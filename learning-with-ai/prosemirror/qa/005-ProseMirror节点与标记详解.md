# ProseMirror 节点（Nodes）与标记（Marks）详解

我们已经详细探讨了 ProseMirror 的 `Schema`，它是定义文档结构规则的核心。现在，我们将深入了解构成这个结构化文档的实际“砖块”——**节点（Nodes）**和**标记（Marks）**。

在 ProseMirror 中，文档是一个由 `Node` 对象组成的树形结构，而 `Mark` 则是附加在某些节点（尤其是文本节点）上的样式或语义信息。它们是文档内容的具体化表示，并由 `Schema` 所定义的规则严格约束。

## 1. 节点 (Nodes)

### 什么是 Node？

`Node` 是 ProseMirror 文档中最基本的结构单元。文档本身（`doc`）就是一个特殊的 Node。所有的内容，无论是段落、标题、图片还是纯文本，都被封装在 Node 对象中。

### Node 的主要特点和类型：

*   **树形结构**: 节点可以包含子节点，从而形成一个层级的树状结构。
*   **Node 类型 (NodeType)**: 每个节点都有一个类型，这个类型由 Schema 定义。例如，`paragraph` (段落), `heading` (标题), `image` (图片), `text` (文本), `doc` (文档根节点)。
*   **内容 (Content)**:
    *   大多数节点可以包含其他节点或文本。Schema 中的 `content` 表达式定义了其合法子节点。
    *   `text` 节点是一个特例，它不包含子节点，而是直接存储文本字符串。
*   **属性 (Attributes)**: 节点可以拥有属性，这些属性存储了该节点的额外数据。例如：
    *   `heading` 节点可以有 `level` 属性（如 `h1`, `h2`）。
    *   `image` 节点可以有 `src`, `alt`, `title` 等属性。
*   **块级节点 (Block Nodes)**: 独占一行，通常用于组织文档的主要结构，如段落、标题、列表项、表格。它们通常包含行内节点或其他块级节点。
*   **行内节点 (Inline Nodes)**: 存在于块级节点内部，与文本混合，如链接、强调文本、图片（作为行内元素）。`text` 节点是最常见的行内节点。
*   **文本节点 (Text Nodes)**: 一种特殊的行内节点，它们是 ProseMirror 文档树的叶子节点，承载实际的文本内容，并且可以附带 `Mark`。

### `doc` 节点的重要性：

*   每个 ProseMirror 文档都以一个 `doc` 节点作为根节点。Schema 中必须定义 `doc` 节点，并且其 `content` 规则定义了文档的顶层结构。

## 2. 标记 (Marks)

### 什么是 Mark？

`Mark`（或称作“标记”）是附加在节点（通常是文本节点）上的一段信息，用于表示该节点的一种样式或语义。例如，加粗（`strong`）、斜体（`em`）、链接（`link`）、代码（`code`）等。

### Mark 的主要特点：

*   **非层级结构**: 与 Node 的树形结构不同，Mark 不是层级嵌套的。它们是“扁平的”附加在文本上。
    *   例如，在 HTML 中 `<b><i>text</i></b>` 是嵌套的，但在 ProseMirror 中，`text` 节点会同时拥有 `strong` 和 `em` 两个 Mark。这避免了 DOM 深度嵌套导致的问题。
*   **范围**: Mark 总是应用于一段连续的文本范围或一个行内节点。
*   **属性 (Attributes)**: 像 Node 一样，Mark 也可以有属性。例如，`link` Mark 会有 `href` 属性来存储链接的 URL。
*   **由 Schema 定义**: 哪些 Mark 是合法的，它们可以拥有哪些属性，以及它们之间是否可以共存（通过 `excludes` 属性）都由 Schema 定义。

## 3. Node 和 Mark 的区别总结

| 特性     | Node (节点)                                  | Mark (标记)                                   |
| :------- | :------------------------------------------- | :-------------------------------------------- |
| **结构** | 树形，可以嵌套，有明确的开始和结束标签         | 扁平的，附加到节点（主要是文本）上，没有嵌套   |
| **作用** | 组织内容结构和语义 (如段落、标题、图片)      | 添加样式或附加语义 (如加粗、斜体、链接)        |
| **内容** | 可以包含其他节点或文本                       | 不包含内容，只是内容的“修饰符”                 |
| **DOM**  | 对应 HTML 元素 (如 `<p>`, `<h1>`, `<img>`)   | 对应 HTML 元素的样式或属性 (如 `<strong>`, `<em>`, `<a href>`) |
| **示例** | `doc`, `paragraph`, `heading`, `image`, `text` | `strong`, `em`, `link`, `code`                |

## 4. Node 和 Mark 的关系与 Schema

Schema 是定义 Node 和 Mark 类型的“蓝图”。它告诉 ProseMirror：

*   有哪些合法的 Node 类型和 Mark 类型。
*   每个 Node 类型的 `content` 模型是什么（它可以包含什么）。
*   每个 Node 和 Mark 的 `attributes` 是什么。
*   每个 Node 和 Mark 如何映射到 DOM（`toDOM`）以及如何从 DOM 解析（`parseDOM`）。

这种分离的、由 Schema 约束的 Node 和 Mark 系统是 ProseMirror 实现高度可控、语义清晰和灵活扩展的文档结构的关键。
