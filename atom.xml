<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
    <title>ç¨‹åºäººç”Ÿ</title>
    <subtitle>è®°å½•ã€æ€è€ƒã€åˆ†äº«</subtitle>
    <link rel="self" type="application/atom+xml" href="https://wangzaixiang.github.io/atom.xml"/>
    <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io"/>
    <generator uri="https://www.getzola.org/">Zola</generator>
    <updated>2025-12-21T00:00:00+00:00</updated>
    <id>https://wangzaixiang.github.io/atom.xml</id>
    <entry xml:lang="en">
        <title>2025 agent æŠ€æœ¯æ±‡ç¼–</title>
        <published>2025-12-21T00:00:00+00:00</published>
        <updated>2025-12-21T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/agents/"/>
        <id>https://wangzaixiang.github.io/blog/agents/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/agents/">&lt;p&gt;ä½œä¸ºä¸€ä¸ª IT ä»ä¸šè€…ï¼Œæˆ‘ä»¬è‡ªèº«æ˜¯æœ€èƒ½æ„Ÿå—åˆ° AI æŠ€æœ¯å¯¹æ—¥å¸¸å·¥ä½œçš„å½±å“çš„ç¾¤é‡Œï¼šclaude code&#x2F;gemini&#x2F;codex å·²ç»æˆä¸ºæˆ‘ä»¬æ—¥å¸¸ç¼–ç¨‹çš„ä¸»åŠ›åŠ©æ‰‹ï¼Œæ˜¯ agent æŠ€æœ¯çš„
æ·±åº¦ä½¿ç”¨è€…ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;context-engineering&quot;&gt;Context Engineering&lt;&#x2F;h1&gt;
&lt;p&gt;ç©¶ç«Ÿæ˜¯ prompt engineering è¿˜æ˜¯ context engineeringï¼Ÿæˆ‘ä¸€åº¦ä¹Ÿçº ç»“è¿‡è¿™ä¸ªæ¦‚å¿µï¼Œä¸è¿‡ä»æœ¬è´¨çš„è§’åº¦æ¥çœ‹ï¼ŒäºŒè€…çš„æœ¬è´¨åŒºåˆ«å¹¶ä¸å¤§ï¼Œåªæ˜¯éšç€åº”ç”¨çš„å¤æ‚åº¦æå‡ï¼Œåœ¨å·¥ç¨‹
é¢†åŸŸéœ€è¦ä¸æ–­çš„ä¼˜åŒ–ï¼šæœ¬è´¨ä¸Šè¿˜æ˜¯æä¾›ç»™ LLM ä¸€ä¸ªæ›´åˆç†çš„ä¸Šä¸‹æ–‡ï¼ˆæˆ–è€…æè¿°ä¸º input æ›´ä¸ºæœ´ç´ ï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æœ¬è´¨ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;LLM context é•¿åº¦é™åˆ¶ï¼Œå¯¼è‡´æˆ‘ä»¬ä¸èƒ½å°†æ‰€æœ‰çŸ¥è¯†éƒ½æ”¾å…¥ context ä¸­
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ª LLM éƒ½æœ‰è‡ªå·±çš„ context é•¿åº¦é™åˆ¶ï¼ˆè¶‹åŠ¿æ˜¯ï¼Œè¿™ä¸ªé—¨æ§›åœ¨é€æ¸æå‡ï¼Œå¾ˆå¤šéƒ½æ˜¯ 256K ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;è¶Šé•¿çš„è¾“å…¥ï¼ŒLLM çš„æˆæœ¬ä¹Ÿæ˜¾è‘—æå‡ï¼Œå“åº”é€Ÿåº¦ä¹Ÿä¼šå˜æ…¢ã€‚ï¼ˆï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;çŸ¥è¯†è¶Šå¤šï¼Œå¸¦ç»™ LLM çš„å¹²æ‰°ã€æ­§ä¹‰ä¹Ÿè¶Šå¤š, LLM å°±è¶Šä¼šè¿·å¤±æ³¨æ„åŠ›ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;context åŒ…æ‹¬ï¼š
&lt;ul&gt;
&lt;li&gt;rules: å¤§éƒ¨ä»½çš„ Prompt éƒ½æ˜¯å›´ç»•è§„åˆ™å±•å¼€çš„ï¼šShould do, Should not do&lt;&#x2F;li&gt;
&lt;li&gt;examples: å…¸å‹çš„ few-shot learning çš„ä¾‹å­&lt;&#x2F;li&gt;
&lt;li&gt;knowledge, references: å…·ä½“çš„çŸ¥è¯†ã€å‚è€ƒèµ„æ–™&lt;&#x2F;li&gt;
&lt;li&gt;tools: tool&#x27;s reference, examples, and rules&lt;&#x2F;li&gt;
&lt;li&gt;user input: ç”¨æˆ·çš„å…·ä½“è¾“å…¥&lt;&#x2F;li&gt;
&lt;li&gt;history
&lt;ul&gt;
&lt;li&gt;tool&#x27;s invocation history&lt;&#x2F;li&gt;
&lt;li&gt;conversation history&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;åˆ†ç±»ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;knowledge representation&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Agent Skills ( metadata, Skill.md,  scripts, references, assets) æœ¬è´¨ä¸Šæ˜¯ä¸€ç§çŸ¥è¯†çš„åˆ†å±‚è¡¨ç¤ºã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;RAG&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;memory management&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;agent-skills&quot;&gt;Agent Skills&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;agentskills.io&#x2F;&quot;&gt;Agent Skills&lt;&#x2F;a&gt; æœ¬è´¨ä¸Šæ˜¯ä¸€ç§é’ˆå¯¹æŠ€èƒ½çŸ¥è¯†çš„åˆ†å±‚è¡¨ç¤ºæ–¹å¼, Skills å°±åƒç»™ agent å®‰è£…çš„&quot;æŠ€èƒ½åŒ…&quot;ï¼Œæ¯ä¸ª skill åŒ…å«ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Metadata: æŠ€èƒ½çš„åç§°ã€æè¿°ã€è§¦å‘æ¡ä»¶&lt;&#x2F;li&gt;
&lt;li&gt;Instructions (skill.md): è¯¦ç»†çš„æ‰§è¡ŒæŒ‡ä»¤å’Œè§„åˆ™ (åŒ…æ‹¬è§„åˆ™ã€æŒ‡ä»¤ï¼Œä»¥åŠå¯¹ scripts&#x2F;references&#x2F;assets å†…å®¹çš„ç´¢å¼•)&lt;&#x2F;li&gt;
&lt;li&gt;Scripts: å¯æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶&lt;&#x2F;li&gt;
&lt;li&gt;References: ç›¸å…³æ–‡æ¡£å’Œç¤ºä¾‹&lt;&#x2F;li&gt;
&lt;li&gt;Assets: é…ç½®æ–‡ä»¶ã€æ¨¡æ¿ç­‰èµ„æº&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;è§£å†³çš„é—®é¢˜&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;çŸ¥è¯†å¤ç”¨: å°†å¸¸è§ä»»åŠ¡ï¼ˆå¦‚ code reviewã€æµ‹è¯•ç”Ÿæˆï¼‰å°è£…æˆ skillï¼Œé¿å…é‡å¤ç¼–å†™ prompt&lt;&#x2F;li&gt;
&lt;li&gt;Context ä¼˜åŒ–: æŒ‰éœ€åŠ è½½ç›¸å…³ skill çš„ contextï¼Œè€Œéæ¯æ¬¡éƒ½åŠ è½½æ‰€æœ‰æŒ‡ä»¤&lt;&#x2F;li&gt;
&lt;li&gt;é¢†åŸŸä¸“ä¸šåŒ–: é’ˆå¯¹ç‰¹å®šåœºæ™¯ï¼ˆå¦‚ç‰¹å®šæ¡†æ¶ã€ä»£ç è§„èŒƒï¼‰å®šåˆ¶ agent è¡Œä¸º&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å·¥ä½œæ–¹å¼&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;text&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-text &quot;&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&#x2F;review-code  â†’  è§¦å‘ &amp;quot;review-code&amp;quot; skill
&lt;&#x2F;span&gt;&lt;span&gt;              â†’  åŠ è½½ skill.md åˆ° context
&lt;&#x2F;span&gt;&lt;span&gt;              â†’  æ‰§è¡Œ skill å®šä¹‰çš„æµç¨‹
&lt;&#x2F;span&gt;&lt;span&gt;              â†’  ä½¿ç”¨ skill ä¸­çš„ tools&#x2F;scripts
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å…¸å‹åº”ç”¨&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&#x2F;commit: æ™ºèƒ½ç”Ÿæˆ git commit message&lt;&#x2F;li&gt;
&lt;li&gt;&#x2F;review-pr: PR ä»£ç å®¡æŸ¥&lt;&#x2F;li&gt;
&lt;li&gt;&#x2F;test: è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹&lt;&#x2F;li&gt;
&lt;li&gt;è‡ªå®šä¹‰ä¸šåŠ¡ skillsï¼ˆå¦‚ç‰¹å®šæ¡†æ¶çš„æœ€ä½³å®è·µæ£€æŸ¥ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ä½¿ç”¨ Knowledge Graph æ¥ç»„ç»‡ Skills ï¼Ÿ
æ–¹æ¡ˆ 1: Hybrid æ··åˆæ¨¡å¼ï¼ˆæ¨èï¼‰&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ + Graph å…ƒæ•°æ®&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;skills&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;â”œâ”€â”€ code-review&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;â”‚   â”œâ”€â”€ skill.md
&lt;&#x2F;span&gt;&lt;span&gt;â”‚   â””â”€â”€ metadata.yaml  â† å®šä¹‰ graph å…³ç³»
&lt;&#x2F;span&gt;&lt;span&gt;â”œâ”€â”€ security-scan&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;â””â”€â”€ graph.json         â† å…¨å±€å…³ç³»å›¾
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;metadata.yaml:
&lt;&#x2F;span&gt;&lt;span&gt;name: code-review
&lt;&#x2F;span&gt;&lt;span&gt;dependencies:
&lt;&#x2F;span&gt;&lt;span&gt;- security-scan
&lt;&#x2F;span&gt;&lt;span&gt;- performance-check
&lt;&#x2F;span&gt;&lt;span&gt;triggers:
&lt;&#x2F;span&gt;&lt;span&gt;- auto: [&amp;quot;*.pr&amp;quot;, &amp;quot;pull_request&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;- command: [&amp;quot;&#x2F;review&amp;quot;, &amp;quot;&#x2F;pr&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;tags: [code-quality, automation]
&lt;&#x2F;span&gt;&lt;span&gt;related_skills:
&lt;&#x2F;span&gt;&lt;span&gt;- refactoring (similarity: 0.8)
&lt;&#x2F;span&gt;&lt;span&gt;- test-generation (often_used_together)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å®ç°ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;SkillGraph&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;__init__&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;):
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.graph = nx.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;DiGraph&lt;&#x2F;span&gt;&lt;span&gt;()  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# NetworkX
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;load_from_filesystem&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;skills_dir&lt;&#x2F;span&gt;&lt;span&gt;):
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for &lt;&#x2F;span&gt;&lt;span&gt;skill_dir &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;in &lt;&#x2F;span&gt;&lt;span&gt;skills_dir.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;iterdir&lt;&#x2F;span&gt;&lt;span&gt;():
&lt;&#x2F;span&gt;&lt;span&gt;              metadata = yaml.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;load&lt;&#x2F;span&gt;&lt;span&gt;(skill_dir &#x2F; &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;metadata.yaml&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;              &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;add_skill_node&lt;&#x2F;span&gt;&lt;span&gt;(skill_dir, metadata)
&lt;&#x2F;span&gt;&lt;span&gt;              &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;add_edges&lt;&#x2F;span&gt;&lt;span&gt;(metadata.dependencies)
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;resolve_dependencies&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;skill_name&lt;&#x2F;span&gt;&lt;span&gt;) -&amp;gt; List[Skill]:
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&amp;quot;&amp;quot;&amp;quot;è¿”å›ä¾èµ–çš„ skillsï¼ˆæ‹“æ‰‘æ’åºï¼‰&amp;quot;&amp;quot;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span&gt;nx.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;topological_sort&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;              &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.graph.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;subgraph&lt;&#x2F;span&gt;&lt;span&gt;(nx.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;ancestors&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.graph, skill_name))
&lt;&#x2F;span&gt;&lt;span&gt;          )
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;recommend_skills&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;task_context&lt;&#x2F;span&gt;&lt;span&gt;) -&amp;gt; List[Skill]:
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&amp;quot;&amp;quot;&amp;quot;åŸºäº graph æ¨èç›¸å…³ skills&amp;quot;&amp;quot;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ä½¿ç”¨ graph embedding æˆ– PageRank
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;æ–¹æ¡ˆ 2: Pure Graph å­˜å‚¨&lt;&#x2F;p&gt;
&lt;p&gt;ä½¿ç”¨ Graph Databaseï¼ˆå¦‚ Neo4jï¼‰ï¼š&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;&#x2F;&#x2F; åˆ›å»º skill
&lt;&#x2F;span&gt;&lt;span&gt;CREATE (review:Skill {
&lt;&#x2F;span&gt;&lt;span&gt;name: &amp;quot;code-review&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;path: &amp;quot;&#x2F;skills&#x2F;code-review&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;})
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; åˆ›å»ºå…³ç³»
&lt;&#x2F;span&gt;&lt;span&gt;CREATE (review)-[:DEPENDS_ON]-&amp;gt;(security:Skill {name: &amp;quot;security-scan&amp;quot;})
&lt;&#x2F;span&gt;&lt;span&gt;CREATE (review)-[:USES_REFERENCE]-&amp;gt;(guide:Reference {path: &amp;quot;style-guide.md&amp;quot;})
&lt;&#x2F;span&gt;&lt;span&gt;CREATE (review)-[:APPLICABLE_TO]-&amp;gt;(lang:Language {name: &amp;quot;Python&amp;quot;})
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; æŸ¥è¯¢ï¼šæ‰¾åˆ°æ‰€æœ‰ Python ç›¸å…³çš„ review skills
&lt;&#x2F;span&gt;&lt;span&gt;MATCH (s:Skill)-[:APPLICABLE_TO]-&amp;gt;(l:Language {name: &amp;quot;Python&amp;quot;})
&lt;&#x2F;span&gt;&lt;span&gt;(s)-[:DEPENDS_ON*0..2]-&amp;gt;(dep)  &#x2F;&#x2F; åŒ…æ‹¬é—´æ¥ä¾èµ–
&lt;&#x2F;span&gt;&lt;span&gt;RETURN s, collect(dep)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ä½•æ—¶ä½¿ç”¨ Graphï¼Ÿ&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;åœºæ™¯&lt;&#x2F;th&gt;&lt;th&gt;æ–‡ä»¶ç³»ç»Ÿ&lt;&#x2F;th&gt;&lt;th&gt;Graph&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;ç®€å•ç‹¬ç«‹ skills (&amp;lt;10ä¸ª)&lt;&#x2F;td&gt;&lt;td&gt;âœ… è¶³å¤Ÿ&lt;&#x2F;td&gt;&lt;td&gt;âŒ è¿‡åº¦è®¾è®¡&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Skills æœ‰ä¾èµ–å…³ç³»&lt;&#x2F;td&gt;&lt;td&gt;âš ï¸ éœ€æ‰‹åŠ¨ç®¡ç†&lt;&#x2F;td&gt;&lt;td&gt;âœ… è‡ªåŠ¨è§£æ&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;éœ€è¦æ™ºèƒ½æ¨è&lt;&#x2F;td&gt;&lt;td&gt;âŒ éš¾å®ç°&lt;&#x2F;td&gt;&lt;td&gt;âœ… é€‚åˆ&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;å¤šç»´åº¦æ£€ç´¢ (è¯­è¨€+é¢†åŸŸ+å·¥å…·)&lt;&#x2F;td&gt;&lt;td&gt;âŒ åªèƒ½æŒ‰ç›®å½•&lt;&#x2F;td&gt;&lt;td&gt;âœ… çµæ´»æŸ¥è¯¢&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Skill ç»„åˆç¼–æ’&lt;&#x2F;td&gt;&lt;td&gt;âš ï¸ ç¡¬ç¼–ç &lt;&#x2F;td&gt;&lt;td&gt;âœ… åŠ¨æ€ç»„åˆ&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;ç‰ˆæœ¬æ¼”åŒ–è¿½è¸ª&lt;&#x2F;td&gt;&lt;td&gt;âŒ&lt;&#x2F;td&gt;&lt;td&gt;âœ…&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Vibe Coding å®è·µè®°å½•</title>
        <published>2025-12-14T00:00:00+00:00</published>
        <updated>2025-12-14T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/vibe-coding-2/"/>
        <id>https://wangzaixiang.github.io/blog/vibe-coding-2/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/vibe-coding-2/">&lt;h1 id=&quot;bei-jing&quot;&gt;èƒŒæ™¯&lt;&#x2F;h1&gt;
&lt;p&gt;æœ€è¿‘ä¸€æ®µæ—¶é—´ï¼Œæ¯”è¾ƒé‡åº¦çš„ä½¿ç”¨ AI å¼€å‘äº†2ä¸ªè½¯ä»¶ï¼Œéƒ½è¿˜æ˜¯è›®æœ‰æŒ‘æˆ˜æ€§çš„ï¼š&lt;&#x2F;p&gt;
&lt;h2 id=&quot;molap-storage&quot;&gt;molap storage&lt;&#x2F;h2&gt;
&lt;p&gt;è¯´æ˜¯ MOLAP(Multi-dimension Online Analysis Process) storageï¼Œè¿™ä¸ªåå­—èµ·å¾—å¤§äº†ä¸€äº›ï¼Œå…¶å®æœ¬é¡¹ç›®åªæ˜¯é’ˆå¯¹ MOLAP è®¡ç®—ä¸­çš„è®¡ç®—åº¦é‡çš„é¢„è®¡ç®—
çš„å­˜å‚¨ã€‚ä¸€èˆ¬çš„ MOLAP å¼•æ“ç´§å¤„ç†åŸå­åº¦é‡çš„é¢„è®¡ç®—çš„å­˜å‚¨ï¼Œå› ä¸ºåŸå­åº¦é‡è‡ªèº«å…·å¤‡å†èšåˆçš„èƒ½åŠ›ï¼Œå…¶å­˜å‚¨çš„æ€§ä»·æ¯”ç›¸å¯¹è¾ƒé«˜ï¼Œè€Œä¸”å…¶æœ¬èº«å¯¹è®¡ç®—åº¦é‡çš„è®¡ç®—
ä¹Ÿæ˜¯å…·æœ‰åŠ é€Ÿæ•ˆæœçš„ã€‚è€Œå¤§éƒ¨ä»½çš„è®¡ç®—åº¦é‡ï¼Œä¸å…·æœ‰å†è®¡ç®—æ€§ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æœ¬è´¨è€Œè¨€ï¼Œè¿™ä¸ªå­˜å‚¨å¼•æ“å°±æ˜¯ä¸€ä¸ªç®€å•çš„ Key-Value å­˜å‚¨å¼•æ“ï¼Œå…¶åŸºæœ¬çš„ API æ˜¯ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;trait &lt;&#x2F;span&gt;&lt;span&gt;DB {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;put&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cube_id&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u16&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dimensions&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;str&lt;&#x2F;span&gt;&lt;span&gt;], &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;: Value) -&amp;gt; Result&amp;lt;()&amp;gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;get&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cube_id&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u16&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dimension&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;str&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; Result&amp;lt;Value&amp;gt;;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ä¸è¿‡ï¼Œç®€å•çš„ API èƒŒåï¼Œè•´å«äº†ä¸å°‘å¤æ‚çš„è®¾è®¡æŒ‘æˆ˜ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;é«˜æ•ˆçš„å­˜å‚¨æ ¼å¼è®¾è®¡ï¼Œä½œä¸ºé¢„è®¡ç®—çš„å­˜å‚¨å¼•æ“ï¼Œè€Œä¸ä»…ä»…æ˜¯å­˜æ”¾åˆ°å†…å­˜ä¸­ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é«˜æ•ˆçš„è¯»å†™æ€§èƒ½ï¼Œå°¤å…¶æ˜¯è¯»æ€§èƒ½ï¼Œåœ¨æˆ‘æœ€æ—©çš„è®¾è®¡ç›®æ ‡ä¸­ï¼Œå¸Œæœ›èƒ½å¤Ÿè¾¾åˆ° 10M QPS çš„è¯»æ€§èƒ½ã€‚(å•ä¸ªè¯·æ±‚è€—æ—¶ ~100ns)ï¼Œè¿™é‡Œéœ€è¦å°½å¯èƒ½çš„åŒ¹é…ç°ä»£ CPU çš„ç‰¹æ€§ï¼Œ
åŒ…æ‹¬ç¼“å­˜æœ‰å¥½ã€SIMD æŒ‡ä»¤é›†çš„ä½¿ç”¨ç­‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é«˜æ•ˆçš„å†…å­˜ä½¿ç”¨ã€‚è¿™ä¸ª API å°†åœ¨ JVM ä¸­ä½¿ç”¨ï¼Œå¦‚æœéœ€è¦å ç”¨è¿‡å¤šçš„ JVM Heap å†…å­˜ï¼Œå°†ä¼šå½±å“åˆ°æ•´ä½“çš„ JVM æ€§èƒ½ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é›¶å¯åŠ¨å¼€é”€ã€‚å³ä½¿å¯¹ä¸€æ¬¡æ€§çš„è„šæœ¬ä»»åŠ¡ï¼Œä¹Ÿå¸Œæœ›èƒ½å¤Ÿå¿«é€Ÿå¯åŠ¨ï¼Œé¿å…å› ä¸ºå­˜å‚¨å¼•æ“çš„åˆå§‹åŒ–è€Œå¸¦æ¥è¿‡å¤šçš„å»¶è¿Ÿã€‚è®¾è®¡ç›®æ ‡æ˜¯å°äº 1ms çš„å¯åŠ¨æ—¶é—´ï¼ˆè¯»ï¼‰ï¼Œ
ä¸€ä¸ªé‡å¤§çš„æŒ‘æˆ˜å°±æ˜¯å¯ç›´æ¥ mmap çš„æ•°æ®ç»“æ„ï¼Œé¿å…ä»»ä½•çš„æ•°æ®åºåˆ—åŒ–æ“ä½œå’Œæ•°æ®å¤åˆ¶å¼€é”€ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;åœ¨&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;the-1brc-program&#x2F;&quot;&gt;the 1brc program&lt;&#x2F;a&gt; é¡¹ç›®ä¸­çš„æè‡´æ€§èƒ½æŒ‘æˆ˜ï¼Œä¸º molap storage çš„è®¾è®¡æä¾›äº†å¾ˆå¥½çš„ç»éªŒç§¯ç´¯,
åœ¨è¿™é¡¹ç›®çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘åŸºæœ¬ä¸Šæ²¡æœ‰èŠ±è´¹å¤ªå¤§çš„ä»£ä»·ï¼Œåªç»å†äº†å‡ è½®å¿«é€Ÿè°ƒä¼˜åï¼Œå°±è¾¾åˆ°äº†æ€§èƒ½ä¸Šçš„æè‡´ç›®æ ‡ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸Šè¿°çš„è®¾è®¡ç›®æ ‡ï¼Œä¸€å¼€å§‹å°±æ³¨å®šè¿™ä¸ªé¡¹ç›®æ˜¯æå…·æŒ‘æˆ˜æ€§çš„ï¼Œä¹Ÿèƒ½å……åˆ†å‘æŒ¥ Rust çš„é¡¶å±‚ç¼–ç¨‹å’Œé«˜æ€§èƒ½çš„æŒ‘æˆ˜ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;reactive-system&quot;&gt;reactive-system&lt;&#x2F;h2&gt;
&lt;p&gt;è¿™ä¸ªé¡¹ç›®æ˜¯ä¸€ä¸ªå“åº”å¼ç³»ç»Ÿå¼•æ“ï¼Œæ˜¯æˆ‘è§„åˆ’ä¸­çš„ Analysis Report(ä¸€ä¸ªç±»ä¼¼äº Observable Notebook çš„æ•°æ®åˆ†æå·¥å…·)çš„æ ¸å¿ƒå¼•æ“ã€‚è¿™ä¸ªå¼•æ“çš„è®¾è®¡ç›®æ ‡æ˜¯ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒå¼‚æ­¥çš„å“åº”å¼è®¡ç®—ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸ºäº¤äº’å¼ notebook æä¾›é«˜æ•ˆçš„å“åº”å¼è®¡ç®—å¼•æ“ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ”¯æŒå¤æ‚çš„å“åº”å¼è®¡ç®—å›¾ï¼Œæ”¯æŒåŠ¨æ€çš„è®¡ç®—å›¾ç»“æ„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¿å®ˆä¿è¯è®¡ç®—çš„å› æœä¸€è‡´æ€§ï¼Œç»ä¸å‡ºç°â€œæ—¶é—´å€’æµâ€ã€â€œæ•°æ®ä¸ä¸€è‡´â€çš„ç°è±¡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ¿€è¿›çš„è°ƒåº¦ä¼˜åŒ–ï¼šä¸¥æ ¼çš„æ‹“æ‰‘æ’åºä¸‹çš„è°ƒåº¦ï¼Œé¿å…é‡å¤è®¡ç®—ï¼Œå¹¶ä¸”åœ¨å› ä¸ºå˜åŒ–è€Œå¯¼è‡´çš„è®¡ç®—è¿‡æœŸæ—¶ï¼Œèƒ½å¤ŸåŠæ—¶å–æ¶ˆè¿‡æœŸè®¡ç®—ï¼ŒèŠ‚çœè®¡ç®—èµ„æºã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;24å¹´ï¼Œæˆ‘è®¾è®¡è¿‡ reactive-system çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¹¶ä¸”åœ¨å…¬å¸çš„äº¤äº’å¼ä»ªè¡¨ç›˜ä¸­åº”ç”¨ï¼Œå¯¹è§£å†³äº¤äº’å¼æ•°æ®åˆ†æä¸­çš„æ•°æ®ä¾èµ–ã€æ•°æ®è”åŠ¨ç­‰é—®é¢˜ï¼Œå‘æŒ¥äº†é‡è¦çš„
ä½œç”¨ï¼ˆè¿™ä¸€å—ä¹Ÿæ˜¯äº§å“å†å²BUGçš„é‡ç¾åŒºï¼‰ã€‚åœ¨ V1 çš„è®¾è®¡åŸºç¡€ä¸Šï¼Œæˆ‘ä¸ºå“åº”å¼ç³»ç»Ÿè¿›è¡Œå¼•å…¥äº†æ–°çš„ç›®æ ‡ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒ notebook ä¸­ code cell è¿™æ ·çš„ å¤šè¾“å…¥ï¼Œå¤šè¾“å‡ºçš„è®¡ç®—å•å…ƒï¼ˆV1 æ˜¯å¤šè¾“å…¥ï¼Œå•è¾“å‡ºï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å®šä¹‰äº†æ›´ä¿å®ˆçš„å› æœä¸€è‡´æ€§æ¨¡å‹ï¼Œç¡®ä¿åœ¨å¼‚æ­¥è®¡ç®—ç¯å¢ƒä¸‹ï¼Œæ•°æ®çš„ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¼•å…¥äº†æ›´æ¿€è¿›çš„è°ƒåº¦ä¼˜åŒ–ç­–ç•¥ï¼Œå¯¹ä»»ä½•è¿‡æ—¶çš„è®¡ç®—ä»»åŠ¡ï¼Œèƒ½å¤ŸåŠæ—¶å–æ¶ˆï¼ŒèŠ‚çœè®¡ç®—èµ„æºã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ›´æ˜ç¡®çš„å¼‚å¸¸ä¼ æ’­æœºåˆ¶ã€‚å°†å¼‚å¸¸ä½œä¸ºè®¡ç®—ç»“æœçš„ä¸€éƒ¨åˆ†è¿›è¡Œä¼ æ’­ï¼Œç¡®ä¿ä¸‹æ¸¸è®¡ç®—èƒ½å¤Ÿæ­£ç¡®å¤„ç†ä¸Šæ¸¸çš„å¼‚å¸¸æƒ…å†µã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;è¿™ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒ API å¾ˆç®€å•ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;typescript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-typescript &quot;&gt;&lt;code class=&quot;language-typescript&quot; data-lang=&quot;typescript&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;interface &lt;&#x2F;span&gt;&lt;span&gt;ReativeModule {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;defineSource&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;source&lt;&#x2F;span&gt;&lt;span&gt;: { &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;id&lt;&#x2F;span&gt;&lt;span&gt;: string, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;initialValue&lt;&#x2F;span&gt;&lt;span&gt;?: any}): void;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;defineComputation&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;computation&lt;&#x2F;span&gt;&lt;span&gt;: {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;id&lt;&#x2F;span&gt;&lt;span&gt;: string;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inputIds&lt;&#x2F;span&gt;&lt;span&gt;: string[];
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;outputIds&lt;&#x2F;span&gt;&lt;span&gt;: string[];
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;body&lt;&#x2F;span&gt;&lt;span&gt;: (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;scope&lt;&#x2F;span&gt;&lt;span&gt;: Scope, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;signal&lt;&#x2F;span&gt;&lt;span&gt;: AbortSignal) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;Promise&amp;lt;Record&amp;lt;string, any&amp;gt;&amp;gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    }): void;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;updateSource&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;id&lt;&#x2F;span&gt;&lt;span&gt;: string, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;newValue&lt;&#x2F;span&gt;&lt;span&gt;: any): void;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;getValue&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;id&lt;&#x2F;span&gt;&lt;span&gt;: string): Promise&amp;lt;any&amp;gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;observe&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;id&lt;&#x2F;span&gt;&lt;span&gt;: string, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;observer&lt;&#x2F;span&gt;&lt;span&gt;: (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;result&lt;&#x2F;span&gt;&lt;span&gt;: Result&amp;lt;any&amp;gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;void): Unsubscribe;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;interface &lt;&#x2F;span&gt;&lt;span&gt;Scope {
&lt;&#x2F;span&gt;&lt;span&gt;    [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;variableId&lt;&#x2F;span&gt;&lt;span&gt;: string]: Promise&amp;lt;any&amp;gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;__getResult&lt;&#x2F;span&gt;&lt;span&gt;: (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;variableId&lt;&#x2F;span&gt;&lt;span&gt;: string) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;Promise&amp;lt;Result&amp;lt;any&amp;gt;&amp;gt;;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;Unsubscribe = () &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;void;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å½“ç„¶ï¼Œ24å¹´æˆ‘ä»…æ˜¯ä½œä¸ºè®¾è®¡è€…ï¼Œè€Œå¼€å‘æ˜¯ç”±ä¸€ä½å‰ç«¯åŒäº‹å®Œæˆçš„ï¼Œè€Œä¸”ï¼Œå½¼æ—¶å¹¶æ²¡æœ‰å€ŸåŠ© AI çš„åŠ›é‡ï¼Œå¼€å‘è¿‡ç¨‹ç›¸å¯¹è¾ƒé•¿ï¼Œè€Œä¸”ä¹Ÿæ˜¯åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ä¸ç®—ç¡®è®¤è®¾è®¡
ç»†èŠ‚ã€‚è€Œç°åœ¨ï¼Œåˆ™æ˜¯ç”±æˆ‘æ¥äº²è‡ªè®¾è®¡ã€ç¼–ç ï¼Œå¹¶ä¸”æ˜¯å€ŸåŠ© Claude Code &#x2F;Gemini ç­‰ AI åŠ©åŠ›æ¥å®Œæˆå¼€å‘ä»»åŠ¡ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿæƒ³æ¯”ä¼ ç»Ÿçš„å¼€å‘æ–¹å¼æœ‰äº†å¾ˆå¤§çš„ä¸åŒï¼Œ
åœ¨å·®ä¸å¤š2å‘¨çš„æ—¶é—´é‡Œï¼Œæˆ‘å…¶å®æ˜¯å®Œæˆäº†2ç‰ˆå¤§å‹çš„è®¾è®¡æ”¹é€ ï¼ˆä» V2 çš„ MVCC è®¾è®¡ï¼Œåˆ° V3 çš„åŸºäº cause_at çš„æ—¶é—´å› æœè®¾è®¡ï¼‰ï¼Œåœ¨ç¬¬3ç‰ˆä¸­ï¼Œåˆè¿›è¡Œå¤šæ¬¡çš„
å®ç°ç»†èŠ‚çš„é‡å¤§è°ƒæ•´ï¼Œå¯¹è°ƒåº¦ã€å–æ¶ˆæœºåˆ¶ã€çŠ¶æ€ç®¡ç†ç­‰éƒ½åšäº†å¥½å‡ æ¬¡çš„é‡æ„ï¼Œå‡ ä¹æ˜¯æ¯å¤©ä¸€æ¬¡å¤§å‹çš„ä»£ç é‡æ„ï¼‰ï¼Œæœ€ç»ˆå®Œæˆäº† V3 çš„è®¾è®¡å’Œå®ç°ï¼Œè¾¾åˆ°äº†æˆ‘å¿ƒç›®ä¸­
ï¼ˆæš‚æ—¶ï¼‰æ¯”è¾ƒå®Œç¾çš„æ„Ÿè§‰ã€‚&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªç³»ç»Ÿéƒ½æ¯”è¾ƒç±»ä¼¼äº ã€ŠA Philosophy of Software Designã€‹ä¸€ä¹¦ä¸­çš„åŸåˆ™ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ›´çª„çš„æ¥å£ï¼šæ¥å£æä¾›äº†é«˜åº¦ç®€å•ã€æŠ½è±¡çš„è¯­ä¹‰ï¼Œéšè—äº†å¤æ‚çš„å®ç°ç»†èŠ‚ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ›´æ·±çš„å®ç°ï¼šåœ¨ç®€å•çš„æ¥å£ä¹‹åï¼Œéšè—äº†å¤æ‚çš„å®ç°ç»†èŠ‚ï¼Œè¿™äº›ç»†èŠ‚éƒ½æ˜¯åé‡äºæ€§èƒ½ã€ä¸€è‡´æ€§çš„æœºåˆ¶ä¼˜åŒ–ï¼Œä½†å¹¶ä¸æš´éœ²ä½¿ç”¨çš„å¤æ‚æ€§ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;workflow-feature-phase-task-workflow&quot;&gt;workflow: feature-phase-task workflow&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨è¿™ä¸¤ä¸ªé¡¹ç›®çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘é€æ­¥å½¢æˆäº†æˆ‘è‡ªå·±çš„ä¸€å¥— workflowï¼Œéå¸¸é€‚åˆäº vibe coding çš„å¼€å‘æ¨¡å¼ï¼Œç›¸å…³çš„æ–‡æ¡£å¯ä»¥å‚è€ƒï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;feature-phase-task-workflow&#x2F;&quot;&gt;feature-phase-task workflow&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;ä½¿ç”¨è¿™ä¸ª workflow ä¼˜ç‚¹ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;è´´åˆ Spec First çš„æ¨¡å¼ï¼šæˆ‘ä»¬ä¸»è¦çš„ç²¾åŠ›åœ¨äºéœ€æ±‚è§„æ ¼å’Œè®¾è®¡æ–‡æ¡£çš„å‡†å¤‡ä¸Šï¼ˆå½“ç„¶è¿™ä¸ªè¿‡ç¨‹ AI å¯ä»¥ç»™ä½ å¾ˆå¤šçš„åŠ©åŠ›ï¼Œä½†ä¸»è¦çš„èŒè´£æ˜¯ä½ ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ Spec å‡†å¤‡å¥½ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå’Œ AI ä¸€èµ·è¯„ä¼°ä¸€ä¸ªå¼€å‘çš„è®¡åˆ’ï¼šåˆ†è§£æˆä¸ºå¤šä¸ª phase,æ¯ä¸ª phase åŒ…å«å¤šä¸ª taskã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹äºä¸ç¡®å®šæ¯”è¾ƒé«˜çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬éœ€è¦å¯åŠ¨ phase 0 é˜¶æ®µï¼šé€šè¿‡å®šä¹‰end-to-end çš„ä½¿ç”¨åœºæ™¯ï¼ŒåŸºäºè¿™äº›ä½¿ç”¨åœºæ™¯ï¼Œç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®å®šæ•´ä½“çš„ API è®¾è®¡ï¼Œ
åœ¨ç¡®å®šäº† API è®¾è®¡ä¹‹åï¼Œå†è¿›è¡Œåç»­çš„ phase æ‹†è§£å’Œ task çš„æ‹†è§£ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;feature å¯¹åº”äº Feature Driven Development çš„ featureï¼Œæˆ–è€… git flow ä¸­çš„ä¸€ä¸ª feature åˆ†æ”¯ï¼Œä¸€ä¸ª Pull Requestã€‚æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½ç‰¹æ€§ã€‚
å¤šä¸ª feature å¯ä»¥å¹¶è¡Œè¿›è¡Œå¼€å‘ï¼Œæœ€å merge åˆ°ä¸»åˆ†æ”¯ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;phase å¯¹åº”äºä¸€ä¸ªå°çš„è¿­ä»£ç›®æ ‡ï¼Œä¸€ä¸ª phase å¯ä»¥ç”¨äºéªŒè¯æŸä¸ªåŸå‹ï¼Œä¸ºä¸‹ä¸€ä¸ª phase åšå‡†å¤‡ï¼Œå¯ä»¥æ˜¯ä¸¢å¼ƒå‹çš„åŸå‹å¼€å‘ï¼Œä¹Ÿå¯ä»¥æ˜¯å¢é‡å¼çš„å¼€å‘ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;task å¯¹åº”äºä¸€ä¸ªå…·ä½“çš„å¼€å‘ä»»åŠ¡ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå°çš„åŠŸèƒ½ç‚¹ï¼Œæˆ–è€…ä¸€ä¸ªæ¨¡å—çš„å®ç°ã€‚task æ˜¯æœ€å°çš„å¼€å‘å•å…ƒã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å®Œæˆè§„åˆ’åï¼Œå°±å¯ä»¥ä»¥ AI ä¸ºä¸»çš„æ–¹å¼å»è¿›è¡Œæ¨è¿›ï¼Œåœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œé€‚å½“çš„è¿›è¡Œå¹²é¢„å³å¯ï¼Œè€Œæ— éœ€é«˜é¢‘ç‡çš„è¿›è¡Œè®¨è®ºå’Œç¼–ç æ²Ÿé€šã€‚è¿™ä¹Ÿä½¿å¾—æˆ‘ä»¬å¯ä»¥å¹¶è¡Œè¿›è¡Œå¤šä¸ª
feature çš„å¼€å‘ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;ai-de-chang-xiang-yu-duan-ban&quot;&gt;AI çš„ é•¿é¡¹ ä¸ çŸ­æ¿&lt;&#x2F;h1&gt;
&lt;p&gt;è¿™ä¸¤ä¸ª2é¡¹ç›®ï¼Œä¸€ä¸ªæ˜¯ Rustï¼Œä¸€ä¸ªæ˜¯ TypeScriptï¼Œä¸¤ä¸ªè¯­è¨€æˆ‘éƒ½æ˜¯æœ‰ä¸€å®šäº†è§£ï¼Œä½†éƒ½ä¸æ˜¯éå¸¸ç†Ÿç»ƒã€‚æ•´ä¸ªå¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä½“éªŒäº† claude code å’Œ gemini ä¸¤ä¸ª agentï¼Œ
ä»–ä»¬å½¼æ­¤çš„ä¹ æ€§ä¹Ÿæœ‰æ‰€ä¸åŒã€‚åœ¨å®æˆ˜è¿‡ç¨‹ä¸­ï¼Œæœ‰çš„ä»»åŠ¡ï¼ŒAI èƒ½å¤Ÿéå¸¸å¥½çš„å®Œæˆï¼Œè€Œæœ‰çš„ä»»åŠ¡ï¼Œåˆ™è¿˜æ˜¯ä¼ ç»Ÿçš„ IDE æ›´ä¸ºé€‚åˆã€‚å½“ç„¶ï¼Œåœ¨èƒ½åŠ›ä¸Šï¼ŒAI ä¹Ÿæœ‰é•¿é¡¹å’ŒçŸ­æ¿ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;äº†è§£ AI çš„é•¿é¡¹å’ŒçŸ­æ¿ï¼Œæœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½çš„åˆ©ç”¨ AI æ¥å®Œæˆå¼€å‘ä»»åŠ¡ï¼Œä»¥åŠå¦‚ä½•åœ¨ä¸€ä¸ªæ°å½“çš„æˆæœ¬ä¸Šï¼Œå®Œæˆå¼€å‘å·¥ä½œã€‚å¦åˆ™ï¼Œä½ å°±ä¼šçƒ§æ‰å¤§é‡çš„ token å´éš¾ä»¥è¾¾æˆç›®æ ‡ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;AI éå¸¸é€‚åˆäºä»£ç çš„ç”Ÿæˆï¼Œå´ä¸ä¸€å®šé€‚åˆäºä»£ç çš„ä¿®æ”¹ï¼Œå°¤å…¶æ˜¯å¤§èŒƒå›´çš„ä»£ç ä¿®æ”¹ã€‚å¦‚æœæŸä¸ªç»“æ„æ€§çš„è®¾è®¡çš„è°ƒæ•´ï¼Œå¯¼è‡´äº†å¤§èŒƒå›´çš„ä»£ç ä¿®æ”¹ï¼Œå¤§é‡çš„ä»£ç é”™è¯¯ï¼Œå¤§é‡çš„å•å…ƒæµ‹è¯•å¤±è´¥ï¼Œ
é‚£ä¹ˆè¿™æ—¶ï¼Œä½ ä¾èµ– AI æ¥è¿›è¡Œä»£ç çš„ä¿®æ”¹ï¼Œä¼šæ˜¯ä¸€ä¸ªç›¸å½“æ¼«é•¿ã€ä¸”çƒ§é’±çš„è¿‡ç¨‹ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;è¿™æ—¶ï¼Œå¯èƒ½äººå·¥ä»‹å…¥çš„ï¼ŒåŸºäºä¼ ç»Ÿçš„ IDE çš„é‡æ„çš„æ–¹å¼ï¼Œå¯èƒ½æ˜¯æ›´ä¸ºé«˜æ•ˆçš„æ–¹å¼ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœå› ä¸ºè®¾è®¡è°ƒæ•´å¯¼è‡´å¤§é‡çš„å•å…ƒæµ‹è¯•å¤±æ•ˆï¼Œé‚£ä¹ˆä¸å…¶è®©å…¶é€ä¸ªä¿®å¤å•å…ƒæµ‹è¯•ï¼Œä¸å¦‚åºŸå¼ƒæ‰è¿™äº›å•å…ƒæµ‹è¯•ï¼Œé‡æ–°ç¼–å†™ï¼ˆç”Ÿæˆï¼‰æ–°çš„å•å…ƒæµ‹è¯•ï¼Œå¯èƒ½ä¼šæ›´ä¸ºé«˜æ•ˆã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœæŸä¸ªä»»åŠ¡ï¼ŒAI é™·å…¥äº†æ— é™å¾ªç¯ï¼Œåœ¨ä¸æ–­çš„ä¿®æ”¹ä»£ç å°è¯•é€šè¿‡çš„æ—¶å€™ï¼Œå¯èƒ½å°±éœ€è¦åŠæ—¶ä»‹å…¥ï¼Œç»™äºˆæ–°çš„æŒ‡å¯¼ï¼Œæˆ–è€…ç›´æ¥äººå·¥ä»‹å…¥å®Œæˆä»»åŠ¡ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ç»“æ„æ€§çš„é‡æ„ï¼Œå¯èƒ½å¯¼è‡´ç°æœ‰çš„ä»£ç å¤§é¢ç§¯å¤±æ•ˆï¼Œè¿™æ—¶ï¼Œä¸å…¶è®© AI å»ä¿®å¤è¿™äº›ä»£ç ï¼Œä¸å¦‚å¤§åˆ€é˜”æ–§çš„è¿›è¡Œé‡å†™&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;é‡æ–°å’Œ AI è®¨è®ºè®¾è®¡ç»†èŠ‚ï¼Œè®¨è®ºå¼€å‘è®¡åˆ’çš„è§„åˆ’ï¼Œä¸å…¶è®©å…¶ä¿®æ”¹ç°æœ‰ä»£ç ï¼Œä¸å¦‚è®©å…¶åŸºäºæ–°çš„è®¾è®¡ï¼Œé‡æ–°ç¼–å†™æ–°çš„ä»£ç ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœåœ¨ä¸Šæ¬¡è¿­ä»£ä¸­ï¼ŒAI ç”Ÿæˆçš„ä»£ç è´¨é‡å¹¶ä¸é«˜ï¼Œé‚£ä¹ˆåœ¨æ–°çš„è®¾è®¡ä¸­ï¼Œå¯¹è¿™äº›ä¸æ¸…æ™°çš„åœ°æ–¹ï¼Œå¼ºè°ƒè®¾è®¡çš„ç»†èŠ‚ï¼ŒåŒ…æ‹¬ï¼š
&lt;ul&gt;
&lt;li&gt;æ ¸å¿ƒçš„æ•°æ®ç»“æ„&lt;&#x2F;li&gt;
&lt;li&gt;API å®šä¹‰ï¼ŒåŒ…æ‹¬è¾“å…¥ã€è¾“å‡ºç­‰ç­¾åä¿¡æ¯ï¼Œä»¥åŠè¯­ä¹‰çš„å®šä¹‰ï¼ŒDesign by Contract ä¹Ÿæ˜¯éå¸¸é€‚åˆäº AI ç¼–ç¨‹ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;AI åœ¨å†™ä»£ç çš„é€Ÿåº¦ä¸Šï¼Œå¯èƒ½æ˜¯ä¼˜ç§€å·¥ç¨‹å¸ˆçš„10å€+ï¼ˆæ›´å¯èƒ½æ˜¯æ™®é€šå·¥ç¨‹å¸ˆçš„å‡ åå€ï¼‰ï¼Œä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªå·¨å¤§çš„é—®é¢˜ï¼šå°±æ˜¯åœ¨è®¾è®¡ä¸å¤Ÿæ¸…æ™°ã€ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œå®ƒä¹Ÿä¼š
æŒ‰ç…§ä¸€ä¸ªâ€œå¿«æªæ‰‹â€çš„æ€ç»´æ¨¡å¼ï¼Œåº”ä»˜å¼ã€å¿«é€Ÿçš„è¾¾æˆçœ¼ä¸‹çš„ç›®æ ‡ï¼ˆå¦‚é€šè¿‡å•å…ƒæµ‹è¯•ï¼‰ï¼Œè¿™ä¸€ç‚¹å€’æ˜¯éå¸¸è±¡ä¸€ä¸ªæ²¡æœ‰è¿½æ±‚çš„ï¼Œæœ‰ä¸°å¯Œç»éªŒçš„å·¥ç¨‹å¸ˆï¼šå®ƒæ— æ‰€ä¸èƒ½çš„å¯ä»¥è¾¾æˆ
å½“ä¸‹çš„ç›®æ ‡ï¼Œå´å®Œå…¨ä¸ç®¡ä¸é¡¾ä¼šä¸ºåç»­ç•™ä¸‹å¤šå°‘æŠ€æœ¯å€ºåŠ¡ã€‚ï¼ˆå¾ˆå¤šå…¬å¸éƒ½æœ‰è¿™æ ·çš„â€œæŠ€æœ¯é«˜æ‰‹â€ï¼Œä»€ä¹ˆé—®é¢˜éƒ½èƒ½è§£å†³ï¼Œå½“ç„¶ï¼Œå¤§éƒ¨ä»½çš„é—®é¢˜ä¹Ÿéƒ½æ˜¯ä»–åŸ‹ä¸‹çš„å‘ï¼Œä¸€æ—¦é—®å…¶
ä»–æ¥ï¼Œç†ç”±å°±æ˜¯ï¼šå½“æ—¶è¦æ±‚çš„æ—¶é—´é‚£ä¹ˆæ€¥ï¼Œåªèƒ½è¿™ä¹ˆè§£å†³äº†ï¼Œè‡³äºæŠ€æœ¯å€ºåŠ¡ï¼Œæˆ‘éƒ½çŸ¥é“ï¼Œä½†æ˜¯åé¢ä¹Ÿæ²¡æœ‰æ—¶é—´å»å¤„ç†äº†ï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰€ä»¥ï¼Œä¸è¦å¤ªä¿¡ä»» AI ç”Ÿæˆçš„ä»£ç ï¼Œä¸€å®šè¦æœ‰ä¸¥æ ¼çš„ code review æœºåˆ¶ã€‚å¦‚æœå‘ç°ä»£ç è´¨é‡ä¸é«˜ï¼Œå¤§éƒ¨ä»½æ˜¯æˆ‘ä»¬è¿‡äºç›¸ä¿¡ AIï¼Œè€Œåœ¨æ²¡æœ‰è¶³å¤Ÿæ¸…æ™°çš„è®¾è®¡ç»†èŠ‚ä¸‹ï¼Œå°±è®© AI è¿›è¡Œå‘æŒ¥ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è¿™ä¸ªæ—¶å€™ï¼Œæ˜¯é‡æ–°è¯„ä¼°æˆ‘ä»¬çš„è®¾è®¡ç»†èŠ‚çš„æ—¶å€™ï¼Œéœ€è¦é‡æ–°æ•²å®šè®¾è®¡ï¼Œæ˜ç¡®æ•°æ®ç»“æ„ã€API çš„å¥‘çº¦ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è¯„ä¼°è¿™ä¸ªæ”¹è¿›æ˜¯ AI æ“…é•¿çš„ï¼Œè¿˜æ˜¯ä¸æ“…é•¿çš„ï¼ˆä¸€èˆ¬çš„ï¼Œè¯­ä¹‰ç¡®å®šã€å¥‘çº¦æ¸…æ™°ï¼Œè¦æ±‚æ˜ç¡®çš„ï¼ŒAIä¸€èˆ¬éƒ½æ˜¯æ¯”è¾ƒæ“…é•¿çš„ï¼‰ï¼Œæ¥é€‰æ‹©ï¼š
&lt;ul&gt;
&lt;li&gt;æ˜¯è®© AI æ¥è¿›è¡Œé‡æ„ã€ä¿®æ”¹ï¼Œ&lt;&#x2F;li&gt;
&lt;li&gt;è¿˜æ˜¯åºŸå¼ƒå½“å‰çš„ä¿®æ”¹ï¼Œè®© AI é‡æ–°åŸºäºæ–°çš„è®¾è®¡ï¼Œé‡æ–°ç¼–å†™ä»£ç ã€‚ï¼ˆæœ‰çš„æ—¶å€™ï¼Œè¿™ä¼šæ¯”ä¿®æ”¹ç°æœ‰ä»£ç æ¥å¾—æ›´ä¸ºæœ‰æ•ˆï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;è¿˜æ˜¯äººå·¥ä»‹å…¥ï¼ŒåŸºäºä¼ ç»Ÿçš„ IDE æ¥å®Œæˆé‡æ„ä»»åŠ¡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æŠ‘æˆ–æ˜¯äººå·¥ä»‹å…¥ï¼Œç¼–å†™æ¡†æ¶è¡Œçš„ä»£ç ï¼Œè®© AI æ¥å®Œæˆå‰©ä½™çš„ç»†èŠ‚å·¥ä½œã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹æŸäº›ä»£ç è´¨é‡è¦æ±‚ä¸é«˜ï¼Œåªéœ€è¦è¾¾æˆç›®æ ‡å³å¯çš„ä»»åŠ¡ï¼ŒAI æ˜¯éå¸¸é€‚åˆçš„ï¼Œè¿™ç§åœºæ™¯ä¸‹ï¼Œåªéœ€è¦è¿›è¡Œç›¸å¯¹æ˜ç¡®çš„ç›®æ ‡å®šä¹‰ï¼Œè€Œæ— éœ€è¿›è¡Œè¿‡å¤šçš„æ¶æ„ã€è®¾è®¡ç»†èŠ‚çš„å®šä¹‰ï¼Œ
å¯ä»¥å®Œå…¨æ”¾æ‰‹è®© AI æ¥å®Œæˆä»»åŠ¡ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å¼€å‘ molap storage è¿‡ç¨‹ä¸­ï¼Œæˆ‘éœ€è¦ä¸€ä¸ª CLI å·¥å…·æ¥æŸ¥çœ‹å­˜å‚¨æ–‡ä»¶çš„å†…å®¹ï¼Œä»¥æ ¸å®å­˜å‚¨æ–‡æ¡£æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚æˆ‘å¹¶ä¸å…³å¿ƒè¿™ä¸ª CLI å·¥å…·çš„ä»£ç è´¨é‡ï¼Œåªéœ€è¦å®ƒèƒ½å·¥ä½œå³å¯ã€‚
è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘å°±åªéœ€è¦æè¿°ç›®æ ‡ï¼Œè€Œè®© AI æ¥è‡ªç”±å‘æŒ¥ã€‚æ•´ä¸ªè¿‡ç¨‹ï¼Œæˆ‘åŸºæœ¬ä¸Šæ²¡æœ‰çœ‹è¿‡æˆ–ä¿®æ”¹è¿‡å®ƒçš„ä»£ç ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨å¼€å‘è¿‡ç¨‹ä¸­çš„ä¸€äº›è„šæœ¬å·¥å…·ï¼Œä¹Ÿæ˜¯å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼æ¥å®Œæˆã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ç¼–å†™æ›´å°çš„æ¨¡å—ã€æ›´å°çš„å‡½æ•°ï¼Œè¿™ä¼šæ˜¾è‘—æå‡ AI ç¼–å†™ä»£ç çš„é€Ÿåº¦ã€è´¨é‡ï¼ŒåŒæ—¶ï¼Œä¹Ÿæ˜¯å‡å°‘ token æ¶ˆè€—çš„æœ‰æ•ˆæ–¹å¼ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ä¸€ä¸ª 2000 è¡Œçš„ä»£ç æ–‡ä»¶ä¸Šè¿›è¡Œä¿®æ”¹ï¼ŒAI éœ€è¦ç†è§£å¤§é‡çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ‰èƒ½è¿›è¡Œæœ‰æ•ˆçš„ä¿®æ”¹ï¼Œè¿™ä¼šæ˜¾è‘—å¢åŠ  token çš„æ¶ˆè€—ã€‚ä½ å¯èƒ½éœ€è¦æ¶ˆè€—å¤§é‡çš„èŠ±è´¹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç›¸åï¼Œå¦‚æœä½ æŠŠä»£ç æ‹†è§£æˆå¤šä¸ªå°çš„æ¨¡å—ã€å¤šä¸ªå°çš„å‡½æ•°ï¼Œé‚£ä¹ˆ AI åªéœ€è¦ç†è§£å±€éƒ¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå°±èƒ½å®Œæˆä¿®æ”¹ä»»åŠ¡ï¼Œè¿™ä¼šæ˜¾è‘—å‡å°‘ token çš„æ¶ˆè€—ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æˆ‘ä¹Ÿå°è¯•è¿‡ï¼Œå¦‚æœå¯¹ä¸€ä¸ªå¤§çš„å‡½æ•°ï¼ˆå®é™…ä¸Šï¼Œè¶…è¿‡50è¡Œçš„ä»£ç ï¼Œäººçš„ç†è§£é€Ÿåº¦å°±ä¼šæŒ‡æ•°ä¸‹é™ï¼‰ï¼Œä½¿ç”¨ SLAP åŸåˆ™è¿›è¡Œæ‹†è§£ï¼Œä¸ä»…è®©æˆ‘ä»¬é˜…è¯»ä»£ç æ›´ä¸ºå®¹æ˜“ï¼Œ
ä¹Ÿä¼šæ˜¾è‘—æå‡ AI è¿›è¡Œä»£ç ä¿®æ”¹çš„æ•ˆç‡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ¨èä½¿ç”¨ FP çš„ç¼–ç¨‹èŒƒå¼ï¼Œè¿™ä¸ä»…å¯ä»¥è®©ä»£ç æ›´ä¸ºç®€çŸ­ï¼Œä¹Ÿæ›´å®¹æ˜“è®© AI ç†è§£ä»£ç çš„æ„å›¾ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;da-dao-kuo-fu-de-zhong-gou&quot;&gt;å¤§åˆ€é˜”æ–§çš„é‡æ„&lt;&#x2F;h1&gt;
&lt;p&gt;æœªå®Œï¼Œå¾…ç»­&lt;&#x2F;p&gt;
&lt;h1 id=&quot;faq&quot;&gt;FAQ&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;AI ç”Ÿæˆçš„ä»£ç è´¨é‡ä¸é«˜ï¼Œæ€ä¹ˆåŠï¼Ÿ&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;ä¸è¦å¤ªä¿¡ä»» AI çš„èƒ½åŠ›ï¼Œéƒ¨ä»½æƒ…å†µä¸‹ï¼Œå®ƒå°±æ˜¯å¯èƒ½æ— æ³•ç”Ÿæˆé«˜è´¨é‡çš„ä»£ç ã€‚è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦æœ‰ä¸¥æ ¼çš„ code review æœºåˆ¶ï¼Œç»™å‡ºä½ çš„æ˜ç¡®çš„æ”¹è¿›æ„è§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¿…è¦çš„æ—¶å€™ï¼Œä½ å¿…é¡»èº¬èº«å…¥å±€ï¼Œå®Œæˆè¿™ä¸€å—ä»£ç çš„ç¼–å†™ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸è¿‡ï¼Œå¤§éƒ¨ä»½çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥åæ€ï¼Œæ˜¯ä¸æ˜¯æˆ‘çš„éœ€æ±‚è§„æ ¼ä¸å¤Ÿæ¸…æ™°ï¼Œè®¾è®¡ç»†èŠ‚ä¸å¤Ÿæ˜ç¡®ï¼Œæˆ–è€…æ˜¯å…¶ä¸­å­˜åœ¨çŸ›ç›¾å’Œæ­§ä¹‰ï¼Œå¯¼è‡´ AI ç†è§£é”™è¯¯ï¼Œæˆ–è€…è‡ªç”±å‘æŒ¥è¿‡åº¦ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å®é™…ä¸Šï¼Œæ²¡æœ‰ AI ä¹‹å‰ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯æ™®éå­˜åœ¨çš„ï¼Œå¦‚æœæ˜¯éœ€æ±‚è§„æ ¼ã€è®¾è®¡ä¸Šçš„é—®é¢˜ï¼Œæˆ‘ä»¬å¾ˆå¤šæ—¶å€™ä¼šå› ä¸ºå¯¹éœ€æ±‚è§„æ ¼ã€è®¾è®¡è§„æ ¼çš„å˜æ›´ä»£ä»·çš„ææƒ§ï¼Œæ›´å€¾å‘äº
ä½¿ç”¨æ‰“è¡¥ä¸çš„æ–¹å¼æ¥è§£å†³é—®é¢˜ï¼Œè€Œä¸æ˜¯é‡æ–°è¯„ä¼°è®¾è®¡ï¼Œè¿›è¡Œæ›´å¤§èŒƒå›´çš„é‡æ„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç°åœ¨ï¼Œæœ‰äº† AI çš„åŠ©åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¤§èƒ†çš„è¿›è¡Œè®¾è®¡çš„è°ƒæ•´å’Œé‡æ„ï¼Œä»¥åŠé‡æ–°å®¡è§†æˆ‘ä»¬çš„æ—©æœŸè®¾è®¡çš„ä¸è¶³çš„èƒ½åŠ›ã€‚è¿™å¯èƒ½ä¼šå€’é€¼è®¾è®¡è€…æé«˜è‡ªèº«çš„æ€ç»´ä¸¥è°¨èƒ½åŠ›ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ AI ç¼–ç¨‹æ—¶ä»£ï¼Œå·¥ç¨‹å¸ˆä¸å†é‡è¦äº†ï¼Œæˆ‘ä»¬åªéœ€è¦äº§å“ç»ç†ï¼Œæˆ–è€…å‡ ä¸ªåˆçº§å·¥ç¨‹å¸ˆå°±è¶³å¤Ÿäº†ï¼Ÿ&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;çœ‹åœºæ™¯ï¼šå¦‚æœæ˜¯ä¸€äº›ç®€å•çš„ CRUD åº”ç”¨ï¼Œæˆ–è€…æ˜¯ä¸€äº›å·²ç»å¾ˆæˆç†Ÿçš„é—®é¢˜é¢†åŸŸï¼Œè¿™ä¸ªè¯´æ³•å¯èƒ½æ˜¯æˆç«‹çš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æˆ‘çš„ä¸åŒçœ‹æ³•æ˜¯ï¼šAI æ—¶ä»£ï¼Œåˆçº§å·¥ç¨‹å¸ˆçš„ä»·å€¼åè€Œä¸‹é™äº†ï¼Œè€Œé«˜çº§å·¥ç¨‹å¸ˆçš„ä»·å€¼åè€Œæå‡äº†ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;AI coding å…¶å®æ˜¯èƒ½åŠ›çš„å¤åˆ¶å™¨ï¼Œè€Œä¸æ˜¯èƒ½åŠ›çš„åˆ›é€ å™¨ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;60åˆ†çš„å·¥ç¨‹å¸ˆ + AI å¯èƒ½ç›¸å½“äº 2-3 ä¸ª 60åˆ†çš„å·¥ç¨‹å¸ˆï¼Œ&lt;&#x2F;li&gt;
&lt;li&gt;70åˆ†çš„å·¥ç¨‹å¸ˆ + AI å¯èƒ½ç›¸å½“äº 2-4 ä¸ª 70åˆ†çš„å·¥ç¨‹å¸ˆï¼Œèƒ½åŠ›é«˜çš„å·¥ç¨‹å¸ˆï¼Œå¯èƒ½ä¹Ÿä¼šæ›´æ“…é•¿ä½¿ç”¨ AI å·¥å…·ï¼Œ&lt;&#x2F;li&gt;
&lt;li&gt;80åˆ†çš„å·¥ç¨‹å¸ˆ + AI å¯èƒ½ç›¸å½“äº 3-6 ä¸ª 80åˆ†çš„å·¥ç¨‹å¸ˆï¼Œ&lt;&#x2F;li&gt;
&lt;li&gt;90åˆ†çš„å·¥ç¨‹å¸ˆ + AI å¯èƒ½ç›¸å½“äº 4-8 ä¸ª 90åˆ†çš„å·¥ç¨‹å¸ˆã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨è´¨é‡ä¼˜å…ˆçš„åœºæ™¯ä¸‹ï¼Œéœ€è¦å°å¿ƒåˆçº§å·¥ç¨‹å¸ˆçš„è´¨é‡æ•ˆåº”ï¼šæ²¡æœ‰ AI æ—¶ï¼Œæ¯ä¸ªæœˆå¯èƒ½åªä¼šäº§å‡º 2000è¡Œ ä½è´¨é‡çš„ä»£ç ï¼Œè€Œæœ‰äº† AI ä¹‹åï¼Œå¯èƒ½æ¯ä¸ªæœˆäº§å‡º 20,000è¡Œ
ä½è´¨é‡çš„ä»£ç ï¼Œè¿™äº›ä»£ç å¯èƒ½ä¼šå¸¦æ¥å¤§é‡çš„æŠ€æœ¯å€ºåŠ¡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ‰€ä»¥ï¼Œåœ¨ AI coding æ—¶ä»£ï¼Œæ›´éœ€è¦é«˜çº§å·¥ç¨‹å¸ˆæ¥è¿›è¡Œè®¾è®¡ã€æ¶æ„ã€ä»£ç è´¨é‡çš„æŠŠæ§ï¼Œç¡®ä¿äº§å‡ºçš„ä»£ç è´¨é‡ã€‚ä¸€ä¸ªé«˜æ°´å¹³çš„å·¥ç¨‹å¸ˆï¼Œå°±ç›¸å½“äºä¼ ç»Ÿæ¨¡å¼ä¸‹
çš„ä¸€ä¸ªé«˜æ°´å¹³å›¢é˜Ÿã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;AI coding ä¼šä¸ä¼šå¸¦æ¥å¤§é‡çš„æŠ€æœ¯å€ºåŠ¡ï¼Ÿ&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;è¿™å®Œå…¨å–å†³äºæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ AI coding å·¥å…·ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœæˆ‘ä»¬è¿‡äºç›¸ä¿¡ AI coding çš„èƒ½åŠ›ï¼Œè€Œå¿½è§†äº†è®¾è®¡ç»†èŠ‚ã€ä»£ç è´¨é‡ï¼Œé‚£ä¹ˆ AI coding å¯èƒ½ä¼šå¸¦æ¥å¤§é‡çš„æŠ€æœ¯å€ºåŠ¡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç›¸åï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿä¸¥æ ¼æŠŠæ§è®¾è®¡ç»†èŠ‚ã€ä»£ç è´¨é‡ï¼Œé‚£ä¹ˆ AI coding åè€Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å‡å°‘æŠ€æœ¯å€ºåŠ¡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä»å¦å¤–ä¸€ä¸ªè§’åº¦æ¥çœ‹ï¼šAI coding çš„æè‡´æ•ˆç‡ï¼Œå¯ä»¥è®©æˆ‘ä»¬çš„è®¾è®¡ã€æ¶æ„å‰æœŸçš„ä¸è¶³ä»¥å°½å¿«çš„é€Ÿåº¦è¢«æš´éœ²å‡ºæ¥ï¼Œå¯¹å…¶è¿›è¡Œå½»åº•é‡æ„çš„æˆæœ¬ä¹Ÿå¤§å¹…é™ä½ï¼Œè¿™ä¸ªæˆæœ¬
åœ¨ä¼ ç»Ÿæ¨¡å¼ä¸‹å¯èƒ½æ˜¯æœ›è€Œç”Ÿç•çš„ï¼Œè€Œåœ¨ AI coding æ—¶ä»£ï¼Œå˜å¾—æ²¡é‚£ä¹ˆææ€–äº†ï¼ˆä»ç„¶æ˜¯å·¨å¤§çš„ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å·¥ç¨‹å¸ˆå¦‚ä½•åœ¨ AI æ—¶ä»£æå‡è‡ªå·±çš„ä»·å€¼ï¼Ÿ&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;æå‡è‡ªå·±çš„è®¾è®¡èƒ½åŠ›ã€æ¶æ„èƒ½åŠ›ï¼Œåœ¨æ¯æ¬¡ AI äº¤äº’ä¸­ï¼Œåæ€è‡ªå·±çš„æŒ‡ä»¤ï¼ˆåŒ…æ‹¬éœ€æ±‚è§„æ ¼ã€è®¾è®¡è§„æ ¼ã€å¼€å‘è¿‡ç¨‹åˆ†è§£ï¼‰æ˜¯å¦åˆç†ã€‚æˆ‘ä»¬æœ‰æ›´å¤šçš„æ—¶é—´å»åš
é«˜ä»·å€¼çš„æ€è€ƒå·¥ä½œäº†ã€‚ä½†ä½ éœ€è¦å»æ€è€ƒã€å»ç»ƒä¹ ï¼Œå»æ”¹è¿›ã€‚æå‡è¿™æ–¹é¢çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬çš„èƒ½åŠ›æ‰ä¼šå¾—åˆ°è´¨çš„æå‡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;AI å¯èƒ½æ˜¯æœ€å¥½çš„è€å¸ˆã€‚åœ¨å¤§éƒ¨ä»½é¢†åŸŸï¼Œä»–éƒ½æ˜¯ä¸€ä¸ª80-90åˆ†çš„é«˜æ‰‹ï¼Œä½ å¯ä»¥éšæ—¶è¯·æ•™ï¼Œç›¸å½“äºä½ éšæ—¶å¯ä»¥å‘ä»»æ„é¢†åŸŸçš„ä¸“å®¶è¯·æ•™é—®é¢˜ï¼Œå‡ ä¹æ²¡æœ‰ä»»ä½•æˆæœ¬ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½ ä¼šé—®é—®é¢˜çš„èƒ½åŠ›ï¼Œå†³å®šäº†ä½ èƒ½ä» AI é‚£é‡Œå­¦åˆ°å¤šå°‘ä¸œè¥¿ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Dec 2025</title>
        <published>2025-12-02T00:00:00+00:00</published>
        <updated>2025-12-02T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2025-12/"/>
        <id>https://wangzaixiang.github.io/monthly/2025-12/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2025-12/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;rust&quot;&gt;Rust&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@theopinionatedev&#x2F;ecs-vs-actor-model-in-rust-the-architecture-showdown-abd1d241014e&quot;&gt;ECS vs Actor Model in Rust&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Feature&lt;&#x2F;th&gt;&lt;th&gt;ECS&lt;&#x2F;th&gt;&lt;th&gt;Actor Model&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;CPU Throughput&lt;&#x2F;td&gt;&lt;td&gt;ğŸ”¥ Extremely high&lt;&#x2F;td&gt;&lt;td&gt;âš¡ Medium&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Memory layout&lt;&#x2F;td&gt;&lt;td&gt;Contiguous, cache-hot&lt;&#x2F;td&gt;&lt;td&gt;Scattered&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Async workflows&lt;&#x2F;td&gt;&lt;td&gt;âŒ Hard&lt;&#x2F;td&gt;&lt;td&gt;âœ… Natural&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Distributed systems.&lt;&#x2F;td&gt;&lt;td&gt;âŒ No&lt;&#x2F;td&gt;&lt;td&gt;âœ… Perfect&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Scaling across machines.&lt;&#x2F;td&gt;&lt;td&gt;âŒ Not applicable&lt;&#x2F;td&gt;&lt;td&gt;âœ… Built for this&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Data-driven workloads.&lt;&#x2F;td&gt;&lt;td&gt;âœ… Best in class&lt;&#x2F;td&gt;&lt;td&gt;âŒ Inefficient&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Isolation&lt;&#x2F;td&gt;&lt;td&gt;âŒ Shared memory model&lt;&#x2F;td&gt;&lt;td&gt;âœ… Strong isolation&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Parallelism.&lt;&#x2F;td&gt;&lt;td&gt;Automatic via borrows&lt;&#x2F;td&gt;&lt;td&gt;Actor-per-thread&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Ideal Use.&lt;&#x2F;td&gt;&lt;td&gt;Simulation, compute, pipelines&lt;&#x2F;td&gt;&lt;td&gt;Services, orchestration&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;ul&gt;
&lt;li&gt;ä»æ€§èƒ½çš„è§’åº¦ï¼ŒECS ç±»ä¼¼äºåˆ—å­˜ï¼Œé€‚åˆäº OLAP å‹çš„æ‰¹é‡ã€é«˜åååº”ç”¨ï¼Œè€Œ Actor Model ç±»ä¼¼äºè¡Œå­˜ï¼Œæ›´é€‚åˆ OLTP å‹çš„å°äº¤äº’ï¼Œå¤§å¹¶å‘äº¤äº’å¼åº”ç”¨ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Bevy ç­‰ ECS æ¶æ„å¯ä»¥é€šè¿‡å€Ÿç”¨åˆ†ææ¥è¯†åˆ«å¯å¹¶è¡Œçš„æ“ä½œï¼ˆå¦‚æœä¸¤ä¸ªæ“ä½œåœ¨æ•°æ®è®¿é—®ä¸Šæ²¡æœ‰å€Ÿç”¨å†²çªï¼Œåˆ™å¯ä»¥å¹¶è¡Œï¼‰ï¼Œè€Œ Actor Model åˆ™é€šè¿‡æ¶ˆæ¯ä¼ é€’æ¥å®ç°è¿è¡Œæ—¶éš”ç¦»ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä»æ‰©å±•æ€§çš„è§’åº¦å¯¹æ¯”
&lt;ul&gt;
&lt;li&gt;Actor å¤©ç„¶åŒ¹é…æ°´å¹³æ‰©å±•ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ECS é«˜åº¦åŒ¹é…å‚ç›´æ‰©å±•ï¼ˆå•æœºå¤šæ ¸ï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ECS å¯¹ OCP åŸåˆ™çš„æ”¯æŒæ›´å¥½ï¼ˆé€šè¿‡ç»„ä»¶ç»„åˆå®ç°æ–°åŠŸèƒ½ï¼‰ï¼Œè€Œ Actor Model åˆ™æ›´ä¾èµ–äºç»§æ‰¿å’Œå¤šæ€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åº·å¨å®šå¾‹ï¼šECS å¯ä»¥æ›´å¥½çš„æ”¯æŒå•å®ä½“å¤šç»„ä»¶è·¨å›¢é˜Ÿçš„ç‹¬ç«‹å¼€å‘ï¼Œè€Œ Actor Model åˆ™æ›´é€‚ä»¥å®ä½“ä¸ºå•ä½çš„å›¢é˜Ÿåˆ’åˆ†ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;scala&quot;&gt;Scala&lt;&#x2F;h2&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;Mpp &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dipankar-tnt.medium.com&#x2F;apache-parquet-vs-newer-file-formats-btrblocks-fastlanes-lance-vortex-cdf02130182c&quot;&gt;data storage format&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;apache parquet:
&lt;ul&gt;
&lt;li&gt;columnar layout, row group and pages, encoding and compression, statistics and filters, interoperability.&lt;&#x2F;li&gt;
&lt;li&gt;decode bottlenecks,&lt;&#x2F;li&gt;
&lt;li&gt;Random access inefficiency&lt;&#x2F;li&gt;
&lt;li&gt;Memory pressure, Row Groups typically in 128M&lt;&#x2F;li&gt;
&lt;li&gt;lack of SIMD&#x2F;GPU awareness&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;maxi-k&#x2F;btrblocks&quot;&gt;BtrBlocks&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ç‰ºç‰²å‹ç¼©ç‡çš„å‰æä¸‹ï¼Œæè‡´ä¼˜åŒ–è§£å‹å’Œæ‰«æé€Ÿåº¦ã€‚è§£å‹ä¸“ä¸º SIMD ä¼˜åŒ–ï¼Œå‹ç¼©ç‡æé«˜ï¼ˆé€šè¿‡æ™ºèƒ½é€‰æ‹©æœ€ä½³ç¼–ç ç»„åˆï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å‹ç¼©æ€§èƒ½å¹¶ä¸æ¯” Parquet æ›´è€—æ—¶ï¼Œé€šå¸¸å†™å¾—æ›´å¿«ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ™ºèƒ½é€‰æ‹© + ç®€å•ç®—æ³• &amp;gt; å›ºå®šé€‰æ‹© + å¤æ‚ç®—æ³•ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;cwida&#x2F;FastLanes&quot;&gt;FastLanes&lt;&#x2F;a&gt;: Next-Gen Big Data File Format
&lt;ul&gt;
&lt;li&gt;æè‡´å‹ç¼©ç‡ + è§£å‹ç¼©æ€§èƒ½ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ•°æ®å¹¶è¡Œç¼–ç ï¼šFOR&#x2F;RLE&#x2F;DICT å¯ä»¥é«˜æ•ˆåœ¨ SIMD&#x2F;GPU ä¸Šè¿è¡Œ&lt;&#x2F;li&gt;
&lt;li&gt;è¡¨è¾¾å¼ç¼–ç &lt;&#x2F;li&gt;
&lt;li&gt;å¤šåˆ—å‹ç¼©ï¼šè¯†åˆ«ä¸åŒåˆ—ä¹‹é—´çš„ç›¸å…³æ€§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç»†ç²’åº¦è®¿é—®å’Œéƒ¨ä»½è§£å‹ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;lancedb.com&#x2F;docs&#x2F;storage&quot;&gt;Lance&lt;&#x2F;a&gt;: æ ¸å¿ƒç›®æ ‡ï¼šå¤„ç† AI åº”ç”¨ä¸­å¯¹å¤šæ¨¡æ€ã€å¿«é€Ÿæ›´æ–°å’Œé«˜æ•ˆéšæœºè®¿é—®çš„éœ€æ±‚ã€‚
&lt;ul&gt;
&lt;li&gt;é«˜æ€§èƒ½éšæœºè®¿é—®
&lt;ul&gt;
&lt;li&gt;parquet é‡å‹ç¼©ï¼Œå˜é•¿ç¼–ç ï¼Œä»¥æ•°æ®å—ä¸ºå•å…ƒã€‚ï¼ˆRowGroup -&amp;gt; Column Chunk -&amp;gt; Pageï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;Lance å°†æ•°æ®é“ºçš„æ›´æœ‰åºï¼Œå¯ç›´æ¥è®¡ç®—åç§»é‡ã€‚ï¼ˆæ›´å°çš„ Fragmentsï¼Œæ¯ä¸ªFragæœ‰ç‹¬ç«‹çš„å…ƒæ•°æ®å¥å’Œ Min&#x2F;Max ä¿¡æ¯ï¼ŒFragsæœ‰å…¨å±€ç´¢å¼•ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;ç¼–ç æ–¹å¼ï¼šLanceï¼šå›ºå®šå®½åº¦ + åç§»é‡è¡¨ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç´¢å¼•æœºåˆ¶ï¼šParquet æ²¡æœ‰è¡Œå·ç´¢å¼•ã€‚Lance å¯ä»¥é€šè¿‡ ç´¢å¼• -&amp;gt; RowId -&amp;gt; åç§»é‡ å¿«é€Ÿå®šä½ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;I&#x2F;O: parquet åŸºäºå¤§å—è¯»å–ï¼ŒLance å€¾å‘éšæœºè®¿é—®ã€‚åŸºäº SSD å’Œ io_uring æŠ€æœ¯ï¼Œä¸€æ¬¡æ€§å‘å‡ºå¤šä¸ªå°è¯»è¯·æ±‚ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;åŸç”Ÿå¤šæ¨¡æ€æ•°æ®æ”¯æŒ&lt;&#x2F;li&gt;
&lt;li&gt;é›†æˆå‘é‡æœç´¢&lt;&#x2F;li&gt;
&lt;li&gt;é›¶æ‹·è´ Schema æ¼”è¿›ï¼šé«˜æ•ˆçš„æ·»åŠ æˆ–ä¿®æ”¹åˆ—ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç‰ˆæœ¬æ§åˆ¶&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;research.google&#x2F;pubs&#x2F;vortex-a-stream-oriented-storage-engine-for-big-data-analytics&#x2F;&quot;&gt;Vortex&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;vortex.dev&quot;&gt;web site&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vortex-data&#x2F;vortex&quot;&gt;github&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;æ—¨åœ¨æˆä¸º Apache Parquet çš„ç»§ä»»è€…&lt;&#x2F;li&gt;
&lt;li&gt;Arrow åŸç”Ÿï¼šzero copy&lt;&#x2F;li&gt;
&lt;li&gt;çº§é—´å‹ç¼©ï¼šç±»ä¼¼äº BtrBlockã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æè‡´æ‰©å±•æ€§ï¼šå®¹è®¸ç”¨æˆ·è‡ªå®šä¹‰ç¼–ç ï¼Œå¸ƒå±€ç­–ç•¥å’Œå‹ç¼©ç®—æ³•ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;web-frontend&quot;&gt;Web &amp;amp; Frontend&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;Elm
æ‰‹ç—’ï¼Œåˆæ‘¸äº†ä¸€ä¸‹ elm è¿™ä¸ªè¯­è¨€ã€‚
&lt;ul&gt;
&lt;li&gt;çº¯å‡½æ•°å¼è¯­è¨€ï¼Œç±»ä¼¼ Haskellã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ²¡æœ‰ null å’Œ undefinedï¼Œæ‰€æœ‰å€¼éƒ½æ˜¯ä¸å¯å˜çš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¼ºç±»å‹ç³»ç»Ÿï¼Œç±»å‹æ¨å¯¼ã€‚é‡æ„æ—¶éå¸¸å‹å¥½ã€å®‰å…¨ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;model-view-update æ¶æ„ã€‚éå¸¸çš„å‡½æ•°å¼ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å·ç§°ï¼šâ€œæ²¡æœ‰è¿è¡Œæ—¶é”™è¯¯çš„è¯­è¨€â€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ€§èƒ½ä¸é”™ï¼š
&lt;ul&gt;
&lt;li&gt;æ”¶ç›Šäºä¸å¯å˜æ•°æ®ç»“æ„ï¼Œå¯ä»¥ä½¿ç”¨ === æ¥å¿«é€Ÿæ¯”è¾ƒæ•°æ®å˜åŒ–ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Html.Lazy æ¥é¿å…ä¸å¿…è¦çš„ DOM æ›´æ–°ã€‚ï¼ˆä¸ä»…å¯ä»¥é¿å…æ›´æ–°ï¼Œç”šè‡³ view å‡½æ•°éƒ½ä¸ä¼šè¢«æ‰§è¡Œï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;Keyed èŠ‚ç‚¹é‡ç”¨ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;æ¿€è¿›ä¼˜åŒ–
&lt;ul&gt;
&lt;li&gt;çº¯å‡½æ•° + ä¸å¯å˜ + å¼ºç±»å‹ï¼Œæ²¡æœ‰åŠ¨æ€å±æ€§è®¿é—®ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;record renamingï¼šç¼–è¯‘æ—¶å°† record çš„å­—æ®µåæ›¿æ¢ä¸ºæ•°å­—ç´¢å¼•ï¼Œé¿å…è¿è¡Œæ—¶çš„å­—ç¬¦ä¸²æŸ¥æ‰¾ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;static function inliningã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ELM çš„ç±»å‹ç³»ç»Ÿä¿è¯äº†ä¸€ä¸ª Record ç»“æ„åœ¨è¿è¡ŒæœŸä¸ä¼šåŠ¨æ€å˜åŒ–ï¼ŒåŒ¹é…æµè§ˆå™¨çš„ shape optimizationã€‚&lt;&#x2F;li&gt;
&lt;li&gt;constant foldingã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;æœ€å°æåŠï¼š25-30Kï¼Œä½†éšç€åº”ç”¨è§„æ¨¡çš„å¢é•¿ï¼ŒElm çš„ä½“ç§¯å¢å¢é•¿æ›²çº¿è¦æ¯” JS å¹³ç¼“å¾—å¤šã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;expertbeacon.com&#x2F;a-real-world-comparison-of-front-end-frameworks-with-benchmarks&#x2F;&quot;&gt;A Real-World Comparison Of Front-End Frameworks With Benchmarks 2024&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;ä»£ç å¯†åº¦ï¼š
&lt;ul&gt;
&lt;li&gt;UI æè¿°ï¼šä»£ç é‡åå¤š&lt;&#x2F;li&gt;
&lt;li&gt;çŠ¶æ€ç®¡ç†ï¼šModel -&amp;gt; Msg -&amp;gt; Update -&amp;gt; Viewï¼Œä»£ç é‡åå¤š(æ¯æ¬¡ä¿®æ”¹éƒ½éœ€è¦åŒæ­¥è¿™4ä¸ªåœ°æ–¹)ï¼Œä½†éå¸¸æ¸…æ™°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸šåŠ¡é€»è¾‘ï¼šä»£ç é‡é€‚ä¸­ï¼Œä½†éå¸¸æ¸…æ™°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯è¯»æ€§æœ€ä½³ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.roc-lang.org&quot;&gt;ROC&lt;&#x2F;a&gt; : ç±»ä¼¼ Elm çš„çº¯å‡½æ•°å¼è¯­è¨€ï¼ŒåŸºäº Rust è¯­è¨€ï¼Œè„±ç¦» JavaScript ç”Ÿæ€ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;ai-agent&quot;&gt;AI &amp;amp; Agent&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;misc&quot;&gt;Misc&lt;&#x2F;h1&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Nov 2025</title>
        <published>2025-11-12T00:00:00+00:00</published>
        <updated>2025-11-12T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2025-11/"/>
        <id>https://wangzaixiang.github.io/monthly/2025-11/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2025-11/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;rust&quot;&gt;Rust&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@bugsybits&#x2F;inside-cargos-parallel-compilation-engine-how-rust-builds-faster-than-you-think-2515bed4f604&quot;&gt;Inside Cargoâ€™s Parallel Compilation Engine: How Rust Builds Faster Than You Think&lt;&#x2F;a&gt;
äº†è§£ Cargo å’Œ rustc çš„ç¼–è¯‘è¿‡ç¨‹&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;ul&gt;
&lt;li&gt;DAG of cratesï¼šä¾æ® crateä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ— éœ€ä¾èµ–æºä»£ç åˆ†æã€‚&lt;&#x2F;li&gt;
&lt;li&gt;the new parallel front-end: parsing, HIR, MIR, type-checking, borrow-checking
&lt;ul&gt;
&lt;li&gt;crate as a unit, serial&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Code Generation Units: LLVM IR generation, optimization, codegen.
&lt;ul&gt;
&lt;li&gt;a crate may split more CGUs in parallel threads&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Linking, often a bottleneck.&lt;&#x2F;li&gt;
&lt;li&gt;Incremental &amp;amp; Caching: only changed crates or units are rebuilt, metadata(.rmeta) files help.
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;monthly&#x2F;2025-11&#x2F;img_1.png&quot; alt=&quot;img_1.png&quot; &#x2F;&gt;&lt;br &#x2F;&gt;
å€ŸåŠ©ä¸ codexï¼Œæˆ‘ç”Ÿæˆäº†ä¸€ä¸ªæµç¨‹å›¾ï¼š
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
  graph TD
    A[&amp;quot;Source files&amp;quot;] --&amp;gt; B[&amp;quot;Parse &amp;amp; macro expand&amp;quot;]
    B --&amp;gt; C[&amp;quot;HIR build &amp;amp; fingerprint&amp;quot;]
    C --&amp;gt; D[&amp;quot;Type check &amp;amp; borrow check\n[cache]&amp;quot;]
    D --&amp;gt; E[&amp;quot;MIR build &amp;amp; opt passes\n[cache]&amp;quot;]

    E --&amp;gt; F{{&amp;quot;Split codegen units\n(parallel)&amp;quot;}}
    F --&amp;gt; G1[&amp;quot;MIR â†’ LLVM IR (per CGU)\n[cache]&amp;quot;]
    G1 --&amp;gt; H1[&amp;quot;LLVM opt (per CGU)\n[cache]&amp;quot;]
    H1 --&amp;gt; I1[&amp;quot;Codegen to object&amp;#x2F;bitcode (.o&amp;#x2F;.bc)\n[cache]&amp;quot;]

    I1 --&amp;gt; L{&amp;quot;LTO enabled?&amp;quot;}
    L -- &amp;quot;No&amp;quot; --&amp;gt; J{{&amp;quot;Join objects&amp;quot;}}
    L -- &amp;quot;ThinLTO&amp;quot; --&amp;gt; T1{{&amp;quot;ThinLTO index &amp;amp; schedule\n(parallel)&amp;quot;}}
    T1 --&amp;gt; T2[&amp;quot;ThinLTO cross-unit opt&amp;#x2F;codegen\n[cache]&amp;quot;]
    T2 --&amp;gt; J
    L -- &amp;quot;Full LTO&amp;quot; --&amp;gt; F1[&amp;quot;Monolithic LTO pipeline\n[cache]&amp;quot;]
    F1 --&amp;gt; J

    J --&amp;gt; K[&amp;quot;Link final artifact&amp;quot;]

    classDef cache fill:#e8f5e9,stroke:#388e3c,color:#1b5e20;
    classDef parallel fill:#e3f2fd,stroke:#1e88e5,color:#0d47a1;

    class D,E,G1,H1,I1,T2,F1 cache;
    class F,J,T1 parallel;
  ```
&lt;&#x2F;div&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;scala&quot;&gt;Scala&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;Scala 3.7.4 released.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;Mpp &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;web-frontend&quot;&gt;Web &amp;amp; Frontend&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jurisjs.com&quot;&gt;juris.js&lt;&#x2F;a&gt; åˆä¸€ä¸ªç»„ä»¶æ¡†æ¶&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;no build&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨ JSON-Like æè¿° DOM (JavaScript Object Notion):
&lt;ul&gt;
&lt;li&gt;static value: no reactive&lt;&#x2F;li&gt;
&lt;li&gt;function: reactive&lt;&#x2F;li&gt;
&lt;li&gt;enhance(): é€æ­¥å¢å¼ºæ¨¡å¼ï¼šå¯¹é™æ€ HTML è¿›è¡Œå¢å¼º&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;blockquote&gt;
&lt;p&gt;æ˜¯å¦éœ€è¦ä¸€ç§æ›´å¥½çš„ structure object notion? æ”¯æŒæ›´å¤šçš„æ•°æ®ç±»å‹ï¼Ÿè¿˜æ˜¯ JSON ? å¯ä»¥ä¸æˆ‘ä¹‹å‰è®¾è®¡çš„ XUL è¿›è¡Œä¸€ä¸ªå¯¹æ¯”ã€‚
éƒ¨åˆ†çš„è®¾è®¡æ€è·¯æ˜¯å€¼å¾—å‚è€ƒçš„ã€‚
æ„Ÿè§‰ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ–°æ¦‚å¿µä¸å¤šï¼Œæ¯”è¾ƒç®€æ´ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç”±äºæ²¡æœ‰ build é˜¶æ®µï¼Œéš¾ä»¥å®ç°è¯¸å¦‚ solidjs&#x2F;svelte è¿™ç±»çš„ç²¾ç»†åŒ–å“åº”å¼&lt;&#x2F;li&gt;
&lt;li&gt;ä½œä¸º DSL çš„ç®€æ´æ€§å€¼å¾—å•†æ¦·ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@resti.guay&#x2F;your-framework-vs-juris-js-on-data-table-rendering-ff3920b2316e&quot;&gt;Juris Performance Compare&lt;&#x2F;a&gt;
è¿™ç¯‡æ–‡ç« å¯¹æ¯”äº† Juris&#x2F;Svelte&#x2F;React&#x2F;Vue3&#x2F;Angular ç­‰æ¡†æ¶åœ¨ä¸€ä¸ªæ¡ˆä¾‹ï¼š100 table rows with 4 actions and 5 editable cells ä¸Šçš„
å†…å­˜å ç”¨ã€æ¸²æŸ“è€—æ—¶ã€äº‹ä»¶å»¶è¿Ÿæ–¹é¢çš„å¯¹æ¯”æ•°æ®ã€‚å¯ä»¥ä½œä¸ºå¯¹æ¡†æ¶æ€§èƒ½å¯¹æ¯”çš„ä¸€ä¸ªå‚è€ƒã€‚
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;monthly&#x2F;2025-11&#x2F;img.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;è¿™ç¯‡æ–‡ç« ä¸­çš„ Juris ç›¸æ¯” Svelte åœ¨ render time ä¸Šè¿˜æ›´å¿«é€Ÿï¼Œbatch rendering mode? è¿™ä¸ªåŸå› ä¸ç¡®å®šã€‚&lt;&#x2F;li&gt;
&lt;li&gt;äº‹ä»¶çš„å»¶è¿Ÿä¹Ÿæ¯” Svelte æ›´å¿«ï¼ŒWhy?&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å…³æ³¨äº†ä¼—å¤šçš„ Web ç»„ä»¶æ¡†æ¶ï¼Œæˆ‘å¿ƒç›®ä¸­ç†æƒ³çš„ ç»„ä»¶æ¡†æ¶ é•¿ä»€ä¹ˆæ¨¡æ ·ï¼Ÿåç»­éœ€è¦èŠ±äº›æ—¶é—´æ€è€ƒå¹¶æ•´ç†ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;build or no-build&lt;&#x2F;li&gt;
&lt;li&gt;V-DOM or DOM&lt;&#x2F;li&gt;
&lt;li&gt;ç²¾ç¡®å“åº”å¼ï¼Ÿ&lt;&#x2F;li&gt;
&lt;li&gt;JSON or JSX or ...&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;autognosi.medium.com&#x2F;typst-studio-in-pure-rust-webassembly-and-rust-for-modern-web-applications-4e2e52be14a2&quot;&gt;Typst Studio in Pure Rust: WebAssembly and Rust for Modern Web ApplicationswTypst Studio in Pure Rust: WebAssembly and Rust for Modern Web Applicationstudio&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;automataia.github.io&#x2F;wasm-typst-studio-rs&#x2F;&quot;&gt;Typst Studio&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;blockquote&gt;
&lt;p&gt;WASM çš„æœ€ä½³åº”ç”¨åœºæ™¯åœ¨å“ªé‡Œï¼Ÿ
Typst æ˜¯å¦é€‚åˆä½œä¸º markdown çš„æ›¿ä»£ï¼Ÿä½œä¸ºæ•°æ®åˆ†æå’Œå¯è§†åŒ–é¢†åŸŸå†…çš„æ–‡æ¡£è½½ä½“å‘¢ï¼Ÿ&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;ai-agent&quot;&gt;AI &amp;amp; Agent&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;toon-format&#x2F;toon&quot;&gt;toon&lt;&#x2F;a&gt; token-oriented object notion
LLM æ—¶ä»£çš„ JSON&#x2F;YML æ›¿ä»£ï¼Œ ç›¸æ¯” JSON èŠ‚çœ40% tokenï¼Œå‡†ç¡®æ€§è¿˜æ›´é«˜ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Graph RAG
å¯¹æ•°æ®åˆ†æç±»çš„ agent, Graph RAG å¯ä»¥åšäº›ä»€ä¹ˆï¼Ÿ&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;misc&quot;&gt;Misc&lt;&#x2F;h1&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>FPT workflow</title>
        <published>2025-11-01T00:00:00+00:00</published>
        <updated>2025-11-01T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/feature-phase-task-workflow/"/>
        <id>https://wangzaixiang.github.io/blog/feature-phase-task-workflow/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/feature-phase-task-workflow/">&lt;h1 id=&quot;feature-phase-task-workflow&quot;&gt;Feature-Phase-Task Workflow&lt;&#x2F;h1&gt;
&lt;p&gt;æœ¬æ–‡æ¡£å®šä¹‰äº† Vibe Coding å®æ–½é¡¹ç›®çš„æµç¨‹å’Œè§„èŒƒã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;shu-yu-biao&quot;&gt;æœ¯è¯­è¡¨&lt;&#x2F;h2&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;æœ¯è¯­&lt;&#x2F;th&gt;&lt;th&gt;å®šä¹‰&lt;&#x2F;th&gt;&lt;th&gt;ç¤ºä¾‹&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;Feature&lt;&#x2F;td&gt;&lt;td&gt;ç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—&lt;&#x2F;td&gt;&lt;td&gt;scheme_v2, file_writer&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Phase&lt;&#x2F;td&gt;&lt;td&gt;Feature å†…çš„å¼€å‘é˜¶æ®µ&lt;&#x2F;td&gt;&lt;td&gt;Phase 1, Phase 2&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Task&lt;&#x2F;td&gt;&lt;td&gt;æœ€å°å·¥ä½œå•å…ƒï¼ˆ0.5-1å¤©ï¼‰&lt;&#x2F;td&gt;&lt;td&gt;Task 1, Task 2&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;TDD&lt;&#x2F;td&gt;&lt;td&gt;æµ‹è¯•é©±åŠ¨å¼€å‘&lt;&#x2F;td&gt;&lt;td&gt;Red-Green-Refactor&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Stub&lt;&#x2F;td&gt;&lt;td&gt;API å ä½å®ç°&lt;&#x2F;td&gt;&lt;td&gt;&lt;code&gt;fn foo() { todo!() }&lt;&#x2F;code&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;h2 id=&quot;jiao-se&quot;&gt;è§’è‰²&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Code Agent&lt;&#x2F;strong&gt;ï¼šè´Ÿè´£å’Œ Developer è¿›è¡Œäº¤äº’ï¼Œç†è§£éœ€æ±‚ã€ç¼–å†™æ–‡æ¡£ã€ä»£ç ã€æµ‹è¯•&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;Developer&lt;&#x2F;strong&gt;ï¼šå¯¹ Code Agent æå‡ºæŒ‡ä»¤ï¼Œå®¡é˜…äº§å‡ºç‰©ï¼Œç¡®è®¤å…³é”®å†³ç­–&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;zhuang-tai-fu-hao-gui-fan&quot;&gt;çŠ¶æ€ç¬¦å·è§„èŒƒ&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;âœ… å®Œæˆ (Completed)&lt;&#x2F;li&gt;
&lt;li&gt;â³ è¿›è¡Œä¸­ (In Progress)&lt;&#x2F;li&gt;
&lt;li&gt;â¸ï¸ å¾…å¼€å§‹ (Pending)&lt;&#x2F;li&gt;
&lt;li&gt;âš ï¸ å—é˜» (Blocked)&lt;&#x2F;li&gt;
&lt;li&gt;ğŸ”„ éœ€é‡åš (Need Rework)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨è§„åˆ™&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ª Phase&#x2F;Task å¿…é¡»æœ‰æ˜ç¡®çš„çŠ¶æ€ç¬¦å·&lt;&#x2F;li&gt;
&lt;li&gt;Code Agent å¿…é¡»åœ¨å®Œæˆåç«‹å³æ›´æ–°çŠ¶æ€&lt;&#x2F;li&gt;
&lt;li&gt;Developer å¯ä»¥å°†ä»»åŠ¡æ ‡è®°ä¸º âš ï¸ æˆ– ğŸ”„&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;0-feature-he-ceng-ji-jie-gou&quot;&gt;0. Feature å’Œå±‚çº§ç»“æ„&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;feature-ding-yi&quot;&gt;Feature å®šä¹‰&lt;&#x2F;h3&gt;
&lt;p&gt;Feature æ˜¯ä¸€ä¸ª&lt;strong&gt;ç‹¬ç«‹çš„åŠŸèƒ½ç‰¹æ€§&lt;&#x2F;strong&gt;ï¼Œå¯ç‹¬ç«‹è§„åˆ’ã€å¼€å‘ã€æµ‹è¯•å’Œäº¤ä»˜ï¼Œå¯¹åº”äº Git Workflow ä¸­ Pull Requestã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Feature ç¤ºä¾‹&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;scheme_v1&lt;&#x2F;code&gt;, &lt;code&gt;scheme_v2&lt;&#x2F;code&gt;, &lt;code&gt;scheme_v3&lt;&#x2F;code&gt;ï¼šä¸åŒçš„å­˜å‚¨æ–¹æ¡ˆ&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;file_writer&lt;&#x2F;code&gt;ï¼šæ–‡ä»¶å†™å…¥æ¨¡å—&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;file_reader&lt;&#x2F;code&gt;ï¼šæ–‡ä»¶è¯»å–æ¨¡å—&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;cli&lt;&#x2F;code&gt;ï¼šå‘½ä»¤è¡Œå·¥å…·&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;lsm_compaction&lt;&#x2F;code&gt;ï¼šLSM åˆå¹¶é€»è¾‘&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;san-ceng-zu-zhi-jie-gou&quot;&gt;ä¸‰å±‚ç»„ç»‡ç»“æ„&lt;&#x2F;h3&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;Feature â†’ Phase â†’ Task
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Feature&lt;&#x2F;strong&gt;ï¼šç‹¬ç«‹åŠŸèƒ½æ¨¡å—ï¼Œæœ‰ç‹¬ç«‹çš„ è®¾è®¡æ–‡æ¡£, task_list.md å’Œæµ‹è¯•æ–‡ä»¶&lt;&#x2F;li&gt;
&lt;li&gt;Feature çš„è®¾è®¡æ–‡æ¡£åœ¨ fpt&#x2F;features&#x2F;{feature}&#x2F;design.md ä¸‹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;Phase&lt;&#x2F;strong&gt;ï¼šFeature å†…çš„å¼€å‘é˜¶æ®µï¼Œç›¸å½“äº1ä¸ªå°çš„è¿­ä»£ï¼Œç¼–å·åœ¨ &lt;strong&gt;Feature å†…ç‹¬ç«‹&lt;&#x2F;strong&gt;ï¼ˆæ¯ä¸ª Feature ä» Phase 1 å¼€å§‹ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;Task&lt;&#x2F;strong&gt;ï¼šå¯åœ¨ 0.5-1 å¤©å®Œæˆçš„æœ€å°å·¥ä½œå•å…ƒ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;å¦‚æœä¸ Git Workflow ç›¸å¯¹æ¯”ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Feature å¯¹åº”äº Pull Requestï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç‰¹æ€§ã€åœºæ™¯ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Phase å¯¹åº”äºä¸€ä¸ª Feature å†…çš„å¤šä¸ª iterationï¼Œæ¯ä¸ª phase å®Œæˆä¸€å®šçš„åŠŸèƒ½ï¼Œå¹¶ä¸ºä¸‹ä¸€ä¸ª phase æä¾›å‡†å¤‡ã€‚éƒ¨ä»½ä»£ç å¯èƒ½å†åç»­çš„ phase æ¸…ç†ã€é‡æ„
å¦‚æœåç»­é‡æ„&#x2F;åˆ é™¤äº†è¿™ä¸ª phase çš„ä»£ç ï¼Œåˆ™ä¹Ÿç›¸åº”çš„é‡æ„&#x2F;åˆ é™¤åŸæœ‰çš„æµ‹è¯•ç”¨ä¾‹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Task åˆ™å¯¹åº”äº phase å†…çš„å­—ä»»åŠ¡æ‹†è§£ï¼Œä¸TDD çš„ test case æœ‰è¾ƒå¥½çš„å¯¹åº”å…³ç³»ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;Feature: file_writer
&lt;&#x2F;span&gt;&lt;span&gt;  Phase 1: API å®šä¹‰
&lt;&#x2F;span&gt;&lt;span&gt;    Task 1: åˆ›å»ºæ ¸å¿ƒæ•°æ®ç»“æ„
&lt;&#x2F;span&gt;&lt;span&gt;    Task 2: å¯¼å‡º API
&lt;&#x2F;span&gt;&lt;span&gt;  Phase 2: Mmap åˆå§‹åŒ–
&lt;&#x2F;span&gt;&lt;span&gt;    Task 1: æ–‡ä»¶é¢„åˆ†é…
&lt;&#x2F;span&gt;&lt;span&gt;    Task 2: Mmap æ˜ å°„
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;Feature: scheme_v2
&lt;&#x2F;span&gt;&lt;span&gt;  Phase 1: Dictionary å®ç°
&lt;&#x2F;span&gt;&lt;span&gt;    Task 1: DimDict API
&lt;&#x2F;span&gt;&lt;span&gt;    Task 2: Encoding é€»è¾‘
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;1-kai-fa-liu-cheng-zong-lan&quot;&gt;1. å¼€å‘æµç¨‹æ€»è§ˆ&lt;&#x2F;h2&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;è§„åˆ’ â†’ æµ‹è¯•è®¾è®¡ â†’ API å®šä¹‰ â†’ æµ‹è¯•è¯„å®¡ â†’ å®ç° â†’ éªŒè¯ â†’ å½’æ¡£
&lt;&#x2F;span&gt;&lt;span&gt;  â†“        â†“          â†“          â†“        â†“      â†“       â†“
&lt;&#x2F;span&gt;&lt;span&gt;Phase   Test Cases  Signatures  Review   Code   Pass   Commit
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;liu-cheng-shuo-ming&quot;&gt;æµç¨‹è¯´æ˜&lt;&#x2F;h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è§„åˆ’&lt;&#x2F;strong&gt;ï¼šå°†åŠŸèƒ½éœ€æ±‚åˆ†è§£ä¸º Featureã€Phase å’Œ Task&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;æµ‹è¯•è®¾è®¡&lt;&#x2F;strong&gt;ï¼šç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œå®šä¹‰é¢„æœŸè¡Œä¸º&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;API å®šä¹‰&lt;&#x2F;strong&gt;ï¼šå®šä¹‰æ•°æ®ç»“æ„å’Œæ¥å£ç­¾åï¼Œä½¿ç”¨ &lt;code&gt;todo!()&lt;&#x2F;code&gt; å ä½&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;æµ‹è¯•è¯„å®¡&lt;&#x2F;strong&gt;ï¼šDeveloper ç¡®è®¤æµ‹è¯•ç”¨ä¾‹ã€API è®¾è®¡æ˜¯å¦ç¬¦åˆéœ€æ±‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°&lt;&#x2F;strong&gt;ï¼šå®ç°åŠŸèƒ½é€»è¾‘ï¼Œä½¿æµ‹è¯•é€šè¿‡&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;éªŒè¯&lt;&#x2F;strong&gt;ï¼šè¿è¡Œæµ‹è¯•ï¼Œç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;å½’æ¡£&lt;&#x2F;strong&gt;ï¼šæ›´æ–° &lt;code&gt;fpt&#x2F;features&#x2F;{feature}&#x2F;task_list.md&lt;&#x2F;code&gt;ï¼Œæäº¤ä»£ç &lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;2-phase-hua-fen&quot;&gt;2. Phase åˆ’åˆ†&lt;&#x2F;h2&gt;
&lt;p&gt;Phase åˆ’åˆ†ç”± Code Agent æ ¹æ® Developer æŒ‡ä»¤è¿›è¡Œï¼Œè§„åˆ’åéœ€ä¸ Developer ç¡®è®¤ã€‚&lt;&#x2F;p&gt;
&lt;h3 id=&quot;phase-gui-fan&quot;&gt;Phase è§„èŒƒ&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;Phase ç¼–å·åœ¨ &lt;strong&gt;Feature å†…ç‹¬ç«‹&lt;&#x2F;strong&gt;ï¼Œæ¯ä¸ª Feature ä» Phase 1 å¼€å§‹&lt;&#x2F;li&gt;
&lt;li&gt;æ¯ä¸ª Phase æœ‰æ¸…æ™°çš„å¼€å‘ç›®æ ‡ï¼Œå¯ä½œä¸ºåç»­ Phase çš„åŸºç¡€ï¼ˆè§†ä¸ºä¸€ä¸ª Iterationï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;åŒ…å« 3-8 ä¸ª Taskï¼Œæ¯ä¸ª Task 0.5-1 å¤©å¯å®Œæˆ&lt;&#x2F;li&gt;
&lt;li&gt;æœ‰æ˜ç¡®çš„éªŒæ”¶æ ‡å‡†å’Œäº§å‡ºç‰©&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;ming-ming-gui-fan&quot;&gt;å‘½åè§„èŒƒ&lt;&#x2F;h3&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;Feature: file_writer
&lt;&#x2F;span&gt;&lt;span&gt;  Phase 1: API å®šä¹‰
&lt;&#x2F;span&gt;&lt;span&gt;  Phase 2: Mmap åˆå§‹åŒ–
&lt;&#x2F;span&gt;&lt;span&gt;  Phase 3: Schema å®šä¹‰
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;Feature: scheme_v2
&lt;&#x2F;span&gt;&lt;span&gt;  Phase 1: Dictionary å®ç°
&lt;&#x2F;span&gt;&lt;span&gt;  Phase 2: Encoding é€»è¾‘
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;phase-0-duan-dao-duan-de-api-she-ji-jie-duan&quot;&gt;phase 0: ç«¯åˆ°ç«¯çš„API è®¾è®¡é˜¶æ®µ&lt;&#x2F;h3&gt;
&lt;p&gt;éƒ¨ä»½å¤æ‚æ€§çš„ä»»åŠ¡éœ€è¦æ’å…¥ phase 0 çš„é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µçš„ç›®çš„æ˜¯ï¼šé‡‡ç”¨ TDD çš„æ–¹å¼ï¼Œé€šè¿‡å®šä¹‰ç«¯åˆ°ç«¯çš„åœºæ™¯ï¼Œæ¥å®šä¹‰ç›¸å…³çš„ API å’Œæ•°æ®ç»“æ„ï¼Œè¯„å®¡é€šè¿‡å
å†å¼€å¯ä¸‹ä¸€é˜¶æ®µçš„çš„å¼€å‘ä»»åŠ¡ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å®šä¹‰ç«¯åˆ°ç«¯çš„APIï¼Œå³æ¨¡å—å¯¹å¤–æä¾›çš„ pub API + structï¼Œè€Œéå†…éƒ¨çš„ã€å®ç°ç»†èŠ‚ç²’åº¦ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç¼–å†™æµ‹è¯•ç”¨ä¾‹æ¥æ¨¡æ‹Ÿä½¿ç”¨åœºæ™¯ï¼Œæ¼”ç¤º API çš„ä½¿ç”¨ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä»…ç¼–å†™æœ€å°åŒ–çš„ä»£ç ï¼ˆtodo!() æ›¿ä»£å®ç°ï¼‰ï¼Œä½¿å…¶é€šè¿‡ç¼–è¯‘ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;ä¸€èˆ¬çš„ï¼Œåœ¨ phase 0 å®Œæˆåï¼Œåº”è¯¥äº¤ç»™ developer æ¥è¿›è¡Œè¯„å®¡ï¼Œè¯„å®¡ç¡®è®¤åï¼Œå†å¼€å§‹å·¥ä½œï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ›´æ–° task_list.md ï¼ˆéœ€è¦æ ¹æ®è¯„å®¡ä¸­çš„å˜åŒ–è€Œè°ƒæ•´è®¡åˆ’ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;3-task-fen-jie-gui-ze&quot;&gt;3. Task åˆ†è§£è§„åˆ™&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;task-gui-fan&quot;&gt;Task è§„èŒƒ&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;å•ä¸ª Task ä¸è¶…è¿‡ 0.5-1 å¤©å·¥ä½œé‡&lt;&#x2F;li&gt;
&lt;li&gt;å¯ç‹¬ç«‹æµ‹è¯•å’ŒéªŒè¯&lt;&#x2F;li&gt;
&lt;li&gt;æœ‰æ˜ç¡®çš„è¾“å…¥å’Œè¾“å‡º&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;ming-ming-gui-fan-1&quot;&gt;å‘½åè§„èŒƒ&lt;&#x2F;h3&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;Feature: file_writer
&lt;&#x2F;span&gt;&lt;span&gt;  Phase 1: API å®šä¹‰
&lt;&#x2F;span&gt;&lt;span&gt;    Task 1: åˆ›å»ºæ ¸å¿ƒæ•°æ®ç»“æ„
&lt;&#x2F;span&gt;&lt;span&gt;    Task 2: å¯¼å‡º API
&lt;&#x2F;span&gt;&lt;span&gt;  Phase 2: Mmap åˆå§‹åŒ–
&lt;&#x2F;span&gt;&lt;span&gt;    Task 1: æ–‡ä»¶é¢„åˆ†é…
&lt;&#x2F;span&gt;&lt;span&gt;    Task 2: Mmap æ˜ å°„
&lt;&#x2F;span&gt;&lt;span&gt;    Task 3: Drop æ¸…ç†é€»è¾‘
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;4-ce-shi-yong-li-gui-fan&quot;&gt;4. æµ‹è¯•ç”¨ä¾‹è§„èŒƒ&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;4-1-ming-ming-gui-fan&quot;&gt;4.1 å‘½åè§„èŒƒ&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;æµ‹è¯•æ–‡ä»¶&lt;&#x2F;strong&gt;: &lt;code&gt;{crate}&#x2F;tests&#x2F;{feature}_phase_{seq}_description.rs&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;crate&lt;&#x2F;code&gt;: æ‰€åœ¨ crateï¼ˆå¦‚ molap_file, lsmï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;feature&lt;&#x2F;code&gt;: Feature åç§°ï¼ˆå¦‚ file_writer, scheme_v2ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;seq&lt;&#x2F;code&gt;: Phase åºå·ï¼ˆåœ¨ Feature å†…ç‹¬ç«‹ç¼–å·ï¼Œ&lt;strong&gt;ä»…1çº§ç¼–å·&lt;&#x2F;strong&gt;ï¼Œå¦‚ 1, 2, 3ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;description&lt;&#x2F;code&gt;: ç®€çŸ­æè¿°&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;strong&gt;æµ‹è¯•å‡½æ•°&lt;&#x2F;strong&gt;: &lt;code&gt;task_{phase}_{task}_description&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;phase&lt;&#x2F;code&gt;: Phase åºå·ï¼ˆ&lt;strong&gt;ä»…1çº§ç¼–å·&lt;&#x2F;strong&gt;ï¼Œå¦‚ 1, 2, 3ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;task&lt;&#x2F;code&gt;: Task åºå·ï¼ˆ&lt;strong&gt;ä»…1çº§ç¼–å·&lt;&#x2F;strong&gt;ï¼Œå¦‚ 1, 2, 3ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;_&lt;&#x2F;code&gt;: ä¸‹åˆ’çº¿åˆ†éš”ç¬¦&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;description&lt;&#x2F;code&gt;: ç®€çŸ­æè¿°&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;&#x2F;strong&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; æ–‡ä»¶å: molap_file&#x2F;tests&#x2F;file_writer&#x2F;phase_2_mmap_init.rs
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;&#x2F; Task 2-1: æ–‡ä»¶é¢„åˆ†é…é€»è¾‘
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;test&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;task_2_1_basic_file_creation&lt;&#x2F;span&gt;&lt;span&gt;() { ... }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;&#x2F; Task 2-3: Drop æ¸…ç†é€»è¾‘
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;test&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;task_2_3_drop_cleanup&lt;&#x2F;span&gt;&lt;span&gt;() { ... }
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; æ–‡ä»¶å: molap_file&#x2F;tests&#x2F;scheme_v2&#x2F;phase_1_dictionary.rs
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;&#x2F; Task 1-1: DimDict API å®šä¹‰
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;test&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;task_1_1_dim_dict_api&lt;&#x2F;span&gt;&lt;span&gt;() { ... }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;&#x2F; Task 1-2: Encoding é€»è¾‘
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;test&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;task_1_2_encoding_logic&lt;&#x2F;span&gt;&lt;span&gt;() { ... }
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;4-2-wen-jian-zu-zhi&quot;&gt;4.2 æ–‡ä»¶ç»„ç»‡&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;æŒ‰ Feature åˆ†ç›®å½•&lt;&#x2F;strong&gt;ï¼šæ¯ä¸ª Feature æœ‰ç‹¬ç«‹çš„æµ‹è¯•å­ç›®å½•&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;molap_file&#x2F;tests&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;â”œâ”€â”€ file_writer&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;â”‚   â”œâ”€â”€ phase_1_v1.rs              # Feature: file_writer, Phase 1
&lt;&#x2F;span&gt;&lt;span&gt;â”‚   â”œâ”€â”€ phase_2_mmap.rs            # Feature: file_writer, Phase 2
&lt;&#x2F;span&gt;&lt;span&gt;â”‚   â””â”€â”€ phase_3_schema.rs          # Feature: file_writer, Phase 3
&lt;&#x2F;span&gt;&lt;span&gt;â”œâ”€â”€ scheme_v1&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;â”‚   â””â”€â”€ phase_1_basic.rs           # Feature: scheme_v1, Phase 1
&lt;&#x2F;span&gt;&lt;span&gt;â””â”€â”€ scheme_v2&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;    â”œâ”€â”€ phase_1_dictionary.rs      # Feature: scheme_v2, Phase 1
&lt;&#x2F;span&gt;&lt;span&gt;    â””â”€â”€ phase_2_encoding.rs        # Feature: scheme_v2, Phase 2
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;lsm&#x2F;tests&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;â”œâ”€â”€ memtable&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;â”‚   â””â”€â”€ phase_1_basic.rs           # Feature: memtable, Phase 1
&lt;&#x2F;span&gt;&lt;span&gt;â””â”€â”€ compaction&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;    â””â”€â”€ phase_1_merge.rs           # Feature: compaction, Phase 1
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;4-2-1-ce-shi-wen-jian-lu-jing-sheng-cheng-gui-ze&quot;&gt;4.2.1 æµ‹è¯•æ–‡ä»¶è·¯å¾„ç”Ÿæˆè§„åˆ™&lt;&#x2F;h3&gt;
&lt;p&gt;Code Agent åˆ›å»ºæµ‹è¯•æ–‡ä»¶æ—¶ï¼Œå¿…é¡»éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¡®å®š crate&lt;&#x2F;strong&gt;ï¼šæ ¹æ®åŠŸèƒ½æ‰€å±çš„ crateï¼ˆå¦‚ molap_fileã€lsmï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;ç¡®å®š feature&lt;&#x2F;strong&gt;ï¼šä» task_list.md çš„æ–‡ä»¶è·¯å¾„ä¸­æå– feature åç§°&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;ç¡®å®š phase&lt;&#x2F;strong&gt;ï¼šä»å½“å‰ Phase æ ‡é¢˜ä¸­æå–åºå·&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿæˆè·¯å¾„&lt;&#x2F;strong&gt;ï¼š&lt;code&gt;{crate}&#x2F;tests&#x2F;{feature}&#x2F;phase_{seq}_{description}.rs&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;task_list è·¯å¾„ï¼š&lt;code&gt;fpt&#x2F;features&#x2F;scheme_v2&#x2F;task_list.md&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;å½“å‰ Phaseï¼š&lt;code&gt;Phase 3: Data Encoding&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;ç”Ÿæˆæµ‹è¯•æ–‡ä»¶ï¼š&lt;code&gt;molap_file&#x2F;tests&#x2F;scheme_v2&#x2F;phase_3_encoding.rs&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;strong&gt;æ–‡ä»¶å†…éƒ¨æŒ‰ Task åˆ†ç»„&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;! Feature: file_writer
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;! Phase 2: æ–‡ä»¶é¢„åˆ†é… + Mmap åˆå§‹åŒ–
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;!
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;! # Tasks
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;! - Task 1: æ–‡ä»¶é¢„åˆ†é…é€»è¾‘
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;! - Task 2: Mmap åˆå§‹åŒ–
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;! - Task 3: Drop æ¸…ç†é€»è¾‘
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;molap_file::{FileWriter, FileConfig};
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;std::fs;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ============================================================================
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; è¾…åŠ©å‡½æ•°
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ============================================================================
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;cleanup_test_file&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;path&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;str&lt;&#x2F;span&gt;&lt;span&gt;) { ... }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ============================================================================
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Task 1: æ–‡ä»¶é¢„åˆ†é…
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ============================================================================
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;&#x2F; Task 2-1: æ–‡ä»¶é¢„åˆ†é…é€»è¾‘
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;test&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;task_2_1_basic_file_creation&lt;&#x2F;span&gt;&lt;span&gt;() { ... }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ============================================================================
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Task 2: Mmap åˆå§‹åŒ–
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ============================================================================
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;&#x2F; Task 2-2: Mmap åˆå§‹åŒ–
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;test&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;task_2_2_mmap_initialization&lt;&#x2F;span&gt;&lt;span&gt;() { ... }
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;4-3-ce-shi-fu-gai&quot;&gt;4.3 æµ‹è¯•è¦†ç›–&lt;&#x2F;h3&gt;
&lt;p&gt;æ¯ä¸ª Phase è‡³å°‘åŒ…å«ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ­£å¸¸æµç¨‹æµ‹è¯•&lt;&#x2F;li&gt;
&lt;li&gt;è¾¹ç•Œæƒ…å†µæµ‹è¯•&lt;&#x2F;li&gt;
&lt;li&gt;é”™è¯¯å¤„ç†æµ‹è¯•&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æ¯ä¸ªæµ‹è¯•å‡½æ•°å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ª Taskï¼Œåœ¨æ–‡æ¡£æ³¨é‡Šä¸­æ˜ç¡®è¯´æ˜è¦†ç›–èŒƒå›´ã€‚&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;5-shi-xian-liu-cheng-tdd-xun-huan&quot;&gt;5. å®ç°æµç¨‹ï¼ˆTDD å¾ªç¯ï¼‰&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;red-green-refactor-yan-ge-zhi-xing-shun-xu&quot;&gt;Red â†’ Green â†’ Refactorï¼ˆä¸¥æ ¼æ‰§è¡Œé¡ºåºï¼‰&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;é‡è¦ï¼šCode Agent å¿…é¡»ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼Œç¦æ­¢è·³è¿‡æˆ–é¢ å€’æ­¥éª¤&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰æµ‹è¯•ï¼ˆRedï¼‰&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å…ˆåœ¨ &lt;code&gt;tests&#x2F;{feature}&#x2F;phase_{seq}_*.rs&lt;&#x2F;code&gt; ä¸­ç¼–å†™æµ‹è¯•å‡½æ•°&lt;&#x2F;li&gt;
&lt;li&gt;æµ‹è¯•å‡½æ•°å‘½åå¿…é¡»éµå¾ª &lt;code&gt;task_{phase}_{task}_description&lt;&#x2F;code&gt; æ ¼å¼&lt;&#x2F;li&gt;
&lt;li&gt;éªŒè¯æµ‹è¯•å¤±è´¥ï¼ˆå› ä¸ºåŠŸèƒ½å°šæœªå®ç°ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰ APIï¼ˆStubï¼‰&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å®šä¹‰æ»¡è¶³æµ‹è¯•çš„æœ€å°æ¥å£ç­¾å&lt;&#x2F;li&gt;
&lt;li&gt;å‡½æ•°ä½“ä½¿ç”¨ &lt;code&gt;todo!()&lt;&#x2F;code&gt; æˆ– &lt;code&gt;unimplemented!()&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;ç¡®ä¿ &lt;code&gt;cargo test --no-run&lt;&#x2F;code&gt; ç¼–è¯‘é€šè¿‡&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æµ‹è¯•è¯„å®¡ç‚¹&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Code Agent å‘ Developer å±•ç¤ºæµ‹è¯•ç”¨ä¾‹&lt;&#x2F;li&gt;
&lt;li&gt;ç­‰å¾… Developer ç¡®è®¤åå†ç»§ç»­å®ç°&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®ç°åŠŸèƒ½ï¼ˆGreenï¼‰&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å®ç°é€»è¾‘ï¼Œä½¿æµ‹è¯•é€šè¿‡&lt;&#x2F;li&gt;
&lt;li&gt;ä¼˜å…ˆæœ€ç®€å•çš„å®ç°ï¼Œä¸è¿‡åº¦è®¾è®¡&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;éªŒè¯æµ‹è¯•é€šè¿‡&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;è¿è¡Œ &lt;code&gt;cargo test task_{phase}_{task}&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;æ‰€æœ‰æµ‹è¯•å¿…é¡»é€šè¿‡ï¼Œæ—  panic æˆ– warnings&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é‡æ„ï¼ˆRefactorï¼‰&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜åŒ–ä»£ç ç»“æ„ï¼Œä¿æŒæµ‹è¯•é€šè¿‡&lt;&#x2F;li&gt;
&lt;li&gt;æ¯æ¬¡é‡æ„åé‡æ–°è¿è¡Œæµ‹è¯•&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h3 id=&quot;code-agent-cao-zuo-jian-cha-qing-dan&quot;&gt;Code Agent æ“ä½œæ£€æŸ¥æ¸…å•&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;åœ¨æ¯ä¸ª Task å¼€å§‹å‰ï¼ŒCode Agent å¿…é¡»&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ç¡®è®¤å·²è¯»å– &lt;code&gt;fpt&#x2F;features&#x2F;{feature}&#x2F;task_list.md&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;ç¡®è®¤å½“å‰ Task çš„ç¼–å·å’Œæè¿°&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;strong&gt;åœ¨æ¯ä¸ª Task å®Œæˆåï¼ŒCode Agent å¿…é¡»&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ›´æ–° &lt;code&gt;fpt&#x2F;features&#x2F;{feature}&#x2F;task_list.md&lt;&#x2F;code&gt; ä¸­çš„çŠ¶æ€&lt;&#x2F;li&gt;
&lt;li&gt;è¿è¡Œ &lt;code&gt;cargo test task_{phase}_{task}&lt;&#x2F;code&gt; éªŒè¯æµ‹è¯•é€šè¿‡&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;6-jin-du-gen-zong-gui-fan&quot;&gt;6. è¿›åº¦è·Ÿè¸ªè§„èŒƒ&lt;&#x2F;h2&gt;
&lt;p&gt;æ¯ä¸ª Feature çš„ Phase å’Œ Task ä¿¡æ¯å†™å…¥åˆ° &lt;code&gt;fpt&#x2F;features&#x2F;{feature}&#x2F;task_list.md&lt;&#x2F;code&gt; æ–‡ä»¶ã€‚&lt;&#x2F;p&gt;
&lt;h3 id=&quot;wen-jian-lu-jing-gui-fan&quot;&gt;æ–‡ä»¶è·¯å¾„è§„èŒƒ&lt;&#x2F;h3&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;fpt&#x2F;features&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;â”œâ”€â”€ file_writer&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;â”‚   â””â”€â”€ design.md             # file_writer feature çš„è®¾è®¡æ–‡æ¡£
&lt;&#x2F;span&gt;&lt;span&gt;â”‚   â””â”€â”€ task_list.md          # file_writer feature çš„ä»»åŠ¡æ¸…å•
&lt;&#x2F;span&gt;&lt;span&gt;â””â”€â”€ cli&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;    â””â”€â”€ task_list.md
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;geng-xin-zhi-ze&quot;&gt;æ›´æ–°èŒè´£&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Code Agent&lt;&#x2F;strong&gt;ï¼šæ¯ä¸ª Task&#x2F;Phase å®Œæˆåè‡ªåŠ¨æ›´æ–°&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;Developer&lt;&#x2F;strong&gt;ï¼šå®¡é˜…å¹¶è°ƒæ•´ä¼˜å…ˆçº§æˆ–è®¡åˆ’&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;wen-jian-ge-shi-shi-li&quot;&gt;æ–‡ä»¶æ ¼å¼ç¤ºä¾‹&lt;&#x2F;h3&gt;
&lt;pre data-lang=&quot;markdown&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-markdown &quot;&gt;&lt;code class=&quot;language-markdown&quot; data-lang=&quot;markdown&quot;&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;# file_writer Task List
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;font-weight:bold;color:#ebcb8b;&quot;&gt;**Git Branch**&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;`feature&#x2F;file_writer`
&lt;&#x2F;span&gt;&lt;span style=&quot;font-weight:bold;color:#ebcb8b;&quot;&gt;**Base Branch**&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;`main`
&lt;&#x2F;span&gt;&lt;span style=&quot;font-weight:bold;color:#ebcb8b;&quot;&gt;**Status**&lt;&#x2F;span&gt;&lt;span&gt;: â³ è¿›è¡Œä¸­
&lt;&#x2F;span&gt;&lt;span style=&quot;font-weight:bold;color:#ebcb8b;&quot;&gt;**Created**&lt;&#x2F;span&gt;&lt;span&gt;: 2025-01-10
&lt;&#x2F;span&gt;&lt;span style=&quot;font-weight:bold;color:#ebcb8b;&quot;&gt;**Last Updated**&lt;&#x2F;span&gt;&lt;span&gt;: 2025-01-15
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;background-color:#4f5b66;color:#c0c5ce;&quot;&gt;---
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;## Phase 1: API å®šä¹‰ + æµ‹è¯•æ¡†æ¶ (âœ… å®Œæˆ)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;- &lt;&#x2F;span&gt;&lt;span style=&quot;font-weight:bold;color:#ebcb8b;&quot;&gt;**çŠ¶æ€**&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;: âœ… å®Œæˆ
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;- &lt;&#x2F;span&gt;&lt;span style=&quot;font-weight:bold;color:#ebcb8b;&quot;&gt;**æ—¶é—´**&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;: 2025-01-XX
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;- &lt;&#x2F;span&gt;&lt;span style=&quot;font-weight:bold;color:#ebcb8b;&quot;&gt;**äº§å‡º**&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;: file_writer.rs, tests&#x2F;file_writer&#x2F;phase_1_v1.rs
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;- &lt;&#x2F;span&gt;&lt;span style=&quot;font-weight:bold;color:#ebcb8b;&quot;&gt;**Commits**&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;`a1b2c3d`&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;`e4f5g6h`
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;- &lt;&#x2F;span&gt;&lt;span style=&quot;font-weight:bold;color:#ebcb8b;&quot;&gt;**éªŒæ”¶æ ‡å‡†**&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;: æ‰€æœ‰ API ç¼–è¯‘é€šè¿‡ï¼Œæµ‹è¯•æ¡†æ¶å°±ç»ª
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span&gt;| Task | æè¿° | çŠ¶æ€ |
&lt;&#x2F;span&gt;&lt;span&gt;|------|------|------|
&lt;&#x2F;span&gt;&lt;span&gt;| 1 | åˆ›å»ºæ ¸å¿ƒæ•°æ®ç»“æ„ | âœ… å®Œæˆ |
&lt;&#x2F;span&gt;&lt;span&gt;| 2 | å¯¼å‡º API | âœ… å®Œæˆ |
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;## Phase 2: æ–‡ä»¶é¢„åˆ†é… + Mmap åˆå§‹åŒ– (â³ è¿›è¡Œä¸­)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;- &lt;&#x2F;span&gt;&lt;span style=&quot;font-weight:bold;color:#ebcb8b;&quot;&gt;**çŠ¶æ€**&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;: â³ è¿›è¡Œä¸­
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;- &lt;&#x2F;span&gt;&lt;span style=&quot;font-weight:bold;color:#ebcb8b;&quot;&gt;**äº§å‡º**&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;: FileWriter::new(), tests&#x2F;file_writer&#x2F;phase_2_mmap.rs
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;- &lt;&#x2F;span&gt;&lt;span style=&quot;font-weight:bold;color:#ebcb8b;&quot;&gt;**éªŒæ”¶æ ‡å‡†**&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;: æ–‡ä»¶é¢„åˆ†é…æ­£ç¡®ï¼ŒMmap åˆå§‹åŒ–æˆåŠŸï¼Œèµ„æºæ­£ç¡®æ¸…ç†
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span&gt;| Task | æè¿° | çŠ¶æ€ |
&lt;&#x2F;span&gt;&lt;span&gt;|------|------|------|
&lt;&#x2F;span&gt;&lt;span&gt;| 1 | æ–‡ä»¶åˆ›å»ºä¸é¢„åˆ†é… | âœ… å®Œæˆ |
&lt;&#x2F;span&gt;&lt;span&gt;| 2 | Mmap åˆå§‹åŒ– | â³ è¿›è¡Œä¸­ |
&lt;&#x2F;span&gt;&lt;span&gt;| 3 | Drop æ¸…ç†é€»è¾‘ | â¸ï¸ å¾…å¼€å§‹ |
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;æ³¨æ„äº‹é¡¹ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ task_list ä¸­ï¼Œä¸è¦å†™å…¥å¤ªå¤šçš„æŠ€æœ¯ç»†èŠ‚ï¼ŒåŒ…æ‹¬æ–¹æ¡ˆæè¿°ã€ä»£ç ç­‰ï¼Œé‡è¦åœ¨äºæè¿°ä»»åŠ¡ç›®æ ‡ï¼Œä»¥ç»´æŒè¯¥æ–‡ä»¶çš„ç®€æ´æ€§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;phase é¢˜ä¸­åŒ…æ‹¬è¯¥ phase çš„å½“å‰çŠ¶æ€ï¼Œæ–¹ä¾¿åœ¨ IDE ä¸­å¿«é€Ÿé€šè¿‡ outline æŸ¥çœ‹è¿›åº¦ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;task table éœ€è¦åŒ…æ‹¬ï¼š Taskã€Description, Status ä¸‰åˆ—ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å®Œæˆ task æˆ– phase åï¼ŒåŠæ—¶æ›´æ–°è¯¥æ–‡æ¡£çš„è¿›åº¦çŠ¶æ€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨æ¯ä¸ª phase ä¸‹ï¼Œæ ¹æ®éœ€è¦ï¼Œå¯ä»¥è¡¥å……ä¸Šç›¸å…³æ–‡æ¡£çš„é“¾æ¥ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;7-yan-shou-biao-zhun&quot;&gt;7. éªŒæ”¶æ ‡å‡†&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;task-wan-cheng-biao-zhun&quot;&gt;Task å®Œæˆæ ‡å‡†&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;âœ… å¯¹åº”æµ‹è¯•é€šè¿‡ï¼ˆ&lt;code&gt;cargo test task_{phase}_{task}&lt;&#x2F;code&gt;ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;âœ… ä»£ç æœ‰æ¸…æ™°æ³¨é‡Š&lt;&#x2F;li&gt;
&lt;li&gt;âœ… æ— æ–°å¢ warningsï¼ˆé™¤åˆç†çš„ &lt;code&gt;unused&lt;&#x2F;code&gt;ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;phase-wan-cheng-biao-zhun&quot;&gt;Phase å®Œæˆæ ‡å‡†&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;âœ… æ‰€æœ‰ Task æµ‹è¯•é€šè¿‡&lt;&#x2F;li&gt;
&lt;li&gt;âœ… æ›´æ–° &lt;code&gt;fpt&#x2F;features&#x2F;{feature}&#x2F;task_list.md&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;âœ… Developer ç¡®è®¤éªŒæ”¶&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;8-gou-tong-mo-shi&quot;&gt;8. æ²Ÿé€šæ¨¡å¼&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;8-1-phase-kai-shi-qian&quot;&gt;8.1 Phase å¼€å§‹å‰&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;Code Agent&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å±•ç¤ºå®Œæ•´çš„ Phase è®¡åˆ’ï¼ˆTask æ¸…å•ã€æ—¶é—´ä¼°ç®—ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;è¯´æ˜æŠ€æœ¯æ–¹æ¡ˆå’Œè®¾è®¡å†³ç­–&lt;&#x2F;li&gt;
&lt;li&gt;ç­‰å¾… Developer ç¡®è®¤åå¼€å§‹å®æ–½&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;&lt;strong&gt;Developer&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å®¡é˜… Phase è®¡åˆ’&lt;&#x2F;li&gt;
&lt;li&gt;æå‡ºè°ƒæ•´å»ºè®®æˆ–ä¼˜åŒ–æ–¹æ¡ˆ&lt;&#x2F;li&gt;
&lt;li&gt;æ˜ç¡®ç¡®è®¤å Code Agent å¼€å§‹å®æ–½&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;8-2-shi-shi-guo-cheng-zhong&quot;&gt;8.2 å®æ–½è¿‡ç¨‹ä¸­&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;Code Agent&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯å®Œæˆä¸€ä¸ª Task å‘ Developer æ±‡æŠ¥è¿›åº¦&lt;&#x2F;li&gt;
&lt;li&gt;é‡åˆ°è®¾è®¡é—®é¢˜åŠæ—¶è¯¢é—® Developer&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;strong&gt;Developer&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;åŠæ—¶å›å¤é—®é¢˜&lt;&#x2F;li&gt;
&lt;li&gt;ç¡®è®¤å…³é”®è®¾è®¡å†³ç­–&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;8-3-phase-wan-cheng-hou&quot;&gt;8.3 Phase å®Œæˆå&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;Code Agent&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;æ€»ç»“å®Œæˆå†…å®¹å’Œæµ‹è¯•ç»“æœ&lt;&#x2F;li&gt;
&lt;li&gt;æ›´æ–° &lt;code&gt;doc&#x2F;tdd&#x2F;{feature}&#x2F;task_list.md&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;è¯´æ˜ä¸‹ä¸€æ­¥è®¡åˆ’&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;&lt;strong&gt;Developer&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;éªŒè¯äº§å‡ºç‰©&lt;&#x2F;li&gt;
&lt;li&gt;ç¡®è®¤æ˜¯å¦è¿›å…¥ä¸‹ä¸€ Phase&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;8-4-wan-zheng-dui-hua-shi-li&quot;&gt;8.4 å®Œæ•´å¯¹è¯ç¤ºä¾‹&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯ï¼šå¼€å§‹ scheme_v2 Phase 1 Task 1&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Code Agent&lt;&#x2F;strong&gt;:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆ‘å°†å¼€å§‹ Feature &lt;code&gt;scheme_v2&lt;&#x2F;code&gt; çš„ Phase 1 Task 1: &quot;DimDict API å®šä¹‰&quot;&lt;&#x2F;p&gt;
&lt;p&gt;æˆ‘çš„è®¡åˆ’æ˜¯ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºæµ‹è¯•æ–‡ä»¶ &lt;code&gt;molap_file&#x2F;tests&#x2F;scheme_v2&#x2F;phase_1_dictionary.rs&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;ç¼–å†™æµ‹è¯•å‡½æ•° &lt;code&gt;task_1_1_dim_dict_api()&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;å®šä¹‰ DimDict çš„æ•°æ®ç»“æ„å’Œæ¥å£ç­¾å&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;todo!()&lt;&#x2F;code&gt; å ä½å®ç°&lt;&#x2F;li&gt;
&lt;li&gt;éªŒè¯ç¼–è¯‘é€šè¿‡&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;æµ‹è¯•ç”¨ä¾‹å°†éªŒè¯ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;DimDict::new() åˆ›å»ºç©ºå­—å…¸&lt;&#x2F;li&gt;
&lt;li&gt;DimDict::insert() æ’å…¥ç»´åº¦å€¼&lt;&#x2F;li&gt;
&lt;li&gt;DimDict::get() æŸ¥è¯¢ç»´åº¦ ID&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æ˜¯å¦å¼€å§‹ï¼Ÿ&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Developer&lt;&#x2F;strong&gt;:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç¡®è®¤ï¼Œå¼€å§‹å§ã€‚è®°å¾— DimDict éœ€è¦æ”¯æŒ Option&lt;String&gt; ç±»å‹ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Code Agent&lt;&#x2F;strong&gt;:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ”¶åˆ°ï¼Œæˆ‘ä¼šåœ¨æµ‹è¯•ä¸­åŒ…å« None å€¼çš„å¤„ç†ã€‚å¼€å§‹å®æ–½...&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;9-yi-chang-chu-li-liu-cheng&quot;&gt;9. å¼‚å¸¸å¤„ç†æµç¨‹&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;9-1-ce-shi-bian-yi-shi-bai&quot;&gt;9.1 æµ‹è¯•ç¼–è¯‘å¤±è´¥&lt;&#x2F;h3&gt;
&lt;p&gt;Code Agent å¿…é¡»ç«‹å³æ£€æŸ¥ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;API ç­¾åæ˜¯å¦ä¸æµ‹è¯•ä»£ç åŒ¹é…&lt;&#x2F;li&gt;
&lt;li&gt;ä¾èµ–å…³ç³»æ˜¯å¦æ­£ç¡®&lt;&#x2F;li&gt;
&lt;li&gt;æ¨¡å—å¯¼å‡ºæ˜¯å¦å®Œæ•´&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;9-2-ce-shi-yun-xing-shi-bai&quot;&gt;9.2 æµ‹è¯•è¿è¡Œå¤±è´¥&lt;&#x2F;h3&gt;
&lt;p&gt;Code Agent å¿…é¡»ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ä»”ç»†é˜…è¯»æµ‹è¯•è¾“å‡ºå’Œæ–­è¨€ä¿¡æ¯&lt;&#x2F;li&gt;
&lt;li&gt;å®šä½å¤±è´¥çš„å…·ä½“æµ‹è¯•å‡½æ•°&lt;&#x2F;li&gt;
&lt;li&gt;ä¿®å¤å®ç°ä»£ç ï¼Œè€Œä¸æ˜¯ä¿®æ”¹æµ‹è¯•ï¼ˆé™¤éæµ‹è¯•æœ¬èº«æœ‰é”™è¯¯ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;å‘ Developer æ±‡æŠ¥æŒç»­å¤±è´¥çš„æµ‹è¯•&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;9-3-ce-shi-tong-guo-dan-luo-ji-you-wen-ti&quot;&gt;9.3 æµ‹è¯•é€šè¿‡ä½†é€»è¾‘æœ‰é—®é¢˜&lt;&#x2F;h3&gt;
&lt;p&gt;å½“ Developer å‘ç°é—®é¢˜æ—¶ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Code Agent å¿…é¡»å…ˆå¢åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹è¦†ç›–è¯¥åœºæ™¯&lt;&#x2F;li&gt;
&lt;li&gt;ç„¶åä¿®å¤å®ç°ä½¿æ–°æµ‹è¯•é€šè¿‡&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;10-git-gong-zuo-liu-ji-cheng&quot;&gt;10. Git å·¥ä½œæµé›†æˆ&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;10-1-fen-zhi-ce-lue-git-worktree&quot;&gt;10.1 åˆ†æ”¯ç­–ç•¥ï¼ˆGit Worktreeï¼‰&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;fen-zhi-ming-ming-gui-fan&quot;&gt;åˆ†æ”¯å‘½åè§„èŒƒ&lt;&#x2F;h4&gt;
&lt;p&gt;æ¯ä¸ª Feature å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„ Git åˆ†æ”¯ï¼š&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;main                           # ä¸»åˆ†æ”¯
&lt;&#x2F;span&gt;&lt;span&gt;â”œâ”€â”€ feature&#x2F;scheme_v2          # Feature åˆ†æ”¯
&lt;&#x2F;span&gt;&lt;span&gt;â”œâ”€â”€ feature&#x2F;file_writer        # Feature åˆ†æ”¯
&lt;&#x2F;span&gt;&lt;span&gt;â””â”€â”€ feature&#x2F;cli                # Feature åˆ†æ”¯
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;è§„åˆ™&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ª Feature å¯¹åº”ä¸€ä¸ª &lt;code&gt;feature&#x2F;{feature_name}&lt;&#x2F;code&gt; åˆ†æ”¯&lt;&#x2F;li&gt;
&lt;li&gt;Feature åˆ†æ”¯ä» &lt;code&gt;main&lt;&#x2F;code&gt; åˆ†æ”¯åˆ›å»º&lt;&#x2F;li&gt;
&lt;li&gt;Phase å’Œ Task çš„ commit éƒ½åœ¨ Feature åˆ†æ”¯ä¸Šè¿›è¡Œ&lt;&#x2F;li&gt;
&lt;li&gt;Feature å®Œæˆåé€šè¿‡ Pull Request åˆå¹¶å› &lt;code&gt;main&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4 id=&quot;git-worktree-bing-xing-kai-fa-tui-jian&quot;&gt;Git Worktree å¹¶è¡Œå¼€å‘ï¼ˆæ¨èï¼‰&lt;&#x2F;h4&gt;
&lt;p&gt;ä½¿ç”¨ Git Worktree å®ç°å¤š Feature çœŸæ­£å¹¶è¡Œå¼€å‘ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ä¸»å·¥ä½œç›®å½•
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;cd&lt;&#x2F;span&gt;&lt;span&gt; &#x2F;path&#x2F;to&#x2F;{project}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ä¸ºæ¯ä¸ª Feature åˆ›å»ºç‹¬ç«‹å·¥ä½œç›®å½•
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; worktree add ..&#x2F;{project}-scheme_v2 feature&#x2F;scheme_v2
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; worktree add ..&#x2F;{project}-file_writer feature&#x2F;file_writer
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# åœ¨ä¸åŒç»ˆç«¯&#x2F;çª—å£ä¸­å¹¶è¡Œå¼€å‘
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;cd&lt;&#x2F;span&gt;&lt;span&gt; ..&#x2F;{project}-scheme_v2      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Terminal 1
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;cd&lt;&#x2F;span&gt;&lt;span&gt; ..&#x2F;{project}-file_writer    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Terminal 2
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ª Feature æœ‰ç‹¬ç«‹çš„å·¥ä½œç›®å½•å’Œç¼–è¯‘çŠ¶æ€&lt;&#x2F;li&gt;
&lt;li&gt;æ— éœ€é¢‘ç¹åˆ‡æ¢åˆ†æ”¯&lt;&#x2F;li&gt;
&lt;li&gt;å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªæµ‹è¯•å¥—ä»¶&lt;&#x2F;li&gt;
&lt;li&gt;é¿å…åˆ†æ”¯åˆ‡æ¢å¯¼è‡´çš„æ–‡ä»¶å˜åŠ¨å’Œé‡æ–°ç¼–è¯‘&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;strong&gt;æ¸…ç† Worktree&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Feature åˆå¹¶ååˆ é™¤ worktree
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; worktree remove ..&#x2F;{project}-scheme_v2
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;10-2-commit-gui-fan&quot;&gt;10.2 Commit è§„èŒƒ&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;task-wan-cheng-shi&quot;&gt;Task å®Œæˆæ—¶&lt;&#x2F;h4&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; add .
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; commit&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -m &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;task: Phase {phase} Task {task} - {description}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; commit&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -m &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;task: Phase 1 Task 2 - DimDict encoding logic&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; commit&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -m &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;task: Phase 2 Task 1 - File preallocation&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;è¯´æ˜&lt;&#x2F;strong&gt;ï¼šFeature åç§°å·²åŒ…å«åœ¨åˆ†æ”¯åä¸­ï¼Œæ— éœ€åœ¨ commit message ä¸­é‡å¤ã€‚&lt;&#x2F;p&gt;
&lt;h4 id=&quot;phase-wan-cheng-shi&quot;&gt;Phase å®Œæˆæ—¶&lt;&#x2F;h4&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; add fpt&#x2F;features&#x2F;{feature}&#x2F;task_list.md
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; commit&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -m &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;phase: Phase {phase} complete - {summary}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; commit&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -m &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;phase: Phase 1 complete - Dictionary implementation&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h4 id=&quot;feature-wan-cheng-shi&quot;&gt;Feature å®Œæˆæ—¶&lt;&#x2F;h4&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; add .
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; commit&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -m &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;feature: {feature} complete&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; push origin feature&#x2F;{feature}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;10-3-wan-zheng-gong-zuo-liu-cheng-shi-li&quot;&gt;10.3 å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹&lt;&#x2F;h3&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ========================================
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Developer å¯åŠ¨æ–° Feature
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ========================================
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;cd&lt;&#x2F;span&gt;&lt;span&gt; &#x2F;path&#x2F;to&#x2F;{project}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; checkout main
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; pull
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; checkout&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -b&lt;&#x2F;span&gt;&lt;span&gt; feature&#x2F;scheme_v2
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# åˆ›å»ºç‹¬ç«‹å·¥ä½œç›®å½•ï¼ˆä½¿ç”¨ worktreeï¼‰
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; worktree add ..&#x2F;{project}-scheme_v2 feature&#x2F;scheme_v2
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;cd&lt;&#x2F;span&gt;&lt;span&gt; ..&#x2F;{project}-scheme_v2
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# åˆ›å»º Feature æ–‡æ¡£
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;mkdir -p&lt;&#x2F;span&gt;&lt;span&gt; fpt&#x2F;features&#x2F;scheme_v2
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ç¼–å†™ design.md å’Œ task_list.md
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; add fpt&#x2F;features&#x2F;scheme_v2&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; commit&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -m &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;docs: Initialize scheme_v2 feature&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ========================================
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Code Agent å¼€å§‹ Phase 1
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ========================================
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Task 1: DimDict API å®šä¹‰
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ... ç¼–å†™æµ‹è¯•ã€å®ç° ...
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; add .
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; commit&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -m &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;task: Phase 1 Task 1 - DimDict API definition&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Task 2: Encoding é€»è¾‘
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ... ç¼–å†™æµ‹è¯•ã€å®ç° ...
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; add .
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; commit&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -m &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;task: Phase 1 Task 2 - Encoding logic&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Phase 1 å®Œæˆ
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; add fpt&#x2F;features&#x2F;scheme_v2&#x2F;task_list.md
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; commit&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -m &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;phase: Phase 1 complete - Dictionary implementation&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ========================================
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Phase 2, Phase 3 ...
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ========================================
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ... é‡å¤ä¸Šè¿°æµç¨‹ ...
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ========================================
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Feature å®Œæˆ
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ========================================
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# æ‰€æœ‰æµ‹è¯•é€šè¿‡
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cargo&lt;&#x2F;span&gt;&lt;span&gt; test&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; --all
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# æœ€ç»ˆæ›´æ–°
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; add .
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; commit&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -m &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;feature: scheme_v2 complete&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# æ¨é€å¹¶åˆ›å»º PR
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; push origin feature&#x2F;scheme_v2
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;gh&lt;&#x2F;span&gt;&lt;span&gt; pr create&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; --title &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Feature: scheme_v2 - New storage scheme&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; --base&lt;&#x2F;span&gt;&lt;span&gt; main
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ========================================
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Code Review &amp;amp; Merge
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ========================================
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Developer å®¡æŸ¥ PR
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# åˆå¹¶åˆ° main
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# æ¸…ç† worktree
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;cd&lt;&#x2F;span&gt;&lt;span&gt; &#x2F;path&#x2F;to&#x2F;{project}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; worktree remove ..&#x2F;{project}-scheme_v2
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; branch&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -d&lt;&#x2F;span&gt;&lt;span&gt; feature&#x2F;scheme_v2
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;10-4-code-agent-jian-cha-qing-dan-git-xiang-guan&quot;&gt;10.4 Code Agent æ£€æŸ¥æ¸…å•ï¼ˆGit ç›¸å…³ï¼‰&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;zai-mei-ge-feature-kai-shi-qian&quot;&gt;åœ¨æ¯ä¸ª Feature å¼€å§‹å‰&lt;&#x2F;h4&gt;
&lt;ul&gt;
&lt;li&gt;âœ… ç¡®è®¤å½“å‰åœ¨æ­£ç¡®çš„ Feature åˆ†æ”¯ï¼ˆ&lt;code&gt;git branch --show-current&lt;&#x2F;code&gt;ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;âœ… å¦‚æœä½¿ç”¨ worktreeï¼Œç¡®è®¤åœ¨æ­£ç¡®çš„å·¥ä½œç›®å½•&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4 id=&quot;zai-mei-ge-task-wan-cheng-hou&quot;&gt;åœ¨æ¯ä¸ª Task å®Œæˆå&lt;&#x2F;h4&gt;
&lt;ul&gt;
&lt;li&gt;âœ… ä½¿ç”¨è§„èŒƒçš„ commit messageï¼ˆ&lt;code&gt;task: Phase X Task Y - description&lt;&#x2F;code&gt;ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;âœ… Commit å˜æ›´åˆ°å½“å‰ Feature åˆ†æ”¯&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4 id=&quot;zai-mei-ge-phase-wan-cheng-hou&quot;&gt;åœ¨æ¯ä¸ª Phase å®Œæˆå&lt;&#x2F;h4&gt;
&lt;ul&gt;
&lt;li&gt;âœ… æ›´æ–° &lt;code&gt;task_list.md&lt;&#x2F;code&gt;ï¼ˆæ ‡è®° Phase âœ…ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;âœ… åˆ›å»º Phase æ€»ç»“ commitï¼ˆ&lt;code&gt;phase: Phase X complete - summary&lt;&#x2F;code&gt;ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4 id=&quot;zai-feature-wan-cheng-hou&quot;&gt;åœ¨ Feature å®Œæˆå&lt;&#x2F;h4&gt;
&lt;ul&gt;
&lt;li&gt;âœ… æ‰€æœ‰ Phase æµ‹è¯•é€šè¿‡&lt;&#x2F;li&gt;
&lt;li&gt;âœ… æ›´æ–° &lt;code&gt;task_list.md&lt;&#x2F;code&gt;ï¼ˆæ ‡è®° Feature âœ…ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;âœ… æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯ï¼ˆ&lt;code&gt;git push origin feature&#x2F;{name}&lt;&#x2F;code&gt;ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;âœ… åˆ›å»º Pull Request&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;10-5-pull-request-gui-fan&quot;&gt;10.5 Pull Request è§„èŒƒ&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;pr-biao-ti-ge-shi&quot;&gt;PR æ ‡é¢˜æ ¼å¼&lt;&#x2F;h4&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;Feature: {feature_name} - {one-line summary}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h4 id=&quot;pr-miao-shu-mo-ban&quot;&gt;PR æè¿°æ¨¡æ¿&lt;&#x2F;h4&gt;
&lt;pre data-lang=&quot;markdown&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-markdown &quot;&gt;&lt;code class=&quot;language-markdown&quot; data-lang=&quot;markdown&quot;&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;## Feature æ¦‚è¿°
&lt;&#x2F;span&gt;&lt;span&gt;{ç®€çŸ­æè¿°åŠŸèƒ½}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;## Phase æ¸…å•
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;- [x] Phase 1: Dictionary å®ç°
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;- [x] Phase 2: Encoding é€»è¾‘
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;- [x] Phase 3: Integration æµ‹è¯•
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;## æµ‹è¯•ç»“æœ
&lt;&#x2F;span&gt;&lt;span&gt;```&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;bash
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cargo&lt;&#x2F;span&gt;&lt;span&gt; test&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; --all
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# æ‰€æœ‰æµ‹è¯•é€šè¿‡
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;xiang-guan-wen-dang&quot;&gt;ç›¸å…³æ–‡æ¡£&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;è®¾è®¡æ–‡æ¡£: &lt;code&gt;fpt&#x2F;features&#x2F;scheme_v2&#x2F;design.md&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;ä»»åŠ¡æ¸…å•: &lt;code&gt;fpt&#x2F;features&#x2F;scheme_v2&#x2F;task_list.md&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;checklist&quot;&gt;Checklist&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot; checked=&quot;&quot;&#x2F;&gt;
æ‰€æœ‰ Phase æµ‹è¯•é€šè¿‡&lt;&#x2F;li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot; checked=&quot;&quot;&#x2F;&gt;
æ›´æ–° task_list.md&lt;&#x2F;li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot; checked=&quot;&quot;&#x2F;&gt;
æ— æ–°å¢ warnings&lt;&#x2F;li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot; checked=&quot;&quot;&#x2F;&gt;
ä»£ç å®¡æŸ¥é€šè¿‡&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;### 10.6 å¤š Feature å†²çªå¤„ç†
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#### ç­–ç•¥ï¼šå®šæœŸåŒæ­¥ main çš„å˜æ›´
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;```bash
&lt;&#x2F;span&gt;&lt;span&gt;# åœ¨ Feature åˆ†æ”¯ï¼ˆæ¯å®Œæˆä¸€ä¸ª Phase åï¼‰
&lt;&#x2F;span&gt;&lt;span&gt;git fetch origin main
&lt;&#x2F;span&gt;&lt;span&gt;git rebase origin&#x2F;main
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;# è§£å†³å†²çªï¼ˆå¦‚æœ‰ï¼‰
&lt;&#x2F;span&gt;&lt;span&gt;# ...
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;git rebase --continue
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;å»ºè®®&lt;&#x2F;strong&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜å…ˆä½¿ç”¨ Rebase ä¿æŒçº¿æ€§å†å²&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ Phase å®ŒæˆååŒæ­¥ main çš„å˜æ›´&lt;&#x2F;li&gt;
&lt;li&gt;Code Agent åœ¨ Phase å¼€å§‹å‰æ£€æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;11-chang-jian-wen-ti-pai-cha&quot;&gt;11. å¸¸è§é—®é¢˜æ’æŸ¥&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;q-ce-shi-wen-jian-zhao-bu-dao-bei-ce-shi-de-mo-kuai&quot;&gt;Q: æµ‹è¯•æ–‡ä»¶æ‰¾ä¸åˆ°è¢«æµ‹è¯•çš„æ¨¡å—&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;A&lt;&#x2F;strong&gt;: æ£€æŸ¥ &lt;code&gt;Cargo.toml&lt;&#x2F;code&gt; ä¸­çš„ &lt;code&gt;[lib]&lt;&#x2F;code&gt; é…ç½®ï¼Œç¡®ä¿æ¨¡å—å·²å¯¼å‡º&lt;&#x2F;p&gt;
&lt;h3 id=&quot;q-phase-bian-hao-chong-tu&quot;&gt;Q: Phase ç¼–å·å†²çª&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;A&lt;&#x2F;strong&gt;: Phase ç¼–å·åœ¨ Feature å†…ç‹¬ç«‹ï¼Œä¸åŒ Feature å¯ä»¥æœ‰ç›¸åŒçš„ Phase ç¼–å·&lt;&#x2F;p&gt;
&lt;h3 id=&quot;q-ce-shi-han-shu-ming-ming-bu-fu-he-gui-fan&quot;&gt;Q: æµ‹è¯•å‡½æ•°å‘½åä¸ç¬¦åˆè§„èŒƒ&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;A&lt;&#x2F;strong&gt;: å¿…é¡»ä½¿ç”¨ &lt;code&gt;task_{phase}_{task}_description&lt;&#x2F;code&gt; æ ¼å¼ï¼Œphase å’Œ task éƒ½æ˜¯å•å±‚ç¼–å·&lt;&#x2F;p&gt;
&lt;h3 id=&quot;q-cargo-test-zhao-bu-dao-te-ding-ce-shi&quot;&gt;Q: &lt;code&gt;cargo test&lt;&#x2F;code&gt; æ‰¾ä¸åˆ°ç‰¹å®šæµ‹è¯•&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;A&lt;&#x2F;strong&gt;: ä½¿ç”¨å®Œæ•´çš„æµ‹è¯•åè¿‡æ»¤ï¼Œå¦‚ &lt;code&gt;cargo test task_2_1&lt;&#x2F;code&gt; æˆ– &lt;code&gt;cargo test --test phase_2_mmap&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;h3 id=&quot;q-ce-shi-tong-guo-dan-code-agent-wei-geng-xin-task-list-md&quot;&gt;Q: æµ‹è¯•é€šè¿‡ä½† Code Agent æœªæ›´æ–° task_list.md&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;A&lt;&#x2F;strong&gt;: è¿™è¿åäº†æ“ä½œæ£€æŸ¥æ¸…å•ï¼ŒCode Agent å¿…é¡»åœ¨æ¯ä¸ª Task å®Œæˆåç«‹å³æ›´æ–°çŠ¶æ€&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Oct 2025</title>
        <published>2025-10-13T00:00:00+00:00</published>
        <updated>2025-10-13T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2025-10/"/>
        <id>https://wangzaixiang.github.io/monthly/2025-10/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2025-10/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Rust&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@syntaxSavage&#x2F;generic-associated-types-gats-the-rust-feature-that-finally-solves-async-trait-hell-b9b79d14a422&quot;&gt;Generic Asoociated Types&lt;&#x2F;a&gt;
å¦‚ä½•ç†è§£ async traits åŠæ›´ä¸ºåŸºç¡€çš„ GATï¼Ÿ&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@syntaxSavage&#x2F;rusts-new-borrow-checker-polonius-is-coming-a890fc5ffd8b&quot;&gt;Polonius: Rust&#x27;s new borrow checking&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;Pros: more precise, fewer false errors, ability to accept more safe code, groundwork for self-borrows.&lt;&#x2F;li&gt;
&lt;li&gt;Cons: more complex analysis, potentially more memory and CPU overhead, risk of regressions for big codebases&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rust-lang.github.io&#x2F;polonius&#x2F;&quot;&gt;Polonius Book&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@the_atomic_architect&#x2F;we-deleted-tokio-from-our-payment-system-and-cut-cloud-costs-by-127-000-b745a86f973b&quot;&gt;We Deleted Tokio From Our Payment System and Cut Cloud Costs by $127,000&lt;&#x2F;a&gt;
Medium ä¸Šçš„æ ‡é¢˜å…šä¹Ÿæ˜¯è¶Šæ¥è¶Šå¤šäº†ï¼Œè¿™ç¯‡æ–‡ç« å°è¯•å¾—å‡ºäº†ä¸€ä¸ªä¸ç®—å¤ªé”™è¯¯çš„ç»“è®ºï¼Œä½†å´åšå‡ºäº†å®Œå…¨é”™è¯¯çš„å½’å› ã€‚
&lt;ul&gt;
&lt;li&gt;è¿™ä¸ªä¸šåŠ¡åœºæ™¯æŠ€æœ¯è¦æ±‚å…¶å®å¾ˆä½ï¼ŒQPS &amp;lt; 1000ï¼Œæ ¹æœ¬ç”¨ä¸ä¸Šä»€ä¹ˆé«˜å¤§ä¸Šçš„æŠ€æœ¯ï¼Œä½¿ç”¨ Thread å®Œå…¨æ˜¯æ»¡è¶³è¦æ±‚çš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½†å°†æˆæœ¬åŸå› å½’ç»“äº async å´æ˜¯å¤´ç—›å¼€é”™äº†è¯æ–¹ï¼Œè™½ç„¶æ€é¸¡ç”¨äº†ç‰›åˆ€ï¼Œä½†æ€ä¸æ­»é¸¡å¹¶ä¸æ˜¯ç‰›åˆ€çš„é—®é¢˜ï¼Œè€Œæ˜¯ä½œè€…åœ¨ async æ¡†æ¶ä¸­ä½¿ç”¨äº† sync çš„ postgres åº“ï¼Œè€Œåˆåªé…ç½®äº†è¾ƒå°çš„çº¿ç¨‹ï¼Œ
å¯¼è‡´å¤§éƒ¨ä»½çº¿ç¨‹å®é™…ä¸Šå¤„åœ¨ Blocking çŠ¶æ€ï¼Œå¯¼è‡´ RTT å¤§å¹…æå‡ã€‚
è¿™ç§é”™è¯¯çš„å½’å› ï¼Œå…¶å±å®³ä¸äºšäºé€‰æ‹©ç¬¨é‡çš„æ¡†æ¶ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@theopinionatedev&#x2F;why-const-evaluation-ctfe-is-the-next-big-compiler-war-473fd8d6a8e5&quot;&gt;Rust Compiler Time Function Evaluation&lt;&#x2F;a&gt;
ä»‹ç»äº† CTFE çš„åŸç†ï¼Œä»¥åŠå’Œ C++&#x2F;Zig&#x2F;D è¯­è¨€çš„å¯¹æ¯”ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@the_atomic_architect&#x2F;rust-gpui-ends-cross-platform-compromise-5d0ee9924517&quot;&gt;GUII Just Ended Cross-Platform Comproise&lt;&#x2F;a&gt;
Zed é¡¹ç›®ä¸­çš„ GUI æ¡†æ¶ï¼Œç›®å‰è¿˜å¤„åœ¨å¼€å‘é˜¶æ®µï¼Œåªæ”¯æŒ MacOSã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;fory.apache.org&#x2F;blog&#x2F;fory_rust_versatile_serialization_framework&#x2F;&quot;&gt;Fory: åˆä¸€ä¸ªåºåˆ—åŒ–æ¡†æ¶&lt;&#x2F;a&gt;
ä¸ Rust ç»“åˆç²¾å¯†ï¼Œä½†æ”¯æŒ Java&#x2F;Python&#x2F;C++&#x2F;Go ç­‰è¯­è¨€ã€‚
&lt;ul&gt;
&lt;li&gt;schema less&lt;&#x2F;li&gt;
&lt;li&gt;no code generation ï¼ˆusing Rust Macroï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;no version mismatches
æˆ‘æœ€å¥½å¥‡çš„æ˜¯ï¼Œå®ƒå±…ç„¶ TPS æ¯” protobuf é«˜ï¼ˆä½†å¯¹æ¯”æ•°æ®ä¸­ protobuf åˆå’Œ JSON ç›¸å·®ä¸å¤§ï¼‰ï¼Ÿè¿™ä¸ªæœ‰ç–‘ç‚¹ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;qouteall.fun&#x2F;qouteall-blog&#x2F;2025&#x2F;How%20to%20Avoid%20Fighting%20Rust%20Borrow%20Checker&quot;&gt;How to avoid fighting Rust&#x27;s borrow checker&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Zig&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Zig 0.15.2 Released æ®è¯´åˆæ˜¯ä¸€ä¸ªç ´åæ€§çš„ç‰ˆæœ¬ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;Mpp &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;DataFusion æœ‰ä¸€æ®µæ—¶é—´æ²¡æœ‰è·Ÿè¿› DataFusion çš„æ–°ç‰¹æ€§äº†ã€‚
&lt;ul&gt;
&lt;li&gt;48.0.0
&lt;ul&gt;
&lt;li&gt;performance: fewer unnecessary projections&lt;&#x2F;li&gt;
&lt;li&gt;performance: Accelerated string functions(ascii, character_length)&lt;&#x2F;li&gt;
&lt;li&gt;performance: Constant aggregate window expressions&lt;&#x2F;li&gt;
&lt;li&gt;grammar: order by all&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;49.0.0
&lt;ul&gt;
&lt;li&gt;performance: dynamic filters and topK pushdown&lt;&#x2F;li&gt;
&lt;li&gt;async UDF&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;50.0.0
&lt;ul&gt;
&lt;li&gt;performance: dynamic filter pushdown improvements(for hash joins)&lt;&#x2F;li&gt;
&lt;li&gt;performance: nested loop join optimization&lt;&#x2F;li&gt;
&lt;li&gt;parquet metadata caching&lt;&#x2F;li&gt;
&lt;li&gt;grammar: support qualify stmt&lt;&#x2F;li&gt;
&lt;li&gt;grammar: filter support for window functions&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;web-frontend&quot;&gt;Web &amp;amp; Frontend&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.ripplejs.com&quot;&gt;RippleJs&lt;&#x2F;a&gt; ä¸€ä¸ªè¯•å›¾ç»“åˆ React, Solid, Svelte çš„æ–°ç»„ä»¶æ¡†æ¶ï¼Œä½¿ç”¨äº†è‡ªå®šä¹‰çš„è¯­è¨€ï¼ˆç±»ä¼¼ JSXï¼‰ã€‚
&lt;blockquote&gt;
&lt;p&gt;å¯¹æˆ‘æ¥è¯´ï¼Œæˆ‘è¿˜æ˜¯å€¾å‘äºä¸åˆ›é€ ä¸€é—¨è¯­è¨€ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;ai-agent&quot;&gt;AI &amp;amp; Agent&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;ai.gopubby.com&#x2F;graphflow-rust-native-orchestration-for-multi-agent-workflows-6143a9b767ad&quot;&gt;graphflow: multi agent flow&lt;&#x2F;a&gt;
æ­£å¥½æœ€è¿‘æˆ‘ä»¬ä¹Ÿè®¾è®¡äº†ä¸€ä¸ªåŸºäº flow çš„å¤š agent æ¡†æ¶ï¼Œå†çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼Œæ„Ÿè§‰è¿™ä¸ªè®¾è®¡è¿˜æ˜¯å¤ªç²—ç³™äº†äº›ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.0xshadow.dev&#x2F;posts&#x2F;coding-agent-in-rust&#x2F;coding-agent-in-rust-introduction&#x2F;&quot;&gt;Build a Coding Agent in Rust&lt;&#x2F;a&gt;
ä¸€ä¸ªä¸ claude code CLI  ç›¸ä¼¼çš„å®ç°&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;misc&quot;&gt;Misc&lt;&#x2F;h1&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Sep 2025</title>
        <published>2025-09-04T00:00:00+00:00</published>
        <updated>2025-09-04T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2025-09/"/>
        <id>https://wangzaixiang.github.io/monthly/2025-09/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2025-09/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;Mpp &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;web-frontend&quot;&gt;Web &amp;amp; Frontend&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@orami98&#x2F;12-revolutionary-web-apis-that-will-replace-your-javascript-libraries-in-2026-bf95b64ce1e3&quot;&gt;12 Revolutionary Web APIs That Will Replace Your JavaScript Libraries in 2026&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;Declarative Shadow DOM: Component isolation without frameworks.&lt;&#x2F;li&gt;
&lt;li&gt;View Transition API(document.startViewTransition) without JS Frameworks.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;ai-agent&quot;&gt;AI &amp;amp; Agent&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;task weaver
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;taskweaver&#x2F;&quot;&gt;github&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;export.arxiv.org&#x2F;abs&#x2F;2311.17541&quot;&gt;TaskWeaver: A Code-First Agent Framework&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;misc&quot;&gt;Misc&lt;&#x2F;h1&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>AIæ—¶ä»£çš„è½¯ä»¶ç ”å‘æ€è€ƒ</title>
        <published>2025-08-30T00:00:00+00:00</published>
        <updated>2025-08-30T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/vibe-coding/"/>
        <id>https://wangzaixiang.github.io/blog/vibe-coding/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/vibe-coding/">&lt;h1 id=&quot;bei-jing&quot;&gt;èƒŒæ™¯&lt;&#x2F;h1&gt;
&lt;p&gt;æœ€è¿‘çš„è¿™äº›å¹´ï¼ŒAIæ˜¾ç„¶æ˜¯å¤„åœ¨ä¸€ä¸ªåŠ é€Ÿå‘å±•å’Œåº”ç”¨çš„é˜¶æ®µï¼Œè®°å¾— chatgpt åœ¨2022å¹´åº•æ¨å‡ºä¹‹æ—¶ï¼Œæˆ‘èº«è¾¹çš„ä¸€äº›æœ‹å‹ï¼ˆèµ„æ·±çº§ï¼‰å°±å‘å‡ºäº†â€œç¨‹åºå‘˜å°†è¢«AIæ›¿ä»£â€œçš„
å“€åšã€‚2024å¹´åº• deepseek R1 æ¨ªç©ºå‡ºä¸–ï¼Œä¸­å›½ç½‘æ°‘ä¹Ÿä¸€å¤œä»å¤§æ¨¡å‹çš„è’æ¼ ï¼ˆä¹‹å‰ä½¿ç”¨ chatgpt æœ‰è¯¸å¤šä¸ä¾¿ï¼‰è·ƒå‡ä¸ºå¤§æ¨¡å‹ä½¿ç”¨è‡ªç”±ï¼Œå…¶æ¨ç†èƒ½åŠ›ã€ç¼–ç èƒ½åŠ›åˆ
æœ‰äº†å¾ˆå¤§çš„æå‡ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æˆ‘ä»2023å¹´å¼€å§‹ä½“éªŒäº†github copilotè¿™æ¬¾ç¼–ç¨‹åŠ©ç†å·¥å…·ï¼Œå½“æ—¶å°±æœ‰ä¸€ç§æƒŠè‰³ä¹‹æ„Ÿï¼šç¡®å®ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘åªéœ€è¦ç¼–å†™ä¸€ä¸‹ commentï¼Œcopilot
å°±å¯ä»¥å¸®æˆ‘å®Œæˆ
æ¥ä¸‹æ¥çš„ç¼–ç å·¥ä½œï¼Œå°¤å…¶æ˜¯åœ¨å°è¯•ä¸€äº›æ–°çš„ç¼–ç¨‹è¯­è¨€ï¼Œæˆ–è€…ä½¿ç”¨ä¸€äº›æ–°çš„library, frameworkæ—¶ï¼Œå¤§å¹…çš„ç¼©çŸ­äº†é—å¿˜çš„æŸ¥æ‰¾èµ„æ–™ï¼Œç¼–å†™ä»£ç ï¼Œè°ƒè¯•çš„å¼€å‘è¿‡ç¨‹ï¼Œ
ç¼–ç æ•ˆç‡åº”è¯¥è¯´æ˜¯åˆå¾ˆå¤§æå‡çš„ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;2024å¹´ï¼Œåˆå¼€å§‹ä½¿ç”¨ cursor ideï¼Œç›¸æ¯”copilot, cursoråœ¨æ™ºèƒ½åŒ–ä¸Šæ›´è¿›ä¸€æ­¥ï¼Œå¾ˆå¤šæ—¶å€™è¿æ³¨é‡Šéƒ½çœæ‰äº†ï¼Œsmart tab åœ¨è¯¸å¤šæ—¶å€™ï¼Œéƒ½æƒ³ä½ æ‰€æƒ³ï¼Œå†ç»“åˆ
å¯¹è¯å¼äº¤äº’ï¼Œåœ¨ç¼–ç¨‹ä½“éªŒä¸Šå†æ¬¡å¤§å¹…æå‡ã€‚ä¸ Copilot ç›¸æ¯”çš„è¯ï¼ŒGithub Copilot åªèƒ½ç®—å†·å…µå™¨æ—¶ä»£ï¼Œè€Œ cursor åˆ™è¿›å…¥åˆ°çƒ­å…µå™¨æ—¶ä»£ï¼Œå¼€å§‹æœ‰è‡ªåŠ¨åŒ–ã€æœºæ¢°åŒ–çš„
æ„Ÿè§‰äº†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æœ€è¿‘ï¼ŒClaude Code å†æ¬¡ç«çˆ†å‡ºåœˆï¼Œæˆ‘ä¹Ÿèµ¶ä¸Šå»è¹­äº†ä¸ªçƒ­åº¦ï¼Œåœ¨è¿‡å»çš„1å‘¨æ—¶é—´ï¼Œåˆ©ç”¨é›¶æ˜Ÿçš„æ—¶é—´ï¼Œåˆ©ç”¨ CC
åšäº†ä¸€äº›å°è¯•ã€‚&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;compare-lang-performance&quot;&gt;compare-lang-performance&lt;&#x2F;a&gt;
å°±æ˜¯å…¶ä¸­çš„ä¸€ä¸ªå®éªŒé¡¹ç›®ï¼Œé€šè¿‡å’ŒCCè¿›è¡Œå¯¹è¯å¼äº¤äº’ï¼Œæœ€ç»ˆäº§å‡ºäº†è¿™ä¸ªæ€§èƒ½å¯¹æ¯”çš„æµ‹è¯•å·¥å…·ã€‚ä½œä¸ºä½“éªŒCCçš„ä¸€æ¬¡å®éªŒï¼Œæˆ‘çš„åŸºæœ¬å·¥ä½œæµç¨‹åŒ…æ‹¬ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€æ±‚å®šä¹‰æµç¨‹ï¼šå‘ CC è¯´æ˜é¡¹ç›®çš„åŸºæœ¬ç›®æ ‡ï¼Œè¯· CC è¿›è¡Œè¯¦ç»†çš„éœ€æ±‚è§„æ ¼æè¿°ï¼Œå¦‚æœä½ å¯¹è¿™ä¸ª spec ä¸æ»¡æ„ï¼Œå¯ä»¥é€šè¿‡å¤šæ¬¡å¯¹è¯äº¤äº’è¿›è¡Œä¿®æ­£ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç¼–ç æµç¨‹ï¼š è®© CC ç¼–å†™ä»£ç ï¼Œè¿è¡Œæµ‹è¯•è¿›è¡ŒéªŒè¯ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åå¤è¿­ä»£ï¼š
&lt;ul&gt;
&lt;li&gt;å¢åŠ æ–°çš„åŠŸèƒ½ï¼šä¾‹å¦‚ï¼Œå¢åŠ æ–°çš„æµ‹è¯•è¯­è¨€ã€æ–°çš„æµ‹è¯•ä»£ç &lt;&#x2F;li&gt;
&lt;li&gt;é‡æ„è®¾è®¡ï¼šä¾‹å¦‚å°†é…ç½®ä¿¡æ¯ä»ä»£ç ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œä» json åˆ° toml åˆ° yamlï¼Œä»¥åŠå¤šæ¬¡è°ƒæ•´é…ç½®çš„æ ¼å¼ï¼ˆé…ç½®é¡¹çš„è®¾è®¡ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;è°ƒæ•´å‘½ä»¤è¡Œå·¥å…·çš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬æ”¯æŒæ–°çš„ CLI é€‰é¡¹ã€è°ƒæ•´è¾“å‡ºæŠ¥å‘Šçš„å½¢å¼ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;æ›´æ–° Readme.md æ–‡ä»¶ï¼Œå°†æµ‹è¯•ç»“æœåŒæ­¥åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;åœ¨è¿™æ¬¡ä½“éªŒè¿‡ç¨‹ä¸­ï¼Œæˆ‘æœ‰æ„è¯†çš„ä¸å»ç›´æ¥è¿›è¡Œç¼–ç å·¥ä½œï¼Œè€Œæ˜¯å°½å¯èƒ½çš„é€šè¿‡ä¸ CC äº¤äº’æ¥è¾¾æˆæˆ‘çš„ç›®çš„ï¼Œå› æ­¤ï¼Œè¿™ä¸ªé¡¹ç›®ä¸­å‡ ä¹å…¨éƒ¨çš„ä»£ç éƒ½æ˜¯
CC ç¼–å†™ã€ä¿®æ­£å®Œæˆçš„ã€‚
è¿™ä¸€ç‚¹ä¸åŒäºä¹‹å‰ä½¿ç”¨ Copilot å’Œ Cursor çš„æ¨¡å¼ï¼šåœ¨è¿‡å»çš„ä½“éªŒä¸­ï¼Œä»£ç çš„ä¸»é¢˜æµç¨‹ã€éª¨æ¶éƒ½æ˜¯æˆ‘æ”¶å·¥ç¼–å†™ï¼ŒAI ä»…åœ¨è¿‡ç¨‹ä¸­ç©¿æ’ååŠ©ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è™½ç„¶æ˜¯ä¸€æ¬¡å°çš„å°è¯•ï¼Œè¿˜æœ‰å¾ˆå¤šçš„ CC èƒ½åŠ›å¹¶æ²¡æœ‰å……åˆ†åˆ©ç”¨èµ·æ¥ï¼Œä½†è¿™ä¸ªä½“éªŒè¿‡ç¨‹å¸¦ç»™äº†æˆ‘ä¸€äº›å…¨æ–°çš„æ€è€ƒï¼Œæˆ‘ä¼šåœ¨è¿™ç‰‡ Blog
ä¸­è®°å½•æˆ‘çš„æ‰€æ€æ‰€è™‘ï¼Œä»¥æœŸå¾…èƒ½å¤Ÿ
æ‰¾åˆ°æœªæ¥ï¼ˆä¸éœ€è¦é‚£ä¹ˆé¥è¿œï¼Œæˆ–è®¸å°±æ˜¯æ¥ä¸‹æ¥çš„æŸä¸ªåŒºé—´ï¼‰çš„æ­£ç¡®çš„ AI ä½¿ç”¨æ¨¡å¼ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;yi-ji-yu-vibe-coding-de-ruan-jian-kai-fa-bian-hua&quot;&gt;ä¸€ã€åŸºäº Vibe Coding çš„è½¯ä»¶å¼€å‘å˜åŒ–&lt;&#x2F;h1&gt;
&lt;p&gt;åŸºäº Claude Code è¿™æ ·çš„ vibe toolsï¼Œç›¸æ¯”ä¼ ç»Ÿè½¯ä»¶å¼€å‘ä¼šå¸¦æ¥ä»¥ä¸‹æ ¹æœ¬æ€§å˜åŒ–ï¼š&lt;&#x2F;p&gt;
&lt;h2 id=&quot;1-kai-fa-liu-cheng-de-gen-ben-xing-zhuan-bian&quot;&gt;1. å¼€å‘æµç¨‹çš„æ ¹æœ¬æ€§è½¬å˜&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;cong-min-jie-mo-shi-zhuan-bian-wei-vibemo-shi&quot;&gt;ä»&lt;code&gt;æ•æ·æ¨¡å¼&lt;&#x2F;code&gt; è½¬å˜ä¸º &lt;code&gt;Vibeæ¨¡å¼&lt;&#x2F;code&gt;&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼ ç»Ÿæ¨¡å¼&lt;&#x2F;strong&gt;ï¼šç¼–å†™éœ€æ±‚æ–‡æ¡£ â†’ è®¾è®¡æ–¹æ¡ˆ â†’ å†™ä»£ç  â†’ è°ƒè¯• â†’ ä¿®æ”¹ä»£ç çš„å¾ªç¯
ä»£ä»·ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å›¢é˜Ÿè¦æ±‚é«˜ï¼šè¦æ±‚å…¨èƒ½çš„å›¢é˜Ÿã€é«˜æ˜‚çš„æ²Ÿé€šæˆæœ¬ã€ç®¡ç†æˆæœ¬&lt;&#x2F;li&gt;
&lt;li&gt;æ²Ÿé€šæ•ˆç‡ä½ï¼šå—é™äºå›¢é˜Ÿäººå‘˜çš„è®¤çŸ¥æ°´å¹³å·®å¼‚ï¼Œä»¥åŠä¼ ç»Ÿçš„ç¼–å†™æ–‡æ¡£ã€æ–¹æ¡ˆã€ä»£ç çš„ä½æ•ˆç‡ï¼Œæ—¶é—´æ•ˆç‡ + ç»Ÿä¸€è¯­è¨€ + è®¤çŸ¥å¯¹é½
å¸¦æ¥äº†å¤§çš„é¸¿æ²Ÿã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åçˆ±å¦¥åçš„é£æ ¼ï¼šæ— è®ºæ˜¯è°ƒæ•´éœ€æ±‚ã€è®¾è®¡æ–¹æ¡ˆã€ç°æœ‰ä»£ç ï¼Œéƒ½å—é™äºå›¢é˜Ÿæ²Ÿé€šå’Œè¿­ä»£æ•ˆç‡ï¼Œä»¥åŠå…¶ä»–ä¸ç¡®å®šçš„é£é™©ï¼Œå›¢é˜Ÿæ›´åå‘äºè¾¾æˆä¿å®ˆçš„ã€å¦¥åçš„æ–¹æ¡ˆï¼Œ
ä»¥è§„é¿é£é™©ï¼Œè€Œéå¤§èƒ†åˆ›æ–°ã€çªç ´ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è¿­ä»£é€Ÿåº¦æ…¢ï¼šé™¤äº†ä¼ ç»Ÿæµç¨‹è‡ªèº«çš„å‘¨æœŸé•¿å¯¼è‡´è¿­ä»£æ•ˆç‡æ…¢ä¹‹å¤–ï¼Œå†å²åŒ…è¢±å¸¦æ¥çš„å½±å“ä¹Ÿéå¸¸å·¨å¤§ã€‚ä»¥è‡´ä¸é¡¹ç›®è¶Šå¾€åèµ°ï¼Œå•ä½äººå¤©çš„äº§å‡ºè¶Šæ¥è¶Šä½ï¼Œè€Œç³»ç»Ÿçš„å¤æ‚æ€§åˆ™è¶Šæ¥è¶Šé«˜ï¼Œ
å½¢æˆä¸€ç§æ¶æ€§çš„åé¦ˆå¢å¼ºæœºåˆ¶ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Vibeæ¨¡å¼&lt;&#x2F;strong&gt;ï¼šæè¿°éœ€æ±‚ï¼ˆå¯¹è¯å¼è¿­ä»£ï¼‰ â†’ AIç”Ÿæˆï¼ˆç”Ÿæˆæ–¹æ¡ˆã€ä»£ç ã€æ–‡æ¡£ï¼‰ â†’ å¯¹è¯å¼è¿­ä»£ä¼˜åŒ–
æœ‰å¦‚ä»&lt;code&gt;ç€‘å¸ƒå¼å¼€å‘æ¨¡å¼&lt;&#x2F;code&gt;æ¼”å˜ä¸º&lt;code&gt;æ•æ·å¼€å‘æ¨¡å¼&lt;&#x2F;code&gt;ï¼Œå†å‘å±•åˆ°&lt;code&gt;Vibeæ¨¡å¼&lt;&#x2F;code&gt;æ—¶ï¼Œä¼šå¸¦æ¥å¾ˆå¤§çš„å˜åŒ–ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å›¢é˜Ÿå‘ç”Ÿå˜åŒ–ï¼šä¸€ä¸ªäººå°±å¯ä»¥æˆä¸ºä¸€ä¸ªè¶…çº§å›¢é˜Ÿï¼ˆäº§å“ç»ç†ã€æ¶æ„å¸ˆã€å¼€å‘å·¥ç¨‹å¸ˆã€æµ‹è¯•å·¥ç¨‹å¸ˆï¼‰ï¼Œèƒ½åŠ›å…¨é¢&lt;&#x2F;li&gt;
&lt;li&gt;æ²Ÿé€šæ•ˆç‡æå‡ï¼Œç®¡ç†æˆå‘˜ä¸‹é™ã€‚ä¸€ä¸ªäººçš„å›¢é˜Ÿåœ¨è¿™æ–¹é¢å…·æœ‰é‡çº§ä¸Šçš„çªç ´ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è¿½æ±‚æè‡´æˆä¸ºå¯èƒ½çš„é£æ ¼ï¼Œæ²¡æœ‰åšä¸åˆ°ï¼Œå°±æ€•æƒ³ä¸åˆ°ã€‚å½“ç„¶ï¼Œè¿™é‡Œä¹Ÿå¯¹æ¶æ„å¸ˆæå‡ºäº†æ›´é«˜çš„è¦æ±‚ï¼Œä½ çš„è¿œè§ã€åˆ›æ„å†³å®šäº†æœ€ç»ˆçš„å¯èƒ½æ€§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¤§èƒ†é‡æ„ã€åˆ›æ–°ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;2-spec-first&quot;&gt;2. Spec-First&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;cong-guo-cheng-shi-she-ji-zhuan-xiang-han-shu-shi-gui-ge&quot;&gt;ä»è¿‡ç¨‹å¼è®¾è®¡è½¬å‘å‡½æ•°å¼è§„æ ¼&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¼ ç»Ÿå¼€å‘ä¸­ï¼Œå¾ˆå¤šç»†èŠ‚åœ¨ç¼–ç è¿‡ç¨‹ä¸­æ‰è€ƒè™‘æ¸…æ¥šï¼Œåœ¨è®¾è®¡é˜¶æ®µè¿‡ç»†ï¼Œå¯èƒ½æµªè´¹å¤§é‡æ—¶é—´ï¼Œä¸”åç»­å®é™…ä¸Šä¼šåç¦»å®é™…ä»£ç è€Œæˆä¸ºé¸¡è‚‹ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ä¼ ç»Ÿæµç¨‹ä¸­ï¼Œå¾ˆå¤šçš„æ–¹æ¡ˆæ›´åé‡äº How é£æ ¼çš„è¿‡ç¨‹å¼è®¾è®¡, è€Œ VibeCode æµç¨‹ä¸­ï¼Œæ›´åé‡äº What é£æ ¼çš„å‡½æ•°å¼é£æ ¼ã€‚
ä½œä¸ºä¸€å Functional Programming çš„çˆ±å¥½è€…ï¼Œæˆ‘çš„è¿‡å¾€ç»éªŒå‘Šè¯‰æˆ‘ï¼šFunctional Code å…·æœ‰æ›´é«˜çš„æŠ½è±¡å±‚æ¬¡ï¼Œç›¸æ¯” Procedure
Codeï¼Œå…·æœ‰æ›´ä¸ºç®€å•çš„æ•°æ®æµï¼Œä»å¯è¯»æ€§
åˆ°ä»£ç è´¨é‡éƒ½ä¼šæœ‰æ˜æ˜¾æå‡ã€‚è€Œåº”ç”¨åˆ°è½¯ä»¶è¿‡ç¨‹ã€è½¯ä»¶æ–¹æ¡ˆæ—¶ï¼Œä¹Ÿéå¸¸æœ‰æ•ˆï¼šèƒ½å¤Ÿæä¾›ä¸€ä¸ªæ˜ç¡®çš„ã€æ¸…æ™°çš„ã€å¯éªŒè¯çš„ç›®æ ‡ï¼Œè¿œèƒœè¿‡é™·å…¥å®ç°ç»†èŠ‚çš„è¿‡ç¨‹æè¿°ï¼ˆè¿™ä¸ªç”šä¹‹äºå›¢é˜Ÿç®¡ç†ã€ä¸æ•™ç»ƒè‰ºæœ¯ã€
ä¸ªäººè§„åˆ’éƒ½ç¬¦åˆç›¸åŒçš„é€»è¾‘ ï¼‰ã€‚
åœ¨ VibeCode æ¨¡å¼ä¸‹ï¼Œè¿™ä¸ªé£æ ¼å°±æˆä¸ºæ˜¾å­¦äº†ï¼Œå› ä¸ºè¿™ä¹Ÿæ˜¯ä½ é©±åŠ¨ AI å·¥ä½œçš„åŸºæœ¬æ–¹å¼ï¼Œä¸º AI æä¾›æ˜ç¡®ã€æ¸…æ™°çš„æŒ‡ä»¤ï¼Œæ˜¯æœ‰æ•ˆäº§å‡ºçš„å¿…å¤‡æŠ€èƒ½ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;bu-tong-ren-wu-xia-de-gui-ge-ding-yi&quot;&gt;ä¸åŒä»»åŠ¡ä¸‹çš„è§„æ ¼å®šä¹‰&lt;&#x2F;h3&gt;
&lt;p&gt;åœ¨vibeç¼–ç¨‹ä¸­ï¼Œè§„æ ¼å®šä¹‰å˜å¾—æ›´åŠ é‡è¦ï¼Œæ ¹æ®ä¸åŒçš„ä»»åŠ¡ï¼Œéœ€è¦ç›¸åº”çš„è§„æ ¼å®šä¹‰ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;åŠŸèƒ½è§„æ ¼
&lt;ul&gt;
&lt;li&gt;Use Case - ç”¨æˆ·ä½¿ç”¨åœºæ™¯å’Œäº¤äº’æµç¨‹&lt;&#x2F;li&gt;
&lt;li&gt;User Story - ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„åŠŸèƒ½éœ€æ±‚æè¿°&lt;&#x2F;li&gt;
&lt;li&gt;Business Logic - Rules, Workflow etc.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;æ¥å£è§„æ ¼
&lt;ul&gt;
&lt;li&gt;CLI: å‘½ä»¤è¡Œæ¥å£è®¾è®¡ï¼ˆå‚æ•°ã€é€‰é¡¹ã€è¾“å‡ºæ ¼å¼ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;API: restful style, RPC style
&lt;ul&gt;
&lt;li&gt;Contract Spec: pre-condition, post-condition, invariant&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;SPI: é¢å‘ OCP æ‰©å±•çš„æ¥å£è®¾è®¡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Configuration - é…ç½®æ–‡ä»¶æ ¼å¼å®šä¹‰ã€‚å¾ˆå¤šå¤æ‚çš„ç³»ç»Ÿï¼Œé…ç½®æ–‡ä»¶åº”è¯¥é¢å‘ç”¨æˆ·è¿›è¡Œè®¾è®¡ï¼Œæ˜¯è½¯ä»¶çš„æ¶æ„çš„ä¸€ä¸ªæŠ•å½±ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Data è§„æ ¼
&lt;ul&gt;
&lt;li&gt;Entity-Relation Model &#x2F; Database Schema&lt;&#x2F;li&gt;
&lt;li&gt;Class Model&lt;&#x2F;li&gt;
&lt;li&gt;Domain Model: Entity(lifecycle, query, command), Value, Event, Service etc.&lt;&#x2F;li&gt;
&lt;li&gt;C4 Model: Contextï¼Œ Container, Component, Class&lt;&#x2F;li&gt;
&lt;li&gt;CRC(Class Responsibility Card): èŒè´£ä¼˜å…ˆ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;QA
&lt;ul&gt;
&lt;li&gt;Test Case - å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ç”¨ä¾‹, TDD, BDD etc&lt;&#x2F;li&gt;
&lt;li&gt;Performance - æ€§èƒ½æŒ‡æ ‡å’ŒåŸºå‡†æµ‹è¯•&lt;&#x2F;li&gt;
&lt;li&gt;Security - å®‰å…¨ç­–ç•¥å’Œæƒé™æ§åˆ¶&lt;&#x2F;li&gt;
&lt;li&gt;Error Handling - å¼‚å¸¸å¤„ç†å’Œé”™è¯¯æ¢å¤ç­–ç•¥&lt;&#x2F;li&gt;
&lt;li&gt;Version Compatible: ç‰ˆæœ¬å…¼å®¹ç­–ç•¥&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Dev Ops
&lt;ul&gt;
&lt;li&gt;Logging&#x2F;Monitoring - æ—¥å¿—è®°å½•å’Œç›‘æ§æŒ‡æ ‡&lt;&#x2F;li&gt;
&lt;li&gt;Deployment - éƒ¨ç½²æµç¨‹å’Œç¯å¢ƒé…ç½®&lt;&#x2F;li&gt;
&lt;li&gt;Visibility&#x2F;Observability - å¯è§‚æµ‹æ€§è¦æ±‚&lt;&#x2F;li&gt;
&lt;li&gt;Backup&#x2F;Recovery - å¤‡ä»½å’Œæ¢å¤ç­–ç•¥&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Others
&lt;ul&gt;
&lt;li&gt;ä¾èµ–ç›¸å…³ï¼šå¸Œæœ›é€‰æ‹©çš„æ¡†æ¶ã€åº“ï¼Œä»¥åŠä¸å¸Œæœ›ä½¿ç”¨çš„æ¡†æ¶ã€åº“&lt;&#x2F;li&gt;
&lt;li&gt;æ„å»ºå·¥å…·&lt;&#x2F;li&gt;
&lt;li&gt;ç›®å½•ç»“æ„&lt;&#x2F;li&gt;
&lt;li&gt;ä»£ç ï¼šç¼–ç¨‹è¯­è¨€é€‰æ‹©ï¼Œç¼–ç¨‹é£æ ¼é€‰æ‹©ï¼ˆæˆ‘æ›´åå‘äºfunctionalï¼‰ï¼Œä»£ç é£æ ¼ï¼ˆç¼©è¿›ã€å‘½åç­‰ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;yi-jiao-hu-zeng-liang-de-fang-shi-jin-xing-spec-ding-yi&quot;&gt;ä»¥äº¤äº’ã€å¢é‡çš„æ–¹å¼è¿›è¡Œ Spec å®šä¹‰&lt;&#x2F;h3&gt;
&lt;p&gt;æ•´ç†ä¸€ä»½è‰¯å¥½å®šä¹‰çš„ Spec æ¥ä½œä¸ºä¸‹ä¸€é˜¶æ®µçš„ä»»åŠ¡å¼€å‘ï¼ˆåŒ…æ‹¬ç¼–ç ã€æµ‹è¯•ï¼‰è‡ªèº«æˆä¸ºäº† Vibe Coding ä¸­æœ€ä¸ºé‡è¦çš„å·¥ä½œï¼Œå¯¹äºå¤æ‚ç³»ç»Ÿè€Œè¨€ï¼Œè¿™ä¸ªæ˜¯æœ€å¤§çš„æŒ‘æˆ˜ï¼Œ
äº‹å®ä¸Šï¼Œå¤§éƒ¨ä»½çš„è½¯ä»¶ï¼ˆå°¤å…¶æ˜¯å†å²æ‚ ä¹…çš„ç³»ç»Ÿï¼‰å­˜åœ¨æˆ–å¤šæˆ–å°‘çš„é—®é¢˜ï¼šåŒ…æ‹¬ bugï¼Œå®‰å…¨æ¼æ´ï¼Œéš¾ä»¥ç»´æŠ¤ã€éš¾ä»¥æ‰©å±• ç­‰é—®é¢˜ï¼Œå¾ˆå¤šäººä¼šç®€å•çš„å½’ç±»ä¸ºè½¯ä»¶ä»£ç å¤ªä¹±å¤ªå¤æ‚ï¼Œ
å¤§éƒ¨ä»½çš„æ—¥å¸¸å·¥ä½œä¹Ÿæ˜¯åœ¨ä»£ç å±‚é¢çš„ä¿®ä¿®è¡¥è¡¥ã€‚ä½†å®é™…ä¸Šï¼Œç»å¤§éƒ¨åˆ†çš„é—®é¢˜å…¶å®åº”è¯¥å½’æ ¹ä¸ºè®¾è®¡ä¸Šçš„é—®é¢˜ï¼ŒåŒ…æ‹¬ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€æ±‚è®¾è®¡çš„é—®é¢˜ï¼šæ¦‚å¿µå®šä¹‰æ˜¯å¦æ¸…æ™°ã€ç³»ç»Ÿå†…æ˜¯å¦æœ‰ä¸€è‡´çš„æ¦‚å¿µã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ¶æ„è®¾è®¡çš„é—®é¢˜ï¼šå±‚æ¬¡ç»“æ„ã€èŒè´£ã€å¥‘çº¦æ˜¯å¦æ¸…æ™°å®šä¹‰ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;åŒºåˆ†ä¸€ä¸ªé—®é¢˜åˆ°åº•æ˜¯ä»£ç å±‚é¢çš„é—®é¢˜è¿˜æ˜¯è®¾è®¡å±‚é¢çš„é—®é¢˜ï¼Œæˆ‘çš„åˆ¤æ–­æ–¹å¼æ˜¯ï¼šå¦‚æœæ˜¯ä»£ç é—®é¢˜ï¼Œé‚£ä¹ˆè¿™åº”è¯¥æ˜¯ä¸€ä¸ªå±€éƒ¨çš„ï¼ˆä¸ä¼šåœ¨å…¶ä»–åœ°æ–¹åå¤é‡å¤åŒæ ·æˆ–è€…ç›¸ä¼¼çš„é—®é¢˜ï¼‰ã€
å¯ä»¥å¿«é€Ÿä¿®å¤å¹¶é¿å…åå¤å‘ç”Ÿçš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¯ä¿®å¤æˆæœ¬ä¸é«˜ï¼Œå¹¶ä¸”ä¿®å¤åä¸ä¼šå¸¦æ¥æ–°çš„å¤æ‚æ€§çš„é—®é¢˜ï¼Œè¿™äº›å¯ä»¥å½’ç»“ä¸ºç®€å•çš„ç¼–ç è´¨é‡é—®é¢˜ï¼Œè€Œå¦‚æœå‡ºç°å¦‚ä¸‹ç‰¹å¾ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å­˜åœ¨å¾ˆå¤šç›¸ä¼¼é—®é¢˜ï¼ˆæ˜¯é¢æ€§é—®é¢˜ï¼Œè€Œéç‚¹æ€§é—®é¢˜ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;é—®é¢˜æ— æ³•å½»åº•ä¿®å¤&lt;&#x2F;li&gt;
&lt;li&gt;é—®é¢˜ä¿®å¤åï¼Œç³»ç»Ÿçš„å¤æ‚æ€§è¿›ä¸€æ­¥æ¶åŒ–
é‚£ä¹ˆè¿™å…¶å®æ˜¯ä¸€ä¸ªè®¾è®¡å±‚é¢çš„é—®é¢˜ï¼šå¦‚æœä¸ä»æ¦‚å¿µå®šä¹‰ã€æ¶æ„è®¾è®¡å±‚é¢å½»åº•çš„è§£å†³ï¼Œè€Œæ˜¯å•çº¯çš„è¡¥ä¸æ–¹å¼è§£å†³é—®é¢˜ï¼Œæœ€ç»ˆä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„å¤æ‚æ€§æå‡ã€æŠ€æœ¯åŒ…è¢±è¶Šæ¥è¶Šæ²‰é‡ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;3-jiao-se-he-ji-neng-yao-qiu-de-shen-ke-bian-hua&quot;&gt;3. è§’è‰²å’ŒæŠ€èƒ½è¦æ±‚çš„æ·±åˆ»å˜åŒ–&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;cheng-xu-yuan-jiao-se-zhuan-bian&quot;&gt;ç¨‹åºå‘˜è§’è‰²è½¬å˜&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;ä»&quot;ä»£ç ç¼–å†™è€…&quot;å˜æˆ&quot;å®šä¹‰è€… + è¯„å®¡è€… + åˆ›æ„è€…â€çš„è½¬å˜&lt;&#x2F;li&gt;
&lt;li&gt;ç›®æ ‡å®šä¹‰è€…ï¼š
&lt;ul&gt;
&lt;li&gt;æ¢³ç†ä½ çš„ç›®æ ‡ï¼Œä½ èƒ½å¦è®²æ¸…æ¥šï¼ˆè®²æ¸…æ¥šç›®æ ‡æ˜¯æˆæœ¬çš„ç¬¬ä¸€æ­¥ï¼‰ï¼Œå®é™…å·¥ä½œä¸­ï¼Œå¾ˆå¤šåŒå­¦æ—¢è®²ä¸æ¸…æ¥šç›®æ ‡ï¼Œä¹Ÿä¸æ¸…æ¥šè‡ªå·±ä¸æ¸…æ¥šç›®æ ‡ï¼Œæ··æ²Œå‰è¡Œæ˜¯å¸¸æ€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸ä»…è½¯ä»¶å¼€å‘ï¼Œä¸æ¸…æ¥šç›®æ ‡å‡ ä¹æ˜¯äººç±»çš„å¸¸æ€ã€‚ï¼ˆã€Šé«˜ç»©æ•ˆæ•™ç»ƒã€‹ä¸€ä¹¦å…¶å®å°±æ˜¯åœ¨æ•™ç»ƒè¿™ä¸ªè¿‡ç¨‹ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;å°†ç›®æ ‡ä»æ··æ²Œæ€æ•´ç†æˆä¸ºæ˜ç¡®æ¸…æ™°å¯è¡Œçš„ç»“æœï¼Œå…¶å®æ˜¯è§£å†³é—®é¢˜çš„æœ€å…³é”®æ­¥éª¤ã€‚å¯¹äºå¤æ‚çš„é—®é¢˜ï¼Œä½ åº”è¯¥å°†è¿™ä¸ªè¿‡ç¨‹å•ç‹¬ä¸€ä¸ªé˜¶æ®µï¼Œåˆ©ç”¨
AI æ¥å¸®ä½ æ•´ç†ï¼Œè€Œä¸æ˜¯ç«‹åˆ»æŠ•å…¥ä¸‹ä¸€é˜¶æ®µçš„å·¥ç»„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½ éœ€è¦å¤šèŠ±ä¸€äº›æ—¶é—´æ¥çœŸå®ç†è§£ç”¨æˆ·çš„ä¸šåŠ¡ã€éœ€æ±‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½ éœ€è¦å¤šèŠ±ä¸€äº›æ—¶é—´æ¥å­¦ä¹ è¿™ä¸ªé¢†åŸŸçš„ä¸“ä¸šçŸ¥è¯†ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½ éœ€è¦å¤šèŠ±ä¸€äº›æ—¶é—´æ¥äº†è§£ç›®å‰è§£å†³è¿™ä¸€ç±»é—®é¢˜çš„åŸºæœ¬æ–¹æ³•ã€ç«Ÿå“ç­‰ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;è¯„å®¡è€…ï¼šå¯¹ AI çš„å›ç­”è¿›è¡Œæ€è€ƒï¼Œè¿™æ˜¯å¦æ»¡è¶³äº†ä½ çš„ç›®æ ‡
&lt;ul&gt;
&lt;li&gt;ä½ åº”è¯¥æ˜¯ä¸€ä¸ªæŒ‘å‰”è€…ï¼Œä¸è¦æ¥å—ä½æ ‡å‡†çš„ç»“æœã€‚å¯ä»¥è¿›ä¸€æ­¥å‘é€æ”¹è¿›çš„æŒ‡ä»¤ï¼Œå°è¯•ä¸€ä¸ªä½ å¿ƒç›®ä¸­æ›´å¥½çš„ç­”æ¡ˆã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœ AI ä¸èƒ½ç»™åˆ°ä½ æœ‰æ•ˆçš„ç­”æ¡ˆï¼Œä½ éœ€è¦é‡æ–°æ€è€ƒè‡ªå·±çš„ç›®æ ‡å®šä¹‰ï¼Œç»™å‡ºæ›´å…·ä½“çš„æŒ‡ä»¤ï¼Œæˆ–è€…åœ¨å…³é”®ä½ç½®ä¸Šè¶Šè¿‡ AI è‡ªå·±åŠ¨æ‰‹ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;åˆ›æ„è€…ï¼šä½ å®šä¹‰çš„ç›®æ ‡çš„ä»·å€¼è¶Šé«˜ï¼Œåç»­çš„äº§å‡ºå°±ä¼šè¶Šé«˜ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;ji-neng-men-jian-zhong-xin-ding-yi&quot;&gt;æŠ€èƒ½é—¨æ§›é‡æ–°å®šä¹‰&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é™ä½æŠ€æœ¯é—¨æ§›&lt;&#x2F;strong&gt;ï¼šè¯­æ³•ã€APIæŸ¥æ‰¾ç­‰æŠ€æœ¯ç»†èŠ‚ä¸å†æ˜¯ç“¶é¢ˆ&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;æé«˜ä¸šåŠ¡é—¨æ§›&lt;&#x2F;strong&gt;ï¼šå¯¹ç³»ç»Ÿè®¾è®¡ã€ä¸šåŠ¡é€»è¾‘çš„ç†è§£è¦æ±‚æ›´é«˜&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;&quot;ä¼šæé—®&quot;æ¯”&quot;ä¼šå†™ä»£ç &quot;æ›´é‡è¦&lt;&#x2F;strong&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;4-yi-ge-ren-jiu-shi-yi-ge-tuan-dui-kai-fa-zi-yuan-de-chong-yu-yu-jiao-se-bian-jie-de-xiao-jie&quot;&gt;4. ä¸€ä¸ªäººå°±æ˜¯ä¸€ä¸ªå›¢é˜Ÿï¼šå¼€å‘èµ„æºçš„å……è£•ä¸è§’è‰²è¾¹ç•Œçš„æ¶ˆè§£&lt;&#x2F;h2&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;1942599600293802943&quot;&gt;MIT å¤§ç‰›ä¼ æˆ Vibe Coding æ­£ç¡®å§¿åŠ¿ï¼šAI ä¸æ˜¯æ–°æ‰‹çš„å…¥é—¨ç©å…·ï¼Œè€Œæ˜¯ä¸“å®¶çš„è¶…çº§å·¥å…·&lt;&#x2F;a&gt;
åŸæ–‡ï¼šhttps:&#x2F;&#x2F;www.stochasticlifestyle.com&#x2F;a-guide-to-gen-ai-llm-vibecoding-for-expert-programmers&#x2F;&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;æ ¸å¿ƒå¿ƒæ™ºæ¨¡å‹ï¼šæŠŠ LLM å½“ä½œä¸€ä¸ª &lt;code&gt;å¤§äºŒå®ä¹ ç”Ÿ&lt;&#x2F;code&gt;: æ‡‚åŸºç¡€ï¼Œä¼šæ¨¡ä»¿ï¼Œèƒ½æ‰§è¡Œï¼ŒçŸ¥è¯†é¢å¹¿è€Œä¸æ·±ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é«˜æ‰‹çš„ Vibe Coding å·¥ä½œæµï¼šå½“å¥½ã€ŒåŒ…å·¥å¤´ã€ï¼Œåˆ«å½“ã€Œç å†œã€&lt;&#x2F;li&gt;
&lt;li&gt;ç§˜è¯€ä¸€ï¼šæ‰¹é‡å¸ƒç½®ã€Œç®€å•æ˜ç¡®ã€ä»»åŠ¡ï¼Œç„¶åèµ°å¼€&lt;&#x2F;li&gt;
&lt;li&gt;ç§˜è¯€äºŒï¼šåƒæ‰”åƒåœ¾ä¸€æ ·æ‰”æ‰åä»£ç &lt;&#x2F;li&gt;
&lt;li&gt;ç§˜è¯€ä¸‰ï¼šè¿½æ±‚ã€Œæ€»æˆåŠŸæ•°ã€ï¼Œè€Œéã€ŒæˆåŠŸç‡ã€&lt;&#x2F;li&gt;
&lt;li&gt;ç§˜è¯€å››ï¼šå…ˆåœ¨ä½ æœ€ç†Ÿæ‚‰çš„ä»£ç ä¸Šç”¨
&amp;gt; ç»“è®ºï¼šæ­£ç¡®å®Œæˆ Vibe Coding æ˜¯ä¸“å®¶çš„ä»»åŠ¡ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;åœ¨ Vibe Coding ä¹‹å‰ï¼Œè¦å®Œæˆä¸€å®šå¤æ‚æ€§çš„è½¯ä»¶äº§å“çš„ç ”å‘ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸€å®šè§„æ¨¡çš„ç ”å‘å›¢é˜Ÿï¼ŒåŒ…æ‹¬ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;äº§å“ç»ç†ï¼Œå®šä¹‰éœ€æ±‚&lt;&#x2F;li&gt;
&lt;li&gt;æ¶æ„å¸ˆï¼šè´Ÿè´£æŠ€æœ¯é€‰é¡¹ã€æ¶æ„è®¾è®¡ï¼Œä¹ŸåŒ…æ‹¬ä¸€äº›æ ¸å¿ƒä»£ç çš„å¼€å‘å·¥ä½œã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¼€å‘å·¥ç¨‹å¸ˆï¼šåŒºåˆ†èµ„æ·±å±‚æ¬¡ã€æ™®é€šå±‚æ¬¡çš„å·¥ç¨‹å¸ˆï¼Œä¸€èˆ¬æ˜¯æ•°é‡æœ€å¤šçš„&lt;&#x2F;li&gt;
&lt;li&gt;æµ‹è¯•å·¥ç¨‹å¸ˆï¼šåŒºåˆ†ç™½ç›’æµ‹è¯•ã€é»‘ç›’æµ‹è¯•ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;éƒ¨ç½²ã€è¿ç»´å·¥ç¨‹å¸ˆã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;è¿™é‡Œï¼Œå¼€å‘å·¥ç¨‹å¸ˆã€æµ‹è¯•å·¥ç¨‹å¸ˆä¸€èˆ¬æ˜¯äººæ•°æœ€å¤šçš„ï¼Œä¹Ÿæ˜¯å¼€å‘å‘¨æœŸä¸­æœ€ä¸ºé¢‘ç¹çš„æ²Ÿé€šã€ç®¡ç†å¯¹è±¡ï¼šä»ç†è§£éœ€æ±‚ã€ç†è§£è®¾è®¡ã€ç¼–å†™ä»£ç ã€ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œå¤§éƒ¨ä»½çš„å·¥ä½œ
éƒ½ä¾èµ–ä¸æ‰‹å·¥ï¼Œå¤§éƒ¨ä»½çš„æ²Ÿé€šå·¥ä½œéƒ½æ¶‰åŠåˆ°å½¼æ­¤ä¹‹é—´ï¼ˆåŒ…æ‹¬ä»éœ€æ±‚åˆ°è®¾è®¡ã€ä»è®¾è®¡åˆ°ç¼–ç ã€ä»ç¼–ç åˆ°æµ‹è¯•ï¼Œä»¥åŠæ‹†åˆ†åçš„ç›¸äº’ä¾èµ–ï¼‰ï¼Œæ—¥å¸¸ä¼šå­˜åœ¨å¤§é‡çš„æ²Ÿé€šã€åè°ƒå·¥ä½œï¼Œ
ä»¥å¼¥è¡¥å›¢é˜Ÿè®¤çŸ¥çš„å·®å¼‚ã€‚ä¹Ÿæœ‰å¾ˆå¤šçš„æ—¶é—´æµªè´¹æ˜¯å¤„åœ¨ç­‰å¾…ä¹‹ä¸­ï¼šä¸‹æ¸¸ç­‰å¾…ä¸Šæ¸¸ï¼Œä»»åŠ¡åä½œè€…ä¹‹é—´çš„ç›¸äº’ç­‰å¾…ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;Vibe Coding å°†å¯¹è¿™ä¸€æ¨¡å¼äº§ç”Ÿå¾ˆå¤§çš„å†²å‡»ï¼Œä½¿å¾—æ¶æ„å¸ˆå°†æ‰¿æ‹…æ›´å¤§çš„èŒè´£ï¼Œå®Œæˆè½¯ä»¶äº§å“çš„åŠŸèƒ½å®šä¹‰ã€æ¶æ„å®šä¹‰ã€ç‰¹æ€§è§„åˆ’ï¼Œå¹¶æŒ‡æŒ¥å¤šä¸ª
LLM å¹¶è¡Œå®ŒæˆåŒ…æ‹¬ï¼š
æ–‡æ¡£ç¼–å†™ã€ ä»£ç ï¼ˆåŒ…æ‹¬æµ‹è¯•ä»£ç ï¼‰çš„ç¼–å†™å·¥ä½œï¼Œå¹¶æœ€ç»ˆäº¤ä»˜æ›´é«˜è´¨é‡çš„è½¯ä»¶äº§å“ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å‚ç…§ Stochastic çš„å·¥ä½œæ–¹å¼ï¼Œå€ŸåŠ©äº AI ç¼–ç¨‹å·¥å…·ï¼Œä¸€ä¸ªæ¶æ„å¸ˆå¯ä»¥åŒæ—¶è°ƒåŠ¨ 3 - 10 ä¸ªï¼ˆä½œè€…å®£ç§°æœ‰å¤§çº¦32ä¸ª claude agent
åœ¨æŒç»­è¿è¡Œï¼Œæˆ‘å¯¹æ­¤è¿˜æ˜¯æœ‰äº›è¯§å¼‚ï¼‰
AI agentï¼Œè®©ä»–ä»¬è¿›è¡ŒååŒå®Œæˆä½ å¸ƒç½®çš„ä»»åŠ¡ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨ Vibe Coding æ¨¡å¼ä¸‹ï¼Œæ¶æ„å¸ˆï¼ˆä¸“å®¶ï¼‰çš„ä¸ªäººèƒ½åŠ›è¾¹ç•Œå°†å¤§å¹…åº¦æ‰©å±•ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªäººå¯ä»¥æ‰¿æ‹…äº§å“ç»ç†ã€æ¶æ„å¸ˆã€å¼€å‘å·¥ç¨‹å¸ˆã€æµ‹è¯•å·¥ç¨‹å¸ˆç­‰å¤šä¸ªè§’è‰²&lt;&#x2F;li&gt;
&lt;li&gt;å°å›¢é˜Ÿå¯ä»¥å®ŒæˆåŸæœ¬éœ€è¦å¤§å›¢é˜Ÿçš„å·¥ä½œ&lt;&#x2F;li&gt;
&lt;li&gt;è·¨è¯­è¨€ã€è·¨æŠ€æœ¯æ ˆçš„æˆæœ¬å¤§å¹…é™ä½(è¯•æƒ³åŸæœ¬éœ€è¦æ‹†åˆ†ä¸ºå¤šä¸ªå²—ä½ï¼Œè€Œç°åœ¨ LLM å¯ä»¥æ‰¿æ‹…å‡ ä¹æ¯ä¸€ä¸ªå²—ä½)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;åŒæ—¶ï¼Œæ–°çš„ç®¡ç†æ–¹å¼ï¼Œ å›¢é˜Ÿçš„åä½œæˆæœ¬é™ä½ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹å›¢é˜Ÿé—´æ²Ÿé€šçš„ä¾èµ–æ˜¾è‘—é™ä½&lt;&#x2F;li&gt;
&lt;li&gt;å›¢é˜Ÿç®¡ç†æˆæœ¬å’Œæ²Ÿé€šæˆæœ¬éƒ½å¤§å¹…å‡å°‘&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨è‰¯å¥½çš„æ¶æ„æ”¯æ’‘åŸºç¡€ä¹‹ä¸Šï¼ŒLLM å¯ä»¥è¡¨ç°å‡ºå¹³è¡¡çš„ã€Good çš„ç¼–ç¨‹èƒ½åŠ›ã€è®¾è®¡èƒ½åŠ›ï¼ˆå¯ä»¥æŠŠ LLM ç±»æ¯”ä¸ºåœ¨æ¯ä¸ªé¢†åŸŸéƒ½èƒ½æ‰“ 80åˆ†
çš„é‚£ä¸ªé€‰æ‰‹ï¼‰ã€‚è€Œæ¶æ„å¸ˆ
åˆ™è¦æˆä¸ºé‚£ä¸ªèƒ½æ‰“ 90-120 åˆ†çš„é¢†å¯¼è€…ã€‚ï¼ˆå½“ç„¶ï¼Œå¦‚æœä½ çš„æ°´å¹³æ˜¯ 80åˆ†ï¼Œé‚£ä¹ˆ LLM ä¹Ÿä¼šåœ¨æ­¤åŸºç¡€ä¸Šæ‰“ä¸ŠæŠ˜æ‰£ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;5-kai-fa-su-du-he-zhong-gou-tai-du-de-ge-xin&quot;&gt;5. å¼€å‘é€Ÿåº¦å’Œé‡æ„æ€åº¦çš„é©æ–°&lt;&#x2F;h2&gt;
&lt;p&gt;Vibe Coding ä¼šå¸¦æ¥å¼€å‘æ•ˆç‡çš„å¤§å¹…æå‡ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä»æƒ³æ³•åˆ°å¯è¿è¡ŒåŸå‹çš„æ—¶é—´å¤§å¹…ç¼©çŸ­: å¤§éƒ¨ä»½æƒ…å†µä¸‹ï¼Œä»ä½ ç»™å‡ºæ¸…æ™°çš„æè¿°åˆ° LLM ç”ŸæˆåŸå‹ä»£ç ï¼Œè¿™ä¸ªæ—¶é—´å°†ä»ä¼ ç»Ÿçš„ äººå¤©é‡çº§ é™ä½åˆ°
5-10 åˆ†é’Ÿé‡çº§ã€‚
è€Œä¸”ä»åŸå‹çš„è§’åº¦æ¥è¯´ï¼Œå®ƒå‡ ä¹æ˜¯å®Œç¾çš„ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;è®¾è®¡çš„å‘¨æœŸä¹Ÿå¤§å¹…é™ä½ï¼šä¼ ç»Ÿçš„æ–¹å¼ä¸‹ï¼Œè¦å½¢æˆä¸€ä»½è®¾è®¡å®Œæ•´çš„è®¾è®¡æ–¹æ¡ˆï¼Œå¾€å¾€éœ€è¦è¾ƒé•¿æ—¶é—´çš„æ·±æ€ç†Ÿè™‘ã€æ•´ç†å’Œè®ºè¯å·¥ä½œï¼ˆè¿™é‡Œæœ‰å¾ˆå¤§æ¯”ä¾‹æ˜¯ä¸€äº›éæ ¸å¿ƒçš„å·¥ä½œï¼Œ
ä½†ä½œä¸ºä¸€ä¸ªå®Œæ•´çš„ä½“ç³»ï¼Œåˆä¸å¯æˆ–ç¼ºï¼‰ã€‚è€Œä»Šï¼Œä½ å¯ä»¥æŠŠç²¾åŠ›èšç„¦åˆ°è®¾è®¡æ–¹æ¡ˆä¸­çš„æ ¸å¿ƒéƒ¨ä»½ï¼Œè€Œå……åˆ†åˆ©ç”¨ LLM çš„å¹¿æ’­çš„çŸ¥è¯†é¢æ¥å¤„ç†å¤§é‡çš„ç»†èŠ‚é—®é¢˜ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;é‡æ„æˆæœ¬é™ä½ï¼Œåœ¨æœ‰è‰¯å¥½çš„æµ‹è¯•ç”¨ä¾‹è¾…åŠ©çš„æƒ…å†µä¸‹ï¼Œå¯¹ç°æœ‰è®¾è®¡ä¸­å­˜åœ¨çš„ä¸åˆç†é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¤§èƒ†çš„é‡æ„ï¼Œä¹ƒè‡³äºå½»åº•çš„é‡æ–°è®¾è®¡ï¼Œæœæ–­çš„æ”¾å¼ƒå†å²åŒ…è¢±ã€‚(
åœ¨
ä¼ ç»Ÿçš„æ¨¡å¼ä¸­ï¼Œè¿™ä¸€å—çš„æˆæœ¬è¦é«˜å¾—å¤šï¼Œä»¥è‡³äºæˆ‘ä»¬å¾ˆå¤šæ—¶å€™ä¼šåšå¤ªå¤šçš„å¦¥åï¼Œè€Œæ¶æ„è®¾è®¡çš„åˆç†æ€§åˆ™ä¼šè¾…åŠ©æå‡ä¸‹ä¸€é˜¶æ®µ LLM
ç¼–å†™ä»£ç ã€ä¿®å¤é—®é¢˜çš„æ•ˆç‡å’Œè´¨é‡)&lt;&#x2F;p&gt;
&lt;p&gt;ç›¸åº”çš„ï¼Œåœ¨ Vibe Coding æ—¶ä»£ï¼Œå¦‚æœä½ ç°æœ‰çš„é¡¹ç›®æ»¡è¶³ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ¸…æ™°çš„é¢†åŸŸåˆ’åˆ†ï¼ˆæ°´å¹³æ‹†è§£ï¼‰ã€åˆ†å±‚æ¶æ„ï¼ˆå‚ç›´æ‹†è§£ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;ç³»ç»Ÿå„ä¸ªæ¨¡å—å…·æœ‰é«˜å†…èšã€ä½è€¦åˆç‰¹æ€§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å„ä¸ªç±»ã€å‡½æ•°æœ‰æ˜ç¡®çš„èŒè´£ã€æ¥å£å®šä¹‰ã€æ¥å£å¥‘çº¦ï¼Œå¹¶é…å¥—æœ‰å®Œå¤‡çš„å•å…ƒæµ‹è¯•ä»£ç &lt;&#x2F;li&gt;
&lt;li&gt;ä¸€è‡´çš„ä»£ç é£æ ¼ã€è§„èŒƒã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´ä¸ªç³»ç»Ÿæ›´å…·æœ‰ä¸€è‡´æ€§ã€ç®€å•æ€§ï¼Œä¸ä»…ä»…å¯¹æ™®é€šç”¨æˆ·è€Œè¨€å…·æœ‰æ›´å¥½çš„å¯ç†è§£æ€§ã€å¯ç»´æŠ¤æ€§ï¼Œä¹Ÿä¼šå¯¹ LLM æ¥è¯´ï¼Œæœ‰æ›´å¥½çš„å¯ç†è§£æ€§ï¼Œè¿™å°±ä¼šåœ¨åç»­çš„
Vibe Coding
ä¸­æœ‰åˆ©äº LLM æ›´å¥½çš„å®Œæˆä½ äº¤ä»˜çš„å¼€å‘ä»»åŠ¡ã€‚å› æ­¤ï¼Œæ¶æ„å¸ˆçš„è§’è‰²å°±éœ€è¦æ›´èšç„¦åœ¨æ•´ä¸ªç³»ç»Ÿçš„ç®€å•æ€§ã€æ¸…æ™°æ€§ä¸Šæ¥ï¼Œè¿™ä¸ªå¯¹æ¶æ„å¸ˆæå‡ºäº†æ›´é«˜çš„æŒ‘æˆ˜å’Œè¦æ±‚ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;çœ¼ç•Œï¼šä½ éœ€è¦æœ‰ç†è§£ç®€å•æ€§ã€ä¸€è‡´æ€§çš„èƒ½åŠ›ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å®¡ç¾æ„è¯†ï¼šä½ éœ€è¦æœ‰åˆ¤æ–­ä¼˜ç¾ä¸ä¸‘é™‹ã€ç®€å•ä¸å¤æ‚ã€ä½æ•ˆä¸é«˜æ•ˆçš„èƒ½åŠ›å’Œæ„è¯†&lt;&#x2F;li&gt;
&lt;li&gt;æŠ½è±¡èƒ½åŠ›ï¼šå½“è¯†åˆ«å‡ºå‘³é“åï¼Œæå‡ºæ”¹è¿›æ–¹æ¡ˆçš„èƒ½åŠ›ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;è¿™äº›èƒ½åŠ›æ˜¯æ¶æ„å¸ˆæ‰€ç‹¬æœ‰çš„ç‰¹è´¨ï¼Œå…¶éœ€è¦æ¯ä¸€ä¸ªæ¶æ„å¸ˆæŒç»­çš„å­¦ä¹ ã€å®è·µå’Œæ¢ç´¢ã€‚æ‰€ä»¥ Vibe Coding å³é‡Šæ”¾äº†æ¶æ„å¸ˆçš„æ—¶é—´å’Œç²¾åŠ›ï¼Œä»¥ä¿ƒæˆæ¶æ„å¸ˆæœ‰æ›´å¤šçš„æ—¶é—´æ€è€ƒå’Œæ”¹è¿›
æ¶æ„èƒ½åŠ›ï¼Œå¦ä¸€æ–¹é¢ï¼Œåˆä»¥è¶³å¤Ÿçš„æ‰§è¡ŒåŠ›æ”¯æ’‘æ¶æ„å¸ˆæ›´å¤šçš„åˆ›æ–°ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;6-vibe-coding-kai-fa-de-hu-cheng-he-ji-zhi&quot;&gt;6. Vibe Coding  å¼€å‘çš„æŠ¤åŸæ²³æœºåˆ¶&lt;&#x2F;h2&gt;
&lt;p&gt;åœ¨Vibe Coding å¼€å‘çš„&quot;å¿«é€Ÿè¿­ä»£&quot;è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•ä¿è¯æ–¹æ¡ˆå’Œä»£ç çš„è´¨é‡ï¼Œé¿å…é‡æ„å¸¦æ¥çš„æœªçŸ¥çš„é—®é¢˜ï¼Œä¾‹å¦‚ç ´ç¯ç‰ˆæœ¬å…¼å®¹ç­‰ï¼Œéœ€è¦å»ºç«‹å¤šå±‚æ¬¡çš„æŠ¤åŸæ²³æœºåˆ¶ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æµ‹è¯•ç”¨ä¾‹ä½œä¸ºæŠ¤åŸæ²³: Vibe Coding å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆè¶³å¤Ÿçš„ã€é«˜è´¨é‡çš„æµ‹è¯•ç”¨ä¾‹ã€‚è¿™æ˜¯é‡æ„çš„æœ‰åˆ©ä¿éšœã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä»£ç è¦†ç›–ç‡æµ‹è¯•&lt;&#x2F;li&gt;
&lt;li&gt;lint å·¥å…·æµ‹è¯•ã€‚å¯¹ rust è¿™ç±»çš„è¯­è¨€ï¼Œrustc å’Œ clipper åé¦ˆçš„è­¦å‘Šï¼Œéƒ½è¦äºˆä»¥å…³æ³¨ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;API å…¼å®¹æ€§ä¿è¯ã€‚å½“é‡æ„ä»£ç ï¼Œè€Œæœ‰éœ€è¦ä¿æŒAPIå…¼å®¹æ€§æ—¶ï¼Œå¯ä»¥æä¾›å·¥å…·ï¼Œæ£€æŸ¥é‡æ„å‰åçš„å…¼å®¹æ€§é—®é¢˜ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ claude.md ä¸­æ˜ç¡®è¡¥å……æœ‰å…³çš„åŸåˆ™ï¼šä¾‹å¦‚ï¼Œä»£ç é£æ ¼ã€æœ€ä½³å®è·µã€ä¸å®¹è®¸çš„è¡Œä¸ºç­‰ç­‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å•ä¸€å˜æ›´ï¼šæ¯æ¬¡å¯¹è¯åªæ”¹å˜ä¸€ä¸ªæ˜ç¡®çš„æ–¹é¢ï¼Œé¿å…å¤§å¹…åº¦å˜æ›´ï¼Œä¾¿äºä»£ç è¯„å®¡ã€éªŒè¯ã€å¿«é€Ÿå›æ»šç­‰&lt;&#x2F;li&gt;
&lt;li&gt;äººå·¥æŠŠå…³ï¼šå¯¹AI æäº¤çš„ä»£ç è¿›è¡Œäººå·¥æŠŠå…³ï¼Œå¯¹æ ¸å¿ƒå±‚çš„ä»£ç å˜æ›´ï¼Œæ›´å¯èƒ½éœ€è¦é€è¡Œæ£€æŸ¥ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;è¿™ä¸ªä¹Ÿéå¸¸ç¬¦åˆå¼•æ–‡ä¸­æåˆ°çš„ shift-left æœºåˆ¶ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;er-shi-jian-ji-qiao-yu-fang-fa-lun&quot;&gt;äºŒã€å®è·µæŠ€å·§ä¸æ–¹æ³•è®º&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;â€œä¸€åˆ†é’Ÿç›®æ ‡â€æ³•&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ã€Šä¸€åˆ†é’Ÿç»ç†äººã€‹ä¸€ä¹¦ä¸­ï¼Œâ€œä¸€åˆ†é’Ÿç›®æ ‡â€æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚å…¶å·¥ä½œæ–¹å¼æ˜¯ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ç®¡ç†è€…æ¸…æ™°é™ˆè¿°ç›®æ ‡ â†’&lt;&#x2F;li&gt;
&lt;li&gt;åŒæ–¹å…±åŒæ€è€ƒå¹¶å¤è¿°ç›®æ ‡ä»¥ç¡®ä¿ç†è§£æ— è¯¯ â†’&lt;&#x2F;li&gt;
&lt;li&gt;æœ€ç»ˆè¾¾æˆä¸€è‡´ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;å®ƒå¼ºè°ƒç›®æ ‡å¿…é¡»æ˜¯æ¸…æ™°ã€ç®€æ´ã€å¯è¡¡é‡çš„ï¼Œå¹¶ä¸”èƒ½åœ¨ä¸€åˆ†é’Ÿå†…è¢«å®Œæ•´åœ°é˜…è¯»å’Œç†è§£ã€‚è¿™ä¸ Vibe Coding çš„æ ¸å¿ƒæ€æƒ³é«˜åº¦ä¸€è‡´ï¼šç»™ AI çš„æŒ‡ä»¤ï¼ˆç›®æ ‡ï¼‰
å¿…é¡»ç»è¿‡â€œé™ˆè¿°-æ€è€ƒ-å¤è¿°â€çš„æ‰“ç£¨è¿‡ç¨‹ï¼Œç¡®ä¿å…¶è¶³å¤Ÿæ¸…æ™°ã€å…·ä½“ï¼Œæ‰èƒ½è·å¾—é«˜è´¨é‡çš„äº§å‡ºã€‚æ¨¡ç³Šæˆ–å†—é•¿çš„ç›®æ ‡ä¼šå¯¼è‡´
AI ç”Ÿæˆåç¦»é¢„æœŸçš„ç»“æœã€‚åœ¨ Vibe Coding ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥åƒè®¾å®šâ€œä¸€åˆ†é’Ÿç›®æ ‡â€ä¸€æ ·ï¼Œä¸ AI äº’åŠ¨çš„æ–¹å¼æ¥ç²¾å¿ƒæ‰“ç£¨æˆ‘ä»¬çš„æ¯ä¸€æ­¥æŒ‡ä»¤ï¼Œç¡®ä¿ AI ä¸
æˆ‘ä»¬åˆç›¸åŒçš„ç†è§£åæ‰å¼€å§‹è¡ŒåŠ¨ï¼Œé¿å…æ— æ•ˆçš„æ²Ÿé€šã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æå‡ºæ¸…æ™°çš„ç›®æ ‡ vs æå‡ºå…·ä½“çš„æ“ä½œæŒ‡ä»¤
ç›¸æ¯”å‘ AI å‘å‡ºå…·ä½“çš„æŒ‡ä»¤ï¼š&quot;è¯·ä½¿ç”¨æŸæŸæŠ€æœ¯ï¼Œç”Ÿæˆä»£ç &quot; è¿™æ ·çš„æŒ‡ä»¤ï¼Œæœ‰çš„æ—¶å€™ï¼Œé˜æ˜ç›®æ ‡ï¼Œä½†ä¸é™å®šå…·ä½“çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œè€Œæ˜¯äº¤ç”± LLM æ¥æ€è€ƒï¼Œå¾ˆå¤šæ—¶å€™ï¼Œ
å®ƒå¯èƒ½ä¼šç»™åˆ°æˆ‘ä»¬æ›´å¤šçš„æƒŠå–œï¼šLLM å¯èƒ½ä¼šæä¾›æ›´å¤šçš„ã€æ›´å¥½çš„é€‰æ‹©ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œå–„äºæå‡ºå¼€æ”¾æ€§çš„é—®é¢˜ï¼Œè€Œéå°é—­æ€§çš„é—®é¢˜ï¼Œæœ‰å¯èƒ½æ›´èƒ½å‘æŒ¥ LLM çš„ä»·å€¼ï¼Œä¸ºè‡ªå·±æä¾›æ›´å¤šçš„æŠ€æœ¯é€‰æ‹©ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;TODO è¿™ä¸€èŠ‚å†…å®¹å°†æŒç»­æ›´æ–°ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;san-quan-mian-yong-bao-ai-shi-xian-ye-wu-zhong-gou-cong-xin-xi-hua-mai-xiang-zhi-neng-hua&quot;&gt;ä¸‰ã€ å…¨é¢æ‹¥æŠ± AIï¼Œå®ç°ä¸šåŠ¡é‡æ„ï¼Œä»ä¿¡æ¯åŒ–è¿ˆå‘æ™ºèƒ½åŒ–&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;ye-wu-liu-cheng-quan-mian-aihua&quot;&gt;ä¸šåŠ¡æµç¨‹å…¨é¢AIåŒ–&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å”®å‰é˜¶æ®µ&lt;&#x2F;strong&gt;ï¼šAIè¾…åŠ©éœ€æ±‚åˆ†æå’Œæ–¹æ¡ˆè®¾è®¡&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;è¿ç»´å®¢æœ&lt;&#x2F;strong&gt;ï¼šæ™ºèƒ½åŒ–æ•…éšœè¯Šæ–­å’Œç”¨æˆ·æœåŠ¡&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;å®šåˆ¶å¼€å‘&lt;&#x2F;strong&gt;ï¼šå¿«é€Ÿå“åº”ä¸ªæ€§åŒ–éœ€æ±‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;ä¸šåŠ¡åº”ç”¨&lt;&#x2F;strong&gt;ï¼šæ•°æ®è§£é‡Šã€AIæŠ¥å‘Šç”Ÿæˆ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;chuan-tong-ruan-jian-zhi-de-zai-aishi-dai-zhong-xin-she-ji&quot;&gt;ä¼ ç»Ÿè½¯ä»¶å€¼å¾—åœ¨AIæ—¶ä»£é‡æ–°è®¾è®¡&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥AI-firstçš„æ€è·¯é‡æ–°è®¾è®¡ä¼ ç»Ÿè½¯ä»¶&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ä¸šåŠ¡ä¸­æ·±åº¦åµŒå…¥AIèƒ½åŠ›ï¼Œè€Œéç®€å•çš„åŠŸèƒ½å åŠ &lt;&#x2F;li&gt;
&lt;li&gt;è¿½æ±‚æè‡´çš„ç”¨æˆ·ä½“éªŒè®¾è®¡&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;TODOï¼šæœ¬ç« å†…å®¹å¸¦è¡¥å……&lt;&#x2F;p&gt;
&lt;h1 id=&quot;si-xue-xi-he-cheng-chang-lu-jing-de-zhong-gou&quot;&gt;å››ã€å­¦ä¹ å’Œæˆé•¿è·¯å¾„çš„é‡æ„&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;xue-xi-zhong-xin-zhuan-yi&quot;&gt;å­¦ä¹ é‡å¿ƒè½¬ç§»&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;ä»&quot;å­¦è¯­æ³•â†’å­¦æ¡†æ¶â†’åšé¡¹ç›®&quot;å˜æˆ&quot;å­¦éœ€æ±‚åˆ†æâ†’å­¦ç³»ç»Ÿè®¾è®¡â†’å­¦AIåä½œ&quot;&lt;&#x2F;li&gt;
&lt;li&gt;æ›´æ³¨é‡è·¨é¢†åŸŸçŸ¥è¯†çš„æ•´åˆèƒ½åŠ›&lt;&#x2F;li&gt;
&lt;li&gt;ä»£ç æ‰€æœ‰æƒè§‚å¿µæ·¡åŒ–ï¼Œæ›´å…³æ³¨ç³»ç»Ÿçš„ç›®æ ‡è®¾è®¡ã€æ¶æ„è®¾è®¡ï¼Œæ›´å…³æ³¨ç³»ç»Ÿçš„ç®€å•è¡Œã€ä¼˜ç¾æ€§å’Œä»·å€¼ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;xin-de-xue-xi-fang-fa-gen-zhao-ai-xue-xi-rang-ai-dang-ni-de-lao-shi-he-xue-xi-zhu-shou&quot;&gt;æ–°çš„å­¦ä¹ æ–¹æ³•ï¼šè·Ÿç€ AI å­¦ä¹ ï¼Œè®© AI å½“ä½ çš„è€å¸ˆå’Œå­¦ä¹ åŠ©æ‰‹&lt;&#x2F;h2&gt;
&lt;p&gt;ä½œä¸ºä¸€åæ¶æ„å¸ˆï¼Œä½ å¯èƒ½å·²ç»åœ¨æŸäº›é¢†åŸŸæ‹¥æœ‰äº†æ·±åº¦çš„ç†è§£ã€è®¤çŸ¥ï¼Œåœ¨è¿™äº›æ–¹é¢ï¼Œä½ æ˜¯ masterï¼Œè€Œ AI æ˜¯ä½ çš„ assistantï¼Œä½†åœ¨ä½ ç†Ÿæ‚‰çš„é¢†åŸŸä¹‹å¤–ï¼Œä½ çš„çŸ¥è¯†ã€
èƒ½åŠ›åˆ™å¯èƒ½è¿œé€Šäº LLM äº†ã€‚ä»Šå¤©çš„ LLM å¯èƒ½å·²ç»åœ¨æˆ‘ä»¬æ‰€çŸ¥çš„æ‰€æœ‰é¢†åŸŸéƒ½æ˜¯ä¸€ä¸ªå¥½å­¦ç”Ÿäº†ï¼Œè€Œä½ ï¼Œåˆ™åªæ˜¯åœ¨å¾ˆç‹­çª„çš„å‡ ä¸ªé¢†åŸŸå†…æ“…é•¿ï¼Œå½“ç„¶ï¼Œåœ¨è¿™äº›é¢†åŸŸå†…ï¼Œ
ä½ åº”è¯¥æ¯” AI åšå¾—æ›´å¥½æ‰æ˜¯ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘å®Œå…¨å¯ä»¥é€šè¿‡å‘ AI è¿›è¡Œå‘é—®ï¼Œè®©å…¶å¸®æˆ‘æ•´ç†å‡ºæˆ‘æœ€å…³å¿ƒçš„ä¸€äº›é—®é¢˜çš„ç­”æ¡ˆï¼Œæœ‰çš„æ—¶å€™ï¼Œå°¤å…¶æ˜¯åœ¨ä¸€äº›å…·æœ‰å¯è¿ç§»æ€§çš„é¢†åŸŸï¼Œæ˜¯éå¸¸æœ‰ä»·å€¼çš„ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ¡ˆä¾‹1: æ¯”å¦‚è¯´ï¼Œæˆ‘æ˜¯ä¸€åèµ„æ·±çš„ JavaScript å·¥ç¨‹å¸ˆï¼Œæˆ‘ç°åœ¨éœ€è¦å­¦ä¹  Pythonï¼Œé‚£ä¹ˆï¼Œæˆ‘å¯ä»¥è®© AI å¸®æˆ‘æ•´ç†å‡ºï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;åŸºæœ¬çš„è¯­æ³•ã€æ•°æ®ç±»å‹ã€æ•°æ®ç»“æ„ã€æ§åˆ¶æµå¯¹æ¯”ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é«˜çº§ç‰¹æ€§ï¼šå¦‚åå°„ã€å…ƒç¼–ç¨‹ç­‰å¯¹æ¯”ã€‚
é€šè¿‡å¯¹æ¯”çš„æ–¹å¼ï¼Œæ¥å­¦ä¹ ä¸€é—¨æ–°çš„è¯­è¨€ï¼Œç®€ç›´æ˜¯å¤ªæ–¹ä¾¿äº†ã€‚è¿™ä¸ªæ¡ˆä¾‹å¯ä»¥æŸ¥çœ‹&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;learning-language&#x2F;blob&#x2F;main&#x2F;python-for-javascript&#x2F;src&#x2F;introduction.md&quot;&gt;Python for Javascript Developers&lt;&#x2F;a&gt;
æ–‡æ¡£ï¼Œè¿™æ˜¯æˆ‘é€šè¿‡ AI æ¥ç¼–å†™çš„ä¸€ç¯‡å¯¹æ¯”ä¸¤ç§è¯­è¨€çš„æ–‡æ¡£è¾“å‡ºã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æ¡ˆä¾‹2: åœ¨ medium ä¸Šæœ‰ä¸€ç¯‡å¾ˆå¥½çš„æŠ€æœ¯æ–‡ç« ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@orami98&#x2F;12-revolutionary-web-apis-that-will-replace-your-javascript-libraries-in-2026-bf95b64ce1e3&quot;&gt;12 Revolutionary Web APIs That Will Replace Your JavaScript Libraries in 2026&lt;&#x2F;a&gt;
ä»‹ç»äº†12ä¸ªæ–°çš„ Web APIï¼Œå¯¹äºWEB åº”ç”¨æ¥è¯´ï¼Œäº†è§£æœ€æ–°çš„æµè§ˆå™¨èƒ½åŠ›ï¼Œå¹¶åˆç†çš„åº”ç”¨ï¼Œå¯¹æé«˜æˆ‘ä»¬åº”ç”¨çš„èƒ½åŠ›ï¼Œä»¥åŠç®€åŒ–åº”ç”¨å¼€å‘çš„å¤æ‚æ€§ä¼šå¸¦æ¥å·¨å¤§çš„æ”¹å˜ã€‚
ä½†æ˜¯è¿™ç¯‡æ–‡ç« æœ‰ä¸€ä¸ªç¼ºé™·ï¼šæ²¡æœ‰æä¾›ä¸€ä¸ªæµ‹è¯•ã€éªŒè¯çš„ç¤ºä¾‹ï¼Œå¯¹æˆ‘ä»¬æ¥ç†è§£è¿™äº›API æœ‰ä¸€å®šçš„å›°éš¾ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘å¯ä»¥è¯·æ±‚ AI:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æ®æ–‡ç« å†…å®¹ï¼Œå¯¹æ¯ä¸€ä¸ª APIï¼Œç”Ÿæˆä¸€ä¸ª exampleï¼Œä»¥å¸®åŠ©æˆ‘è¿›è¡Œç†è§£ï¼ˆå¸®åŠ©æˆ‘ä»¬å»ºç«‹å¯¹ API èƒ½åŠ›çš„åŸºæœ¬è®¤çŸ¥ï¼Œå¹¶é€šè¿‡æ¡ˆä¾‹è¾¹æ”¹è¾¹å­¦ï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹æ¯ä¸€ä¸ªAPIï¼Œä¸ºæˆ‘æä¾›å®˜æ–¹çš„æ–‡æ¡£é“¾æ¥ï¼ˆå­¦ä¹ æ–°æŠ€æœ¯çš„æœ€ä½³å®è·µå°±æ˜¯é˜…è¯»å…¶å®˜æ–¹èµ„æ–™ï¼Œæˆ–å¾—ä¸€ä¸ªç›¸å¯¹å®Œæ•´çš„è®¤çŸ¥ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æˆ‘å°†è¿™ä¸ªä¾‹å­æ”¾åˆ°äº† &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;twelve-revolutionary-web-api&quot;&gt;twelve-revolutionary-web-api&lt;&#x2F;a&gt; é¡¹ç›®ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰ AI çš„è¾…åŠ©ï¼Œæˆ‘è¦ç†è§£è¿™12ä¸ª API éœ€è¦èŠ±è´¹çš„æ—¶é—´å¯èƒ½ä¼šå¤šå¾ˆå¤šå€ï¼Œè€Œç°åœ¨ï¼Œæˆ‘çš„å­¦ä¹ æ—¶é—´å°±æ˜¾è‘—é™ä½ï¼Œè€Œä¸”æ•ˆæœè¿˜æ›´å¥½äº†ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;vibecoding-shi-dai-jia-gou-shi-de-gao-du-jiang-jiu-shi-ruan-jian-de-gao-du&quot;&gt;VibeCoding æ—¶ä»£ï¼Œæ¶æ„å¸ˆçš„é«˜åº¦å°†å°±æ˜¯è½¯ä»¶çš„é«˜åº¦&lt;&#x2F;h2&gt;
&lt;p&gt;AI æ—¶ä»£ï¼Œç¨‹åºå‘˜å¯èƒ½æ˜¯æœ€æ—©æ”¶åˆ°å†²å‡»çš„ä¸€ä¸ªè¡Œä¸šï¼Œç›®å‰ï¼Œä¸­å›½çš„ä¸šç•Œæ™®éå­˜åœ¨è¿™æ ·çš„ä¸€äº›è§‚ç‚¹ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;AI æ—¶ä»£ï¼Œç¨‹åºå‘˜çš„å·¥ä½œå°†å¤§éƒ¨ä»½è¢« AI æ›¿ä»£&lt;&#x2F;li&gt;
&lt;li&gt;AI æ—¶ä»£ï¼Œç¨‹åºå‘˜ä¸å†é‡è¦ï¼Œæˆ‘åªéœ€è¦ä¸€ä¸ªäº§å“ç»ç† æˆ–è€… ä¸€ä¸ªä¼šç¼–å†™æç¤ºè¯çš„å·¥ç¨‹å¸ˆ å°±å¯ä»¥äº†ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;åŒ…æ‹¬æˆ‘çš„ä¸€äº›è€å‹ï¼ˆæ¯”è¾ƒèµ„æ·±ï¼‰ï¼Œä¹Ÿå¯¹å¼€å‘è¿™ä¸ªèŒä¸šæ¯”è¾ƒç°å¿ƒï¼Œè§‰å¾—æ²¡æœ‰å‰é€”äº†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æˆ‘ä¸ªäººå…¶å®æœ‰ä¸€äº›ä¸åŒçš„çœ‹æ³•ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ç¡®å®ï¼Œä½æ°´å¹³ç¨‹åºå‘˜ä¼šå—åˆ°è¾ƒå¤§çš„å†²å‡»ï¼Œå› ä¸ºå…¶ä¸ä»…å¯ä»¥è¢« AI æ‰€æ›¿ä»£ï¼Œè€Œä¸” AI çš„æ°´å¹³å·²ç»æ˜¯ä¸­ä¸Šæ¸¸å·¥ç¨‹å¸ˆçš„å¼€å‘æ°´å¹³äº†ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½†è‡³å°‘ç°é˜¶æ®µï¼ˆæœªæ¥æˆ‘ä¹Ÿä¸ç®—å¤ªä¹è§‚ï¼‰ï¼ŒAI çš„ç‰¹å¾ä»ç„¶æ˜¯ï¼šçŸ¥è¯†å¹¿åšï¼Œæ·±åº¦æœ‰é™ï¼ˆå…¶è§£å†³é—®é¢˜çš„æ–¹å¼ä»ç„¶æ˜¯æ¨¡å¼åŒ¹é…ï¼Œåœ¨ä»–è§è¿‡çš„é¢˜å‹ä»¥å†…ï¼‰ã€åˆ›æ–°èƒ½åŠ›å¼±ã€‚
å…¶èƒ½å‘æŒ¥å¤šå¤§çš„ä»·å€¼ï¼Œå®Œå…¨ä¾èµ–äºé©¾é©­è€…çš„è®¤çŸ¥æ°´å¹³ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœä½ ä¸èƒ½å‘ AI æ­£ç¡®çš„æå‡ºé—®é¢˜ï¼ˆæå‡ºæ­£ç¡®çš„é—®é¢˜æœ¬èº«å°±æ˜¯é è¿‘è§£å†³æ–¹æ¡ˆçš„å…³é”®ä¸€æ­¥ï¼‰ï¼ŒAI èƒ½ç»™åˆ°ç­”æ¡ˆä»·å€¼å°±ä¼šæœ‰é™ã€‚è€Œèƒ½æå‡ºæœ‰ä»·å€¼çš„é—®é¢˜ï¼Œè‡ªèº«å°±å–å†³äº
é©¾é©­è€…çš„è§†é‡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ä¸€äº›å¤æ‚çš„åœºæ™¯ä¸‹ï¼ŒAI ä¸€å¼€å§‹ç»™åˆ°çš„è§£å†³æ–¹æ¡ˆå…¶å®ä¹Ÿåªæ˜¯ï¼šå¯ä»¥æ­£ç¡®å·¥ä½œçš„ä¸€ä¸ªåŸå‹ï¼Œå…¶ä½œä¸ºæœ€ç»ˆè½¯ä»¶äº§å“çš„ä¸€éƒ¨ä»½ä¾ç„¶æ˜¯ä¸è¶³å¤Ÿçš„ï¼ˆå¦‚æœä»…ä»…æ˜¯ short time
çš„äº¤ä»˜ç‰©å¯èƒ½æ˜¯è¶³å¤Ÿçš„ï¼‰ï¼Œä½ éœ€è¦å¯¹å…¶è¿›è¡Œ reviewï¼Œå¹¶å¯¹ä¸åˆç†çš„åœ°æ–¹ç»™å‡ºæ¸…æ™°çš„è§£å†³æŒ‡ç¤ºã€‚è¿™ä¸ªæ—¶å€™ï¼Œä½ çš„åˆ¤æ–­åŠ›ã€å®¡ç¾è§‚å°±æ˜¯å…³é”®ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æˆ‘ä¸ªäººçš„è§‚ç‚¹ï¼šå¦‚æœä½ çš„èƒ½åŠ›æ˜¯80åˆ†ï¼Œé‚£ä¹ˆ AI çš„å¤©èŠ±æ¿å°±æ˜¯ 80åˆ†ï¼Œè€Œå¦‚æœä½ çš„èƒ½åŠ›æ˜¯90åˆ†ï¼Œé‚£ä¹ˆ AI çš„èƒ½åŠ›ä¹Ÿä¼šæ˜¾è‘—æå‡ã€‚å®é™…ä¸Šï¼Œæ¶æ„å¸ˆå’Œæ¶æ„å¸ˆçš„å·®è·
å¾€å¾€ä¸æ˜¯ç™¾åˆ†æ¯”çš„å·®è·ï¼Œè€Œæ˜¯æˆå€ã€æˆçº§æ•°çš„å·®åˆ«ã€‚ä¼ ç»Ÿçš„ç¼–ç¨‹æ—¶ä»£ï¼Œä¸€ä¸ªä¼˜ç§€çš„å·¥ç¨‹å¸ˆæŠµå¾—ä¸Š10ä¸ªåˆ°100ä¸ªå¹³åº¸çš„å·¥ç¨‹å¸ˆï¼ŒAI æ—¶ä»£ï¼Œè¿™ä¸ªå·®è·åªä¼šæ›´å¤§ï¼šå› ä¸ºç°åœ¨
æˆ‘ä»¬çœŸçš„åªéœ€è¦æ€è€ƒï¼Œè€Œä¸éœ€è¦èŠ±å¤ªå¤šçš„æ—¶é—´æ•²ä»£ç äº†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¯¹ä¸­å›½çš„è½¯ä»¶ä¸šè€Œè¨€ï¼Œæˆ‘è§‰å¾—ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–°çš„æœºä¼šã€‚ä¸­å›½çš„è½¯ä»¶ä¸šï¼Œå°¤å…¶æ˜¯åº”ç”¨è½¯ä»¶ï¼Œåœ¨è¿‡å¾€çš„é«˜é€Ÿå‘å±•ä¸­ï¼Œäº«å—äº†ä¸­å›½é«˜é€Ÿå‘å±•çš„çº¢åˆ©æœŸï¼Œé‡å•†ä¸šæ¨¡å¼ï¼Œè½»æŠ€æœ¯å†…æ¶µï¼Œåœ¨ä½æ°´å¹³çš„
æŠ€æœ¯å±‚é¢ç–¯ç‹‚å†…å·ï¼Œä½¿ç”¨å»‰ä»·çš„åŠ³åŠ¨åŠ›ï¼ˆä»…ä»…æ˜¯ç›¸å¯¹æ¬§ç¾ï¼‰ï¼Œå’Œ 996 çš„ç¦æŠ¥ä½“ç³»ï¼Œé‡æˆ˜æœ¯åŠªåŠ›ï¼ˆè¯´çš„å¥½å¬æ˜¯é«˜é€Ÿè¿­ä»£ï¼‰ï¼Œè½»æˆ˜ç•¥æŠ•å…¥ï¼ˆæ²¡æœ‰è‡ªå·±çš„æ ¸å¿ƒæŠ€æœ¯ï¼‰ï¼Œæ›´
æ¼”è¿›äº†å¥‡è‘©çš„35å²å°±å¤±ä¸šçš„èŒåœºæ½œè§„åˆ™ï¼Œç å†œç¡®å®æ˜¯è´§çœŸä»·å®çš„ç‰›é©¬ã€å†œæ°‘ã€‚åœ¨é«˜é€Ÿå‘å±•çº¢åˆ©ä¸å†ï¼Œä¼ä¸šéœ€ç”±é‡é‡æ”¹å‘é‡è´¨ï¼Œéœ€è¦å»ºç«‹è‡ªå·±çš„æ ¸å¿ƒæŠ€æœ¯ä»·å€¼ä¹‹æ—¶ï¼Œå†
åŠ ä¸Š AI çš„çªç ´æ€§å‘å±•ï¼Œæˆ‘è§‰å¾—ä¸€å®šä¼šå‘ç”Ÿå…ˆæ­»è€Œåç”Ÿçš„è½¬å˜ç‚¹ã€‚ï¼ˆæ— å¥ˆåæ§½ä¸­ï¼‰&lt;&#x2F;p&gt;
&lt;h1 id=&quot;misc&quot;&gt;Misc&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;vibe-coding-de-bian-cheng-yu-yan-bian-cheng-fan-shi-xuan-ze&quot;&gt;Vibe Coding çš„ç¼–ç¨‹è¯­è¨€ã€ç¼–ç¨‹èŒƒå¼é€‰æ‹©&lt;&#x2F;h2&gt;
&lt;p&gt;äº’è”ç½‘ä¸Šå…³äº AI æ—¶ä»£çš„æœ€ä½³ç¼–ç¨‹è¯­è¨€ï¼Œå·²ç»æœ‰å¾ˆå¤šçš„äº‰è®ºäº†ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;solmaz.io&#x2F;typed-languages-are-better-suited-for-vibecoding&quot;&gt;Typed language are better for vibecoding&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;DVxaQQqrFb6Vl3himVnAfg&quot;&gt;Shift-Left å¼ç¼–ç¨‹è¯­è¨€ï¼ˆRustï¼‰æ˜¯ AI è‡ªåŠ¨ç¼–ç çš„æœ€ä½³è¯­è¨€&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dev.to&#x2F;szabgab&#x2F;what-is-shift-left-programming-5601&quot;&gt;What is shift-left â¬…ï¸ programming?&lt;&#x2F;a&gt;  åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä½œè€…ä»‹ç»äº†
shift-left
çš„æ¦‚å¿µï¼šåœ¨å¼€å‘çš„å°½æ—©é˜¶æ®µï¼ˆç¼–ç é˜¶æ®µã€ç¼–è¯‘é˜¶æ®µã€å•å…ƒæµ‹è¯•é˜¶æ®µ ...ï¼‰è¶Šæ—©ä¿è¯è´¨é‡çš„ç¼–ç¨‹è¯­è¨€ï¼Œå°±æ˜¯
shift-leftï¼Œè¿™ä¸æˆ‘ä»¬ä¼ ç»Ÿçš„â€œæµ‹è¯•å·¦ç§»â€çš„ç†å¿µæ˜¯ä¸€è‡´çš„ï¼Œ
åªæ˜¯èµ°å¾—æ›´è¿œä¸€äº›ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å¼ºç±»å‹ç¼–ç¨‹ç›¸æ¯”åŠ¨æ€ç±»å‹è¯­è¨€å¯ä»¥åœ¨ç¼–è¯‘æ—¶å‘ç°å°½å¯èƒ½çš„é—®é¢˜ï¼Œåè€…åˆ™æ›´ä¾èµ–äºè¿è¡Œæ—¶ã€‚ï¼ˆå½“ç„¶è¶³å¤Ÿçš„ unit testing å¯ä»¥ä½œä¸º
shift-left çš„æ‰‹æ®µï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;ç±»ä¼¼äº Rust è¿™æ ·çš„å¼ºè¯­ä¹‰è¯­è¨€ï¼Œå¯ä»¥é¿å…ç±»å‹å®‰å…¨ã€å†…å­˜å®‰å…¨ã€å¹¶å‘å®‰å…¨ã€é”™è¯¯å¤„ç†ç­‰é—®é¢˜ï¼Œè¿‘ä¹è¾¾åˆ°ç¼–è¯‘é€šè¿‡å³æ­£ç¡®è¿è¡Œã€‚&lt;&#x2F;li&gt;
&lt;li&gt;TDD&#x2F;unit testing ç›¸æ¯”ç»§æ‰¿æµ‹è¯•ã€UATæµ‹è¯•æœ‰æ›´ä½çš„æˆæœ¬ï¼Œæ”¯æŒæ›´é¢‘ç¹çš„é‡æ„å’Œè¿­ä»£ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;ç„¶è€Œï¼Œrust åœ¨æŸäº›é¢†åŸŸçš„è¯­ä¹‰å¤æ‚æ€§ä¹Ÿè®¸ä¼šç»™ AI å¸¦æ¥å¾ˆå¤§çš„æŒ‘æˆ˜ï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°å¤æ‚çš„ç”Ÿå‘½å‘¨æœŸã€ç±»å‹ç³»ç»Ÿæ—¶ï¼Œå“ªäº›è®©è‡ªèº«ç”¨æˆ·éƒ½æ™•å¤´è½¬å‘çš„ç±»å‹ä½“æ“ï¼Œå¾ˆå¤§å¯èƒ½
ä¼šè®© LLM ä¸çŸ¥æ‰€ä»ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Explicit is better than implicit
ä½¿ç”¨äº†è¾ƒå¤šéšå¼é£æ ¼çš„ç¼–ç¨‹è¯­è¨€ï¼ŒAI ç†è§£æ—¶ä¼šå¸¦å…¥è¾ƒå¤šçš„æ¨æ–­ï¼Œé˜…è¯»ä»£ç ï¼Œå®¹æ˜“äº§ç”Ÿé”™è¯¯ï¼Œç”Ÿæˆä»£ç æ—¶åˆ™å¯èƒ½äº§ç”Ÿæ­§ä¹‰ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;AI çš„ç†è§£èƒ½åŠ›è™½ç„¶å¼ºå¤§ï¼Œä½†å…¶æ¨ç†æ˜¯åŸºäºæ¦‚ç‡å’Œæ¨¡å¼åŒ¹é…çš„ã€‚éšå¼çš„è¡Œä¸ºï¼ˆå¦‚ Python çš„ &lt;strong&gt;magic&lt;&#x2F;strong&gt; æ–¹æ³•ã€JavaScript
çš„ç±»å‹å¼ºåˆ¶è½¬æ¢ã€æˆ–ä¾èµ–ä¸Šä¸‹æ–‡çš„é»˜è®¤å‚æ•°ï¼‰
ä¼šå¢åŠ  AI ç†è§£æ„å›¾çš„éš¾åº¦ï¼Œå®¹æ˜“å¯¼è‡´ç”Ÿæˆçš„ä»£ç ä¸ç¬¦åˆé¢„æœŸã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;concise vs verbose&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;functional vs imperative&lt;&#x2F;p&gt;
&lt;p&gt;å‡½æ•°å¼çš„é£æ ¼å¤©ç„¶å¥‘åˆ AIï¼šï¼ˆç”šè‡³äºè¿™ä¹Ÿéå¸¸åŒ¹é…ç¤¾ä¼šçš„åˆ†å·¥æ¨¡å¼ï¼šå®¢æˆ·æå‡ºéœ€æ±‚ï¼Œä¾›åº”å•†è´Ÿè´£å®ç°ï¼Œé¢†å¯¼ç»™å‡ºç›®æ ‡ï¼Œå‘˜å·¥è´Ÿè´£å®ç°ï¼‰&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Vibe Coding è‡ªèº«æ›´å€¾å‘äºåˆ†å·¥ï¼šäººè´Ÿè´£å®šä¹‰ç›®æ ‡ï¼ŒAI è´Ÿè´£å®ç°ç›®æ ‡ã€‚ å½“æˆ‘ä»¬ç»™å‡ºå…·ä½“çš„å®ç°è¿‡ç¨‹æè¿°æ—¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯¹äººæ¥è¯´ä½æ•ˆçš„è¿‡ç¨‹ï¼Œè€Œä¸”å¯èƒ½é™åˆ¶äº†
AI çš„é€‰æ‹©ã€‚æ­¤å¤–ï¼Œå¤æ‚çš„è¿‡ç¨‹æè¿°å¢åŠ äº† AI ç†è§£ä½ çš„â€œæ„å›¾â€çš„è´Ÿæ‹…ï¼Œå¯¼è‡´åœ¨ç»†èŠ‚ä¸Šå‡ºé”™ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é™åˆ¶å‰¯ä½œç”¨ï¼Œæ¸…æ™°çš„æ•°æ®æµï¼Œå¯ä»¥è®© AI ç”Ÿæˆçš„ä»£ç æ›´ç®€çŸ­ã€æ˜“äºç†è§£ï¼Œæ˜“äºéªŒè¯ï¼Œ&lt;&#x2F;li&gt;
&lt;li&gt;æ›´æ˜“äºåˆ†è§£ã€ç»„åˆï¼Œå®ç°ä»£ç å¤ç”¨ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;gua-he-vibe-coding-de-ren-wu-lei-xing&quot;&gt;é€‚åˆ Vibe Coding çš„ä»»åŠ¡ç±»å‹&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;ä¿®å¤å±€éƒ¨çš„ä»£ç  Bug ï¼ˆå®‰å…¨æ¼æ´ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;tbc&quot;&gt;TBC&lt;&#x2F;h1&gt;
&lt;p&gt;æœ¬æ–‡ç›®å‰å¤„äºé…é…¿é˜¶æ®µï¼Œä¼šæŒç»­è¿›è¡Œè¿½åŠ ã€ä¿®æ”¹ï¼Œç›´è‡³å®šç¨¿ã€‚&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>vega, d3, echart 3ä¸ªç»˜å›¾å·¥å…·å¯¹æ¯”</title>
        <published>2025-08-14T00:00:00+00:00</published>
        <updated>2025-08-14T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/compare-vega-d3-echart/"/>
        <id>https://wangzaixiang.github.io/blog/compare-vega-d3-echart/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/compare-vega-d3-echart/">&lt;h1 id=&quot;compare-by-case&quot;&gt;Compare by Case&lt;&#x2F;h1&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;compare-vega-d3-echart&#x2F;img.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;d3-bar-chart&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;observablehq.com&#x2F;@d3&#x2F;bar-chart&#x2F;2#chart&quot;&gt;D3 bar-chart&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;chart &lt;&#x2F;span&gt;&lt;span&gt;= {
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Declare the chart dimensions and margins.
&lt;&#x2F;span&gt;&lt;span&gt;  const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;width &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;928&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;height &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;500&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;marginTop &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;30&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;marginRight &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;marginBottom &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;30&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;marginLeft &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;40&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Declare the x (horizontal position) scale.
&lt;&#x2F;span&gt;&lt;span&gt;  const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;x &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;d3&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;scaleBand&lt;&#x2F;span&gt;&lt;span&gt;()
&lt;&#x2F;span&gt;&lt;span&gt;      .domain(d3.groupSort(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;data&lt;&#x2F;span&gt;&lt;span&gt;, ([&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;d&lt;&#x2F;span&gt;&lt;span&gt;]) =&amp;gt; -d.frequency, (d) =&amp;gt; d.letter)) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; descending frequency
&lt;&#x2F;span&gt;&lt;span&gt;      .range([&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;marginLeft&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;width &lt;&#x2F;span&gt;&lt;span&gt;- &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;marginRight&lt;&#x2F;span&gt;&lt;span&gt;])
&lt;&#x2F;span&gt;&lt;span&gt;      .padding(0.1);
&lt;&#x2F;span&gt;&lt;span&gt;  
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Declare the y (vertical position) scale.
&lt;&#x2F;span&gt;&lt;span&gt;  const y = d3.scaleLinear()
&lt;&#x2F;span&gt;&lt;span&gt;      .domain([&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;d3&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;max&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;data&lt;&#x2F;span&gt;&lt;span&gt;, (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;d&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;d&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;frequency&lt;&#x2F;span&gt;&lt;span&gt;)])
&lt;&#x2F;span&gt;&lt;span&gt;      .range([&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;height &lt;&#x2F;span&gt;&lt;span&gt;- &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;marginBottom&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;marginTop&lt;&#x2F;span&gt;&lt;span&gt;]);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Create the SVG container.
&lt;&#x2F;span&gt;&lt;span&gt;  const svg = d3.create(&amp;quot;svg&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;      .attr(&amp;quot;width&amp;quot;, width)
&lt;&#x2F;span&gt;&lt;span&gt;      .attr(&amp;quot;height&amp;quot;, height)
&lt;&#x2F;span&gt;&lt;span&gt;      .attr(&amp;quot;viewBox&amp;quot;, [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;width&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;height&lt;&#x2F;span&gt;&lt;span&gt;])
&lt;&#x2F;span&gt;&lt;span&gt;      .attr(&amp;quot;style&amp;quot;, &amp;quot;max-width: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100&lt;&#x2F;span&gt;&lt;span&gt;%; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;height&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;auto&lt;&#x2F;span&gt;&lt;span&gt;;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;)&lt;&#x2F;span&gt;&lt;span style=&quot;background-color:#bf616a;color:#2b303b;&quot;&gt;;&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Add a rect for each bar.
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;svg&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;append&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;g&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;      .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;attr&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;fill&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;steelblue&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;selectAll&lt;&#x2F;span&gt;&lt;span&gt;()
&lt;&#x2F;span&gt;&lt;span&gt;    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;data&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;data&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;join&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;rect&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;      .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;attr&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;d&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;d&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;letter&lt;&#x2F;span&gt;&lt;span&gt;))
&lt;&#x2F;span&gt;&lt;span&gt;      .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;attr&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;d&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;d&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;frequency&lt;&#x2F;span&gt;&lt;span&gt;))
&lt;&#x2F;span&gt;&lt;span&gt;      .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;attr&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;height&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;d&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;) - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;d&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;frequency&lt;&#x2F;span&gt;&lt;span&gt;))
&lt;&#x2F;span&gt;&lt;span&gt;      .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;attr&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;width&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;bandwidth&lt;&#x2F;span&gt;&lt;span&gt;());
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Add the x-axis and label.
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;svg&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;append&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;g&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;      .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;attr&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;transform&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, `&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;translate(0,${&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;height &lt;&#x2F;span&gt;&lt;span&gt;- &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;marginBottom&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;})&lt;&#x2F;span&gt;&lt;span&gt;`)
&lt;&#x2F;span&gt;&lt;span&gt;      .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;call&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;d3&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;axisBottom&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span&gt;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;tickSizeOuter&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;));
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Add the y-axis and label, and remove the domain line.
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;svg&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;append&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;g&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;      .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;attr&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;transform&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, `&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;translate(${&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;marginLeft&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;},0)&lt;&#x2F;span&gt;&lt;span&gt;`)
&lt;&#x2F;span&gt;&lt;span&gt;      .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;call&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;d3&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;axisLeft&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span&gt;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;tickFormat&lt;&#x2F;span&gt;&lt;span&gt;((&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;y &lt;&#x2F;span&gt;&lt;span&gt;* &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100&lt;&#x2F;span&gt;&lt;span&gt;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;toFixed&lt;&#x2F;span&gt;&lt;span&gt;()))
&lt;&#x2F;span&gt;&lt;span&gt;      .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;call&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;g &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;g&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;.domain&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;remove&lt;&#x2F;span&gt;&lt;span&gt;())
&lt;&#x2F;span&gt;&lt;span&gt;      .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;call&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;g &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;g&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;append&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;text&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;          .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;attr&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;marginLeft&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;          .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;attr&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;          .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;attr&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;fill&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;currentColor&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;          .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;attr&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;text-anchor&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;start&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;          .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;text&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;â†‘ Frequency (%)&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;));
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Return the SVG element.
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;return svg&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;node&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;d3-observable-plot-api&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;observablehq.com&#x2F;@d3&#x2F;bar-chart&#x2F;2#cell-546&quot;&gt;D3 Observable Plot API&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Plot&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;plot&lt;&#x2F;span&gt;&lt;span&gt;({
&lt;&#x2F;span&gt;&lt;span&gt;  y: {percent: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span&gt;},
&lt;&#x2F;span&gt;&lt;span&gt;  marks: [
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Plot&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;barY&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;data&lt;&#x2F;span&gt;&lt;span&gt;, {x: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;letter&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, y: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;frequency&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, fill: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;steelblue&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, sort: {x: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;-y&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;}}),
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Plot&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;ruleY&lt;&#x2F;span&gt;&lt;span&gt;([&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;])
&lt;&#x2F;span&gt;&lt;span&gt;  ]
&lt;&#x2F;span&gt;&lt;span&gt;})
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;vega-bar&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;vega.github.io&#x2F;vega&#x2F;examples&#x2F;bar-chart&#x2F;&quot;&gt;Vega bar&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;json&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-json &quot;&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;$schema&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;https:&#x2F;&#x2F;vega.github.io&#x2F;schema&#x2F;vega&#x2F;v6.json&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;description&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;A basic bar chart example, with value labels shown upon pointer hover.&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;width&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;400&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;height&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;200&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;padding&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;data&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [
&lt;&#x2F;span&gt;&lt;span&gt;    {
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;table&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;values&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [
&lt;&#x2F;span&gt;&lt;span&gt;        {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;category&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;A&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;amount&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;28&lt;&#x2F;span&gt;&lt;span&gt;},
&lt;&#x2F;span&gt;&lt;span&gt;        {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;category&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;B&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;amount&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;55&lt;&#x2F;span&gt;&lt;span&gt;},
&lt;&#x2F;span&gt;&lt;span&gt;        {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;category&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;C&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;amount&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;43&lt;&#x2F;span&gt;&lt;span&gt;},
&lt;&#x2F;span&gt;&lt;span&gt;        {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;category&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;D&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;amount&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;91&lt;&#x2F;span&gt;&lt;span&gt;},
&lt;&#x2F;span&gt;&lt;span&gt;        {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;category&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;E&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;amount&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;81&lt;&#x2F;span&gt;&lt;span&gt;},
&lt;&#x2F;span&gt;&lt;span&gt;        {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;category&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;F&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;amount&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;53&lt;&#x2F;span&gt;&lt;span&gt;},
&lt;&#x2F;span&gt;&lt;span&gt;        {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;category&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;G&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;amount&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;19&lt;&#x2F;span&gt;&lt;span&gt;},
&lt;&#x2F;span&gt;&lt;span&gt;        {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;category&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;H&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;amount&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;87&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;      ]
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;  ],
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;signals&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [
&lt;&#x2F;span&gt;&lt;span&gt;    {
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;tooltip&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {},
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;on&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [
&lt;&#x2F;span&gt;&lt;span&gt;        {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;events&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;rect:pointerover&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;update&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;datum&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;events&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;rect:pointerout&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;update&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;{}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;      ]
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;  ],
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;scales&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [
&lt;&#x2F;span&gt;&lt;span&gt;    {
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;xscale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;type&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;band&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;domain&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;data&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;table&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;field&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;category&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;range&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;width&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;padding&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0.05&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;round&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true
&lt;&#x2F;span&gt;&lt;span&gt;    },
&lt;&#x2F;span&gt;&lt;span&gt;    {
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;yscale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;domain&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;data&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;table&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;field&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;amount&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nice&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;range&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;height&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;  ],
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;axes&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [
&lt;&#x2F;span&gt;&lt;span&gt;    { &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;orient&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;bottom&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;scale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;xscale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; },
&lt;&#x2F;span&gt;&lt;span&gt;    { &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;orient&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;left&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;scale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;yscale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; }
&lt;&#x2F;span&gt;&lt;span&gt;  ],
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;marks&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [
&lt;&#x2F;span&gt;&lt;span&gt;    {
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;type&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;rect&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;data&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;table&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;encode&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;enter&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {
&lt;&#x2F;span&gt;&lt;span&gt;          &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;scale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;xscale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;field&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;category&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;          &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;width&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;scale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;xscale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;band&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;},
&lt;&#x2F;span&gt;&lt;span&gt;          &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;scale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;yscale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;field&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;amount&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;          &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;y2&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;scale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;yscale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;        },
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;update&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {
&lt;&#x2F;span&gt;&lt;span&gt;          &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;fill&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;steelblue&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;        },
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;hover&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {
&lt;&#x2F;span&gt;&lt;span&gt;          &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;fill&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;red&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;      }
&lt;&#x2F;span&gt;&lt;span&gt;    },
&lt;&#x2F;span&gt;&lt;span&gt;    {
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;type&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;text&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;encode&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;enter&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {
&lt;&#x2F;span&gt;&lt;span&gt;          &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;align&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;center&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;          &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;baseline&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;bottom&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;          &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;fill&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;#333&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;        },
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;update&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {
&lt;&#x2F;span&gt;&lt;span&gt;          &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;scale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;xscale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;signal&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;tooltip.category&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;band&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0.5&lt;&#x2F;span&gt;&lt;span&gt;},
&lt;&#x2F;span&gt;&lt;span&gt;          &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;scale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;yscale&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;signal&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;tooltip.amount&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;offset&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;-2&lt;&#x2F;span&gt;&lt;span&gt;},
&lt;&#x2F;span&gt;&lt;span&gt;          &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;text&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;signal&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;tooltip.amount&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;          &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;fillOpacity&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [
&lt;&#x2F;span&gt;&lt;span&gt;            {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;test&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;datum === tooltip&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;},
&lt;&#x2F;span&gt;&lt;span&gt;            {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;          ]
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;      }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;  ]
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;vega-lite&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;vega.github.io&#x2F;vega-lite&#x2F;examples&#x2F;bar.html&quot;&gt;Vega Lite&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;json&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-json &quot;&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;$schema&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;https:&#x2F;&#x2F;vega.github.io&#x2F;schema&#x2F;vega-lite&#x2F;v6.json&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;description&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;A simple bar chart with embedded data.&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;data&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;values&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [
&lt;&#x2F;span&gt;&lt;span&gt;      {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;a&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;A&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;28&lt;&#x2F;span&gt;&lt;span&gt;}, {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;a&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;B&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;55&lt;&#x2F;span&gt;&lt;span&gt;}, {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;a&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;C&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;43&lt;&#x2F;span&gt;&lt;span&gt;},
&lt;&#x2F;span&gt;&lt;span&gt;      {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;a&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;D&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;91&lt;&#x2F;span&gt;&lt;span&gt;}, {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;a&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;E&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;81&lt;&#x2F;span&gt;&lt;span&gt;}, {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;a&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;F&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;53&lt;&#x2F;span&gt;&lt;span&gt;},
&lt;&#x2F;span&gt;&lt;span&gt;      {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;a&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;G&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;19&lt;&#x2F;span&gt;&lt;span&gt;}, {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;a&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;H&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;87&lt;&#x2F;span&gt;&lt;span&gt;}, {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;a&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;I&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;52&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;    ]
&lt;&#x2F;span&gt;&lt;span&gt;  },
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;mark&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;bar&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;encoding&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;field&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;a&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;type&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nominal&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;axis&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;labelAngle&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;}},
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;field&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;type&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;quantitative&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;  }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;echat&quot;&gt;EChat&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;option &lt;&#x2F;span&gt;&lt;span&gt;= {
&lt;&#x2F;span&gt;&lt;span&gt;  xAxis: {
&lt;&#x2F;span&gt;&lt;span&gt;    type: &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;category&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;,
&lt;&#x2F;span&gt;&lt;span&gt;    data: [&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Mon&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Tue&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Wed&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Thu&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Fri&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Sat&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Sun&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;]
&lt;&#x2F;span&gt;&lt;span&gt;  },
&lt;&#x2F;span&gt;&lt;span&gt;  yAxis: {
&lt;&#x2F;span&gt;&lt;span&gt;    type: &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;
&lt;&#x2F;span&gt;&lt;span&gt;  },
&lt;&#x2F;span&gt;&lt;span&gt;  series: [
&lt;&#x2F;span&gt;&lt;span&gt;    {
&lt;&#x2F;span&gt;&lt;span&gt;      data: [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;120&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;200&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;150&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;80&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;70&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;110&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;130&lt;&#x2F;span&gt;&lt;span&gt;],
&lt;&#x2F;span&gt;&lt;span&gt;      type: &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;bar&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;  ]
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;performance-compare&quot;&gt;Performance Compare&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨è¿™ä¸ª&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;compare-chart&quot;&gt;é¡¹ç›®&lt;&#x2F;a&gt;ä¸­ï¼Œæˆ‘å¯¹è¿™3ä¸ªæ¡†æ¶, åŸºäº Stacked Area Chart è¿›è¡Œäº†ä¸€ä¸ªç®€å•çš„æ€§èƒ½å¯¹æ¯”(36,600ä¸ªæ•°æ®ç‚¹)ï¼š
å¯¹æ¯”ç»“æœï¼š
&lt;img src=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;compare-chart&#x2F;raw&#x2F;main&#x2F;doc&#x2F;result_safari.png&quot; alt=&quot;Safari Results&quot; &#x2F;&gt;
&lt;img src=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;compare-chart&#x2F;raw&#x2F;main&#x2F;doc&#x2F;result_chrome.png&quot; alt=&quot;Chrome Results&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨ Stacked Area Chart è¿™ä¸ªåœºæ™¯ä¸­, Vega(åŸºäºCanvas) ç•¥ä¼˜äº D3(åŸºäºsvg)ï¼Œè¿œä¼˜äº Echart(~16x fast)ã€‚æˆ‘ä¹‹å‰æœ‰ä¸€ä¸ªæ‹…å¿ƒï¼šVegaé‡‡ç”¨ Reactive Dataflow graph
çš„æ–¹å¼æ˜¯å¦ä¼šå­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œé€šè¿‡è¿™ä¸ªæµ‹è¯•ï¼Œæ¶ˆé™¤äº†æˆ‘çš„è¿™ä¸ªæ‹…å¿ƒã€‚å®Œå…¨å¯ä»¥æ”¾å¿ƒçš„å°† reactive dataflow è¿™ç§æ¨¡å¼æ¨å¹¿åº”ç”¨åˆ°æ›´å¤šçš„ UI é¢†åŸŸ&lt;&#x2F;p&gt;
&lt;p&gt;æˆ‘åœ¨æ€è€ƒåº”ç”¨äº low code è¿™ä¸€ç±»çš„ åº”ç”¨ä¸­ï¼ŒåŸºäºå£°æ˜å¼çš„æ–¹å¼æ¥æè¿° UI çš„äº¤äº’è¡Œä¸ºï¼Œä»è€Œé¿å…å¼•å…¥å¤æ‚çš„è„šæœ¬ï¼Œåœ¨å¸¦æ¥å¼ºè¡¨è¾¾èƒ½åŠ›çš„åŒæ—¶ï¼Œå¹³è¡¡é…ç½®çš„ç®€å•æ€§ã€è®¾è®¡æ—¶çš„å¯è§†åŒ–ã€å·¥å…·åŒ–èƒ½åŠ›ã€‚å¸Œæœ›åç»­æœ‰æœºä¼šèƒ½å¤Ÿè½åœ°&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Aug 2025</title>
        <published>2025-08-07T00:00:00+00:00</published>
        <updated>2025-08-07T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2025-08/"/>
        <id>https://wangzaixiang.github.io/monthly/2025-08/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2025-08/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;vale.dev&quot;&gt;Another Easy, Fast, Safe Langauge&lt;&#x2F;a&gt;
åˆä¸€é—¨é‡å¿ƒå‹ƒå‹ƒçš„ç¼–ç¨‹è¯­è¨€ï¼Œèƒ½å¤ŸåŒæ—¶åœ¨ easy, safe, fast ä¸Šè·å¾—å¹³è¡¡ã€‚å…¶ä¸­çš„ generational reference æ¦‚å¿µç¡®å®å¾ˆæœ‰åˆ›æ„
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;verdagon.dev&#x2F;blog&#x2F;generational-references&quot;&gt;Vale&#x27;s Memory Safety Strategy: Generational References and Regions&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;Mpp &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;web-frontend&quot;&gt;Web &amp;amp; Frontend&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;browser.engineering&#x2F;index.html&quot;&gt;Web Browser Engineering&lt;&#x2F;a&gt; ä»‹ç» Browser åŸç†çš„å¥½èµ„æ–™ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;ai-agent&quot;&gt;AI &amp;amp; Agent&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.anthropic.com&#x2F;engineering&#x2F;multi-agent-research-system&quot;&gt;How we built our multi-agent research system&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;1928636720796136414&quot;&gt;Multi-Agent Systemï¼Œä¸€ç¯‡å°±å¤Ÿäº†&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;æ¨¡å¼
&lt;ul&gt;
&lt;li&gt;Plan - Executor(think-act-observe)&lt;&#x2F;li&gt;
&lt;li&gt;PDCA&lt;&#x2F;li&gt;
&lt;li&gt;ä¸»æ™ºèƒ½ä½“ï¼šè°ƒåº¦ã€å…¨å±€æ€ç»´ã€æ¢ç´¢ä¸åŒè·¯å¾„ã€èšç„¦æ•´ä½“ç›®æ ‡&lt;&#x2F;li&gt;
&lt;li&gt;å­æ™ºèƒ½ä½“ï¼šæ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡çª—å£ã€å·¥å…·é›†å’Œç›¸å¯¹å…·ä½“çš„ä»»åŠ¡ç›®æ ‡ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;TestCase
&lt;ul&gt;
&lt;li&gt;å°é—­ç›®æ ‡&lt;&#x2F;li&gt;
&lt;li&gt;å¼€æ”¾ç›®æ ‡ï¼šä½¿ç”¨ LLM ä½œä¸ºè£å†³è€…&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;æœç´¢å³å‹ç¼©ã€å‹ç¼©å³æ™ºèƒ½
&lt;ul&gt;
&lt;li&gt;å­æ™ºèƒ½ä½“ï¼šæ¶ˆåŒ–å¤§é‡åŸå§‹çŸ¥è¯†ï¼Œæç‚¼å‡ºå‹ç¼©åçš„æ´è§ï¼Œäº¤ç»™ä¸»æ™ºèƒ½ä½“è¿›è¡Œæç‚¼ã€‚
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;monthly&#x2F;2025-08&#x2F;img.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;misc&quot;&gt;Misc&lt;&#x2F;h1&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Jul 2025</title>
        <published>2025-07-07T00:00:00+00:00</published>
        <updated>2025-07-07T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2025-07/"/>
        <id>https://wangzaixiang.github.io/monthly/2025-07/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2025-07/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;rust
&lt;ul&gt;
&lt;li&gt;[https:&#x2F;&#x2F;sharnoff.io&#x2F;blog&#x2F;why-rust-compiler-slow](Why is the Rust compiler so slow?)
&lt;ul&gt;
&lt;li&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;monthly&#x2F;2025-07&#x2F;img.png&quot; alt=&quot;cargo build --timings&quot; &#x2F;&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;monthly&#x2F;2025-07&#x2F;img_1.png&quot; alt=&quot;opt-level&quot; &#x2F;&gt;&lt;&#x2F;li&gt;
&lt;li&gt;debug , LTO, optimization&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;RUSTFLAGS=&quot;-Cllvm-args=-inline-threshold=50 -Cllvm-args=-inlinedefault-threshold=50 -Cllvm-args=-inlinehint-threshold=50&quot;&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Reducing inlining with LLVM args;&lt;&#x2F;li&gt;
&lt;li&gt;Breaking up expensive functions in the main crate; and&lt;&#x2F;li&gt;
&lt;li&gt;Removing generics from dependencies to prevent needing to compile it in the main crate
Timeline:&lt;&#x2F;li&gt;
&lt;li&gt;We started at ~175s&lt;&#x2F;li&gt;
&lt;li&gt;Disabling LTO (and debug symbols!) got us to 51s (-71%)&lt;&#x2F;li&gt;
&lt;li&gt;Changing to opt-level = 1 on the final crate got us to 48.8s (-4%)&lt;&#x2F;li&gt;
&lt;li&gt;Reducing inlining with -C llvm-args got us to 40.7s (-16%)&lt;&#x2F;li&gt;
&lt;li&gt;Local changes got us to 37.7s (-7%)&lt;&#x2F;li&gt;
&lt;li&gt;Changes with dependencies got us to 32.3s (-14%)&lt;&#x2F;li&gt;
&lt;li&gt;Enabling -Zshare-generics got us to 29.1s (-10%)&lt;&#x2F;li&gt;
&lt;li&gt;And switching away from alpine got us to 9.1s (-69%)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.veeso.dev&#x2F;blog&#x2F;en&#x2F;leaktracer-a-rust-allocator-to-trace-memory-allocations&#x2F;&quot;&gt;Leaktracer: A Rust allocator to trace memory allocations&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;zig
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;kristoff.it&#x2F;blog&#x2F;zig-new-async-io&#x2F;&quot;&gt;zig&#x27;s new async io&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;kristoff.it&#x2F;blog&#x2F;zig-colorblind-async-await&#x2F;&quot;&gt;What is Zig&#x27;s â€œColorblindâ€ Async&#x2F;Await?&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Java
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;qxDNW5Ss3r4zhPSCqdXvqw&quot;&gt;å°çº¢ä¹¦JDKå‡çº§å¸¦æ¥10%æ•´ä½“æ€§èƒ½æå‡ï¼Œè¿™ä»½å‡çº§æŒ‡å—æ”¶å¥½äº†ï¼&lt;&#x2F;a&gt; åƒå¹´çš„JDK8é—®é¢˜
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;openjdk.org&#x2F;jeps&#x2F;307&quot;&gt;G1: Parallel Full GC for G1&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;G1: Initiating Heap Occupancy Percent&lt;&#x2F;li&gt;
&lt;li&gt;G1: æå‰å›æ”¶å¤§å¯¹è±¡
æ€»çš„æ„Ÿè§‰æ¥è¯´ï¼Œå¯¹å¤§å‹ç³»ç»Ÿï¼ŒJavaçš„GCä»ç„¶å¸¦æ¥äº†ä¸€å®šç¨‹åº¦çš„ä¸å¯æ§å› ç´ ï¼Œæ‰€æœ‰çš„ GC è°ƒä¼˜å…¶å®éƒ½æ˜¯åœ¨è¿™ä¸ªä¸ç¡®å®šæ€§ä¸Šè·³èˆï¼Œè·å¾—æˆ–å¤šæˆ–å°‘çš„æ”¹è¿›ï¼Œ
ä½†ä»ç„¶æ˜¯å­˜åœ¨ä¸ç¡®å®šæ€§ã€‚è¿™å°±æ˜¯åœ¨ä¸€ä¸ªä½ç»´åº¦çš„æŒ£æ‰ã€‚ï¼ˆä¸è¿‡ï¼Œä½œä¸ºåº”ç”¨å±‚çš„ç¼–ç¨‹è¯­è¨€ï¼Œä¸é‡‡çº³ GC çš„æˆæœ¬å¯èƒ½æ›´é«˜ ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;Java çš„ä¼˜ç‚¹å’Œç¼ºç‚¹å¯èƒ½æ˜¯ç°åœ¨çš„ç”Ÿæ€ï¼Œåœ¨ä¸éœ€è¦é‚£ä¹ˆè‡ƒè‚¿çš„åœºæ™¯ä¸‹ï¼Œå¯èƒ½ä¼šè¶Šæ¥è¶Šè‡ƒè‚¿ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.swift.org&#x2F;blog&#x2F;swift-at-apple-migrating-the-password-monitoring-service-from-java&#x2F;&quot;&gt;ä» Java è¿ç§»åˆ° Swift: å¯†ç ç›‘æ§æœåŠ¡&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;MPP &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;web-frontend&quot;&gt;Web &amp;amp; Frontend&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;uxplanet.org&#x2F;dashboard-that-works-a-step-by-step-guide-for-startups-in-2025-1cec1bfe7f9c&quot;&gt;Dashboard That Works: A Step-by-Step Guide for Startups in 2025&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;A truly functional dashboard:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;GOALS, DATA, PEOPLE, LOGIC&lt;&#x2F;li&gt;
&lt;li&gt;analysts, designers, developers&lt;&#x2F;li&gt;
&lt;li&gt;work for business, not just look pretty&lt;&#x2F;li&gt;
&lt;li&gt;Don&#x27;t try to make a dashboard for everyone&lt;&#x2F;li&gt;
&lt;li&gt;define use cases and users&lt;&#x2F;li&gt;
&lt;li&gt;identify key metrics&lt;&#x2F;li&gt;
&lt;li&gt;prepare data&lt;&#x2F;li&gt;
&lt;li&gt;sketch a rough layout&lt;&#x2F;li&gt;
&lt;li&gt;get user feedback&lt;&#x2F;li&gt;
&lt;li&gt;write a solid brief for designers&lt;&#x2F;li&gt;
&lt;li&gt;find the right builders&lt;&#x2F;li&gt;
&lt;li&gt;Launch, watch, improve&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;[fastplotlib](a plotting library built on WGPU)&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;based on [pygfx](a python-graphics library visualization framework on WGPU)
æ€è€ƒï¼šç»“åˆ Vega, Pixi, D3 ç­‰æ¡†æ¶ï¼Œæ€è€ƒä¸€ç§æè¿° visualization çš„æœ€ä½³æ–¹å¼ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Vegaï¼šä½¿ç”¨ JSON çš„æ–¹å¼ï¼Œç¼ºä¹ç±»å‹åŒ–çº¦æŸï¼Œä¸ä¾¿äºç†è§£ã€ä½¿ç”¨ï¼Œéƒ¨ä»½çš„èƒ½åŠ›è¿‡äºç³–åŒ–ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨å¤šç»´ç©ºé—´çš„æ–¹å¼æ¥ç†è§£ visualization&lt;&#x2F;li&gt;
&lt;li&gt;å°†æ•°æ®ï¼ˆå…³ç³»æ•°æ®ã€å¤šç»´æ•°æ®ï¼‰æ˜ å°„åˆ°ï¼ˆå¯è§†åŒ–ï¼‰å¤šç»´ç©ºé—´ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨ react çš„æ–¹å¼æ¥ç†è§£ interact&lt;&#x2F;li&gt;
&lt;li&gt;æ›´å¥½çš„è¡¨ç¤ºè¯­è¨€ï¼Ÿ
&lt;ul&gt;
&lt;li&gt;JSON based&lt;&#x2F;li&gt;
&lt;li&gt;more datatype: date, interval, float, decimal, more via regexp&quot;...&quot; style&lt;&#x2F;li&gt;
&lt;li&gt;JSON constructor:   Color { r g b }&lt;&#x2F;li&gt;
&lt;li&gt;functional constructor: Color(r, g, b), with fixed parameter and named parameter&lt;&#x2F;li&gt;
&lt;li&gt;enum literal. .RED instead of Color.RED&lt;&#x2F;li&gt;
&lt;li&gt;reference spec: global reference, document reference, scoped reference.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;g2.antv.antgroup.com&#x2F;manual&#x2F;quick-start&quot;&gt;AntV G2&lt;&#x2F;a&gt;
ç²—è§ˆä¸€ä¸‹æ–‡æ¡£å’Œç¤ºä¾‹ï¼ŒG2 çš„æ¦‚å¿µä¸ vega æ—¶éå¸¸ç›¸ä¼¼çš„ï¼Œæä¾›2ç§ API: å‘½ä»¤å¼ å’Œ DSL å¼ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;llm-agents&quot;&gt;LLM &amp;amp; Agents&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;lilianweng.github.io&#x2F;posts&#x2F;2023-06-23-agent&#x2F;&quot;&gt;LLM Powered Autonomous Agents&lt;&#x2F;a&gt;
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;monthly&#x2F;2025-07&#x2F;img_2.png&quot; alt=&quot;img_2.png&quot; &#x2F;&gt;&lt;&#x2F;li&gt;
&lt;li&gt;AutoGPT&lt;&#x2F;li&gt;
&lt;li&gt;AnyTool&lt;&#x2F;li&gt;
&lt;li&gt;HuggingGPT&lt;&#x2F;li&gt;
&lt;li&gt;Understanding the planning of LLM agents: A survey&lt;&#x2F;li&gt;
&lt;li&gt;https:&#x2F;&#x2F;github.com&#x2F;AntonOsika&#x2F;gpt-engineer&lt;&#x2F;li&gt;
&lt;li&gt;JoyAgent&lt;&#x2F;li&gt;
&lt;li&gt;Gaia benchmark: a benchmark for General AI Assistants&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>misc</title>
        <published>2025-06-20T12:00:00+00:00</published>
        <updated>2025-06-20T12:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/thoughts/misc/"/>
        <id>https://wangzaixiang.github.io/thoughts/misc/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/thoughts/misc/">&lt;ol&gt;
&lt;li&gt;ç®¡ç†ä¹‹åŒ¹é…ä¸å¼¹æ€§
&lt;ul&gt;
&lt;li&gt;æ‰ä½åŒ¹é…ï¼šæ‰ä¸é…ä½è€…ï¼Œä½è™šï¼Œä½ä¸é…æ‰è€…ï¼Œæ‰å±ˆã€‚
&lt;ul&gt;
&lt;li&gt;ä»¥èµ„å†ï¼Œä»¥äº²ç–ã€ä»¥æµ®å¤¸è…ä½è€…ï¼Œæ¯”æ¯”çš†æ˜¯ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸€å°†æ— èƒ½ï¼Œç´¯æ­»ä¸‰å†›ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½ä¸é…æ‰ï¼Œè™½åƒé‡Œé©¬äº¦ç—…é©¹äº¦ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;èµç½šä¸æ˜&lt;&#x2F;li&gt;
&lt;li&gt;å¼¹æ€§
&lt;ul&gt;
&lt;li&gt;è¿‡ç´§åˆ™åƒµï¼Œç•é¦–ç•å°¾ï¼Œä¸æ•¢å†’é™©ï¼Œä¸æ•¢çŠ¯é”™ã€‚æœ‰å¼¹æ€§åˆ™é¼“åŠ±æ‰¿æ‹…è´£ä»»ï¼Œæ•¢å†’é£é™©ï¼Œè€Œéä¸æ±‚æœ‰åŠŸä½†æ±‚æ— è¿‡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è¿‡æ¾åˆ™å¼›ï¼Œè‡ªç”±æ•£æ¼«ï¼Œæ— ç»„ç»‡æ— çºªå¾‹ï¼Œå¾—è¿‡ä¸”è¿‡ã€‚ æœ‰å¼¹æ€§åˆ™è®¸å¯é€‚å½“æ¾å¼›ï¼Œæˆ–ä¼‘æ¯ï¼Œæˆ–å­¦ä¹ ï¼Œå¹³è¡¡èº«å¿ƒã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;å¶å…¬å¥½é¾™
å¹¼æ—¶è¯»æ­¤æ–‡ï¼Œæ„Ÿè§‰å¤¸å¼ ï¼Œä¸åŒ¹é…ç°å®ã€‚è€Œä»Šæ€ä¹‹ï¼Œå®å±æ— çŸ¥ï¼šæ­¤å–»å®ä¹ƒæ— æ—¶æ— åˆ»ä¸éšäºä¸–é—´ï¼Œäºä½ äºæˆ‘ï¼Œæˆ–çš†å¶å…¬ã€‚æˆ‘æœ‰é¸¿é¹„ä¹‹å¿—ï¼Œå´ä¸æ„¿è¸å®è€•è€˜ï¼Œ
è¯¸å¤šæ—¶å…‰ï¼Œçš†ä»˜è¯¸å¿«æ–‡å­¦ã€å¿«èµ„è®¯ã€å¿«å¨±ä¹ä¸­ï¼Œä¸äº¦å¶å…¬ä¹ã€‚æ²»ç†å…¬å¸ï¼Œè™½è¨€å¿…ä½¿å‘½æ„¿æ™¯ï¼Œæ¶æ„æ–‡åŒ–ï¼Œå´ä¸æ„¿ç²¾ç ”äº§å“ï¼Œèµ°è¿‘å®¢æˆ·ï¼Œèµ°è¿‘å‘˜å·¥ä¸€çº¿ï¼Œä¸äº¦å¶å…¬ä¹ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>é¢å‘åˆ†æåœºæ™¯çš„ SQL æ‰©å±•æ€è€ƒ</title>
        <published>2025-06-06T00:00:00+00:00</published>
        <updated>2025-06-06T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/analysis-sql-extensions/"/>
        <id>https://wangzaixiang.github.io/blog/analysis-sql-extensions/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/analysis-sql-extensions/">&lt;h1 id=&quot;zai-yi-ge-ji-suan-liu-zhong-shu-chu-duo-ge-jie-guo&quot;&gt;åœ¨ä¸€ä¸ªè®¡ç®—æµä¸­è¾“å‡ºå¤šä¸ªç»“æœ&lt;&#x2F;h1&gt;
&lt;p&gt;ç›®å‰çš„ Query éƒ½åªèƒ½è¾“å‡ºå•ä¸ªç»“æœé›†ï¼Œå¦‚æœèƒ½åœ¨ä¸€ä¸ªè®¡ç®—å›¾ä¸­åŒæ—¶è¾“å‡ºå¤šä¸ªç»“æœé›†ï¼Œåœ¨ä¸€äº› BI åœºæ™¯ä¼šæœ‰æ€§èƒ½ä¸Šçš„ä¼˜åŒ–ã€‚ä¸€ä¸ªå…¸å‹çš„æ¡ˆä¾‹å°±æ˜¯ï¼šåœ¨æŸ¥è¯¢ç¬¬ä¸€é¡µæ•°æ®çš„åŒæ—¶ï¼Œ
è¿”å›æ€»è¡Œæ•°ã€‚ç›®å‰çš„åšæ³•æ˜¯æ‹†åˆ†ä¸º2ä¸ªç‹¬ç«‹çš„æŸ¥è¯¢ï¼šQ1 æŸ¥è¯¢ç¬¬ä¸€é¡µæ•°æ®ï¼ŒQ2 æŸ¥è¯¢æ€»è¡Œæ•°ã€‚å¦‚æœç»“åˆåˆ°ä¸€ä¸ªè®¡ç®—å›¾ä¸­ï¼Œåˆ™å¯ä»¥å…±äº«å¾ˆå¤šç®—å­çš„è®¡ç®—ï¼Œä»è€Œå‡å°‘é‡å¤è®¡ç®—æ¶ˆè€—ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;group-by-grouping-set-cube-rollup&quot;&gt;group by grouping set, cube, rollup&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒæ•°æ®åº“
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;duckdb.org&#x2F;docs&#x2F;stable&#x2F;sql&#x2F;query_syntax&#x2F;grouping_sets&quot;&gt;duckdb&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.postgresql.org&#x2F;docs&#x2F;current&#x2F;queries-table-expressions.html#QUERIES-GROUPING-SETS&quot;&gt;postgres 9.5&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dev.mysql.com&#x2F;blog-archive&#x2F;improvements-to-rollup-in-mysql&#x2F;&quot;&gt;mysql 8.0.19&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;datafusion: ç›®å‰å¹¶ä¸æ”¯æŒ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨åœºæ™¯ï¼šå°†åˆ†ç»„ã€å°è®¡ã€åˆè®¡ç­‰å¤šä¸ªæŸ¥è¯¢åœ¨åŒä¸€ä¸ª SQL ä¸­å®Œæˆã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ€§èƒ½ä¼˜åŒ–ï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨æœ€å°ç²’åº¦ä¸Šè¿›è¡Œ group aggregate&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ä¸Šå±‚ç²’åº¦ä¸Šè¿›è¡Œ rollupï¼Œé¿å…é‡å¤è®¡ç®—ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨åŒä¸€ä¸ªç®—å­ä¸­å®Œæˆ grouping set çš„è®¡ç®—ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;aggregate-with-filter&quot;&gt;aggregate with filter&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒæ•°æ®åº“
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;duckdb.org&#x2F;docs&#x2F;stable&#x2F;sql&#x2F;functions&#x2F;aggregates&quot;&gt;duckdb&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;datafusion: ç›®å‰å¹¶ä¸æ”¯æŒ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;é€‚ç”¨åœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨åˆ†ç»„è®¡ç®—æ—¶ï¼Œæ”¯æŒå®šä¹‰åŒ…å«æ›´å¤š filter çš„åº¦é‡è®¡ç®—ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;aggregate-with-rollup&quot;&gt;aggregate with rollup&lt;&#x2F;h1&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT&lt;&#x2F;span&gt;&lt;span&gt; category, product, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;SUM&lt;&#x2F;span&gt;&lt;span&gt;(amount) as amount, 
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;SUM&lt;&#x2F;span&gt;&lt;span&gt;(amount) rollup(category) as amount_of_product,  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- åœ¨ category ä¸Š rollup
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;SUM&lt;&#x2F;span&gt;&lt;span&gt;(amount) rollup(product) as amount_of_category,  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- åœ¨ product ä¸Š rollup
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; orders
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;GROUP BY&lt;&#x2F;span&gt;&lt;span&gt; category, product
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ç›®å‰è¿˜æ²¡æœ‰çœ‹åˆ°å“ªä¸ªæ•°æ®åº“æ”¯æŒè¿™ç§å½¢å¼çš„æŸ¥è¯¢ã€‚å…¶ä¸åŒäº group by grouping, åè€…ä¼šè¿”å›ä¸åŒçš„åˆ†ç»„ï¼Œ aggregate with rollup æ˜¯åœ¨å½“å‰çš„åˆ†ç»„ä¸Š
è¿”å› rollup çš„ç»“æœã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è¯„ä¼°ï¼šåœ¨ datafusion ä¸­å¢åŠ è¿™ä¸ªèƒ½åŠ›ï¼Œå¹¶è€ƒè™‘åœ¨å•ä¸ªç®—å­ä¸­å®Œæˆè®¡ç®—ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;jie-he-aggregate-with-filter-rollup&quot;&gt;ç»“åˆ aggregate with filter &amp;amp; rollup&lt;&#x2F;h1&gt;
&lt;p&gt;å¦‚æœèƒ½å¤Ÿåœ¨ datafusion ä¸­åŒæ—¶æ”¯æŒ aggregate with filter &amp;amp; rollup çš„åŠŸèƒ½çš„è¯ï¼Œé‚£ä¹ˆä»¥ä¸‹çš„ OLAP è®¡ç®—å°±ä¼šå˜å¾—ç®€å•ä¸”é«˜æ•ˆï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;with filter ç±»ä¼¼äº MDX çš„ &lt;code&gt;([Measure].[X], [DimMore].[m1])&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;with rollup ç±»ä¼¼äº MDX çš„ &lt;code&gt;([Measure].[X], [Dim1].[AllDim1s])&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;ç»„åˆï¼š å®ç°äºŒè€…çš„ç­‰æ•ˆæ“ä½œã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é™åˆ¶ï¼šwith filter &amp;amp; with rollup éƒ½åœ¨ where ä¹‹åæ‰§è¡Œï¼Œå…¶åŸºç¡€æ•°æ®å— where æ¡ä»¶çš„é™åˆ¶ï¼Œæ— æ³•åœ¨ filter ä¸­å˜æ›´æ•°æ®èŒƒå›´ï¼Œè™½ç„¶æœ‰è¿™ä¸ªé™åˆ¶ï¼Œ
ä»ç„¶å¯ä»¥æ»¡è¶³å¾ˆå¤§éƒ¨ä»½çš„ MDX æŒ‡æ ‡è®¡ç®—çš„èƒ½åŠ›&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;more-aggregate-functions&quot;&gt;More Aggregate Functions&lt;&#x2F;h1&gt;
&lt;p&gt;å‚è€ƒï¼šhttps:&#x2F;&#x2F;duckdb.org&#x2F;docs&#x2F;stable&#x2F;sql&#x2F;functions&#x2F;aggregates&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;function&lt;&#x2F;th&gt;&lt;th&gt;duckdb&lt;&#x2F;th&gt;&lt;th&gt;duckdb-order-by&lt;&#x2F;th&gt;&lt;th&gt;datafusion&lt;&#x2F;th&gt;&lt;th&gt;description&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;any_value(arg)&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Returns the first non-null value from arg, support order by&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;arbitrary(arg)&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;first_value&lt;&#x2F;td&gt;&lt;td&gt;Returns the first value(null or non-null) from arg, support order by&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;arg_max&#x2F;min(arg, val)&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Finds the row with the maximum val and calculates the arg expression at that row. support order by&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;arg_max&#x2F;min(arg, val, n)&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;return a List of N&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;arg_max_null(arg, val)&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;ignore rows where val is null&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;array_agg(arg)&#x2F;list&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;bit_and&#x2F;or&#x2F;xor(arg)&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;bool_and&#x2F;or(arg)&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;count(*)&#x2F;count(val)&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;max(arg)&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;max(arg, n)&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;max_by(arg, val, n)&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;h1 id=&quot;as-of-join&quot;&gt;as-of join&lt;&#x2F;h1&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;h&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;ticker&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;h&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;when&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;p&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;price &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;* &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;h&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;shares &lt;&#x2F;span&gt;&lt;span&gt;AS value
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; holdings h
&lt;&#x2F;span&gt;&lt;span&gt; ASOF &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;JOIN&lt;&#x2F;span&gt;&lt;span&gt; prices p &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- å…³è”åˆ° 1 æ¡ prices è®°å½•ï¼Œå» p.when ä¸­æœ€å¤§çš„è®°å½•ï¼Œ inner join ä¸¢å¼ƒæ‰¾ä¸åˆ°çš„ join, or left join é‡‡ç”¨ outer join
&lt;&#x2F;span&gt;&lt;span&gt;      ON &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;h&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;ticker &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;p&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;ticker
&lt;&#x2F;span&gt;&lt;span&gt;      AND &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;h&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;when &lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;p&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;when&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒæ•°æ®åº“
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;duckdb.org&#x2F;docs&#x2F;stable&#x2F;guides&#x2F;sql_features&#x2F;asof_join#inner-asof-joins&quot;&gt;duckdb&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;é€‚ç”¨åœºæ™¯
&lt;ul&gt;
&lt;li&gt;æ—¶ç‚¹ç±»æŒ‡æ ‡ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;gao-xiao-zhi-xing-scalar-subquery&quot;&gt;é«˜æ•ˆæ‰§è¡Œ scalar subquery&lt;&#x2F;h1&gt;
&lt;p&gt;ä½¿ç”¨ scalar subquery (å¯ä»¥å‡ºç°åœ¨ SelectItem, Where éƒ¨ä»½)ï¼Œæ¥æè¿°è®¡ç®—åº¦é‡ï¼Œå…·æœ‰è¾ƒå¼ºçš„è¡¨è¾¾èƒ½åŠ›ï¼Œå¯ä»¥è¦†ç›–ä¸Šè¿°çš„ aggregate with rollup çš„èƒ½åŠ›ï¼Œ
ä»¥åŠæ›´ä¸ºå¤æ‚çš„ä¸€äº›è®¡ç®—åœºæ™¯ï¼ŒåŒ…æ‹¬ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ—¶é—´å¿«é€Ÿè®¡ç®—ï¼Œå¦‚ åŒæœŸå€¼ã€å‰æœŸå€¼ã€å¹´ï¼ˆå­£ã€æœˆï¼‰ç´¯è®¡ã€åŒæœŸç´¯è®¡å€¼&lt;&#x2F;li&gt;
&lt;li&gt;ç»„å†…å æ¯”&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;å¦‚æœ SQL æ‰§è¡Œå¼•æ“èƒ½å¤Ÿé«˜æ•ˆçš„æ‰§è¡Œ scalar subquery, é‚£ä¹ˆå¯¹ OLAP åˆ†ææ¥è¯´ï¼Œå°±å¾ˆæœ‰ä»·å€¼äº†ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;ericfu.me&#x2F;subquery-optimization&#x2F;&quot;&gt;SQL å­æŸ¥è¯¢çš„ä¼˜åŒ–&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æ–‡çŒ®ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;ericfu.me&#x2F;subquery-optimization&#x2F;&quot;&gt;Unnesting Arbitrary Queries&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;21395872495&quot;&gt;4.5 duck-å…³è”å­æŸ¥è¯¢(binder-&amp;gt;plan-&amp;gt;optimize)&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;TPCH Query2&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;	s_acctbal,	s_name,	n_name,	p_partkey,	p_mfgr,	s_address,	s_phone,	s_comment	
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt;	part,	supplier,	partsupp,	nation,	region	
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt;	p_partkey = ps_partkey	and s_suppkey = ps_suppkey	and p_size = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;15	&lt;&#x2F;span&gt;&lt;span&gt;and p_type like &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;%BRASS&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;	
&lt;&#x2F;span&gt;&lt;span&gt;   and s_nationkey = n_nationkey	and n_regionkey = r_regionkey	and r_name = &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;EUROPE&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;	
&lt;&#x2F;span&gt;&lt;span&gt;   and ps_supplycost = (	
&lt;&#x2F;span&gt;&lt;span&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;min&lt;&#x2F;span&gt;&lt;span&gt;(ps_supplycost)	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt;	partsupp,	supplier,	nation,	region	
&lt;&#x2F;span&gt;&lt;span&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt;	p_partkey = ps_partkey	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- p_partkey is from outer part
&lt;&#x2F;span&gt;&lt;span&gt;           and s_suppkey = ps_suppkey	and s_nationkey = n_nationkey	
&lt;&#x2F;span&gt;&lt;span&gt;           and n_regionkey = r_regionkey	and r_name = &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;EUROPE&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;	
&lt;&#x2F;span&gt;&lt;span&gt;  )	
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;order by&lt;&#x2F;span&gt;&lt;span&gt;	s_acctbal &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;desc&lt;&#x2F;span&gt;&lt;span&gt;,	n_name,	s_name,	p_partkey;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å¯¹è¿™ä¸ªå­æŸ¥è¯¢, duckdb å’Œ datafusion éƒ½å…·æœ‰è‰¯å¥½çš„ä¼˜åŒ–èƒ½åŠ›ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;datafusion 48.0.0 æš‚ä¸æ”¯æŒå¦‚ä¸‹çš„æŸ¥è¯¢ï¼ˆduckdbæ”¯æŒï¼Œä½†å…¶æŸ¥è¯¢è®¡åˆ’ä¸æ˜¯å¾ˆå¥½é˜…è¯»ï¼‰ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select 
&lt;&#x2F;span&gt;&lt;span&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_custkey&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_orderdate&lt;&#x2F;span&gt;&lt;span&gt;, 
&lt;&#x2F;span&gt;&lt;span&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_totalprice&lt;&#x2F;span&gt;&lt;span&gt;),
&lt;&#x2F;span&gt;&lt;span&gt;       (
&lt;&#x2F;span&gt;&lt;span&gt;           &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o2&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_totalprice&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;           &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; orders o2
&lt;&#x2F;span&gt;&lt;span&gt;           &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where 	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o2&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_custkey &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_custkey 
&lt;&#x2F;span&gt;&lt;span&gt;               and &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o2&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_orderdate &lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;= date_trunc(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;year&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_orderdate&lt;&#x2F;span&gt;&lt;span&gt;) 
&lt;&#x2F;span&gt;&lt;span&gt;               and &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o2&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_orderdate &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_orderdate
&lt;&#x2F;span&gt;&lt;span&gt;       ) as &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;å¹´ç´¯è®¡&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; orders o1 
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where 
&lt;&#x2F;span&gt;&lt;span&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_orderdate &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;date&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;1992-02-10&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; 
&lt;&#x2F;span&gt;&lt;span&gt;       and &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_custkey &lt;&#x2F;span&gt;&lt;span&gt;in (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3689999&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;7800163&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;é”™è¯¯ï¼š&lt;code&gt;This feature is not implemented: Physical plan does not support logical expression ScalarSubquery(&amp;lt;subquery&amp;gt;)&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
idea: æ–°å¢ä¸€ç§ reduce join, outer : inner = 1: Nï¼Œ å°†å¤šè¡Œ inner çš„æ•°æ®è¿›è¡Œèšåˆåï¼Œä½œä¸º inner çš„è¾“å‡ºã€‚
åœ¨ join ç®—å­ä¸­å®Œæˆèšåˆæ“ä½œï¼Œå‡å°‘ join çš„ outputã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
ideaï¼šåœ¨ reduce join ä¸­ï¼Œå°†éƒ¨ä»½ window function çš„æ‰§è¡Œä¼˜åŒ–ç­–ç•¥å¼•å…¥ï¼Œå‡å°‘ working set ä»¥åŠèšåˆè®¡ç®—é‡ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>datafusion æ€§èƒ½åˆ†æ</title>
        <published>2025-06-06T00:00:00+00:00</published>
        <updated>2025-06-06T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/datafusion-performance/"/>
        <id>https://wangzaixiang.github.io/blog/datafusion-performance/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/datafusion-performance/">&lt;p&gt;æœ¬æ–‡è®°å½•æˆ‘å¯¹ datafusion çš„ä¸€äº›æ€§èƒ½æµ‹è¯•çš„æ•°æ®ã€åˆ†æå’Œæ€è€ƒã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä»2023å¹´èµ·ï¼Œæˆ‘å¼€å§‹å…³æ³¨åœ¨å…¬å¸çš„ BI åˆ†æå¼•æ“ä¸­ï¼Œå¼•å…¥ OLAP å¼•æ“çš„åº•å±‚è®¡ç®—èƒ½åŠ›ï¼Œå½“æ—¶å°±å¼€å§‹è¯„ä¼°äº†å‡ ä¸ªè®¡ç®—å¼•æ“ï¼ŒåŒ…æ‹¬ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;pola.rs&quot;&gt;polars&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;datafusion.apache.org&quot;&gt;datafusion&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;duckdb.org&quot;&gt;duckdb&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;å…³æ³¨çš„é‡ç‚¹ä¸»è¦æ˜¯ è®¡ç®—èƒ½åŠ› å’Œ è®¡ç®—æ€§èƒ½ï¼Œåé¢é€‰æ‹©äº† duckdb ä½œä¸ºæˆ‘ä»¬çš„è®¡ç®—å¼•æ“ï¼Œä¸»è¦çš„ä¼˜åŠ¿ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ€§èƒ½ï¼šduckdb åœ¨å¤§éƒ¨ä»½æµ‹è¯•åœºæ™¯éƒ½å…·æœ‰é¢†å…ˆæˆ–ç›¸å½“çš„æ€§èƒ½ï¼ˆå¯å‚è€ƒæˆ‘å½“æ—¶çš„ä¸€ä¸ªæµ‹è¯•ï¼š&lt;a href=&quot;&#x2F;inside-duckdb&#x2F;preface.html&quot;&gt;duckdb æµ‹è¯„&lt;&#x2F;a&gt;ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;è¡¨è¾¾èƒ½åŠ›ï¼šduckdb å¯¹çª—å£å‡½æ•°çš„æ”¯æŒç¨‹åº¦åŸºæœ¬ä¸Šæ˜¯æœ€å®Œå¤‡çš„ï¼ˆè€Œæˆ‘æµ‹è¯•çš„å…¶ä»–åŒ…æ‹¬ mysql, clickhouse, datafusion éƒ½æœ‰ä¸åŒç¨‹åº¦çš„æ”¯æŒä¸å……åˆ†ï¼‰ï¼Œpola.rs
çš„çª—å£è®¡ç®—é€»è¾‘å®Œå…¨ä¸åŒäº SQL å®šä¹‰çš„çª—å£å‡½æ•°ï¼ˆè€Œä¸”æˆ‘æ— æ³•ç†è§£èµ·åº•å±‚é€»è¾‘æ˜¯ä»€ä¹ˆï¼‰ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬åç»­åœ¨ä½¿ç”¨ duckdb æ—¶ï¼Œä¹Ÿå‘ç°äº† duckdb æä¾›äº†å¾ˆå¤šæœ‰ä»·å€¼çš„
SQL æ‰©å±•ï¼Œä¾‹å¦‚ group by grouping set å¯¹åˆ†ç»„å°è®¡ç­‰ç»Ÿè®¡åœºæ™¯éå¸¸æœ‰å¸®åŠ©ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å·¥å…·å®Œå–„åº¦ï¼šduckdb çš„ å·¥å…·ï¼ŒåŒ…æ‹¬ CLIã€python API éƒ½è®¾è®¡å¾—éå¸¸å‹å¥½ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;25å¹´ï¼Œåœ¨é˜…è¯»äº†&lt;a href=&quot;https:&#x2F;&#x2F;docs.google.com&#x2F;presentation&#x2F;d&#x2F;1gqcxSNLGVwaqN0_yJtCbNm19-w5pqPuktII5_EDA6_k&quot;&gt;2024 Practice: Apache Arrow DataFusion A Fast, Embeddable, Modular Analytic Query Engine&lt;&#x2F;a&gt;
ä¸€æ–‡åï¼Œå°¤å…¶æ˜¯æ–‡ä¸­æåˆ°çš„æ€§èƒ½å¯¹æ¯”åï¼Œæˆ‘ä¹Ÿåœ¨æœ¬åœ°é‡è·‘äº†ä¸€æ¬¡ datafusion-duckdb-benchmark çš„å¯¹æ¯”ï¼Œå†èŠ±äº†äº›æ—¶é—´é˜…è¯»äº†ä¸€ä¸‹ datafusion çš„æºä»£ç ï¼Œ
æœ‰äº†ä¸€äº›ä¸åŒçš„è®¤çŸ¥ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Rust æºä»£ç çš„å¯è¯»æ€§ç›¸æ¯” C++ æœ‰äº†æ›´å¥½çš„æå‡ï¼ˆå¯èƒ½å› ä¸ºæˆ‘å–œæ¬¢ Rust è¶…è¿‡ C++ï¼‰ï¼Œæˆ‘ä¹ŸæŠŠé˜…è¯» hash-join, window functionç­‰ç®—å­æ•´ç†äº†æ–‡ç« ï¼Œåœ¨è¿™ä¸ªç³»åˆ—ä¸­è¿›è¡Œäº†å‘è¡¨ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;datafusion çš„æ€§èƒ½è™½ç„¶æ•´ä½“ä¸Šä»ç„¶ä¸å¦‚ duckdbï¼Œä½†è¿™ä¸ªå·®è·ä¸»è¦æ˜¯å·¥ç¨‹ä¸Šçš„æˆç†Ÿåº¦ï¼Œè€Œéæ¶æ„ä¸Šçš„å·®å¼‚ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦é’ˆå¯¹ datafusion-duckdb-benchmark è¿™ä¸ªé¡¹ç›®çš„æµ‹è¯•ç»“æœï¼Œå¯¹äºŒè€…çš„å·®å¼‚è¿›è¡Œåˆ†æï¼Œå¹¶å°è¯•ç»™å‡ºæ”¹è¿›ã€ä¼˜åŒ– datafusion çš„ä¸€äº›å»ºè®®ã€‚
æ›´æ–°çš„ &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;datafusion-duckdb-benchmark&quot;&gt;datafusion-duckdb-benchmark&lt;&#x2F;a&gt; é¡¹ç›®:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å‡çº§åˆ°æœ€æ–°çš„ç‰ˆæœ¬ datafusion 47.0.0 å’Œ duckdb 1.3.0&lt;&#x2F;li&gt;
&lt;li&gt;é…åˆæœ¬æ–‡å¯¹éƒ¨ä»½è„šæœ¬è¿›è¡Œäº†æ›´æ–°ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;datafusion-duckdb-benchmark&quot;&gt;datafusion-duckdb-benchmark&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;clickbench&lt;&#x2F;li&gt;
&lt;li&gt;tpch&lt;&#x2F;li&gt;
&lt;li&gt;h2o&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;clickbench-dan-xian-cheng-ce-shi&quot;&gt;clickbench å•çº¿ç¨‹æµ‹è¯•&lt;&#x2F;h1&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-performance&#x2F;comparison.clickbench.png&quot; alt=&quot;comparison.clickbench.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- duckdb sql
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;with 
&lt;&#x2F;span&gt;&lt;span&gt;   cb_datafusion as (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt;  read_csv(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;results&#x2F;2025-06-17-df-48.0.0-duckdb-1.3.0-m1max&#x2F;clickbench_datafusion.csv&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, header=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;, columns= { &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;query&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;: &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;core&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;: &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;seq&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;: &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;tm&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;: &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;double&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; } )),
&lt;&#x2F;span&gt;&lt;span&gt;   cb_duckdb as (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt;  read_csv(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;results&#x2F;2025-06-17-df-48.0.0-duckdb-1.3.0-m1max&#x2F;clickbench_duckdb.csv&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, header=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;, columns= { &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;query&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;: &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;core&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;: &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;seq&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;: &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;tm&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;: &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;double&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; } )),
&lt;&#x2F;span&gt;&lt;span&gt;   duckdb as (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt; query, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;min&lt;&#x2F;span&gt;&lt;span&gt;(tm) as tm &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; cb_duckdb &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by&lt;&#x2F;span&gt;&lt;span&gt; query &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;order by&lt;&#x2F;span&gt;&lt;span&gt; query), 
&lt;&#x2F;span&gt;&lt;span&gt;   datafusion as (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt; query, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;min&lt;&#x2F;span&gt;&lt;span&gt;(tm) as tm &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; cb_datafusion &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by&lt;&#x2F;span&gt;&lt;span&gt; query &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;order by&lt;&#x2F;span&gt;&lt;span&gt; query)
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;duckdb&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;query&lt;&#x2F;span&gt;&lt;span&gt;, round(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;duckdb&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;tm&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3&lt;&#x2F;span&gt;&lt;span&gt;) as &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;duckdb time&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, round(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;datafusion&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;tm&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3&lt;&#x2F;span&gt;&lt;span&gt;) as &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;datafusion time&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, round((&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;datafusion&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;tm &lt;&#x2F;span&gt;&lt;span&gt;- &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;duckdb&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;tm&lt;&#x2F;span&gt;&lt;span&gt;) &#x2F; (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;duckdb&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;tm&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;* &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;) as &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;diff%&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; 
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; duckdb &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;left join&lt;&#x2F;span&gt;&lt;span&gt; datafusion on &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;duckdb&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;query &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;datafusion&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;query
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;order by &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th style=&quot;text-align: right&quot;&gt;query&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: right&quot;&gt;duckdb time&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: right&quot;&gt;datafusion time&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: right&quot;&gt;diff%&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;1&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.03&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.033&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;12.23&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;2&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.109&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.071&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-35.08&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;3&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.285&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.321&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;12.51&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;4&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.394&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.287&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-27.19&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;5&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.411&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.219&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-7.96&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;6&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.931&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;3.111&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;6.15&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;7&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.633&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.063&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-96.15&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;8&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.117&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.075&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-36.21&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;9&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.95&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.629&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-10.87&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;10&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;4.04&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;3.929&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-2.75&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;11&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.651&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.008&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;55.0&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;12&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.757&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.133&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;49.66&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;13&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.781&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.917&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;4.91&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;14&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;4.062&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;3.907&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-3.81&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;15&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.968&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.763&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-6.92&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;16&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.673&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.596&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-2.86&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;17&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;5.652&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;5.042&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-10.79&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;18&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;5.57&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;5.024&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-9.8&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;19&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;10.476&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;8.318&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-20.6&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;20&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.095&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.241&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;151.94&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;21&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;7.064&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;6.455&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-8.62&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;22&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;5.578&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;7.659&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;37.31&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;23&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;10.85&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;14.823&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;36.62&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;24&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;7.969&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;39.1&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;390.67&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;25&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.454&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.314&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-5.69&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;26&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.708&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.048&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;19.93&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;27&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.251&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.613&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;16.09&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;28&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;5.094&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;10.745&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;110.92&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;29&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;29.147&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;28.087&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-3.64&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;30&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.24&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.405&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;904.0&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;31&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;3.086&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.896&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-6.15&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;32&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;3.544&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.911&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-17.86&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;33&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;10.346&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;8.892&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-14.05&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;34&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;9.928&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;11.879&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;19.65&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;35&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;10.395&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;11.869&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;14.19&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;36&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.916&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;3.819&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;30.97&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;37&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.125&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.152&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;22.28&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;38&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.101&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.093&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-7.43&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;39&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.066&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.112&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;69.53&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;40&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.222&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.292&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;31.95&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;41&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.052&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.033&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-36.48&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;42&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.047&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.031&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-33.35&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;43&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.062&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.039&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-36.65&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;p&gt;åœ¨43ä¸ªåœºæ™¯ä¸­ï¼Œæœ‰23ä¸ªåœºæ™¯ datafusion æ›´å¿«ï¼Œæœ‰20ä¸ªåœºæ™¯ï¼Œdatafusion æ›´æ…¢, å…¶ä¸­å·®å¼‚æ¯”è¾ƒæ˜¾è‘—çš„æ˜¯ï¼š&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th style=&quot;text-align: right&quot;&gt;query&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: right&quot;&gt;duckdb time&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: right&quot;&gt;datafusion time&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: right&quot;&gt;diff%&lt;&#x2F;th&gt;&lt;th&gt;analyze&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;1&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.03&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.033&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;12.23&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;3&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.285&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.321&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;12.51&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;6&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.931&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;3.111&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;6.15&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;11&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.651&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.008&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;55.0&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;12&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.757&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.133&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;49.66&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;13&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.781&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.917&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;4.91&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;20&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.095&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.241&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;151.94&lt;&#x2F;td&gt;&lt;td&gt;TODO&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;22&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;5.578&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;7.659&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;37.31&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;23&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;10.85&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;14.823&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;36.62&lt;&#x2F;td&gt;&lt;td&gt;TODO&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;24&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;7.969&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;39.1&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;390.67&lt;&#x2F;td&gt;&lt;td&gt;duckdb ç”Ÿæˆäº†æ›´å¥½çš„ TOP-N æ‰§è¡Œè®¡åˆ’&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;26&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.708&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.048&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;19.93&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;27&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.251&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.613&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;16.09&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;28&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;5.094&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;10.745&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;110.92&lt;&#x2F;td&gt;&lt;td&gt;TODO&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;30&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.24&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.405&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;904.0&lt;&#x2F;td&gt;&lt;td&gt;duckdb æœ‰æ›´å¥½çš„å…¬å…±è¡¨è¾¾å¼ä¼˜åŒ–&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;34&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;9.928&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;11.879&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;19.65&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;35&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;10.395&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;11.869&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;14.19&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;36&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.916&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;3.819&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;30.97&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;37&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.125&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.152&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;22.28&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;39&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.066&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.112&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;69.53&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;40&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.222&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.292&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;31.95&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;h2 id=&quot;query-23&quot;&gt;query 23&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;duckdb: TABLE_SCAN 11.49s, output: 7128 rows (98%)&lt;&#x2F;li&gt;
&lt;li&gt;datafusion:&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;query-24-select-from-hits-where-url-like-google-order-by-eventtime-limit-10&quot;&gt;query 24: &lt;code&gt;SELECT * FROM hits WHERE URL LIKE &#x27;%google%&#x27; ORDER BY EventTime LIMIT 10&lt;&#x2F;code&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;duckdb ç”Ÿæˆäº†æ›´å¥½çš„æŸ¥è¯¢è®¡åˆ’ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt; a.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;* 
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; hits a 
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;join
&lt;&#x2F;span&gt;&lt;span&gt;     (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt; file_index, file_row_number &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; hits &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt; URL LIKE &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;%google%&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;ORDER BY&lt;&#x2F;span&gt;&lt;span&gt; EventTime &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;LIMIT &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;) b 
&lt;&#x2F;span&gt;&lt;span&gt; on &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;a&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;file_index &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;file_index &lt;&#x2F;span&gt;&lt;span&gt;and &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;a&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;file_row_number &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;file_row_number
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è¿™ä¸ªä¼˜åŒ–ï¼Œæå¤§çš„å‡å°‘äº† parquet çš„æ‰«æå¼€é”€ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;query-30&quot;&gt;query 30&lt;&#x2F;h2&gt;
&lt;p&gt;duckdb å¯¹å…¬å…±è¡¨è¾¾å¼ä¼˜åŒ–è¿›è¡Œäº†æ›´å¥½çš„ä¼˜åŒ–ï¼Œå°† &lt;code&gt;SUM(col + n)&lt;&#x2F;code&gt; æ›¿æ¢ä¸º &lt;code&gt;SUM(col) + n * COUNT(col)&lt;&#x2F;code&gt;, è¿™æ ·å¯¹ Query 30 ä¸­å¤šè¾¾ 90 ä¸ª &lt;code&gt;SUM(col + n)&lt;&#x2F;code&gt;
çš„å­—æ®µï¼Œæœ€åä¼˜åŒ–åˆ°åªæœ‰2ä¸ªåˆ†ç»„è®¡ç®—ï¼š &lt;code&gt;SUM(col)&lt;&#x2F;code&gt; å’Œ &lt;code&gt;COUNT(col)&lt;&#x2F;code&gt;ã€‚
ä¼˜åŒ–ï¼š å‚è€ƒ duckdb çš„è¡¨è¾¾å¼ä¼˜åŒ–ç­–ç•¥ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;tpch-benchmark&quot;&gt;tpch benchmark&lt;&#x2F;h1&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-performance&#x2F;comparison.tpch.png&quot; alt=&quot;comparison.tpch.png&quot; &#x2F;&gt;
è¿™ä¸ªæµ‹è¯•åœ¨ M1-MAX 64G ä¸Šè¿è¡Œã€‚&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th style=&quot;text-align: right&quot;&gt;query&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: right&quot;&gt;duckdb time&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: right&quot;&gt;datafusion time&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: right&quot;&gt;diff%&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;1&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.624&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;4.939&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;88.23&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;2&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.37&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.84&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;126.78&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;3&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.584&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.634&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;3.17&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;4&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.117&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.897&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-19.63&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;5&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.753&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.412&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;37.64&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;6&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.742&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.822&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;10.74&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;7&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.659&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;4.817&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;190.37&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;8&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.413&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.835&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;17.47&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;9&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;3.651&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;4.605&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;26.11&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;10&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.503&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.587&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;3.35&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;11&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.347&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.949&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;173.3&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;12&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.918&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.556&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;69.45&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;13&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.859&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.503&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;-12.44&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;14&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.03&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.194&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;15.95&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;15&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.907&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.331&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;156.89&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;16&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.337&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.524&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;55.21&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;17&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.679&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;5.537&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;229.75&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;18&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.779&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;8.695&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;212.84&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;19&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.5&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.584&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;72.31&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;20&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;1.347&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;2.007&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;49.0&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;21&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;4.58&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;7.678&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;67.63&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: right&quot;&gt;22&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.498&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;0.765&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: right&quot;&gt;53.83&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;p&gt;åœ¨ TPCH çš„æµ‹è¯•ä¸­ï¼Œdatafusion æ•´ä½“è½åäº duckdbï¼Œé™¤ 4&#x2F;13 è¦æ›´å¿«ä¸€äº›ä¹‹å¤–ï¼Œå…¶ä½™çš„ 20 ä¸ªæŸ¥è¯¢éƒ½æ›´æ…¢ï¼Œå·®è·æ¯”è¾ƒå¤§çš„æ˜¯ 2&#x2F;7&#x2F;11&#x2F;15&#x2F;17&#x2F;18 å·æŸ¥è¯¢ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;query-1-duckdb-datafusion-3-33s-4-971s-sf-10&quot;&gt;Query 1:   duckdb : datafusion =  3.33s : 4.971s (SF=10)&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;	l_returnflag,	l_linestatus,
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(l_quantity) as sum_qty,
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(l_extendedprice) as sum_base_price,
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(l_extendedprice &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;*&lt;&#x2F;span&gt;&lt;span&gt; (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;- l_discount)) as sum_disc_price,
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(l_extendedprice &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;*&lt;&#x2F;span&gt;&lt;span&gt; (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;- l_discount) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;*&lt;&#x2F;span&gt;&lt;span&gt; (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;+ l_tax)) as sum_charge,
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;avg&lt;&#x2F;span&gt;&lt;span&gt;(l_quantity) as avg_qty,
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;avg&lt;&#x2F;span&gt;&lt;span&gt;(l_extendedprice) as avg_price,
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;avg&lt;&#x2F;span&gt;&lt;span&gt;(l_discount) as avg_disc,
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;*&lt;&#x2F;span&gt;&lt;span&gt;) as count_order
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt;	lineitem
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt;	l_shipdate &amp;lt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;date &lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;1998-09-02&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by&lt;&#x2F;span&gt;&lt;span&gt;	l_returnflag,	l_linestatus
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;order by&lt;&#x2F;span&gt;&lt;span&gt;	l_returnflag,	l_linestatus 
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;datafusion
&lt;ul&gt;
&lt;li&gt;ç®—å­è€—æ—¶ï¼šä½¿ç”¨ &lt;code&gt;explain analyze&lt;&#x2F;code&gt;
&lt;ul&gt;
&lt;li&gt;DataSourceExec output_rows: 59,986,052 time_elapsed_processing: 1.029s&lt;&#x2F;li&gt;
&lt;li&gt;FilterExec     output_rows: 59,142,609 elapsed_compute: 173.698ms&lt;&#x2F;li&gt;
&lt;li&gt;CoalesceBatchesExec:  output_rows: 59,142,609 elapsed_compute: 624.365ms &lt;em&gt;DuckDB æ²¡æœ‰è¿™ä¸ªå¼€é”€&lt;&#x2F;em&gt;&lt;&#x2F;li&gt;
&lt;li&gt;ProjectionExec: elapsed_compute: 448.843035ms&lt;&#x2F;li&gt;
&lt;li&gt;AggregateExec:  output_rows: 4, elapsed_compute: 2.581794006s&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;4lrfgTI&quot;&gt;samply profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;duckdb 3.33s
&lt;ul&gt;
&lt;li&gt;ç®—å­è€—æ—¶
&lt;ul&gt;
&lt;li&gt;TableScan:   output_rows: 59142609, time: 1.20s&lt;&#x2F;li&gt;
&lt;li&gt;Projection:  0.12s + 0.11s&lt;&#x2F;li&gt;
&lt;li&gt;HASH_GROUP_BY:  1.85s&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;4l0qZsr&quot;&gt;samply profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹æ¯”
&lt;ul&gt;
&lt;li&gt;DataFusion çš„ CoalesceBatchExec å¼€é”€ 0.624sï¼Œåœ¨ DuckDB æ²¡æœ‰è¿™ä¸€æ­¥å¤„ç†ã€‚
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;set datafusion.execution.coalesce_batches = false&lt;&#x2F;code&gt; æ‰§è¡Œæ—¶ï¼Œå…¶æ•ˆæœä¸ duckdb ç›¸ä¼¼ï¼Œå‡å°‘äº†è¿™ä¸ªç®—å­çš„å¼€é”€&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;ProjectionExec, DataFusionå¤šè€—æ—¶ 0.218s
&lt;ul&gt;
&lt;li&gt;datafusion åªè®¡ç®—äº† &lt;code&gt;l_extendedprice * (1 - l_discount)&lt;&#x2F;code&gt; è€—æ—¶ 475ms&lt;&#x2F;li&gt;
&lt;li&gt;duckdb æœ‰ä¸¤ä¸ªè®¡ç®—ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;a: l_extendedprice * (1 - l_discount)&lt;&#x2F;code&gt; è€—æ—¶ 120ms&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;a * (1.00 + l_tax)&lt;&#x2F;code&gt; è€—æ—¶ 0.11s&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹æ¯”è€Œè¨€ï¼Œdatafusion åœ¨è¡¨è¾¾å¼æ±‚å€¼çš„æ‰§è¡Œæ•ˆç‡ä¸Šï¼Œè¦æ¯” duckdb æ…¢äº†å¾ˆå¤šã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;AggregateExec:  DataFusion å¤šè€—æ—¶ï¼š0.732s
&lt;ul&gt;
&lt;li&gt;datafusion éœ€è¦åœ¨è¿™ä¸ªé˜¶æ®µè¿›è¡Œæ›´å¤šçš„è¡¨è¾¾å¼è®¡ç®—ï¼Œä¸”æ‰§è¡Œæ•ˆç‡åªæœ‰ duckdb çš„ 25%&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;query-7-duckdb-datafusion-1-987s-5-536s&quot;&gt;Query 7: duckdb: datafusion = 1.987s : 5.536s&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;	supp_nation,	cust_nation,	l_year,	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(volume) as revenue	
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt;	(	
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n_name &lt;&#x2F;span&gt;&lt;span&gt;as supp_nation,	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n2&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n_name &lt;&#x2F;span&gt;&lt;span&gt;as cust_nation,	extract(year &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; l_shipdate) as l_year,	l_extendedprice &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;*&lt;&#x2F;span&gt;&lt;span&gt; (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;- l_discount) as volume	
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt;	supplier,	lineitem,	orders,	customer,	nation n1,	nation n2	
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt;	s_suppkey = l_suppkey	and o_orderkey = l_orderkey	and c_custkey = o_custkey	and s_nationkey = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n_nationkey
&lt;&#x2F;span&gt;&lt;span&gt;     and c_nationkey = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n2&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n_nationkey	
&lt;&#x2F;span&gt;&lt;span&gt;     and (	(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n_name &lt;&#x2F;span&gt;&lt;span&gt;= &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;FRANCE&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; and &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n2&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n_name &lt;&#x2F;span&gt;&lt;span&gt;= &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;GERMANY&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;)	or (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n_name &lt;&#x2F;span&gt;&lt;span&gt;= &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;GERMANY&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; and &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n2&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n_name &lt;&#x2F;span&gt;&lt;span&gt;= &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;FRANCE&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;)	)	
&lt;&#x2F;span&gt;&lt;span&gt;     and l_shipdate between &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;date &lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;1995-01-01&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; and &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;date &lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;1996-12-31&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;	
&lt;&#x2F;span&gt;&lt;span&gt;) as shipping	
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by&lt;&#x2F;span&gt;&lt;span&gt;	supp_nation,	cust_nation,	l_year	
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;order by&lt;&#x2F;span&gt;&lt;span&gt;	supp_nation,	cust_nation,	l_year;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;relation graph
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
     flowchart TD
       lineitem[lineitem 60m filtered 18.2m] --- orders[orders 15m] --- customer[customer 1.5m] --- nation_2[nation2 25 filtered 2]
       lineitem --- supplier[supplier 100K] --- nation_1[nation1 25 filtered 2]
     ```
&lt;&#x2F;div&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;datafusion&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Join Order:
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
         flowchart TD
           lineitem[lineitem 60m filtered 18.2m] ---|2| orders[orders 15m] ---|3| customer[customer 1.5m] ---|4| nation_2[nation2 25 filtered 2]
           lineitem ---|1| supplier[supplier 100K] ---|5| nation_1[nation1 25 filtered 2]
       ```
&lt;&#x2F;div&gt;
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
       flowchart TD
        S[supplier\n100K] --&amp;gt;|build| j1[Join\n18.2m]
        L[lineitem\n60m] --&amp;gt; f1[Filter\n18.2m] --&amp;gt;|input| j1 --&amp;gt;|build| j2[Join\n18.2m]
        O[orders\n15m] --&amp;gt;|input| j2 --&amp;gt;|build| j3[Join \n18.2m]
        C[customer\n1.5m] --&amp;gt;|input| j3 --&amp;gt;|build| j4[Join \n1.5m]
        N1[nation] --&amp;gt; f2[Filter\n2] --&amp;gt;|input| j4 --&amp;gt;|build| j5[Join\n58k]
        N2[nation] --&amp;gt; f3[Filter\n2] --&amp;gt;|input| j5 
       ```
&lt;&#x2F;div&gt;
å‚è€ƒè¿™ä¸ªå›¾ï¼šåŸºæœ¬ä¸Šï¼Œdatafusion é€‰æ‹©äº†å‡ ä¹æœ€å·®çš„ join-pathã€‚&lt;&#x2F;li&gt;
&lt;li&gt;DataSourceExec: lineitem, output_rows: 59,986,052, time_elapsed_processing: 1.21s&lt;&#x2F;li&gt;
&lt;li&gt;FilterExec lineitem, output_rows: 18,230,325, elapsed_compute: 151.385ms&lt;&#x2F;li&gt;
&lt;li&gt;CoalesceBatchExec: lineitem, elapsed_compute:28.304ms&lt;&#x2F;li&gt;
&lt;li&gt;DataSourceExec: Supplier, output rows: 100,000, time_elapsed_processing: 1.103ms&lt;&#x2F;li&gt;
&lt;li&gt;JoinExec (lineitem * Supplier), output rows: 18,230,325  build_time: 1.902ms   join_time: 217.514ms&lt;&#x2F;li&gt;
&lt;li&gt;CoalesceBatchExec( lineitem * supplier),  output rows: 18,230,325, elapsed_compute: 65.489ms&lt;&#x2F;li&gt;
&lt;li&gt;DataSourceExec(orders): output_rows: 15,000,000   time_elapsed_processing: 203.315ms&lt;&#x2F;li&gt;
&lt;li&gt;JoinExec( lineitem * Supplier * orders ): output_rows: 18230325, build_time: 2.245s, join_time: 554.960ms&lt;&#x2F;li&gt;
&lt;li&gt;JoinExec( lineitem * supplier * orders * customers: 1,500,000): output_rows: 18,230,325, build_time: 3.510002485s, join_time: 1.391s&lt;&#x2F;li&gt;
&lt;li&gt;JoinExec( lineitem * supplier * orders * customers * nation: 2): output_rows:  1,460,257    build time: 5.060385334s, join_time: 66.956ms&lt;&#x2F;li&gt;
&lt;li&gt;JoinExec( lineitem * supplier * orders * customers * nation * nation): output_rows: 58365,  build time: 5.147108365s  join_time; 5.428ms&lt;&#x2F;li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
datafusion çš„ explain analyze å¯¹ JOIN çš„ è€—æ—¶è®¡ç®—å¹¶ä¸å‡†ç¡®ï¼Œå…¶æ—¶é—´åŒ…æ‹¬äº†ä¸Šæ¸¸æ•°æ®çš„å¤„ç†æ—¶é—´ã€‚å®é™… build time æ²¡æœ‰è¿™ä¹ˆå¤§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;44D0Aes&quot;&gt;Samply Profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;duckdb&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Join Order
&lt;code&gt;(orders X (lineitem X (supplier X nation))) * (customer X nation)&lt;&#x2F;code&gt;
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
       flowchart TD
       lineitem[lineitem 60m filtered 18.2m] ---|3| orders[orders 15m] ---|5| customer[customer 1.5m] ---|4| nation_2[nation2 25 filtered 2]
       lineitem ---|2| supplier[supplier 100K] ---|1| nation_1[nation1 25 filtered 2]
       ```
&lt;&#x2F;div&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;duckdb å¯¹ JOIN æœ‰ right filter left çš„ ä¼˜åŒ–ï¼Œå¯ä»¥å¤§å¤§çš„å‡å°‘ probe side çš„æ‰«ææˆæœ¬&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ä½œä¸ºå¯¹æ¯”ï¼š duckdb çš„ JOIN è€—æ—¶æ€»å…±ä¸º 430msã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;4nnkj9q&quot;&gt;Samply Profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹æ¯”&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹è¿™ä¸ªæŸ¥è¯¢ï¼Œduckdb å¤„ç†çš„å…³è”é¡ºåºåŸºæœ¬ä¸Šæ˜¯é”™è¯¯çš„ï¼Œæœ€ä½³çš„å…³è”é¡ºåºåº”è¯¥æ˜¯ &lt;code&gt;(filter(lineitem) X supplier X orders X customer X nation X nation &lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
å°è¯•æ‰‹åŠ¨ç¼–å†™ç‰©ç†æŸ¥è¯¢è®¡åˆ’ï¼Œæ¥åšä¸€ä¸ªæ€§èƒ½å¯¹æ¯”&lt;&#x2F;li&gt;
&lt;li&gt;Coalesceå¸¦æ¥äº†é¢å¤–çš„å¼€é”€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨ CTE æ–¹å¼æ”¹å†™ä¸Šé¢çš„ SQL&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;with&lt;&#x2F;span&gt;&lt;span&gt; j1 as (
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;s&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;s_suppkey&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n_name &lt;&#x2F;span&gt;&lt;span&gt;as supp_nation &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; supplier s &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;join&lt;&#x2F;span&gt;&lt;span&gt; nation n1 on &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;s&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;s_nationkey &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n_nationkey
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n_name &lt;&#x2F;span&gt;&lt;span&gt;in (&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;FRANCE&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;GERMANY&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;)
&lt;&#x2F;span&gt;&lt;span&gt; ),
&lt;&#x2F;span&gt;&lt;span&gt; j2 as (
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;c&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;c_custkey&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n2&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n_name &lt;&#x2F;span&gt;&lt;span&gt;as cust_nation &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; customer c &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;join&lt;&#x2F;span&gt;&lt;span&gt; nation n2 on &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;c&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;c_nationkey &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n2&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n_nationkey
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n2&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;n_name &lt;&#x2F;span&gt;&lt;span&gt;in (&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;FRANCE&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;GERMANY&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;)
&lt;&#x2F;span&gt;&lt;span&gt; ),
&lt;&#x2F;span&gt;&lt;span&gt; j3 as (
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_orderkey&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;j2&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;cust_nation &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; orders o &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;join&lt;&#x2F;span&gt;&lt;span&gt; j2 on &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_custkey &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;j2&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;c_custkey
&lt;&#x2F;span&gt;&lt;span&gt; ),
&lt;&#x2F;span&gt;&lt;span&gt; j4 as (
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt; extract(year &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; l_shipdate) as l_year,
&lt;&#x2F;span&gt;&lt;span&gt;     l_extendedprice &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;*&lt;&#x2F;span&gt;&lt;span&gt; (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;- l_discount) as volume, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;j1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;supp_nation&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;l&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;l_orderkey
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; lineitem l &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;join&lt;&#x2F;span&gt;&lt;span&gt; j1 on &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;l&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;l_suppkey &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;j1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;s_suppkey
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt; l_shipdate between &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;date &lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;1995-01-01&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; and &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;date &lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;1996-12-31&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;
&lt;&#x2F;span&gt;&lt;span&gt; ),
&lt;&#x2F;span&gt;&lt;span&gt; j5 as (
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt; l_year, volume, supp_nation, cust_nation
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; j4 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;join&lt;&#x2F;span&gt;&lt;span&gt; j3 on l_orderkey = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;j3&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_orderkey
&lt;&#x2F;span&gt;&lt;span&gt; )
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;      supp_nation,    cust_nation,    l_year, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(volume) as revenue
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; j5
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt; (supp_nation = &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;FRANCE&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; and cust_nation = &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;GERMANY&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;) or (supp_nation = &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;GERMANY&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; and cust_nation = &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;FRANCE&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;)
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by&lt;&#x2F;span&gt;&lt;span&gt;     supp_nation,    cust_nation,    l_year
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;order by&lt;&#x2F;span&gt;&lt;span&gt;     supp_nation,    cust_nation,    l_year            
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
è¿™ä¸ª SQL ç†è®ºä¸Šæ˜¯é’ˆå¯¹è¿™ä¸ª case çš„æœ€ä½³æ‰§è¡Œè®¡åˆ’ï¼Œåœ¨ duckdb ä¸­ä¸åŸå§‹ç‰ˆæœ¬å‡ ä¹ä¸€è‡´ï¼ˆ1.98s ä¼˜åŒ–å¹¶ä¸æ˜æ˜¾ï¼‰ï¼Œdatafusion ä¸­æ‰§è¡Œæ—¶é—´æå‡åˆ° 2.90s(æ”¹å†™å‰ï¼š5.536s)
è¿™ä¹ŸéªŒè¯äº† join çš„é¡ºåºå¯¹æ€§èƒ½çš„å½±å“æ˜¯æ˜¾è‘—çš„
&lt;blockquote&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆè¿™ä¸ªæœ€ä¼˜åŒ–çš„æŸ¥è¯¢è®¡åˆ’ä»ç„¶ä¸å¦‚ duckdb? ç»è¿‡æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œdatafusion ä»ç„¶æ²¡æœ‰æ­£ç¡®çš„å¤„ç† build side å’Œ probe side, é€‰æ‹©äº†
æ•°æ®é‡æ›´å¤§çš„ä¸€ç«¯ä½œä¸º build sideï¼Œ ç›®å‰ï¼Œdatafusion æ— æ³•åœ¨ SQL ä¸­ä½¿ç”¨ tips è¿›è¡Œè°ƒæ•´ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;è¿™ä¸ªæ¡ˆä¾‹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å­¦ä¹  Join ä¼˜åŒ–çš„æ¡ˆä¾‹ï¼Œæˆ‘ä¼šç»“åˆè¿™ä¸ªæ¡ˆä¾‹æ¥é˜…è¯»è®ºæ–‡ ã€ŠDynamic Programming Strikes Backã€‹ ä»¥åŠ æ·±å¯¹è¿™æ–¹é¢çŸ¥è¯†çš„ç†è§£ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;query-17-subquery-duckdb-2-152s-datafusion-7-091s&quot;&gt;Query 17: subquery duckdb 2.152s : datafusion 7.091s&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(l_extendedprice) &#x2F; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;7&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 &lt;&#x2F;span&gt;&lt;span&gt;as avg_yearly
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt;	lineitem,	part
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt;	p_partkey = l_partkey	and p_brand = &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Brand#23&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;	and p_container = &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;MED BOX&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;
&lt;&#x2F;span&gt;&lt;span&gt;  and l_quantity &amp;lt; (	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;* &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;avg&lt;&#x2F;span&gt;&lt;span&gt;(l_quantity)	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt;	lineitem	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt;	l_partkey = p_partkey ) 
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;datafusion
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
        flowchart TD
        A[&amp;quot;ProjectionExec&amp;lt;br&amp;gt;---&amp;lt;br&amp;gt;avg_yearly:&amp;lt;br&amp;gt;CAST(sum(l_extendedprice) AS Float64) &amp;#x2F; 7&amp;quot;]
        B[&amp;quot;AggregateExec&amp;lt;br&amp;gt;---&amp;lt;br&amp;gt;aggr: sum(l_extendedprice)&amp;lt;br&amp;gt;mode: Single&amp;quot;]
        C[&amp;quot;HashJoinExec&amp;lt;br&amp;gt;---&amp;lt;br&amp;gt;on: (p_partkey = l_partkey)&amp;lt;br&amp;gt;5526rows, build: 50ms join: 5ms&amp;quot;]
        D[&amp;quot;HashJoinExec&amp;lt;br&amp;gt;---&amp;lt;br&amp;gt;on: (l_partkey = p_partkey)&amp;quot;&amp;lt;br&amp;gt;61385rows, build: 1.92s, join: 11ms]
        E[&amp;quot;ProjectionExec&amp;lt;br&amp;gt;---&amp;lt;br&amp;gt;exprs:&amp;lt;br&amp;gt;0.2 * avg(l_quantity)&amp;lt;br&amp;gt;l_partkey&amp;lt;br&amp;gt;2m rows, 15ms&amp;quot;]
        F[&amp;quot;AggregateExec&amp;lt;br&amp;gt;---&amp;lt;br&amp;gt;aggr: avg(l_quantity)&amp;lt;br&amp;gt;group_by: l_partkey&amp;lt;br&amp;gt;mode: Single&amp;lt;br&amp;gt;2m rows, 2.553s&amp;quot;]
        G[&amp;quot;DataSourceExec&amp;lt;br&amp;gt;---&amp;lt;br&amp;gt;files: 1&amp;lt;br&amp;gt;format: parquet&amp;lt;br&amp;gt;59.9m rows 1.03s&amp;quot;]
        H[&amp;quot;FilterExec&amp;lt;br&amp;gt;---&amp;lt;br&amp;gt;predicate:&amp;lt;br&amp;gt;p_brand = Brand#23&amp;lt;br&amp;gt;AND&amp;lt;br&amp;gt;p_container = MED BOX&amp;lt;br&amp;gt;2044rows, 11ms&amp;quot;]
        I[&amp;quot;DataSourceExec&amp;lt;br&amp;gt;---&amp;lt;br&amp;gt;files: 1&amp;lt;br&amp;gt;format: parquet&amp;lt;br&amp;gt;predicate applied&amp;lt;br&amp;gt;2m rows, 24.9ms&amp;quot;]
        J[&amp;quot;DataSourceExec&amp;lt;br&amp;gt;---&amp;lt;br&amp;gt;files: 1&amp;lt;br&amp;gt;format: parquet &amp;lt;br&amp;gt;59.9m rows, 500ms&amp;quot;]

        A --&amp;gt; B
        B --&amp;gt; C
        C --&amp;gt; D
        C --&amp;gt; E
        D --&amp;gt; G
        D --&amp;gt; H
        H --&amp;gt; I
        E --&amp;gt; F
        F --&amp;gt; J
     ```
&lt;&#x2F;div&gt;
&lt;ul&gt;
&lt;li&gt;ä¸¤ä¸ªè€—æ—¶çš„ç®—å­ï¼š aggregate 2.553s,  hashjoin: 1.92s(JOINé¡ºåºä¸å¿§)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;duckdb
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
      flowchart TD
      A1[&amp;quot;Total Time: 4.55s&amp;quot;]
      A2[&amp;quot;QUERY&amp;quot;]
      A3[&amp;quot;EXPLAIN_ANALYZE&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;0 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      A4[&amp;quot;PROJECTION&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;avg_yearly&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;1 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      A5[&amp;quot;UNGROUPED_AGGREGATE&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;Aggregates: sum(#0)&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;1 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      A6[&amp;quot;PROJECTION&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;l_extendedprice&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;5526 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      A7[&amp;quot;PROJECTION&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;#2&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;5526 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      A8[&amp;quot;FILTER&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;(CAST(l_quantity AS DOUBLE&amp;lt;br&amp;gt;) &amp;lt; SUBQUERY)&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;5526 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      A9[&amp;quot;RIGHT_DELIM_JOIN&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;Join Type: RIGHT&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;Conditions:&amp;lt;br&amp;gt;p_partkey IS NOT DISTINCT&amp;lt;br&amp;gt;FROM p_partkey&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;Delim Index: 1&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;0 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      B1[&amp;quot;HASH_JOIN&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;Join Type: INNER&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;Conditions:&amp;lt;br&amp;gt;l_partkey = p_partkey&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;61385 Rows&amp;lt;br&amp;gt;(0.28s)&amp;quot;]
      B2[&amp;quot;HASH_JOIN&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;Join Type: RIGHT&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;Conditions:&amp;lt;br&amp;gt;p_partkey IS NOT DISTINCT&amp;lt;br&amp;gt;FROM p_partkey&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;61385 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      B3[&amp;quot;HASH_GROUP_BY&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;Groups: #0&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;2044 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      C1[&amp;quot;TABLE_SCAN&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;Function:&amp;lt;br&amp;gt;READ_PARQUET&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;Projections:&amp;lt;br&amp;gt;l_partkey&amp;lt;br&amp;gt;l_quantity&amp;lt;br&amp;gt;l_extendedprice&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;Total Files Read: 1&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;59905251 Rows&amp;lt;br&amp;gt;(2.20s)&amp;quot;]
      C2[&amp;quot;TABLE_SCAN&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;Function:&amp;lt;br&amp;gt;READ_PARQUET&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;Projections:&amp;lt;br&amp;gt;p_partkey&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;Filters:&amp;lt;br&amp;gt;p_brand=&amp;#x27;Brand#23&amp;#x27;&amp;lt;br&amp;gt;p_container=&amp;#x27;MED BOX&amp;#x27;&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;Total Files Read: 1&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;2044 Rows&amp;lt;br&amp;gt;(1.17s)&amp;quot;]
      D2[&amp;quot;DUMMY_SCAN&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;0 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      E1[&amp;quot;PROJECTION&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;(0.2 * avg(l_quantity))&amp;lt;br&amp;gt;p_partkey&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;2044 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      E2[&amp;quot;PROJECTION&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;__internal_decompress_integral_bigint(#0, 1)&amp;lt;br&amp;gt;#1&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;2044 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      E3[&amp;quot;HASH_GROUP_BY&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;Groups: #0&amp;lt;br&amp;gt;Aggregates: avg(#1)&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;2044 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      E4[&amp;quot;PROJECTION&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;p_partkey&amp;lt;br&amp;gt;l_quantity&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;61385 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      E5[&amp;quot;PROJECTION&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;#0&amp;lt;br&amp;gt;__internal_compress_integral_l_uinteger(#1, 1)&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;61385 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      E6[&amp;quot;PROJECTION&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;l_quantity&amp;lt;br&amp;gt;p_partkey&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;61385 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]
      E7[&amp;quot;HASH_JOIN&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;Join Type: INNER&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;Conditions:&amp;lt;br&amp;gt;l_partkey = p_partkey&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;61385 Rows&amp;lt;br&amp;gt;(0.27s)&amp;quot;]
      F1[&amp;quot;TABLE_SCAN&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;Function:&amp;lt;br&amp;gt;READ_PARQUET&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;Projections:&amp;lt;br&amp;gt;l_partkey&amp;lt;br&amp;gt;l_quantity&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;Total Files Read: 1&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;59905251 Rows&amp;lt;br&amp;gt;(0.57s)&amp;quot;]
      F2[&amp;quot;DELIM_SCAN&amp;lt;br&amp;gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;lt;br&amp;gt;Delim Index: 1&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;0 Rows&amp;lt;br&amp;gt;(0.00s)&amp;quot;]

      A1 --&amp;gt; A2
      A2 --&amp;gt; A3
      A3 --&amp;gt; A4
      A4 --&amp;gt; A5
      A5 --&amp;gt; A6
      A6 --&amp;gt; A7
      A7 --&amp;gt; A8
      A8 --&amp;gt; A9
      A9 --&amp;gt; B1
      A9 --&amp;gt; B2
      A9 --&amp;gt; B3
      B1 --&amp;gt; C1
      B1 --&amp;gt; C2

      B2 --&amp;gt; E1
      B2 --&amp;gt; D2
      E1 --&amp;gt; E2
      E2 --&amp;gt; E3
      E3 --&amp;gt; E4
      E4 --&amp;gt; E5
      E5 --&amp;gt; E6
      E6 --&amp;gt; E7
      E7 --&amp;gt; F1
      E7 --&amp;gt; F2
     ```
&lt;&#x2F;div&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;query-18-duckdb-3-495s-vs-datafusion-9-567s&quot;&gt;Query 18:  duckdb: 3.495s vs datafusion: 9.567s&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;	c_name,	c_custkey,	o_orderkey,	o_orderdate,	o_totalprice,	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(l_quantity)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt;	customer,	orders,	lineitem
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where	
&lt;&#x2F;span&gt;&lt;span&gt;    o_orderkey in (
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;	l_orderkey	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt;	lineitem	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by&lt;&#x2F;span&gt;&lt;span&gt;	l_orderkey having	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(l_quantity) &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;300
&lt;&#x2F;span&gt;&lt;span&gt;    )	
&lt;&#x2F;span&gt;&lt;span&gt;    and c_custkey = o_custkey	and o_orderkey = l_orderkey
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by&lt;&#x2F;span&gt;&lt;span&gt;	c_name,	c_custkey,	o_orderkey,	o_orderdate,	o_totalprice
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;order by&lt;&#x2F;span&gt;&lt;span&gt;	o_totalprice &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;desc&lt;&#x2F;span&gt;&lt;span&gt;,	o_orderdate
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;duckdb&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt;  let a = (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;	l_orderkey	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt;	lineitem	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by&lt;&#x2F;span&gt;&lt;span&gt;	l_orderkey having	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(l_quantity) &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;300&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;  let b = lineitem &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;inner join&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;              (orders &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;inner join&lt;&#x2F;span&gt;&lt;span&gt; a on &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;orders&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_orderkey &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;a&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o_orderkey&lt;&#x2F;span&gt;&lt;span&gt;) 
&lt;&#x2F;span&gt;&lt;span&gt;              &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;inner join&lt;&#x2F;span&gt;&lt;span&gt; customers c on &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;o&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;custkey &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;c&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;custkey 
&lt;&#x2F;span&gt;&lt;span&gt;          )
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;datafusion&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt;let a = (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt; l_orderkey, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(l_quanitity) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; lineitem &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;having &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(l_quanitity))
&lt;&#x2F;span&gt;&lt;span&gt;let b = (lineitem  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;inner join&lt;&#x2F;span&gt;&lt;span&gt; (orders &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;inner join&lt;&#x2F;span&gt;&lt;span&gt; customer))
&lt;&#x2F;span&gt;&lt;span&gt;b semi &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;join&lt;&#x2F;span&gt;&lt;span&gt; a
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
BUG: set datafusion.execution.coalesce_batches = false; æ‰§è¡Œè¯¥SQL è¯­å¥ä¼šè¶…æ—¶&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;ç»“è®ºï¼šduckdb å¯¹ JOIN é¡ºåºè¿›è¡Œäº†æ›´ä¼˜çš„ä¼˜åŒ–ï¼Œåœ¨è¿™ä¸ªæŸ¥è¯¢ä¸­ï¼Œå°†å…·æœ‰æ›´å¥½ç­›é€‰ä½œç”¨çš„ o_orderkey in subquery é‡ç»„é¡ºåºåï¼Œä½¿å¾—å°½æ—©çš„å‡å°‘äº†æ•°æ®é‡ï¼Œå°†æŸ¥è¯¢å¤§å¤§åŠ é€Ÿã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;åç»­å°†å¯¹å…¶ä»– Case è¿›è¡Œæ€§èƒ½å¯¹æ¯”åˆ†æã€‚&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;datafusion explain format = tree æ—¶ï¼ŒHashJoin æŒ‰ç…§ build-side, probe-side çš„å·¦å³é¡ºåºã€‚&lt;&#x2F;li&gt;
&lt;li&gt;datafusion explain format = indent æ—¶ï¼ŒHashJoin æŒ‰ç€ build-side, probe-side çš„ä¸Šä¸‹é¡ºåº&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;blockquote&gt;
&lt;h1 id=&quot;jie-lun-datafusion-xing-neng-de-zhu-yao-yin-su&quot;&gt;ç»“è®ºï¼š datafusion æ€§èƒ½çš„ä¸»è¦å› ç´ &lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;CoalesceBatchExec å¸¦æ¥çš„é¢å¤–å¼€é”€. å‚è€ƒ TPCH-Query1&lt;&#x2F;li&gt;
&lt;li&gt;å…¬å…±è¡¨è¾¾å¼æå–ä¼˜åŒ–ä¸å¤Ÿ:  TPCH-Query1, ClickBench-Query30&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹ &lt;code&gt;select * from ... limit 10&lt;&#x2F;code&gt; è¿™æ ·çš„æŸ¥è¯¢ï¼ŒæŸ¥è¯¢è®¡åˆ’ä¸å¤Ÿä¼˜åŒ–ï¼Œå¯¼è‡´äº†å¤§é‡çš„æ•°æ®æ‰«æã€‚ ClickBench-Query24&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹è¡¨è¾¾å¼æ±‚å€¼ï¼Œdatafusion çš„æ‰§è¡Œæ•ˆç‡è¿œä½äº duckdbï¼ˆ~25%ï¼‰ã€‚è¿™ä¸ªéœ€è¦è¿›ä¸€æ­¥æ ¸å®ï¼Œå¯¹æ¯”ï¼Œåœ¨å¤§æ•°æ®é‡ä¸‹å¯¹æ€§èƒ½æœ‰æ™®éæ€§çš„å½±å“ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;JOIN çš„æ€§èƒ½
&lt;ul&gt;
&lt;li&gt;duckdb ç”Ÿæˆäº†æ›´åˆç†çš„ JOIN é¡ºåºï¼ŒåŒ…æ‹¬
&lt;ul&gt;
&lt;li&gt;é€‰æ‹©æ•°æ®é‡æ›´å°çš„è¾¹ä½œä¸º build-side&lt;&#x2F;li&gt;
&lt;li&gt;é‡æ’ JOIN çš„é¡ºåºï¼Œä½¿å¾—å…·æœ‰æ›´å¥½ç­›é€‰ä½œç”¨çš„ JOIN æå‰æ‰§è¡Œã€‚ TPCH-18&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;hashjoin ç®—å­çš„æ‰§è¡Œæ•ˆç‡ä¸å¦‚ duckdbã€‚&lt;&#x2F;li&gt;
&lt;li&gt;duckdb æ”¯æŒ Dynamic Filter PushDown ä¼˜åŒ–ï¼Œåœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œå¯ä»¥å¤§å¹…åº¦æå‡æ€§èƒ½&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
å¦‚æœèƒ½å¤Ÿæä¾›å¯¹è¡¨è¾¾å¼æ±‚å€¼çš„æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯ï¼Œå¯¹å®šä½æ€§èƒ½ä¼šæœ‰æ›´å¥½çš„å¸®åŠ©&lt;&#x2F;li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
datafusion çš„ explain analyze ä¸èƒ½ä»¥ tree çš„æ–¹å¼æ˜¾ç¤ºï¼Œå¯é˜…è¯»æ€§å¼±äº duckdbï¼Œç†è§£è€—æ—¶éœ€è¦æ¶ˆè€—æ›´å¤šæ—¶é—´ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;datafusion-wen-zhang-xi-lie&quot;&gt;datafusion æ–‡ç« ç³»åˆ—&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;duck-push-vs-datafusion-pull&#x2F;&quot;&gt;push vs pull&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-hashjoin&#x2F;&quot;&gt;datafusion hashjoin executor&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-window-function&#x2F;&quot;&gt;datafusion window function executor&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-performance&#x2F;&quot;&gt;datafusion performance&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Jun 2025</title>
        <published>2025-06-02T00:00:00+00:00</published>
        <updated>2025-06-02T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2025-06/"/>
        <id>https://wangzaixiang.github.io/monthly/2025-06/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2025-06/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;Rust
&lt;ul&gt;
&lt;li&gt;Async from scratch ç³»åˆ—æ•™ç¨‹
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;natkr.com&#x2F;2025-04-10-async-from-scratch-1&#x2F;&quot;&gt;1: What is in a Future, anyway?&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;natkr.com&#x2F;2025-04-15-async-from-scratch-2&#x2F;&quot;&gt;2: Wake me maybe&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;natkr.com&#x2F;2025-05-22-async-from-scratch-3&#x2F;&quot;&gt;3: Pinned against the wall &lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;NLnetLabs&#x2F;roto&quot;&gt;Roto&lt;&#x2F;a&gt; An Embedded script language that is fast, safe and easy to use.
è¿™ä¸ªè„šæœ¬è¯­è¨€åœ¨æŸç§ç¨‹åº¦ä¸Šå¾ˆç¬¦åˆæˆ‘çš„ä¸ªäººåå¥½ï¼Œä¸è¿‡ï¼Œå†…åœ¨çš„ä¸æ”¯æŒ loop çš„è®¾è®¡æ˜¯å¦ä¼šé™åˆ¶è¯­è¨€çš„åº”ç”¨åœºæ™¯ï¼Ÿä½œä¸ºä¸€ä¸ª safe çš„è„šæœ¬è¯­è¨€ï¼Œå…¶è¾¹ç•Œå¿…é¡»æ˜¯
ç²¾å¿ƒæ§åˆ¶çš„ï¼Œå¼ºç±»å‹é€‚åˆäº compiledï¼ˆåŸºäº&lt;a href=&quot;https:&#x2F;&#x2F;cranelift.dev&quot;&gt;cranelift&lt;&#x2F;a&gt;é¡¹ç›®ï¼‰ï¼Œè¿™æœ‰åˆ©äºé²æ£’æ€§å’Œæ€§èƒ½ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;SIMD in zlib-rs
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;tweedegolf.nl&#x2F;en&#x2F;blog&#x2F;153&#x2F;simd-in-zlib-rs-part-1-autovectorization-and-target-features&quot;&gt;Autovectorization and target features&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;tweedegolf.nl&#x2F;en&#x2F;blog&#x2F;155&#x2F;simd-in-zlib-rs-part-2-compare256&quot;&gt;compare256&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;developerlife.com&#x2F;2025&#x2F;05&#x2F;19&#x2F;rust-mem-latency&#x2F;&quot;&gt;Rust memory latency and performance&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=m7PVZixO35c&amp;amp;feature=youtu.be&quot;&gt;New CPUs don&#x27;t speed up old code&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;youtu.be&#x2F;WwkuAqObplU&quot;&gt;Data oriented design&lt;&#x2F;a&gt;: Flat dara structure are better for memory locality&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;youtu.be&#x2F;Dhn-JgZaBWo&quot;&gt;Memory Latency vs CPU operation&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;youtu.be&#x2F;pJ-FRRB5E84&amp;amp;t=1831&quot;&gt;Memory Allocation Tips&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;smallvec&#x2F;latest&#x2F;smallvec&#x2F;struct.SmallVec.html&quot;&gt;smallvec&lt;&#x2F;a&gt; ç±»ä¼¼äº Arrow çš„ &lt;a href=&quot;https:&#x2F;&#x2F;arrow.apache.org&#x2F;docs&#x2F;format&#x2F;Columnar.html#variable-size-binary-view-layout&quot;&gt;Variable-size Binary View Layout&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;smallstr&#x2F;0.3.0&#x2F;smallstr&#x2F;&quot;&gt;smallstr&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;monthly&#x2F;2025-06&#x2F;memory_latency.svg&quot; alt=&quot;memory_latency.svg&quot; &#x2F;&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Stack vs heap ä»¥åŠå¹¿ä¹‰çš„ç±» String&#x2F;Vec æ•°æ®ç»“æ„ä¸­çš„ä¸€çº§å­˜å‚¨ã€äºŒçº§å­˜å‚¨ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;rust drop å¼€é”€æ¯” alloc è¦å¤§: æ˜¯å¦æ˜¯å› ä¸º drop è‡ªèº«çš„å¼€é”€è€Œé deallocï¼Ÿ&lt;&#x2F;li&gt;
&lt;li&gt;memory alignment å¯¹æ€§èƒ½çš„å½±å“&lt;&#x2F;li&gt;
&lt;li&gt;Global Allocators
&lt;ul&gt;
&lt;li&gt;jemalloc: å¤šçº¿ç¨‹ã€å¤§é‡å°å¯¹è±¡(chunkè®¾è®¡)&lt;&#x2F;li&gt;
&lt;li&gt;default&#x2F;ptmalloc:  å•çº¿ç¨‹&lt;&#x2F;li&gt;
&lt;li&gt;tcmalloc: ä¸‰çº§ ThreadCache + CentralCache + PageHeapï¼Œ è‡ªæ—‹é”, å°å¯¹è±¡æ— é”åˆ†é…ï¼Œç¬æ€é«˜å¹¶å‘&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;RingBufferï¼šä½¿ç”¨æ•°ç»„æ¨¡æ‹Ÿé“¾è¡¨ï¼Œæ›´å¥½çš„å†…å­˜å±€éƒ¨æ€§&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;SIMD
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;simd-everywhere&#x2F;simde&quot;&gt;simd-everywhere&lt;&#x2F;a&gt; è½¯ä»¶ä»¿çœŸçš„æ–¹å¼æ¨¡æ‹Ÿ SIMD æŒ‡ä»¤ã€‚ARM çš„ SIMD æŒ‡ä»¤å‚è€ƒèµ„æ–™å¾ˆéš¾é˜…è¯»ï¼Œå¯ä»¥é€šè¿‡
è¿™ä¸ªç«™ç‚¹ï¼Œæ¥ç†è§£è¿™äº›æŒ‡ä»¤æ˜¯å¦‚ä½•ä»¿çœŸæ‰§è¡Œçš„ã€‚ä¸è¿‡ï¼Œå¥½åƒæœ‰ä¸å°‘æŒ‡ä»¤å¹¶æ²¡æœ‰å®ç°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;linebender.org&#x2F;blog&#x2F;a-plan-for-simd&#x2F;&quot;&gt;a plan for simd&lt;&#x2F;a&gt; &lt;code&gt;Linebender&lt;&#x2F;code&gt;çš„ SIMD å®ç°è®¡åˆ’ã€‚
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ 256 bit width: èƒ½å¾ˆå¥½çš„åŒ¹é… AVX2, åœ¨ NEON ä¸Šä½¿ç”¨2ä¸ªå¯„å­˜å™¨è¿›è¡Œæ¨¡æ‹Ÿã€‚è€ƒè™‘åˆ° Neon æœ‰32ä¸ª128ä½å¯„å­˜å™¨ï¼Œä»ç„¶æœ‰è¶³å¤Ÿçš„å¤„ç†èƒ½åŠ›ï¼ˆåœ¨M1ç³»åˆ—èŠ¯ç‰‡ä¸Šï¼ŒåŸºæœ¬ç­‰æ•ˆäº16 x 256 çš„AVX2ï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ–‡ä¸­æåˆ° AVX512 ç›¸æ¯” AVX256ï¼Œæ€§èƒ½æå‡æœ‰é™ï¼Œ&lt;code&gt;a 512 bit vector is processed in two clock cycles (see mersenneforum post for more details), each handling 256 bits&lt;&#x2F;code&gt;,
è¿™ç§è¯´æ³•ï¼Œä½†æ²¡æœ‰æåˆ°ç¡®åˆ‡çš„ä¿¡æ¯æ¥æºã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ &lt;a href=&quot;https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s?__biz=MzUzMDI5OTA5NQ==&amp;amp;mid=2247487111&amp;amp;idx=1&amp;amp;sn=6d0577675df2d7649c78434d7c3aa3df&amp;amp;chksm=fb8cd799a5e3c39b87e6073f8b27607da43498205097d82bb4ef383ccadeb708fb48f098d0f0#rd&quot;&gt;Milvis&lt;&#x2F;a&gt;
ä¸­æœ‰ AVX2 vs AVX512 çš„å¯¹æ¯”ï¼Œæœ‰æå‡ 20%-65%ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;AVX512 å¯èƒ½ä¼šå¯¼è‡´ CPU é™é¢‘ï¼Œæœ€ç»ˆæ€§èƒ½æå‡æ‰“äº†æŠ˜æ‰£ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;MPP &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;DuckDB æºä»£ç é˜…è¯»ç³»åˆ—æ–‡ç« 
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;21013348181&quot;&gt;parser&lt;&#x2F;a&gt; è¯­æ³•åˆ†æï¼Œç”ŸæˆAST&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;21019887715&quot;&gt;binder&lt;&#x2F;a&gt;, symbol(table&#x2F;column) resolver&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;21027047841&quot;&gt;logical operators&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;21028438818&quot;&gt;logical plan&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;21030374102&quot;&gt;ä¼˜åŒ–å™¨&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;21100427584&quot;&gt;Expression Rewriter, SumRewriterOptimizer, FilterPullup&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;21179256764&quot;&gt;FilterPushDown&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;21395872495&quot;&gt;Deliminator&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;24105415637&quot;&gt;JoinOrder&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;21131398911&quot;&gt;ä¼˜åŒ–å™¨æ€»ç»“&lt;&#x2F;a&gt;
ä¹‹å‰æˆ‘é˜…è¯»äº† backend çš„å‡ ä¸ªç®—å­æºä»£ç ï¼Œé€šè¿‡è¿™ä¸ªç³»åˆ—ï¼ŒåŠ æ·±å¯¹å‰ç«¯çš„å­¦ä¹ ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;web-frontend&quot;&gt;Web &amp;amp; Frontend&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;How Rolldown Works
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.atriiy.dev&#x2F;blog&#x2F;rolldown-module-loader-and-dependency-graph&quot;&gt;Module Loading, Dependency Graphs, and Optimization Explained&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.atriiy.dev&#x2F;blog&#x2F;rolldown-link-stage-symbol-linking-resolution&quot;&gt;Symbol Linking, CJS&#x2F;ESM Resolution, and Export Analysis Explained&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;tools-libraries&quot;&gt;Tools &amp;amp; Libraries&lt;&#x2F;h1&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>datafusion window function execution</title>
        <published>2025-05-26T00:00:00+00:00</published>
        <updated>2025-05-26T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/datafusion-window-function/"/>
        <id>https://wangzaixiang.github.io/blog/datafusion-window-function/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/datafusion-window-function/">&lt;h1 id=&quot;api-shi-yong-chuang-kou-han-shu&quot;&gt;API: ä½¿ç”¨çª—å£å‡½æ•°&lt;&#x2F;h1&gt;
&lt;p&gt;çª—å£å‡½æ•°æ˜¯é’ˆå¯¹æ•°æ®åˆ†æçš„ä¸€ä¸ª SQL æŸ¥è¯¢æ‰©å±•ï¼Œå…¶æ‰§è¡Œé¡ºåºå¦‚ä¸‹å›¾ä¸­ï¼Œ
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-window-function&#x2F;sql-execute-plan.png&quot; alt=&quot;SQL æ‰§è¡Œé¡ºåº&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;ä¸€èˆ¬çš„ï¼Œçª—å£å‡½æ•°çš„è¯­æ³•å¦‚ä¸‹ï¼š
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-window-function&#x2F;window_expr_grammar.png&quot; alt=&quot;window_expr_grammar.png&quot; &#x2F;&gt;
æ¥æºï¼šhttps:&#x2F;&#x2F;duckdb.org&#x2F;docs&#x2F;stable&#x2F;sql&#x2F;functions&#x2F;window_functions&lt;&#x2F;p&gt;
&lt;p&gt;datafusion æä¾›äº†å¯¹çª—å£å‡½æ•°çš„æ”¯æŒï¼Œä¸è¿‡ï¼Œç›®å‰çš„ç‰ˆæœ¬æ”¯æŒç¨‹åº¦ä»ç„¶ä¸å¦‚ duckdbï¼Œæˆ‘ç›®å‰å‘ç°çš„é—®é¢˜æ˜¯ï¼š frame ä¸­ç›®å‰ä»…æ”¯æŒ literal expr,
è¿™é™åˆ¶äº†åŸºäºå½“å‰è¡Œçš„ dynamic range çš„æ”¯æŒèƒ½åŠ›ï¼Œä¾‹å¦‚ï¼Œå…¸å‹çš„ ä¸Šå¹´åŒæœŸå¹´ç´¯ è¿™æ ·çš„è®¡ç®—ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨ duckdb ä¸­ï¼Œå¯ä»¥è¡¨ç¤ºä¸º&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;SUM&lt;&#x2F;span&gt;&lt;span&gt;( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;SUM&lt;&#x2F;span&gt;&lt;span&gt;(amount) ) over (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;order by&lt;&#x2F;span&gt;&lt;span&gt; order_date 
&lt;&#x2F;span&gt;&lt;span&gt;  range between to_days( order_date - (date_trunc(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;year&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, order_date&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;year&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;) - interval &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt; year)) preceding 
&lt;&#x2F;span&gt;&lt;span&gt;  and interval &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt; year preceding )
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;æœ¬æ–‡åˆ†æçš„ç›®çš„ä¹‹ä¸€å°±æ˜¯å¯¹ datafusion çš„çª—å£å‡½æ•°æ‰§è¡Œæœºåˆ¶è¿›è¡Œç ”ç©¶ï¼Œå¹¶è¯„ä¼°ä¸ºå…¶æ·»åŠ ä¸Šè¿™ç±»èƒ½åŠ›çš„å¯è¡Œæ€§ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;spi-chuang-jian-zi-ding-yi-de-chuang-kou-han-shu&quot;&gt;SPIï¼šåˆ›å»ºè‡ªå®šä¹‰çš„çª—å£å‡½æ•°&lt;&#x2F;h1&gt;
&lt;p&gt;datafusion ä¸­æ”¯æŒ4ç§ è‡ªå®šä¹‰å‡½æ•°ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;udf: scalar å‡½æ•°&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;udtf: è¡¨å‡½æ•°ï¼Œå¦‚ csv_read ä¹‹ç±»çš„å‡½æ•°&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;udwf: User Define Window Functionï¼šä»¥ partition ä¸ºå•ä½çš„çª—å£å‡½æ•°&lt;&#x2F;p&gt;
&lt;p&gt;ä¸»è¦é’ˆå¯¹éèšåˆç±»çš„çª—å£å‡½æ•°ï¼Œå‚è§ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;apache&#x2F;datafusion&#x2F;blob&#x2F;main&#x2F;datafusion-examples&#x2F;examples&#x2F;simple_udwf.rs&quot;&gt;simple udwf&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;apache&#x2F;datafusion&#x2F;blob&#x2F;main&#x2F;datafusion-examples&#x2F;examples&#x2F;advanced_udwf.rs&quot;&gt;advanced udwf&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;see: datafusion&#x2F;physical-expr&#x2F;src&#x2F;window&#x2F;standard.rs StandardWindowExpr::evaluate(æŒ‰ç…§è¿™ä¸ªæºä»£ç æ•´ç†ï¼Œä¸ä»£ç æ³¨é‡Šå¯¹åº”ä¸ä¸Š)&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;[&lt;code&gt;uses_window_frame&lt;&#x2F;code&gt;]&lt;&#x2F;th&gt;&lt;th&gt;[&lt;code&gt;supports_bounded_execution&lt;&#x2F;code&gt;]&lt;&#x2F;th&gt;&lt;th&gt;[&lt;code&gt;include_rank&lt;&#x2F;code&gt;]&lt;&#x2F;th&gt;&lt;th&gt;function_to_implement&lt;&#x2F;th&gt;&lt;th&gt;functions&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;true&lt;&#x2F;td&gt;&lt;td&gt;*&lt;&#x2F;td&gt;&lt;td&gt;*&lt;&#x2F;td&gt;&lt;td&gt;[&lt;code&gt;evaluate&lt;&#x2F;code&gt;]&lt;&#x2F;td&gt;&lt;td&gt;nth_value&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;false (default)&lt;&#x2F;td&gt;&lt;td&gt;*&lt;&#x2F;td&gt;&lt;td&gt;true&lt;&#x2F;td&gt;&lt;td&gt;[&lt;code&gt;evaluate_all_with_rank&lt;&#x2F;code&gt;]&lt;&#x2F;td&gt;&lt;td&gt;rank, dense_rank, cume_dist&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;false&lt;&#x2F;td&gt;&lt;td&gt;*&lt;&#x2F;td&gt;&lt;td&gt;false (default)&lt;&#x2F;td&gt;&lt;td&gt;[&lt;code&gt;evaluate_all&lt;&#x2F;code&gt;]&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;UDWF çª—å£å‡½æ•°åˆ—è¡¨ï¼š&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;category&lt;&#x2F;th&gt;&lt;th&gt;functions&lt;&#x2F;th&gt;&lt;th&gt;supported&lt;&#x2F;th&gt;&lt;th&gt;desc&lt;&#x2F;th&gt;&lt;th&gt;uses_window_frame&lt;&#x2F;th&gt;&lt;th&gt;supports_bounded_execution&lt;&#x2F;th&gt;&lt;th&gt;include_rank&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;ranking&lt;&#x2F;td&gt;&lt;td&gt;cume_dist&lt;&#x2F;td&gt;&lt;td&gt;df, duckdb&lt;&#x2F;td&gt;&lt;td&gt;ç´¯ç§¯ç™¾åˆ†æ¯”&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;td&gt;true&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;ranking&lt;&#x2F;td&gt;&lt;td&gt;dense_rank&lt;&#x2F;td&gt;&lt;td&gt;df, duckdb&lt;&#x2F;td&gt;&lt;td&gt;1,2,2,3 é£æ ¼çš„æ’å&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;td&gt;true&lt;&#x2F;td&gt;&lt;td&gt;true&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;ranking&lt;&#x2F;td&gt;&lt;td&gt;rank&lt;&#x2F;td&gt;&lt;td&gt;df, duckdb&lt;&#x2F;td&gt;&lt;td&gt;1,2,2,4 é£æ ¼çš„æ’å&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;td&gt;true&lt;&#x2F;td&gt;&lt;td&gt;true&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;ranking&lt;&#x2F;td&gt;&lt;td&gt;ntile(n)&lt;&#x2F;td&gt;&lt;td&gt;df, duckdb&lt;&#x2F;td&gt;&lt;td&gt;æŒ‰ n ç­‰åˆ†&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;ranking&lt;&#x2F;td&gt;&lt;td&gt;percent_rank&lt;&#x2F;td&gt;&lt;td&gt;df, duckdb&lt;&#x2F;td&gt;&lt;td&gt;æ’åç™¾åˆ†æ¯”&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;td&gt;true&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;ranking&lt;&#x2F;td&gt;&lt;td&gt;row_number&lt;&#x2F;td&gt;&lt;td&gt;df, duckdb&lt;&#x2F;td&gt;&lt;td&gt;è¡Œå·&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;td&gt;true&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;analytical&lt;&#x2F;td&gt;&lt;td&gt;first_value(expr)&lt;&#x2F;td&gt;&lt;td&gt;df, duckdb&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;analytical&lt;&#x2F;td&gt;&lt;td&gt;lag(expr, offset, default)&lt;&#x2F;td&gt;&lt;td&gt;df, duckdb&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;td&gt;true&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;analytical&lt;&#x2F;td&gt;&lt;td&gt;last_value(expr)&lt;&#x2F;td&gt;&lt;td&gt;df, duckdb&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;analytical&lt;&#x2F;td&gt;&lt;td&gt;lead(expr, offset, default)&lt;&#x2F;td&gt;&lt;td&gt;df, duckdb&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;td&gt;true&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;analytical&lt;&#x2F;td&gt;&lt;td&gt;nth_value(expr, n)&lt;&#x2F;td&gt;&lt;td&gt;df, duckdb&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;true&lt;&#x2F;td&gt;&lt;td&gt;true&lt;&#x2F;td&gt;&lt;td&gt;X&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;ul&gt;
&lt;li&gt;udaf: User Define Aggregate Function
é’ˆå¯¹å½¢å¦‚ SUM, COUNT ä¹‹ç±»çš„å‡½æ•°ï¼Œè‡ªå®šä¹‰å‡½æ•°å‚è€ƒï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;apache&#x2F;datafusion&#x2F;blob&#x2F;main&#x2F;datafusion-examples&#x2F;examples&#x2F;advanced_udaf.rs&quot;&gt;advanced udaf&lt;&#x2F;a&gt;
æ ¸å¿ƒæ¥å£æ˜¯ Accumulator, GroupsAccumulator&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
classDiagram
        
        class WindowUDFImpl {
            &amp;lt;&amp;lt;trait&amp;gt;&amp;gt;
            +partition_evaluator(PartitionEvaluatorArgs args) PartitionEvaluator
        }
        class PartitionEvaluator {
                &amp;lt;&amp;lt;trait&amp;gt;&amp;gt;
                +is_causal(): bool
                +uses_window_frame(): bool
                +supports_bounded_execution(): bool
                +include_rank(): bool
                +evaluate(&amp;amp;~ArrayRef~ values, &amp;amp;Range~usize~ range): Result&amp;lt;ScalarValue&amp;gt; 
                +evaluate_all(values:&amp;amp;~ArrayRef~, num_rows:uszie): Result&amp;lt;ArrayRef&amp;gt;
                +evaluate_all_with_rank(usize num_rows, &amp;amp;[Range~usize~] ranks_in_partition) -&amp;gt; Result&amp;lt;ArrayRef&amp;gt;
        }
        WindowUDFImpl .. PartitionEvaluator
        
        class AggregateUDFImpl {
            &amp;lt;&amp;lt;trait&amp;gt;&amp;gt;    
            +accumulator(AccumulatorArgs args): Result~Box~dyn Accumulator~~
            +create_groups_accumulator(AccumulatorArgs args): Result&amp;lt;Box&amp;lt;dyn GroupsAccumulator&amp;gt;&amp;gt;
        }
        
        class Accumulator {
                &amp;lt;&amp;lt;trait&amp;gt;&amp;gt;
                +update_batch(&amp;amp;[ArrayRef]): Result&amp;lt;()&amp;gt;
                +retract_batch(&amp;amp;[ArrayRef]): Result&amp;lt;()&amp;gt;
                +state(): Result&amp;lt;Vec&amp;lt;ScalaValue&amp;gt;&amp;gt;
                +merge_batch(&amp;amp;[ArrayRef]): Result&amp;lt;()&amp;gt;
                +evaluate(): Result&amp;lt;ScalaValue&amp;gt;
        }
        
        class GroupsAccumulator {
            &amp;lt;&amp;lt;trait&amp;gt;&amp;gt;
            +update_batch(&amp;amp;[ArrayRef], Option&amp;lt;&amp;amp;BooleanArray&amp;gt;, usize): Result&amp;lt;()&amp;gt;
            +state(EmitTo): Result&amp;lt;ArrayRef&amp;gt;
            +merge_batch(&amp;amp;[ArrayRef], &amp;amp;[usize], Option&amp;lt;&amp;amp;BooleanArray&amp;gt;, usize): Result&amp;lt;()&amp;gt;
            +evaluate(EmitTo): Result&amp;lt;ArrayRef&amp;gt;    
        }

    AggregateUDFImpl .. Accumulator
    AggregateUDFImpl .. GroupsAccumulator
        
```
&lt;&#x2F;div&gt;&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
classDiagram
    class WindowExpr {
        &amp;lt;&amp;lt;trait&amp;gt;&amp;gt;
        +evaluate_args(batch: &amp;amp;RecordBatch) Result~Vec&amp;lt;ArrayRef&amp;gt;~
        +evaluate(batch: &amp;amp;RecordBatch) Result~ArrayRef~
        +evaluate_stateful(partition_batches: &amp;amp;PartitionBatches, window_agg_state: &amp;amp;mut PartitionWindowAggStates) Result~()~
    }

    note for AggregateWindowExpr &amp;quot;for user-defined-aggregate-function&amp;quot;
    class AggregateWindowExpr {
        &amp;lt;&amp;lt;trait&amp;gt;&amp;gt;
    }

    note for StandardWindowExpr &amp;quot;for user-defined-window-function&amp;quot;
    class StandardWindowExpr {
            &amp;lt;&amp;lt;struct&amp;gt;&amp;gt;
    }

    class SlidingAggregateWindowExpr {
            &amp;lt;&amp;lt;struct&amp;gt;&amp;gt;
    }

    class PlainAggregateWindowExpr {
            &amp;lt;&amp;lt;struct&amp;gt;&amp;gt;
    }

    WindowExpr &amp;lt;|-- AggregateWindowExpr
    AggregateWindowExpr &amp;lt;|-- SlidingAggregateWindowExpr
    AggregateWindowExpr &amp;lt;|-- PlainAggregateWindowExpr
    WindowExpr &amp;lt;|-- StandardWindowExpr
```
&lt;&#x2F;div&gt;&lt;h2 id=&quot;wu-li-ji-hua-sheng-cheng-xuan-ze-suan-zi-windowexpr-jue-ce-shu&quot;&gt;ç‰©ç†è®¡åˆ’ç”Ÿæˆï¼šé€‰æ‹©ç®—å­ã€WindowExpr å†³ç­–æ ‘&lt;&#x2F;h2&gt;
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
flowchart TD
    A[ 1: function type ?] == window function ==&amp;gt; StandardWindowExpr
    A == aggregate function ==&amp;gt; C[frame start unbounded ?]
    A2[2: frame end bounded ?]
    A2 == unbounded following ==&amp;gt; WA[WindowAggExec]
    A2 == bounded ==&amp;gt; BWA[BoundedWindowAggExec]    
    C == unbounded preceding ==&amp;gt; plain[PlainAggregateWindowExpr]
    C == bounded ==&amp;gt; sliding[SlidingAggregateWindowExpr]
```
&lt;&#x2F;div&gt;
&lt;p&gt;å…·ä½“ï¼Œå¯ä»¥æŸ¥çœ‹å¦‚ä¸‹çš„ä»£ç å®ä¾‹ï¼Œé€šè¿‡ä»£ç çš„è°ƒè¯•ç­‰æ–¹å¼ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£ä¸åŒçš„ç®—å­ä¸‹çš„æ‰§è¡Œæµç¨‹ï¼š&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;function&lt;&#x2F;th&gt;&lt;th&gt;operator&lt;&#x2F;th&gt;&lt;th&gt;window expr&lt;&#x2F;th&gt;&lt;th&gt;demo&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;aggregate&lt;&#x2F;td&gt;&lt;td&gt;window agg exec&lt;&#x2F;td&gt;&lt;td&gt;plain aggregate&lt;&#x2F;td&gt;&lt;td&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;vectorize_engine&#x2F;blob&#x2F;main&#x2F;playgrounds&#x2F;try_datafusion&#x2F;src&#x2F;bin&#x2F;test_windows.rs&quot;&gt;test_sum_1&lt;&#x2F;a&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;aggregate&lt;&#x2F;td&gt;&lt;td&gt;window agg exec&lt;&#x2F;td&gt;&lt;td&gt;sliding aggregate&lt;&#x2F;td&gt;&lt;td&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;vectorize_engine&#x2F;blob&#x2F;main&#x2F;playgrounds&#x2F;try_datafusion&#x2F;src&#x2F;bin&#x2F;test_windows.rs&quot;&gt;test_sum2&lt;&#x2F;a&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;aggregate&lt;&#x2F;td&gt;&lt;td&gt;bounded window agg exec&lt;&#x2F;td&gt;&lt;td&gt;plain aggregate&lt;&#x2F;td&gt;&lt;td&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;vectorize_engine&#x2F;blob&#x2F;main&#x2F;playgrounds&#x2F;try_datafusion&#x2F;src&#x2F;bin&#x2F;test_windows.rs&quot;&gt;test_sum4&lt;&#x2F;a&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;aggregate&lt;&#x2F;td&gt;&lt;td&gt;bounded window agg exec&lt;&#x2F;td&gt;&lt;td&gt;sliding aggregate&lt;&#x2F;td&gt;&lt;td&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;vectorize_engine&#x2F;blob&#x2F;main&#x2F;playgrounds&#x2F;try_datafusion&#x2F;src&#x2F;bin&#x2F;test_windows.rs&quot;&gt;test_sum3&lt;&#x2F;a&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;h2 id=&quot;suan-zi-windowaggexec-fen-xi&quot;&gt;ç®—å­: WindowAggExec åˆ†æ&lt;&#x2F;h2&gt;
&lt;p&gt;æ ¹æ®ä¸Šè¿°åˆ†æï¼ŒWindowAggExec çš„ frame å½¢å¦‚ï¼šbetween bounded and unbounded following&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ä»ä¸Šæ¸¸è·å– RecordBatchï¼Œè¿½åŠ åˆ° self.batches ä¸­ï¼Œç›´è‡³å…¨éƒ¨è¯»å–å®Œæˆï¼Œè¿›å…¥åˆ°ç¬¬2æ­¥ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å°†å…¨éƒ¨çš„ RecordBatch åˆå¹¶ä¸ºä¸€ä¸ª RecordBatch&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ batch ä¸Šæ±‚å€¼ sort columns (partition key, maybe + order key)&lt;&#x2F;li&gt;
&lt;li&gt;æŒ‰ç…§ partition key å¯¹ batch è¿›è¡Œ partitionï¼Œç”±äº batch å·²ç»æ’åºï¼Œå› æ­¤ï¼Œåœ¨batch ä¸­æ¯ä¸ªåˆ†åŒºçš„æ•°æ®å·²ç»æ˜¯è¿ç»­å­˜æ”¾çš„ï¼Œä¸€ä¸ªåˆ†åŒºçš„æ•°æ®æ¥ç€
ä¸Šä¸€ä¸ªåˆ†åŒºçš„æ•°æ®ã€‚æ¯ä¸ªåˆ†åŒºå¯ä»¥è¡¨ç¤ºä¸º Range&lt;usize&gt;&lt;&#x2F;li&gt;
&lt;li&gt;foreach partitionï¼Œè°ƒç”¨å‡½æ•° WindowAggExec::compute_window_aggregates è¿›è¡Œçª—å£å‡½æ•°æ±‚å€¼
&lt;ol&gt;
&lt;li&gt;foreach window_expr è°ƒç”¨ window_expr.evaluate(batch) æ±‚å€¼ï¼ˆå¤šä¸ªçª—å£å‡½æ•°å¯ä»¥å…±äº«åŒä¸€ä¸ªçª—å£ï¼‰
&lt;ul&gt;
&lt;li&gt;window_expr.evaluate(batch) : single partition, single window_exp
&lt;ul&gt;
&lt;li&gt;foreach row in batch &lt;code&gt;AggregateWindowExpr::get_result_column&lt;&#x2F;code&gt;
&lt;ol&gt;
&lt;li&gt;è®¡ç®— å½“å‰è¡Œçš„ window range&lt;&#x2F;li&gt;
&lt;li&gt;window_expr.&lt;code&gt;get_aggregate_result_inside_range&lt;&#x2F;code&gt;: evaluate for single row with a range(window)
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;PlainAggregateWindowExpr::get_aggregate_result_inside_range: window 0..end end æ˜¯é€’å¢çš„&lt;&#x2F;p&gt;
&lt;p&gt;frame: 0 .. LAST&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹æ¯” last_rangeï¼Œå°† shift in rows è°ƒç”¨ accumulator.update_batch&lt;&#x2F;li&gt;
&lt;li&gt;è·å– accumulator.evaluate&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;SlidingAggregateWindowExpr::get_aggregate_result_inside_range:&lt;&#x2F;p&gt;
&lt;p&gt;frame: &lt;em&gt;bounded&lt;&#x2F;em&gt; .. LAST&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹æ¯” last_rangeï¼Œå°† shift out rows è°ƒç”¨ accumulator.retract_batch&lt;&#x2F;li&gt;
&lt;li&gt;å°† shift in rows è°ƒç”¨ accumulator.update_batch&lt;&#x2F;li&gt;
&lt;li&gt;è·å– accumulator.evaluate&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æ€»ä¹‹ï¼š SlidingAggregateWindowExpr::get_aggregate_result_inside_range å¯ä»¥è¦†ç›– PlainAggregateWindowExpr::get_aggregate_result_inside_range çš„èƒ½åŠ›ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;suan-zi-boundedwindowaggexec&quot;&gt;ç®—å­ï¼š BoundedWindowAggExec&lt;&#x2F;h2&gt;
&lt;p&gt;å¯¹ frame.end ä¸æ˜¯ unbounded following çš„çª—å£ç±»å‹ï¼Œdatafusion è§†ä¸º bounded windowï¼Œä½¿ç”¨ BoundedWindowAggExec ç®—å­æ¥å¤„ç†è¯¥çª—å£å‡½æ•°çš„è®¡ç®—ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ ¹æ® frame.start çš„ä¸åŒï¼Œä¼šé€‰æ‹©ä¸åŒç±»å‹çš„ WindowExpr:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹æ ‡å‡†çš„çª—å£å‡½æ•°ï¼ˆUDWFï¼‰ï¼Œä½¿ç”¨ StandardWindowExpr + PartitionEvaluator:&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;*&lt;&#x2F;span&gt;&lt;span&gt;, rank() over (partition by product_id &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;order by&lt;&#x2F;span&gt;&lt;span&gt; order_date) as rank1 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; t1
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹èšåˆç±»çª—å£å‡½æ•°ï¼ˆUDAFï¼‰, frame.start æ˜¯ unbounded preceding çš„ï¼Œä½¿ç”¨ PlainAggregateWindowExpr + Accumulator&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;*&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(amount) over (partition by product_id &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;order by&lt;&#x2F;span&gt;&lt;span&gt; order_date rows between unbounded preceding and &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt; following) as amounts1 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; t1
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹èšåˆç±»çª—å£å‡½æ•°ï¼ˆUDAFï¼‰, frame.start ä¸æ˜¯ unbounded preceding çš„ï¼Œä½¿ç”¨ SlidingAggregateWindowExpr + Accumulator&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;*&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(amount) over (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;order by&lt;&#x2F;span&gt;&lt;span&gt; order_date range between interval &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;1 days&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; preceding and interval &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;1 days&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; following) as slide_amounts &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; t1
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æ‰§è¡Œæµç¨‹ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;BoundedWindowAggStream ä»ä¸Šæ¸¸è¯»å– RecordBatch (å·²æŒ‰ window order by è¿›è¡Œæ’åº)&lt;&#x2F;li&gt;
&lt;li&gt;æ ¹æ® RecordBatch æ›´æ–° partition_key -&amp;gt; PartitionBatchState( record_batch )&lt;&#x2F;li&gt;
&lt;li&gt;è°ƒç”¨ BoundedWindowAggStream::compute_aggregates è®¡ç®—çª—å£å‡½æ•°
&lt;ol&gt;
&lt;li&gt;foreach window_expr, call window_expr.evaluate_stateful (1 window_expr, multi partition)
&lt;ol&gt;
&lt;li&gt;foreach partition, call window_expr.get_result_column (1 window_expr, 1 partition)
&lt;ol&gt;
&lt;li&gt;foreach row which is not calculated previous
&lt;ol&gt;
&lt;li&gt;è®¡ç®— row å¯¹åº”çš„ frame range&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœ RecordBatch æ»¡è¶³ frame rangeï¼Œåˆ™è°ƒç”¨ window_expr.get_aggregate_result_inside_range è¿›è¡Œèšåˆæ±‚å€¼
&lt;ol&gt;
&lt;li&gt;ç›¸æ¯”ä¸Šä¸€è¡Œçš„frameï¼Œå¯¹ç§»å‡ºçš„è¡Œè°ƒç”¨ accumulator::retract_batch&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹ç§»å…¥çš„è¡Œè°ƒç”¨ accumulator::update_batch&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;BoundedWindowAggStream {
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;window_expr&lt;&#x2F;span&gt;&lt;span&gt;: Vec&amp;lt;WindowExprRef&amp;gt;,
&lt;&#x2F;span&gt;&lt;span&gt;  
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;input_buffer&lt;&#x2F;span&gt;&lt;span&gt;: RecordBatch,
&lt;&#x2F;span&gt;&lt;span&gt;  
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;partition_buffers&lt;&#x2F;span&gt;&lt;span&gt;:  PartitionBatches,   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; IndexMap&amp;lt;PartitionKey, PartitionBatchState&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;window_agg_states&lt;&#x2F;span&gt;&lt;span&gt;:  Vec&amp;lt;PartitionWindowAggStates&amp;gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; indexed by window_expr, IndexMap&amp;lt;PartitionKey, WindowState&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;PartitionBatchState {
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;record_batch&lt;&#x2F;span&gt;&lt;span&gt;:  RecordBatch,
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;most_recent_row&lt;&#x2F;span&gt;&lt;span&gt;: Option&amp;lt;RecordBatch&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;  is_end: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;bool&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;n_out_row&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;WindowState {
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;state&lt;&#x2F;span&gt;&lt;span&gt;: WindowAggState,
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;window_fn&lt;&#x2F;span&gt;&lt;span&gt;: WindowFn,      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ç´¯åŠ å™¨ä¼šæŒæœ‰çŠ¶æ€ï¼Œé€šè¿‡ update_batch, retract_batch, merge_batch æ›´æ–°çŠ¶æ€
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;WindowAggState {
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;window_frame_range&lt;&#x2F;span&gt;&lt;span&gt;: Range&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;,
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;window_frame_ctx&lt;&#x2F;span&gt;&lt;span&gt;:  Option&amp;lt;WindowFrameContext&amp;gt;,
&lt;&#x2F;span&gt;&lt;span&gt;  
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;last_calculated_index&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;offset_pruned_rows&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;  
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;out_col&lt;&#x2F;span&gt;&lt;span&gt;: ArrayRef,
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;n_row_result_missing&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;is_end&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;bool
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
classDiagram
  class BoundedWindowAggStream {
          &amp;lt;&amp;lt;object&amp;gt;&amp;gt;
          
          window_exprs: Vec~WindowExprRef~
          
          input_buffer: RecordBatch
          finished: bool
          
  }

  class PartitionBatchState {
          &amp;lt;&amp;lt;object&amp;gt;&amp;gt;
          
          record_batch: RecordBatch
          most_recent_row: Option&amp;lt;RecordBatch&amp;gt;
          is_end: bool
          n_out_row: usize
  }
  
  class WindowState {
          &amp;lt;&amp;lt;object&amp;gt;&amp;gt;
          state: WindowAggState
          window_fn: WindowFn
  }
  class WindowAggState {
          &amp;lt;&amp;lt;object&amp;gt;&amp;gt;
          window_frmae_range: Range&amp;lt;usize&amp;gt;
          window_frame_ctx: Option&amp;lt;WindowFrameContext&amp;gt;
          
          last_cacluated_index: usize
          offset_pruned_rows: usize
          out_col: ArrayRef
          n_row_result_missing: usize
          is_end: bool
  }
  class WindowFn {
          &amp;lt;&amp;lt;object&amp;gt;&amp;gt;
          partition_evaluator: PartitionEvaulator
          accumulator: Accumulator
  }      
        
        

  BoundedWindowAggStream o-- PartitionBatchState : partition_buffers[PartitionKey]
  BoundedWindowAggStream o-- WindowState : window_agg_state[window_expr_idx][PartitionKey]
  
  WindowState o--  WindowAggState
  WindowState o--  WindowFn    

```
&lt;&#x2F;div&gt;
&lt;p&gt;å¤„ç†è¿‡ç¨‹ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;æ— éœ€åœ¨è¯»å–äº†å…¨éƒ¨åˆ†åŒºæ•°æ®åï¼Œå†è¿›è¡Œçª—å£å‡½æ•°è®¡ç®—ï¼Œå¯ä»¥åœ¨è¯»å…¥ batch çš„è¿‡ç¨‹ä¸­å¢é‡çš„å¤„ç†ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;si-kao&quot;&gt;æ€è€ƒ&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;æ€è€ƒï¼šæ”¯æŒæ›´ä¸ºçµæ´»çš„ values between expr and expr ? è™½ç„¶ä¸èƒ½åŒ¹é…ä¸Šè¿°çš„ä¼˜åŒ–ï¼Œä½†åœ¨æ•°æ®é‡ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æœ‰æ›´å¤§çš„è¡¨ç°åŠ›&lt;&#x2F;li&gt;
&lt;li&gt;æ€è€ƒï¼šå¦‚ä½•é«˜æ•ˆçš„æ”¯æŒåŒæœŸã€åŒæœŸç´¯ç§¯ç­‰åŠŸèƒ½ï¼Ÿ&lt;&#x2F;li&gt;
&lt;li&gt;æ€è€ƒï¼šWindowAggExec æ˜¯å¦å¯ä»¥è½¬æ¢ä¸º é€†åºåä½¿ç”¨ BoundedWindowAggExec?&lt;&#x2F;li&gt;
&lt;li&gt;datafusion çª—å£å‡½æ•°ä»£ç æ”¹è¿›æ€è€ƒ
&lt;ul&gt;
&lt;li&gt;PlainAggregateWindowExpr ä¸ SlidingAggregateWindowExpr é€»è¾‘ç›¸ä¼¼ï¼Œè¯„ä¼°åˆå¹¶ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;datafusion-wen-zhang-xi-lie&quot;&gt;datafusion æ–‡ç« ç³»åˆ—&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;duck-push-vs-datafusion-pull&#x2F;&quot;&gt;push vs pull&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-hashjoin&#x2F;&quot;&gt;datafusion hashjoin executor&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-window-function&#x2F;&quot;&gt;datafusion window function executor&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-performance&#x2F;&quot;&gt;datafusion performance&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>datafusion hashjoin æ€§èƒ½åˆ†æ</title>
        <published>2025-05-08T00:00:00+00:00</published>
        <updated>2025-05-08T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/datafusion-hashjoin/"/>
        <id>https://wangzaixiang.github.io/blog/datafusion-hashjoin/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/datafusion-hashjoin/">&lt;p&gt;æœ€è¿‘ï¼Œé˜…è¯»äº† datafusion é¡¹ç›®çš„æºä»£ç ï¼Œæˆ‘ä¼šé€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œæ•´ç†ä»£ç é˜…è¯»ä¸­çš„ä¸€äº›ç¬”è®°ã€æ€è€ƒã€‚æœ¬æ–‡ç›®å‰æ˜¯å¤„äºè‰ç¨¿é˜¶æ®µï¼ˆå‡Œä¹±ï¼‰ï¼Œä¼šæŒç»­ä¿®æ”¹ã€æ›´æ–°ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;datafusion-xing-neng-ce-ping&quot;&gt;datafusion æ€§èƒ½æµ‹è¯„&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;top-down-pull-execution-volcano-vs-bottom-up-push-execution-pipeline&quot;&gt;Top-down pull execution(Volcano) vs bottom-up push execution(Pipeline)&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;hashjoin-xing-neng-ce-ping&quot;&gt;HashJoin æ€§èƒ½æµ‹è¯„&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;in-order vs out-of-order&lt;&#x2F;li&gt;
&lt;li&gt;small build set vs large build set&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;hashjoin-gai-jin&quot;&gt;HashJoin æ”¹è¿›&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;Query Plan æ”¹è¿›
&lt;ul&gt;
&lt;li&gt;left join æ”¹å†™ä¸º inner join&lt;&#x2F;li&gt;
&lt;li&gt;filter move to left side&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;HashJoin ç®—å­æ”¹è¿›
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨è¡Œå­˜æ›¿ä»£åˆ—å­˜ï¼Œä»¥æé«˜ç¼“å­˜æœ‰å¥½æ€§&lt;&#x2F;li&gt;
&lt;li&gt;æ˜¾ç¤ºçš„ SIMD ä¼˜åŒ–&lt;&#x2F;li&gt;
&lt;li&gt;æ–°çš„ hashmap æ•°æ®ç»“æ„è®¾è®¡&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;gai-jin-de-hashmap-shu-ju-jie-gou&quot;&gt;æ”¹è¿›çš„ HashMap æ•°æ®ç»“æ„&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;HashMap1 { 
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;tags&lt;&#x2F;span&gt;&lt;span&gt;: Box&amp;lt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u16&lt;&#x2F;span&gt;&lt;span&gt;]&amp;gt;,    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; æ¯ 16 ä¸ª tag ä¸º 1 group,  group_idx = h1(hash) % GROUP, tag = h2(hash)
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;first&lt;&#x2F;span&gt;&lt;span&gt;: Box&amp;lt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;]&amp;gt;,   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; first.len() == tags.len(), å­˜å‚¨æ¯ä¸ª tag å¯¹åº”çš„ fist è¡Œå·
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;next&lt;&#x2F;span&gt;&lt;span&gt;:  Box&amp;lt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;]&amp;gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; next.len() == ROWS + 1, å­˜å‚¨æ¯ä¸ªè¡Œå·å¯¹åº”çš„ä¸‹ä¸€è¡Œå·ï¼Œ 0 è¡¨ç¤ºæ— ã€‚
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;HashMap2 {
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;tags&lt;&#x2F;span&gt;&lt;span&gt;: Box&amp;lt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u16&lt;&#x2F;span&gt;&lt;span&gt;]&amp;gt;, 
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;first&lt;&#x2F;span&gt;&lt;span&gt;: Box&amp;lt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u16&lt;&#x2F;span&gt;&lt;span&gt;]&amp;gt;,   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; first.len() == tags.len(), first[i] ä¸º rows çš„ç´¢å¼•ï¼Œ0 è¡¨ç¤ºæ— æ•°æ®
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;rows&lt;&#x2F;span&gt;&lt;span&gt;: Box&amp;lt;[Row]&amp;gt;,    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; é‡‡ç”¨ row storageï¼Œå…¶é¡ºåºä¸åŒäºè¾“å…¥çš„é¡ºåºï¼Œè€Œæ˜¯æŒ‰ç…§åœ¨ hashmap åçš„é¡ºåº
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;Row {
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;hashcode&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;,   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ä»…ä¿ç•™ 63ä½ï¼Œæœ€é«˜ä½ä¸º0æ—¶ï¼Œè¡¨ç¤ºæ²¡æœ‰ä¸‹ä¸€è¡Œï¼Œä¸º1æ—¶ï¼Œè¡¨ç¤ºæœ‰ä¸‹ä¸€è¡Œã€‚
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col1&lt;&#x2F;span&gt;&lt;span&gt;:  any,      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ä¿ç•™åŸå§‹çš„æ•°æ®åˆ—
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col2&lt;&#x2F;span&gt;&lt;span&gt;:  any,
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ol&gt;
&lt;li&gt;build hashmap1
&lt;ul&gt;
&lt;li&gt;GROUPS = ROWS * SCALE &#x2F; 16, SCALE å»ºè®®é€‰æ‹© 2-4ï¼Œæ¯ä¸ª groups ä¸­çš„ tag éƒ½åˆå§‹åŒ–ä¸º 0xFFFF(æ¯ä¸ªåˆ†ç»„éæœ€åä¸€ä¸ªslot) å’Œ 0xFFFE(æ¯ä¸ªåˆ†ç»„æœ€åä¸€ä¸ªslot)&lt;&#x2F;li&gt;
&lt;li&gt;foreach build row, calculate hashcode: u64 for hash-columns&lt;&#x2F;li&gt;
&lt;li&gt;h2 = hashcode &amp;gt;&amp;gt; 49: ä¿ç•™15ä½çš„ h2&lt;&#x2F;li&gt;
&lt;li&gt;group_idx = hashcode % GROUPS&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ 1 ä¸ª groups ä¸­ä½¿ç”¨ simd æŒ‡ä»¤æœç´¢ h2
&lt;ul&gt;
&lt;li&gt;(unlikely) å¦‚æœå­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºè¯¥ h2 å·²è¢«å ç”¨ï¼Œ&lt;code&gt;next[row_no] = first[slot], first[slot] = row_no&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;(likely) å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æœç´¢ 0xFFFF æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯ç”¨ slot
&lt;ul&gt;
&lt;li&gt;(likely) å¦‚æœæ‰¾åˆ°ï¼Œåˆ™å ç”¨è¯¥ slotï¼š&lt;code&gt;first[slot] = row_no&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;(unlikely) å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™å ç”¨æœ€åä¸€ä¸ªslotï¼š&lt;code&gt;next[row_no] = first[slot], first[slot] = row_no&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;build hashmap2
&lt;ul&gt;
&lt;li&gt;éå† hashmap1.tags&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœæŸä¸ª tag å¯¹åº”çš„ first != 0ï¼Œåˆ™å°† first è¡Œå‹å…¥ rows
&lt;ul&gt;
&lt;li&gt;éå† next æ ˆï¼Œå°†å½“å‰ tag çš„ä¸‹ä¸€ä¸ª next å‹å…¥rowsï¼Œ ç›´è‡³ç»“æŸ
hashmap2 æ„å»ºå®Œæˆåï¼Œä¹‹å‰çš„åˆ—å­˜æ•°æ®å¯ä»¥é‡Šæ”¾ã€‚hashmap2 ä¸­ä½¿ç”¨è¡Œå­˜è¿›è¡Œå­˜å‚¨ï¼Œä¸”å…·æœ‰ç›¸åŒçš„ hashcode çš„è¡Œè¢«è®¾è®¡ä¸ºè¿ç»­å­˜å‚¨ã€‚ä¸ºåç»­ probe phase çš„æ€§èƒ½ä¼˜åŒ–æä¾›åŸºç¡€ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h3 id=&quot;shi-yan-shu-ju&quot;&gt;å®éªŒæ•°æ®&lt;&#x2F;h3&gt;
&lt;p&gt;åœ¨ https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;vectorize_engine&#x2F;blob&#x2F;main&#x2F;playgrounds&#x2F;try_cpu&#x2F;src&#x2F;bin&#x2F;TestHash.rs è¿™ä¸ªå®éªŒä¸­ï¼Œæˆ‘å¯¹è¿™ä¸ªæ•°æ®
ç»“æ„è¿›è¡Œäº†æµ‹è¯•&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;GROUP_WIDTH&lt;&#x2F;th&gt;&lt;th&gt;H2_WIDTH&lt;&#x2F;th&gt;&lt;th&gt;SCALE&lt;&#x2F;th&gt;&lt;th&gt;H2 duplicated&lt;&#x2F;th&gt;&lt;th&gt;other duplicated&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;16&lt;&#x2F;td&gt;&lt;td&gt;8&lt;&#x2F;td&gt;&lt;td&gt;1&lt;&#x2F;td&gt;&lt;td&gt;11.37%&lt;&#x2F;td&gt;&lt;td&gt;9.32%&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;16&lt;&#x2F;td&gt;&lt;td&gt;8&lt;&#x2F;td&gt;&lt;td&gt;2&lt;&#x2F;td&gt;&lt;td&gt;6%&lt;&#x2F;td&gt;&lt;td&gt;0.098%&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;16&lt;&#x2F;td&gt;&lt;td&gt;8&lt;&#x2F;td&gt;&lt;td&gt;3&lt;&#x2F;td&gt;&lt;td&gt;4%&lt;&#x2F;td&gt;&lt;td&gt;0.002%&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;16&lt;&#x2F;td&gt;&lt;td&gt;8&lt;&#x2F;td&gt;&lt;td&gt;4&lt;&#x2F;td&gt;&lt;td&gt;3.09%&lt;&#x2F;td&gt;&lt;td&gt;0.001%&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;16&lt;&#x2F;td&gt;&lt;td&gt;16&lt;&#x2F;td&gt;&lt;td&gt;1&lt;&#x2F;td&gt;&lt;td&gt;0.05%&lt;&#x2F;td&gt;&lt;td&gt;13.24%&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;16&lt;&#x2F;td&gt;&lt;td&gt;16&lt;&#x2F;td&gt;&lt;td&gt;2&lt;&#x2F;td&gt;&lt;td&gt;0.03%&lt;&#x2F;td&gt;&lt;td&gt;0.18%&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;16&lt;&#x2F;td&gt;&lt;td&gt;16&lt;&#x2F;td&gt;&lt;td&gt;3&lt;&#x2F;td&gt;&lt;td&gt;0.02%&lt;&#x2F;td&gt;&lt;td&gt;0.004%&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;16&lt;&#x2F;td&gt;&lt;td&gt;16&lt;&#x2F;td&gt;&lt;td&gt;4&lt;&#x2F;td&gt;&lt;td&gt;0.01%&lt;&#x2F;td&gt;&lt;td&gt;0%&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;p&gt;å®éªŒè¡¨æ˜ï¼šé€‰æ‹© (GROUP_WIDTH = 16, H2_WIDTH = 16, SCALE = 2) æ—¶ï¼Œfirst å‘½ä¸­ç‡è¾¾åˆ° 99.9%ï¼Œæ•ˆæœå¾ˆç†æƒ³ï¼Œè¿œæ¯” (GROUP_WIDTH = 16, H2_WIDTH = 8, SCALE = 2)
è¦å¥½ã€‚è€Œå…¶æˆæœ¬å¢åŠ è¾ƒä¸ºæœ‰é™ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;tags å ç”¨ç©ºé—´å¢åŠ 1å€&lt;&#x2F;li&gt;
&lt;li&gt;æœç´¢æ—¶ï¼Œéœ€è¦æœç´¢ 32B(vs 16B)&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;probe-phase&quot;&gt;probe phase&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;mac-xia-de-xing-neng-ce-ping-gong-ju&quot;&gt;Mac ä¸‹çš„æ€§èƒ½æµ‹è¯„å·¥å…·&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;datafusion-wen-zhang-xi-lie&quot;&gt;datafusion æ–‡ç« ç³»åˆ—&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;duck-push-vs-datafusion-pull&#x2F;&quot;&gt;push vs pull&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-hashjoin&#x2F;&quot;&gt;datafusion hashjoin executor&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-window-function&#x2F;&quot;&gt;datafusion window function executor&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-performance&#x2F;&quot;&gt;datafusion performance&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>May 2025</title>
        <published>2025-05-06T00:00:00+00:00</published>
        <updated>2025-05-06T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2025-05/"/>
        <id>https://wangzaixiang.github.io/monthly/2025-05/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2025-05/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Architecture&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;developer.apple.com&#x2F;documentation&#x2F;apple-silicon&#x2F;cpu-optimization-guide&quot;&gt;Apple Silicon CPU Optimization Guide: 3.0&lt;&#x2F;a&gt;
åˆå‘ç°äº†ä¸€æœ¬ CPU çº§ä¼˜åŒ–çš„å¥½ä¹¦ï¼Œè™½ç„¶è¿™æœ¬ä¹¦ç‰¹åˆ«é’ˆå¯¹ Apple ç³»åˆ—CPU(åŒ…æ‹¬ Aç³»åˆ—å’Œ M ç³»åˆ—)ï¼Œä½†å¾ˆå¤šçš„å†…å®¹ï¼Œé’ˆå¯¹ç°ä»£è¶…æ ‡é‡å¤„ç†å™¨ï¼Œéƒ½æ˜¯å…·æœ‰å‚è€ƒæ„ä¹‰çš„ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ç»“åˆè¿™æœ¬ä¹¦ï¼Œå¯ä»¥æ›´å¥½çš„ç†è§£ã€Šè¶…æ ‡é‡å¤„ç†å™¨è®¾è®¡ã€‹ã€ã€Šé«˜æ€§èƒ½è¶…æ ‡é‡CPUå¾®æ¶æ„å‰–æäºè®¾è®¡ã€‹ç­‰ä¹¦çš„å†…å®¹ï¼Œæˆ‘åç»­ä¹Ÿä¼šé™†ç»­æ•´ç†è¿™æœ¬ä¹¦çš„å­¦ä¹ ç¬”è®°ã€‚ç»“åˆ datafusion
ç­‰é¡¹ç›®ï¼Œä¹Ÿå¯ä»¥å°è¯•è¿›è¡Œå®è·µã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;ibrahimessam.com&#x2F;posts&#x2F;prefetch&#x2F;&quot;&gt;software prefetch example 1&lt;&#x2F;a&gt; æ€§èƒ½æå‡çº¦ 20%&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;lemire.me&#x2F;blog&#x2F;2018&#x2F;04&#x2F;30&#x2F;is-software-prefetching-__builtin_prefetch-useful-for-performance&#x2F;&quot;&gt;software prefetch example 2&lt;&#x2F;a&gt; æ€§èƒ½æå‡çº¦ 10%&lt;&#x2F;p&gt;
&lt;p&gt;è¿™ä¸ªä¾‹å­ï¼Œæˆ‘åœ¨ M1 ä¸Šæµ‹è¯•æ—¶ï¼Œå®é™…æ•ˆæœæå‡éå¸¸æœ‰é™ï¼Œå¤§çº¦åœ¨ 1%ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Rust&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;alexpusch&#x2F;rust-magic-patterns&#x2F;blob&#x2F;master&#x2F;visual-journey-through-async-rust&#x2F;Readme.md&quot;&gt;A Visual Journey Through Async Rust&lt;&#x2F;a&gt;
é€šè¿‡å¯è§†åŒ–çš„æ–¹å¼æ¥ç†è§£ async&#x2F;await çš„æ‰§è¡Œï¼ŒåŒ…æ‹¬ concurrent ä¸ parallel çš„åŒºåˆ«ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;alexpusch&#x2F;rust-magic-patterns&#x2F;blob&#x2F;master&#x2F;rust-stream-visualized&#x2F;Readme.md&quot;&gt;Rust Stream API visualized and exposed&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;willemvanhulle.tech&#x2F;blog&#x2F;func-async&#x2F;&quot;&gt;ä½¿ç”¨ Stream ç¼–å†™å‡½æ•°å¼çš„ä»£ç &lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Stream ï½ async iterator&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;borretti.me&#x2F;article&#x2F;two-years-of-rust&quot;&gt;Two Years of Rust&lt;&#x2F;a&gt; å¾ˆæœ‰æ„æ€çš„ä¸€ä¸ªèµ„æ·±ç¨‹åºå‘˜ï¼ˆä½†å¯¹rustä»…æœ‰2å¹´ä½¿ç”¨ç»éªŒï¼‰çš„æ€è€ƒã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ã€Bç«™ä¸­æ–‡è®²è¯»ã€‘https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1JGVXzAEXP?vd_source=eee72bea0d6227ec450743399f7c7b5b&lt;&#x2F;li&gt;
&lt;li&gt;å°†å€Ÿç”¨æ£€æŸ¥ä»ä¸€ç§è´Ÿæ‹…è½¬åŒ–ä¸ºä¸€ç§ç±»åŒ–çš„æ£€æŸ¥ï¼šå¹¶å°†å¤æ‚çš„å€Ÿç”¨æ£€æŸ¥å¼•å¯¼æˆ‘ä»¬å¯¹è®¾è®¡è¿›è¡Œç®€åŒ–ï¼Œé‡‡å–æ›´åŠ æ­£äº¤åŒ–çš„è®¾è®¡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;linearly-types æ¦‚å¿µï¼š
&lt;blockquote&gt;
&lt;p&gt;çº¿æ€§ç±»å‹ï¼ˆLinearly Typesï¼‰æ˜¯ç¼–ç¨‹è¯­è¨€ç±»å‹ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œä¸»è¦ç”¨äºèµ„æºç®¡ç†å’Œå†…å­˜å®‰å…¨ã€‚å®ƒè¦æ±‚å˜é‡åœ¨ä½¿ç”¨æ—¶å¿…é¡»ä¸¥æ ¼éµå¾ªâ€œæ°å¥½ä¸€æ¬¡â€çš„è§„åˆ™ï¼Œ
å³æ¯ä¸ªå˜é‡åœ¨ä½œç”¨åŸŸå†…å¿…é¡»è¢«ä½¿ç”¨ä¸”ä»…è¢«ä½¿ç”¨ä¸€æ¬¡ã€‚è¿™ç§æœºåˆ¶å¸¸ç”¨äºé˜²æ­¢èµ„æºæ³„æ¼ï¼ˆå¦‚å†…å­˜ã€æ–‡ä»¶å¥æŸ„ç­‰ï¼‰ï¼Œå¹¶æ”¯æŒå¯¹åº•å±‚æ“ä½œçš„é«˜æ•ˆæ§åˆ¶ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦æ°¸è¿œä¸å¤Ÿå¿«ï¼Œdeepseek å¯ä»¥å¯¹è¿™ä¸ªå¼€é”€åšå¾ˆå…¥çš„è§£é‡Šã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ‹›è˜å¾ˆéš¾å—ï¼Ÿå…¶å® rust æœ¬èº«å°±å¸®åŠ©ä½ è¿›è¡Œäº†ç­›é€‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ»¥ç”¨macroï¼šè¿‡åº¦ä½¿ç”¨ macro å¯èƒ½ä¼šè®©ä»£ç çš„é˜…è¯»å’Œè°ƒè¯•æˆä¸ºå›°éš¾ï¼Œè¿™ä¸€ç‚¹ï¼Œæˆ‘åœ¨é˜…è¯» datafusion æºä»£ç æ—¶ä¹Ÿæœ‰æ‰€å‘ç°ï¼Œå®é™…ä¸Šï¼Œä½¿ç”¨å‡½æ•°æ›¿ä»£ç»“åˆ inline
æœºåˆ¶æ¥æ›¿ä»£ä¸å¿…è¦çš„ macroï¼Œæ˜¯æˆ‘æ›´å–œæ¬¢çš„æ–¹å¼ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ä½œè€…å¯¹ borrow checking æœ‰ç€ç™¾ç§‘å…¨ä¹¦çº§çš„ç†è§£ï¼Œå› ä¸ºè‡ªå·±å®ç°è¿‡ç±»ä¼¼çš„æœºåˆ¶ã€‚è¿™ä¸ªæˆ‘æ˜¯æ·±æœ‰ä½“ä¼šçš„ï¼Œæˆ‘ä¹‹å‰å®ç°è¿‡ä¸€ä¸ª &lt;a href=&quot;https:&#x2F;&#x2F;easyajax.sourceforge.net&#x2F;&quot;&gt;easyajax&lt;&#x2F;a&gt;,
æ‰€ä»¥å¯¹åç»­çš„è¿™ç±»ç»„ä»¶æ¡†æ¶å°±æœ‰ç€è‡ªå·±ç‹¬ç‰¹çš„ç†è§£ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Scala&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Scala 3.7.0 å‘å¸ƒã€‚è¿™ä¸ªç‰ˆæœ¬æœ€å¤§çš„ç‰¹æ€§æ˜¯ &lt;a href=&quot;https:&#x2F;&#x2F;docs.scala-lang.org&#x2F;scala3&#x2F;reference&#x2F;other-new-features&#x2F;named-tuples.html&quot;&gt;NamedTuple&lt;&#x2F;a&gt; æˆä¸ºæ­£å¼ç‰¹æ€§ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;MPP &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;web-frontend&quot;&gt;Web &amp;amp; Frontend&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.atriiy.dev&#x2F;blog&#x2F;rolldown-module-loader-and-dependency-graph&quot;&gt;How Rolldown Works: Module Loading, Dependency Graphs, and Optimization Explained&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@yewang222&#x2F;how-we-built-a-500-faster-web-app-with-webassembly-in-2025-49f8f3f52995&quot;&gt;How We Built a 500% Faster Web App with WebAssembly in 2025&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;åº”ç”¨ç±»å‹ï¼šå…¸å‹çš„BIå±•ç¤ºã€åˆ†æåº”ç”¨ï¼šå®æ—¶æ•°æ®å¤„ç†ï¼Œç±»ä¼¼äºç”µå­è¡¨æ ¼çš„å±•ç¤ºï¼Œå›¾è¡¨å±•ç¤ºï¼ŒåŠ¨æ€çš„ç”¨æˆ·ç•Œé¢ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨å‰ç«¯è¿›è¡Œäº†å¤§é‡çš„æ•°æ®åŠ å·¥å¤„ç†ç±»å·¥ä½œ(éDOMæ“ä½œ)ï¼Œä»¥æé«˜äº¤äº’çš„ä½“éªŒï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å‰ç«¯è¿‡æ»¤&lt;&#x2F;li&gt;
&lt;li&gt;å‰ç«¯æ’åº&lt;&#x2F;li&gt;
&lt;li&gt;transposeï¼ˆäº¤å‰è¡¨æœ¬åœ°å¤„ç†ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;æœ¬åœ°çš„åˆ†ç»„èšåˆ&lt;&#x2F;li&gt;
&lt;li&gt;ç”µå­è¡¨æ ¼çš„æœ¬åœ°å…¬å¼è®¡ç®—&lt;&#x2F;li&gt;
&lt;li&gt;JSON: å°†è¿œç¨‹çš„ blob è½¬æ¢ä¸º JSON&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æœ€ä½³æ­é…ï¼šJavaScript å¤„ç† render, WASM å¤„ç† compute&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.yogalayout.dev&quot;&gt;Yoga&lt;&#x2F;a&gt;  Meta çš„æ€¥äº CSS çš„ box layout engine, PixiJS ä½¿ç”¨å…¶æ¥è¿›è¡Œ scenario layout, ä¹Ÿå¯ä»¥è€ƒè™‘
ç”¨äºä»ªè¡¨ç›˜ä¹‹ç±»çš„åœºæ™¯ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;shuding&#x2F;yoga-wasm-web&quot;&gt;Yoga-WASM&lt;&#x2F;a&gt; ä»¥ WASM æ–¹å¼ä½¿ç”¨&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vislyhq&#x2F;stretch&quot;&gt;Stretch&lt;&#x2F;a&gt; Rust å®ç°ï¼Œæ”¯æŒ FlexBox layout, ç›®å‰ä¸æ´»è·ƒ&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;linebender&#x2F;druid&quot;&gt;druid: A data-first Rust-native UI design toolkit&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;incremental layout.&lt;&#x2F;li&gt;
&lt;li&gt;containing block&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;pixijs.com&#x2F;blog&quot;&gt;pixijs layout v3&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;tools-libraries&quot;&gt;Tools &amp;amp; Libraries&lt;&#x2F;h1&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>M1 CPU åˆ†æ”¯é¢„æµ‹å¤±è¯¯å¯¹æ€§èƒ½çš„å½±å“æµ‹è¯•</title>
        <published>2025-04-29T00:00:00+00:00</published>
        <updated>2025-04-29T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/cpu-branch-miss/"/>
        <id>https://wangzaixiang.github.io/blog/cpu-branch-miss/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/cpu-branch-miss/">&lt;h1 id=&quot;m1-cpu-fen-zhi-yu-ce-shi-wu-dui-xing-neng-de-ying-xiang-ce-shi&quot;&gt;M1 CPU åˆ†æ”¯é¢„æµ‹å¤±è¯¯å¯¹æ€§èƒ½çš„å½±å“æµ‹è¯•&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨è¶…æ ‡é‡å¤„ç†å™¨ä¸­ï¼Œåˆ†æ”¯é¢„æµ‹çš„å‡†ç¡®ç‡å¦‚ä½•ï¼Œä»¥åŠåˆ†æ”¯é¢„æµ‹å‡†ç¡®ç‡å¯¹æ€§èƒ½çš„å½±å“å¦‚ä½•ï¼Œè¿™ä¸ªå®éªŒæ˜¯åœ¨ M1 CPU ä¸Šçš„ä¸€ä¸ªæµ‹è¯•ï¼Œä¸ºæˆ‘ä»¬æ›´å¥½çš„ç†è§£ç°ä»£è¶…æ ‡é‡å¤„ç†å™¨ä¸‹
åˆ†æ”¯é¢„æµ‹çš„å·¥ä½œåŸç†æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„è§†è§’ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„ç¼–å†™é«˜æ€§èƒ½çš„ä»£ç ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;vectorize_engine&#x2F;blob&#x2F;main&#x2F;playgrounds&#x2F;try_cpu&#x2F;src&#x2F;bin&#x2F;TestLoop.rs&quot;&gt;æµ‹è¯•ä»£ç &lt;&#x2F;a&gt;ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;TestCase {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;: String,   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; same as mmap file
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;numbers&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; number of elements
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;mmap&lt;&#x2F;span&gt;&lt;span&gt;: Mmap
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;impl &lt;&#x2F;span&gt;&lt;span&gt;TestCase {
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;&#x2F; éå†æ•°ç»„ï¼Œå¯¹æ¯ä¸€ä¸ªå…ƒç´ éå†å…¶æ¯ä¸€ä¸ªä¸º1çš„äºŒè¿›åˆ¶ä½
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;execute&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;) -&amp;gt; (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; sum = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; loops = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; numbers = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ std::slice::from_raw_parts(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.mmap.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_ptr&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const u64&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.numbers) };
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        numbers.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;iter&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;for_each&lt;&#x2F;span&gt;&lt;span&gt;(|&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;n&lt;&#x2F;span&gt;&lt;span&gt;| {
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; n = n;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; n &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;&#x2F; è¿™ä¸ªåˆ†æ”¯åˆ¤æ–­çš„å‡†ç¡®åº¦æ˜¯æœ¬æµ‹è¯•çš„å…³é”®ç‚¹ï¼Œéšç€æ ·æœ¬æ•°æ®çš„éšæœºæ€§ä¸åŒï¼Œå…¶é¢„æµ‹å‡†ç¡®åº¦ä¹Ÿä¼šä¸åŒ
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bit = n.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;trailing_zeros&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;                n &amp;amp;= !(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&amp;lt; bit);
&lt;&#x2F;span&gt;&lt;span&gt;                sum += bit as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;                loops += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;        });
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        (sum, loops)
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;&#x2F; data1: 0..n æ ·æœ¬æ•°æ®æ¯”è¾ƒæœ‰åºï¼Œé¢„æœŸåˆ†æ”¯é¢„æµ‹æˆåŠŸç‡é«˜
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;generate_data1&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;slice&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;]) {
&lt;&#x2F;span&gt;&lt;span&gt;    (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;..slice.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;()).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;for_each&lt;&#x2F;span&gt;&lt;span&gt;( |&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;n&lt;&#x2F;span&gt;&lt;span&gt;| slice[n] = n as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;&#x2F; data2: æ¯ä¸ªæ ·æœ¬çš„ popcnt éƒ½æ˜¯ 15ï¼Œé¢„æœŸåˆ†æ”¯é¢„æµ‹æˆåŠŸç‡æœ€é«˜
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;generate_data2&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;slice&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;]) {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; nums = [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0xFFF7&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0xFFF70&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0xFFF700&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0xFFF7000&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0xFFF70000&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0xFFF700000&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0xFFF7000000&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0xFFF70000000&lt;&#x2F;span&gt;&lt;span&gt;];
&lt;&#x2F;span&gt;&lt;span&gt;    (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;..slice.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;()).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;for_each&lt;&#x2F;span&gt;&lt;span&gt;( |&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;n&lt;&#x2F;span&gt;&lt;span&gt;| slice[n] = nums[ n &amp;amp; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x7 &lt;&#x2F;span&gt;&lt;span&gt;]);
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;&#x2F; data3: å®Œå…¨éšæœºçš„æ•°æ®æ ·æœ¬ï¼Œé¢„æœŸåˆ†æ”¯é¢„æµ‹æˆåŠŸç‡ä½
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;generate_data3&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;slice&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;]) {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; random = rand::thread_rng();
&lt;&#x2F;span&gt;&lt;span&gt;    (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;..slice.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;()).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;for_each&lt;&#x2F;span&gt;&lt;span&gt;( |&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;n&lt;&#x2F;span&gt;&lt;span&gt;| slice[n] = random.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;next_u64&lt;&#x2F;span&gt;&lt;span&gt;());
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;ce-shi-jie-guo&quot;&gt;æµ‹è¯•ç»“æœ&lt;&#x2F;h2&gt;
&lt;p&gt;æœ¬æ¬¡æµ‹è¯•æ˜¯åœ¨ M1 Maxï¼ˆ64G) å’Œ M4(32G) ä¸Šè¿›è¡Œï¼Œç”±äºé‡‡ç”¨ mmap æ–¹å¼è¯»å–æ•°æ®ï¼Œç”±äºæµ‹è¯•æ–‡ä»¶çš„å¤§å° &amp;lt; 8Gï¼Œåœ¨ä¸¤ä¸ªç¯å¢ƒä¸­ï¼Œå‡å¯ä¿è¯æ–‡ä»¶å…¨éƒ¨åœ¨ page cache ä¸­ï¼Œ
æµ‹è¯•ç»“æœä¸€èˆ¬é‡‡ç”¨ç¬¬2è½®åçš„ç»“æœï¼Œä»¥é¿å… IO çš„å½±å“ã€‚&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;test case&lt;&#x2F;th&gt;&lt;th&gt;IPC&lt;&#x2F;th&gt;&lt;th&gt;branch-misses&lt;&#x2F;th&gt;&lt;th&gt;ns&#x2F;iter&lt;&#x2F;th&gt;&lt;th&gt;description&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;test1-M1&lt;&#x2F;td&gt;&lt;td&gt;3.996&lt;&#x2F;td&gt;&lt;td&gt;4.88e-3&lt;&#x2F;td&gt;&lt;td&gt;0.776&lt;&#x2F;td&gt;&lt;td&gt;æµ‹è¯•æ ·æœ¬è¾ƒä¸ºæœ‰åº&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;test2-M1&lt;&#x2F;td&gt;&lt;td&gt;4.596&lt;&#x2F;td&gt;&lt;td&gt;6e-7&lt;&#x2F;td&gt;&lt;td&gt;0.678&lt;&#x2F;td&gt;&lt;td&gt;æµ‹è¯•æ ·æœ¬éå¸¸æœ‰åº&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;test3-M1&lt;&#x2F;td&gt;&lt;td&gt;1.908&lt;&#x2F;td&gt;&lt;td&gt;2.9e-2&lt;&#x2F;td&gt;&lt;td&gt;1.555&lt;&#x2F;td&gt;&lt;td&gt;æµ‹è¯•æ ·æœ¬éšæœºæ— åº&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;test1-M4&lt;&#x2F;td&gt;&lt;td&gt;4.63&lt;&#x2F;td&gt;&lt;td&gt;3.44e-3&lt;&#x2F;td&gt;&lt;td&gt;0.563&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;test2-M4&lt;&#x2F;td&gt;&lt;td&gt;5.307&lt;&#x2F;td&gt;&lt;td&gt;1.5e-7&lt;&#x2F;td&gt;&lt;td&gt;0.498&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;test3-M4&lt;&#x2F;td&gt;&lt;td&gt;2.034&lt;&#x2F;td&gt;&lt;td&gt;2.9e-2&lt;&#x2F;td&gt;&lt;td&gt;1.136&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;p&gt;M1 vs M4 å¾®æ¶æ„å¯¹æ¯”ï¼ˆæ¥æºäº deepseek ï¼‰&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è§£ç å™¨å®½åº¦ä¼˜åŒ–
&lt;ul&gt;
&lt;li&gt;æŒ‡ä»¤è§£ç èƒ½åŠ›æå‡
&lt;ul&gt;
&lt;li&gt;é‡‡ç”¨ 10 å®½è§£ç å•å…ƒï¼ˆæ¯ä¸ªæ—¶é’Ÿå‘¨æœŸå¯è§£ç  10 æ¡æŒ‡ä»¤ï¼‰ï¼Œç›¸æ¯” M3 çš„ 9 å®½è¿›ä¸€æ­¥åŠ å®½ï¼Œæ¨æµ‹è¿™æ˜¯è‹¹æœè‡ª M1ï¼ˆæ¨æµ‹ä¸º 8 å®½ï¼‰ä»¥æ¥çš„æœ€å¤§è§„æ¨¡å‰ç«¯ä¼˜åŒ–ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;M1ï¼šåŸºäº ARMv8 æ¶æ„ï¼Œè§£ç å™¨å®½åº¦è¾ƒçª„ï¼ˆæ¨æµ‹ä¸º 8 å®½ï¼‰ï¼ŒæŒ‡ä»¤ååé‡è¾ƒä½ï¼Œé™åˆ¶äº†å¹¶è¡Œå¤„ç†èƒ½åŠ›ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;å‰ç«¯ä¸åç«¯ååŒæ”¹è¿›
&lt;ul&gt;
&lt;li&gt;M4 çš„è§£ç å™¨ä¸åç«¯æ‰§è¡Œå•å…ƒåŒ¹é…æ›´é«˜æ•ˆï¼Œé€šè¿‡ æ‰©å¤§åˆ†æ”¯é¢„æµ‹çª—å£å’Œ ä¼˜åŒ–æŒ‡ä»¤é¢„å–é€»è¾‘ï¼Œå‡å°‘æµæ°´çº¿åœé¡¿ï¼Œæå‡æŒ‡ä»¤çº§å¹¶è¡Œåº¦ï¼ˆILPï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;åç«¯æ‰§è¡Œæ¶æ„å‡çº§
&lt;ul&gt;
&lt;li&gt;æ‰§è¡Œå•å…ƒä¸è°ƒåº¦é˜Ÿåˆ—æ‰©å±•
&lt;ul&gt;
&lt;li&gt;M4ï¼šåç«¯ Dispatch Bufferï¼ˆæŒ‡ä»¤æ´¾å‘ç¼“å†²åŒºï¼‰å’Œ æµ®ç‚¹è°ƒåº¦é˜Ÿåˆ—å®¹é‡æ˜¾è‘—å¢åŠ ï¼Œæ”¯æŒæ›´å¤æ‚çš„ä¹±åºæ‰§è¡Œï¼ˆOut-of-Order Executionï¼‰ã€‚ä¾‹å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;æµ®ç‚¹å•å…ƒï¼ˆFPUï¼‰è°ƒåº¦é˜Ÿåˆ—æ·±åº¦å¢åŠ  20%ï¼Œæ”¯æŒæ›´å¤šæŒ‡ä»¤å¹¶è¡Œæ‰§è¡Œã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ–°å¢ SME å•å…ƒï¼ˆå¯æ‰©å±•çŸ©é˜µæ‰©å±•ï¼Œç±»ä¼¼ ARMv9 çš„ SVE2ï¼‰ï¼Œä¸“ä¸º AI å’Œ SIMD å¯†é›†å‹ä»»åŠ¡ä¼˜åŒ–ï¼ŒåŠ é€ŸçŸ©é˜µè¿ç®—ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;M1ï¼šåç«¯æ‰§è¡Œèµ„æºè¾ƒå°‘ï¼Œç¼ºä¹ä¸“ç”¨ AI åŠ é€Ÿå•å…ƒï¼Œä¾èµ–ä¼ ç»Ÿ SIMD æŒ‡ä»¤ï¼ˆå¦‚ NEONï¼‰å¤„ç†å¹¶è¡Œä»»åŠ¡ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;å†…å­˜å­ç³»ç»Ÿä¼˜åŒ–
&lt;ul&gt;
&lt;li&gt;M4 é‡‡ç”¨ -7500 å†…å­˜ï¼Œå»¶è¿Ÿä» M1 çš„ 96ns é™ä½è‡³ 88nsï¼Œé…åˆæ›´å¤§çš„å…±äº« L2 ç¼“å­˜ï¼ˆ16MBï¼‰ï¼Œå‡å°‘åç«¯æ‰§è¡Œå•å…ƒç­‰å¾…æ•°æ®çš„æ—¶é—´ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;fen-xi&quot;&gt;åˆ†æ&lt;&#x2F;h2&gt;
&lt;p&gt;ä»¥ test1 åœ¨ M1 ä¸Šçš„æŸæ¬¡æ ·æœ¬ä¸ºä¾‹ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;text&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-text &quot;&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;thread: 88508440, trace time: 4.999996
&lt;&#x2F;span&gt;&lt;span&gt;        cycles: 16016222700
&lt;&#x2F;span&gt;&lt;span&gt;  instructions: 63551443474
&lt;&#x2F;span&gt;&lt;span&gt;      branches: 7620789323
&lt;&#x2F;span&gt;&lt;span&gt; branch-misses: 37781905
&lt;&#x2F;span&gt;&lt;span&gt; 
&lt;&#x2F;span&gt;&lt;span&gt;case: test1, sum: 213330485248, loops: 14846928128, elapsed: 11.525sec, avg: 0.776 ns&#x2F;iter
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;1 iter&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;0.776ns&lt;&#x2F;li&gt;
&lt;li&gt;cycles: 2.486&lt;&#x2F;li&gt;
&lt;li&gt;IPC: 3.97&lt;&#x2F;li&gt;
&lt;li&gt;instructions: 9.86: è¿™ä¸ªæ•°ä¸ ä¸‹é¢çš„æ±‡ç¼–æŒ‡ä»¤æ˜¯ä¸€è‡´çš„ï¼ˆ9ï¼Œè€ƒè™‘åˆ°å¤–å±‚å¾ªç¯è¿˜æœ‰ä¸€äº›æŒ‡ä»¤çš„åˆ†æ‹…ï¼Œåé¢çœ‹çœ‹æ˜¯å¦æœ‰æ›´ç²¾å‡†çš„æµ‹è¯•æ–¹æ³•ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æ ¸å¿ƒå¾ªç¯çš„ asm: ä¸€å…± 9 æ¡æŒ‡ä»¤ï¼Œæ ¹æ®æŒ‡ä»¤çš„ä¾èµ–æ€§ï¼Œè‡³å°‘éœ€è¦ 5 ä¸ª cycle æ‰èƒ½å®Œæˆä¸€æ¬¡è¿­ä»£&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;asm&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-asm &quot;&gt;&lt;code class=&quot;language-asm&quot; data-lang=&quot;asm&quot;&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x1000028a0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;:	rbit   x11&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x10&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;             ; 1 x11 = reverse x10 bits, u1-6            
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;:	clz    x11&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x11&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;             ; 2 x11 = count leading zeros of x11, u1-6    
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;:	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;lsl    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x12&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x9&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x11&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;         ; 3 x12 = 1 &amp;lt;&amp;lt; x11  u1-6    
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;4&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;:	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;add    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x25&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x11&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x25&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;        ; 4.1   sum += x11  u1-6  
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;:	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;add    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x24&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x24&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;#&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;       ; 4.2   loops += 1  u1-6  
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;6&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;:	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mov    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x1&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x24&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;              ; 5.1   x1 = sum  ; è¿™æ¡æŒ‡ä»¤æœ¬æ¥å¯ä»¥æŒªåˆ°å¾ªç¯å¤–é¢ï¼Œrustc æ²¡æœ‰è¿›è¡Œè¿™ä¸ªä¼˜åŒ–  
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;7&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;:	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mov    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x0&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x25&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;              ; 5.2   x0 = loop ; è¿™æ¡æŒ‡ä»¤æœ¬æ¥å¯ä»¥æŒªåˆ°å¾ªç¯å¤–é¢ï¼Œrustc  æ²¡æœ‰è¿›è¡Œè¿™ä¸ªä¼˜åŒ– 
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;:	bics   x10&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x10&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;x12&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;        ; 4.3   x10 = x10 &amp;amp; ~x12    2 * u1-3
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;9&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;:	b.ne   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x1000028a0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;          ; 5.3. &amp;lt;+3112&amp;gt; [inlined] core::num::&amp;lt;impl u64&amp;gt;::trailing_zeros at uint_macros.rs:162:20
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;                                ; u1-2
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å¤§è‡´ç›¸å½“äºåœ¨æ¯ 5 cycle ä¸­å®Œæˆäº† 2 æ¬¡è¿­ä»£ï¼Œå³ç›¸å½“äº loop i å’Œ loop i+1 åŒæ—¶æ‰§è¡Œ&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;é™åˆ¶åªèƒ½æ‰§è¡Œ 2 ä¸ªè¿­ä»£çš„åŸå› ï¼Œä¼°è®¡æ˜¯ bics &#x2F; b.ne æŒ‡ä»¤ä»…èƒ½åœ¨ u1-2 ä¸­æ‰§è¡Œï¼Œå…¶æ‰§è¡Œå•å…ƒçš„é™åˆ¶å¯¼è‡´äº†åç»­çš„æŒ‡ä»¤æ— æ³•ç»§ç»­å¹¶è¡Œã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœè¦è¿›ä¸€æ­¥æå‡å¹¶å‘è¡Œï¼Œåˆ™éœ€è¦ cpu åœ¨è®¾è®¡ä¸Šè¿›ä¸€æ­¥æé«˜æ‰§è¡Œå•å…ƒçš„æ•°é‡ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨å¤§éƒ¨ä»½æƒ…å†µä¸‹ï¼ŒCPU çš„ åˆ†æ”¯é¢„æµ‹å‡†ç¡®ç‡ç›¸å½“ä¹‹é«˜ï¼Œæ¯”å¦‚ test1 ä¸­å‡†ç¡®åº¦é«˜è¾¾ï¼š99.512%ï¼Œtest2 åˆ™æ˜¯ 99.9999%ï¼Œè€Œ test3 åˆ™æ˜¯ 97.1%ã€‚
å…¶ä¸­ test3 çš„æ ·æœ¬æ•°æ®æ˜¯å®Œå…¨éšæœºçš„ï¼Œåˆ†æ”¯é¢„æµ‹çš„å‡†ç¡®ç‡ä»ç„¶é«˜è¾¾ 97.1%ã€‚è¿™ä¸ªå€¼æ˜¯è¿œé«˜äºæˆ‘çš„é¢„æœŸçš„ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åˆ†æ”¯é¢„æµ‹å‡†ç¡®åº¦å¯¹æ€§èƒ½çš„å½±å“æ˜¯å·¨å¤§çš„ï¼Œtest3 çš„å‡†ç¡®åº¦é™ä½äº†2.9%ï¼Œä½†æ•´ä½“æ€§èƒ½åˆ™ä¸‹é™äº† çº¦ 50%ã€‚&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;å‡è®¾åˆ†æ”¯é¢„æµ‹æˆåŠŸæ—¶ ns&#x2F;iter ä¸º xï¼Œå¤±è´¥æ—¶ä¸º yï¼Œåˆ™ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;x = 0.678&lt;&#x2F;li&gt;
&lt;li&gt;(0.971 * x + 0.029 * y) = 1.555&lt;&#x2F;li&gt;
&lt;li&gt;y = 30.91&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;y&#x2F;x = 45.6 å³ï¼š1æ¬¡åˆ†æ”¯é¢„æµ‹å¤±è´¥çš„æˆæœ¬çº¦ç­‰äº 45.6 æ¬¡åˆ†æ”¯é¢„æµ‹æˆåŠŸçš„æˆæœ¬ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;å½“åˆ†æ”¯é¢„æµ‹å¤±è´¥æ—¶ï¼Œè¿›å…¥åˆ°æµæ°´çº¿åé¢çš„æŒ‡ä»¤éœ€è¦è¿›è¡Œæ¸…ç†ï¼Œå¹¶é‡ç½®å‰ç«¯å–æŒ‡ã€è¯‘ç ç­‰æ“ä½œï¼Œåœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œåˆ™ç›¸å½“äº ï½50-100 ä¸ª cycle çš„æˆæœ¬ï¼Œ
è¿™ä¸ªå€¼æ˜¾ç„¶é«˜äºé¢„æœŸäº†ã€‚ï¼ˆç½‘ä¸Šçš„è¯´æ³•æ˜¯ 15-20 ä¸ª cycleï¼‰&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;si-kao&quot;&gt;æ€è€ƒ&lt;&#x2F;h2&gt;
&lt;p&gt;å½“æ•°æ®æœ¬èº«çš„æ— åºæ€§è¾ƒé«˜æ—¶ï¼ŒCPU çš„åˆ†æ”¯é¢„æµ‹èƒ½åŠ›ä¼šå¤§å¹…åº¦ä¸‹é™ï¼Œå…¶å¯¹äºæ€§èƒ½çš„å½±å“ä¹Ÿä¼šå¤§å¹…åº¦ä¸Šå‡ã€‚å¦‚ä½•åº”å¯¹è¿™ç±»é—®é¢˜å‘¢ï¼Œè¿™é‡Œæ˜¯ä¸€äº›æˆ‘çš„æ€è€ƒï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;é€šè¿‡æ•°æ®çš„é¢„å¤„ç†ï¼Œæå‡æ•°æ®çš„æœ‰åºæ€§ï¼Œæ¥æå‡åˆ†æ”¯é¢„æµ‹çš„å‡†ç¡®åº¦ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è¯„ä¼°æ¶ˆé™¤åˆ†æ”¯çš„å¯èƒ½æ€§ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨ ç®—æ•°æ“ä½œ æ¥æ›¿ä»£åˆ†æ”¯æ“ä½œã€‚
&lt;ul&gt;
&lt;li&gt;ç®€å•æ¡ä»¶åˆ¤æ–­è½¬æ¢ä¸º CMOV(x86), CSEL(ARM) æŒ‡ä»¤&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;if (flag) sum += x; &lt;&#x2F;code&gt; æ”¹å†™ä¸º &lt;code&gt;sum += flag * x;&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨ SIMD å®ç°æ— åˆ†æ”¯çš„å¹¶è¡Œè®¡ç®—&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>æ‰§è¡Œè®¡åˆ’ä¹‹ Push based vs Pull based</title>
        <published>2025-04-02T00:00:00+00:00</published>
        <updated>2025-04-02T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/duck-push-vs-datafusion-pull/"/>
        <id>https://wangzaixiang.github.io/blog/duck-push-vs-datafusion-pull/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/duck-push-vs-datafusion-pull/">&lt;p&gt;å…ˆå ä¸ªå‘ä½ï¼Œä»¥åå†å®Œå–„è¿™ç¯‡æ–‡ç« ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ç›®å‰æ•´ç†çš„ä¸€äº›è‰ç¨¿:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;learning&#x2F;perf-vs-duckdb-1.html&quot;&gt;perf-vs-duckdb&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;datafusion-wen-zhang-xi-lie&quot;&gt;datafusion æ–‡ç« ç³»åˆ—&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;duck-push-vs-datafusion-pull&#x2F;&quot;&gt;push vs pull&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-hashjoin&#x2F;&quot;&gt;datafusion hashjoin executor&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-window-function&#x2F;&quot;&gt;datafusion window function executor&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;datafusion-performance&#x2F;&quot;&gt;datafusion performance&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>A Query Intermediate Representation Language (Draft)</title>
        <published>2025-04-02T00:00:00+00:00</published>
        <updated>2025-04-02T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/qir-design/"/>
        <id>https://wangzaixiang.github.io/blog/qir-design/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/qir-design/">&lt;p&gt;QIR æ˜¯ä¸€ç§ç”¨äºæè¿°å…³ç³»ä»£æ•°æŸ¥è¯¢çš„ä¸­é—´è¯­è¨€ï¼ŒSQL æŸ¥è¯¢å¯ä»¥ç¿»è¯‘ç§°ä¸º qir ä»£ç ï¼Œç„¶åå†è§£é‡Šæˆ–è€…ç¼–è¯‘æ‰§è¡Œã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;overview&quot;&gt;Overview&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;what-is-qir&quot;&gt;What is QIR&lt;&#x2F;h2&gt;
&lt;p&gt;QIR (Query Intermediate Representation) æ˜¯ä¸€ç§ç”¨äºæè¿°æ•°æ®æŸ¥è¯¢çš„ä¸­é—´è¡¨ç¤ºè¯­è¨€ï¼Œç±»ä¼¼äº SQL æŸ¥è¯¢çš„æŸ¥è¯¢è®¡åˆ’ï¼‰ã€‚å®ƒå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åŸºäºå…³ç³»ä»£æ•°&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;QIR ä½¿ç”¨å…³ç³»ä»£æ•°ç®—å­(å¦‚ scanã€filterã€joinã€aggregation ç­‰)æ¥æè¿°æ•°æ®å¤„ç†é€»è¾‘&lt;&#x2F;li&gt;
&lt;li&gt;æ¯ä¸ªç®—å­éƒ½æœ‰æ˜ç¡®å®šä¹‰çš„è¾“å…¥å’Œè¾“å‡ºç±»å‹&lt;&#x2F;li&gt;
&lt;li&gt;æ”¯æŒå¤æ‚çš„æ•°æ®å¤„ç†æ“ä½œï¼Œå¦‚ joinã€group byã€window functions ç­‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;AST based&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;QIR æ˜¯ä¸€ç§ AST (Abstract Syntax Tree) è¡¨ç¤ºï¼Œè€Œé bytecode&lt;&#x2F;li&gt;
&lt;li&gt;QIR æ˜¯å‡½æ•°å¼çš„ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ç±»å‹å®‰å…¨&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;QIR æä¾›äº†è¡¨ç»“æ„ç±»å‹å®šä¹‰ï¼Œç”¨äºç±»å‹æ£€æŸ¥ï¼Œå¹¶ä¸”ä¾¿äºJITä¼˜åŒ–ï¼Œå‡å°‘è¿è¡Œæ—¶çš„æ£€æŸ¥å¼€é”€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ¯ä¸ªç®—å­çš„è¾“å…¥è¾“å‡ºç±»å‹åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ£€æŸ¥&lt;&#x2F;li&gt;
&lt;li&gt;å¯ä»¥åŠæ—©å‘ç°ç±»å‹é”™è¯¯ï¼Œæé«˜ä»£ç è´¨é‡&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æµæ°´çº¿å¼å¤„ç†&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;QIR ä½¿ç”¨ pipeline æ¥ç»„ç»‡ç®—å­&lt;&#x2F;li&gt;
&lt;li&gt;æ”¯æŒå¤šä¸ª pipeline ä¹‹é—´çš„ä¾èµ–å…³ç³»&lt;&#x2F;li&gt;
&lt;li&gt;ä¾¿äºè¿›è¡Œå¹¶è¡ŒåŒ–å’Œåˆ†å¸ƒå¼å¤„ç†&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;QIR çš„å®šä½ç±»ä¼¼äº &lt;a href=&quot;https:&#x2F;&#x2F;www.monetdb.org&#x2F;documentation-Mar2025&#x2F;dev-guide&#x2F;monetdb-internals&#x2F;mal_reference&#x2F;&quot;&gt;MonetDB ä¸­çš„ MAL è¯­è¨€&lt;&#x2F;a&gt;ï¼Œæˆ–è€… &lt;a href=&quot;https:&#x2F;&#x2F;sqlite.org&#x2F;opcode.html&quot;&gt;Sqlite ä¸­çš„ bytecode&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;why-qir&quot;&gt;Why QIR&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;å¯ä»¥ç›´æ¥ç”Ÿæˆã€ç¼–å†™ QIR ä»£ç å¹¶æ‰§è¡Œã€‚&lt;&#x2F;li&gt;
&lt;li&gt;SQL æŸ¥è¯¢æ‰©å±•æŸ¥è¯¢ç®—å­è¾ƒä¸ºå¤æ‚ã€‚QIR ç›®æ ‡æ˜¯æä¾›æ›´æ–¹é¢çš„æ‰©å±•ç®—å­èƒ½åŠ›ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ›´æ•æ·çš„æ–°ç®—å­å¼€å‘ã€æµ‹è¯•æµç¨‹
&lt;ul&gt;
&lt;li&gt;å®ç°æ–°çš„ç®—å­ã€ç­–ç•¥ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ‰‹åŠ¨ç¼–å†™ QIR ä»£ç &lt;&#x2F;li&gt;
&lt;li&gt;è¿›è¡Œ JIT ä¼˜åŒ–&lt;&#x2F;li&gt;
&lt;li&gt;è¾¾åˆ°é¢„æœŸæ•ˆæœåï¼Œå†æ”¹è¿› Planner æ”¯æŒæ–°ç®—å­ï¼ˆä»¥ç»ˆä¸ºå§‹ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;æ€§èƒ½ä¼˜åŒ–çš„å®éªŒåœº
&lt;ul&gt;
&lt;li&gt;ä¸°å¯Œçš„ Join ç®—æ³•æ”¯æŒ: semi joinï¼Œ anti-semi joinï¼Œ as of join&lt;&#x2F;li&gt;
&lt;li&gt;çª—å£å‡½æ•°æ‰©å±•ï¼šrange between expr and expr&lt;&#x2F;li&gt;
&lt;li&gt;çª—å£å‡½æ•°æ‰©å±•ï¼šover(partition by expr order by expr where expr)&lt;&#x2F;li&gt;
&lt;li&gt;minmax ç´¢å¼•ä¼˜åŒ–&lt;&#x2F;li&gt;
&lt;li&gt;bloom ç´¢å¼•ä¼˜åŒ–&lt;&#x2F;li&gt;
&lt;li&gt;åˆ†åŒºã€åˆ†æ¡¶æŸ¥è¯¢ä¼˜åŒ–ï¼ˆå¯¹Joinçš„æ”¯æŒï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;profile based optimization&lt;&#x2F;li&gt;
&lt;li&gt;vectorized execution. QIR åŸºäº arrow æ•°æ®ç»“æ„ï¼Œä»¥å‘é‡åŒ–çš„æ–¹å¼è¿›è¡Œæ•°æ®å¤„ç†&lt;&#x2F;li&gt;
&lt;li&gt;JIT: QIR æ›´ä¾¿äº JIT&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;query-ir-de-tuo-bu-tu&quot;&gt;Query IR çš„æ‹“æ‰‘å›¾&lt;&#x2F;h2&gt;
&lt;p&gt;æœ¬æ–‡æ¡£ä¸­çš„æ‹“æ‰‘å›¾ä½¿ç”¨ mermaid æ ¼å¼ç”Ÿæˆï¼Œå…·ä½“æ ¼å¼å¦‚ä¸‹ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;æ¯ä¸ªpipeline å¯¹åº”ä¸€ä¸ª subgraphï¼Œ pipeline çš„ çˆ¶å­å…³ç³»ä½¿ç”¨çº¢è‰²è¿æ¥çº¿è¡¨ç¤º&lt;&#x2F;li&gt;
&lt;li&gt;æ¯ä¸ªç®—å­ï¼ŒåŒ…æ‹¬ Sourceï¼Œ Operatorsï¼Œ Sink å¯¹åº”ä¸€ä¸ª node. ä½¿ç”¨&quot;å˜é‡å:ç®—å­å&quot;ä½œä¸º labelï¼Œ ä¾‹å¦‚ï¼š&quot;user_filter: filter&quot;ï¼Œ å„ä¸ªç®—å­ä¹‹é—´çš„æ•°æ®æµä½¿ç”¨è¿æ¥çº¿è¡¨ç¤º&lt;&#x2F;li&gt;
&lt;li&gt;exchange_sender ä¸ exchange_receiver ä¹‹é—´çš„è¿çº¿ä½¿ç”¨è™šçº¿ï¼Œè¡¨ç¤ºæ•°æ®äº¤æ¢ï¼Œå…¶ä»–çš„æ•°æ®æµä½¿ç”¨å®çº¿ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;lookup_hash_table ä¸ build_hash_table ä¹‹é—´çš„è¿çº¿ä½¿ç”¨ç»¿çº¿ç›¸å…³ï¼Œè¡¨ç¤ºå…¶æ•°æ®ä¾èµ–å…³ç³»ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;node å’Œ link ä¸Šçš„ label å…¨éƒ¨ä½¿ç”¨å¼•å·åŒ…è£¹ï¼Œä»¥é¿å…ç‰¹æ®Šå­—ç¬¦çš„å¹²æ‰°ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;examples&quot;&gt;Examples&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;example-1-jian-dan-cha-xun&quot;&gt;Example 1: ç®€å•æŸ¥è¯¢&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- table: users(id, name, birthday, email)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt; name, email &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; users &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt; birthday &amp;gt; &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;1990-01-01&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å…¶å¯¹åº”çš„ qir ä»£ç å¦‚ä¸‹ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;qir&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-qir &quot;&gt;&lt;code class=&quot;language-qir&quot; data-lang=&quot;qir&quot;&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; type users æ˜¯ä¸€ä¸ªè¡¨ç±»å‹ä¿¡æ¯ï¼Œç”¨äºä¸ºåé¢çš„ä»£ç æä¾›ç±»å‹æ£€æŸ¥ï¼Œä¾‹å¦‚å­—æ®µåæ˜¯å¦æ­£ç¡®ï¼Œæ•°æ®ç±»å‹æ˜¯å¦æ­£ç¡®ç­‰ã€‚
&lt;&#x2F;span&gt;&lt;span&gt;type users = table {
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;users&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    columns = [
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;id&amp;quot;, type = &amp;quot;int&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;name&amp;quot;, type = &amp;quot;string&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;birthday&amp;quot;, type = &amp;quot;date&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;email&amp;quot;, type = &amp;quot;string&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;    ]    
&lt;&#x2F;span&gt;&lt;span&gt;}; 
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; source1 æ˜¯ä¸€ä¸ª Source operator, å…¶è¾“å‡ºç±»å‹ä¸ºï¼š DataFrame {
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F;     columns = [
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F;         {name = &amp;quot;name&amp;quot;, type = &amp;quot;string&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F;         {name = &amp;quot;birthday&amp;quot;, type = &amp;quot;date&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F;         {name = &amp;quot;email&amp;quot;, type = &amp;quot;string&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F;     ]
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; }
&lt;&#x2F;span&gt;&lt;span&gt;let source1 = scan(
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;users&amp;quot;, &#x2F;&#x2F; table name
&lt;&#x2F;span&gt;&lt;span&gt;    table = users, 
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;name&amp;quot;, &amp;quot;birthday&amp;quot;, &amp;quot;email&amp;quot;] ); &#x2F;&#x2F; ä» users è¡¨ä¸­è¯»å–æ•°æ®
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F;&#x2F; filter1 æ˜¯ä¸€ä¸ª ordinary operator, å…¶è¾“å‡ºç±»å‹ä¸ºï¼š DataFrame {
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F;&#x2F;     columns = [
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F;&#x2F;         {name = &amp;quot;name&amp;quot;, type = &amp;quot;string&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F;&#x2F;         {name = &amp;quot;email&amp;quot;, type = &amp;quot;string&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F;&#x2F;     ]
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F;&#x2F; }
&lt;&#x2F;span&gt;&lt;span&gt;let filter1 = filter(input = source1, 
&lt;&#x2F;span&gt;&lt;span&gt;    predictor = |row| { row.birthday &amp;gt; date&amp;#39;1990-01-01&amp;#39; },     &#x2F;&#x2F; è¿‡æ»¤å‡º birthday &amp;gt; &amp;#39;1990-01-01&amp;#39; çš„æ•°æ® 
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;name&amp;quot;, &amp;quot;email&amp;quot;] );   &#x2F;&#x2F; è¾“å‡º name å’Œ email å­—æ®µ
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F;&#x2F; sink1 æ˜¯ä¸€ä¸ª sink operator, å…¶è¾“å‡ºç±»å‹ä¸è¾“å…¥ç±»å‹ç›¸åŒï¼Œèµ·åˆ°ä¸€ä¸ªæ”¶é›†çš„ä½œç”¨
&lt;&#x2F;span&gt;&lt;span&gt;let sink1 = identity_sink(input = filter1); 
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let pipeline1 = pipeline {
&lt;&#x2F;span&gt;&lt;span&gt;    source = source1,
&lt;&#x2F;span&gt;&lt;span&gt;    operators = [filter1],
&lt;&#x2F;span&gt;&lt;span&gt;    sink = sink1
&lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; graph æ˜¯ä¸€ä¸ª topology ç±»å‹ï¼Œç”¨äºæè¿°æ•´ä¸ªæŸ¥è¯¢çš„æ‹“æ‰‘ç»“æ„ï¼Œä¹Ÿæ˜¯å•ä¸ª qir æ–‡ä»¶çš„æœ€ç»ˆè¾“å‡ºç»“æœã€‚
&lt;&#x2F;span&gt;&lt;span&gt;let graph = topology( main = pipeline1 );
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;example-2-simple-join&quot;&gt;Example 2: simple join&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;--- table: order_item(order_item_id: u64, order_date: date, product_id: u32, quantity: u32, amount: decimal)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;--- table: product(product_id: u32, product_name: string, category_id: u32)
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt; product_name, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(quantity), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(amount)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; order_item &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;join&lt;&#x2F;span&gt;&lt;span&gt; product on &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;order_item&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;product_id &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;product&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;product_id
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by&lt;&#x2F;span&gt;&lt;span&gt; product_name
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å¯¹åº”çš„ qir ä»£ç å¦‚ä¸‹ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;qir&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-qir &quot;&gt;&lt;code class=&quot;language-qir&quot; data-lang=&quot;qir&quot;&gt;&lt;span&gt;&#x2F;&#x2F; å®šä¹‰è¡¨ç»“æ„ç±»å‹
&lt;&#x2F;span&gt;&lt;span&gt;type order_item = table {
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;order_item&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    columns = [
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;order_item_id&amp;quot;, type = &amp;quot;u64&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;order_date&amp;quot;, type = &amp;quot;date&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;product_id&amp;quot;, type = &amp;quot;u32&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;quantity&amp;quot;, type = &amp;quot;u32&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;amount&amp;quot;, type = &amp;quot;decimal&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;    ]
&lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;type product = table {
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;product&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    columns = [
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;product_id&amp;quot;, type = &amp;quot;u32&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;product_name&amp;quot;, type = &amp;quot;string&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;category_id&amp;quot;, type = &amp;quot;u32&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;    ]
&lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; æºæ“ä½œç¬¦
&lt;&#x2F;span&gt;&lt;span&gt;let order_item_source = scan(
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;order_item&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    table = order_item,
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;product_id&amp;quot;, &amp;quot;quantity&amp;quot;, &amp;quot;amount&amp;quot;]  &#x2F;&#x2F; åªéœ€è¦å‚ä¸è®¡ç®—çš„å­—æ®µ
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let product_source = scan(
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;product_scan&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    table = product,
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;product_id&amp;quot;, &amp;quot;product_name&amp;quot;]       &#x2F;&#x2F; åªéœ€è¦å…³è”å­—æ®µå’Œåˆ†ç»„å­—æ®µ
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let ht_build1 = build_hash_table(
&lt;&#x2F;span&gt;&lt;span&gt;	input = product_source,
&lt;&#x2F;span&gt;&lt;span&gt;	key = [ &amp;quot;product_id&amp;quot; ] );
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let ht_lookup1 = lookup_hash_table( ht = ht_build1, input = order_item_source, key = [&amp;quot;product_id&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;	output = [ [&amp;quot;quantity&amp;quot;, &amp;quot;amount&amp;quot;], &#x2F;&#x2F; field from lookup side
&lt;&#x2F;span&gt;&lt;span&gt;			   [&amp;quot;product_name&amp;quot;] ]	&#x2F;&#x2F; field from build side
&lt;&#x2F;span&gt;&lt;span&gt; );
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let hash_aggr1 = hash_aggregator( input = h1_lookup1, 
&lt;&#x2F;span&gt;&lt;span&gt;	group_by = [&amp;quot;product_name&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;	aggregators = [
&lt;&#x2F;span&gt;&lt;span&gt;		sum_aggregator( name=&amp;quot;total_quantity&amp;quot;, field = &amp;quot;quantity&amp;quot; ),
&lt;&#x2F;span&gt;&lt;span&gt;		sum_aggregator( name=&amp;quot;total_amount&amp;quot;, field = &amp;quot;amount&amp;quot; )
&lt;&#x2F;span&gt;&lt;span&gt;	],
&lt;&#x2F;span&gt;&lt;span&gt;	output = [ &amp;quot;product_name&amp;quot;, &amp;quot;total_quantity&amp;quot;, &amp;quot;total_amount&amp;quot; ]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let pipeline1 = pipeline( source = product_source, sink = ht_build1 );
&lt;&#x2F;span&gt;&lt;span&gt;let pipeline2 = pipeline( source = order_item_source, operators = [ht_lookup1], sink = hash_aggr1, 
&lt;&#x2F;span&gt;&lt;span&gt;	parent = [pipeline1] );	&#x2F;&#x2F; pipeline2 ä¾èµ– pipeline1, ä»…å½“ pipeline1 æ‰§è¡Œå®Œæˆåï¼Œæ‰èƒ½å¼€å§‹æ‰§è¡Œ
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let graph = topology(main = pipeline2);
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;example-3-join-with-filter&quot;&gt;Example 3: join with filter&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- table: order_item(order_item_id, order_date, user_id, product_id, quantity, amount)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- table: users(user_id, name, sex, province, city)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt; province, city, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;(order_item_id), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(quantity), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(amount)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; order_item &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;left join&lt;&#x2F;span&gt;&lt;span&gt; users on &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;order_item&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;user_id &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;users&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;user_id
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt; order_date &amp;gt;= &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;2025-01-1&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; and sex = &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;F&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by&lt;&#x2F;span&gt;&lt;span&gt; province, city
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre data-lang=&quot;qir&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-qir &quot;&gt;&lt;code class=&quot;language-qir&quot; data-lang=&quot;qir&quot;&gt;&lt;span&gt;&#x2F;&#x2F; å®šä¹‰è¡¨ç»“æ„ç±»å‹
&lt;&#x2F;span&gt;&lt;span&gt;type order_item = table {
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;order_item&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    columns = [
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;order_item_id&amp;quot;, type = &amp;quot;u64&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;order_date&amp;quot;, type = &amp;quot;date&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;user_id&amp;quot;, type = &amp;quot;u32&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;product_id&amp;quot;, type = &amp;quot;u32&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;quantity&amp;quot;, type = &amp;quot;u32&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;amount&amp;quot;, type = &amp;quot;decimal&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;    ]
&lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;type users = table {
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;users&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    columns = [
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;user_id&amp;quot;, type = &amp;quot;u32&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;name&amp;quot;, type = &amp;quot;string&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;sex&amp;quot;, type = &amp;quot;string&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;province&amp;quot;, type = &amp;quot;string&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;city&amp;quot;, type = &amp;quot;string&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;    ]
&lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; æºæ“ä½œç¬¦å’Œè¿‡æ»¤ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
&lt;&#x2F;span&gt;&lt;span&gt;let users_scan = scan(
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;users&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    table = users,
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;user_id&amp;quot;, &amp;quot;sex&amp;quot;, &amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let users_filter = filter(
&lt;&#x2F;span&gt;&lt;span&gt;    input = users_scan,
&lt;&#x2F;span&gt;&lt;span&gt;    predictor = |row| { row.sex == &amp;quot;F&amp;quot; },  &#x2F;&#x2F; æå‰è¿‡æ»¤å¥³æ€§ç”¨æˆ·
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;user_id&amp;quot;, &amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let ht_build = build_hash_table(
&lt;&#x2F;span&gt;&lt;span&gt;    input = users_filter,
&lt;&#x2F;span&gt;&lt;span&gt;    key = [&amp;quot;user_id&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let order_item_scan = scan(
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;order_item&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    table = order_item,
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;user_id&amp;quot;, &amp;quot;order_item_id&amp;quot;, &amp;quot;quantity&amp;quot;, &amp;quot;amount&amp;quot;, &amp;quot;order_date&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let order_filter = filter(
&lt;&#x2F;span&gt;&lt;span&gt;    input = order_item_scan,
&lt;&#x2F;span&gt;&lt;span&gt;    predictor = |row| { row.order_date &amp;gt;= date&amp;#39;2025-01-01&amp;#39; },
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;user_id&amp;quot;, &amp;quot;order_item_id&amp;quot;, &amp;quot;quantity&amp;quot;, &amp;quot;amount&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let ht_lookup = lookup_hash_table(
&lt;&#x2F;span&gt;&lt;span&gt;    ht = ht_build,
&lt;&#x2F;span&gt;&lt;span&gt;    input = order_filter,
&lt;&#x2F;span&gt;&lt;span&gt;    key = [&amp;quot;user_id&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;    output = [
&lt;&#x2F;span&gt;&lt;span&gt;        [&amp;quot;order_item_id&amp;quot;, &amp;quot;quantity&amp;quot;, &amp;quot;amount&amp;quot;],  &#x2F;&#x2F; è®¢å•è¡¨å­—æ®µ
&lt;&#x2F;span&gt;&lt;span&gt;        [&amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;]                     &#x2F;&#x2F; ç”¨æˆ·è¡¨å­—æ®µï¼ˆå·²è¿‡æ»¤ï¼‰
&lt;&#x2F;span&gt;&lt;span&gt;    ],
&lt;&#x2F;span&gt;&lt;span&gt;    join_type = &amp;quot;inner&amp;quot;  &#x2F;&#x2F; æ”¹ä¸ºå†…è¿æ¥ï¼ˆå› ä¸ºç”¨æˆ·è¡¨å·²è¿‡æ»¤ï¼‰
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let hash_aggr = hash_aggregator(
&lt;&#x2F;span&gt;&lt;span&gt;    input = ht_lookup,
&lt;&#x2F;span&gt;&lt;span&gt;    group_by = [&amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;    aggregators = [
&lt;&#x2F;span&gt;&lt;span&gt;        count_aggregator(name = &amp;quot;total_orders&amp;quot;, field = &amp;quot;order_item_id&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;        sum_aggregator(name = &amp;quot;total_quantity&amp;quot;, field = &amp;quot;quantity&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;        sum_aggregator(name = &amp;quot;total_amount&amp;quot;, field = &amp;quot;amount&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;    ],
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;, &amp;quot;total_orders&amp;quot;, &amp;quot;total_quantity&amp;quot;, &amp;quot;total_amount&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; æµæ°´çº¿å®šä¹‰ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
&lt;&#x2F;span&gt;&lt;span&gt;let pipeline1 = pipeline(
&lt;&#x2F;span&gt;&lt;span&gt;    source = users_scan,
&lt;&#x2F;span&gt;&lt;span&gt;    operators = [users_filter],
&lt;&#x2F;span&gt;&lt;span&gt;    sink = ht_build
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let pipeline2 = pipeline(
&lt;&#x2F;span&gt;&lt;span&gt;    source = order_item_scan,
&lt;&#x2F;span&gt;&lt;span&gt;    operators = [order_filter, ht_lookup, hash_aggr],
&lt;&#x2F;span&gt;&lt;span&gt;    sink = hash_aggr,
&lt;&#x2F;span&gt;&lt;span&gt;    parent = [pipeline1]  &#x2F;&#x2F; å¼ºä¾èµ–
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let graph = topology(main = pipeline2);
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;example-4-join-with-filter-and-having&quot;&gt;Example 4: join with filter and having&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- table: order_item(order_item_id, order_date, user_id, product_id, quantity, amount)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- table: users(user_id, name, sex, province, city)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt; province, city, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;(order_item_id), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(quantity), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(amount)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; order_item &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;left join&lt;&#x2F;span&gt;&lt;span&gt; users on &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;order_item&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;user_id &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;users&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;user_id
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt; order_date &amp;gt;= &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;2025-01-1&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; and sex = &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;F&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by&lt;&#x2F;span&gt;&lt;span&gt; province, city
&lt;&#x2F;span&gt;&lt;span&gt;having &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;(order_item_id) &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ç­‰ä»·çš„ qir ä»£ç ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;qir&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-qir &quot;&gt;&lt;code class=&quot;language-qir&quot; data-lang=&quot;qir&quot;&gt;&lt;span&gt;&#x2F;&#x2F; å®šä¹‰è¡¨ç»“æ„ç±»å‹ï¼ˆä¸ç¤ºä¾‹3ç›¸åŒï¼‰
&lt;&#x2F;span&gt;&lt;span&gt;type order_item = table {
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;order_item&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    columns = [
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;order_item_id&amp;quot;, type = &amp;quot;u64&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;order_date&amp;quot;, type = &amp;quot;date&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;user_id&amp;quot;, type = &amp;quot;u32&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;product_id&amp;quot;, type = &amp;quot;u32&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;quantity&amp;quot;, type = &amp;quot;u32&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;amount&amp;quot;, type = &amp;quot;decimal&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;    ]
&lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;type users = table {
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;users&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    columns = [
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;user_id&amp;quot;, type = &amp;quot;u32&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;name&amp;quot;, type = &amp;quot;string&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;sex&amp;quot;, type = &amp;quot;string&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;province&amp;quot;, type = &amp;quot;string&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;city&amp;quot;, type = &amp;quot;string&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;    ]
&lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; æºæ“ä½œç¬¦å’Œè¿‡æ»¤ï¼ˆç»§æ‰¿ä¼˜åŒ–é€»è¾‘ï¼‰
&lt;&#x2F;span&gt;&lt;span&gt;let users_scan = scan(
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;users&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    table = users,
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;user_id&amp;quot;, &amp;quot;sex&amp;quot;, &amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let users_filter = filter(
&lt;&#x2F;span&gt;&lt;span&gt;    input = users_scan,
&lt;&#x2F;span&gt;&lt;span&gt;    predictor = |row| { row.sex == &amp;quot;F&amp;quot; },
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;user_id&amp;quot;, &amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let ht_build = build_hash_table(
&lt;&#x2F;span&gt;&lt;span&gt;    input = users_filter,
&lt;&#x2F;span&gt;&lt;span&gt;    key = [&amp;quot;user_id&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let order_item_scan = scan(
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;order_item&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    table = order_item,
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;user_id&amp;quot;, &amp;quot;order_item_id&amp;quot;, &amp;quot;quantity&amp;quot;, &amp;quot;amount&amp;quot;, &amp;quot;order_date&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let order_filter = filter(
&lt;&#x2F;span&gt;&lt;span&gt;    input = order_item_scan,
&lt;&#x2F;span&gt;&lt;span&gt;    predictor = |row| { row.order_date &amp;gt;= date&amp;#39;2025-01-01&amp;#39; },
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;user_id&amp;quot;, &amp;quot;order_item_id&amp;quot;, &amp;quot;quantity&amp;quot;, &amp;quot;amount&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let ht_lookup = lookup_hash_table(
&lt;&#x2F;span&gt;&lt;span&gt;    ht = ht_build,
&lt;&#x2F;span&gt;&lt;span&gt;    input = order_filter,
&lt;&#x2F;span&gt;&lt;span&gt;    key = [&amp;quot;user_id&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;    output = [
&lt;&#x2F;span&gt;&lt;span&gt;        [&amp;quot;order_item_id&amp;quot;, &amp;quot;quantity&amp;quot;, &amp;quot;amount&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;        [&amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;    ],
&lt;&#x2F;span&gt;&lt;span&gt;    join_type = &amp;quot;inner&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; æ–°å¢ HAVING è¿‡æ»¤é˜¶æ®µ
&lt;&#x2F;span&gt;&lt;span&gt;let hash_aggr = hash_aggregator(
&lt;&#x2F;span&gt;&lt;span&gt;    input = ht_lookup,
&lt;&#x2F;span&gt;&lt;span&gt;    group_by = [&amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;    aggregators = [
&lt;&#x2F;span&gt;&lt;span&gt;        count_aggregator(name = &amp;quot;total_orders&amp;quot;, field = &amp;quot;order_item_id&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;        sum_aggregator(name = &amp;quot;total_quantity&amp;quot;, field = &amp;quot;quantity&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;        sum_aggregator(name = &amp;quot;total_amount&amp;quot;, field = &amp;quot;amount&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;    ],
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;, &amp;quot;total_orders&amp;quot;, &amp;quot;total_quantity&amp;quot;, &amp;quot;total_amount&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let having_filter = filter(
&lt;&#x2F;span&gt;&lt;span&gt;    input = hash_aggr,
&lt;&#x2F;span&gt;&lt;span&gt;    predictor = |row| { row.total_orders &amp;gt; 10 },  &#x2F;&#x2F; HAVING æ¡ä»¶
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;, &amp;quot;total_orders&amp;quot;, &amp;quot;total_quantity&amp;quot;, &amp;quot;total_amount&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; æµæ°´çº¿å®šä¹‰
&lt;&#x2F;span&gt;&lt;span&gt;let pipeline1 = pipeline(
&lt;&#x2F;span&gt;&lt;span&gt;    source = users_scan,
&lt;&#x2F;span&gt;&lt;span&gt;    operators = [users_filter],
&lt;&#x2F;span&gt;&lt;span&gt;    sink = ht_build
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let pipeline2 = pipeline(
&lt;&#x2F;span&gt;&lt;span&gt;    source = order_item_scan,
&lt;&#x2F;span&gt;&lt;span&gt;    operators = [order_filter, ht_lookup, hash_aggr, having_filter],
&lt;&#x2F;span&gt;&lt;span&gt;    sink = having_filter,
&lt;&#x2F;span&gt;&lt;span&gt;    parent = [pipeline1]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let graph = topology(main = pipeline2);
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å¯¹åº”çš„æ‹“æ‰‘å›¾ä¸ºï¼š
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
graph TD
    subgraph Pipeline1[&amp;quot;ç”¨æˆ·è¡¨å¤„ç†&amp;quot;]
        us1[&amp;quot;users_scan: scan&amp;quot;] --&amp;gt;|&amp;quot;è¯»å–ç”¨æˆ·æ•°æ®&amp;quot;| uf1[&amp;quot;users_filter: filter&amp;quot;]
        uf1 --&amp;gt;|&amp;quot;è¿‡æ»¤å¥³æ€§ç”¨æˆ·&amp;quot;| hb1[&amp;quot;ht_build: build_hash_table&amp;quot;]
    end

    subgraph Pipeline2[&amp;quot;è®¢å•å¤„ç†&amp;quot;]
        ois1[&amp;quot;order_item_scan: scan&amp;quot;] --&amp;gt;|&amp;quot;è¯»å–è®¢å•æ•°æ®&amp;quot;| of1[&amp;quot;order_filter: filter&amp;quot;]
        of1 --&amp;gt;|&amp;quot;è¿‡æ»¤æ—¥æœŸ&amp;quot;| hl1[&amp;quot;ht_lookup: lookup_hash_table&amp;quot;]
        hl1 --&amp;gt;|&amp;quot;è¿æ¥ç»“æœ&amp;quot;| ha1[&amp;quot;hash_aggr: hash_aggregator&amp;quot;]
        ha1 --&amp;gt;|&amp;quot;èšåˆç»“æœ&amp;quot;| hf1[&amp;quot;having_filter: filter&amp;quot;]
    end

    Pipeline1 --&amp;gt;|&amp;quot;çˆ¶ä¾èµ–&amp;quot;| Pipeline2
    hb1 -.-&amp;gt;|&amp;quot;å“ˆå¸Œè¡¨ä¾èµ–&amp;quot;| hl1
```
&lt;&#x2F;div&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;example-5-shuffle-join&quot;&gt;Example 5: shuffle join&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- big table join, using shuffle join
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- table: order_item(order_item_id, order_date, user_id, product_id, quantity, amount)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- table: users(user_id, name, sex, province, city)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt; province, city, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;(order_item_id), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(quantity), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(amount)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; order_item &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;left join&lt;&#x2F;span&gt;&lt;span&gt; users on &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;order_item&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;user_id &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;users&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;user_id
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt; order_date &amp;gt;= &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;2025-01-1&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; and sex = &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;F&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by&lt;&#x2F;span&gt;&lt;span&gt; province, city
&lt;&#x2F;span&gt;&lt;span&gt;having &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;(order_item_id) &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å¯¹åº”çš„ qir ä»£ç å¦‚ä¸‹ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;qir&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-qir &quot;&gt;&lt;code class=&quot;language-qir&quot; data-lang=&quot;qir&quot;&gt;&lt;span&gt;&#x2F;&#x2F; å®šä¹‰è¡¨ç»“æ„ç±»å‹
&lt;&#x2F;span&gt;&lt;span&gt;type order_item = table {
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;order_item&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    columns = [
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;order_item_id&amp;quot;, type = &amp;quot;u64&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;order_date&amp;quot;, type = &amp;quot;date&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;user_id&amp;quot;, type = &amp;quot;u32&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;product_id&amp;quot;, type = &amp;quot;u32&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;quantity&amp;quot;, type = &amp;quot;u32&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;amount&amp;quot;, type = &amp;quot;decimal&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;    ]
&lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;type users = table {
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;users&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    columns = [
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;user_id&amp;quot;, type = &amp;quot;u32&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;name&amp;quot;, type = &amp;quot;string&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;sex&amp;quot;, type = &amp;quot;string&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;province&amp;quot;, type = &amp;quot;string&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;city&amp;quot;, type = &amp;quot;string&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;    ]
&lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; ç”¨æˆ·è¡¨å¤„ç†æµæ°´çº¿ï¼ˆå“ˆå¸Œè¡¨æ„å»ºä¾§ï¼‰
&lt;&#x2F;span&gt;&lt;span&gt;let users_scan = scan(
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;users&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    table = users,
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;user_id&amp;quot;, &amp;quot;sex&amp;quot;, &amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let users_filter = filter(
&lt;&#x2F;span&gt;&lt;span&gt;    input = users_scan,
&lt;&#x2F;span&gt;&lt;span&gt;    predictor = |row| { row.sex == &amp;quot;F&amp;quot; },
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;user_id&amp;quot;, &amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let users_exchange_sender = exchange_sender(
&lt;&#x2F;span&gt;&lt;span&gt;    input = users_filter,
&lt;&#x2F;span&gt;&lt;span&gt;    partition_by = [&amp;quot;user_id&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;    shuffle_mode = &amp;quot;HASH&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let users_exchange_receiver = exchange_receiver(
&lt;&#x2F;span&gt;&lt;span&gt;    input = users_exchange_sender,
&lt;&#x2F;span&gt;&lt;span&gt;    partition_by = [&amp;quot;user_id&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;    shuffle_mode = &amp;quot;HASH&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let ht_build = build_hash_table(
&lt;&#x2F;span&gt;&lt;span&gt;    input = users_exchange_receiver,
&lt;&#x2F;span&gt;&lt;span&gt;    key = [&amp;quot;user_id&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; è®¢å•è¡¨å¤„ç†æµæ°´çº¿ï¼ˆæ¢æµ‹ä¾§ï¼‰
&lt;&#x2F;span&gt;&lt;span&gt;let order_scan = scan(
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;order_item&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    table = order_item,
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;user_id&amp;quot;, &amp;quot;order_item_id&amp;quot;, &amp;quot;quantity&amp;quot;, &amp;quot;amount&amp;quot;, &amp;quot;order_date&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let order_filter = filter(
&lt;&#x2F;span&gt;&lt;span&gt;    input = order_scan,
&lt;&#x2F;span&gt;&lt;span&gt;    predictor = |row| { row.order_date &amp;gt;= date&amp;#39;2025-01-01&amp;#39; },
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;user_id&amp;quot;, &amp;quot;order_item_id&amp;quot;, &amp;quot;quantity&amp;quot;, &amp;quot;amount&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let order_exchange_sender = exchange_sender(
&lt;&#x2F;span&gt;&lt;span&gt;    input = order_filter,
&lt;&#x2F;span&gt;&lt;span&gt;    partition_by = [&amp;quot;user_id&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;    shuffle_mode = &amp;quot;HASH&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let order_exchange_receiver = exchange_receiver(
&lt;&#x2F;span&gt;&lt;span&gt;    input = order_exchange_sender,
&lt;&#x2F;span&gt;&lt;span&gt;    partition_by = [&amp;quot;user_id&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;    shuffle_mode = &amp;quot;HASH&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; æœ¬åœ°Joinä¸èšåˆ
&lt;&#x2F;span&gt;&lt;span&gt;let ht_lookup = lookup_hash_table(
&lt;&#x2F;span&gt;&lt;span&gt;    ht = ht_build,
&lt;&#x2F;span&gt;&lt;span&gt;    input = order_exchange_receiver,
&lt;&#x2F;span&gt;&lt;span&gt;    key = [&amp;quot;user_id&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;    output = [
&lt;&#x2F;span&gt;&lt;span&gt;        [&amp;quot;order_item_id&amp;quot;, &amp;quot;quantity&amp;quot;, &amp;quot;amount&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;        [&amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;    ],
&lt;&#x2F;span&gt;&lt;span&gt;    join_type = &amp;quot;inner&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let local_aggr = hash_aggregator(
&lt;&#x2F;span&gt;&lt;span&gt;    input = ht_lookup,
&lt;&#x2F;span&gt;&lt;span&gt;    group_by = [&amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;    aggregators = [
&lt;&#x2F;span&gt;&lt;span&gt;        count_aggregator(name = &amp;quot;total_orders&amp;quot;, field = &amp;quot;order_item_id&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;        sum_aggregator(name = &amp;quot;total_quantity&amp;quot;, field = &amp;quot;quantity&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;        sum_aggregator(name = &amp;quot;total_amount&amp;quot;, field = &amp;quot;amount&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;    ],
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;, &amp;quot;total_orders&amp;quot;, &amp;quot;total_quantity&amp;quot;, &amp;quot;total_amount&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; å…¨å±€èšåˆé˜¶æ®µ
&lt;&#x2F;span&gt;&lt;span&gt;let global_exchange_sender = exchange_sender(
&lt;&#x2F;span&gt;&lt;span&gt;    input = local_aggr,
&lt;&#x2F;span&gt;&lt;span&gt;    partition_by = [&amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;    shuffle_mode = &amp;quot;HASH&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let global_exchange_receiver = exchange_receiver(
&lt;&#x2F;span&gt;&lt;span&gt;    input = global_exchange_sender,
&lt;&#x2F;span&gt;&lt;span&gt;    partition_by = [&amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;    shuffle_mode = &amp;quot;HASH&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let global_aggr = hash_aggregator(
&lt;&#x2F;span&gt;&lt;span&gt;    input = global_exchange_receiver,
&lt;&#x2F;span&gt;&lt;span&gt;    group_by = [&amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;    aggregators = [
&lt;&#x2F;span&gt;&lt;span&gt;        sum_aggregator(name = &amp;quot;total_orders&amp;quot;, field = &amp;quot;total_orders&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;        sum_aggregator(name = &amp;quot;total_quantity&amp;quot;, field = &amp;quot;total_quantity&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;        sum_aggregator(name = &amp;quot;total_amount&amp;quot;, field = &amp;quot;total_amount&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;    ],
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;, &amp;quot;total_orders&amp;quot;, &amp;quot;total_quantity&amp;quot;, &amp;quot;total_amount&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let having_filter = filter(
&lt;&#x2F;span&gt;&lt;span&gt;    input = global_aggr,
&lt;&#x2F;span&gt;&lt;span&gt;    predictor = |row| { row.total_orders &amp;gt; 10 },
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;province&amp;quot;, &amp;quot;city&amp;quot;, &amp;quot;total_orders&amp;quot;, &amp;quot;total_quantity&amp;quot;, &amp;quot;total_amount&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; æµæ°´çº¿å®šä¹‰
&lt;&#x2F;span&gt;&lt;span&gt;let pipeline_users = pipeline(
&lt;&#x2F;span&gt;&lt;span&gt;    source = users_scan,
&lt;&#x2F;span&gt;&lt;span&gt;    operators = [users_filter, users_exchange_sender],
&lt;&#x2F;span&gt;&lt;span&gt;    sink = users_exchange_sender
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let pipeline_ht = pipeline(
&lt;&#x2F;span&gt;&lt;span&gt;    source = users_exchange_receiver,
&lt;&#x2F;span&gt;&lt;span&gt;    operators = [ht_build],
&lt;&#x2F;span&gt;&lt;span&gt;    sink = ht_build,
&lt;&#x2F;span&gt;&lt;span&gt;    parent = [pipeline_users]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let pipeline_order = pipeline(
&lt;&#x2F;span&gt;&lt;span&gt;    source = order_scan,
&lt;&#x2F;span&gt;&lt;span&gt;    operators = [order_filter, order_exchange_sender],
&lt;&#x2F;span&gt;&lt;span&gt;    sink = order_exchange_sender
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let pipeline_join = pipeline(
&lt;&#x2F;span&gt;&lt;span&gt;    source = order_exchange_receiver,
&lt;&#x2F;span&gt;&lt;span&gt;    operators = [ht_lookup, local_aggr, global_exchange_sender],
&lt;&#x2F;span&gt;&lt;span&gt;    sink = global_exchange_sender,
&lt;&#x2F;span&gt;&lt;span&gt;    parent = [pipeline_ht, pipeline_order]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let pipeline_global = pipeline(
&lt;&#x2F;span&gt;&lt;span&gt;    source = global_exchange_receiver,
&lt;&#x2F;span&gt;&lt;span&gt;    operators = [global_aggr, having_filter],
&lt;&#x2F;span&gt;&lt;span&gt;    sink = having_filter,
&lt;&#x2F;span&gt;&lt;span&gt;    parent = [pipeline_join]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let graph = topology(main = pipeline_global);
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å¯¹åº”çš„æ‹“æ‰‘å›¾å¦‚ä¸‹ï¼š
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
graph TD
    subgraph Pipeline1[&amp;quot;Usersé¢„å¤„ç†&amp;quot;]
        us1[&amp;quot;users_scan: scan&amp;quot;] --&amp;gt;|&amp;quot;åŸå§‹æ•°æ®&amp;quot;| us2[&amp;quot;users_filter: filter&amp;quot;]
        us2 --&amp;gt;|&amp;quot;è¿‡æ»¤å¥³æ€§ç”¨æˆ·&amp;quot;| us3[&amp;quot;users_exchange_sender: exchange_sender&amp;quot;]
        style us3 stroke:#666,stroke-dasharray:5 5
    end

    us3 -.-&amp;gt; ur1

    subgraph Pipeline2[&amp;quot;å“ˆå¸Œè¡¨æ„å»º&amp;quot;]
        ur1[&amp;quot;users_exchange_receiver: exchange_receiver&amp;quot;] --&amp;gt;|&amp;quot;æŒ‰user_idåˆ†åŒº&amp;quot;| ur2[&amp;quot;ht_build: build_hash_table&amp;quot;]
        style ur1 stroke:#666,stroke-dasharray:5 5
    end

    subgraph Pipeline3[&amp;quot;Ordersé¢„å¤„ç†&amp;quot;]
        od1[&amp;quot;order_scan: scan&amp;quot;] --&amp;gt;|&amp;quot;åŸå§‹è®¢å•&amp;quot;| od2[&amp;quot;order_filter: filter&amp;quot;]
        od2 --&amp;gt;|&amp;quot;è¿‡æ»¤æ—¥æœŸ&amp;quot;| od3[order_exchange_sender: exchange_sender]
        style od3 stroke:#666,stroke-dasharray:5 5
    end

    od3 -.-&amp;gt; or1

    subgraph Pipeline4[&amp;quot;æœ¬åœ°Joinèšåˆ&amp;quot;]
        or1[&amp;quot;order_exchange_receiver: exchange_receiver&amp;quot;] --&amp;gt;|&amp;quot;æŒ‰user_idåˆ†åŒº&amp;quot;| j1[&amp;quot;ht_lookup: lookup_hash_table&amp;quot;]
        j1 -.-&amp;gt;|&amp;quot;å“ˆå¸Œè¡¨ä¾èµ–&amp;quot;| ur2
        style j1 stroke:#0F0
        j1 --&amp;gt;|&amp;quot;è¿æ¥ç»“æœ&amp;quot;| a1[&amp;quot;local_aggr: hash_aggregator&amp;quot;]
        a1 --&amp;gt;|&amp;quot;æœ¬åœ°èšåˆ&amp;quot;| e1[global_exchange_sender: exchange_sender]
        style e1 stroke:#666,stroke-dasharray:5 5
    end

    e1 -.-&amp;gt; gr1
    
    subgraph Pipeline5[&amp;quot;å…¨å±€èšåˆ&amp;quot;]
        gr1[&amp;quot;global_exchange_receiver: exchange_receiver&amp;quot;] --&amp;gt;|æŒ‰çœå¸‚åˆ†åŒº| a2[&amp;quot;global_aggr: hash_aggregator&amp;quot;]
        style gr1 stroke:#666,stroke-dasharray:5 5
        a2 --&amp;gt;|æœ€ç»ˆç»“æœ| f1[&amp;quot;having_filter: filter&amp;quot;]
    end

   Pipeline1 --&amp;gt;|&amp;quot;Shuffle(user_id)&amp;quot;| Pipeline2
   Pipeline3 --&amp;gt;|&amp;quot;Shuffle(user_id)&amp;quot;| Pipeline4
   Pipeline2 --&amp;gt;|&amp;quot;å“ˆå¸Œè¡¨æ•°æ®&amp;quot;| Pipeline4
   Pipeline4 --&amp;gt;|&amp;quot;Shuffle(province&amp;#x2F;city)&amp;quot;| Pipeline5
```
&lt;&#x2F;div&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;example-6-chuang-kou-han-shu&quot;&gt;Example 6: çª—å£å‡½æ•°&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- table data(Plant: string, Date: date, mwh: f64)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Plant&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Date&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;avg&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;MWh&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) OVER (
&lt;&#x2F;span&gt;&lt;span&gt;        PARTITION BY &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Plant&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;ORDER BY &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Date&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;ASC
&lt;&#x2F;span&gt;&lt;span&gt;        RANGE BETWEEN INTERVAL &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3&lt;&#x2F;span&gt;&lt;span&gt; DAYS PRECEDING
&lt;&#x2F;span&gt;&lt;span&gt;                  AND INTERVAL &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3&lt;&#x2F;span&gt;&lt;span&gt; DAYS FOLLOWING)
&lt;&#x2F;span&gt;&lt;span&gt;        AS &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;MWh 7-day Moving Average&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;FROM &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;data&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;ORDER BY &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å¯¹åº”çš„ qir ä»£ç ä¸ºï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;qir&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-qir &quot;&gt;&lt;code class=&quot;language-qir&quot; data-lang=&quot;qir&quot;&gt;&lt;span&gt;type data = table {
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;data&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    columns = [
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;Plant&amp;quot;, type = &amp;quot;string&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;Date&amp;quot;, type = &amp;quot;date&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;        {name = &amp;quot;MWh&amp;quot;, type = &amp;quot;f64&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;    ]
&lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; æ•°æ®è¯»å–
&lt;&#x2F;span&gt;&lt;span&gt;let data_scan = scan(
&lt;&#x2F;span&gt;&lt;span&gt;    name = &amp;quot;data&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;    table = data,
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;Plant&amp;quot;, &amp;quot;Date&amp;quot;, &amp;quot;MWh&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; æœ¬åœ°æ’åºä¸çª—å£è®¡ç®—
&lt;&#x2F;span&gt;&lt;span&gt;let sort_op = sort(
&lt;&#x2F;span&gt;&lt;span&gt;    input = data_scan,
&lt;&#x2F;span&gt;&lt;span&gt;    columns = [
&lt;&#x2F;span&gt;&lt;span&gt;    	{column = &amp;quot;Plant&amp;quot;, direction = &amp;quot;ASC&amp;quot;},
&lt;&#x2F;span&gt;&lt;span&gt;    	{column = &amp;quot;Date&amp;quot;, direction = &amp;quot;ASC&amp;quot;}
&lt;&#x2F;span&gt;&lt;span&gt;    ],
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;Plant&amp;quot;, &amp;quot;Date&amp;quot;, &amp;quot;MWh&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let window_agg = window_aggregator(
&lt;&#x2F;span&gt;&lt;span&gt;    input = sort_op,
&lt;&#x2F;span&gt;&lt;span&gt;    partition_by = [&amp;quot;Plant&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;    order_by = [{column = &amp;quot;Date&amp;quot;, direction = &amp;quot;ASC&amp;quot;}],
&lt;&#x2F;span&gt;&lt;span&gt;    frame = {
&lt;&#x2F;span&gt;&lt;span&gt;        type = &amp;quot;RANGE&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        start = {value = 3, unit = &amp;quot;DAY&amp;quot;, preceding = true},
&lt;&#x2F;span&gt;&lt;span&gt;        end = {value = 3, unit = &amp;quot;DAY&amp;quot;, preceding = false}
&lt;&#x2F;span&gt;&lt;span&gt;    },
&lt;&#x2F;span&gt;&lt;span&gt;    aggregators = [
&lt;&#x2F;span&gt;&lt;span&gt;        avg_aggregator(
&lt;&#x2F;span&gt;&lt;span&gt;            name = &amp;quot;MWh 7-day Moving Average&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;            field = &amp;quot;MWh&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;        )
&lt;&#x2F;span&gt;&lt;span&gt;    ],
&lt;&#x2F;span&gt;&lt;span&gt;    output = [&amp;quot;Plant&amp;quot;, &amp;quot;Date&amp;quot;, &amp;quot;MWh 7-day Moving Average&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let sink = identity_sink(input = global_sort);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let pipeline1 = pipeline(
&lt;&#x2F;span&gt;&lt;span&gt;    source = data_scan,
&lt;&#x2F;span&gt;&lt;span&gt;    sink = sort_op
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let pipeline2 = pipeline(
&lt;&#x2F;span&gt;&lt;span&gt;	input = sort_op,
&lt;&#x2F;span&gt;&lt;span&gt;	sink = window_agg,
&lt;&#x2F;span&gt;&lt;span&gt;	parent = pipeline1
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;let graph = topology(main = main_pipeline);
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å¯¹åº”çš„æ‹“æ‰‘å›¾ä¸º:
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
graph TD
    subgraph Pipeline1[&amp;quot;æ•°æ®é¢„å¤„ç†æµæ°´çº¿&amp;quot;]
        ds1[&amp;quot;data_scan: scan&amp;quot;] --&amp;gt;|&amp;quot;è¯»å–åŸå§‹æ•°æ®&amp;quot;| so1[&amp;quot;sort_op: sort&amp;quot;]
        style so1 stroke:#333
    end

    subgraph Pipeline2[&amp;quot;çª—å£è®¡ç®—æµæ°´çº¿&amp;quot;]
        so1 --&amp;gt;|&amp;quot;æ’åºåæ•°æ®&amp;quot;| wa1[&amp;quot;window_agg: window_aggregator&amp;quot;]
    end

    Pipeline1 --&amp;gt;|&amp;quot;çˆ¶ä¾èµ–&amp;quot;| Pipeline2
    style Pipeline1 stroke:#F00
    style Pipeline2 stroke:#F00
```
&lt;&#x2F;div&gt;&lt;&#x2F;p&gt;
&lt;p&gt;TODO: qir ä¸ºçª—å£å‡½æ•°æä¾›äº†ä¸åŒçš„è®¡ç®—æ¨¡å¼ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;as an operator: æ”¯æŒæµå¼çš„å¤„ç†ï¼Œå¯ä»¥æ»¡è¶³å¯¹å¤§æ•°æ®é›†è¿›è¡Œçª—å£è®¡ç®—ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;as an sink: ä¸æ”¯æŒæµå¼è®¡ç®—ï¼Œéœ€è¦å°†æ•´ä¸ªæ•°æ®é›†æ”¾å…¥å†…å­˜è¿›è¡Œçª—å£è®¡ç®—ã€‚
è¿™ä¸€å—ç¨åè¡¥å……ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;he-xin-gai-nian&quot;&gt;æ ¸å¿ƒæ¦‚å¿µ&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;topology&quot;&gt;topology&lt;&#x2F;h2&gt;
&lt;p&gt;topology æ˜¯ä¸€ä¸ªå®Œæ•´çš„æŸ¥è¯¢è®¡åˆ’ï¼Œç”±ä¸€ä¸ªæˆ–å¤šä¸ª pipeline ç»„æˆã€‚pipeline ä¹‹é—´å¯ä»¥æœ‰ä¾èµ–å…³ç³»,å½¢æˆä¸€ä¸ªæœ‰å‘æ— ç¯å›¾(DAG)ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;pipeline&quot;&gt;pipeline&lt;&#x2F;h2&gt;
&lt;p&gt;pipeline æ˜¯ä¸€ä¸ªæ•°æ®å¤„ç†æµæ°´çº¿ï¼Œç”± sourceã€operators å’Œ sink ç»„æˆ:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;source: æ•°æ®æºç®—å­ï¼Œè´Ÿè´£ä»å­˜å‚¨ç³»ç»Ÿï¼ˆæˆ–è€…æ¥æ”¶å¤–éƒ¨çš„è¯·æ±‚ï¼‰è¯»å–æ•°æ®&lt;&#x2F;li&gt;
&lt;li&gt;operators: å¤„ç†ç®—å­åºåˆ—ï¼Œå¯¹æ•°æ®è¿›è¡Œè½¬æ¢ã€è¿‡æ»¤ã€èšåˆç­‰æ“ä½œ&lt;&#x2F;li&gt;
&lt;li&gt;sink: æ±‡èšç®—å­ï¼Œè´Ÿè´£å°†å¤„ç†ç»“æœå†™å…¥å­˜å‚¨ç³»ç»Ÿæˆ–ä¼ é€’ç»™ä¸‹ä¸€ä¸ª pipeline&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;pipeline æ”¯æŒ partitionï¼Œæ¯ä¸ªpartition ä¸­çš„ç®—å­çš„æ•°æ®æµåŠ¨æ˜¯åœ¨å•ä¸ªçº¿ç¨‹ä¸­ï¼Œä»¥å°æ‰¹é‡çš„æ–¹å¼è¿›è¡ŒæµåŠ¨ï¼Œè¿™ç§æ–¹å¼å¯ä»¥å……åˆ†å‘æŒ¥ CPU çš„
å‘é‡åŒ–è®¡ç®—å’Œ Cache å¸¦æ¥çš„æ€§èƒ½æå‡ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;pipeline æ”¯æŒåˆ†åŒºæ—¶ï¼Œsink èŠ‚ç‚¹å¯ä»¥æ˜¯åˆ†åŒºçš„ï¼Œæˆ–è€…æ˜¯æ±‡èšçš„ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;pipeline ä¹‹é—´å¯ä»¥æœ‰ä¾èµ–å…³ç³»:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
&lt;code&gt;pipeline_a&lt;&#x2F;code&gt; å¯ä»¥ä¾èµ–äº &lt;code&gt;pipeline_b&lt;&#x2F;code&gt;: b æ‰§è¡Œå®Œæˆåï¼Œa æ‰èƒ½å¼€å§‹æ‰§è¡Œ&lt;&#x2F;li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
&lt;code&gt;pipeline_a[partition_1]&lt;&#x2F;code&gt; å¯ä»¥ä¾èµ–äº &lt;code&gt;pipeline_b[partition_1]&lt;&#x2F;code&gt;: b çš„ partition_1 æ‰§è¡Œå®Œæˆåï¼Œa çš„ partition_1 æ‰èƒ½å¼€å§‹æ‰§è¡Œ&lt;&#x2F;li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
operator ä¹‹é—´æ”¯æŒ notify æœºåˆ¶ï¼Œä¸‹æ¸¸ operator å¯ä»¥å‘ä¸Šæ¸¸ operator å‘é€é€šçŸ¥ï¼Œä¾‹å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;Limit æ“ä½œï¼Œå½“è¾¾åˆ°æŒ‡å®šçš„è¡Œæ•°æ—¶ï¼Œé€šçŸ¥ä¸Šæ¸¸åœæ­¢å‘é€æ•°æ®&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;operator&quot;&gt;operator&lt;&#x2F;h2&gt;
&lt;p&gt;operator æ˜¯æ•°æ®å¤„ç†ç®—å­ï¼Œæ¯ä¸ªç®—å­éƒ½æœ‰æ˜ç¡®å®šä¹‰çš„è¾“å…¥å’Œè¾“å‡ºç±»å‹ã€‚å¸¸è§çš„ç®—å­åŒ…æ‹¬:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;filter: è¿‡æ»¤ç®—å­&lt;&#x2F;li&gt;
&lt;li&gt;join: å…³è”ç®—å­&lt;&#x2F;li&gt;
&lt;li&gt;aggregation: èšåˆç®—å­&lt;&#x2F;li&gt;
&lt;li&gt;sort: æ’åºç®—å­&lt;&#x2F;li&gt;
&lt;li&gt;window: çª—å£ç®—å­&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;source&quot;&gt;source&lt;&#x2F;h2&gt;
&lt;p&gt;source æ˜¯æ•°æ®æºç®—å­ï¼Œè´Ÿè´£ä»å­˜å‚¨ç³»ç»Ÿè¯»å–æ•°æ®ã€‚å¸¸è§çš„ source åŒ…æ‹¬:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;scan: è¡¨æ‰«æç®—å­&lt;&#x2F;li&gt;
&lt;li&gt;exchange_receiver: æ•°æ®äº¤æ¢æ¥æ”¶ç®—å­&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;sink&quot;&gt;sink&lt;&#x2F;h2&gt;
&lt;p&gt;sink æ˜¯æ±‡èšç®—å­ï¼Œè´Ÿè´£å°†å¤„ç†ç»“æœå†™å…¥å­˜å‚¨ç³»ç»Ÿæˆ–ä¼ é€’ç»™ä¸‹ä¸€ä¸ª pipelineã€‚å¸¸è§çš„ sink åŒ…æ‹¬:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;identity_sink: æ’ç­‰æ±‡èšç®—å­&lt;&#x2F;li&gt;
&lt;li&gt;exchange_sender: æ•°æ®äº¤æ¢å‘é€ç®—å­&lt;&#x2F;li&gt;
&lt;li&gt;build_hash_table: å“ˆå¸Œè¡¨æ„å»ºç®—å­&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;type-system&quot;&gt;type system&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;data type&lt;&#x2F;li&gt;
&lt;li&gt;column metadata: nullable, sort, index(minmax, bloom)&lt;&#x2F;li&gt;
&lt;li&gt;table metadata: partition, bucket&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹æ€§èƒ½çš„ä¼˜åŒ–
&lt;ul&gt;
&lt;li&gt;è¡¨è¾¾å¼æ±‚å€¼ï¼Œå‡å°‘è¿è¡ŒæœŸçš„è§£é‡Šå¼€é”€&lt;&#x2F;li&gt;
&lt;li&gt;nullable: é¿å… null æ£€æŸ¥&lt;&#x2F;li&gt;
&lt;li&gt;æ’åºï¼š å¦‚æœæ•°æ®å·²ç»æ’åºï¼Œåˆ™å¯ä»¥é€‰æ‹© Merge Sort ç­‰ç®—æ³•&lt;&#x2F;li&gt;
&lt;li&gt;partition: é¿å…å…¨è¡¨æ‰«æ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;partition&quot;&gt;partition&lt;&#x2F;h2&gt;
&lt;p&gt;partition æ˜¯æ•°æ®åˆ†åŒºæ¦‚å¿µï¼Œç”¨äºå¹¶è¡Œå’Œåˆ†å¸ƒå¼è®¡ç®—:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®å¯ä»¥æŒ‰ç…§æŒ‡å®šçš„å­—æ®µè¿›è¡Œåˆ†åŒº&lt;&#x2F;li&gt;
&lt;li&gt;ä¸åŒåˆ†åŒºå¯ä»¥å¹¶è¡Œå¤„ç†&lt;&#x2F;li&gt;
&lt;li&gt;åˆ†åŒºä¹‹é—´å¯ä»¥é€šè¿‡ exchange ç®—å­è¿›è¡Œæ•°æ®äº¤æ¢&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;suan-zi-shuo-ming&quot;&gt;ç®—å­è¯´æ˜&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;scan è¡¨æ‰«æç®—å­ï¼Œç”¨äºä»è¡¨ä¸­è¯»å–æ•°æ®&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;name: è¡¨å&lt;&#x2F;li&gt;
&lt;li&gt;table: è¡¨ç±»å‹å®šä¹‰ï¼Œoptionalï¼Œ ç”¨äºç±»å‹æ£€æŸ¥&lt;&#x2F;li&gt;
&lt;li&gt;output: éœ€è¦è¾“å‡ºçš„å­—æ®µåˆ—è¡¨&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;filter å¯¹è¾“å…¥ DataFrame è¿›è¡Œè¿‡æ»¤æ“ä½œ&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;input: è¾“å…¥ DataFrame&lt;&#x2F;li&gt;
&lt;li&gt;predictor: è¿‡æ»¤å‡½æ•°ï¼Œè¿”å› true è¡¨ç¤ºä¿ç•™ï¼Œè¿”å› false è¡¨ç¤ºä¸¢å¼ƒ&lt;&#x2F;li&gt;
&lt;li&gt;output: è¾“å‡ºå­—æ®µåˆ—è¡¨&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;build_hash_table æ„å»ºå“ˆå¸Œè¡¨ï¼Œç”¨äºå…³è”æ“ä½œ&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;input: è¾“å…¥ DataFrame&lt;&#x2F;li&gt;
&lt;li&gt;key: å“ˆå¸Œè¡¨çš„ key åˆ—&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;lookup_hash_table ä»å“ˆå¸Œè¡¨ä¸­æŸ¥æ‰¾æ•°æ®ï¼Œç”¨äºå…³è”æ“ä½œ&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ht: å“ˆå¸Œè¡¨ï¼Œç”± build_hash_table æ„å»º&lt;&#x2F;li&gt;
&lt;li&gt;input: è¾“å…¥ DataFrame&lt;&#x2F;li&gt;
&lt;li&gt;key: å…³è”å­—æ®µ&lt;&#x2F;li&gt;
&lt;li&gt;output: è¾“å‡ºå­—æ®µåˆ—è¡¨ï¼Œæ ¼å¼ä¸º [[lookup_side_fields]ï¼Œ [build_side_fields]]&lt;&#x2F;li&gt;
&lt;li&gt;join_type: è¿æ¥ç±»å‹ï¼Œinner&#x2F;left&#x2F;right&#x2F;semi&#x2F;anti-semi&#x2F;crossjoin ç­‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;hash_aggregator å“ˆå¸Œèšåˆç®—å­&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;input: è¾“å…¥ DataFrame&lt;&#x2F;li&gt;
&lt;li&gt;group_by: åˆ†ç»„å­—æ®µåˆ—è¡¨&lt;&#x2F;li&gt;
&lt;li&gt;aggregators: èšåˆå‡½æ•°åˆ—è¡¨&lt;&#x2F;li&gt;
&lt;li&gt;output: è¾“å‡ºå­—æ®µåˆ—è¡¨&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;count_aggregator è®¡æ•°èšåˆå‡½æ•°&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;name: èšåˆç»“æœå­—æ®µå&lt;&#x2F;li&gt;
&lt;li&gt;field: è¦è®¡æ•°çš„å­—æ®µå&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;sum_aggregator æ±‚å’Œèšåˆå‡½æ•°&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;name: èšåˆç»“æœå­—æ®µå&lt;&#x2F;li&gt;
&lt;li&gt;field: è¦æ±‚å’Œçš„å­—æ®µå&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;identity_sink æ’ç­‰æ±‡èšç®—å­&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;input: è¾“å…¥ DataFrame&lt;&#x2F;li&gt;
&lt;li&gt;è¯´æ˜: è¾“å‡ºç±»å‹ä¸è¾“å…¥ç±»å‹ç›¸åŒï¼Œç”¨äºæ•°æ®æ”¶é›†&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;exchange_sender å‘é€ç«¯ç®—å­ï¼Œç”¨äºåˆ†å¸ƒå¼è®¡ç®—&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;input: è¾“å…¥ DataFrame&lt;&#x2F;li&gt;
&lt;li&gt;partition_by: åˆ†åŒºå­—æ®µåˆ—è¡¨&lt;&#x2F;li&gt;
&lt;li&gt;shuffle_mode: &quot;HASH&quot; for hash shuffleï¼Œ &quot;GLOBAL&quot; for collect all data to one partition&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;exchange_receiver æ¥æ”¶ç«¯ç®—å­ï¼Œç”¨äºåˆ†å¸ƒå¼è®¡ç®—&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;input: è¾“å…¥ DataFrameï¼Œ å¯¹åº”äº exchange_sender ç®—å­&lt;&#x2F;li&gt;
&lt;li&gt;partition_by: åˆ†åŒºå­—æ®µåˆ—è¡¨ï¼Œéœ€è¦ä¸ exchange_sender ç®—å­çš„ partition_by ä¸€è‡´&lt;&#x2F;li&gt;
&lt;li&gt;shuffle_mode: &quot;HASH&quot; for hash shuffleï¼Œ &quot;GLOBAL&quot; for collect all data to one partitionï¼Œéœ€è¦ä¸ exchange_sender ç®—å­çš„ shuffle_mode ä¸€è‡´&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;window_aggr å¸¦è¡¥å……&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;pipeline æµæ°´çº¿å®šä¹‰&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;source: æºç®—å­&lt;&#x2F;li&gt;
&lt;li&gt;operators: ç®—å­åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;sink: æ±‡èšç®—å­&lt;&#x2F;li&gt;
&lt;li&gt;parent: ä¾èµ–çš„çˆ¶æµæ°´çº¿åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;topology æŸ¥è¯¢æ‹“æ‰‘ç»“æ„&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;main: ä¸»æµæ°´çº¿&lt;&#x2F;li&gt;
&lt;li&gt;è¯´æ˜: ç”¨äºæè¿°æ•´ä¸ªæŸ¥è¯¢çš„æ‹“æ‰‘ç»“æ„ï¼Œæ˜¯å•ä¸ª qir æ–‡ä»¶çš„æœ€ç»ˆè¾“å‡º&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å½“è¿›è¡Œå¤§æ•°æ®é‡çš„è¡¨ä¹‹é—´ join æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨ shuffle join ç®—æ³•ï¼Œå³å°†æ•°æ®æŒ‰ç…§ join key è¿›è¡Œå“ˆå¸Œåˆ†åŒºï¼Œç„¶åå°†ç›¸åŒ key çš„æ•°æ®å‘é€åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œ join æ“ä½œã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;todo&quot;&gt;TODO&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;æ”¯æŒ &lt;code&gt;SELECT sum(amount), sum(amount) FILTER (region != &#x27;north&#x27;) FROM sales;&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;æ”¯æŒ &lt;code&gt;SELECT first(amount ORDER BY date ASC) FROM sales;&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;æä¾›æ›´å¤šåŸºç¡€æ—¶é—´çª—å£èƒ½åŠ›ï¼ˆdate basedï¼‰,å¢å¼ºå¯¹æ—¶é—´å¿«é€Ÿè®¡ç®—çš„æ”¯æŒã€‚
&lt;ul&gt;
&lt;li&gt;å¹´&#x2F;å¹´å­£&#x2F;å¹´æœˆ&#x2F;å¹´å‘¨&#x2F;å¹´æœˆæ—¥ å¤šç§å±‚æ¬¡ç»“æ„  &lt;code&gt;date_trunc&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;å‰æœŸã€åŒæœŸ&lt;&#x2F;li&gt;
&lt;li&gt;ï¼ˆå¹´&#x2F;æœˆ&#x2F;å‘¨ï¼‰ç´¯è®¡ã€å‰æœŸç´¯è®¡ã€åŒæœŸç´¯è®¡&lt;&#x2F;li&gt;
&lt;li&gt;æ»‘åŠ¨ã€æ»šåŠ¨çª—å£&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;æä¾›æ›´å¤šæ—¶åºçª—å£èƒ½åŠ›ï¼ˆtime basedï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;æ”¯æŒæ›´çµæ´»çš„çª—å£å‡½æ•°èƒ½åŠ›ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;SUM(X) OVER (PARTITION BY expr ORDER BY expr RANGE BETWEEN expr AND expr)&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;SUM(X) OVER (PARTITION BY expr ORDER BY expr WHERE expr)&lt;&#x2F;code&gt;
å¯¹å­—ç¬¦ä¸²ç­‰ç±»å‹è€Œè¨€ï¼Œrange bettween expr precedding æ²¡æ³•ä½¿ç”¨ï¼Œå¯¹æ—¥æœŸã€æ—¶é—´ç­‰ä¹Ÿæ›´ç®€æ´ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;æ‰©å±•æ”¯æŒå¦‚ä¸‹çš„ SQL è¯­æ³•ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥å¤„ç†ç±»ä¼¼äº MDX çš„è¡ç”Ÿåº¦é‡ï¼ˆä¿®æ”¹å½“å‰ Context çš„ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬å¢åŠ æ–°çš„ç»´åº¦æ¡ä»¶ï¼Œæˆ–è€…å‡å°‘ç°æœ‰çš„ç»´åº¦é™åˆ¶ï¼Œä½†ä¿æŒå½“å‰çš„æŸ¥è¯¢è¡Œä¸å˜ï¼‰ã€‚&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT&lt;&#x2F;span&gt;&lt;span&gt; a, b, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;SUM&lt;&#x2F;span&gt;&lt;span&gt;(X),
&lt;&#x2F;span&gt;&lt;span&gt;           &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;SUM&lt;&#x2F;span&gt;&lt;span&gt;(X) FILTER (c &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;),  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- SUM(X, a, b, c &amp;gt; 10) 
&lt;&#x2F;span&gt;&lt;span&gt;           &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;SUM&lt;&#x2F;span&gt;&lt;span&gt;(X) BY a FILTER(b = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2 &lt;&#x2F;span&gt;&lt;span&gt;and c &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- SUM(X, a, b = 2, c &amp;gt; 10)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
æä¾›è¿™ç§æ‰©å±•èƒ½åŠ›ï¼Œä¸ä»…æå‡äº† SQL çš„è¡¨è¾¾èƒ½åŠ›ï¼Œè€Œä¸”è¿™ä¸ªå¯ä»¥ç”Ÿæˆä¸€ä¸ªé«˜æ•ˆçš„æ‰§è¡Œ planï¼Œæ‰§è¡Œæ•ˆç‡ä¹Ÿèƒ½å¾—åˆ°æ˜¾è‘—æå‡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ”¯æŒï¼šè¿™ä¸ªç‰¹æ€§å¯ä»¥æ˜¾è‘—ç®€åŒ– åˆ†ç»„å°è®¡çš„ SQL æŸ¥è¯¢ã€‚
&lt;ul&gt;
&lt;li&gt;duckdb:&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- the syntax () denotes the empty set (i.e., computing an ungrouped aggregate)
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- è¿™ä¸ªåŠŸèƒ½éå¸¸é€‚åˆäºè¿›è¡Œåˆ†ç»„å°è®¡çš„è®¡ç®—ã€‚
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT&lt;&#x2F;span&gt;&lt;span&gt; city, street_name, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;avg&lt;&#x2F;span&gt;&lt;span&gt;(income)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; addresses
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;GROUP BY&lt;&#x2F;span&gt;&lt;span&gt; GROUPING SETS ((city, street_name), (city), (street_name), ());
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT&lt;&#x2F;span&gt;&lt;span&gt; city, street_name, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;avg&lt;&#x2F;span&gt;&lt;span&gt;(income)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; addresses
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;GROUP BY&lt;&#x2F;span&gt;&lt;span&gt; CUBE (city, street_name); &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- ç­‰æ•ˆäº group by grouping sets( (city, street_name), (city), (street_name), ());
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT&lt;&#x2F;span&gt;&lt;span&gt; city, street_name, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;avg&lt;&#x2F;span&gt;&lt;span&gt;(income)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; addresses
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;GROUP BY&lt;&#x2F;span&gt;&lt;span&gt; ROLLUP (city, street_name) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- ç­‰æ•ˆäº group by grouping sets( (city, street_name), (city), () );
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- grouping_id
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>April 2025</title>
        <published>2025-04-02T00:00:00+00:00</published>
        <updated>2025-04-02T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2025-04/"/>
        <id>https://wangzaixiang.github.io/monthly/2025-04/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2025-04/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;Rust
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;tweedegolf.nl&#x2F;en&#x2F;blog&#x2F;152&#x2F;does-using-rust-really-make-your-software-safer&quot;&gt;does using rust really make safer?&lt;&#x2F;a&gt;
ä¸€ä¸ªå¾ˆæœ‰è¶£çš„å®éªŒï¼Œå¯¹ä¸€ä¸ª DNS è§£æçš„å®‰å…¨æ¼æ´ï¼Œé€‰æ‹©4ä¸ªäººä½¿ç”¨Rustè¿›è¡Œé‡å†™ï¼ˆåŒ…æ‹¬å®ä¹ ç”Ÿä¸æœ‰ç»éªŒçš„åŒå­¦ï¼‰ï¼Œæ•´ä½“çš„å®‰å…¨æ€§èƒ½å¤§å¹…åº¦æ”¹è¿›ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;bumpalo&#x2F;latest&#x2F;bumpalo&#x2F;&quot;&gt;bumpalo:A fast bump allocation arena for Rust.&lt;&#x2F;a&gt;
ç±»ä¼¼äº zig çš„ ArenaAllocatorã€‚å¯¹äº Request&#x2F;Response æ¨¡å¼çš„åº”ç”¨åœºæ™¯ï¼Œæœ‰ç€æœ€å¥½çš„å†…å­˜åˆ†é…æ€§èƒ½ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Scala
&lt;ul&gt;
&lt;li&gt;Scala.js 1.19.0 å¯¹ WASM æ”¯æŒå¢å¼ºã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;JavaScript
&lt;ul&gt;
&lt;li&gt;https:&#x2F;&#x2F;evanw.github.io&#x2F;source-map-visualization&#x2F; è¿™ä¸ªå·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¾ˆå¥½çš„ç†è§£ SourceMap&lt;&#x2F;li&gt;
&lt;li&gt;åŸºäº SourceMap å¯ä»¥å¾ˆå¥½çš„è¿›è¡Œ package åçš„ä»£ç å¤§å°è¿›è¡Œåˆ†æã€‚source-map-explorer è¿™ä¸ªå·¥å…·å¥½åƒå·²ç»è¿‡æ—¶äº†ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;MPP &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;Datafusion
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.google.com&#x2F;presentation&#x2F;d&#x2F;1D3GDVas-8y0sA4c8EOgdCvEjVND4s2E7I6zfs67Y4j8&#x2F;edit#slide=id.p&quot;&gt;Part 1: Query Engine Architecture&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.google.com&#x2F;presentation&#x2F;d&#x2F;1ypylM3-w60kVDW7Q6S99AHzvlBgciTdjsAfqNP85K30&quot;&gt;Part 2: Logical Plan and  Expressions&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.google.com&#x2F;presentation&#x2F;d&#x2F;1cA2WQJ2qg6tx6y4Wf8FH2WVSm9JQ5UgmBWATHdik0hg&quot;&gt;Part 3: Physical Plan and Execution&lt;&#x2F;a&gt;
æ€è€ƒï¼š&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹æ¯” Datafusion ä¸ DuckDB&#x2F;Polars çš„æ‰§è¡Œè®¡åˆ’
&lt;ol&gt;
&lt;li&gt;ä» Part 3, page 11 æ¥çœ‹ï¼Œdatafusion åœ¨ operator é—´åŸºäº async&#x2F;await å¼‚æ­¥æ‰§è¡Œã€‚è€Œ duckdb åœ¨ pipeline ä¹‹å†…çš„ operator æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚
è¿™ä¸ªå¯èƒ½æ˜¯ duckdb çš„æ€§èƒ½ä¼˜åŠ¿ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;å¼•å…¥ä¸€ä¸ªæ–°çš„ IR æ€è€ƒï¼š&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;qir-design&#x2F;&quot;&gt;another query plan IR- draft&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;1894867212713579084&quot;&gt;DSM vs. NSM ä¸ºä»€ä¹ˆåˆ—å­˜æ•°æ®åº“DuckDBçš„ç®—å­ä¼šç”¨åˆ°è¡Œå­˜&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;duckdb.org&#x2F;2024&#x2F;03&#x2F;29&#x2F;external-aggregation.html&quot;&gt;duckdb hash aggræ€§èƒ½åˆ†æ&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.tecton.ai&#x2F;blog&#x2F;introducing-rift-tectons-compute-engine&#x2F;&quot;&gt;Introducing Rift: Tectonâ€™s Compute Engine&lt;&#x2F;a&gt;
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;monthly&#x2F;2025-04&#x2F;img.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;
&lt;ul&gt;
&lt;li&gt;Big data is dead because of Big Machine. 34T memory * 480 cores&lt;&#x2F;li&gt;
&lt;li&gt;Single node queries are cool again.&lt;&#x2F;li&gt;
&lt;li&gt;Storage and Compute separation.&lt;&#x2F;li&gt;
&lt;li&gt;Familiar, Python-native(notebook), local first developer experience.&lt;&#x2F;li&gt;
&lt;li&gt;Scalable, efficient, and portable across all workloads.&lt;&#x2F;li&gt;
&lt;li&gt;Faster time to market with lower operational cost.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;web-frontend&quot;&gt;Web &amp;amp; Frontend&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;tools-libraries&quot;&gt;Tools &amp;amp; Libraries&lt;&#x2F;h1&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Understand Svelte Rune</title>
        <published>2025-03-26T00:00:00+00:00</published>
        <updated>2025-03-26T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/understand-svelte-rune/"/>
        <id>https://wangzaixiang.github.io/blog/understand-svelte-rune/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/understand-svelte-rune/">&lt;h1 id=&quot;what-is-rune&quot;&gt;What is Rune?&lt;&#x2F;h1&gt;
&lt;p&gt;Svelte 5 æ˜¯ Svelte çš„ä¸€æ¬¡å¤§ç‰ˆæœ¬æ›´æ–°ï¼Œå…¶æ ¸å¿ƒç‰¹æ€§æ˜¯å¼•å…¥äº† runes è¿™ä¸ªæ¦‚å¿µï¼Œåœ¨&lt;a href=&quot;https:&#x2F;&#x2F;svelte.dev&#x2F;blog&#x2F;runes&quot;&gt;è¿™ç¯‡å®˜æ–¹ blog&lt;&#x2F;a&gt; ä¸­ï¼Œä½œè€…å¯¹ runes è¿›è¡Œäº†è§£é‡Šï¼š&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;rune:
A letter or mark used as a mystical or magic symbol. (ä¸€ç§é€šè¿‡å­—ç¬¦æˆ–è€…æ ‡è®°æ¥è¡¨è¾¾æŸç§ç‰¹æ®Šå«ä¹‰çš„ç¬¦å·)&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;åœ¨æŸäº›ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œä¹Ÿæœ‰ç›¸ä¼¼çš„æ¦‚å¿µï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;vimscript ä¸­çš„å˜é‡å‰ç¼€&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;text&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-text &quot;&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;let g:ack_options = &amp;#39;-s -H&amp;#39;    &amp;quot; g: global
&lt;&#x2F;span&gt;&lt;span&gt;let s:ack_program = &amp;#39;ack&amp;#39;      &amp;quot; s: local (to script)
&lt;&#x2F;span&gt;&lt;span&gt;let l:foo = &amp;#39;bar&amp;#39;              &amp;quot; l: local (to function)
&lt;&#x2F;span&gt;&lt;span&gt;let w:foo = &amp;#39;bar&amp;#39;    &amp;quot; w: window
&lt;&#x2F;span&gt;&lt;span&gt;let b:state = &amp;#39;on&amp;#39;   &amp;quot; b: buffer
&lt;&#x2F;span&gt;&lt;span&gt;let t:state = &amp;#39;off&amp;#39;  &amp;quot; t: tab
&lt;&#x2F;span&gt;&lt;span&gt;echo v:var           &amp;quot; v: vim special
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Ruby ä¸­çš„å˜é‡å‰ç¼€&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;ruby&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-ruby &quot;&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;global_variable &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span&gt;@&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;instance_variable &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span&gt;@@&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;class_variable &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span&gt;CONSTANT = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span&gt;local_variable = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;go è¯­è¨€ä¸­é€šè¿‡å¤§å°å†™æ¥åŒºåˆ†å˜é‡çš„å¯è§æ€§&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;go&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-go &quot;&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;package &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;main
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;fmt&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;GlobalVariable &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;globalVariable &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;func &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;fmt&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Println&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;GlobalVariable&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 0
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;fmt&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Println&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;globalVariable&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 0
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;é€šè¿‡ä½¿ç”¨æŸäº›å‰ç¼€æ€§æ ‡è¯†å­—ç¬¦ï¼Œæ¥è¡¨è¾¾æŸç§ç‰¹æ®Šçš„å«ä¹‰ï¼Œå’Œ ROR(Rails on Ruby) ä¸­çš„çº¦å®šä¼˜äºé…ç½®(Convention Over Configuration)çš„æ€æƒ³ç±»ä¼¼ï¼Œ
è¿™ç§æ–¹å¼å¯ä»¥è®©ä»£ç æ›´åŠ æ˜“è¯»ï¼Œæ›´åŠ æ˜“äºç»´æŠ¤ã€‚ä½†ä¸€èˆ¬è¾ƒå°‘åº”ç”¨ä¸åº•å±‚ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå› ä¸ºä¸€èˆ¬æ¥è¯´ï¼Œçº¦å®šæ˜¯ä¸Šå±‚çš„ï¼Œåœ¨ä¸åŒçš„ç¯å¢ƒä¸­ï¼Œå¯èƒ½ä¼šæœ‰ä¸åŒçš„çº¦å®šã€‚è€Œåº•å±‚
è¯­è¨€ä¸€èˆ¬ä¸ä¸ç‰¹å®šçš„ç¯å¢ƒç»‘å®šï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šæœ‰è¿™ç§çº¦å®šã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;svelte-rune&quot;&gt;Svelte Rune&lt;&#x2F;h1&gt;
&lt;p&gt;é€šè¿‡ä¸€ä¸ªç®€å•çš„ä»£ç ç¤ºä¾‹ï¼Œå¯¹æ¯”ä¸€ä¸‹ Svelte 4 ä¸ Svelte 5 çš„åŒºåˆ«ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;html&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-html &quot;&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span&gt;&#x2F;&#x2F; Svelte 4
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;script &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;lang&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;ts&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;increment&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count &lt;&#x2F;span&gt;&lt;span&gt;+= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;script&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;button &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;on:click&lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;{increment}&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        clicks: {count}
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;button&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&#x2F; Svelte 5
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;script &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;lang&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;ts&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$state&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; vs: let count = 0;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;increment&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count &lt;&#x2F;span&gt;&lt;span&gt;+= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;script&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;button &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;on:click&lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;{increment}&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        clicks: {count}
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;button&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ç²—ç•¥çš„çœ‹ï¼ŒSvelte 5 çš„ä»£ç æ¯” Svelte 4 å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯åœ¨ count çš„å®šä¹‰ä¸Šï¼Œå¤šäº†ä¸€ä¸ª &lt;code&gt;$state&lt;&#x2F;code&gt; çš„è°ƒç”¨ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Svelte 4 ä¸­ï¼Œè¿™æ®µä»£ç æ˜¯ä¸€æ®µå®Œå…¨æ ‡å‡†çš„ JavaScript ä»£ç ï¼Œæ²¡æœ‰ä»»ä½•ç‰¹æ®Šçš„åœ°æ–¹ã€‚ä½† Svelte æ¡†æ¶ä¼šè¿™æ®µä»£ç è¿›è¡Œ Reactive å˜æ¢å¤„ç†ã€‚è¿™ä¸ªè¿‡ç¨‹
æ˜¯å®Œå…¨éšå¼çš„ã€‚
&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹çš„æ˜¯ï¼Œå¯¹ç”¨æˆ·å®Œå…¨é€æ˜ï¼Œç°æœ‰çš„ä»£ç æ— éœ€ä»»ä½•ä¿®æ”¹ï¼Œå°±å¯ä»¥ä½¿ç”¨ Svelte çš„ Reactive ç‰¹æ€§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç¼ºç‚¹ä¹Ÿæ˜¯ï¼šç”¨æˆ·éš¾ä»¥äº†è§£è¿™æ®µä»£ç çš„å®é™…è¿è¡Œè¯­ä¹‰ï¼Œæ˜¯ reactive çš„è¿˜æ˜¯æ™®é€šçš„ JavaScript ä»£ç ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœè¿™æ®µä»£ç ä¸æ˜¯æ”¾åœ¨ .svelte æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯æ”¾åœ¨ä¸€ä¸ªæ™®é€šçš„ .js æ–‡ä»¶ä¸­ï¼Œè¿™ç§ä¸æ˜ç¡®çš„è¯­ä¹‰å°±ä¼šæ›´åŠ æ˜æ˜¾ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Svelte 5 ä¸­ï¼Œé€šè¿‡ &lt;code&gt;$state&lt;&#x2F;code&gt; è°ƒç”¨(ä¸‹é¢ä¼šä»‹ç»åˆ°ï¼Œè¿™å…¶å®ä¸æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨)ï¼Œæ˜ç¡®çš„è¡¨æ˜äº†è¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ª Reactive å˜é‡ã€‚è¿™æ ·ï¼Œç”¨æˆ·å°±å¯ä»¥æ¸…æ¥šçš„çŸ¥é“è¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ª Reactive å˜é‡ã€‚
&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹æ˜¯ï¼šç”¨æˆ·å¯ä»¥æ¸…æ¥šçš„çŸ¥é“è¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ª Reactive å˜é‡ã€‚å¯¹è¿™ä¸ªå˜é‡çš„è¯»å†™ï¼Œä¼šæŒ‰ç…§ reactive æœºåˆ¶æ¥è¿›è¡Œã€‚ï¼ˆä¸‹é¢ä¼šä»‹ç»è¿™ä¸ªreactive æœºåˆ¶ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;ç¼ºç‚¹æ˜¯ï¼šä»é reactive çš„ä»£ç è½¬æ¢åˆ° reactive çš„ä»£ç ï¼Œéœ€è¦è¿›è¡Œä¿®æ”¹ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å¯ä»¥è¿™ä¹ˆç†è§£ï¼šSvelte 5 å’Œ Svelte 4 å…·æœ‰å‡ ä¹ç›¸åŒçš„è¿è¡Œæ—¶è¯­ä¹‰ï¼Œè€Œå·®å¼‚ä»…ä»…æ˜¯åœ¨æºä»£ç ä¸­çš„è¡¨è¿°æ–¹å¼ä¸åŒï¼šSvelte 4 é€šè¿‡å®Œå…¨éšå¼çš„æ–¹å¼ï¼ˆæŒ‰ç…§çº¦å®šï¼‰ï¼Œ
è€Œ Svelte 5 é€šè¿‡æ˜¾å¼çš„æ–¹å¼,ä½¿ç”¨ runes æ¥æ˜¾ç¤ºæ ‡è®°éœ€è¦è¿›è¡Œ reactive å¤„ç†çš„å˜é‡ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨æ”¯æŒ macro çš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œä¹Ÿä¼šä½¿ç”¨ç±»ä¼¼çš„æ–¹å¼æ¥å¤„ç†ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Rust ä¸­çš„ &lt;code&gt;#[derive(Debug, Display)]&lt;&#x2F;code&gt; æ³¨è§£ï¼Œä¼šè‡ªåŠ¨ä¸ºç±»å‹å®ç° Debug å’Œ Display traitã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Java ä¸­çš„ Lombok æ¡†æ¶ï¼Œå¯¹ç±»å‹æ·»åŠ  &lt;code&gt;@Data&lt;&#x2F;code&gt; æ³¨è§£ï¼Œä¼šè‡ªåŠ¨ä¸ºç±»å‹æ·»åŠ  getter&#x2F;setter&#x2F;hashCode&#x2F;equals ç­‰æ–¹æ³•ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;ThoughtWorksInc&#x2F;Binding.scala&quot;&gt;Scala Binding&lt;&#x2F;a&gt; Scala é€šè¿‡ macro å®ç°å¯¹ä»£ç çš„è½¬æ¢å®ç° reactive æœºåˆ¶ã€‚åˆ©ç”¨ macro å’Œ @html æ³¨è§£ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å‚ç…§ä¸Šè¿°çš„å¯¹æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œrunes æ˜¯ç±»ä¼¼äº Macro çš„ä¸€ç§æœºåˆ¶ï¼Œé‡‡ç”¨ ç°æœ‰è¯­è¨€çš„è¯­æ³•ï¼ˆåœ¨svelteä¸­ï¼Œä½¿ç”¨äº† &lt;code&gt;$state, $props, $derived, $effect, $bindable, $inspect, $host&lt;&#x2F;code&gt; ç­‰æ ‡è®°å‡½æ•°ï¼‰
æ¥æ˜¾ç¤ºç”³æ˜æŸç§ç‰¹å®šçš„è¯­ä¹‰ï¼ˆè¿™ä¸ªè¯­ä¹‰ç”± macro-expansion æœºåˆ¶è¿›è¡Œå®ç°ï¼Œåœ¨è¿™é‡Œï¼Œå°±æ˜¯ svelte compiler, svelte compiler ç›¸å½“äº Scala ä¸­ çš„ Macroï¼‰&lt;&#x2F;p&gt;
&lt;h1 id=&quot;how-svelte-rune-works&quot;&gt;How Svelte Rune works&lt;&#x2F;h1&gt;
&lt;p&gt;Svelte æä¾›äº† playground å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œå®éªŒï¼Œè¿™ä¸ª playground è¿˜æä¾›äº†æŸ¥çœ‹ç¼–è¯‘åç”Ÿæˆçš„ JS ä»£ç çš„åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£ runes èƒŒåçš„å·¥ä½œåŸç†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;case: &lt;a href=&quot;https:&#x2F;&#x2F;svelte.dev&#x2F;playground&#x2F;reactive-assignments&quot;&gt;Reactive assignmentsç¤ºä¾‹&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;html&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-html &quot;&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;script&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$state&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;handleClick&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;		&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count &lt;&#x2F;span&gt;&lt;span&gt;+= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;	}
&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;script&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;button &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;onclick&lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{handleClick}&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;	Clicked {count}
&lt;&#x2F;span&gt;&lt;span&gt;	{count === 1 ? &amp;#39;time&amp;#39; : &amp;#39;times&amp;#39;}
&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;button&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å¯¹åº”çš„ç¼–è¯‘åçš„ JS ä»£ç (å·²æ‰‹åŠ¨æ·»åŠ ä¸Šç±»å‹ä¿¡æ¯)ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;svelte&#x2F;internal&#x2F;disclose-version&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;* &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;svelte&#x2F;internal&#x2F;client&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; function handleClick() {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;		count += 1;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;	}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;handleClick&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;_&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;: Source&amp;lt;number&amp;gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;set&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;get&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;) + &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; template compiled
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;root&lt;&#x2F;span&gt;&lt;span&gt;: () &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;Node = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;template&lt;&#x2F;span&gt;&lt;span&gt;(`&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;lt;button&amp;gt; &amp;lt;&#x2F;button&amp;gt;&lt;&#x2F;span&gt;&lt;span&gt;`);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;export default function &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;App&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$$anchor&lt;&#x2F;span&gt;&lt;span&gt;: Node) {
&lt;&#x2F;span&gt;&lt;span&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;: Source&amp;lt;number&amp;gt; = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;state&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; let count = $state(0);
&lt;&#x2F;span&gt;&lt;span&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;button &lt;&#x2F;span&gt;&lt;span&gt;= root(); 
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;button&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;__click &lt;&#x2F;span&gt;&lt;span&gt;= [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;handleClick&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;];   
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;text &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;child&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;button&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;reset&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;button&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Clicked {count}\n{count === 1 ? &amp;#39;time&amp;#39; : &amp;#39;times&amp;#39;}
&lt;&#x2F;span&gt;&lt;span&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;template_effect&lt;&#x2F;span&gt;&lt;span&gt;(() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;set_text&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;text&lt;&#x2F;span&gt;&lt;span&gt;, `&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Clicked ${&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;get&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;) &lt;&#x2F;span&gt;&lt;span&gt;?? &amp;#39;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;${(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;get&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;) &lt;&#x2F;span&gt;&lt;span&gt;=== &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;? &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;time&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; : &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;times&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;) &lt;&#x2F;span&gt;&lt;span&gt;?? &amp;#39;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;}&lt;&#x2F;span&gt;&lt;span&gt;`));
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;append&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$$anchor&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;button&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;delegate&lt;&#x2F;span&gt;&lt;span&gt;([&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;click&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;]);
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ol&gt;
&lt;li&gt;let count = $state å£°æ˜äº†ä¸€ä¸ª reactive å˜é‡ï¼ˆå¯¹åº”ç±»å‹ä¸º &lt;code&gt;Source&amp;lt;T&amp;gt;&lt;&#x2F;code&gt;ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨æºä»£ç ä¸­ï¼Œå¯¹å˜é‡ count çš„è®¿é—® get&#x2F;set æ“ä½œï¼Œè¢«æå‡ä¸º &lt;code&gt;$.get(count)&lt;&#x2F;code&gt; å’Œ &lt;code&gt;$.set(count, value)&lt;&#x2F;code&gt; çš„è°ƒç”¨ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆè¦æå‡ï¼Ÿ
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;$.get(count)&lt;&#x2F;code&gt; æå‡åï¼Œåœ¨ effect ä¸Šä¸‹æ–‡ä¸­æ—¶ï¼Œè‡ªåŠ¨å»ºç«‹ä¸Šä¸‹æ–‡å¯¹ count çš„å“åº”å¼ç›‘å¬ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;$.set(count, value)&lt;&#x2F;code&gt; æå‡åï¼Œé™¤äº†æ›´æ–° count çš„å€¼å¤–ï¼Œè¿˜ä¼šè§¦å‘å¯¹ä¸‹æ¸¸ç›‘å¬ç€çš„é€šçŸ¥ï¼Œä»è€Œå®ç°å“åº”å¼çš„ä¼ æ’­ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œåªæœ‰ text node å»ºç«‹äº†å¯¹ count çš„ç›‘å¬ï¼Œæ¨¡ç‰ˆçš„å…¶ä»–éƒ¨ä»½ï¼ˆé™æ€å†…å®¹ï¼‰å¹¶ä¸å…³å¿ƒ count çš„å˜åŒ–ï¼Œå› æ­¤ï¼Œå½“ count å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ
å¹¶ä¸æ˜¯æ•´ä¸ª template éƒ½ä¼šæ›´æ–°ï¼Œè€Œåªæœ‰ text node ä¼šæ›´æ–°ã€‚ï¼ˆå½“ç„¶ï¼Œç›®å‰æ¥è¯´ï¼Œä¸€ä¸ª text node æ˜¯ä½œä¸ºæ•´ä½“çš„ï¼‰
&lt;ul&gt;
&lt;li&gt;ä»ç›®å‰ svelte ç”Ÿæˆçš„ä»£ç æ¥çœ‹ï¼Œåœ¨ä¸€ä¸ªæ¨¡ç‰ˆå†…çš„é™æ€å†…å®¹ï¼Œå³ä½¿åªæœ‰éƒ¨ä»½å‘ç”Ÿäº†å˜åŒ–ï¼Œä»ç„¶æ˜¯æ‰€æœ‰é™æ€å†…å®¹éƒ½é‡æ–°è®¡ç®—å¹¶åˆ·æ–°ï¼Œè¿™ä¸€å—è¿˜æœ‰ä¼˜åŒ–ç©ºé—´ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœä¸€ä¸ª $state å˜é‡åœ¨æ•´ä¸ªAppä¸­ï¼Œæ²¡æœ‰ä¿®æ”¹ç‚¹ï¼Œå…¶ä¼šé€€åŒ–ä¸ºä¸€ä¸ª æ™®é€šå˜é‡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä»è¿™ä¸ªç¤ºä¾‹æ¥çœ‹ï¼Œè¿™é‡Œçš„ effect ä¾èµ–è¿‡ç¨‹æ˜¯å®Œå…¨ç¼–è¯‘æœŸé™æ€ç¡®å®šçš„ï¼Œsvelte ä»ç„¶æ˜¯åœ¨ç¼–è¯‘æœŸåŠ¨æ€å¤„ç†ï¼Œå¦‚æœè°ƒæ•´åˆ°ç¼–è¯‘æœŸé™æ€å»ºç«‹ä¾èµ–å…³ç³»ï¼Œæ˜¯å¦
ä¼šæœ‰æ›´å¥½çš„åˆå§‹åŒ–æ€§èƒ½ï¼Ÿ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;è¿™ä¸ªå®ç°æ–¹å¼æ”¾åœ¨ scala.js ä¸­ä¼¼ä¹å®ç°æˆæœ¬æ›´ä½ã€‚è¿™ä¸ªåªæ˜¯ä¸€ä¸ªçŒœæµ‹ï¼Œè¿˜æ²¡æœ‰å®é™…è¯„ä¼°ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;qi-ta&quot;&gt;å…¶ä»–&lt;&#x2F;h1&gt;
&lt;p&gt;å¯¹å…¶ä»–çš„ runeï¼Œåç»­è¿›è¡Œåˆ†æã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ€»ç»“ï¼š rune å¯ä»¥ç†è§£ä¸ºä½¿ç”¨ç°æœ‰è¯­æ³•å…ƒç´ ï¼Œæ¥å®šä¹‰ä¸€ç§æ–°çš„è¯­è¨€çº§ç‰¹æ€§ï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ç§æ–°çš„è¯­æ³•ï¼‰ï¼Œæ˜¯ä¸€ä¸ªè²Œä¼¼å‡½æ•°ï¼Œå®é™…ä¸ºè¯­æ³•çš„æ ‡è®°ã€‚&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>å¤§é‡ç»„ä»¶æ ‘ä¸‹çš„æ€§èƒ½å¯¹æ¯”</title>
        <published>2025-03-06T00:00:00+00:00</published>
        <updated>2025-03-06T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/lot-of-components-perf/"/>
        <id>https://wangzaixiang.github.io/blog/lot-of-components-perf/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/lot-of-components-perf/">&lt;p&gt;è¿™ä¸ªæµ‹è¯•æ˜¯åœ¨åˆ›å»ºå¤§é‡ç»„ä»¶æ ‘çš„æƒ…å†µä¸‹ï¼Œå¯¹æ¯”å‡ ä¸ªå‰ç«¯æ¡†æ¶çš„æ€§èƒ½ï¼Œä¸ºåœ¨é«˜æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ä¸‹é€‰æ‹©åˆé€‚çš„æ¡†æ¶æä¾›å‚è€ƒã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;chang-jing-shuo-ming&quot;&gt;åœºæ™¯è¯´æ˜ï¼š&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;App åŒ…æ‹¬ 1 ä¸ª PerfComp20 ç»„ä»¶&lt;&#x2F;li&gt;
&lt;li&gt;1ä¸ª PerfComp20 ç»„ä»¶åŒ…æ‹¬ 26 ä¸ª PerfComp11 ç»„ä»¶&lt;&#x2F;li&gt;
&lt;li&gt;1ä¸ª PerfComp11 ç»„ä»¶åŒ…æ‹¬ 1 ä¸ª PerfComp10 ç»„ä»¶ (æ€»å…± 26 ä¸ª PerfComp10 ç»„ä»¶)&lt;&#x2F;li&gt;
&lt;li&gt;1ä¸ª PerfComp10 ç»„ä»¶åŒ…æ‹¬ 200 ä¸ª PerfComp01 ç»„ä»¶ ï¼ˆæ€»å…± 5200 ä¸ª PerfComp01 ç»„ä»¶ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;1ä¸ª PerfComp01 ç»„ä»¶åŒ…æ‹¬ 5 ä¸ª PerfComp00 ç»„ä»¶ ï¼ˆæ€»å…± 26000 ä¸ª PerfComp00 ç»„ä»¶ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;æ•´ä¸ªé¡µé¢åŒ…æ‹¬ï¼š
&lt;ul&gt;
&lt;li&gt;26 * 200 * 5 = 26000 ä¸ª PerfComp00 ç»„ä»¶&lt;&#x2F;li&gt;
&lt;li&gt;26 * 200 = 5200 ä¸ª PerfComp01 ç»„ä»¶&lt;&#x2F;li&gt;
&lt;li&gt;26 = 26 ä¸ª PerfComp10 ç»„ä»¶&lt;&#x2F;li&gt;
&lt;li&gt;26 = 26 ä¸ª PerfComp11 ç»„ä»¶&lt;&#x2F;li&gt;
&lt;li&gt;1 = 1 ä¸ª PerfComp20 ç»„ä»¶&lt;&#x2F;li&gt;
&lt;li&gt;1 = 1 ä¸ª App ç»„ä»¶&lt;&#x2F;li&gt;
&lt;li&gt;æ€»å…± 31254 ä¸ªç»„ä»¶&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;ce-shi-jie-guo&quot;&gt;æµ‹è¯•ç»“æœï¼š&lt;&#x2F;h2&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Part&lt;&#x2F;th&gt;&lt;th&gt;Svelte&lt;&#x2F;th&gt;&lt;th&gt;Vue3&lt;&#x2F;th&gt;&lt;th&gt;Lit&lt;&#x2F;th&gt;&lt;th&gt;Lit + Native PerfComp00&lt;&#x2F;th&gt;&lt;th&gt;Lit + Native PerfComp00, PerfComp01&lt;&#x2F;th&gt;&lt;th&gt;All Native WC&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;Scripting&lt;&#x2F;td&gt;&lt;td&gt;134.28ms&lt;&#x2F;td&gt;&lt;td&gt;332.95ms&lt;&#x2F;td&gt;&lt;td&gt;427.68ms&lt;&#x2F;td&gt;&lt;td&gt;265.5ms&lt;&#x2F;td&gt;&lt;td&gt;112.29ms&lt;&#x2F;td&gt;&lt;td&gt;85ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Styling&lt;&#x2F;td&gt;&lt;td&gt;17.39ms&lt;&#x2F;td&gt;&lt;td&gt;15.3ms&lt;&#x2F;td&gt;&lt;td&gt;59.71ms&lt;&#x2F;td&gt;&lt;td&gt;24.86ms&lt;&#x2F;td&gt;&lt;td&gt;20ms&lt;&#x2F;td&gt;&lt;td&gt;21ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Layout&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;51.69ms&lt;&#x2F;td&gt;&lt;td&gt;124.53ms&lt;&#x2F;td&gt;&lt;td&gt;33ms&lt;&#x2F;td&gt;&lt;td&gt;31ms&lt;&#x2F;td&gt;&lt;td&gt;32ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Paint&lt;&#x2F;td&gt;&lt;td&gt;2.10ms&lt;&#x2F;td&gt;&lt;td&gt;8.6ms&lt;&#x2F;td&gt;&lt;td&gt;34ms&lt;&#x2F;td&gt;&lt;td&gt;20ms&lt;&#x2F;td&gt;&lt;td&gt;11ms&lt;&#x2F;td&gt;&lt;td&gt;14ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;h2 id=&quot;web-component-de-duo-chong-fang-shi-xing-neng-dui-bi&quot;&gt;Web Component çš„å¤šç§æ–¹å¼æ€§èƒ½å¯¹æ¯”&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;Lit Element &#x2F; Native HTMLComponent&lt;&#x2F;li&gt;
&lt;li&gt;DOM structure
&lt;ul&gt;
&lt;li&gt;Shadow DOM + div.text shared style &lt;code&gt;&amp;lt;div&amp;gt;${text}&amp;lt;&#x2F;div&amp;gt;&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Shadow DOM + div.text inlined style &lt;code&gt;&amp;lt;div style=&quot;display: inline;&quot;&amp;gt;${text}&amp;lt;&#x2F;div&amp;gt;&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Shadow DOM + text &lt;code&gt;${text}&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;element DOM + div.text shared style &lt;code&gt;&amp;lt;div class=&quot;inlined&quot;&amp;gt;${text}&amp;lt;&#x2F;div&amp;gt;&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;element DOM + text &lt;code&gt;${text}&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Mode&lt;&#x2F;th&gt;&lt;th&gt;DOM Structure&lt;&#x2F;th&gt;&lt;th&gt;Scripting&lt;&#x2F;th&gt;&lt;th&gt;Styling&lt;&#x2F;th&gt;&lt;th&gt;Layout&lt;&#x2F;th&gt;&lt;th&gt;Paint&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;Lit&lt;&#x2F;td&gt;&lt;td&gt;Shadow DOM + div.text shared style&lt;&#x2F;td&gt;&lt;td&gt;470&lt;&#x2F;td&gt;&lt;td&gt;93.70&lt;&#x2F;td&gt;&lt;td&gt;104&lt;&#x2F;td&gt;&lt;td&gt;33&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Lit&lt;&#x2F;td&gt;&lt;td&gt;Shadow DOM + div.text inlined style&lt;&#x2F;td&gt;&lt;td&gt;447&lt;&#x2F;td&gt;&lt;td&gt;46.39&lt;&#x2F;td&gt;&lt;td&gt;105.11&lt;&#x2F;td&gt;&lt;td&gt;33&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Lit&lt;&#x2F;td&gt;&lt;td&gt;Shadow DOM + text&lt;&#x2F;td&gt;&lt;td&gt;443&lt;&#x2F;td&gt;&lt;td&gt;26&lt;&#x2F;td&gt;&lt;td&gt;39.27&lt;&#x2F;td&gt;&lt;td&gt;23&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Lit&lt;&#x2F;td&gt;&lt;td&gt;element DOM + div.text shared style&lt;&#x2F;td&gt;&lt;td&gt;428&lt;&#x2F;td&gt;&lt;td&gt;67&lt;&#x2F;td&gt;&lt;td&gt;119&lt;&#x2F;td&gt;&lt;td&gt;31&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Lit&lt;&#x2F;td&gt;&lt;td&gt;element DOM + text&lt;&#x2F;td&gt;&lt;td&gt;430&lt;&#x2F;td&gt;&lt;td&gt;27&lt;&#x2F;td&gt;&lt;td&gt;46&lt;&#x2F;td&gt;&lt;td&gt;22&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Native&lt;&#x2F;td&gt;&lt;td&gt;Shadow DOM + div.text shared style&lt;&#x2F;td&gt;&lt;td&gt;103&lt;&#x2F;td&gt;&lt;td&gt;93.97&lt;&#x2F;td&gt;&lt;td&gt;120.85&lt;&#x2F;td&gt;&lt;td&gt;21&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Native&lt;&#x2F;td&gt;&lt;td&gt;Shadow DOM + div.text inlined style&lt;&#x2F;td&gt;&lt;td&gt;101&lt;&#x2F;td&gt;&lt;td&gt;42&lt;&#x2F;td&gt;&lt;td&gt;104&lt;&#x2F;td&gt;&lt;td&gt;20&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Native&lt;&#x2F;td&gt;&lt;td&gt;Shadow DOM + text&lt;&#x2F;td&gt;&lt;td&gt;86&lt;&#x2F;td&gt;&lt;td&gt;20.8&lt;&#x2F;td&gt;&lt;td&gt;32.78&lt;&#x2F;td&gt;&lt;td&gt;14.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Native&lt;&#x2F;td&gt;&lt;td&gt;element DOM + div.text shared style&lt;&#x2F;td&gt;&lt;td&gt;83&lt;&#x2F;td&gt;&lt;td&gt;43&lt;&#x2F;td&gt;&lt;td&gt;99.5&lt;&#x2F;td&gt;&lt;td&gt;20&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Native&lt;&#x2F;td&gt;&lt;td&gt;element DOM + text&lt;&#x2F;td&gt;&lt;td&gt;75&lt;&#x2F;td&gt;&lt;td&gt;19&lt;&#x2F;td&gt;&lt;td&gt;31&lt;&#x2F;td&gt;&lt;td&gt;14&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;h2 id=&quot;fen-xi-jie-lun&quot;&gt;åˆ†æç»“è®º&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åŸºäº Lit çš„ Web Component ç”¨äº micro component æ—¶ï¼Œå¯¼è‡´é¡µé¢ä¸­å¤§é‡çš„ shadow dom å’Œ å¤§é‡çš„DOMæ—¶
å¯¹æ€§èƒ½çš„å½±å“è¾ƒå¤§ï¼Œå°¤å…¶æ˜¯å¯¹ styling å’Œ layout çš„å½±å“çš„è€—æ—¶å½±å“è¾ƒå¤§ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;scripting: Lit çš„åˆå§‹åŒ–å¼€é”€è¾ƒå¤§ï¼Œä¼°è®¡ä¸»è¦æ˜¯ Lit Template çš„å¼€é”€ã€‚æŒ‰ç…§ &lt;a href=&quot;https:&#x2F;&#x2F;lit.dev&#x2F;blog&#x2F;2023-10-10-lit-3.0&#x2F;#compiler&quot;&gt;Lit æ–‡æ¡£&lt;&#x2F;a&gt;ä¸­çš„è¯´æ³•ï¼Œå¯¹äº heavy-template çš„æƒ…å†µä¸‹ï¼Œé‡‡ç”¨é¢„ç¼–è¯‘çš„
æ–¹å¼ï¼Œé¦–æ¬¡æ€§èƒ½æå‡ 45%ï¼Œæ›´æ–°æ—¶æå‡21%ã€‚ å¯¹éœ€è¦å¤§é‡é‡å¤çš„ç»„ä»¶ï¼Œå¯ä»¥è€ƒè™‘ç›´æ¥ä½¿ç”¨ Native Web Componentã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;styling: Lit ç›®å‰é€‰æ‹©çš„ç»„ä»¶çº§å…±äº«çš„ styleï¼Œç”±äºåœ¨ shadow dom ä¸­å¼•å…¥äº† stylesheetï¼Œå…¶å¯¹æ€§èƒ½æœ‰ä¸€å®šçš„å½±å“ã€‚ç›¸åï¼ŒSvelte&#x2F;Vue3 ç­‰é‡‡ç”¨åœ¨ document level çš„ style ä¼¼ä¹æ€§èƒ½æ›´å¥½ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è¿™ä¸ªä¸æ„Ÿè§‰ä¸Šå¹¶ä¸ä¸€è‡´ï¼Œä»æ„Ÿè§‰ä¸Šæ¥çœ‹ï¼Œshadow dom å†…çš„ style sheet ä¼¼ä¹ä¼šå› ä¸ºå±‚æ¬¡ç®€å•è€Œæœ‰æ›´é«˜çš„ match æ•ˆç‡ã€‚ä½†å®é™…ä¸Šï¼Œåè€Œæœ‰æŸå¤±ï¼Œä¼°è®¡ä¸æ‰¹é‡å¤„ç†æœ‰å…³ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;layoutï¼šshadow dom çš„å¼•å…¥å¹¶ä¸ä¼šå¯¼è‡´ DOM çš„å¤æ‚ï¼Œlayout ä¸ä¼šæœ‰å¤§çš„å½±å“ã€‚ç›¸åï¼Œç»„ä»¶å¸¦æ¥çš„ DOM ç»“æ„çš„å¤æ‚æ€§ï¼Œä¼šå¯¼è‡´ layout çš„æ€§èƒ½å¼€é”€ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¯¹äº Svelteï¼Œmicro component è‡ªèº«å¯èƒ½ä¸ä¼šå¼•å…¥é¢å¤–çš„ DOM ç»“æ„ï¼Œä¾‹å¦‚ç›´æ¥æ˜ å°„æˆ document ä¸Šçš„div&#x2F;text å…ƒç´ ã€‚è€Œ web component ä¸­ï¼Œæ¯ä¸€ä¸ª component è‡ªèº«ä¼š
å ç”¨ä¸€ä¸ª DOM elementï¼Œåœ¨å‡ºç°å¤§é‡çš„ç»„ä»¶æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ layout çš„æ€§èƒ½å¼€é”€ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Web Component æ€§èƒ½&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æœ¬æ¬¡æµ‹è¯•ä¸­ï¼Œä½¿ç”¨ Native ç¼–å†™å…¨éƒ¨çš„ Web Component æ€§èƒ½æœ€ä½³ï¼Œå…¶å¼€é”€ç”šè‡³ä½äº Svelteï¼ˆæ¡†æ¶å¼€é”€ï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;shadow dom è‡ªèº«å¹¶ä¸ä¼šå½±å“ DOM ç»“æ„çš„å¤æ‚åº¦ï¼Œä¸ä¼šå¸¦æ¥é¢å¤–çš„ layout å¼€é”€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;shadow dom ä¸­çš„ adoptedStyleSheets ä¼šå¸¦æ¥ styling çš„å¼€é”€ã€‚å½“å‡ºç°å¤§é‡ç»„ä»¶æ—¶ï¼ŒStyling çš„æ—¶é—´æœ‰æ‰€å¢åŠ ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è¯´æ˜å¼•å…¥æ¡†æ¶å¤šå°‘ä¼šå¼•å…¥å¼€é”€ï¼Œå°¤å…¶æ˜¯UIç»„ä»¶é¦–æ¬¡åˆå§‹åŒ–æœ‰å¤„ç†æ¨¡ç‰ˆã€reactiveæ¡†æ¶ç­‰å¼€é”€ã€‚
åœ¨è¿™äº›æ–¹é¢ï¼ŒSvelte çš„ä¼˜åŠ¿åœ¨äºå…¶ç¼–è¯‘æ—¶çš„é™æ€ä¼˜åŒ–è€Œæˆæœ¬æœ€ä½ã€‚Lit çš„ Template compiler åº”è¯¥æ˜¯å¯¹æ­¤çœ‹é½ï¼Œä½†ç›®å‰è¿˜ä¸æˆç†Ÿã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æœ¬æ¬¡æµ‹è¯•è¾ƒä¸ºå˜æ€ï¼Œåœ¨ä¸€èˆ¬åº”ç”¨åœºæ™¯ä¸­å¦‚ä¸æ¶‰åŠåˆ°å¦‚æ­¤å·¨å¤§çš„ç»„ä»¶æ ‘ï¼ˆå»ºè®®ä¸€èˆ¬æ§åˆ¶åœ¨2000ä»¥ä¸‹æ—¶ï¼‰ï¼Œä¸€èˆ¬æ— éœ€æ‹…å¿ƒåˆå§‹åŒ–çš„æ€§èƒ½é—®é¢˜ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;can-kao&quot;&gt;å‚è€ƒï¼š&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;é¡¹ç›®æºä»£ç ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;lot-of-elements-compare&quot;&gt;Git Repo&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Recalculate Style
&lt;blockquote&gt;
&lt;p&gt;In your performance recordings, some of these long-running tasks may be Recalculate Style events.
A Recalculate Style event tracks the time it takes for the browser to do the following:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Iterate through the DOM elements on a page, to find all of the CSS style rules that match a given element.&lt;&#x2F;li&gt;
&lt;li&gt;Compute each element&#x27;s actual style, based on the matching CSS style rules.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;CSS styles need to be recalculated whenever the applicability of CSS rules may have changed, such as:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;When elements are added to or removed from the DOM.&lt;&#x2F;li&gt;
&lt;li&gt;When an element&#x27;s attributes are changed, such as the value of a class or id attribute.&lt;&#x2F;li&gt;
&lt;li&gt;When user input occurs, such as a mouse move or a change of which element in a webpage has focus, which can affect :hover rules.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;see: https:&#x2F;&#x2F;developer.chrome.com&#x2F;docs&#x2F;devtools&#x2F;performance&#x2F;selector-stats?hl=zh-cn&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹å¤§é‡ DOM è¿›è¡Œæ›´æ–°å¯¼è‡´ reflow æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wilsonpage&#x2F;fastdom?tab=readme-ov-file&quot;&gt;FastDOM&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Shadow DOM å¯¹ Style çš„æ€§èƒ½å½±å“ã€‚&lt;a href=&quot;https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s?__biz=MzA5NTg1NzI0Mw==&amp;amp;mid=2650000010&amp;amp;idx=1&amp;amp;sn=dd2c9188b1e91467358d542e4ed99001&amp;amp;chksm=895bac7764066c46c70e6fb79023871313717d67db92722402bd04eb296e0735f398e6f393b9#rd&quot;&gt;ä¸­æ–‡&lt;&#x2F;a&gt;
&lt;a href=&quot;https:&#x2F;&#x2F;nolanlawson.com&#x2F;2021&#x2F;08&#x2F;15&#x2F;does-shadow-dom-improve-style-performance&#x2F;&quot;&gt;åŸæ–‡:Does shadow DOM improve style performance?&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœ page æ¯”è¾ƒå¤æ‚ï¼ˆDOMèŠ‚ç‚¹è¶Šå¤šã€CSSè§„åˆ™è¶Šå¤šï¼‰ï¼Œshadow dom å¯ä»¥æé«˜ Style é€Ÿåº¦&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœ page å¹¶ä¸å¤æ‚ï¼Œå¼•å…¥ shadow dom ä¼šå¢åŠ å›ºå®šçš„å¼€é”€ï¼Œåè€Œå¢åŠ  Style å¼€é”€ï¼ˆä»å•ä¸ªå¤§æ‰¹é‡è½¬æ¢ä¸ºå¤šä¸ªå°æ‰¹é‡ï¼‰
åœ¨å¾ˆå¤šæ—¶å€™ï¼ŒStyleçš„æ—¶é—´ä¼šæ¯” layout æ›´è€—æ—¶ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;nolanlawson.com&#x2F;2022&#x2F;06&#x2F;22&#x2F;style-scoping-versus-shadow-dom-which-is-fastest&#x2F;#:~:text=TL%3BDR%3A%20My%20new%20benchmark%20largely%20confirmed%20my%20previous,scenarios%2C%20but%20in%20others%20it%E2%80%99s%20much%20less%20performant&quot;&gt;Style scoping versus shadow DOM: which is fastest?&lt;&#x2F;a&gt;
æ€»ä½“æ”¯æŒ Shadow DOM æœ‰æ”¹å–„ Style æ€§èƒ½çš„è§‚ç‚¹ï¼Œä¸”æ€§èƒ½æ¯”è¾ƒç¨³å®šã€‚
&lt;ul&gt;
&lt;li&gt;ç›¸å…³æµ‹è¯•é¡¹ç›® &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;nolanlawson&#x2F;shadow-selector-benchmark&quot;&gt;shadow-selector-benchmark&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨çº¿æµ‹è¯•ï¼šhttps:&#x2F;&#x2F;nolanlawson.github.io&#x2F;shadow-selector-benchmark&#x2F;&lt;&#x2F;li&gt;
&lt;li&gt;Firefox Stylo å¼•æ“æ˜¯æœ€å¿«çš„ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥è¿™ä¸€å—çš„å¼€é”€ã€‚åœ¨å…¶ä»–æµè§ˆå™¨éœ€è¦èŠ±1000msçš„åœºæ™¯ä¸‹ï¼ŒFirefox åªéœ€è¦èŠ±è´¹ 100msã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨2025å¹´ï¼Œè¿™ä¸€å—çš„æ€§èƒ½å¯¹æ¯” FF(360ms) &amp;gt; Chrome(460ms) &amp;gt; Safari(931ms) Chrome ä¸ Safari çš„å·®è·è™½å°äº†ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Shadow DOM å¯¹ layout çš„æ€§èƒ½å½±å“ã€‚
&lt;ul&gt;
&lt;li&gt;å‡å°‘å¸ƒå±€èŒƒå›´ï¼Œæ˜¯å¦ä»…å½±å“è¾¹ç•Œå†…çš„å±€éƒ¨å¸ƒå±€ï¼Ÿ&lt;&#x2F;li&gt;
&lt;li&gt;ç»“åˆ CSS containment å±æ€§ï¼Œæ˜¯å¦å¯ä»¥å‡å°‘ layout çš„å¼€é”€ï¼Ÿ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blogs.igalia.com&#x2F;mrego&#x2F;files&#x2F;2019&#x2F;01&#x2F;css-contain-example.html&quot;&gt;CSS Containment Performance Example&lt;&#x2F;a&gt;
ä½¿ç”¨ contain: strict å¸¦æ¥äº†8å€çš„æ€§èƒ½æå‡ã€‚åœ¨æŸäº›ç¨‹åº¦ä¸Šï¼ŒCSS containment ä¸ shadow dom æœ‰ç›¸ä¼¼ä¹‹å¤„ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>March 2025</title>
        <published>2025-03-03T00:00:00+00:00</published>
        <updated>2025-03-03T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2025-03/"/>
        <id>https://wangzaixiang.github.io/monthly/2025-03/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2025-03/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;sCRHoM-JITyp0L4kgWH1Jw&quot;&gt;Rust 2024 å¹´åº¦æŠ¥å‘Š ä¹‹ä¸€ï¼š Rust 2024 Edition å˜æ›´ç‰¹æ€§è¯¦è§£&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å“²å­¦
&lt;ul&gt;
&lt;li&gt;Safety &amp;amp; Performance&lt;&#x2F;li&gt;
&lt;li&gt;ç”Ÿæ€ç³»ç»Ÿ ä¸ ç¤¾åŒºåä½œçš„å¼€æ”¾æ²»ç†&lt;&#x2F;li&gt;
&lt;li&gt;Zero Cost Abstractions &amp;amp; ç°ä»£è¯­è¨€ç‰¹æ€§çš„å…¼å®¹&lt;&#x2F;li&gt;
&lt;li&gt;ç³»ç»Ÿç¼–ç¨‹ ä¸ åº”ç”¨è½åœ°&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;2024 Edition (éœ€è¦èŠ±äº›æ—¶é—´é€ä¸€ç†è§£ä¸€ä¸‹)
&lt;ul&gt;
&lt;li&gt;if-let chains&#x2F; let chains&lt;&#x2F;li&gt;
&lt;li&gt;è¡¨è¾¾å¼ä¸´æ—¶å€¼çš„scope&lt;&#x2F;li&gt;
&lt;li&gt;match ç»‘å®šå˜é‡&lt;&#x2F;li&gt;
&lt;li&gt;! ç±»å‹çš„å›é€€ç±»å‹&lt;&#x2F;li&gt;
&lt;li&gt;gen ç”Ÿæˆå™¨&lt;&#x2F;li&gt;
&lt;li&gt;async trait fn&lt;&#x2F;li&gt;
&lt;li&gt;async closure&lt;&#x2F;li&gt;
&lt;li&gt;use&amp;lt;&#x27;a&amp;gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;zig 0.14 2025-3-5 å‘å¸ƒ&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;switch æ”¯æŒ continue :label value è¯­æ³•&lt;&#x2F;li&gt;
&lt;li&gt;.foo æ”¯æŒ Result Location Semantics&lt;&#x2F;li&gt;
&lt;li&gt;field &amp;amp; declarations ä¸èƒ½åŒå&lt;&#x2F;li&gt;
&lt;li&gt;å…¨å±€å˜é‡åˆå§‹åŒ–å¯ä»¥ä½¿ç”¨å½¼æ­¤çš„åœ°å€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;@branchHint(.unlikely)&lt;&#x2F;li&gt;
&lt;li&gt;...&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;felixwrt.dev&#x2F;posts&#x2F;const-fn&#x2F;&quot;&gt;Const Fn in Rust&lt;&#x2F;a&gt;
è¿™ç¯‡æ–‡ç« å¹¶æ²¡æœ‰ä»‹ç» const fn æ˜¯å¦‚ä½•åœ¨ compile time æ—¶evaluate çš„ï¼Œåªæ˜¯ä»‹ç»äº† const fn çš„åŸºæœ¬ç”¨æ³•ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;reference&#x2F;const_eval.html&quot;&gt;compile time evaluation&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å­¦ä¹  register allocation&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;c9x.me&#x2F;compile&#x2F;bib&#x2F;pcc-rega.pdf&quot;&gt;A Generalized Algorithm for Graph-Coloring Register Allocation&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;640647465&quot;&gt;CS143 ç¼–è¯‘åŸç†ç¬”è®° 6 - Register Allocation&lt;&#x2F;a&gt; ä¸­æ–‡ç¬”è®°
&lt;ul&gt;
&lt;li&gt;Liveness Analysis&lt;&#x2F;li&gt;
&lt;li&gt;Register interference graph&lt;&#x2F;li&gt;
&lt;li&gt;Graph coloring&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;c9x.me&#x2F;compile&#x2F;bib&#x2F;linearscan.pdf&quot;&gt;Linear Scan Register Allocation&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;628123333&quot;&gt;ä¸­æ–‡ç¬”è®°&lt;&#x2F;a&gt;
ç®€å•çš„é€‰æ‹©ï¼Œlife time æœ€é•¿çš„variable è¿›è¡Œ spillï¼Œç®€å•ç²—æš´ï¼ˆå­˜æ´»æ—¶é—´æœ€é•¿å°±æ„å‘³ç€å ç”¨æœ€å¤šèµ„æºï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ç†è§£ rust çš„ç¼–è¯‘æ–¹å¼ä¸ LTO&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;rust çš„ç¼–è¯‘å•å…ƒæ˜¯ crate, ä¸€ä¸ª crate å¯ä»¥ç¼–è¯‘ç§°ä¸ºä¸€ä¸ª rlib æˆ–è€…ä¸€ä¸ª executable, ä¸€ä¸ª crate ä¼šåŒ…æ‹¬å¤šä¸ª .o æ–‡ä»¶ï¼ˆå…·ä½“æ„æˆå¾…åˆ†æï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;rust åœ¨æ¯ä¸ª crate ä¸­ä¼šå¯¹ generic è¿›è¡Œå±•å¼€ï¼Œå› æ­¤ï¼Œä¼šåŒ…æ‹¬å±•å¼€çš„ä»£ç ï¼ˆåœ¨ä½¿ç”¨çš„crateä¸­å±•å¼€ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœ a crate ä¾èµ–äº† b, c crateï¼Œé‚£ä¹ˆåœ¨ b, c ä¸­å¯èƒ½éƒ½åŒ…æ‹¬äº†å¯¹ generic çš„ç›¸åŒå±•å¼€ä»£ç ï¼ˆå¦‚æœæ˜¯ç›¸åŒçš„èŒƒå‹å‚æ•°ï¼‰ã€‚å¦‚æœä¸ä½¿ç”¨ LTO
ä¼˜åŒ–ï¼Œåœ¨æœ€ç»ˆç”Ÿæˆçš„ a ä¸­ä¼šåŒ…æ‹¬é‡å¤çš„ä»£ç ã€‚å¯ç”¨ LTO åˆ™å¯ä»¥æ¶ˆé™¤ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è¿™ä¹Ÿæ„å‘³ç€ generic å±•å¼€ï¼Œä¼šåœ¨æ¯ä¸ª crate ç¼–è¯‘æ—¶ä¸­é‡å¤ä¸€æ¬¡ã€‚æœ‰åˆ†æè¯´è¿™æ˜¯ rust æ…¢çš„ä¸»è¦åŸå› ä¹‹ä¸€ï¼Œå¯èƒ½æ˜¯å¤§å‹é¡¹ç›®å¤§é‡çš„crateå¯¼è‡´äº†è¿™ç§æƒ…å†µã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ä¸æ—©æœŸçš„ C è¯­è¨€ä¸åŒï¼Œåœ¨ C ä¸­ï¼Œæ¯ä¸ª .c æ–‡ä»¶ç¼–è¯‘ç§°ä¸ºä¸€ä¸ª .o æ–‡ä»¶ï¼Œæœ€åé€šè¿‡ linker è¿›è¡Œè¿æ¥ï¼ˆåœ¨æ—©æœŸå†…å­˜è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹å¼æ˜¯åˆé€‚çš„ï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Rust&#x2F;C++ ç”±äºå¼•å…¥äº† generic&#x2F;template, Vec&lt;T&gt; çš„ä»£ç éœ€è¦åœ¨ T ç¡®å®šæ—¶è¿›è¡Œç”Ÿæˆã€‚Rust æ˜¯åœ¨æ¯ä¸ª crate ä¸­ç”Ÿæˆè¿™äº›ä»£ç ï¼Œç„¶ååœ¨ link æ—¶
é€šè¿‡ LTO è¿›è¡Œåˆå¹¶ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Zig åˆ™æ˜¯ä½œä¸ºæ•´ä½“è¿›è¡Œç¼–è¯‘ï¼Œå› æ­¤ï¼Œæ€»æ˜¯å…¨å±€æ¶ˆé™¤é‡å¤çš„ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;MPP &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;645064049&quot;&gt;DuckDB -- ARTç´¢å¼•&lt;&#x2F;a&gt;
trie æ ‘çš„å˜ç§ï¼Œé¢å‘å†…å­˜ï¼ˆç´¢å¼•æ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ï¼‰&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Node4 ( &lt;code&gt;key[4], child[4]&lt;&#x2F;code&gt; ):  4 + 4 * 8 = 36 bytes&lt;&#x2F;li&gt;
&lt;li&gt;Node16 ( &lt;code&gt;key[16], child[16]&lt;&#x2F;code&gt; ) 16 + 16 * 8 = 144 bytes&lt;&#x2F;li&gt;
&lt;li&gt;Node48 ( &lt;code&gt;key[256], child[48]&lt;&#x2F;code&gt; ) 256 + 48 * 8 = 400 bytes&lt;&#x2F;li&gt;
&lt;li&gt;Node256 ( &lt;code&gt;child[256]&lt;&#x2F;code&gt; ) 256 * 8 = 2048 bytes&lt;&#x2F;li&gt;
&lt;li&gt;Leaf&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ä¼˜åŒ–ï¼šNode: prefix + key + index, Leaf: prefix + valueã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;duckdb.org&#x2F;2022&#x2F;07&#x2F;27&#x2F;art-storage.html&quot;&gt;Duck DB -- ART&lt;&#x2F;a&gt;
DuckDB æ—©æœŸ ART ç´¢å¼•æ˜¯ä¸å­˜å‚¨çš„ï¼Œå¯åŠ¨æ—¶ä¼šé‡å»ºã€‚ç›®å‰çš„ç‰ˆæœ¬æ˜¯æŒä¹…åŒ–çš„ã€‚
ä½¿ç”¨ ART æ¥å­˜å‚¨ PKï¼ˆæ¯ä¸€è¡Œéƒ½éœ€è¦åœ¨ Leaf ä¸­ï¼‰:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;æ˜¯å¦ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Ÿlazy load node ä½¿å¾—æ— éœ€å°†å…¨éƒ¨ç´¢å¼•åŠ è½½åˆ°å†…å­˜ä¸­ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚ä½•è¿›è¡Œå­˜å‚¨ï¼Ÿæ–¹ä¾¿ lazy load
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;monthly&#x2F;2025-03&#x2F;art-post-order.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;monthly&#x2F;2025-03&#x2F;art-storage.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;
ä½¿ç”¨ post-order å¯ä»¥ä½¿å¾—ä¸€ä¸ªä¸€ä¸ª Block (256K) ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œè¯»å–ï¼ˆå­˜å‚¨æ—¶å¯é€‰å‹ç¼©ï¼‰ã€‚å½“ block æœªåŠ è½½æ—¶ï¼Œåªéœ€æ•´ä½“åŠ è½½è¯¥ block åˆ°å†…å­˜ä¸­ã€‚
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;monthly&#x2F;2025-03&#x2F;swizzlable-pointer.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;é—®é¢˜ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;post order ç»´æŒäº† node çš„æ•´ä½“æœ‰åºæ€§ï¼Œä¸€ä¸ª block ä¸­çš„èŠ‚ç‚¹æ˜¯åŸºæœ¬è¿ç»­ã€æœ‰åºçš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ’å…¥ã€ä¿®æ”¹æ“ä½œæ¶‰åŠåˆ°å¯¹ block çš„æ‹†åˆ†ã€åˆå¹¶ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç´¢å¼•çš„å­˜å‚¨æ”¾å¤§æ¯”ç‡å¦‚ä½•ï¼Ÿæ¯”å¦‚è¯´å¯¹ 1G çš„æ•°æ®è¡Œï¼Œ ART ç´¢å¼•éœ€è¦å¤šå°‘ç©ºé—´ï¼Ÿ&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;web-visualization&quot;&gt;Web &amp;amp; Visualization&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;tools-libraries&quot;&gt;Tools &amp;amp; Libraries&lt;&#x2F;h1&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>measure IPC for M1</title>
        <published>2025-02-06T00:00:00+00:00</published>
        <updated>2025-02-06T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/measure-ipc-for-m1/"/>
        <id>https://wangzaixiang.github.io/blog/measure-ipc-for-m1/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/measure-ipc-for-m1/">&lt;p&gt;ç°åœ¨çš„é«˜æ€§èƒ½CPUåŸºæœ¬ä¸Šéƒ½æ˜¯è¶…æ ‡é‡ + SIMD æ”¯æŒäº†ï¼Œè¶…æ ‡é‡çš„è®¾è®¡æ˜¯æé«˜æŒ‡æ ‡å¹¶è¡Œåº¦ï¼ˆIPC: Instruction Per Cycleï¼‰, SIMD æ˜¯æé«˜æ•°æ®å¹¶è¡Œåº¦ã€‚äºŒè€…
ç»“åˆåœ¨å¾ˆå¤šé«˜æ€§èƒ½çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥å‘æŒ¥å‡ºå¾ˆå¥½çš„æ€§èƒ½ã€‚æœ¬æ–‡æ³¨é‡ä¸é€šè¿‡ä¸€äº›ä»£ç ç¤ºä¾‹æ¥åº¦é‡ IPCï¼Œä»¥åŠé€šè¿‡ IPC æ¥è®¤çŸ¥ CPU çš„ç›¸å…³ä¼˜åŒ–ç‰¹æ€§ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;1-ru-he-du-liang-ipc&quot;&gt;1. å¦‚ä½•åº¦é‡ IPC?&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨ x86 å¹³å°ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ perf æ¥åº¦é‡ IPCï¼ˆä½†å¤§éƒ¨åˆ†çš„äº‘è™šæ‹Ÿç¯å¢ƒä¸‹ï¼Œperf éƒ½ä¸æ”¯æŒ IPCçš„åº¦é‡ï¼‰ï¼Œä½†æ˜¯åœ¨ M1 ä¸Šï¼Œperf å¹¶ä¸æ”¯æŒ IPC åº¦é‡ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ç»è¿‡ä¸æ‡ˆçš„æœç´¢ï¼Œç»ˆäºæ‰¾åˆ°äº†ä¸€äº› M1 ä¸Šåº¦é‡ IPC çš„æ–¹æ³•ï¼Œå‚è€ƒï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gist.github.com&#x2F;ibireme&#x2F;173517c208c7dc333ba962c1f0d67d12&quot;&gt;M1: A demo shows how to read Intel or Apple M1 CPU performance counter in macOS.&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;El-Naizin&#x2F;rust-kperf&quot;&gt;rust-kperf&lt;&#x2F;a&gt; MacOS ä¸‹çš„æœªå…¬å¼€çš„API çš„é€†å‘å·¥ç¨‹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;m1_ipc_measure&quot;&gt;æˆ‘æ”¹è¿›çš„ M1 IPC åº¦é‡å°å·¥å…·&lt;&#x2F;a&gt; åœ¨ä¸Šè¿°èµ„æ–™çš„åŸºç¡€ä¸Šï¼Œæˆ‘ç¨å¾®æ”¹è¿›çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥åº¦é‡æŸä¸ªå‘½ä»¤çš„ IPC å€¼ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æœ¬æ–‡ä¸­ä¸»è¦åŸºäºä¸Šè¿°æ”¹è¿›çš„ M1 IPC åº¦é‡å°å·¥å…·æ¥åº¦é‡ IPCã€‚è¿™ä¸ªå·¥å…·è¿˜å¾ˆä¸å®Œå–„ï¼Œä¸»è¦åŸå› æ˜¯ M1 çš„ kperf åº“çš„API èµ„æ–™è¿˜ç›¸å½“ç¼ºå¤±ï¼Œå¤§éƒ¨ä»½éƒ½æ˜¯é€šè¿‡é€†å‘å·¥ç¨‹å¾—åˆ°çš„ï¼Œ
æˆ‘ç›®å‰å¯¹è¿™ä¸ª API è¿˜æ˜¯ä¸€çŸ¥åŠè§£ï¼Œç›®å‰è¿™ä¸ªå°å·¥å…·ä¹Ÿåªæ˜¯å‹‰å¼ºå‡‘åˆï¼Œé™åˆ¶è¿˜å¾ˆå¤šï¼Œè¿™äº›åœ¨è¯¥é¡¹ç›®çš„ readme.md ä¸­éƒ½æœ‰è¯´æ˜ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;2-the-m1-microarchitecture&quot;&gt;2. the m1 microarchitecture.&lt;&#x2F;h1&gt;
&lt;p&gt;æœ¬æ–‡æ˜¯åœ¨ M1 Max(Mac Book Pro 2021)ä¸Šè¿›è¡Œçš„ï¼Œ ä¸‹æ–‡ä¸­çš„ IPC åˆ†æä¼šå‚è€ƒè¿™ä¸ª CPU çš„ç‰¹æ€§ã€‚è¿™é‡Œé™„ä¸Š M1 å¾®æ¶æ„å›¾ï¼ˆæ¥æºï¼š&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;700865927&quot;&gt;ä¸­æ–‡&lt;&#x2F;a&gt;ã€
&lt;a href=&quot;https:&#x2F;&#x2F;dougallj.github.io&#x2F;applecpu&#x2F;firestorm.html&quot;&gt;åŸæ–‡&lt;&#x2F;a&gt;ï¼‰&lt;&#x2F;p&gt;

&lt;img src=&quot;https:&amp;#x2F;&amp;#x2F;wangzaixiang.github.io&amp;#x2F;processed_images&amp;#x2F;M1-Firestorm-MicroArchitecture.2e1440e8b51702f1.png&quot; &#x2F;&gt;&lt;h1 id=&quot;3-ipcdu-liang&quot;&gt;3. IPCåº¦é‡&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;3-1-test1-ipc-3-74-wei-shen-me-bu-shi-6&quot;&gt;3.1 test1: IPC ï½ 3.74, ä¸ºä»€ä¹ˆä¸æ˜¯ 6+ ?&lt;&#x2F;h2&gt;
&lt;p&gt;ä»£ç ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;master&#x2F;src&#x2F;bin&#x2F;TestIPC.rs#L44&quot;&gt;å®Œæ•´æºä»£ç &lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;test1&lt;&#x2F;span&gt;&lt;span&gt;(){
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; base0 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1234&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; base1 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1234&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i1 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i2 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;20&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i3 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;30&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i4 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;40&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i5 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;50&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i6 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;60&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i7 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;70&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut i8 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;80&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i9 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;90&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i10 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i11 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;110&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i12 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;120&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; time0 = std::time::Instant::now();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for &lt;&#x2F;span&gt;&lt;span&gt;_ in &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;..&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100_0000_0000&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ asm! {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i1}, {i1}, {base0}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i2}, {i2}, {base0}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i3}, {i3}, {base0}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i4}, {i4}, {base0}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i5}, {i5}, {base0}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i6}, {i6}, {base0}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i7}, {i7}, {base0}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i8}, {i8}, {base0}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i9}, {i9}, {base0}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i10}, {i10}, {base0}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i11}, {i11}, {base0}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i12}, {i12}, {base0}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i1}, {i1}, {base1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i2}, {i2}, {base1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i3}, {i3}, {base1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i4}, {i4}, {base1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i5}, {i5}, {base1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i6}, {i6}, {base1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i7}, {i7}, {base1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i8}, {i8}, {base1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i9}, {i9}, {base1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i10}, {i10}, {base1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i11}, {i11}, {base1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i12}, {i12}, {base1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        base0 = in(reg) base0,
&lt;&#x2F;span&gt;&lt;span&gt;        base1 = in(reg) base1,
&lt;&#x2F;span&gt;&lt;span&gt;        i1 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i1,
&lt;&#x2F;span&gt;&lt;span&gt;        i2 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i2,
&lt;&#x2F;span&gt;&lt;span&gt;        i3 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i3,
&lt;&#x2F;span&gt;&lt;span&gt;        i4 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i4,
&lt;&#x2F;span&gt;&lt;span&gt;        i5 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i5,
&lt;&#x2F;span&gt;&lt;span&gt;        i6 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i6,
&lt;&#x2F;span&gt;&lt;span&gt;        i7 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i7,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i8 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i8&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        i9 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i9,
&lt;&#x2F;span&gt;&lt;span&gt;        i10 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i10,
&lt;&#x2F;span&gt;&lt;span&gt;        i11 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i11,
&lt;&#x2F;span&gt;&lt;span&gt;        i12 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i12,
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; time1 = time0.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;elapsed&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    println!(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;test1 total time: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{:?}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;, iteration: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{:.2}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;ns&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, time1, time1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_nanos&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f64  &lt;&#x2F;span&gt;&lt;span&gt;&#x2F; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100_0000_0000.0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ä½¿ç”¨ inline asm çš„æ–¹å¼ï¼Œé¿å…æ¥è‡ªrustçš„ä¼˜åŒ–ï¼Œè¿™æ ·å¯ä»¥æ›´ä¸ºç›´æ¥çš„è§‚å¯Ÿ CPU çš„æ‰§è¡Œæƒ…å†µã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è¿™ä¸ªç¤ºä¾‹å¾ªç¯100äº¿æ¬¡ï¼Œæ¯æ¬¡å¾ªç¯ä¸­æ‰§è¡Œ 12 * 2 æ¬¡çš„ add æŒ‡ä»¤ï¼Œæ¯12æ¡ add æŒ‡ä»¤æ˜¯å®Œå…¨æ— ä¸Šä¸‹æ–‡ä¾èµ–çš„ï¼Œç¬¬2ç»„å¯¹ç¬¬ä¸€ç»„æœ‰ä¾èµ–ï¼Œå³æ¯éš”12æ¡æŒ‡ä»¤æœ‰ä¸Šä¸‹æ–‡ä¾èµ–ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åº¦é‡ç»“æœï¼šIPC: 3.74&lt;&#x2F;p&gt;
&lt;p&gt;æŒ‰ç…§æ¶æ„å›¾çš„è®¾è®¡ï¼ŒM1 æœ‰ 6ä¸ª ALU å•å…ƒï¼Œéƒ½å¯ä»¥æ‰§è¡Œ add æŒ‡ä»¤ï¼Œ ç†è®ºä¸Š IPC å€¼åº”è¯¥å¯ä»¥ è¾¾åˆ° 6ï¼Œä½†åªæµ‹è¯•åˆ°äº† 3.74, è¿™ä¸ªåŸå› è¿˜æœ‰å¾…åˆ†æã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;3-2-test2-ipc-1-84&quot;&gt;3.2 test2: IPC ~1.84&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;test2&lt;&#x2F;span&gt;&lt;span&gt;(){
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; base0 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1234&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; base1 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1234&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i1 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i2 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;20&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i3 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;30&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i4 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;40&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i5 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;50&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i6 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;60&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i7 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;70&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut i8 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;80&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i9 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;90&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i10 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i11 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;110&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i12 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;120&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; time0 = std::time::Instant::now();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for &lt;&#x2F;span&gt;&lt;span&gt;_ in &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;..&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100_0000_0000&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ asm! {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i1}, {i1}, {base0}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 1. loop N: instr 0 -&amp;gt; loop N - 1 : instr 12
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i2}, {i2}, {i1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 2
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i3}, {i3}, {i2}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 3
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i4}, {i4}, {i3}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 4
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i5}, {i5}, {i4}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 5
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i6}, {i6}, {i5}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 6
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i7}, {i7}, {i6}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 7
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i8}, {i8}, {i7}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 8
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i9}, {i9}, {i8}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 9
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i10}, {i10}, {i9}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 10
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i11}, {i11}, {i10}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 11
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i12}, {i12}, {i11}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 12
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i1}, {i1}, {i12}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 13
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i2}, {i2}, {i1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 14
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i3}, {i3}, {i2}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 15
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i4}, {i4}, {i3}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 16
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i5}, {i5}, {i4}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 17
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i6}, {i6}, {i5}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 18
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i7}, {i7}, {i6}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 19
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i8}, {i8}, {i7}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 20
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i9}, {i9}, {i8}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 21
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i10}, {i10}, {i9}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 22
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i11}, {i11}, {i10}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 23
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i12}, {i12}, {i11}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 24
&lt;&#x2F;span&gt;&lt;span&gt;        base0 = in(reg) base0,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; base1 = in(reg) base1,
&lt;&#x2F;span&gt;&lt;span&gt;        i1 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i1,
&lt;&#x2F;span&gt;&lt;span&gt;        i2 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i2,
&lt;&#x2F;span&gt;&lt;span&gt;        i3 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i3,
&lt;&#x2F;span&gt;&lt;span&gt;        i4 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i4,
&lt;&#x2F;span&gt;&lt;span&gt;        i5 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i5,
&lt;&#x2F;span&gt;&lt;span&gt;        i6 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i6,
&lt;&#x2F;span&gt;&lt;span&gt;        i7 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i7,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i8 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i8&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        i9 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i9,
&lt;&#x2F;span&gt;&lt;span&gt;        i10 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i10,
&lt;&#x2F;span&gt;&lt;span&gt;        i11 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i11,
&lt;&#x2F;span&gt;&lt;span&gt;        i12 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i12,
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; time1 = time0.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;elapsed&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    println!(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;test2 total time: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{:?}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;, iteration: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{:.2}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;ns&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, time1, time1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_nanos&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f64  &lt;&#x2F;span&gt;&lt;span&gt;&#x2F; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100_0000_0000.0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæ¯è½®å¾ªç¯ä¸­çš„24æ¡æŒ‡ä»¤æ˜¯æœ‰ä¸Šä¸‹æ–‡ä¾èµ–çš„ï¼Œå³æ¯æ¡æŒ‡ä»¤éƒ½ä¾èµ–äºä¸Šä¸€æ¡æŒ‡ä»¤çš„ç»“æœï¼Œç†è®ºä¸Šåªèƒ½ä¸²è¡Œæ‰§è¡Œï¼Œä½†å¾ˆå¥‡æ€ªçš„æ˜¯ï¼ŒIPC ä»ç„¶è¾¾åˆ°äº† 1.84ï¼Œ
è€Œä¸æ˜¯1ï¼Œå³æ¯ä¸ªå‘¨æœŸå†…ï¼ŒCPU ä»ç„¶æ‰§è¡Œäº†1.84æ¡æŒ‡ä»¤ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä»”ç»†åˆ†æï¼Œè™½ç„¶åœ¨æ¯ä¸ªå¾ªç¯å†…éƒ¨ï¼Œæœ‰ä¸Šä¸‹æ–‡ä¾èµ–ï¼Œä½†ä¸‹ä¸€ä¸ªå¾ªç¯çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ä»…ä¾èµ–äºä¸Šä¸€è½®å¾ªç¯çš„ç¬¬13æ¡æŒ‡ä»¤ï¼Œæ‰€ä»¥ï¼Œç†è®ºä¸Š Loop1:14 å’Œ Loop2:1 å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œ
Loop1:15 å’Œ Loop2:2 å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼ŒLoop1:24 å’Œ Loop2:11 å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œåœ¨å¤§éƒ¨ä»½æ—¶é—´èŒƒå›´å†…ï¼ŒCPU ä»ç„¶å¯ä»¥å¹¶è¡Œ2æ¡æŒ‡ä»¤ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;é‚£ä¹ˆä¸ºä»€ä¹ˆ Loop3 ä¸èƒ½åŠ å…¥åˆ°å¹¶è¡Œæ‰§è¡Œä¸­æ¥å‘¢ï¼Ÿè¿™æ ·çš„è¯ï¼ŒIPCå°±å¯ä»¥æ¥è¿‘3äº†ï¼Ÿå¯¹ç…§ M1 çš„æ¶æ„å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼šç”±äºå— ALU dispatch queue çš„é™åˆ¶ï¼Œ
ä½†å…·ä½“çš„åŸå› è¿˜æœ‰å¾…è¿›ä¸€æ­¥çš„åˆ†æã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨å¦‚æ­¤ä¸²è¡Œçš„ä»£ç ä¸­ï¼ŒIPC ä»ç„¶è¿™ä¹ˆé«˜ï¼Œå¯¹ç®€å•çš„ALUæ“ä½œï¼Œæ˜¯å¦æœ‰å¯èƒ½é™åˆ¶åˆ° 1 å‘¢ï¼Ÿå¦‚æœè®© Loop2:head ä¾èµ– Loop1:tailï¼Œç†è®ºä¸Šè¿™æ ·çš„ä»£ç å°±ä¸å¤ªå¯èƒ½
å¹¶è¡Œæ‰§è¡Œäº†ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•ä¸€ä¸‹ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;3-3-test2-1-ipc-1-0&quot;&gt;3.3 test2_1: IPC ~1.0&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;test2_1&lt;&#x2F;span&gt;&lt;span&gt;(){
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; base0 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1234&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; base1 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1234&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i1 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i2 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;20&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i3 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;30&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i4 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;40&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i5 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;50&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i6 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;60&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i7 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;70&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut i8 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;80&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i9 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;90&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i10 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i11 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;110&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i12 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;120&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; time0 = std::time::Instant::now();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for &lt;&#x2F;span&gt;&lt;span&gt;_ in &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;..&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100_0000_0000&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ asm! {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i1}, {i12}, {base0}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i2}, {i2}, {i1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i3}, {i3}, {i2}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i4}, {i4}, {i3}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i5}, {i5}, {i4}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i6}, {i6}, {i5}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i7}, {i7}, {i6}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i8}, {i8}, {i7}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i9}, {i9}, {i8}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i10}, {i10}, {i9}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i11}, {i11}, {i10}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i12}, {i12}, {i11}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i1}, {i1}, {i12}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i2}, {i2}, {i1}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i3}, {i3}, {i2}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i4}, {i4}, {i3}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i5}, {i5}, {i4}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i6}, {i6}, {i5}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i7}, {i7}, {i6}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i8}, {i8}, {i7}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i9}, {i9}, {i8}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i10}, {i10}, {i9}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i11}, {i11}, {i10}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;add {i12}, {i12}, {i11}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        base0 = in(reg) base0,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; base1 = in(reg) base1,
&lt;&#x2F;span&gt;&lt;span&gt;        i1 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i1,
&lt;&#x2F;span&gt;&lt;span&gt;        i2 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i2,
&lt;&#x2F;span&gt;&lt;span&gt;        i3 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i3,
&lt;&#x2F;span&gt;&lt;span&gt;        i4 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i4,
&lt;&#x2F;span&gt;&lt;span&gt;        i5 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i5,
&lt;&#x2F;span&gt;&lt;span&gt;        i6 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i6,
&lt;&#x2F;span&gt;&lt;span&gt;        i7 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i7,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i8 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i8&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        i9 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i9,
&lt;&#x2F;span&gt;&lt;span&gt;        i10 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i10,
&lt;&#x2F;span&gt;&lt;span&gt;        i11 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i11,
&lt;&#x2F;span&gt;&lt;span&gt;        i12 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;inout&lt;&#x2F;span&gt;&lt;span&gt;(reg) i12,
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; time1 = time0.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;elapsed&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    println!(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;test2_1 total time: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{:?}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;, iteration: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{:.2}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;ns&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, time1, time1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_nanos&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f64  &lt;&#x2F;span&gt;&lt;span&gt;&#x2F; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100_0000_0000.0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å¯¹è¿™ä¸ªå®Œå…¨é¦–å°¾ç›¸è¡”çš„ä»£ç ï¼ŒIPC çº¦ä¸ºï¼š~ 1.08ï¼Œè‡³äºä¸ºä»€ä¹ˆä»ç„¶å¤§äº1ï¼Œåº”è¯¥æ˜¯å¤„ç†å¾ªç¯çš„é¢å¤–æŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤å¯ä»¥è¢«å¹¶å‘æ‰§è¡Œï¼Œä»è€Œç¨å¾®çš„æé«˜äº† IPCã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;3-4-ru-he-shi-ipc-da-dao-zui-da-zhi-8&quot;&gt;3.4 å¦‚ä½•ä½¿ IPC è¾¾åˆ°æœ€å¤§å€¼ 8ï¼Ÿ&lt;&#x2F;h2&gt;
&lt;h2 id=&quot;3-5-li-jie-register-renaming&quot;&gt;3.5 ç†è§£ register renaming&lt;&#x2F;h2&gt;
&lt;h2 id=&quot;3-6-ce-shi-load-store-zhi-ling&quot;&gt;3.6 æµ‹è¯• load&#x2F;store æŒ‡ä»¤&lt;&#x2F;h2&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>the 1brc program</title>
        <published>2025-02-06T00:00:00+00:00</published>
        <updated>2025-02-06T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/the-1brc-program/"/>
        <id>https://wangzaixiang.github.io/blog/the-1brc-program/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/the-1brc-program/">&lt;h1 id=&quot;about-1brc&quot;&gt;About 1brc&lt;&#x2F;h1&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;gunnarmorling&#x2F;1brc&quot;&gt;1brc&lt;&#x2F;a&gt; ç¼–ç¨‹æŒ‘æˆ˜åŸæœ¬æ˜¯ä¸€ä¸ªä½¿ç”¨ Java å¤„ç† 10 äº¿è¡Œæ–‡æœ¬æ•°æ®ï¼Œå¹¶è¿›è¡Œæ±‡æ€»ç»Ÿè®¡çš„æŒ‘æˆ˜ï¼Œè¿™ä¸ªç¨‹åºçš„é€»è¾‘å¹¶ä¸å¤æ‚ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è¯»å–å¹¶åˆ†ææ–‡æœ¬æ•°æ®ï¼Œå…¶æ ¼å¼å¦‚ä¸‹ï¼š&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt; Hamburg;12.0
&lt;&#x2F;span&gt;&lt;span&gt; Bulawayo;8.9
&lt;&#x2F;span&gt;&lt;span&gt; Palembang;38.8
&lt;&#x2F;span&gt;&lt;span&gt; St. John&amp;#39;s;15.2
&lt;&#x2F;span&gt;&lt;span&gt; Cracow;12.6
&lt;&#x2F;span&gt;&lt;span&gt; Bridgetown;26.9
&lt;&#x2F;span&gt;&lt;span&gt; Istanbul;6.2
&lt;&#x2F;span&gt;&lt;span&gt; Roseau;34.4
&lt;&#x2F;span&gt;&lt;span&gt; Conakry;31.2
&lt;&#x2F;span&gt;&lt;span&gt; Istanbul;23.0
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
æ¯ä¸€è¡ŒåŒ…æ‹¬ä¸€ä¸ªåŸå¸‚åå’Œä¸€ä¸ªæ°”æ¸©æ•°å€¼ï¼Œä»¥åˆ†å·åˆ†éš”ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç»Ÿè®¡æ¯ä¸€ä¸ªåŸå¸‚çš„æœ€é«˜æ°”æ¸©ã€æœ€ä½æ°”æ¸©ã€å¹³å‡æ°”æ¸©ï¼Œå¹¶è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ç¨‹åº¦çš„æŒ‘æˆ˜åœ¨äºï¼Œéœ€è¦å¤„ç† 10äº¿ è¡Œçš„æ–‡æœ¬æ•°æ®ï¼ˆçº¦13.7GBï¼‰ï¼Œåˆ°åº•å¯ä»¥åœ¨å¤šå¿«çš„æ—¶é—´å†…å®Œæˆè¿™ä¸ªä»»åŠ¡å‘¢ï¼Ÿä¸åŒäºå…¶ä»–çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼Œä¼šé™å®šæœ‰é™çš„å†…å­˜ã€CPU ç­‰èµ„æºï¼Œ
1brc å®˜æ–¹ç»™å®šçš„è¿è¡Œç¯å¢ƒæ˜¯ 32 core AMD EPYCâ„¢ 7502P (Zen2), 128 GB RAM, è¿˜æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æœºå™¨ã€‚æœ¬æ–‡æ‰€ä½¿ç”¨çš„æ‰§è¡Œç¯å¢ƒæ˜¯ M1 Max(Macbook Pro 2021):
8æ€§èƒ½æ ¸å¿ƒï¼Œ2èŠ‚èƒ½æ ¸å¿ƒï¼Œ64GB RAMï¼Œä¹Ÿæ˜¯ä¸€æ¬¾éå¸¸å¼ºå¤§çš„æœºå™¨ã€‚è¿™ä¸ªæŒ‘æˆ˜æ˜¯åœ¨ç°ä»£CPUå’Œå……è£•çš„å†…å­˜èµ„æºä¸‹ï¼Œåˆ°åº•å¯ä»¥åœ¨å¤šå¿«çš„æ—¶é—´å†…ï¼Œå®Œæˆ10äº¿è¡Œæ–‡æœ¬æ•°æ®çš„å¤„ç†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åŸé¡¹ç›®æ˜¯ä½¿ç”¨Javaè¿›è¡ŒæŒ‘æˆ˜ï¼Œä¸è¿‡åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä¼šå°è¯•åŸºäº Rust æ¥å®Œæˆè¿™ä¸ªæŒ‘æˆ˜ï¼Œæ¯•ç«Ÿï¼ŒRust è·ç¦» CPU æ›´è¿‘ï¼Œæœ‰æ›´å¤šçš„ç©ºé—´å¯ä¾›æˆ‘ä»¬è…¾æŒªã€‚å½“ç„¶ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œä¹Ÿæ˜¯ä¸€æ¬¡
å­¦ä¹  Rust çš„æœºä¼šã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;ver1-yuan-shi-ban-ben-108s&quot;&gt;ver1: åŸå§‹ç‰ˆæœ¬ 108s&lt;&#x2F;h1&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use crate&lt;&#x2F;span&gt;&lt;span&gt;::&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MEASUREMENT_FILE&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;std::collections::HashMap;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;std::io::BufRead;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;allow&lt;&#x2F;span&gt;&lt;span&gt;(dead_code)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;ver1&lt;&#x2F;span&gt;&lt;span&gt;() -&amp;gt; Result&amp;lt;HashMap&amp;lt;String,(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;)&amp;gt;, Box&amp;lt;dyn std::error::Error&amp;gt;&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; file = std::fs::File::open(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MEASUREMENT_FILE&lt;&#x2F;span&gt;&lt;span&gt;)?;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; reader = std::io::BufReader::new(file);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;Item {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;min&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;max&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; hash: HashMap&amp;lt;String, Item&amp;gt; = std::collections::HashMap::new();
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for&lt;&#x2F;span&gt;&lt;span&gt; line in reader.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;lines&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; name;value
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; line = line?;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; parts = line.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;split&lt;&#x2F;span&gt;&lt;span&gt;(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;;&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;).collect::&amp;lt;Vec&amp;lt;&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;str&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; name = parts.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;get&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;unwrap&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; value = parts.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;get&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;unwrap&lt;&#x2F;span&gt;&lt;span&gt;().parse::&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;()?;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;match&lt;&#x2F;span&gt;&lt;span&gt; hash.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;get_mut&lt;&#x2F;span&gt;&lt;span&gt;(*name) {
&lt;&#x2F;span&gt;&lt;span&gt;            Some(item) =&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                item.count += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;                item.sum += value;
&lt;&#x2F;span&gt;&lt;span&gt;                item.min = item.min.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;min&lt;&#x2F;span&gt;&lt;span&gt;(value);
&lt;&#x2F;span&gt;&lt;span&gt;                item.max = item.max.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;max&lt;&#x2F;span&gt;&lt;span&gt;(value);
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;            None =&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; item = Item {
&lt;&#x2F;span&gt;&lt;span&gt;                    min: value,
&lt;&#x2F;span&gt;&lt;span&gt;                    max: value,
&lt;&#x2F;span&gt;&lt;span&gt;                    count: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;                    sum: value
&lt;&#x2F;span&gt;&lt;span&gt;                };
&lt;&#x2F;span&gt;&lt;span&gt;                hash.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;insert&lt;&#x2F;span&gt;&lt;span&gt;(name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_string&lt;&#x2F;span&gt;&lt;span&gt;(), item);
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; result = hash.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;iter&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span&gt;(|(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;item&lt;&#x2F;span&gt;&lt;span&gt;)| {
&lt;&#x2F;span&gt;&lt;span&gt;        (name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;clone&lt;&#x2F;span&gt;&lt;span&gt;(), (item.min, item.max, item.sum &#x2F; item.count as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;))
&lt;&#x2F;span&gt;&lt;span&gt;    }).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;collect&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    Ok( result )
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ä½œä¸ºä¸€ä¸ªåŸºç¡€ç‰ˆæœ¬ï¼Œè¿™æ®µä»£ç å¯è°“æ˜¯ä¸­è§„ä¸­çŸ©ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;BufReader&lt;&#x2F;code&gt; é€è¡Œè¯»å–æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ &lt;code&gt;split&lt;&#x2F;code&gt; åˆ†å‰²å­—ç¬¦ä¸²ã€‚ï¼ˆå¦‚æœä¸ä½¿ç”¨ BufReaderï¼Œä¼°è®¡é€Ÿåº¦è¿˜ä¼šæ…¢1ä¸ªæ•°é‡çº§ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨ HashMap æ¥å¤„ç†èšåˆæ•°æ®ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å•çº¿ç¨‹ã€‚ï¼ˆæœ¬æ¡ˆä¾‹å…¨éƒ¨åŸºäºå•çº¿ç¨‹æ¥è¿›è¡Œåˆ†æï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;æ€§èƒ½æ•°æ®ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è€—æ—¶ï¼š107.9s&lt;&#x2F;li&gt;
&lt;li&gt;IPC: 4.91 (çœ‹èµ·æ¥è¿˜å¾ˆä¸é”™)&lt;&#x2F;li&gt;
&lt;li&gt;Branch misses: 0.64%&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;mstange&#x2F;samply&quot;&gt;samply&lt;&#x2F;a&gt; profile &lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;3WMkb80&quot;&gt;link&lt;&#x2F;a&gt;:
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;the-1brc-program&#x2F;img.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;samply&lt;&#x2F;span&gt;&lt;span&gt; load profiles&#x2F;profile-v1.json  
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ç„¶åä½¿ç”¨ firefox æ‰“å¼€ http:&#x2F;&#x2F;localhost:3000 ç«¯å£å³å¯æŸ¥çœ‹ samply çš„ profile åˆ†æå›¾è¡¨
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;read_line: ~46s
&lt;ul&gt;
&lt;li&gt;fill_buf: ~2.76s è¿™é‡Œæ˜¯çœŸå®ä¸OSæ‰“äº¤é“ï¼Œè¯»å–æ–‡ä»¶å†…å®¹çš„å¼€é”€ï¼ˆçœŸå®çš„è¯»å–æ–‡ä»¶çš„å¼€é”€å¹¶ä¸é«˜ï¼Œè¿œä½äºå…¶ä»–éƒ¨åˆ†ï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;memchr: ~20.5s æ˜¯æŸ¥æ‰¾æ¢è¡Œç¬¦çš„å¼€é”€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Vec::extend_from_slice: ~12.75s æ˜¯å¤åˆ¶æ•°æ®åˆ° Vec çš„å¼€é”€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;from_utf8: ~7s, æ˜¯å¤„ç† UTF-8 çš„å¼€é”€ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;line.split(&#x27;;&#x27;).collect::&amp;lt;Vec&amp;lt;&amp;amp;str&amp;gt;&amp;gt;()&lt;&#x2F;code&gt; ~22s
&lt;ul&gt;
&lt;li&gt;Vec åˆ†é…å†…å­˜çš„æ—¶é—´ï¼š ~6.5s&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;hash.get_mut(*name)&lt;&#x2F;code&gt; ~12sï¼ŒRust çš„ HashMap é‡‡ç”¨äº† SIMD åŠ é€Ÿï¼Œæ¯”å¸¸è§„çš„ HashMap å¿«äº†å¾ˆå¤šã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Drop Vec&amp;lt;&amp;amp;str&amp;gt; ~11s: é‡Šæ”¾å†…å­˜çš„å¼€é”€å±…ç„¶è¿™ä¹ˆé«˜ï¼Œå¦‚æœå†åŠ ä¸Š Vec&#x2F;String çš„åˆ†é…å¼€é”€ï¼ˆ~13sï¼‰ï¼ŒèŠ±åœ¨å†…å­˜åˆ†é…é‡Šæ”¾ä¸Šçš„æ—¶é—´(~16s)ï¼Œä¸å®¹å°å˜˜ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Drop String ~7.7s&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;parts.get(1).unwrap().parse::&amp;lt;f32&amp;gt;()?&lt;&#x2F;code&gt; ~ 6.6sï¼Œç›®å‰è¿˜ä¸æ˜¯æˆ‘ä»¬çš„ç“¶é¢ˆç‚¹ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªåŸºçº¿ç‰ˆæœ¬å‡ºæ¥äº†ï¼Œçœ‹èµ·æ¥ï¼Œread_line æ˜¯ç›®å‰æœ€å¤§çš„ç“¶é¢ˆï¼Œå…¶ä¸­çœŸå®çš„ IO å¼€é”€å¹¶ä¸é«˜ï¼ˆæœ¬æ¬¡æµ‹è¯•çš„ç”µè„‘æœ‰64Gå†…å­˜ï¼Œå› æ­¤ï¼Œæ–‡ä»¶çš„å†…å®¹å¤§æ¦‚ç‡æ˜¯å…¨éƒ¨åœ¨ Page Cacheä¸­çš„ï¼Œ
å¹¶ä¸ä¼šæ¶‰åŠåˆ°çœŸå®çš„IOï¼Œç›®å‰æ¥çœ‹ï¼Œ2.76s è¯»å–å®Œå…¨éƒ¨æ–‡ä»¶å†…å®¹ï¼Œçœ‹èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒå¿«çš„ï¼‰ï¼Œè€ŒèŠ±åœ¨ æŸ¥æ‰¾æ¢è¡Œç¬¦ï¼Œå¤åˆ¶æ•°æ®ï¼ˆStringï¼‰ã€è§£æUTF-8ã€åˆ†é…å’Œé‡Šæ”¾å†…å­˜çš„è€—æ—¶å æ¯”å¾ˆæ¯”ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;ver2-89s&quot;&gt;ver2, 89s&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨ ver1 ä¸­ï¼Œæˆ‘ä»¬å‘ç° read_line ä¸­ &lt;code&gt;Vec::extend_from_slice&lt;&#x2F;code&gt; ä¸ŠèŠ±è´¹äº†12.75s çš„æ—¶é—´ï¼ŒåŸå› æ˜¯æˆ‘ä»¬æ¯æ¬¡è¯»å–å¹¶è¿”å›ä¸€ä¸ªæ–°è¡Œï¼ˆStringï¼‰ï¼Œå¤„ç†å®Œæˆå
å°±é‡Šæ”¾æ‰è¿™ä¸ªè¯¥å­—ç¬¦ä¸²ï¼ˆï½7.7sï¼‰ï¼Œå¦‚æœæˆ‘ä»¬ä¸é‡å¤åˆ†é…ã€é‡Šæ”¾å†…å­˜ï¼Œè€Œæ˜¯å¤ç”¨ä¸€ä¸ª String å‘¢ï¼Ÿç®€å•çš„åšå¦‚ä¸‹ä¿®æ”¹ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;ver2.rs&quot;&gt;è¯¦ç»†ä»£ç &lt;&#x2F;a&gt;ï¼š
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;the-1brc-program&#x2F;diff_ver2_ver1.png&quot; alt=&quot;diff_ver2_ver1.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æ€§èƒ½æ•°æ®ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è€—æ—¶ï¼š89.3s (-17.6s, +16.3%)&lt;&#x2F;li&gt;
&lt;li&gt;IPC: 4.57&lt;&#x2F;li&gt;
&lt;li&gt;Branch misses: 8.4%&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;4htrWrC&quot;&gt;samply profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;çœ‹èµ·æ¥ä¸é”™ï¼Œå‡ è¡Œä»£ç çš„ä¿®æ”¹ï¼Œå°±æå‡äº†16.3%çš„æ€§èƒ½ï¼ŒæŸ¥çœ‹ samply profile, è®¡åˆ’è¦æ¶ˆé™¤çš„è€—æ—¶éƒ½å¦‚é¢„æœŸçš„å‡å°‘äº†ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„æˆæœ¬ï¼Œå¹¶æ²¡æœ‰é‚£ä¹ˆçš„å»‰ä»·ï¼ˆå½“ç„¶ï¼Œè¿™ä¸ªæ¡ˆä¾‹å¯æ˜¯10äº¿æ¬¡å¾ªç¯ï¼ŒæŠŠè¿™ä¸ªæˆæœ¬ç»™æ”¾å¤§äº†ï¼‰ã€‚å¯¹äºparser å¤„ç† AST è¿™æ ·çš„åœºæ™¯ï¼Œå¤šééå†ï¼Œ
å¤§é‡çš„å°å¯¹è±¡çš„åˆ†é…å’Œé‡Šæ”¾ï¼Œè¿™ä¸ªæˆæœ¬æ˜¯éå¸¸é«˜çš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ JVM ä¸­ï¼Œå¯¹è±¡çš„åˆ†é…å’Œé‡Šæ”¾æ›´æ˜¯æ— å¤„ä¸åœ¨ï¼Œç”±äºæ²¡æœ‰ value objectï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨ heap ä¸­åˆ†é…ï¼Œè€Œæ›´é«˜æ•ˆçš„è¯­è¨€ï¼Œä¸€å®šéœ€è¦ value object,å¹¶
ä¼˜å…ˆåœ¨ stackï¼ˆor in-placeï¼‰ä¸­åˆ†é…ã€‚ç›¸æ¯” heapï¼Œ stack allocate å¯ä»¥è®¤ä¸ºæ˜¯é›¶æˆæœ¬çš„ã€‚å½“ç„¶ï¼ŒJVMçš„GCæœºåˆ¶ï¼Œå¯èƒ½ä¼šæ¯”C&#x2F;Rustç­‰è¯­è¨€åœ¨åˆ†é…&#x2F;é‡Šæ”¾å†…å­˜
ä¸Šæ›´åŠ é«˜æ•ˆï¼šä¸€æ˜¯ç”±äºå†…å­˜æ•´ç†ï¼Œé¿å…äº†ç¢ç‰‡çš„å­˜åœ¨ï¼Œåˆ†é…å†…å­˜æˆæœ¬æ›´ä½ã€‚äºŒæ˜¯å‡ ç§çš„é‡Šæ”¾ï¼Œå°¤å…¶æ˜¯åˆ†ä»£GCä¸‹å¹´è½»ä»£çš„å¤åˆ¶å›æ”¶æœºåˆ¶ï¼Œæˆæœ¬ç›¸æ¯”é€ä¸€çš„å›æ”¶ä¼šæœ‰
æ˜¾è‘—çš„æå‡ã€‚ä½†æ— è®ºå¦‚ä½•ï¼Œå¦‚æœèƒ½é¿å…åˆ†é…å’Œé‡Šæ”¾ï¼Œæ‰æ˜¯æœ€ä½³çš„é€‰æ‹©ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;ver3-65s&quot;&gt;ver3, 65s&lt;&#x2F;h1&gt;
&lt;p&gt;æ¶ˆé™¤äº† read_line çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„æˆæœ¬ï¼Œæˆ‘ä»¬çš„ç“¶é¢ˆç‚¹åˆè½¬ç§»åˆ°äº† &lt;code&gt;line.split(&#x27;;&#x27;).collect::&amp;lt;Vec&amp;lt;&amp;amp;str&amp;gt;&amp;gt;()&lt;&#x2F;code&gt; ä¸Šï¼Œè¿™ä¸ªæ“ä½œçš„æˆæœ¬æ˜¯22sï¼Œå…¶ä¸»è¦æˆæœ¬ä¹Ÿæ˜¯
èŠ±è´¹åœ¨ Iterator çš„éå†å’Œ Vec çš„åˆ†é…å’Œé‡Šæ”¾ä¸Šã€‚ç”±äºæ¯ä¸€è¡Œæ–‡æœ¬æ ¼å¼æ¯”è¾ƒç®€å•ï¼Œå› æ­¤æˆ‘ä»¬é‡æ–°ä¼˜åŒ–ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç  &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;ver3.rs&quot;&gt;ver3å®Œæ•´è¿æ¥&lt;&#x2F;a&gt;ï¼š
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;the-1brc-program&#x2F;ver2_collect.png&quot; alt=&quot;img_1.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;the-1brc-program&#x2F;ver3_code1.png&quot; alt=&quot;img_1.png&quot; &#x2F;&gt;
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;the-1brc-program&#x2F;ver3_code2.png&quot; alt=&quot;img_1.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æ€§èƒ½æ•°æ®ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è€—æ—¶ï¼š65.5s (vs ver2: -23.8s, +26.6%) (vs ver1: -42.4s, +39.4%)&lt;&#x2F;li&gt;
&lt;li&gt;IPC: 4.12&lt;&#x2F;li&gt;
&lt;li&gt;Branch misses: 0.94%&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;4hqukPN&quot;&gt;samply profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ver2&#x2F;ver3 ä¸¤è½®ä¼˜åŒ–åï¼Œåœ¨ samply profile ä¸­ï¼Œå·²ç»çœ‹åˆ°æ²¡æœ‰æ˜æ˜¾çš„å†…å­˜åˆ†é…ã€é‡Šæ”¾çš„å¼€é”€äº†ï¼Œæ€§èƒ½çš„æ•´ä½“æå‡è¾¾åˆ°äº†39.4%ã€‚ä¸ºæˆ‘ä»¬çš„ä¼˜åŒ–æˆå°±é¼“æŒã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ”¶è·ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨è¿™ä¸¤è½®çš„ä¼˜åŒ–ä¸­ï¼Œsamply çš„è´¡çŒ®æ˜¯æœ€å¤§çš„ï¼Œä»–ä¸ºæˆ‘ä»¬æä¾›äº†ç›´è§‚çš„æ€§èƒ½æ•°æ®ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¤§éƒ¨ä»½åº”ç”¨åœ¨æ—©æœŸéƒ½å­˜åœ¨â€œä½å‚â€çš„æœå®ï¼Œå¾€å¾€åªéœ€è¦è¾ƒå°‘çš„ä»£ä»·ï¼Œå°±å¯ä»¥å–å¾—å·¨å¤§çš„æ€§èƒ½æå‡ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™äº›ä½å‚çš„æœå®ï¼Œå¯èƒ½ä¼šè·å¾—æˆå€ã€
æ•°åå€çš„æ€§èƒ½æå‡ï¼Œè€Œä»£ä»·åˆ™éå¸¸å¾®å°ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;ver4-51s&quot;&gt;ver4, 51s&lt;&#x2F;h1&gt;
&lt;p&gt;å¯¹ ver3 çš„ profile æ•°æ®è¿›è¡Œåˆ†æå‘ç°ï¼Œ&amp;amp;str::from_utf8 èŠ±è´¹äº† ~9s çš„æ—¶é—´ï¼Œç”±äºæˆ‘ä»¬çš„è¾“å…¥æ–‡ä»¶æ˜¯ä¸€ä¸ªæ ¼å¼è‰¯å¥½çš„æ–‡ä»¶ï¼Œåœ¨æœ¬æ¬¡æ€§èƒ½æŒ‘æˆ˜ä¸­ï¼Œå¯ä»¥å¿½ç•¥
UTF8 æ£€æŸ¥çš„æˆæœ¬ï¼ˆå½“ç„¶ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦æƒè¡¡è¾“å…¥æ£€æŸ¥çš„å¿…è¦æ€§ï¼Œä¸ä¸€å®šèƒ½å¤Ÿå¦¥åï¼Œä¸è¿‡åœ¨ä¸€ä¸ªå¤æ‚ç³»ç»Ÿä¸­ï¼Œåº”è¯¥å°½å¯èƒ½çš„åœ¨æœ€å¤–å±‚è¿›è¡Œè¶³å¤Ÿçš„è¾“å…¥æ ¡éªŒï¼Œé¿å…åœ¨
åç»­å†…éƒ¨çš„å¤„ç†ä¸­é‡å¤çš„è¿›è¡Œæ­£ç¡®æ€§çš„æ£€æŸ¥ï¼šå³æµªè´¹äº†è®¡ç®—èµ„æºï¼Œä¹Ÿå¢åŠ äº†ä»£ç å¤æ‚æ€§ï¼Œå‚è€ƒæˆ‘åœ¨è¿™ç¯‡ &lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;complexity&#x2F;&quot;&gt;blog ä¸­æ‰€è¯´çš„ DBC&lt;&#x2F;a&gt;ï¼‰&lt;&#x2F;p&gt;
&lt;p&gt;è°ƒæ•´åçš„ä»£ç ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;ver4.rs&quot;&gt;å®Œæ•´é“¾æ¥&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;read_line&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;reader&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut &lt;&#x2F;span&gt;&lt;span&gt;std::io::BufReader&amp;lt;std::fs::File&amp;gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;line&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;&amp;#39;a mut &lt;&#x2F;span&gt;&lt;span&gt;Vec&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;) -&amp;gt; Result&amp;lt;Option&amp;lt;(&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span&gt; [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;], &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;)&amp;gt;, Box&amp;lt;dyn std::error::Error&amp;gt;&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; pos = line.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; n1 = reader.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;read_until&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;;&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, line)?;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; n1 &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; let part1 = &amp;amp;line[pos..pos+n1-1];
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; n2 = reader.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;read_until&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, line)?;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; n2 &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; part1 = &amp;amp;line[pos..pos + n1 - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;];
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; part2 = &amp;amp;line[pos + n1..pos + n1 + n2 - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;];
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; value = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; sign = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for&lt;&#x2F;span&gt;&lt;span&gt; i in part2.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;iter&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;*i == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; {
&lt;&#x2F;span&gt;&lt;span&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;continue
&lt;&#x2F;span&gt;&lt;span&gt;                } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else if &lt;&#x2F;span&gt;&lt;span&gt;*i == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;-&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; {
&lt;&#x2F;span&gt;&lt;span&gt;                    sign = -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;                } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;                    value = value * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10 &lt;&#x2F;span&gt;&lt;span&gt;+ (i - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;                }
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;            Ok(Some((part1, value * sign)))
&lt;&#x2F;span&gt;&lt;span&gt;        } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            Ok(None)
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;        Ok(None)
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;the-1brc-program&#x2F;ver4_code1.png&quot; alt=&quot;img_1.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æ€§èƒ½æ•°æ®ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è€—æ—¶ï¼š51.2s (vs ver3: -14.3s, +21.8%) (vs ver2: -38.7s, +43%) (vs ver1: -56.7s, +52.6%)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;40ObCun&quot;&gt;samply profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ç»è¿‡ ver4 çš„ä¼˜åŒ–åï¼Œsamply profile ä¸­çš„ç«ç„°å›¾å˜å¾—æ›´åŠ çš„ç®€å•ï¼Œç›®å‰ä¸»è¦çš„å¼€é”€åŒ…æ‹¬ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;std::io::BufRead::read_until&lt;&#x2F;code&gt; ~ 32s ä»¥ &lt;code&gt;, \n&lt;&#x2F;code&gt; ä½œä¸ºåˆ†éš”ç¬¦é€ä¸€è¯»å– &amp;amp;str&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;std::collections::hash::map::HashMap::get_mut&lt;&#x2F;code&gt; ~ 15s&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;ä½å‚çš„æœå®ä¼¼ä¹å·²ç»é‡‡æ‘˜å®Œæ¯•ï¼Œè¿™ä¸¤ä¸ªæ„Ÿè§‰éƒ½ä¸å¥½è¿›è¡Œè¿›ä¸€æ­¥çš„ä¼˜åŒ–äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬è¿˜èƒ½åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ&lt;&#x2F;p&gt;
&lt;h1 id=&quot;ver5-48-3s&quot;&gt;ver5, 48.3s&lt;&#x2F;h1&gt;
&lt;p&gt;è¿™ä¸ªç‰ˆæœ¬å°è¯•å¯¹ next_line è¿›è¡Œä¼˜åŒ–ï¼Œä½¿ç”¨çŠ¶æ€æœºæ¥è¿›è¡Œ one scan per line çš„å¤„ç†ï¼Œæ•ˆæœè¾ƒä¸ºæœ‰é™ï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç å’Œæ€§èƒ½æ•°æ®äº†ï¼Œ
æ„Ÿå…´è¶£çš„å¯ä»¥æŸ¥çœ‹&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;ver4.rs&quot;&gt;ver5æºä»£ç &lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;h1 id=&quot;ver6-30-9s&quot;&gt;ver6, 30.9s&lt;&#x2F;h1&gt;
&lt;p&gt;ç»è¿‡å‰é¢5è½®çš„ä¼˜åŒ–ï¼Œç›®å‰æœ€å¤§çš„ç“¶é¢ˆç‚¹æ˜¯ &lt;code&gt;std::io::read_until(b&#x27;;&#x27; or b&#x27;\n&#x27;)&lt;&#x2F;code&gt;ï¼Œè¿™é‡Œæ¶‰åŠåˆ°ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦ä½¿ç”¨ Buffer çš„æ–¹å¼ä» OS è¯»å–æ•°æ®åˆ° è¿›ç¨‹Bufferï¼ˆå›ºå®šå¤§å°ï¼Œä¸€èˆ¬ä¸º8Kï¼‰ä¸­ã€‚ ~ 3s&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ Buffer ä¸­æŸ¥æ‰¾ä¸‹ä¸€ä¸ªåˆ†éš”ç¬¦çš„ä½ç½®ã€‚ï¼ˆæ¯ä¸€è¡Œæœ‰2ä¸ªåˆ†éš”ç¬¦ï¼š&lt;code&gt;;&lt;&#x2F;code&gt; å’Œ &lt;code&gt;\n&lt;&#x2F;code&gt;) ~ 19.2s&lt;&#x2F;li&gt;
&lt;li&gt;ä» Buffer ä¸­å¤åˆ¶åˆ° Vec ä¸­ï¼ˆè¯»è€…å¯ä»¥æ€è€ƒä¸ºä»€ä¹ˆéœ€è¦è¿™æ¬¡å¤åˆ¶ï¼Œä¸ç›´æ¥åœ¨ Buffer ä¸­å¤„ç†ï¼Ÿï¼‰~ 6.7s&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æˆ‘ä»¬æ˜¯å¦å¯ä»¥é¿å…ä¸¤æ¬¡æ•°æ®å¤åˆ¶å‘¢ï¼Œå¹¶å‡å°‘æŸ¥æ‰¾åˆ†éš”ç¬¦çš„æˆæœ¬å‘¢ï¼Ÿzero copy æ˜¯è§£å†³è¿™ç±»é—®é¢˜çš„ä¸€ä¸ªæ–¹å‘ï¼Œåœ¨ Kafka ç­‰ Java é¡¹ç›®ä¸­ï¼Œä½¿ç”¨ sendfile
è¿™æ ·çš„ç³»ç»Ÿè°ƒç”¨æ¥é¿å…æ•°æ®çš„å¤åˆ¶ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;a href=&quot;https:&#x2F;&#x2F;www.man7.org&#x2F;linux&#x2F;man-pages&#x2F;man2&#x2F;mmap.2.html&quot;&gt;mmap&lt;&#x2F;a&gt; æ¥å®ç° zero copyã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use crate&lt;&#x2F;span&gt;&lt;span&gt;::&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MEASUREMENT_FILE&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;memchr::memchr;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;memmap2::Mmap;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;std::collections::HashMap;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;parse_value&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;_buf&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32 &lt;&#x2F;span&gt;&lt;span&gt;{    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ~0.5s
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; return 0;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;std::intrinsics::unlikely;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; sign = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; value = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for&lt;&#x2F;span&gt;&lt;span&gt; b in _buf {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;unlikely&lt;&#x2F;span&gt;&lt;span&gt;(*b == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;-&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;) {
&lt;&#x2F;span&gt;&lt;span&gt;            sign = -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else if &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;unlikely&lt;&#x2F;span&gt;&lt;span&gt;(*b == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;) {
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;continue&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            value = value * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10 &lt;&#x2F;span&gt;&lt;span&gt;+ (*b - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    value * sign
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;allow&lt;&#x2F;span&gt;&lt;span&gt;(dead_code)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;ver6&lt;&#x2F;span&gt;&lt;span&gt;() -&amp;gt; Result&amp;lt;HashMap&amp;lt;String, (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;)&amp;gt;, Box&amp;lt;dyn std::error::Error&amp;gt;&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; file = std::fs::File::open(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MEASUREMENT_FILE&lt;&#x2F;span&gt;&lt;span&gt;)?;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; mmap = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ Mmap::map(&amp;amp;file)? };
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; buf = mmap.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_ref&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;Item {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;min&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;max&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; hash: HashMap&amp;lt;String, Item&amp;gt; = HashMap::with_capacity(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;16384&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; let mut hash:FxHashMap&amp;lt;String, Item&amp;gt; = FxHashMap::with_capacity_and_hasher(16384, rustc_hash::FxBuildHasher::default());
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;callback &lt;&#x2F;span&gt;&lt;span&gt;= |&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;], &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;| {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;match&lt;&#x2F;span&gt;&lt;span&gt; hash.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;get_mut&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ core::str::from_utf8_unchecked(name) }) {
&lt;&#x2F;span&gt;&lt;span&gt;            Some(item) =&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                item.count += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;                item.sum += value;
&lt;&#x2F;span&gt;&lt;span&gt;                item.min = item.min.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;min&lt;&#x2F;span&gt;&lt;span&gt;(value);
&lt;&#x2F;span&gt;&lt;span&gt;                item.max = item.max.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;max&lt;&#x2F;span&gt;&lt;span&gt;(value);
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;            None =&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; item = Item {
&lt;&#x2F;span&gt;&lt;span&gt;                    min: value,
&lt;&#x2F;span&gt;&lt;span&gt;                    max: value,
&lt;&#x2F;span&gt;&lt;span&gt;                    count: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;                    sum: value
&lt;&#x2F;span&gt;&lt;span&gt;                };
&lt;&#x2F;span&gt;&lt;span&gt;                hash.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;insert&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ core::str::from_utf8_unchecked(name) }.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_string&lt;&#x2F;span&gt;&lt;span&gt;(), item);
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    };
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; _no_used = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; let mut callback = |_name: &amp;amp;[u8], value: i32| {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;     _no_used += value;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; };
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;loop &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;match &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;memchr&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;;&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;amp;buf[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;..]) { &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; scan ~14s
&lt;&#x2F;span&gt;&lt;span&gt;            Some(pos1) =&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; name = &amp;amp;buf[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;..pos1];
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; remain = &amp;amp;buf[pos1+&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;..];
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;match &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;memchr&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, remain) {
&lt;&#x2F;span&gt;&lt;span&gt;                    Some(pos2) =&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; value = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;parse_value&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;remain[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;..pos2]);
&lt;&#x2F;span&gt;&lt;span&gt;                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;callback&lt;&#x2F;span&gt;&lt;span&gt;(name, value);      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 7.5s
&lt;&#x2F;span&gt;&lt;span&gt;                        buf = &amp;amp;remain[pos2+&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;..];
&lt;&#x2F;span&gt;&lt;span&gt;                    }
&lt;&#x2F;span&gt;&lt;span&gt;                    None =&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;break&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;                    }
&lt;&#x2F;span&gt;&lt;span&gt;                }
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;            None =&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;break&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; result = hash.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;iter&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span&gt;(|(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;item&lt;&#x2F;span&gt;&lt;span&gt;)| {
&lt;&#x2F;span&gt;&lt;span&gt;        (name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_string&lt;&#x2F;span&gt;&lt;span&gt;(), (item.min as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32 &lt;&#x2F;span&gt;&lt;span&gt;&#x2F; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10.0&lt;&#x2F;span&gt;&lt;span&gt;, item.max as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32 &lt;&#x2F;span&gt;&lt;span&gt;&#x2F; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10.0&lt;&#x2F;span&gt;&lt;span&gt;, item.sum as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32 &lt;&#x2F;span&gt;&lt;span&gt;&#x2F; (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10.0 &lt;&#x2F;span&gt;&lt;span&gt;* item.count as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;)))
&lt;&#x2F;span&gt;&lt;span&gt;    }).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;collect&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    Ok(result)
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;ver6.rs&quot;&gt;ver6å®Œæ•´æºä»£ç &lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æ€§èƒ½æ•°æ®ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è€—æ—¶ï¼š31s ï¼ˆvs ver4: -20.3s, +39.6%ï¼‰ï¼ˆvs ver1: -76.9s, +71.1%ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;4hOMo5W&quot;&gt;samply profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;é‡‡ç”¨ zero copy ä¼˜åŒ–åï¼Œæˆ‘ä»¬çš„æ€§èƒ½è·å¾—äº†æ˜¾è‘—æå‡ï¼Œç›¸å¯¹äº ver1ï¼Œè€—æ—¶ç¼©çŸ­åˆ° 29%ã€‚ä» flame graph ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå·²ç»æ²¡æœ‰æ•°æ®å¤åˆ¶çš„æˆæœ¬äº†ã€‚
ç›®å‰ï¼Œæœ€å¤§çš„å‡ å—è€—æ—¶ä¸ºï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;memchr::memchr::memchr&lt;&#x2F;code&gt; ~ 3.7s&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;onebrc_rust::ver6::parse_value&lt;&#x2F;code&gt; ~ 4.87s&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;std::collections::hash::map::HashMap::get_mut&lt;&#x2F;code&gt; ~ 19.5sï¼Œ æœ‰ç‚¹å¥‡æ€ªï¼Œè¿™é‡Œçš„è€—æ—¶ç›¸æ¯”ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œåè€Œå¢åŠ äº†ã€‚è¿™ä¸ªä»¥åå†åˆ†æã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;ver7-25-5s&quot;&gt;ver7, 25.5s&lt;&#x2F;h1&gt;
&lt;p&gt;æŸ¥çœ‹ ver6 çš„ flame graphï¼Œæˆ‘ä»¬å‘ç° HashMap ä¸­æœ€å¤§çš„å¼€é”€æ˜¯ make_hash, æ¶ˆè€—äº†ï½16s çš„æ—¶é—´ï¼Œåè€Œ å…¶ä»–çš„lookup æ“ä½œ(~3s)å¹¶ä¸å¤§ï¼Œç»æŸ¥é˜…èµ„æºï¼Œ&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;https:&#x2F;&#x2F;nnethercote.github.io&#x2F;perf-book&#x2F;hashing.html&lt;&#x2F;p&gt;
&lt;p&gt;HashSet and HashMap are two widely-used types. The default hashing algorithm is not specified, but at the time of
writing the default is an algorithm called SipHash 1-3. This algorithm is high qualityâ€”it provides high protection
against collisionsâ€”but is relatively slow, particularly for short keys such as integers.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ Rust çš„å“²å­¦ä¸­ï¼ŒHashMap çš„è®¾è®¡æ˜¯ä¸ºäº†ä¿è¯é«˜è´¨é‡çš„ hashï¼Œè€Œä¸æ˜¯ä¸ºäº†é€Ÿåº¦ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æŒ‰ç…§æ–‡ä¸­çš„æ¨èï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ° &lt;a href=&quot;https:&#x2F;&#x2F;crates.io&#x2F;crates&#x2F;fxhash&quot;&gt;fxhash&lt;&#x2F;a&gt;, å®Œæ•´æºä»£ç å‚è§ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;ver7.rs&quot;&gt;ver7&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æ€§èƒ½æ•°æ®ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è€—æ—¶ï¼š25.5s (vs ver6: -5.5s, +21.5%) (vs ver1: -82.5s, +76.3%)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;4hE32Fs&quot;&gt;samply profile&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;make_hash çš„æ—¶é—´å¤§å¹…ç¼©çŸ­ï¼Œ~5.1s&lt;&#x2F;li&gt;
&lt;li&gt;lookup çš„æ—¶é—´åè€Œæå‡ï¼Œä» ~3s æå‡åˆ° ï½8.8s. è¿™ä¸ªåŸå› åç»­åˆ†æã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;åˆ‡æ¢åˆ° fxhash åï¼Œæ€§èƒ½åˆå°å¹…åº¦çš„æå‡ï¼Œè¿›å…¥åˆ° 25sï¼Œå½“ç„¶ï¼Œç›¸æ¯” ver1ï¼Œæˆ‘ä»¬å·²ç»æœ‰ 4+å€ çš„æ€§èƒ½æå‡äº†ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;ver8-23-25s&quot;&gt;ver8, 23.25s&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨ ver1 - ver7 ä¸­ï¼Œæˆ‘ä»¬éƒ½æ²¡æœ‰ä½¿ç”¨ SIMD è¿™ä¸€æŠ€æœ¯ï¼Œä» ver8 å¼€å§‹ï¼Œæˆ‘ä»¬å°†é€æ­¥å¼•å…¥ SIMD æŠ€æœ¯ã€‚å…ˆä» æŸ¥æ‰¾åˆ†éš”ç¬¦å¼€å§‹ã€‚åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œä¸€ç›´ä½¿ç”¨
&lt;code&gt;memchr&lt;&#x2F;code&gt; æˆ– read_until(å…¶å†…éƒ¨ä¹ŸåŸºäº memchr )ï¼Œå¦‚æœæŸ¥æ‰¾ crate.io çš„æ–‡æ¡£ï¼Œæˆ‘ä»¬å¾—çŸ¥ï¼Œmemchr å†…éƒ¨ä¹Ÿä¼šé‡‡ç”¨ SIMD æŠ€æœ¯è¿›è¡Œä¼˜åŒ–ï¼Œä¸è¿‡å¦‚æœé˜…è¯»
æºä»£ç ï¼Œmemchr å°½åœ¨è¾ƒå¤§çš„æ•°ç»„ä¸­ä½¿ç”¨ SIMDï¼Œè€Œå¯¹å°æ•°ç»„åˆ™ç›´æ¥éå†ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ 1brc è¿™ä¸ªæŒ‘æˆ˜èµ›ä¸­ï¼Œå¹³å‡æ¯è¡Œçš„é•¿åº¦ä¸º 13.8 å­—ç¬¦ï¼Œè€Œä¸”æ¯è¡ŒåŒ…å«2ä¸ªåˆ†éš”ç¬¦ï¼Œå› æ­¤ï¼Œmemchr å¤§éƒ¨ä»½æƒ…å†µä¸‹éƒ½æ²¡æœ‰é‡‡ç”¨ SIMD ä¼˜åŒ–ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ver1 - ver7 çš„ç‰ˆæœ¬ä¸­ï¼Œæ¯æ¬¡éƒ½æ˜¯è·å–ä¸‹ä¸€ä¸ªåˆ†éš”ç¬¦çš„ä½ç½®ï¼Œè¿™å¹¶æ²¡æœ‰å……åˆ†å‘æŒ¥ SIMD çš„æ•ˆç‡ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥ä¸€æ¬¡è¯»å–ä¸€ä¸ª block(æ¯”å¦‚64B)ï¼Œä½¿ç”¨
SIMD æŒ‡ä»¤ä¸€æ¬¡æ‰¾å‡ºå…¨éƒ¨çš„åˆ†éš”ç¬¦çš„ä½ç½®ï¼Œç„¶åå†è¿›è¡Œå¤„ç†ã€‚å¦‚æœæ˜¯ 64B çš„ Blockï¼Œå¹³å‡åŒ…å« 4.6 è¡Œçš„æ•°æ®ï¼Œå…± 9.2 ä¸ªåˆ†éš”ç¬¦ã€‚è¿™å°±ç›¸å½“äºåŸæ¥éœ€è¦
9æ¬¡ memchr çš„æ“ä½œå¯ä»¥åœ¨ å•ä¸ª SIMD æ“ä½œä¸­å®Œæˆã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;ver8.rs&quot;&gt;ver8æºä»£ç &lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;ver8&lt;&#x2F;span&gt;&lt;span&gt;() -&amp;gt; Result&amp;lt;HashMap&amp;lt;String,(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;)&amp;gt;, Box&amp;lt;dyn std::error::Error&amp;gt;&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; file = std::fs::File::open(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MEASUREMENT_FILE&lt;&#x2F;span&gt;&lt;span&gt;)?;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; mmap = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ Mmap::map(&amp;amp;file)? };
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; buf = mmap.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_ref&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;Item {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;min&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;max&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; let mut hash = HashMap::with_capacity_and_hasher(16384, fasthash::spooky::Hash64);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; hash:FxHashMap&amp;lt;String, Item&amp;gt; = FxHashMap::with_capacity_and_hasher(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;16384&lt;&#x2F;span&gt;&lt;span&gt;, rustc_hash::FxBuildHasher::default());
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; let mut sum = 0;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;callback &lt;&#x2F;span&gt;&lt;span&gt;= |&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;], &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16&lt;&#x2F;span&gt;&lt;span&gt;| {  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ~13.5s 60%
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;match&lt;&#x2F;span&gt;&lt;span&gt; hash.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;get_mut&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ core::str::from_utf8_unchecked(name) }) {
&lt;&#x2F;span&gt;&lt;span&gt;            Some(item) =&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                item.count += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;                item.sum += value as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;                item.min = item.min.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;min&lt;&#x2F;span&gt;&lt;span&gt;(value);
&lt;&#x2F;span&gt;&lt;span&gt;                item.max = item.max.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;max&lt;&#x2F;span&gt;&lt;span&gt;(value);
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;            None =&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; item = Item {
&lt;&#x2F;span&gt;&lt;span&gt;                    min: value,
&lt;&#x2F;span&gt;&lt;span&gt;                    max: value,
&lt;&#x2F;span&gt;&lt;span&gt;                    count: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;                    sum: value as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;                };
&lt;&#x2F;span&gt;&lt;span&gt;                hash.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;insert&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ core::str::from_utf8_unchecked(name) }.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_string&lt;&#x2F;span&gt;&lt;span&gt;(), item);
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    };
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; v01 = u8x64::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;;&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; v02 = u8x64::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;enum &lt;&#x2F;span&gt;&lt;span&gt;State {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;BEGIN&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;POS1
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; state2: State = State::&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;BEGIN&lt;&#x2F;span&gt;&lt;span&gt;;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; BEGIN, POS1
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; line_begin: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; always valid
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; pos1: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; when state2 is POS1
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; cursor: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; if block_is_tail, cursor can scroll forward, otherwise, cursor is always the head of the block
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; block_is_tail: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;bool &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; simd_mask: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= {      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; when block_is_tail == false, simd_mask is the search mask
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; v1: u8x64 = u8x64::from_slice(buf);        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 64 bytes
&lt;&#x2F;span&gt;&lt;span&gt;        (v1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_eq&lt;&#x2F;span&gt;&lt;span&gt;(v01) | v1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_eq&lt;&#x2F;span&gt;&lt;span&gt;(v02)).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;()
&lt;&#x2F;span&gt;&lt;span&gt;    };
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;loop &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; pos: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;=  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;loop &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;likely&lt;&#x2F;span&gt;&lt;span&gt;(block_is_tail == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;) {    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 1. simd_block
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; first = simd_mask.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;trailing_zeros&lt;&#x2F;span&gt;&lt;span&gt;(); &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 0..64
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;likely&lt;&#x2F;span&gt;&lt;span&gt;(first &amp;lt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;64&lt;&#x2F;span&gt;&lt;span&gt;) {  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 1.1 having a match
&lt;&#x2F;span&gt;&lt;span&gt;                    simd_mask &amp;amp;= !(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&amp;lt; first);
&lt;&#x2F;span&gt;&lt;span&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;break&lt;&#x2F;span&gt;&lt;span&gt; cursor + first as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; break result 1: from simd_block
&lt;&#x2F;span&gt;&lt;span&gt;                } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 1.2 load next block and continue loop
&lt;&#x2F;span&gt;&lt;span&gt;                    cursor += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;likely&lt;&#x2F;span&gt;&lt;span&gt;(cursor + &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;64 &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;= buf.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;()) { &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 1.2.1 load next u8x64 block
&lt;&#x2F;span&gt;&lt;span&gt;                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; v1 = u8x64::from_slice(&amp;amp;buf[cursor..cursor + &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;64&lt;&#x2F;span&gt;&lt;span&gt;]);
&lt;&#x2F;span&gt;&lt;span&gt;                        simd_mask = (v1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_eq&lt;&#x2F;span&gt;&lt;span&gt;(v01) | v1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_eq&lt;&#x2F;span&gt;&lt;span&gt;(v02)).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;                    } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 1.2.2 load the tail block
&lt;&#x2F;span&gt;&lt;span&gt;                        block_is_tail = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;                    }
&lt;&#x2F;span&gt;&lt;span&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;continue&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;                }
&lt;&#x2F;span&gt;&lt;span&gt;            } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 2. tail block
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;match &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;memchr2&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;;&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;amp;buf[cursor..]) {
&lt;&#x2F;span&gt;&lt;span&gt;                    Some(index) =&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; result = cursor + index;
&lt;&#x2F;span&gt;&lt;span&gt;                        cursor += index + &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;break&lt;&#x2F;span&gt;&lt;span&gt; result;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; break result 2: from tail block
&lt;&#x2F;span&gt;&lt;span&gt;                    }
&lt;&#x2F;span&gt;&lt;span&gt;                    None =&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                        unreachable!(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;tail block should always have a match&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;);
&lt;&#x2F;span&gt;&lt;span&gt;                    }
&lt;&#x2F;span&gt;&lt;span&gt;                }
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;        };
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;match&lt;&#x2F;span&gt;&lt;span&gt; state2 {
&lt;&#x2F;span&gt;&lt;span&gt;            State::&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;BEGIN &lt;&#x2F;span&gt;&lt;span&gt;=&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                pos1 = pos;
&lt;&#x2F;span&gt;&lt;span&gt;                state2 = State::&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;POS1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;            State::&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;POS1 &lt;&#x2F;span&gt;&lt;span&gt;=&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; pos2 = pos;
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;callback&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;buf[line_begin..pos1], &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;parse_value&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;buf[pos1+&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;..pos2]));
&lt;&#x2F;span&gt;&lt;span&gt;                state2 = State::&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;BEGIN&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;                line_begin = pos2 + &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;unlikely&lt;&#x2F;span&gt;&lt;span&gt;( pos + &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;== buf.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() ) {
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;break&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; result = hash.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;iter&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span&gt;(|(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;item&lt;&#x2F;span&gt;&lt;span&gt;)| {
&lt;&#x2F;span&gt;&lt;span&gt;        (name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;clone&lt;&#x2F;span&gt;&lt;span&gt;(), (item.min as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;&#x2F; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10.0&lt;&#x2F;span&gt;&lt;span&gt;, item.max as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32 &lt;&#x2F;span&gt;&lt;span&gt;&#x2F; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10.0&lt;&#x2F;span&gt;&lt;span&gt;, item.sum as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32 &lt;&#x2F;span&gt;&lt;span&gt;&#x2F; item.count as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32 &lt;&#x2F;span&gt;&lt;span&gt;&#x2F; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10.0&lt;&#x2F;span&gt;&lt;span&gt;))
&lt;&#x2F;span&gt;&lt;span&gt;    }).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;collect&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    Ok(result)
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;æ€§èƒ½æ•°æ®ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è€—æ—¶: 23.25s (vs ver7: -2.25s, +9.2%) (vs ver1: -84.65s, +78.3%)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;3Er2Afo&quot;&gt;samply profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å¯¹æ¯”ver7, æœ‰å°å¹…åº¦æå‡ï¼ˆè¿™æ˜¯å› ä¸º v7 ä¸­ memchr çš„è€—æ—¶ä¹Ÿåªæœ‰ 3s, å¹¶ä¸å¤§ï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åˆ‡æ¢æˆ SIMD å¤„ç†åï¼Œä»£ç ç¨å¾®åˆäº›å¤æ‚ï¼Œè¿™æ˜¯å› ä¸ºåœ¨æ€§èƒ½ä¼˜åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¼šäº§ç”Ÿè¶Šæ¥è¶Šå¤šçš„â€è‡ªæˆ‘æ§åˆ¶â€œæ„Ÿï¼Œä»¥é¿å…ç¼–è¯‘æœŸç”Ÿæˆä¸ä½³çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨
å¾ˆå¤šæƒ…å†µä¸‹ï¼Œé«˜æ€§èƒ½çš„ä»£ç ä¸ zero cost abstraction æ˜¯æœ‰çŸ›ç›¾çš„ã€‚å½“ç„¶ï¼Œåé¢æˆ‘ä»¬ä¹Ÿä¼šçœ‹åˆ°ï¼Œè¿™ç§æ„Ÿè§‰å¹¶ä¸å¯é ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œç°ä»£ç¼–è¯‘æœŸè¶³ä»¥ç”Ÿæˆé«˜æ•ˆçš„
ä»£ç ï¼Œå¹¶ä¸”æ— æ‚–äº zero cost abstractionã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;ver9-23-76s&quot;&gt;ver9, 23.76s&lt;&#x2F;h1&gt;
&lt;p&gt;ver9 æ˜¯åœ¨ ver8 çš„åŸºç¡€ä¸Šï¼Œå¯¹ parse_value è¿›è¡Œä¼˜åŒ–ï¼Œä½¿ç”¨ SIMD æŒ‡ä»¤è¿›è¡Œä¼˜åŒ–ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;parse_value&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;buf&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16 &lt;&#x2F;span&gt;&lt;span&gt;{    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ~0.5s
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; return 0;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; scale = u16x4::from_array( [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;] );
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; sign = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; buf[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;] == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;-&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; {-&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16&lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; offset = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; buf[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;] == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;-&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; {&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; v1 = {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; buf = &amp;amp;buf[offset..];
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; arr: [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;] = [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;];
&lt;&#x2F;span&gt;&lt;span&gt;        arr[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;- buf.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;()..].&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;copy_from_slice&lt;&#x2F;span&gt;&lt;span&gt;(buf);
&lt;&#x2F;span&gt;&lt;span&gt;        u16x4::from_array( [ arr[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;4&lt;&#x2F;span&gt;&lt;span&gt;] as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u16&lt;&#x2F;span&gt;&lt;span&gt;, arr[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span&gt;] as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u16&lt;&#x2F;span&gt;&lt;span&gt;, arr[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;6&lt;&#x2F;span&gt;&lt;span&gt;] as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u16&lt;&#x2F;span&gt;&lt;span&gt;, arr[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;7&lt;&#x2F;span&gt;&lt;span&gt;] as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u16 &lt;&#x2F;span&gt;&lt;span&gt;] )
&lt;&#x2F;span&gt;&lt;span&gt;    };
&lt;&#x2F;span&gt;&lt;span&gt;    ((v1 - u16x4::splat(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u16&lt;&#x2F;span&gt;&lt;span&gt;))  * scale).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;reduce_sum&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16 &lt;&#x2F;span&gt;&lt;span&gt;* sign
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;ver9.rs&quot;&gt;ver9å®Œæ•´æºä»£ç &lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æ€§èƒ½æ•°æ®ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è€—æ—¶ï¼š23.76s (vs ver8: +0.51s, -2.1%) (vs ver1: -84.14s, +78.1%)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;3EtGoRX&quot;&gt;samply profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å¯¹ parse_value è¿›è¡Œ SIMD ä¼˜åŒ–å¹¶æ²¡æœ‰è¾¾åˆ°é¢„æœŸçš„ç»“æœã€‚æˆ‘ä»¬ç»§ç»­å‰è¡Œã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;ver10-27-10s&quot;&gt;ver10, 27.10s&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨ ver9 çš„ç«ç„°å›¾ä¸Šï¼Œå½“å‰æœ€å¤§çš„å¼€é”€æ˜¯ &lt;code&gt;std::collections::hash::map::HashMap::get_mut&lt;&#x2F;code&gt;(~11.7s), ver10 å°è¯•ä½¿ç”¨ä¸€ä¸ªæ›¿ä»£çš„ HashMap
æ–¹æ¡ˆï¼Œæ¥å‡å°‘ hash çš„è®¡ç®—å¼€é”€å’Œ lookup çš„å¼€é”€ï¼Œä¸è¿‡ï¼Œè¿™ä¸ªç‰ˆæœ¬å¹¶æ²¡æœ‰è¾¾åˆ°é¢„æœŸçš„æ•ˆæœã€‚ è¿™é‡Œå°±ä¸åˆ†æäº†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;ver10.rs&quot;&gt;ver10æºä»£ç &lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;h1 id=&quot;ver12-13-07s&quot;&gt;ver12ï¼Œ13.07s&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨ ver10 ä¸­ï¼Œæˆ‘ä»¬å°è¯•è‡ªå»ºä¸€ä¸ªæ›¿ä»£çš„ HashMapï¼ŒåŸºæœ¬çš„æ–¹å‘æ˜¯å°† city_name æ˜ å°„ä¸º integer, ç„¶åä½¿ç”¨ä¸€ä¸ªç¨€ç–çš„ Vec æ¥å­˜å‚¨ key-valueï¼Œ
åœ¨ ver10 ä¸­å°è¯•æ˜¯å¤±è´¥çš„ï¼Œä¸»è¦æ˜¯ HashMap çš„ Miss æ¯”ä¾‹è¿‡é«˜ï¼ˆ50%ï¼‰,å³æœ‰50%çš„ key éƒ½éœ€è¦è¿›è¡Œéƒ½å¤šä½™1æ¬¡çš„æŸ¥æ‰¾ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨ ver12 ä¸­ï¼Œæˆ‘ä»¬ç»§ç»­ä¼˜åŒ–æ•°æ®ç»“æ„ï¼Œå°è¯•å°† flame graph ä¸­ç›®å‰æœ€å¤§çš„å¼€é”€ &lt;code&gt;std::collections::hash::map::HashMap::get_mut&lt;&#x2F;code&gt;(~11.7s)
é™ä¸‹æ¥ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¼˜åŒ–åçš„ç®—æ³•ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å°† city_name æ˜ å°„ä¸º i128, å³ä»…å– city_name çš„æœ€å¤š16å­—èŠ‚ä½œä¸º keyã€‚ï¼ˆæœ‰äº›å–å·§ï¼Œåœ¨æµ‹è¯•ä¸­ï¼Œæ‰€æœ‰çš„city name æˆªå–å‰16ä¸ªå­—èŠ‚æ—¶ï¼Œæ˜¯æ²¡æœ‰
é‡å¤çš„ã€‚ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨å¦‚ä¸‹ç®—æ³•å°† i128 æ˜ å°„ä¸º i20:&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_a: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64 &lt;&#x2F;span&gt;&lt;span&gt;= ??? &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ä½64ä½
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_b: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64 &lt;&#x2F;span&gt;&lt;span&gt;= ??? &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; é«˜64ä½
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; hash = { &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; b[0..19] ^ b[20..39] ^ b[40..59] ^ b[64..83] ^ b[84..103] ^ b[104..123]
&lt;&#x2F;span&gt;&lt;span&gt;         &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; p0 = key_a &amp;amp; mask;
&lt;&#x2F;span&gt;&lt;span&gt;         &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; p1 = (key_a &amp;gt;&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;20&lt;&#x2F;span&gt;&lt;span&gt;) &amp;amp; mask;
&lt;&#x2F;span&gt;&lt;span&gt;         &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; p2 = (key_a &amp;gt;&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;40&lt;&#x2F;span&gt;&lt;span&gt;) &amp;amp; mask;
&lt;&#x2F;span&gt;&lt;span&gt;         &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; p3 = key_b &amp;amp; mask;
&lt;&#x2F;span&gt;&lt;span&gt;         &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; p4 = (key_b &amp;gt;&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;20&lt;&#x2F;span&gt;&lt;span&gt;) &amp;amp; mask;
&lt;&#x2F;span&gt;&lt;span&gt;         &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; p5 = (key_b &amp;gt;&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;40&lt;&#x2F;span&gt;&lt;span&gt;) &amp;amp; mask;
&lt;&#x2F;span&gt;&lt;span&gt;         p0 ^ p1 ^ p2 ^ p3 ^ p4 ^ p5
&lt;&#x2F;span&gt;&lt;span&gt;     };
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;åˆ†é…ä¸€ä¸ª 2^20 + 1024 çš„ Vec&lt;AggrItem&gt;, å…¶ä¸­: AggrItem æ˜¯æ¯ä¸€ä¸ªæ±‡æ€»é¡¹ï¼ˆå ç”¨56å­—èŠ‚å¤§å°ï¼‰&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;AggrItem {
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;key_a&lt;&#x2F;span&gt;&lt;span&gt;:  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 32
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;key_b&lt;&#x2F;span&gt;&lt;span&gt;:  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 40
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;key&lt;&#x2F;span&gt;&lt;span&gt;: Vec&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;,    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 24
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;min&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16&lt;&#x2F;span&gt;&lt;span&gt;,       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 42
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;max&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16&lt;&#x2F;span&gt;&lt;span&gt;,       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 44
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 48
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;,       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 52
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;æ ¹æ® city_name è®¡ç®— 128ä½çš„ key å€¼ï¼Œå¹¶ä½¿ç”¨ä¸Šè¿°çš„ hash ç®—æ³•ï¼Œè®¡ç®— hash å€¼(0 - 2^20-1), ç„¶åä½¿ç”¨è¯¥ hash å€¼ç›´æ¥è®¿é—®æ•°ç»„
&lt;ul&gt;
&lt;li&gt;ç”±äºå¯èƒ½å­˜åœ¨é‡å¤çš„ hash å€¼ï¼Œå› æ­¤ï¼Œéœ€è¦æ¯”è¾ƒ key å€¼æ˜¯å¦ä¸€è‡´ï¼Œä¸€è‡´åˆ™å‘½ä¸­ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸å‘½ä¸­åˆ™æœç´¢æ•°ç»„ä¸­çš„ä¸‹ä¸€é¡¹ï¼Œç›´åˆ° hash å€¼ç›¸åŒ&lt;&#x2F;li&gt;
&lt;li&gt;æœ€å¤šæœç´¢1024æ¬¡ï¼Œå¦åˆ™ç›´æ¥æŠ¥é”™ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è®¾è®¡è¿™ä¸ªç®—æ³•çš„åŸå› æ˜¯ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;1brc æŒ‘æˆ˜çš„æ•°æ®é›†ä¸­ï¼Œå…±æœ‰443ä¸ªåŸå¸‚ï¼Œcity_name é•¿åº¦ä¸º 3..33ï¼Œé€‰å–å‰16ä¸ªå­—ç¬¦æ—¶ï¼Œå³å¯ä¿è¯å”¯ä¸€æ€§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è®¾è®¡ä¸€ä¸ªåŒ…å« 1M å¤§å°çš„ HashMapï¼Œå¹¶é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„ hash ç®—æ³•ï¼Œå¯ä»¥ç¡®ä¿è¯¥ HashMap çš„ç¨€ç–æ€§ï¼Œç»å¤§éƒ¨åˆ†çš„ city åº”è¯¥å”¯ä¸€å‘½ä¸­æŸä¸ª slot è€Œæ— éœ€
éå†ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨ i128 ä½œä¸º key çš„å”¯ä¸€æ€§ï¼Œé¿å…äº†è¿›è¡Œå­—ç¬¦ä¸²æ¯”è¾ƒçš„å¼€é”€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸Šè¿°çš„ hash ç®—æ³•ï¼Œæ˜¯ç®€å•çš„æ•°å­¦è¿ç®—ï¼Œç›¸æ¯”å­—ç¬¦ä¸²è®¡ç®— hash è¦å¿«æ·å¾ˆå¤šï¼ˆä¸”ä¸æ¶‰åŠå†…å­˜è®¿é—®ï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;ver12.rs&quot;&gt;ver12 å®Œæ•´æºä»£ç &lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æ€§èƒ½æ•°æ®:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è€—æ—¶ï¼š 13.07s (vs ver9: -10.69s, +45.1%) (vs ver1: -93.83s, +87.1%)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;414vPNO&quot;&gt;samply profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;éå¸¸å¯å–œçš„çªç ´ï¼Œé€šè¿‡ç‹¬ç‰¹è®¾è®¡çš„ HashMapï¼Œæˆ‘ä»¬è·å¾—äº†æ¯”ä½¿ç”¨ &lt;code&gt;std::collections::hash::map::HashMap&lt;&#x2F;code&gt; å¿«å¾—å¤šçš„æ€§èƒ½ï¼ŒåŸæ¥ HashMap 11.7s çš„å¼€é”€
é™ä½åˆ°äº† 2 sï¼Œæ›´è®©æˆ‘ä»¬çš„ç¨‹åºç›¸æ¯” ver1 æé«˜äº† 8+ å€çš„æ€§èƒ½æå‡ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ç°åœ¨ï¼Œä¸»è¦çš„è€—æ—¶ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å¤„ç†åˆ†éš”ç¬¦ï¼š~3.15s&lt;&#x2F;li&gt;
&lt;li&gt;parse_value ï½4.7s&lt;&#x2F;li&gt;
&lt;li&gt;hash aggregate: ~2.4s&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;è¿˜å¯ä»¥è¿›è¡Œå“ªäº›ä¼˜åŒ–å‘¢ï¼Ÿ&lt;&#x2F;p&gt;
&lt;h1 id=&quot;ver13-9-12s&quot;&gt;ver13, 9.12s&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨ver9 ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ SIMD ä¼˜åŒ–äº† parse_valueï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¾¾åˆ°é¢„æœŸçš„æ•ˆæœï¼Œå¦‚æœæˆ‘ä»¬å°†å¤šè¡Œçš„ value æ”¾åˆ°ä¸€èµ·æ¥ä½¿ç”¨ SIMD å‘¢ï¼Ÿå¦å¤–ï¼Œloop unroll
ä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„ä¼˜åŒ–æ‰‹æ®µï¼Œåœ¨æˆ‘ä»¬å‰é¢çš„ç‰ˆæœ¬ä¸­ï¼Œæ¯æ¬¡å¾ªç¯éƒ½æ˜¯å¤„ç†1è¡Œï¼Œè€Œæˆ‘ä»¬ç°åœ¨çš„ç‰ˆæœ¬å·²ç»æ¯æ¬¡è¯»å– 64 å­—èŠ‚çš„ blockï¼Œä½¿ç”¨ SIMD æ¥è¿›è¡Œåˆ†éš”ç¬¦æ£€æµ‹ï¼Œ
é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•æŠŠä¸€ä¸ª block ä¸­çš„å¤šè¡Œæ•°æ®æ”¾åˆ°ä¸€èµ·æ¥å¤„ç†ã€‚æ ¹æ®ä¸Šé¢çš„æ•°æ®åˆ†æï¼Œæ¯ä¸ªblock åŒ…å« 1-8 è¡Œæ•°æ®ï¼Œå¹³å‡ä¸º 4.6 è¡Œã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;parse_values&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;val1&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;], &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;val2&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;], &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;val3&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;], &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;val4&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; pad_1 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;- val1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;isize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; pad_2 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;- val2.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;isize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; pad_3 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;- val3.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;isize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; pad_4 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;- val4.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;isize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; ptr1 = val1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_ptr&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;offset&lt;&#x2F;span&gt;&lt;span&gt;( -pad_1);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; ptr2 = val2.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_ptr&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;offset&lt;&#x2F;span&gt;&lt;span&gt;(-pad_2);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; ptr3 = val3.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_ptr&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;offset&lt;&#x2F;span&gt;&lt;span&gt;(-pad_3);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; ptr4 = val4.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_ptr&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;offset&lt;&#x2F;span&gt;&lt;span&gt;(-pad_4);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; l1 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::from_be_bytes( *(ptr1 as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;]) );
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; l2 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::from_be_bytes( *(ptr2 as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;]) );
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; l3 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::from_be_bytes( *(ptr3 as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;]) );
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; l4 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::from_be_bytes( *(ptr4 as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;]) );
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; clear top pad_1 * 8 bits of l1
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; l1 = l1 &amp;amp; (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MAX &lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;&amp;gt; (pad_1 * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;));
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; l2 = l2 &amp;amp; (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MAX &lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;&amp;gt; (pad_2 * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;));
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; l3 = l3 &amp;amp; (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MAX &lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;&amp;gt; (pad_3 * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;));
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; l4 = l4 &amp;amp; (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MAX &lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;&amp;gt; (pad_4 * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;));
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; sign_1 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; val1[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;] == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;-&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; { -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; sign_2 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; val2[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;] == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;-&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; { -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; sign_3 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; val3[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;] == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;-&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; { -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; sign_4 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; val4[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;] == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;-&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; { -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; v: u32x4 = u32x4::from_array([l1 as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;, l2 as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;, l3 as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;,  l4 as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;]);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; v2: i8x16 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;transmute&lt;&#x2F;span&gt;&lt;span&gt;(v);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; v2  = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;extend_i8x16&lt;&#x2F;span&gt;&lt;span&gt;(v2) };
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; let v2: i16x32 = simd_swizzle!(v2, [7, 6, 5, 4, 3, 2, 1, 0, 15, 14, 13, 12, 11, 10, 9, 8, 23, 22, 21, 20, 19, 18, 17, 16, 31, 30, 29, 28, 27, 26, 25, 24]);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; scale: i16x16 = i16x16::from_array([ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100 &lt;&#x2F;span&gt;&lt;span&gt;] );
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; mask = v2.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ge&lt;&#x2F;span&gt;&lt;span&gt;(i16x16::splat(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16&lt;&#x2F;span&gt;&lt;span&gt;));
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; v2 = mask.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;(v2, i16x16::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16&lt;&#x2F;span&gt;&lt;span&gt;));
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; sub = v2 - i16x16::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16&lt;&#x2F;span&gt;&lt;span&gt;);      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; (c - &amp;#39;0&amp;#39;)
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; mul = sub * scale;                                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; (c - &amp;#39;0&amp;#39;) * scale
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; mul_2 = mul.rotate_elements_right::&amp;lt;2&amp;gt;();       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 100 + 0, 10 + 1
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; sum = mul + mul_2;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; sum_2 = sum.rotate_elements_right::&amp;lt;1&amp;gt;();       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 100 + 0 + 10 + 1
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; sum = sum + sum_2;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; array: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i16&lt;&#x2F;span&gt;&lt;span&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;16&lt;&#x2F;span&gt;&lt;span&gt;] = &amp;amp; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;transmute&lt;&#x2F;span&gt;&lt;span&gt;(sum);
&lt;&#x2F;span&gt;&lt;span&gt;    (sign_1 * array[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3&lt;&#x2F;span&gt;&lt;span&gt;], sign_2 * array[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;7&lt;&#x2F;span&gt;&lt;span&gt;], sign_3 * array[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;11&lt;&#x2F;span&gt;&lt;span&gt;], sign_4 * array[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;15&lt;&#x2F;span&gt;&lt;span&gt;])
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;FileReader {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;_mmap&lt;&#x2F;span&gt;&lt;span&gt;: Mmap,         &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; const
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;length&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;,      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; const
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;buf&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const u8&lt;&#x2F;span&gt;&lt;span&gt;,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; const
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;eof&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;bool&lt;&#x2F;span&gt;&lt;span&gt;,          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; has more content
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cursor&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;,      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; read_more will update, å½“å‰è¯»å–ä½ç½®ï¼Œå·²è¯»å–å¹¶åˆ†æç»“æœä¿å­˜åœ¨ mask ä¸­
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;mask&lt;&#x2F;span&gt;&lt;span&gt;:   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;,        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; read_more will set, next will clear
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;line_begin&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;,    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; next will updateï¼Œä¸‹ä¸€è¡Œçš„å¼€å§‹ä½ç½®
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;impl &lt;&#x2F;span&gt;&lt;span&gt;FileReader {
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;new&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;mmap&lt;&#x2F;span&gt;&lt;span&gt;: Mmap) -&amp;gt; FileReader {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; length = mmap.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; buf = mmap.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_ptr&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; u8x64 = u8x64::from_array( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ *( buf as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;64&lt;&#x2F;span&gt;&lt;span&gt;]) } );
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; mask_v1: u8x64 = u8x64::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;;&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; mask_v2: u8x64 = u8x64::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; mask: Mask&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i8&lt;&#x2F;span&gt;&lt;span&gt;, 64&amp;gt; = u8x64.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_eq&lt;&#x2F;span&gt;&lt;span&gt;(mask_v1) | u8x64.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_eq&lt;&#x2F;span&gt;&lt;span&gt;(mask_v2);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; mask = mask.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        FileReader {
&lt;&#x2F;span&gt;&lt;span&gt;            _mmap: mmap,
&lt;&#x2F;span&gt;&lt;span&gt;            length,
&lt;&#x2F;span&gt;&lt;span&gt;            buf,
&lt;&#x2F;span&gt;&lt;span&gt;            eof: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;            cursor: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;            mask,
&lt;&#x2F;span&gt;&lt;span&gt;            line_begin: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    #[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;read_block_at_cursor&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; change to unlikely fastup from 11.5s ~ 6.65s
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;unlikely&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.mask == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;) {    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; need more
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.cursor += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;likely&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.cursor + &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;64 &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.length) {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; mask_v1: u8x64 = u8x64::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;;&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;);
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; mask_v2: u8x64 = u8x64::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; u8x64 = u8x64::from_array( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ *( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.buf.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;add&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.cursor) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;64&lt;&#x2F;span&gt;&lt;span&gt;]) } );
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; mask: Mask&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i8&lt;&#x2F;span&gt;&lt;span&gt;, 64&amp;gt; = u8x64.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_eq&lt;&#x2F;span&gt;&lt;span&gt;(mask_v1) | u8x64.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_eq&lt;&#x2F;span&gt;&lt;span&gt;(mask_v2);
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.mask = mask.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;read_last_block&lt;&#x2F;span&gt;&lt;span&gt;();      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    #[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;read_last_block&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; ptr = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.buf.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;add&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.cursor) };
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.length - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.cursor;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; maybe zero
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; slice = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ std::slice::from_raw_parts(ptr, count) };
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; base = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;loop &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; base &amp;gt;= count {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;break&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;match &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;memchr2&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;;&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &amp;amp;slice[base..]) {
&lt;&#x2F;span&gt;&lt;span&gt;                Some(index) =&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.mask |= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&amp;lt; (base+index);
&lt;&#x2F;span&gt;&lt;span&gt;                    base += index+&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;                }
&lt;&#x2F;span&gt;&lt;span&gt;                _ =&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;                    panic!(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;tail block should always have a match&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;);
&lt;&#x2F;span&gt;&lt;span&gt;                }
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.eof = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; TODO wrongs for the last line
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;next&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;) -&amp;gt; Option&amp;lt;(&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;&amp;#39;static&lt;&#x2F;span&gt;&lt;span&gt; [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;], &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;&amp;#39;static&lt;&#x2F;span&gt;&lt;span&gt; [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;])&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;likely&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.eof == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;read_block_at_cursor&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; first = {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; index = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.mask.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;trailing_zeros&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.mask &amp;amp;= !(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&amp;lt; index);
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.cursor + index as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize
&lt;&#x2F;span&gt;&lt;span&gt;            };
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;read_block_at_cursor&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; second = {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; index = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.mask.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;trailing_zeros&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.mask &amp;amp;= !(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&amp;lt; index);
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.cursor + index as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize
&lt;&#x2F;span&gt;&lt;span&gt;            };
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;] = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ std::slice::from_raw_parts(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.buf.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;add&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.line_begin), first - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.line_begin) };
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; value: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;] = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ std::slice::from_raw_parts(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.buf.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;add&lt;&#x2F;span&gt;&lt;span&gt;(first + &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;), second - first - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;) };
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; result = (key, value);
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;.line_begin = second + &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            Some(result)
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            None
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;...
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; based on ver12
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;ver13&lt;&#x2F;span&gt;&lt;span&gt;() -&amp;gt; Result&amp;lt;HashMap&amp;lt;String,(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;)&amp;gt;, Box&amp;lt;dyn std::error::Error&amp;gt;&amp;gt; {     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 8.96s
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; file = std::fs::File::open(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MEASUREMENT_FILE&lt;&#x2F;span&gt;&lt;span&gt;)?;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; mmap = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ Mmap::map(&amp;amp;file)? };
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; reader = FileReader::new(mmap);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; aggr = AggrInfo::new();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;loop &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; r1 = reader.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;next&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; r2 = reader.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;next&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; r3 = reader.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;next&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; r4 = reader.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;next&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;likely&lt;&#x2F;span&gt;&lt;span&gt;(r4.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;is_some&lt;&#x2F;span&gt;&lt;span&gt;()) {
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span&gt;Some((r1_name, r1_value)) = r1 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ unreachable!() };
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span&gt;Some((r2_name, r2_value)) = r2 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ unreachable!() };
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span&gt;Some((r3_name, r3_value)) = r3 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ unreachable!() };
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span&gt;Some((r4_name, r4_value)) = r4 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ unreachable!() };
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; ptr1 = r1_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_ptr&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_a_1: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::from_le_bytes( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ *(ptr1 as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;]) });
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_b_1: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::from_le_bytes( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ *(ptr1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;add&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;]) });
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; ptr2 = r2_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_ptr&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_a_2: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::from_le_bytes( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ *(ptr2 as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;]) });
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_b_2: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::from_le_bytes( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ *(ptr2.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;add&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;]) });
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; ptr3 = r3_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_ptr&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_a_3: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::from_le_bytes( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ *(ptr3 as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;]) });
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_b_3: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::from_le_bytes( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ *(ptr3.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;add&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;]) });
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; ptr4 = r4_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_ptr&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_a_4: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::from_le_bytes( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ *(ptr4 as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;]) });
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_b_4: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;::from_le_bytes( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ *(ptr4.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;add&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;]) });
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; len_a_1 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; r1_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() &amp;gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ r1_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() };
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; len_b_1 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; r1_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() &amp;gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;16 &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else if&lt;&#x2F;span&gt;&lt;span&gt; r1_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;{ r1_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;}  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 &lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; len_a_2 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; r2_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() &amp;gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ r2_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() };
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; len_b_2 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; r2_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() &amp;gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;16 &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else if&lt;&#x2F;span&gt;&lt;span&gt; r2_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;{ r2_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;}  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 &lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; len_a_3 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; r3_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() &amp;gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ r3_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() };
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; len_b_3 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; r3_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() &amp;gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;16 &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else if&lt;&#x2F;span&gt;&lt;span&gt; r3_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;{ r3_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;}  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 &lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; len_a_4 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; r4_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() &amp;gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ r4_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;()  };
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; len_b_4 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; r4_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() &amp;gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;16 &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else if&lt;&#x2F;span&gt;&lt;span&gt; r4_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;{ r4_name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;}  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 &lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_a_1 = key_a_1 &amp;amp; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MASKS&lt;&#x2F;span&gt;&lt;span&gt;[len_a_1];
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_b_1 = key_b_1 &amp;amp; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MASKS&lt;&#x2F;span&gt;&lt;span&gt;[len_b_1];
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_a_2 = key_a_2 &amp;amp; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MASKS&lt;&#x2F;span&gt;&lt;span&gt;[len_a_2];
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_b_2 = key_b_2 &amp;amp; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MASKS&lt;&#x2F;span&gt;&lt;span&gt;[len_b_2];
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_a_3 = key_a_3 &amp;amp; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MASKS&lt;&#x2F;span&gt;&lt;span&gt;[len_a_3];
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_b_3 = key_b_3 &amp;amp; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MASKS&lt;&#x2F;span&gt;&lt;span&gt;[len_b_3];
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_a_4 = key_a_4 &amp;amp; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MASKS&lt;&#x2F;span&gt;&lt;span&gt;[len_a_4];
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; key_b_4 = key_b_4 &amp;amp; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MASKS&lt;&#x2F;span&gt;&lt;span&gt;[len_b_4];
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span&gt;(v1, v2, v3, v4) = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;parse_values&lt;&#x2F;span&gt;&lt;span&gt;(r1_value, r2_value, r3_value, r4_value) };
&lt;&#x2F;span&gt;&lt;span&gt;            aggr.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;save_item&lt;&#x2F;span&gt;&lt;span&gt;(r1_name, key_a_1, key_b_1, v1);
&lt;&#x2F;span&gt;&lt;span&gt;            aggr.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;save_item&lt;&#x2F;span&gt;&lt;span&gt;(r2_name, key_a_2, key_b_2, v2);
&lt;&#x2F;span&gt;&lt;span&gt;            aggr.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;save_item&lt;&#x2F;span&gt;&lt;span&gt;(r3_name, key_a_3, key_b_3, v3);
&lt;&#x2F;span&gt;&lt;span&gt;            aggr.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;save_item&lt;&#x2F;span&gt;&lt;span&gt;(r4_name, key_a_4, key_b_4, v4);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if let &lt;&#x2F;span&gt;&lt;span&gt;Some((name, value)) = r1 {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;process_one&lt;&#x2F;span&gt;&lt;span&gt;(name, value, &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; aggr);
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if let &lt;&#x2F;span&gt;&lt;span&gt;Some((name, value)) = r2 {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;process_one&lt;&#x2F;span&gt;&lt;span&gt;(name, value, &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; aggr);
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if let &lt;&#x2F;span&gt;&lt;span&gt;Some((name, value)) = r3 {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;process_one&lt;&#x2F;span&gt;&lt;span&gt;(name, value, &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; aggr);
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;break&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; check_result(&amp;amp;aggr);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    Ok( HashMap::new() )
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ver13 æºä»£ç ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;ver13.rs&quot;&gt;ver13&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æ€§èƒ½æ•°æ®ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è€—æ—¶ï¼š9.12s (vs ver12: -3.95s, +30.2%) (vs ver1: -97.58s, +91.4%)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;3Q6KCBh&quot;&gt;samply profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;parse_values çš„è€—æ—¶ä»é™åˆ°äº† 0.56sï¼Œä» 4.7s å‡å°‘åˆ°äº† 0.56sï¼Œç”šè‡³è¶…å‡ºäº†æˆ‘ä»¬çš„é¢„æœŸã€‚å½“ç„¶ï¼Œ1brc é¦–æ¬¡è¿›å…¥10ç§’ä»¥å†…çš„æˆç»©ï¼Œç›¸æ¯” ver1 æå‡äº† 11.8 å€ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ç°åœ¨ï¼Œä¸»è¦çš„è€—æ—¶ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;éå†è¯»å– blockï¼š5.35s&lt;&#x2F;li&gt;
&lt;li&gt;hash aggregator: 1.97s&lt;&#x2F;li&gt;
&lt;li&gt;parse_values: 0.56s&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;ver14-13-06s&quot;&gt;ver14, 13.06s&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨ ver13 ä¸­ï¼Œæˆ‘ä»¬å°è¯•åœ¨ä¸€ä¸ªå¾ªç¯ä¸­å¤„ç†å¤šè¡Œæ•°æ®ï¼Œè·å¾—äº†å¾ˆå¥½çš„æ•ˆæœï¼Œæ˜¯å¦å¯ä»¥ç»§ç»­è¿™ä¸€ç­–ç•¥ï¼Œåœ¨ä¸€ä¸ªå¾ªç¯ä¸­å¤„ç†æ›´å¤šçš„æ•°æ®ï¼Ÿ&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨ ver14 ä¸­ï¼Œæˆ‘ä»¬å°è¯•ä¸€æ¬¡è¯»å– 256 å­—èŠ‚å¤§å°çš„ block, å°è¯•ä½¿ç”¨ u8x64 ï¼ˆ512b) çš„å‘é‡è§„æ¨¡æ¥æ‰«æåˆ†éš”ç¬¦ï¼Œå¾ˆä¸å¹¸ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„æ€§èƒ½é€€åŒ–åˆ°äº† 13sã€‚
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;the-1brc-program&#x2F;img_1.png&quot; alt=&quot;img_1.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;è¯¦ç»†æºä»£ç ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;ver14.rs&quot;&gt;ver14&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;åŸå› åˆ†æï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;M1 åªæ”¯æŒ 128b çš„å‘é‡ï¼Œæ›´å¤§çš„å‘é‡å…¶å®æ˜¯è½¯ä»¶æ¨¡æ‹Ÿï¼Œè€Œéç¡¬ä»¶æ”¯æŒã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç›¸ä¼¼çš„ï¼Œåœ¨ M1 ä¸Šå¹¶æ²¡æœ‰ native çš„ u128 æ”¯æŒï¼Œä½¿ç”¨ ï¼ˆu64, u64) æ›¿ä»£ u128 å¯èƒ½ä¼šæ€§èƒ½æ›´ä½³ã€‚ï¼ˆu128åº•å±‚ä½¿ç”¨è½¯ä»¶æ¨¡æ‹Ÿï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨å¾ªç¯å¤„ç†ä¸­å¼•å…¥æ•°ç»„ç­‰æ•°æ®ç»“æ„&lt;code&gt;mask: [u64;4]&lt;&#x2F;code&gt;ï¼Œæ•°ç»„è®¿é—®ç­‰å¹¶ä¸åˆ©äº SSA ä¼˜åŒ–ï¼Œåœ¨å¾ªç¯å¤„ç†ä¸­ä¼šå¢åŠ å¯¹å†…å­˜çš„ load&#x2F;store è®¿é—®ï¼Œè€Œ SSA ä¼˜åŒ–å
èƒ½å¤Ÿæ›´å¥½çš„ä½¿ç”¨ register æ¥æ›¿ä»£æ•°æ®ï¼Œå‡å°‘å†…å­˜è®¿é—®æ“ä½œã€‚å¯„å­˜å™¨ç›¸æ¯”å†…å­˜ï¼ˆå³ä½¿æ˜¯L1 hitedï¼‰,ä¹Ÿä¼šæœ‰æ›´ä½çš„æˆæœ¬ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;æ€§èƒ½æ•°æ®ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è€—æ—¶ï¼š13.06s (vs ver13: +3.94s, -30.2%) (vs ver1: -93.64s, +87.5%)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;4gJ8ztC&quot;&gt;samply profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ä¼˜åŒ–å¤±è´¥ï¼Œç»•è¡Œ...&lt;&#x2F;p&gt;
&lt;h1 id=&quot;ver15-10-52s&quot;&gt;ver15, 10.52s&lt;&#x2F;h1&gt;
&lt;p&gt;å°è¯•åœ¨ ver13 çš„åŸºç¡€ä¸Šï¼Œæ¯æ¬¡è¯»å– 128B çš„ Blockï¼Œå¹¶å°†åˆ†éš”ç¬¦æ‰«æçš„ç»“æœå­˜å‚¨åœ¨ i128 ä¸­ï¼ˆä¸ä½¿ç”¨æ•°æ®ï¼Œä»è€Œå¯ä»¥æ›´å¥½çš„ä½¿ç”¨å¯„å­˜å™¨ä¼˜åŒ–ï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ€§èƒ½æ•°æ®ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è€—æ—¶ï¼š10.52s (vs ver13: +1.4s, -13.4%) (vs ver1: -90.18s, +84.3%)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;4bbGCJP&quot;&gt;samply profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å‡å°‘å†…å­˜è®¿é—®ï¼Œè¿˜æ˜¯æœ‰ä¸€å®šçš„æ•ˆæœçš„ï¼Œç›¸æ¯” v14 è¦å¥½ä¸€äº›çš„ï¼Œä½†ä»ç„¶æ²¡æœ‰è¾¾åˆ° ver13 çš„æ•ˆæœã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;ver16-8-55s&quot;&gt;ver16, 8.55s&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨ ver15 çš„æŠ€æœ¯ä¸Šï¼Œä½¿ç”¨ (u64, u64) æ›¿ä»£ u128ï¼Œå°è¯•è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å®Œæ•´æºä»£ç ï¼š[ver16](https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;ver16.rsï¼‰&lt;&#x2F;p&gt;
&lt;p&gt;æ€§èƒ½æ•°æ®ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è€—æ—¶ï¼š8.55s (vs ver15: -1.97s, -18.8%) (vs ver13: -0.56s, + 6% )(vs ver1: -92.15s, +86.2%)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;4hTD3d4&quot;&gt;samply profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å‡å°‘åˆ°äº†9ç§’å†…ã€‚åŸå› æ˜¯åœ¨ ARM ä¸­ï¼Œé€šç”¨å¯„å­˜å™¨æ˜¯ 64 ä½çš„ï¼Œå³ä½¿æ˜¯å¯¹128ä½çš„å‘é‡å¯„å­˜å™¨ï¼Œå•ä¸ªLane ä¹Ÿæœ€å¤šä»…æ”¯æŒ 64b, åœ¨ Rust ä¸­çš„u128 å®é™…ä¸Šæ˜¯é€šè¿‡
è½¯ä»¶è¿›è¡Œæ¨¡æ‹Ÿçš„,å¯¹ u128 çš„æ“ä½œè¿œæ¯” u64 è¦ä½æ•ˆã€‚åœ¨ v16 ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ (u64, u64) æ¥æ›¿ä»£ u128ï¼Œé¿å…äº†è½¯ä»¶æ¨¡æ‹Ÿçš„å¼€é”€,ç›¸æ¯”ä½¿ç”¨ u128 è¦æ›´å¿«ä¸€äº›ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨ ver16 ä¸­ï¼Œæ¯æ¬¡åªå¤„ç† 64B çš„block, å¹¶å°†è¡Œä¸­çš„&lt;code&gt;;&lt;&#x2F;code&gt; åˆ†éš”ç¬¦ å’Œ è¡Œæœ«çš„ &lt;code&gt;\n&lt;&#x2F;code&gt;åˆ†éš”ç¬¦çš„ä½ç½®åˆ†å¼€å­˜å‚¨ ä¸º mask1, mask2ï¼Œè¿™æ ·ï¼Œåœ¨åç»­å¤„ç†ä¸­ï¼Œå¯¹ä¸¤ä¸ª mask
çš„ è·å–æ“ä½œå¯ä»¥å¹¶è¡Œè¿›è¡Œï¼Œæé«˜æŒ‡ä»¤çš„å¹¶è¡Œåº¦ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;ver17-16-2s&quot;&gt;ver17: 16.2s&lt;&#x2F;h1&gt;
&lt;p&gt;ver17 å°è¯•å¯¹ä»£ç è¿›è¡Œä¸€äº›é‡æ„ï¼Œä½¿å¾—ä»£ç çš„å¯è¯»æ€§æ›´å¥½ä¸€äº›ï¼Œå°†ä¸»æµç¨‹çš„å¾ªç¯å¤„ç†ä»ä¸»å‡½æ•°ä¸­æŠ½å‡ºæ¥ï¼Œè½¬ç§»åˆ° scan_loop ä¸­ï¼ŒåŒæ—¶ï¼Œå°†å¾ªç¯çš„ä¸€äº›ä¸Šä¸‹æ–‡å˜é‡
ä» struct å­—æ®µè½¬ç§»åˆ° scan_loop çš„å±€éƒ¨å˜é‡ä¸­ï¼Œå½“æ—¶çš„è€ƒè™‘æ˜¯ç¼–è¯‘å™¨å¯ä»¥æ›´å¥½çš„è¿›è¡Œ SSA ä¼˜åŒ–ï¼Œå‡å°‘å†…å­˜è®¿é—®ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;rust åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥å°† struct å­—æ®µçš„å˜é‡ä¹Ÿ SSA ä¼˜åŒ–ï¼Œåˆ°æ¥çš„ä¼˜åŠ¿å°±æ˜¯è¿™äº›å­—æ®µä¼šç›´æ¥ä¿å­˜åœ¨ register ä¸­ï¼Œè€Œä¸æ˜¯åœ¨å†…å­˜ä¸­ï¼Œè®¿é—®å¯„å­˜å™¨ç›¸æ¯”
è®¿é—®å†…å­˜ï¼Œæœ‰æ›´ä½çš„æˆæœ¬ï¼ˆè™½ç„¶åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç”±äºL1 Cacheçš„ä¼˜åŒ–ä»¥åŠå…¶ä»–ä¼˜åŒ–ï¼Œè¿™ä¸ªå·®è·å¯èƒ½å¹¶ä¸æ˜æ˜¾ï¼Œä½†ä½¿ç”¨å¯„å­˜å™¨æ€»æ˜¯æ›´ä¸ºæ€§èƒ½æœ‰å¥½çš„ï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è¿™ä¸ªç‰ˆæœ¬çš„æ€§èƒ½é€€åŒ–åˆ°äº† 16.2sï¼ŒåŸå› æ˜¯åœ¨ scan_loop ä¸­ï¼Œå› æ­¤ï¼Œæœ¬æ–‡ä¸å¯¹å…¶è¿›è¡Œå±•å¼€è¯´æ˜ï¼Œç›´æ¥è·³è¿‡ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å®Œæ•´æºä»£ç ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;ver17.rs&quot;&gt;ver17&lt;&#x2F;a&gt;
æ€§èƒ½è¯´æ˜ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è€—æ—¶ï¼š16.2s (vs ver16: +7.65s, -89.4%) (vs ver1: -84.48s, +82.4%)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;3QnKGgg&quot;&gt;samply profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;ver18-6-76s&quot;&gt;ver18: 6.76s&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨ ver17 çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;æ¯æ¬¡è¯»å– 64B çš„blockï¼Œè€Œä¸æ˜¯ 128B, 64B çš„ block å¯ä»¥æ›´å¥½çš„åŒ¹é… ARM çš„ 64b æ¶æ„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨ 3 è¡Œä¸€ä¸ªæ‰¹é‡çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œå‡å°‘åˆ†æ”¯é¢„æµ‹å¤±è´¥çš„æƒ…å†µã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å®Œæ•´æºä»£ç ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;onebrc_rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;ver18.rs&quot;&gt;ver18&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æ€§èƒ½è¯´æ˜ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è€—æ—¶ï¼š6.76s (vs ver17: -9.44s, -58.4%) (vs ver1: -94.32s, +93.3%)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;share.firefox.dev&#x2F;4gQ8hB3&quot;&gt;samply profile&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è¿™ä¸ªç‰ˆæœ¬çš„æ€§èƒ½æœ‰äº†å¾ˆå¤§çš„æå‡ï¼Œæˆ‘ä»¬è¿›å…¥äº† 7s ä»¥å†…çš„èŒƒå›´ï¼ˆåŸé¡¹ç›®ä¸­Javaç¬¬ä¸€ååœ¨æˆ‘æœ¬åœ°çš„å•çº¿ç¨‹æˆç»©ä¸º7.10sï¼‰ï¼Œver18 é¦–æ¬¡è¶…è¿‡äº† Java Top 1çš„æˆç»©ã€‚
å¯å–œå¯è´ºï¼Œæ˜¯å¦è¿˜æœ‰æ›´è¿›ä¸€æ­¥çš„ä¼˜åŒ–ç©ºé—´å‘¢ï¼Ÿ&lt;&#x2F;p&gt;
&lt;h1 id=&quot;ver21-6-17s&quot;&gt;ver21: 6.17s&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;ver22-5-38s&quot;&gt;ver22: 5.38s&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;ver22-pgo-5-25s&quot;&gt;ver22 + pgo: 5.25s&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨ ver22 çš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨ &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;rustc&#x2F;profile-guided-optimization.html#:~:text=rustc%20supports%20doing%20profile-guided%20optimization%20%28PGO%29.%20This%20chapter,it%20can%20be%20used.%20What%20Is%20Profiled-Guided%20Optimization%3F&quot;&gt;profile guided optimization&lt;&#x2F;a&gt;
è¿›è¡Œç¼–è¯‘ä¼˜åŒ–ï¼Œç›¸æ¯” ~pgo çš„ç‰ˆæœ¬ï¼Œæå‡äº†çº¦ %2 çš„æ€§èƒ½ã€‚è™½ç„¶æ¯”ä¾‹ä¸å¤§ï¼Œä¸è¿‡èƒœåœ¨æˆæœ¬ä½ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ²¡æœ‰å¯¹æ¯”ç”Ÿæˆçš„ä»£ç ï¼Œä¼°è®¡æ˜¯åŸºäº profile data, å¯¹ register allocation ç­‰åšäº†ç­–ç•¥æ€§çš„ä¼˜åŒ–ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æœªå®Œï¼Œå¾…ç»­......&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>February 2025</title>
        <published>2025-02-06T00:00:00+00:00</published>
        <updated>2025-02-06T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2025-02/"/>
        <id>https://wangzaixiang.github.io/monthly/2025-02/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2025-02/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;El-Naizin&#x2F;rust-kperf&quot;&gt;rust-kperf&lt;&#x2F;a&gt; MacOS ä¸‹çš„æœªå…¬å¼€çš„API çš„é€†å‘å·¥ç¨‹ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;developer.arm.com&#x2F;documentation&#x2F;102340&#x2F;0100&#x2F;SVE2-architecture-fundamentals&quot;&gt;ARM SVE2 æ¶æ„åŸºç¡€&lt;&#x2F;a&gt;
SVE æŒ‡ä»¤é›†çš„è®¾è®¡ç¡®å®æ˜¯ä¸€ä¸ªåˆ›æ–°ï¼Œå¯ä»¥æ”¯æŒä»»æ„çš„å‘é‡é•¿åº¦è€Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚ç›¸æ¯” SSE&#x2F;AVX&#x2F;AVX2&#x2F;AVX512 ç­‰æŒ‡ä»¤é›†ï¼ŒSVE è¦ä¼˜ç¾å¾—å¤šã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;strongly-typed-thoughts.net&#x2F;blog&#x2F;zig-2025&quot;&gt;What I like and unlike for Zig&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Likes
&lt;ul&gt;
&lt;li&gt;arbitrary width integers and packed structs&lt;&#x2F;li&gt;
&lt;li&gt;generic types are functions at the type level&lt;&#x2F;li&gt;
&lt;li&gt;error union types&lt;&#x2F;li&gt;
&lt;li&gt;c interop&lt;&#x2F;li&gt;
&lt;li&gt;the build system&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Unlikes
&lt;ul&gt;
&lt;li&gt;error handling, than Rust&#x27;s Result&lt;&#x2F;li&gt;
&lt;li&gt;shadowing is forbidden&lt;&#x2F;li&gt;
&lt;li&gt;compile time duck typing: anytype&lt;&#x2F;li&gt;
&lt;li&gt;no typeclasses&#x2F;traits&lt;&#x2F;li&gt;
&lt;li&gt;comptime is probably not interesting as it looks&lt;&#x2F;li&gt;
&lt;li&gt;non encapsulion&lt;&#x2F;li&gt;
&lt;li&gt;memory safety is highly underestimated and fallacious&lt;&#x2F;li&gt;
&lt;li&gt;lazy compilation&lt;&#x2F;li&gt;
&lt;li&gt;no destructors&lt;&#x2F;li&gt;
&lt;li&gt;no (unicode) strings.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;c9x.me&#x2F;compile&#x2F;&quot;&gt;QBE&lt;&#x2F;a&gt; QBE is a compiler backend that aims to provide 70% of the performance of industrial optimizing compilers in
10% of the code.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;like LLVM IR, but simpler.&lt;&#x2F;li&gt;
&lt;li&gt;~10k lines of c code. (vs 1M lines of LLVM), ä»£ç é‡å°‘ï¼ŒPure Cï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å­¦ä¹ ç¼–è¯‘æœŸåç«¯çš„å‚è€ƒã€‚&lt;&#x2F;li&gt;
&lt;li&gt;support for amd64 (linux and osx), arm64, and riscv64.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.zhihu.com&#x2F;question&#x2F;500409301&#x2F;answer&#x2F;3210484073&quot;&gt;LLVMæŒ‡ä»¤é€‰æ‹©&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æŒ‡ä»¤é€‰æ‹©è¿‡ç¨‹ä»¥ IR ä¸ºè¾“å…¥ï¼Œè¾“å‡ºä¸€ç³»åˆ—ä½¿ç”¨æ— é™å¯„å­˜å™¨çš„æŒ‡ä»¤ï¼Œåˆ†ä¸ºå¦‚ä¸‹é˜¶æ®µï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ„å»ºåˆå§‹ Selection DAG&lt;&#x2F;li&gt;
&lt;li&gt;ä¼˜åŒ–&lt;&#x2F;li&gt;
&lt;li&gt;ç±»å‹åˆæ³•åŒ–&lt;&#x2F;li&gt;
&lt;li&gt;ä¼˜åŒ–&lt;&#x2F;li&gt;
&lt;li&gt;æ“ä½œåˆæ³•åŒ–&lt;&#x2F;li&gt;
&lt;li&gt;ä¼˜åŒ–&lt;&#x2F;li&gt;
&lt;li&gt;ç›®æ ‡æŒ‡ä»¤é€‰æ‹©&lt;&#x2F;li&gt;
&lt;li&gt;è°ƒåº¦æ ¸å½¢æˆã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼šæ‚¨å¯ä»¥é€šè¿‡åœ¨è°ƒç”¨llcæ—¶ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ä¼ é€’-view-dag-combine1-dagsã€-view-legalize-dagsã€-view-dag-combine2-dagsã€
-view-isel-dagsæˆ–-view-sched-dagsæ¥å‘Šè¯‰LLVMåœ¨æŒ‡ä»¤é€‰æ‹©è¿‡ç¨‹çš„å„ä¸ªé˜¶æ®µç”Ÿæˆé€‰æ‹©DAGçš„å¯è§†åŒ–è¡¨ç¤ºã€‚
-debugå‚æ•°å‘Šè¯‰llcç”Ÿæˆé€‰æ‹©DAGçš„æ–‡æœ¬è¡¨ç¤ºã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;karpathy&#x2F;makemore&quot;&gt;makemore&lt;&#x2F;a&gt; è¯­è¨€ç”Ÿæˆæ¨¡å‹ï¼Œtransformer çš„ç®€å•ç‰ˆæœ¬ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.rust-lang.org&#x2F;2025&#x2F;02&#x2F;20&#x2F;Rust-1.85.0.html&quot;&gt;Rust Edition 2024&lt;&#x2F;a&gt; åˆä¸€ä¸ªå¤§ç‰ˆæœ¬æ¥äº†ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;MPP &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;web-visualization&quot;&gt;Web &amp;amp; Visualization&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;platform.uno&#x2F;blog&#x2F;state-of-webassembly-2024-2025&#x2F;&quot;&gt;The State of WASM - 2024 and 2025&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;ESM integration, &lt;code&gt;import {add} from &#x27;.&#x2F;my-math.wasm&#x27;&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;tools-libraries&quot;&gt;Tools &amp;amp; Libraries&lt;&#x2F;h1&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>LLVMå­¦ä¹ ç³»åˆ—äºŒï¼šä»ä¸€æ®µç®€å•çš„Cä»£ç æ¥å­¦ä¹ LLVM-IR</title>
        <published>2025-01-05T00:00:00+00:00</published>
        <updated>2025-01-05T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/learning-llvm-2/"/>
        <id>https://wangzaixiang.github.io/blog/learning-llvm-2/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/learning-llvm-2/">&lt;p&gt;æœ¬æ–‡æ‰¿æ¥ &lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;learning-llvm&#x2F;&quot;&gt;LLVM å­¦ä¹ ç³»åˆ—ä¸€ï¼šåˆè¯» LLVM-IR ç¤ºä¾‹ä»£ç &lt;&#x2F;a&gt; ä¸­ï¼Œæœ¬æ–‡å°†é€šè¿‡ä¸€ä¸ªç®€å•çš„ C ä»£ç æ¥å­¦ä¹  LLVM IR çš„ç”Ÿæˆè¿‡ç¨‹ï¼Œ
ä»¥åŠå¦‚ä½•é€šè¿‡å‘½ä»¤è¡Œå·¥å…·æ¥æŸ¥çœ‹å„ä¸ª pass çš„è¾“å‡ºã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;shi-li-dai-ma&quot;&gt;ç¤ºä¾‹ä»£ç &lt;&#x2F;h1&gt;
&lt;pre data-lang=&quot;c&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-c &quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;demo1&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt; y = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt;(x == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;    y = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  }
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else if&lt;&#x2F;span&gt;&lt;span&gt;(x == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100&lt;&#x2F;span&gt;&lt;span&gt;){
&lt;&#x2F;span&gt;&lt;span&gt;    y = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;20&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  }
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else if&lt;&#x2F;span&gt;&lt;span&gt;(x == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;200&lt;&#x2F;span&gt;&lt;span&gt;){
&lt;&#x2F;span&gt;&lt;span&gt;    y = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;30&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  }
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    y = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;40&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  }
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return&lt;&#x2F;span&gt;&lt;span&gt; y;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;shi-li-xue-xi-o3-de-you-hua-guo-cheng&quot;&gt;å®ä¾‹å­¦ä¹  -O3 çš„ä¼˜åŒ–è¿‡ç¨‹:&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ç¼–è¯‘ï¼š&lt;code&gt;clang -S -emit-llvm -O3 -mllvm -print-after-all demo1.c -o demo1-O3.ll 2&amp;gt;&#x2F;tmp&#x2F;passes.txt&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æŸ¥çœ‹ -O3 é€‰é¡¹ç¼–è¯‘çš„å…¨è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ª pass æ‰§è¡Œåçš„ IR ä»£ç ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;grep &quot;Dump After&quot; &#x2F;tmp&#x2F;passes.txt | wc -l&lt;&#x2F;code&gt; ï¼š å…± 106 ä¸ª pass&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;clang -mllvm -debug-pass=Arguments -c demo1.c&lt;&#x2F;code&gt; æŸ¥çœ‹ opt çš„å‚æ•°ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;text&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-text &quot;&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt; Pass Arguments:  -tti -targetlibinfo -assumption-cache-tracker -targetpassconfig -machinemoduleinfo -profile-summary-info -tbaa -scoped-noalias-aa \
&lt;&#x2F;span&gt;&lt;span&gt;     -collector-metadata -machine-branch-prob -regalloc-evict -regalloc-priority -domtree -basic-aa -aa -objc-arc-contract -pre-isel-intrinsic-lowering \
&lt;&#x2F;span&gt;&lt;span&gt;     -expand-large-div-rem -expand-large-fp-convert -atomic-expand -aarch64-sve-intrinsic-opts -simplifycfg -domtree -loops -loop-simplify \
&lt;&#x2F;span&gt;&lt;span&gt;     -lazy-branch-prob -lazy-block-freq -opt-remark-emitter -scalar-evolution -loop-data-prefetch -aarch64-falkor-hwpf-fix -basic-aa \
&lt;&#x2F;span&gt;&lt;span&gt;     -loop-simplify -canon-freeze -iv-users -loop-reduce -basic-aa -aa -mergeicmps -loops -lazy-branch-prob -lazy-block-freq -expand-memcmp \
&lt;&#x2F;span&gt;&lt;span&gt;     -gc-lowering -shadow-stack-gc-lowering -lower-constant-intrinsics -lower-global-dtors -unreachableblockelim -domtree -loops -postdomtree \
&lt;&#x2F;span&gt;&lt;span&gt;     -branch-prob -block-freq -consthoist -replace-with-veclib -partially-inline-libcalls -expandvp -post-inline-ee-instrument \
&lt;&#x2F;span&gt;&lt;span&gt;     -scalarize-masked-mem-intrin -expand-reductions -loops -tlshoist -postdomtree -branch-prob -block-freq -lazy-branch-prob \
&lt;&#x2F;span&gt;&lt;span&gt;     -lazy-block-freq -opt-remark-emitter -select-optimize -aarch64-globals-tagging -stack-safety -domtree -basic-aa -aa -aarch64-stack-tagging \
&lt;&#x2F;span&gt;&lt;span&gt;     -complex-deinterleaving -aa -memoryssa -interleaved-load-combine -domtree -interleaved-access -aarch64-sme-abi -domtree -loops -type-promotion \
&lt;&#x2F;span&gt;&lt;span&gt;     -codegenprepare -domtree -dwarf-eh-prepare -aarch64-promote-const -global-merge -callbrprepare -safe-stack -stack-protector -domtree -basic-aa \
&lt;&#x2F;span&gt;&lt;span&gt;     -aa -loops -postdomtree -branch-prob -debug-ata -lazy-branch-prob -lazy-block-freq -aarch64-isel -finalize-isel -lazy-machine-block-freq \
&lt;&#x2F;span&gt;&lt;span&gt;     -early-tailduplication -opt-phis -slotindexes -stack-coloring -localstackalloc -dead-mi-elimination -machinedomtree -aarch64-condopt \
&lt;&#x2F;span&gt;&lt;span&gt;     -machine-loops -machine-trace-metrics -aarch64-ccmp -lazy-machine-block-freq -machine-combiner -aarch64-cond-br-tuning -machine-trace-metrics \ 
&lt;&#x2F;span&gt;&lt;span&gt;     -early-ifcvt -aarch64-stp-suppress -aarch64-simdinstr-opt -aarch64-stack-tagging-pre-ra -machinedomtree -machine-loops -machine-block-freq  \
&lt;&#x2F;span&gt;&lt;span&gt;     -early-machinelicm -machinedomtree -machine-block-freq -machine-cse -machinepostdomtree -machine-cycles -machine-sink -peephole-opt \
&lt;&#x2F;span&gt;&lt;span&gt;     -dead-mi-elimination -aarch64-mi-peephole-opt -aarch64-dead-defs -detect-dead-lanes -init-undef -processimpdefs -unreachable-mbb-elimination \ 
&lt;&#x2F;span&gt;&lt;span&gt;     -livevars -phi-node-elimination -twoaddressinstruction -machinedomtree -slotindexes -liveintervals -register-coalescer -rename-independent-subregs \ 
&lt;&#x2F;span&gt;&lt;span&gt;     -machine-scheduler -aarch64-post-coalescer-pass -machine-block-freq -livedebugvars -livestacks -virtregmap -liveregmatrix -edge-bundles \
&lt;&#x2F;span&gt;&lt;span&gt;     -spill-code-placement -lazy-machine-block-freq -machine-opt-remark-emitter -greedy -virtregrewriter -regallocscoringpass -stack-slot-coloring \ 
&lt;&#x2F;span&gt;&lt;span&gt;     -machine-cp -machinelicm -aarch64-copyelim -aarch64-a57-fp-load-balancing -removeredundantdebugvalues -fixup-statepoint-caller-saved  \
&lt;&#x2F;span&gt;&lt;span&gt;     -postra-machine-sink -machinedomtree -machine-loops -machine-block-freq -machinepostdomtree -lazy-machine-block-freq -machine-opt-remark-emitter \ 
&lt;&#x2F;span&gt;&lt;span&gt;     -shrink-wrap -prologepilog -machine-latecleanup -branch-folder -lazy-machine-block-freq -tailduplication -machine-cp -postrapseudos \
&lt;&#x2F;span&gt;&lt;span&gt;     -aarch64-expand-pseudo -aarch64-ldst-opt -kcfi -aarch64-speculation-hardening -machinedomtree -machine-loops -aarch64-falkor-hwpf-fix-late \ 
&lt;&#x2F;span&gt;&lt;span&gt;     -postmisched -gc-analysis -machine-block-freq -machinepostdomtree -block-placement -fentry-insert -xray-instrumentation -patchable-function \
&lt;&#x2F;span&gt;&lt;span&gt;     -aarch64-ldst-opt -machine-cp -aarch64-fix-cortex-a53-835769-pass -aarch64-collect-loh -funclet-layout -stackmap-liveness -livedebugvalues \
&lt;&#x2F;span&gt;&lt;span&gt;     -machine-sanmd -machine-outliner -aarch64-sls-hardening -aarch64-ptrauth -aarch64-branch-targets -branch-relaxation -aarch64-jump-tables \
&lt;&#x2F;span&gt;&lt;span&gt;     -cfi-fixup -lazy-machine-block-freq -machine-opt-remark-emitter -stack-frame-layout -unpack-mi-bundles -lazy-machine-block-freq \
&lt;&#x2F;span&gt;&lt;span&gt;     -machine-opt-remark-emitter
&lt;&#x2F;span&gt;&lt;span&gt; Pass Arguments:  -domtree
&lt;&#x2F;span&gt;&lt;span&gt; Pass Arguments:  -assumption-cache-tracker -targetlibinfo -domtree -loops -scalar-evolution -stack-safety-local
&lt;&#x2F;span&gt;&lt;span&gt; Pass Arguments:  -domtree
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;æŠŠè¿™ä¸ªå‚æ•°ç›´æ¥ä¸¢ç»™ opt å‘½ä»¤è¡Œæ˜¯ä¸è¡Œçš„ï¼Œä¼šæŠ¥é”™è¯¯ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨å¦‚ä¸‹çš„è„šæœ¬æ¥åˆ†æ -print-after-all&lt;&#x2F;p&gt;
&lt;p&gt;ä¸ºäº†æ›´å¥½çš„è§‚å¯Ÿæ¯ä¸ª pass çš„è¾“å‡ºï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„è„šæœ¬æ¥æ‹†åˆ†æ¯ä¸ª pass åçš„IRï¼Œå¹¶è¾“å‡ºåˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ä¸­ã€‚æ–¹ä¾¿ä½¿ç”¨ diff ç­‰å·¥å…·
æ¥å¯¹æ¯”æ¯ä¸ª pass çš„æ¼”è¿›è¿‡ç¨‹ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; src&#x2F;bin&#x2F;passes.rs
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;std::fs::File;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;std::io::{&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;, BufRead, BufReader, Write};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;() -&amp;gt; io::Result&amp;lt;()&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; args[1] is the input file like abc.ll
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; input_file = std::env::args().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;nth&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;expect&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;no filename given&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;!input_file.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;ends_with&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;.ll&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) {
&lt;&#x2F;span&gt;&lt;span&gt;        panic!(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;input file must end with .ll&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; path = std::path::Path::new(&amp;amp;input_file);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; basename = path.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;file_stem&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;expect&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;no basename found&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_str&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;expect&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;basename is not a valid UTF-8 string&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; file = File::open(input_file.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_str&lt;&#x2F;span&gt;&lt;span&gt;())?;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; reader = BufReader::new(file);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; file_count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; output_file = File::create(format!(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;.&#x2F;output&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{basename}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;_&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{file_count}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;.ll&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;))?;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for&lt;&#x2F;span&gt;&lt;span&gt; line in reader.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;lines&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; line = line?;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; line.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;contains&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt; Dump After &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) {
&lt;&#x2F;span&gt;&lt;span&gt;            file_count += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            output_file = File::create(format!(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;.&#x2F;output&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{basename}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;_&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{file_count}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;.ll&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;))?;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        writeln!(output_file, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, line)?;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    Ok(())
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;code&gt;cargo run --bin passes -- path&#x2F;to&#x2F;file.ll&lt;&#x2F;code&gt; ä¼šåœ¨ output ç›®å½•ä¸‹ç”Ÿæˆå¤šä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”ä¸€ä¸ª pass çš„è¾“å‡ºã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;afnanenayet&#x2F;diffsitter&quot;&gt;&lt;code&gt;difft&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; é€æ­¥çš„å¯¹æ¯”æ¯ä¸ª pass çš„è¾“å‡ºï¼Œè§‚å¯Ÿ IR çš„æ¼”å˜è¿‡ç¨‹ï¼Œç†è§£å„ä¸ª pass çš„èŒè´£ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªå°çš„demoä¸­ï¼Œä¸»è¦æ˜¯å¦‚ä¸‹ä¸¤ä¸ª pass èµ·åˆ°äº†å…³é”®ä½œç”¨ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;simplifycfg: ç®€åŒ–æ§åˆ¶æµå›¾ï¼ŒåŒ…æ‹¬åˆå¹¶åŸºæœ¬å¿«ï¼Œä½¿ç”¨ switch æ›¿ä»£å¤šä¸ª if else ç­‰ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;SROA: An optimization pass providing Scalar Replacement of Aggregates. This pass takes allocations which can be completely
analyzed (that is, they don&#x27;t escape) and tries to turn them into scalar SSA values.
åˆšå¼€å§‹çš„æ—¶å€™ï¼ŒIR å¹¶ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„ SSAï¼Œå¯¹æ¯ä¸ªå˜é‡çš„è¯»å†™éƒ½æ˜¯é€šè¿‡ alloca å’Œ load&#x2F;store æ¥å®ç°çš„ï¼Œè¿™ä¸ª pass å°†è¿™äº›å˜é‡è½¬æ¢ä¸º SSA å½¢å¼ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;pass 7: After SimplifyCFGPass
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
      flowchart TD
      %% function demo1
      %1[&amp;quot;  %2 = alloca i32, align 4
        %3 = alloca i32, align 4
        store i32 %0, ptr %2, align 4, !tbaa !5
        call void @llvm.lifetime.start.p0(i64 4, ptr %3) #2
        store i32 0, ptr %3, align 4, !tbaa !5
        %4 = load i32, ptr %2, align 4, !tbaa !5
        %5 = icmp eq i32 %4, 1
        br i1 %5, label %6, label %7&amp;quot;]
          %1 --&amp;gt;|%6| %6
      %6[&amp;quot;  store i32 10, ptr %3, align 4, !tbaa !5
        br label %16&amp;quot;]
          %1 --&amp;gt;|%7| %7
      %7[&amp;quot;  %8 = load i32, ptr %2, align 4, !tbaa !5
        %9 = icmp eq i32 %8, 100
        br i1 %9, label %10, label %11&amp;quot;]
          %7 --&amp;gt;|%10| %10
      %10[&amp;quot;  store i32 20, ptr %3, align 4, !tbaa !5
        br label %16&amp;quot;]
          %7 --&amp;gt;|%11| %11
      %11[&amp;quot;  %12 = load i32, ptr %2, align 4, !tbaa !5
        %13 = icmp eq i32 %12, 200
        br i1 %13, label %14, label %15&amp;quot;]
          %11 --&amp;gt;|%14| %14
      %14[&amp;quot;  store i32 30, ptr %3, align 4, !tbaa !5
        br label %16&amp;quot;]
          %11 --&amp;gt;|%15| %15
      %15[&amp;quot;  store i32 40, ptr %3, align 4, !tbaa !5
        br label %16&amp;quot;]
          %10 --&amp;gt;|%16| %16
          %15 --&amp;gt;|%16| %16
          %14 --&amp;gt;|%16| %16
          %6 --&amp;gt;|%16| %16
      %16[&amp;quot;  %17 = load i32, ptr %3, align 4, !tbaa !5
        call void @llvm.lifetime.end.p0(i64 4, ptr %3) #2
        ret i32 %17&amp;quot;]
      style %16 stroke:#0f0
      ```
&lt;&#x2F;div&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;2: pass 8:  After SROAPass
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
      flowchart TD
      %% function demo1
      %1[&amp;quot;  %2 = icmp eq i32 %0, 1
        br i1 %2, label %3, label %4&amp;quot;]
          %1 --&amp;gt;|%3| %3
      %3[&amp;quot;  br label %11&amp;quot;]
          %1 --&amp;gt;|%4| %4
      %4[&amp;quot;  %5 = icmp eq i32 %0, 100
        br i1 %5, label %6, label %7&amp;quot;]
          %4 --&amp;gt;|%6| %6
      %6[&amp;quot;  br label %11&amp;quot;]
          %4 --&amp;gt;|%7| %7
      %7[&amp;quot;  %8 = icmp eq i32 %0, 200
        br i1 %8, label %9, label %10&amp;quot;]
          %7 --&amp;gt;|%9| %9
      %9[&amp;quot;  br label %11&amp;quot;]
          %7 --&amp;gt;|%10| %10
      %10[&amp;quot;  br label %11&amp;quot;]
          %6 --&amp;gt;|%11| %11
          %10 --&amp;gt;|%11| %11
          %9 --&amp;gt;|%11| %11
          %3 --&amp;gt;|%11| %11
      %11[&amp;quot;  %12 = phi i32 [ 10, %3 ], [ 20, %6 ], [ 30, %9 ], [ 40, %10 ]
        ret i32 %12&amp;quot;]
      style %11 stroke:#0f0
      ```
&lt;&#x2F;div&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;3: pass 17:  After SimplifyCFGPass
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
      flowchart TD
      %% function demo1
      %1[&amp;quot;  switch i32 %0, label %4 [
          i32 1, label %5
          i32 100, label %2
          i32 200, label %3
        ]&amp;quot;]
              %1 --&amp;gt;|%2| %2
      %2[&amp;quot;  br label %5&amp;quot;]
              %1 --&amp;gt;|%3| %3
      %3[&amp;quot;  br label %5&amp;quot;]
              %1 --&amp;gt;|%4| %4
      %4[&amp;quot;  br label %5&amp;quot;]
              %1 --&amp;gt;|%5| %5
              %2 --&amp;gt;|%5| %5
              %4 --&amp;gt;|%5| %5
              %3 --&amp;gt;|%5| %5
      %5[&amp;quot;  %6 = phi i32 [ 20, %2 ], [ 30, %3 ], [ 40, %4 ], [ 10, %1 ]
        ret i32 %6&amp;quot;]
      style %5 stroke:#0f0
      ```
&lt;&#x2F;div&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡ opt å‘½ä»¤æ¥é‡ç°æŸä¸ª pass çš„ä¼˜åŒ–è¿‡ç¨‹ï¼šï¼ˆéƒ¨ä»½ pass è¾“å‡ºçš„ IL éœ€è¦ç®€å•çš„æ‰‹å·¥è°ƒæ•´æ–¹èƒ½æ­£ç¡®æ‰§è¡Œï¼‰&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;shell&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-shell &quot;&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span&gt;opt -S output&#x2F;demo1_6.ll -passes=simplifycfg -o -
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è¿™é‡Œçš„ pass name å¯ä»¥ä» æ–‡ä»¶ä¸­çš„ &lt;code&gt;Dump After&lt;&#x2F;code&gt; ä¸­æ‰¾åˆ°ã€‚
&lt;code&gt;opt -S output&#x2F;demo1_6.ll -passes=simplifycfg,sroa,simplifycfg -o -&lt;&#x2F;code&gt; ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥ä» -O0 çš„ IR ä¼˜åŒ–åˆ° -O3 çš„ IRã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;ming-ling-xing-gong-ju-can-kao&quot;&gt;å‘½ä»¤è¡Œå·¥å…·å‚è€ƒ&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ç¼–è¯‘ä¸º LLVM IR: &lt;code&gt;clang -S -emit-llvm demo1.c -o demo1.ll&lt;&#x2F;code&gt; å¯ç»“åˆ &lt;code&gt;-O1&lt;&#x2F;code&gt;, &lt;code&gt;-O3&lt;&#x2F;code&gt; ç­‰ä¼˜åŒ–é€‰é¡¹ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;clang -c -mllvm -print-after-all demo1.c&lt;&#x2F;code&gt; æŸ¥çœ‹å„ä¸ªé˜¶æ®µçš„è¾“å‡ºï¼ŒæŸ¥çœ‹å„ä¸ªpassåçš„ IR&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;clang -mllvm --help&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;clang -mllvm --help-hidden&lt;&#x2F;code&gt; æŸ¥çœ‹éšè—çš„é€‰é¡¹&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;clang -mllvm -debug-pass=Arguments&lt;&#x2F;code&gt; print pass arguments to pass to opt.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;opt -S src.ll -passes=.. -o -&lt;&#x2F;code&gt; ä½¿ç”¨ opt æ¥æ‰§è¡Œé€‰æ‹©çš„ pass å¹¶è§‚å¯Ÿ IR çš„æ¼”è¿›ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;--debug-pass=Details: print pass details when it is executed&lt;&#x2F;li&gt;
&lt;li&gt;--debug-pass-manager=quiet|verbose&lt;&#x2F;li&gt;
&lt;li&gt;--debugify-each    Start each pass with debugify and end it with check-debugify&lt;&#x2F;li&gt;
&lt;li&gt;--print-passes     print available passes&lt;&#x2F;li&gt;
&lt;li&gt;--print-pipeline-passes æ˜¾ç¤ºå½“å‰çš„ pass pipeline å¯ä»¥ä½¿ç”¨ clang -mllvm --print-pipeline-passes æŸ¥çœ‹ clang çš„ pass pipeline
ç„¶ååœ¨ opt ä¸­é‡æ”¾è¿™ä¸ª pipelineã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;llc&lt;&#x2F;code&gt; from LLVM IR to assembly&lt;&#x2F;p&gt;
&lt;p&gt;å¦‚æœå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;text&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-text &quot;&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;LLVM ERROR: Unsupported stack probing method
&lt;&#x2F;span&gt;&lt;span&gt;PLEASE submit a bug report to https:&#x2F;&#x2F;github.com&#x2F;Homebrew&#x2F;homebrew-core&#x2F;issues and include the crash backtrace.
&lt;&#x2F;span&gt;&lt;span&gt;Stack dump:
&lt;&#x2F;span&gt;&lt;span&gt;0.	Program arguments: &#x2F;opt&#x2F;homebrew&#x2F;opt&#x2F;llvm&#x2F;bin&#x2F;llc demo.ll
&lt;&#x2F;span&gt;&lt;span&gt;1.	Running pass &amp;#39;Function Pass Manager&amp;#39; on module &amp;#39;demo.ll&amp;#39;.
&lt;&#x2F;span&gt;&lt;span&gt;......
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è¯·ç¡®ä¿clang ä¸ llc çš„ç‰ˆæœ¬æ˜¯ä¸€è‡´çš„ã€‚apple è‡ªå¸¦çš„ clang ä¸ homebrew å®‰è£…çš„ llvm ä¸ä¸€å®šæ˜¯åŒä¸€ä¸ªç‰ˆæœ¬ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;as&lt;&#x2F;code&gt; from assembly to object file&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;xiao-jie&quot;&gt;å°ç»“&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;æœ¬æ–‡ç»™å‡ºäº†ä¸€ä¸ªå­¦ä¹  LLVM IR çš„æœ‰æ•ˆæ–¹æ³•ï¼šå³è·Ÿç€ clang çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œé€æ­¥äº†è§£ IR ä»¥åŠå„ä¸ª pass çš„ä½œç”¨ã€‚å¹¶ç»™å‡ºäº†å‚è€ƒçš„å‘½ä»¤è¡Œå·¥å…·ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æœ¬æ–‡ä¸­çš„ passes ç”Ÿæˆå·¥å…·ï¼Œè„šæœ¬æ˜¯é€šè¿‡ github copilot è¾…åŠ©ç”Ÿæˆçš„ rust è„šæœ¬ï¼Œç¨å¾®è°ƒæ•´ä¸€ä¸‹åï¼Œå°±å¯ä»¥ä½¿ç”¨ï¼Œæ¥è¾…åŠ©åˆ†æ IRã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åç»­ï¼š
&lt;ul&gt;
&lt;li&gt;å¯¹äºå¤æ‚çš„ IR ä»£ç ï¼Œéœ€è¦æœ‰ä¸€ä¸ªä» IR ç”Ÿæˆ CFG çš„å·¥å…·ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„ç†è§£ IR çš„æ§åˆ¶æµç¨‹ã€‚æˆ‘ä¼šåœ¨åé¢çš„å­¦ä¹ ä¸­ï¼Œä½¿ç”¨ rust æ¥ç¼–å†™è¿™ä¸ªå·¥å…·ã€‚
&lt;blockquote&gt;
&lt;p&gt;åˆç¨¿å·²ç»å®Œæˆï¼Œå¯ä»¥å‚è€ƒï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;my-llvm-tools&#x2F;blob&#x2F;main&#x2F;src&#x2F;bin&#x2F;ll2cfg.rs&quot;&gt;ll2cfg&lt;&#x2F;a&gt;
æœ¬æ–‡ä¸­çš„ CFG æµç¨‹å›¾å‡ä½¿ç”¨è¯¥å·¥å…·ç”Ÿæˆã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;å¯ä»¥ä½¿ç”¨æœ¬æ–‡ä¸­ä»‹ç»çš„æ–¹æ³•ï¼Œé€æ­¥é˜…è¯»æ›´ä¸ºå¤æ‚çš„ LLVM IR ä»£ç ï¼Œå­¦ä¹  LR çš„åŸºæœ¬çŸ¥è¯†ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸‹ä¸€æ­¥é‡ç‚¹å…³æ³¨çš„æ˜¯å‘é‡åŒ–ä»£ç çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œè¯„ä¼°ç›´æ¥åŸºäº LLVM ç”Ÿæˆå‘é‡åŒ–çš„å…³ç³»è®¡ç®—ä»£ç çš„å¯è¡Œæ€§ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;ç³»åˆ—é“¾æ¥
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;learning-llvm&#x2F;&quot;&gt;LLVM å­¦ä¹ ç³»åˆ—ä¸€ï¼šåˆè¯» LLVM-IR ç¤ºä¾‹ä»£ç &lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;learning-llvm-2&#x2F;&quot;&gt;LLVM å­¦ä¹ ç³»åˆ—äºŒï¼šä»ä¸€æ®µç®€å•çš„Cä»£ç æ¥å­¦ä¹ LLVM-IR&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>January 2025</title>
        <published>2025-01-01T00:00:00+00:00</published>
        <updated>2025-01-01T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2025-01/"/>
        <id>https://wangzaixiang.github.io/monthly/2025-01/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2025-01/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@techhara&#x2F;performance-optimization-technique-branchless-programming-a40c0a35511e&quot;&gt;Performance optimization â€” branchless programming&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cpp&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-cpp &quot;&gt;&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;branchful&lt;&#x2F;span&gt;&lt;span&gt;(std::optional&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span&gt;, std::optional&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const int&lt;&#x2F;span&gt;&lt;span&gt; NULL_VALUE = -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;(x.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;has_value&lt;&#x2F;span&gt;&lt;span&gt;() &amp;amp;&amp;amp; y.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;has_value&lt;&#x2F;span&gt;&lt;span&gt;()) {
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span&gt;*x * *y;
&lt;&#x2F;span&gt;&lt;span&gt; } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return&lt;&#x2F;span&gt;&lt;span&gt; NULL_VALUE;
&lt;&#x2F;span&gt;&lt;span&gt; }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;æ¶ˆé™¤åˆ†æ”¯ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cpp&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-cpp &quot;&gt;&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span&gt;boolean hasX = x.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;has_value&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;boolean hasY = y.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;has_value&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;boolean all = hasX &amp;amp;&amp;amp; hasY;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return&lt;&#x2F;span&gt;&lt;span&gt; all ? *x * *y : NULL_VALUE;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;6-7å€æ€§èƒ½æå‡ã€‚ åœ¨ CPU å±‚ï¼Œcmov æŒ‡ä»¤å¯ä»¥å®ç°åˆ†æ”¯æ¶ˆé™¤ï¼Œ&lt;&#x2F;p&gt;
&lt;p&gt;å·¥å…·ï¼š perf stat -e instructions,branches,branch-misses  command args
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;monthly&#x2F;2025-01&#x2F;img.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@techhara&#x2F;performance-optimization-efficient-cache-programming-f107dce3bef0&quot;&gt;Performance optimizationâ€”efficient cache programming 1&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å‡å°‘ struct çš„å¤§å°ï¼Œå¯¹å¤§æ•°ç»„ç±»çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥å‡å°‘å†…å­˜çš„å ç”¨ï¼Œä»è€Œæé«˜ cache çš„å‘½ä¸­ç‡ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.devgenius.io&#x2F;cpu-cache-how-to-write-code-to-make-the-cpu-execute-faster-cc0cf4969c4b&quot;&gt;How to write code to make the cpu execute faster&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Linux: &lt;code&gt;&#x2F;sys&#x2F;devices&#x2F;system&#x2F;cpu&#x2F;cpu0&#x2F;cache&#x2F;index[0123]&#x2F;size&lt;&#x2F;code&gt; for Level L1(IC) L1(DC), 2, 3 cache size.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;&#x2F;sys&#x2F;devices&#x2F;system&#x2F;cpu&#x2F;cpu0&#x2F;cache&#x2F;index[0123]&#x2F;coherency_line_size&lt;&#x2F;code&gt; for cache line size.&lt;&#x2F;li&gt;
&lt;li&gt;sched_setaffinity: set the CPU affinity of a process.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;array[i][j]&lt;&#x2F;code&gt; è®¿é—®é¡ºåºå¯¹ cache çš„å½±å“ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.scottredig.com&#x2F;blog&#x2F;bonkers_comptime&#x2F;&quot;&gt;Zig Comptime is Bonkers Good ç–¯ç‹‚çš„å¥½&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;view 0: è¯­æ³•å™ªéŸ³å°‘ï¼Œä½ å‡ ä¹å¯ä»¥å¿½ç•¥å®ƒã€‚&lt;&#x2F;li&gt;
&lt;li&gt;view 1: æ²¡æœ‰æ³›å‹ï¼Œä½†æœ‰æ›´å¥½çš„æ³›å‹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;view 2: ç¼–è¯‘æœŸæ‰§è¡Œçš„æ ‡å‡† zig ä»£ç ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;view 3&#x2F;4&#x2F;5: æ··åˆ comptime + runtimeï¼Œå±•å¼€æˆæ–°çš„ä»£ç ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;plasma-umass&#x2F;Mesh&#x2F;raw&#x2F;master&#x2F;mesh-pldi19-powers.pdf&quot;&gt;Mesh: compacting memory management for C&#x2F;C++ applications&lt;&#x2F;a&gt;
æ¦‚è§ˆäº†è¿™ç¯‡è®ºæ–‡ï¼Œå¾ˆæœ‰åˆ›æ„çš„å†…å­˜ç®¡ç†æ–¹å¼ï¼Œå‡å°‘ç‰©ç†å†…å­˜ç¢ç‰‡ï¼ˆè€Œéè™šæ‹Ÿå†…å­˜ï¼‰ï¼Œæé«˜ç‰©ç†å†…å­˜çš„ä½¿ç”¨æ•ˆç‡ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœä¸¤ä¸ª virtual page ä¸­çš„æ´»è·ƒåˆ†é…æ²¡æœ‰é‡å ï¼Œåˆ™å¯ä»¥åˆå¹¶æ˜ å°„åˆ°åŒä¸€ä¸ª physical page.&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ Linux ä¸Šï¼Œå¯ä»¥é€šè¿‡ &#x2F;dev&#x2F;mem æ¥è®¿é—®ç‰©ç†å†…å­˜ã€‚å¯ä»¥é€šè¿‡ &#x2F;proc&#x2F;pid&#x2F;pagemap, å‚è€ƒï¼š&lt;a href=&quot;https:&#x2F;&#x2F;codentium.com&#x2F;accessing-physical-memory-from-userspace-on-linux&#x2F;#&quot;&gt;Accessing physical memory from userspace on Linux&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Linux ç³»ç»Ÿè°ƒç”¨ &lt;code&gt;memfd_create(name, flags)&lt;&#x2F;code&gt; åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ï¼Œå…¶å†…å®¹åœ¨ virtual memory ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶æ¥ä¸‹æ¥åˆå¯ä»¥ mmap åˆ°è™šæ‹Ÿå†…å­˜ä¸­ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ Mac ä¸Šæ˜¯é€šè¿‡ mkstemp åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œä¿ç•™ fd ç„¶å unlink æ”¹æ–‡ä»¶ã€‚è¿™æ ·çš„è¯ï¼Œç†è®ºä¸Šä¼šå¤šä¸€ä¸ª IO çš„å¼€é”€ã€‚&lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;39779517&#x2F;does-mac-os-have-a-way-to-create-an-anonymous-file-mapping&quot;&gt;Stackoverflow&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;å‚è€ƒå®ç°ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;plasma-umass&#x2F;Mesh&quot;&gt;LibMesh&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gist.github.com&#x2F;ibireme&#x2F;173517c208c7dc333ba962c1f0d67d12&quot;&gt;M1: A demo shows how to read Intel or Apple M1 CPU performance counter in macOS.&lt;&#x2F;a&gt;&lt;br &#x2F;&gt;
ç»ˆäºæ‰¾åˆ°äº†ä¸€ä¸ªåœ¨ M1 ä¸‹åº¦é‡ IPC çš„æ–¹æ³•äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä¼šæ”¹è¿›ä¸€ä¸‹è¿™ä¸ªå·¥å…·ï¼Œåç»­å¯ä»¥ç”¨æ¥è¾…åŠ©åº¦é‡è‡ªå·±ç¼–å†™çš„ä»£ç çš„æ€§èƒ½ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘æŠŠè¿™ä¸ªå·¥å…·ç®€å•çš„æ”¹è¿›äº†ä¸€ä¸‹ï¼Œå¯ä»¥å¯¹æŸä¸ªè¿›è¡Œè¿›è¡Œåº¦é‡ï¼Œä»£ç æäº¤åˆ°äº† &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;m1_ipc_measure&quot;&gt;github&lt;&#x2F;a&gt; ä¸Šï¼Œç›®å‰è¿˜å¾ˆåŸå§‹ï¼Œ
ä½¿ç”¨æ–¹å¼ï¼š
&lt;ol&gt;
&lt;li&gt;clang -o kpc main.c&lt;&#x2F;li&gt;
&lt;li&gt;.&#x2F;kpc 2 command args  # å¯åŠ¨ command, å¹¶åº¦é‡ 2s çš„ IPC(ç›®å‰éœ€ç¡®ä¿ å‘½ä»¤æ‰§è¡Œæ—¶é•¿å¤§äº2s * 2)
å°±å¯ä»¥åº¦é‡å‡º IPC, branch misses ç­‰ä¿¡æ¯äº†ã€‚ä½¿ç”¨è¿™ä¸ªå·¥å…·åº¦é‡äº†ä¸€ä¸‹æœ€è¿‘çš„ 1brc ä»£ç ï¼ŒIPCè¾¾åˆ°äº† 4.70, branch misses ä¸º 2.6%ã€‚æœ‰è¿™äº›æ•°æ®ï¼Œå¯ä»¥
æ›´å¥½çš„æŒ‡å¯¼å¦‚ä½•è¿›è¡Œä»£ç ä¼˜åŒ–ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;å‚è€ƒï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;lemire&#x2F;Code-used-on-Daniel-Lemire-s-blog&#x2F;tree&#x2F;master&#x2F;2021&#x2F;03&#x2F;24&quot;&gt;Counting cycles and instructions on the Apple M1 processor&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;MPP &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;web-visualization&quot;&gt;Web &amp;amp; Visualization&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;tools-libraries&quot;&gt;Tools &amp;amp; Libraries&lt;&#x2F;h1&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>C++&#x2F;Rust é¢å‘CPUè¿›è¡Œä¼˜åŒ–</title>
        <published>2024-12-27T00:00:00+00:00</published>
        <updated>2024-12-27T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/c-optimize/"/>
        <id>https://wangzaixiang.github.io/blog/c-optimize/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/c-optimize/">&lt;p&gt;æœ¬æ–‡æ˜¯é˜…è¯» ã€Šä»ç°ä»£CPU ç‰¹æ€§å’Œç¼–è¯‘çš„è§’åº¦åˆ†æC++ ä»£ç ä¼˜åŒ–-ææˆæ ‹ã€‹çš„ç¬”è®°ä»¥åŠæˆ‘åšçš„ä¸€äº›å®éªŒã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;dan-wen-jian-bian-yi-vs-duo-wen-jian-bian-yi-lto&quot;&gt;å•æ–‡ä»¶ç¼–è¯‘ vs å¤šæ–‡ä»¶ç¼–è¯‘ &amp;amp; LTO&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;shi-yan&quot;&gt;å®éªŒ&lt;&#x2F;h2&gt;
&lt;p&gt;ç¤ºä¾‹ä»£ç ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cpp&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-cpp &quot;&gt;&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;compute&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int &lt;&#x2F;span&gt;&lt;span&gt;*&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;input&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int &lt;&#x2F;span&gt;&lt;span&gt;*&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;output&lt;&#x2F;span&gt;&lt;span&gt;){
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt;(*input &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;) *output = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt;(*input &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span&gt;) *output *= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;# include &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;stdio.h&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;args&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;char &lt;&#x2F;span&gt;&lt;span&gt;**&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;argv&lt;&#x2F;span&gt;&lt;span&gt;){
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;20&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt; o = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt; j = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;; j &amp;lt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;800000000&lt;&#x2F;span&gt;&lt;span&gt;; j++){
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;compute&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;i, &amp;amp;o);
&lt;&#x2F;span&gt;&lt;span&gt;  }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;printf&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;out = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;%d&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, o);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ol&gt;
&lt;li&gt;å•æ–‡ä»¶ç‰ˆæœ¬ã€‚
&lt;ul&gt;
&lt;li&gt;clang&lt;pre data-lang=&quot;text&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-text &quot;&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;  clang -O3 -o compute compute.cpp
&lt;&#x2F;span&gt;&lt;span&gt;  time .&#x2F;compute
&lt;&#x2F;span&gt;&lt;span&gt;  è€—æ—¶ 0.00s
&lt;&#x2F;span&gt;&lt;span&gt;  
&lt;&#x2F;span&gt;&lt;span&gt;  clang --target=x86_64-macos -O3 -o compute compute.c -- å¯ä»¥äº¤å‰ç¼–è¯‘ä¸º x86_64 çš„ä»£ç ã€‚
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;gcc ä¸ä¸Šç±»ä¼¼ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;å¤šæ–‡ä»¶ç‰ˆæœ¬ã€‚
å°†ä¸Šè¿°æ–‡ä»¶æ‹†åˆ†ä¸º compute.h, compute.cpp, main.cpp ä¸‰ä¸ªæ–‡ä»¶ã€‚
&lt;ul&gt;
&lt;li&gt;clang ä¸å¯åŠ¨ LTO&lt;pre data-lang=&quot;text&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-text &quot;&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;  clang -O3 -o compute compute.cpp main.cpp
&lt;&#x2F;span&gt;&lt;span&gt;  time .&#x2F;compute
&lt;&#x2F;span&gt;&lt;span&gt;  è€—æ—¶ 0.76s
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;clang å¯åŠ¨ LTO&lt;pre data-lang=&quot;text&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-text &quot;&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;  clang -O3 -flto -o compute compute.cpp main.cpp
&lt;&#x2F;span&gt;&lt;span&gt;  time .&#x2F;compute
&lt;&#x2F;span&gt;&lt;span&gt;  è€—æ—¶ 0.00s
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;gcc ä¸ä¸Šç±»ä¼¼ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;jie-lun&quot;&gt;ç»“è®º&lt;&#x2F;h2&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;ä»£ç ç»“æ„&lt;&#x2F;th&gt;&lt;th&gt;LTO&lt;&#x2F;th&gt;&lt;th&gt;è€—æ—¶&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;å•æ–‡ä»¶&lt;&#x2F;td&gt;&lt;td&gt;å¦&lt;&#x2F;td&gt;&lt;td&gt;0.00s&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;å¤šæ–‡ä»¶&lt;&#x2F;td&gt;&lt;td&gt;æ˜¯&lt;&#x2F;td&gt;&lt;td&gt;0.00s&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;å¤šæ–‡ä»¶&lt;&#x2F;td&gt;&lt;td&gt;å¦&lt;&#x2F;td&gt;&lt;td&gt;0.76s&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;ol&gt;
&lt;li&gt;å•æ–‡ä»¶æ—¶ï¼Œclang&#x2F;gcc ä¼šå°½å¯èƒ½çš„ inline ä¼˜åŒ–ï¼Œå…¶äº§ç”Ÿçš„ä»£ç å¦‚ä¸‹ï¼š
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;c-optimize&#x2F;img.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;
&lt;blockquote&gt;
&lt;p&gt;compute å‡½æ•°çš„ä»£ç åœ¨å†…è”åï¼Œå…¶å€¼ç›´æ¥è¢«è®¡ç®—å‡ºæ¥ï¼Œè€Œä¸æ˜¯é€šè¿‡å¾ªç¯è®¡ç®—ã€‚æ‰€ä»¥è€—æ—¶ä¸º0.00sã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;å¤šæ–‡ä»¶æ—¶ï¼Œé™¤éå¯åŠ¨ LTOï¼Œå¦åˆ™æ— æ³•è¿›è¡Œå†…è”ä¼˜åŒ–ã€‚æ‰€ä»¥è€—æ—¶ä¸º0.76sã€‚è€Œå¯åŠ¨ LTO åï¼Œå…¶ä»£ç ç»“æ„ä¸å•æ–‡ä»¶æ—¶ç±»ä¼¼ï¼Œæ‰€ä»¥è€—æ—¶ä¸º0.00sã€‚
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;c-optimize&#x2F;img_1.png&quot; alt=&quot;img_1.png&quot; &#x2F;&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;what-about-rust&quot;&gt;What about Rust?&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;Rust ä¸ C++ åœ¨ inline æ–¹é¢æ›´ä¸ºæ¿€è¿›ï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨ åŒä¸€ä¸ª crate å†…ï¼Œå³ä½¿æ˜¯ä¸åŒçš„ moduleï¼Œç¼–è¯‘å™¨ä¼šå°½å¯èƒ½çš„ inline å‡½æ•°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ä¸åŒçš„ crate ç®€ï¼Œé™¤éä½¿ç”¨ &lt;code&gt;#[inline]&lt;&#x2F;code&gt; æˆ–è€… &lt;code&gt;#[inline(always)]&lt;&#x2F;code&gt;ï¼Œå¦åˆ™æ— æ³•è¿›è¡Œå†…è”ä¼˜åŒ–ã€‚è¿™ä¸ªå¹¶ä¸éœ€è¦å¼€å¯ LTOã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;aliasing&quot;&gt;Aliasing&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;c&quot;&gt;C++&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;cpp&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-cpp &quot;&gt;&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;compute&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt;* &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;__restrict__ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;input&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt;* &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;__restrict__ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;output&lt;&#x2F;span&gt;&lt;span&gt;){
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt;(*input &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;) *output = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt;(*input &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span&gt;) *output *= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;code&gt;__restrict__&lt;&#x2F;code&gt; é™å®šäº† input ä¸ output ä¸ä¼šæŒ‡å‘åŒä¸€ä¸ªåœ°å€ï¼Œ(ä¸ä¼šæ˜¯åŒä¸€ä¸ªæ•°æ®çš„ä¸¤ä¸ªåˆ«å)ï¼Œè¿™æ ·ç¼–è¯‘å™¨å¯ä»¥æ›´å¥½çš„ä¼˜åŒ–ä»£ç ï¼Œä¾‹å¦‚ï¼Œä¸¤æ¬¡ &lt;code&gt;*input&lt;&#x2F;code&gt;
æ“ä½œå°±æ— éœ€ä»å†…å­˜ä¸­è¯»å–ä¸¤æ¬¡ï¼Œè€Œæ˜¯è¯»å–ä¸€æ¬¡åï¼Œç¬¬äºŒæ¬¡è®¿é—®æ—¶ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨è¯¥å€¼ã€‚&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;ä»£ç ç»“æ„&lt;&#x2F;th&gt;&lt;th&gt;&lt;strong&gt;restrict&lt;&#x2F;strong&gt;&lt;&#x2F;th&gt;&lt;th&gt;è€—æ—¶&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;å¤šæ–‡ä»¶&lt;&#x2F;td&gt;&lt;td&gt;å¦&lt;&#x2F;td&gt;&lt;td&gt;0.76s&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;å¤šæ–‡ä»¶&lt;&#x2F;td&gt;&lt;td&gt;æ˜¯&lt;&#x2F;td&gt;&lt;td&gt;0.76s&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;p&gt;ä¼˜åŒ–ç»“æœå¹¶ä¸æ˜æ˜¾ï¼šä¸»è¦æ˜¯å› ä¸º L1 cache çš„å­˜åœ¨ï¼Œå³ä½¿æ˜¯ä¸¤æ¬¡è¯»å–ï¼Œä¹Ÿä¸ä¼šæœ‰å¤ªå¤§çš„æ€§èƒ½æŸå¤±ã€‚
å¯¹åº”çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;c-optimize&#x2F;img_2.png&quot; alt=&quot;img_2.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Aliasing æ¶ˆé™¤åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ä¼šå¸¦æ¥æ›´ä¸ºæ˜æ˜¾çš„ä¼˜åŒ–ï¼ˆè¿™ä¸ªä¾‹å­ä¸å¤Ÿæ˜æ˜¾ï¼‰ï¼Œå¯ä»¥å‚è€ƒï¼š&lt;a href=&quot;&#x2F;blog&#x2F;rust-cpp-comparison&#x2F;&quot;&gt;Rust vs C++: A Performance Comparison&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;h1 id=&quot;fen-zhi-you-hua&quot;&gt;åˆ†æ”¯ä¼˜åŒ–&lt;&#x2F;h1&gt;
&lt;p&gt;ç†è®ºä¸Šï¼Œåˆ†æ”¯é¢„æµ‹å¤±è´¥ä¼šå¯¼è‡´æµæ°´çº¿çš„ç©ºè½¬ï¼Œä»è€Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚ä½†åˆ°åº•åˆ†æ”¯é¢„æµ‹å¤±è´¥ä¼šå¯¼è‡´å¤šå°‘æ€§èƒ½ä¸‹é™ï¼Œæ˜¯å¦éœ€è¦å¼•èµ·é‡è§†å‘¢ï¼Ÿ&lt;&#x2F;p&gt;
&lt;p&gt;æˆ‘ä¹‹å‰æœ‰åœ¨ Rust çš„ std åº“ä¸­çœ‹åˆ° &lt;code&gt;std::intrinsics::likely&lt;&#x2F;code&gt; çš„ç”¨æ³•ï¼Œä¾‹å¦‚ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; from core::slice::sort::stable
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;sort&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;T, F: FnMut(&amp;amp;T, &amp;amp;T) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;bool&lt;&#x2F;span&gt;&lt;span&gt;, BufT: BufGuard&amp;lt;T&amp;gt;&amp;gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;v&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; [T], &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;is_less&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; F) {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Arrays of zero-sized types are always all-equal, and thus sorted.
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;T::&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;IS_ZST &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Instrumenting the standard library showed that 90+% of the calls to sort
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; by rustc are either of size 0 or 1.
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; len = v.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;intrinsics::likely(len &amp;lt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;   ...
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è¿™ä¸ªä¾‹å­æä¾›äº†å¯¹åˆ†æ”¯é¢„æµ‹å¤±è´¥çš„æ€§èƒ½æŸå¤±çš„ä¸€ä¸ªè¯„ä¼°ã€‚æˆ‘æŠŠä½œè€…çš„ä»£ç ä½¿ç”¨ Rust é‡å†™äº†ä¸€éï¼Œç„¶åè¿›è¡Œäº†ä¸€äº›å®éªŒã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span&gt;#![&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;feature&lt;&#x2F;span&gt;&lt;span&gt;(core_intrinsics)]
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;compute&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;input&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;output&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut i32&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;    #[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;not&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;any&lt;&#x2F;span&gt;&lt;span&gt;(feature = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;likely&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, feature = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;unlikely&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)))]
&lt;&#x2F;span&gt;&lt;span&gt;    {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;*input &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10 &lt;&#x2F;span&gt;&lt;span&gt;{  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; compiler as likely
&lt;&#x2F;span&gt;&lt;span&gt;            *output = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;*input &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;5 &lt;&#x2F;span&gt;&lt;span&gt;{  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; compiler as likely
&lt;&#x2F;span&gt;&lt;span&gt;            *output *= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    #[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(feature = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;likely&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;    {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;std::intrinsics::likely(*input &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;            *output = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;std::intrinsics::likely(*input &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;            *output *= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    #[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(feature = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;unlikely&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;    {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;std::intrinsics::unlikely(*input &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;            *output = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;std::intrinsics::unlikely(*input &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;            *output *= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;(){
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;20&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; o = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;compute&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;, &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; o);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; tm0 = std::time::Instant::now();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; j = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; j &amp;lt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1_000_000_000&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32 &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;compute&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;i, &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; o); }
&lt;&#x2F;span&gt;&lt;span&gt;        j += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; tm1 = std::time::Instant::now();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    #[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;not&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;any&lt;&#x2F;span&gt;&lt;span&gt;(feature = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;likely&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, feature = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;unlikely&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)))]
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; msg = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;normal&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;;
&lt;&#x2F;span&gt;&lt;span&gt;    #[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(feature = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;likely&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; msg = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;likely&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;;
&lt;&#x2F;span&gt;&lt;span&gt;    #[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(feature = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;unlikely&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; msg = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;unlikely&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    println!(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{msg}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt; out = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt; time = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{:?}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, o, tm1-tm0 );
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;feature&lt;&#x2F;th&gt;&lt;th&gt;è€—æ—¶&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;normal&lt;&#x2F;td&gt;&lt;td&gt;1.253s&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;unlikely&lt;&#x2F;td&gt;&lt;td&gt;1.267s&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;likely&lt;&#x2F;td&gt;&lt;td&gt;0.955s&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;p&gt;å¯¹åº”çš„ä»£ç çš„å·®å¼‚å¦‚ä¸‹ï¼š
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;c-optimize&#x2F;img_3.png&quot; alt=&quot;img_3.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;ä»è¿™ä¸ªç”Ÿæˆçš„ä»£ç æ¥çœ‹ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;normal æ¨¡å¼ä¸‹ï¼Œç¼–è¯‘æœŸçš„é¢„æµ‹ä¸å®é™…æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œä½†ç”Ÿæˆçš„ä»£ç æ•ˆç‡ä¸ likely ä¸‹çš„æ•ˆç‡åƒå·®å¾ˆå¤§ï¼Œä¸»è¦åŸå› åº”è¯¥æ˜¯ æ— æ¡ä»¶branch å¯¼è‡´çš„æµæ°´çº¿çš„ç©ºè½¬ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;unlikely æ¨¡å¼ä¸‹ï¼Œä¸¤ä¸ª if åˆ†æ”¯çš„é¢„æµ‹éƒ½æ˜¯é”™è¯¯çš„ï¼Œå…¶æ€§èƒ½ç›¸æ¯” likely ä¸‹é™äº† 25%ï¼Œ åº”è¯¥è¯´è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å³ä½¿æ˜¯ likely å®Œå…¨é¢„æµ‹å‡†ç¡®ï¼Œä¹Ÿæœ‰å¯èƒ½ç”Ÿæˆä¸å¤Ÿé«˜æ•ˆçš„ä»£ç ã€‚è¿™é‡Œçš„ normal æ¨¡å¼å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ–è®¸æœ€ç»ˆçš„æ–¹æ¡ˆè¿˜æ˜¯è¦æ‰‹å†™çš„æ±‡ç¼–æ‰èƒ½è¾¾åˆ°æœ€ä¼˜ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;links&quot;&gt;links&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@techhara&#x2F;performance-optimization-technique-branchless-programming-a40c0a35511e&quot;&gt;Performance optimization â€” branchless programming&lt;&#x2F;a&gt;
è¿™ç¯‡æ–‡ç« ä¸­çš„ç¤ºä¾‹ï¼Œé€šè¿‡æ¶ˆé™¤åˆ†æ”¯ï¼Œå®ç°äº† 6-7å€çš„æ€§èƒ½æå‡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@techhara&#x2F;performance-optimization-efficient-cache-programming-f107dce3bef0&quot;&gt;Performance optimizationâ€”efficient cache programming 1&lt;&#x2F;a&gt;
é€šè¿‡å‡å°‘ struct çš„å¤§å°ï¼Œæé«˜ cache å‘½ä¸­ç‡ï¼Œæ€§èƒ½æå‡ 31%ï¼Œ cache miss rate ä» 39% é™ä½åˆ° 13%ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.devgenius.io&#x2F;cpu-cache-how-to-write-code-to-make-the-cpu-execute-faster-cc0cf4969c4b&quot;&gt;How to write code to make the cpu execute faster&lt;&#x2F;a&gt;
cache å‹å¥½çš„ä»£ç ç¼–å†™ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>ä¸€ä¸ª Zig ç¼–è¯‘å™¨çš„ Bug</title>
        <published>2024-12-05T00:00:00+00:00</published>
        <updated>2024-12-05T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/a-zig-bug/"/>
        <id>https://wangzaixiang.github.io/blog/a-zig-bug/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/a-zig-bug/">&lt;h1 id=&quot;yi-ge-zig-bian-yi-qi-de-bug&quot;&gt;ä¸€ä¸ª Zig ç¼–è¯‘å™¨çš„ Bug&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨åŠ¨æ‰‹å­¦ä¹  Zig çš„è¿‡ç¨‹ä¸­ï¼Œåœ¨æ¢ç´¢stackä¸­å˜é‡çš„memory layoutæ—¶ï¼Œå‘ç°äº†äº†ä¸€ä¸ª Bugï¼Œå·²æäº¤åˆ° &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;ziglang&#x2F;zig&#x2F;issues&#x2F;22140&quot;&gt;github&lt;&#x2F;a&gt;ã€‚
åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;zig&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-zig &quot;&gt;&lt;code class=&quot;language-zig&quot; data-lang=&quot;zig&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; std = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@import&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;std&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; SIZE = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1024 &lt;&#x2F;span&gt;&lt;span&gt;* &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;256&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;() !&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;arr&lt;&#x2F;span&gt;&lt;span&gt;: [SIZE]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;undefined&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for &lt;&#x2F;span&gt;&lt;span&gt;(arr, 0..) |&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;_&lt;&#x2F;span&gt;&lt;span&gt;, i| {
&lt;&#x2F;span&gt;&lt;span&gt;        arr[i] = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;@intCast&lt;&#x2F;span&gt;&lt;span&gt;(i);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    std.debug.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;print&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;main &amp;amp;arr = {*}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, .{&amp;amp;arr});
&lt;&#x2F;span&gt;&lt;span&gt;    std.debug.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;print&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;main &amp;amp;arr = {*} same as above &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, .{&amp;amp;arr}); &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; same as above
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    std.debug.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;print&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;passArray for mutable array&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, .{});
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;passArray&lt;&#x2F;span&gt;&lt;span&gt;(arr);
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;passArray&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;arr&lt;&#x2F;span&gt;&lt;span&gt;: [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SIZE&lt;&#x2F;span&gt;&lt;span&gt;]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;p1&lt;&#x2F;span&gt;&lt;span&gt;: *&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; [SIZE]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32 &lt;&#x2F;span&gt;&lt;span&gt;= &amp;amp;arr;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; p2 = &amp;amp;arr;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;p3&lt;&#x2F;span&gt;&lt;span&gt;: [*]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const u32 &lt;&#x2F;span&gt;&lt;span&gt;= &amp;amp;arr;
&lt;&#x2F;span&gt;&lt;span&gt;    std.debug.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;print&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;inside passArray &amp;amp;arr = {*} p2 = {*} p3 = {*}  p1 != p2 != p3 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, .{ p1, p2, p3 });
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; LOOP = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3&lt;&#x2F;span&gt;&lt;span&gt;; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; when LOOP = 14, the program will crash
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    std.debug.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;print&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;LOOP = {} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, .{LOOP});
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;inline for &lt;&#x2F;span&gt;&lt;span&gt;(0..LOOP) |&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;_&lt;&#x2F;span&gt;&lt;span&gt;| {
&lt;&#x2F;span&gt;&lt;span&gt;        std.debug.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;print&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;inside passArray, &amp;amp;arr = {*} not same as above.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, .{&amp;amp;arr}); &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; &amp;amp;arr increase SIZE * 4 every time
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;} 
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;

&lt;img src=&quot;https:&amp;#x2F;&amp;#x2F;wangzaixiang.github.io&amp;#x2F;processed_images&amp;#x2F;a_zig_bug.643ff30a512ae452.png&quot; &#x2F;&gt;
&lt;p&gt;å› ä¸ºæ¯æ¬¡ &lt;code&gt;&amp;amp;arr&lt;&#x2F;code&gt; æ“ä½œéƒ½å¯¼è‡´åœ¨æ ˆä¸Šå¤åˆ¶äº†ä¸€ä¸ªæ•°ç»„ï¼Œå› æ­¤ï¼Œå¦‚æœæ•°ç»„é•¿åº¦è¾ƒå¤§ï¼Œ&lt;code&gt;&amp;amp;arr&lt;&#x2F;code&gt; æ“ä½œæ¬¡æ•°è¾ƒå¤šæ—¶ï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸Šè¿°çš„ä»£ç ä¸­ï¼Œ1M * 14 = 14Mï¼Œ åœ¨æˆ‘
çš„ Mac ä¸Šï¼Œå°±ä¼šå‡ºç° SIGSEV é”™è¯¯ ( åº”è¯¥æ˜¯ StackOverflow äº† )ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨å›½å†…çš„ Zig ç¾¤é—®äº†ä¸€ä¸‹ï¼Œä¼—è¯´çº·çº­ï¼Œæœ‰å¤§ç¥åšæŒè®¤ä¸ºè¿™ä¸ªä¸æ˜¯ bugï¼Œè€Œæ˜¯ constcast çš„å¿…ç„¶ç»“æœï¼Œä¸è¿‡æˆ‘å¹¶ä¸èƒ½ç†è§£ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;&amp;amp;arr&lt;&#x2F;code&gt; åªæ˜¯ä¸€ä¸ªå–åœ°å€æ“ä½œï¼Œå¹¶ä¸ä¼šæ”¹å˜æ•°æ®ç±»å‹ã€‚å¦‚æœåŸæ¥æ˜¯ const çš„ï¼Œç»“æœå°±æ˜¯ &lt;code&gt;*const [N]&lt;&#x2F;code&gt; å¦åˆ™å°±æ˜¯ &lt;code&gt;*[N]&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;ä¸åŒäº rust, zig å¹¶æ²¡æœ‰ &lt;code&gt;&amp;amp;x&lt;&#x2F;code&gt; å’Œ &lt;code&gt;&amp;amp;mut x&lt;&#x2F;code&gt; çš„åŒºåˆ«ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;&amp;amp;arr&lt;&#x2F;code&gt; å¯¼è‡´æ•°ç»„å¤åˆ¶ï¼Œä¸ä»…ä¼šå¯¼è‡´æ ˆå†…å­˜çš„æµªè´¹ï¼Œè€Œä¸”ä¹Ÿå¢åŠ äº†ä¸å¿…è¦çš„ä»£ç æˆæœ¬ã€‚æ›´ä¸¥é‡çš„ä¼šå¯¼è‡´ StackOverflowï¼Œå…¶å®è¿˜æ˜¯ä¸€ä¸ªæ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;æäº¤åˆ° github ä¸Šï¼Œå¾ˆå¿«è·å¾—äº† core team çš„ç¡®è®¤ï¼Œå·²æ¥å—ä½œä¸ºä¸€ä¸ªBugï¼Œå¹¶æ·»åŠ åˆ°äº† 0.14 çš„ milestone ä¸­ã€‚&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Zig Comptime</title>
        <published>2024-12-05T00:00:00+00:00</published>
        <updated>2024-12-05T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/zig-comptime/"/>
        <id>https://wangzaixiang.github.io/blog/zig-comptime/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/zig-comptime/">&lt;h1 id=&quot;1-what-is-zig-other-than-others&quot;&gt;1. what is zig other than others?&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;zen: Only one obvious way to do things. æ˜¾ç¤ºï¼Œç›´æ¥ã€‚
&lt;ul&gt;
&lt;li&gt;No Hidden control flow. æ²¡æœ‰éšè—çš„å‡½æ•°è°ƒç”¨ã€‚ï¼ˆå½“ç„¶ä¹Ÿæ²¡æœ‰ææ„å‡½æ•°ã€éšå¼è½¬æ¢ã€è‡ªåŠ¨è§£å¼•ç”¨ç­‰ç­‰ï¼‰ã€‚ç¼ºç‚¹æ˜¯æŠ½è±¡å¯èƒ½ä¸å¤Ÿï¼Œä¼˜ç‚¹æ˜¯ä»£ç æ›´ç›´æ¥ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;No hidden allocations. çœ‹ä¸€ä¸ªå‡½æ•°æ˜¯å¦æœ‰å†…å­˜åˆ†é…ï¼Œåªéœ€è¦çœ‹å®ƒæ˜¯å¦æœ‰ allocator å‚æ•°äº†&lt;&#x2F;li&gt;
&lt;li&gt;No variable shadowing. è™½ç„¶å†™ä»£ç æ—¶ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›ä¸ä¾¿ï¼Œä½†å¯¹é˜…è¯»ä»£ç æ¥è¯´ï¼Œæ›´ç›´æ¥ä¸€äº›ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;comptime
&lt;ul&gt;
&lt;li&gt;zig comptime vs rust macro&lt;&#x2F;li&gt;
&lt;li&gt;zig comptime vs Scala meta programming.&lt;&#x2F;li&gt;
&lt;li&gt;If a container level variable is const then its value is comptime-known, otherwise it is runtime-known&lt;&#x2F;li&gt;
&lt;li&gt;type&#x2F; std.built.Type ç­‰ç±»å‹ï¼Œåªå­˜åœ¨äº comptime ä¸­ï¼Œå¾ˆå¤šä»£ç éœ€è¦å¯ inline.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;2-comptime-expression-shi-ru-he-zhi-xing-de&quot;&gt;2. comptime expression æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ&lt;&#x2F;h1&gt;
&lt;pre data-lang=&quot;zig&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-zig &quot;&gt;&lt;code class=&quot;language-zig&quot; data-lang=&quot;zig&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; main.zig
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; std = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@import&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;std&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; è¿™ä¸ªæ–¹æ³•æ²¡æœ‰å¤ªå¤§çš„ä¸šåŠ¡é€»è¾‘ï¼Œç›®çš„ä»…ä»…æ˜¯é˜²æ­¢ä¼˜åŒ–ï¼Œè®© longLoop(n) æ–¹æ³•çš„è€—æ—¶æ›´æ˜æ˜¾
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;longLoop&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;n&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;i&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt;(i &amp;lt; n) : (i += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum2&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; skip = i % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10 &lt;&#x2F;span&gt;&lt;span&gt;+ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;j&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt;(j &amp;lt; n) : (j += skip) {
&lt;&#x2F;span&gt;&lt;span&gt;            sum2 += j;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        sum += sum2;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return&lt;&#x2F;span&gt;&lt;span&gt; sum;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;() !&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; n = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;6000&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; show times of longLoop(n)
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; start = std.time.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;milliTimestamp&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; result = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;longLoop&lt;&#x2F;span&gt;&lt;span&gt;(n);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; end = std.time.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;milliTimestamp&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    std.debug.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;print&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;runtime  eval: n = {}, result = {}, time = {}ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, .{ n,  result, end - start});
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; start2 = std.time.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;milliTimestamp&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;@setEvalBranchQuota&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1_000_000_000&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; result2 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;comptime &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;longLoop&lt;&#x2F;span&gt;&lt;span&gt;(n);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; end2 = std.time.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;milliTimestamp&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    std.debug.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;print&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;comptime eval: n = {}, result = {}, time = {}ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, .{ n,  result2, end2 - start2});
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ç¼–è¯‘ main.zig, &lt;code&gt;zig build-exe -O ReleaseFast src&#x2F;main.zig&lt;&#x2F;code&gt;, è€—æ—¶ 21s. è°ƒæ•´ comptime longLoop(n) çš„å‚æ•°ï¼Œ åˆ†åˆ«è€—æ—¶å¦‚ä¸‹ï¼š&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;n&lt;&#x2F;th&gt;&lt;th&gt;compile time&lt;&#x2F;th&gt;&lt;th&gt;runtime eval&lt;&#x2F;th&gt;&lt;th&gt;comptime eval&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;1&lt;&#x2F;td&gt;&lt;td&gt;4.5s&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;10&lt;&#x2F;td&gt;&lt;td&gt;4.5s&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;100&lt;&#x2F;td&gt;&lt;td&gt;4.5s&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;1000&lt;&#x2F;td&gt;&lt;td&gt;5.0s&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;2000&lt;&#x2F;td&gt;&lt;td&gt;6.6s&lt;&#x2F;td&gt;&lt;td&gt;1ms&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;3000&lt;&#x2F;td&gt;&lt;td&gt;8.6s&lt;&#x2F;td&gt;&lt;td&gt;3ms&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;4000&lt;&#x2F;td&gt;&lt;td&gt;11.9s&lt;&#x2F;td&gt;&lt;td&gt;3ms&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;5000&lt;&#x2F;td&gt;&lt;td&gt;15.9s&lt;&#x2F;td&gt;&lt;td&gt;4ms&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;6000&lt;&#x2F;td&gt;&lt;td&gt;21.0s&lt;&#x2F;td&gt;&lt;td&gt;9ms&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;7000&lt;&#x2F;td&gt;&lt;td&gt;27.0s&lt;&#x2F;td&gt;&lt;td&gt;12ms&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;8000&lt;&#x2F;td&gt;&lt;td&gt;33.9s&lt;&#x2F;td&gt;&lt;td&gt;14ms&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;9000&lt;&#x2F;td&gt;&lt;td&gt;41.9s&lt;&#x2F;td&gt;&lt;td&gt;18ms&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;10000&lt;&#x2F;td&gt;&lt;td&gt;50.7s&lt;&#x2F;td&gt;&lt;td&gt;19ms&lt;&#x2F;td&gt;&lt;td&gt;0ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;p&gt;ä»ä¸Šè¿°æ•°æ®å¯ä»¥çœ‹å‡ºï¼Œ&lt;code&gt;comptime longLoop(n)&lt;&#x2F;code&gt; éšç€ n çš„å¢é•¿ï¼Œ compile time ä¼šæ˜¾è‘—å¢é•¿ï¼Œn == 1000 æ—¶ï¼Œç¼–è¯‘æ—¶é•¿ä¸º5sï¼Œè€Œ n = 10000 æ—¶
ç¼–è¯‘æ—¶é•¿ä¸º50sã€‚è€Œ runtime eval çš„è€—æ—¶ä»…ä»…æ˜¯ä» 0ms å¢é•¿åˆ° 19ms, è¿™å¯ä»¥è¯´æ˜ï¼Œcompile é˜¶æ®µï¼Œcomptime eval å¹¶é native æ–¹å¼æ‰§è¡Œ longLoop
ä»£ç ï¼Œè€Œæ˜¯é‡‡ç”¨äº†ä¸€ç§ AST interpreter çš„æ–¹å¼æ‰§è¡Œä»£ç ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæ•ˆç‡æœ‰ä¸Šåƒå€çš„å·®è·ã€‚ï¼ˆè¿™ä¸ªæ¡ˆä¾‹ä»…ä¸ºæµ‹è¯•ç›®çš„ï¼Œå®é™… comptime çš„è€—æ—¶å·®è·ä¸€èˆ¬
ä¼šæ˜¾è‘—ä½äºè¿™ä¸ªå·®è·ï¼Œç”šè‡³åœ¨å¤§éƒ¨ä»½æƒ…å†µä¸‹ï¼Œå¯¹ä½¿ç”¨è€…æ— æ˜æ˜¾æ„ŸçŸ¥ï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ä¹‹å‰ï¼Œæˆ‘æ˜¯ä½¿ç”¨ fib(n) æ¥æµ‹è¯• comptime çš„ï¼Œå‚è€ƒï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;zig&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-zig &quot;&gt;&lt;code class=&quot;language-zig&quot; data-lang=&quot;zig&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; std=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@import&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;std&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;fibonacci&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;index&lt;&#x2F;span&gt;&lt;span&gt;:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64 &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;(index &amp;lt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return&lt;&#x2F;span&gt;&lt;span&gt; index;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;fibonacci&lt;&#x2F;span&gt;&lt;span&gt;(index&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;-1&lt;&#x2F;span&gt;&lt;span&gt;)+ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;fibonacci&lt;&#x2F;span&gt;&lt;span&gt;(index - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;() !&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;n&lt;&#x2F;span&gt;&lt;span&gt;:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;50&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; const result = fibonacci(n);&#x2F;&#x2F; run: 37.8s,compile:4.34s
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; result = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;comptime &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;fibonacci&lt;&#x2F;span&gt;&lt;span&gt;(n); &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; compile 4.3s run: 0s
&lt;&#x2F;span&gt;&lt;span&gt;     std.debug.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;print&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;fib(f})= {}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, .{n, result }); 
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è¿™ä¸ªæ¡ˆä¾‹çœ‹èµ·æ¥å¾ˆåå¸¸ï¼šfib(50) åœ¨è¿è¡ŒæœŸæ‰§è¡Œè€—æ—¶ 37.8s, è€Œ comptime è€—æ—¶åˆ™è¿‘ä¹ä¸º0ï¼ˆ4.34s æ˜¯zig compile -O ReleaseFast çš„åŸºå‡†æ—¶é—´ï¼‰ï¼Œä¸ºä»€ä¹ˆ
comptime çš„è€—æ—¶è¿™ä¹ˆä½å‘¢ï¼ŸçŒœæµ‹æ˜¯å¯¹ fib è®¡ç®—è¿›è¡Œäº† cache ä¼˜åŒ–ï¼Œè¿™ä¸€ç‚¹ä¹Ÿä» zig çš„æ–‡æ¡£ä¸­å¾—åˆ°äº†è¯å®ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;zig&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-zig &quot;&gt;&lt;code class=&quot;language-zig&quot; data-lang=&quot;zig&quot;&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Functions called at compile-time are memoized. This means you can
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; do this:
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;expect&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;LinkedList&lt;&#x2F;span&gt;&lt;span&gt;(i32) == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;LinkedList&lt;&#x2F;span&gt;&lt;span&gt;(i32));
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å› ä¸º zig å¯¹ AST çš„è§£é‡Šæ‰§è¡Œï¼Œå¹¶ä¸”è¿›è¡Œäº† memoize ä¼˜åŒ–ï¼Œæ‰€ä»¥æ‰æœ‰äº†åœ¨è¿™é‡Œï¼Œè§£é‡Šæ‰§è¡Œæ¯”ç¼–è¯‘æ‰§è¡Œç‰ˆæœ¬æ›´å¿«çš„æƒ…å†µã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;comptime evaluation æ˜¯åœ¨ Sema é˜¶æ®µå®Œæˆçš„ã€‚å‚è€ƒæ–‡æ¡£ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;mitchellh.com&#x2F;zig&#x2F;sema&quot;&gt;Zig Sema&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æˆ‘è¿˜æ²¡æœ‰çœ‹æ‡‚è¿™ç¯‡æ–‡ç« ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;3-dynamic-construct-a-type-in-comptime&quot;&gt;3. dynamic construct a type in comptime&lt;&#x2F;h1&gt;
&lt;p&gt;Zig å¯ä»¥é€šè¿‡ comptime æ¥å®ç° genericï¼Œä½†å®˜ç½‘ç»™çš„ä¾‹å­è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;zig&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-zig &quot;&gt;&lt;code class=&quot;language-zig&quot; data-lang=&quot;zig&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;List&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;comptime &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;T&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return struct &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;items&lt;&#x2F;span&gt;&lt;span&gt;: []&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;T&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    };
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; The generic List data structure can be instantiated by passing in a type:
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;buffer&lt;&#x2F;span&gt;&lt;span&gt;: [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;undefined&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var&lt;&#x2F;span&gt;&lt;span&gt; list = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;List&lt;&#x2F;span&gt;&lt;span&gt;(i32){
&lt;&#x2F;span&gt;&lt;span&gt;    .items = &amp;amp;buffer,
&lt;&#x2F;span&gt;&lt;span&gt;    .len = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ„é€ çš„ &lt;code&gt;List(i32)&lt;&#x2F;code&gt; è¿˜æ˜¯æ„Ÿè§‰ä¸å¤ŸåŠ¨æ€ï¼Œè­¬å¦‚ï¼Œæ˜¯å¦å¯ä»¥ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ç»“æ„ä½“çš„æˆå‘˜æ•°é‡ã€ç±»å‹æ˜¯åŠ¨æ€çš„ï¼Ÿ&lt;&#x2F;li&gt;
&lt;li&gt;ç»“æ„ä½“å†…çš„ fn æ˜¯åŠ¨æ€çš„ï¼Ÿ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;è¿™ä¸€åˆ‡çš„å¥¥ç§˜ï¼Œéšè—åœ¨ &lt;code&gt;@typeInfo&lt;&#x2F;code&gt;, &lt;code&gt;@Type&lt;&#x2F;code&gt; è¿™å‡ ä¸ªå†…ç½®å‡½æ•°ä¸­ã€‚å¦‚ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š User2 æ˜¯ä¸€ä¸ª comptime åŠ¨æ€è®¡ç®—å‡ºæ¥çš„ç±»å‹ï¼Œå…¶ä¸€éƒ¨ä»½
å­—æ®µæ˜¯ä» User è¿™ä¸ªæ¨¡ç‰ˆç±»å‹ä¸­å¤åˆ¶æ¥çš„ï¼Œemail å­—æ®µåˆ™æ˜¯åŠ¨æ€æ·»åŠ ä¸Šå»çš„ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;zig&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-zig &quot;&gt;&lt;code class=&quot;language-zig&quot; data-lang=&quot;zig&quot;&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; std = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@import&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;std&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; used as a type Template
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span&gt;User = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;: [:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const u8&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;age&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; print = std.debug.print;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;t_info&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;std.builtin.Type &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;@typeInfo&lt;&#x2F;span&gt;&lt;span&gt;(User);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; dynamic construct a Type
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;t_info2&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;std.builtin.Type &lt;&#x2F;span&gt;&lt;span&gt;= .{
&lt;&#x2F;span&gt;&lt;span&gt;       .Struct = .{
&lt;&#x2F;span&gt;&lt;span&gt;          .layout = t_info.Struct.layout,
&lt;&#x2F;span&gt;&lt;span&gt;           .backing_integer =  t_info.Struct.backing_integer,
&lt;&#x2F;span&gt;&lt;span&gt;           .fields = &amp;amp; .{
&lt;&#x2F;span&gt;&lt;span&gt;               .{
&lt;&#x2F;span&gt;&lt;span&gt;                   .name = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;NAME&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;                   .type = t_info.Struct.fields[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;].type,
&lt;&#x2F;span&gt;&lt;span&gt;                   .default_value = t_info.Struct.fields[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;].default_value,
&lt;&#x2F;span&gt;&lt;span&gt;                   .is_comptime = t_info.Struct.fields[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;].is_comptime,
&lt;&#x2F;span&gt;&lt;span&gt;                   .alignment = t_info.Struct.fields[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;].alignment
&lt;&#x2F;span&gt;&lt;span&gt;               },
&lt;&#x2F;span&gt;&lt;span&gt;               .{
&lt;&#x2F;span&gt;&lt;span&gt;                   .name = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;AGE&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;                   .type = t_info.Struct.fields[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;].type,
&lt;&#x2F;span&gt;&lt;span&gt;                   .default_value = t_info.Struct.fields[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;].default_value,
&lt;&#x2F;span&gt;&lt;span&gt;                   .is_comptime = t_info.Struct.fields[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;].is_comptime,
&lt;&#x2F;span&gt;&lt;span&gt;                   .alignment = t_info.Struct.fields[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;].alignment
&lt;&#x2F;span&gt;&lt;span&gt;               },
&lt;&#x2F;span&gt;&lt;span&gt;               .{
&lt;&#x2F;span&gt;&lt;span&gt;                   .name = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;email&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;                   .type = [:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; u8,
&lt;&#x2F;span&gt;&lt;span&gt;                   .default_value = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;null&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;                   .is_comptime = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;                   .alignment = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1
&lt;&#x2F;span&gt;&lt;span&gt;               }
&lt;&#x2F;span&gt;&lt;span&gt;           },
&lt;&#x2F;span&gt;&lt;span&gt;           .decls = t_info.Struct.decls,
&lt;&#x2F;span&gt;&lt;span&gt;           .is_tuple = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;false
&lt;&#x2F;span&gt;&lt;span&gt;       }
&lt;&#x2F;span&gt;&lt;span&gt;    };
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; build type User2
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; User2 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;@Type&lt;&#x2F;span&gt;&lt;span&gt;(t_info2);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; now, User2 can be used in source code.
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;u&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;User2 &lt;&#x2F;span&gt;&lt;span&gt;= .{
&lt;&#x2F;span&gt;&lt;span&gt;        .NAME = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;WANGZX&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        .AGE = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;20&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        .email = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;wangzx@qq.com&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    };
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;print&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;Users = {any}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, .{User2});
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;print&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;u.NAME = {s}, u.AGE = {d} u.email = {s}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        .{ u.NAME, u.AGE, u.email });
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;4-dui-bi-scala3-macro&quot;&gt;4. å¯¹æ¯” Scala3 Macro&lt;&#x2F;h1&gt;
&lt;p&gt;æˆ‘å¯¹ Scala3 Macro äº†è§£è¾ƒå¤šï¼Œwsql, wjsonç­‰é¡¹ç›®éƒ½æ·±åº¦ä¾èµ– macro æä¾›çš„å¼ºå¤§èƒ½åŠ›ï¼Œrust macro åˆ™åªæ˜¯æ³›æ³›äº†è§£ã€‚å› æ­¤ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œä¼šå¯¹ç…§
Scala3 macro æ¥ç†è§£ zig comptime.&lt;&#x2F;p&gt;
&lt;p&gt;ç”±äºç›®å‰ zig comptime æ‰§è¡Œçš„ä¸€äº›é™åˆ¶ï¼Œä¾‹å¦‚ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸èƒ½æœ‰ runtime side effects, åŠ ä¸Šç›®å‰çš„ interpret æ‰§è¡Œæ–¹å¼çš„å¯èƒ½æ€§èƒ½æŸå¤±ï¼Œzig comptime ä¼šæœ‰ä¸€äº›é™åˆ¶ï¼Œè€Œ scala3 macro åˆ™ä¸ä¼šå—ä¸Šè¿°é™åˆ¶ã€‚
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;All code with runtime side effects or depending on runtime values emits a compile error.&lt;&#x2F;li&gt;
&lt;li&gt;All function calls cause the compiler to interpret the function at compile-time,
emitting a compile error if the function tries to do something that has global runtime side effects.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Scala3 quotes API æœ‰æ›´å¼ºçš„åå°„èƒ½åŠ›ï¼Œå¯ä»¥ç›´æ¥æ“ä½œ ASTï¼Œåœ¨ä¸€äº›åŠ¨æ€ç”Ÿæˆä»£ç çš„åœºæ™¯ä¼šæ›´çµæ´»ï¼ˆè¿™ä¸ªAPIæœ¬èº«æ˜¯ Scala Compiler çš„APIï¼‰ã€‚
zig ç›®å‰æ¥çœ‹ï¼Œæ˜¯ä¸æä¾›å¯¹ä»£ç çš„ AST åå°„ã€æ“çºµçš„èƒ½åŠ›çš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é™åˆ¶ï¼šScala3 ç›®å‰çš„ macro æä¾›çš„éƒ½æ˜¯ blackbox macro, ä¹Ÿå°±æ˜¯è¯´ï¼Œmacro è‡ªèº«å¹¶ä¸å½±å“å¤–éƒ¨çš„ç±»å‹ç³»ç»Ÿï¼Œä¾‹å¦‚ï¼Œä¸èƒ½æ·»åŠ æ–°çš„
ç±»å‹ã€æ–¹æ³•ã€å˜é‡ç­‰ï¼Œå³ä½¿æ·»åŠ äº†ï¼Œä¹Ÿæ— æ³•ä¸ºå…¶ä»–ä»£ç æ‰€æ„ŸçŸ¥ã€‚zig comptime åˆ™å¯ä»¥ç›´æ¥åˆ›æ–°æ–°çš„ç±»å‹ã€‚ï¼ˆè¿™ä¹Ÿæ˜¯ zig generic çš„å®ç°æ–¹å¼ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;std.builtin.Type ç±»ä¼¼äº scala.quotes.TypeReprï¼Œä½†å…·æœ‰æ›´å¼ºçš„ whitebox èƒ½åŠ›ï¼Œæ˜¯ comptime æ—¶ç”¨äºæè¿° Type çš„å…ƒæ•°æ®ç»“æ„ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;can-kao&quot;&gt;å‚è€ƒ&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;Zig Cli: å¤„ç† CLI æ˜¯ comptime çš„ä¸€ä¸ªå¾ˆå®ç”¨çš„åœºæ™¯ã€‚ rust&#x2F;scala éƒ½ç©è¿™ä¸ªã€‚
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zigcli.liujiacai.net&#x2F;modules&#x2F;simargs&#x2F;&quot;&gt;Zig CLI&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Hejsil&#x2F;zig-clap&quot;&gt;Zig Clap&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>December 2024</title>
        <published>2024-12-01T00:00:00+00:00</published>
        <updated>2024-12-01T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2024-12/"/>
        <id>https://wangzaixiang.github.io/monthly/2024-12/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2024-12/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;zig-ben-yue-zhong-dian-hua-yi-xie-shi-jian-xue-xi-li-jie-zig&quot;&gt;Zig: æœ¬æœˆé‡ç‚¹èŠ±ä¸€äº›æ—¶é—´å­¦ä¹ ç†è§£ zigã€‚&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;Zig Compiler Internals
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;mitchellh.com&#x2F;zig&#x2F;tokenizer&quot;&gt;Tokenizer&lt;&#x2F;a&gt;: bytes -&amp;gt; token
tokenizer è¿‡ç¨‹ä¸ä½¿ç”¨ heap.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;mitchellh.com&#x2F;zig&#x2F;parser&quot;&gt;Parser&lt;&#x2F;a&gt;: token -&amp;gt; AST&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨ MultiArrayList ä½œä¸ºå­˜å‚¨æ•°æ®ç»“æ„ï¼ˆstructure of arrayï¼‰:å‡å°‘å†…å­˜å ç”¨ï¼Œç¼“å­˜å‹å¥½ã€‚ï¼ˆä½¿ç”¨ macro å¯ä»¥ç®€åŒ– SOA çš„ apiï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;mitchellh.com&#x2F;zig&#x2F;astgen&quot;&gt;AstGen: AST =&amp;gt; ZIR&lt;&#x2F;a&gt; AST =&amp;gt; ZIR( Zig IR)&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;zig ast-check -t &amp;lt;file&amp;gt;&lt;&#x2F;code&gt; å¯ä»¥æŸ¥çœ‹ ZIR&lt;&#x2F;li&gt;
&lt;li&gt;zir is untyped&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;mitchellh.com&#x2F;zig&#x2F;sema&quot;&gt;Zig Sema&lt;&#x2F;a&gt;: ZIR -&amp;gt; AIR (Analyzed IR) The heart of zig compiler.&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;zig build-obj --verbose-air &amp;lt;file&amp;gt;&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;comptime evaluation&lt;&#x2F;li&gt;
&lt;li&gt;AIR is fully typed&lt;&#x2F;li&gt;
&lt;li&gt;AIR is only generated for exported or referenced functions.&lt;&#x2F;li&gt;
&lt;li&gt;Value: comptime-known value.&lt;&#x2F;li&gt;
&lt;li&gt;Type: comptime-known type(all types are comptime-known). a type can be a value of type &lt;code&gt;type&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;TypedValue: value with type.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ç†è§£ comptime, æˆ‘å‡†å¤‡äº†ä¸€ä¸ªå®éªŒï¼Œå‚è€ƒï¼š&lt;a href=&quot;&#x2F;learning&#x2F;zig&#x2F;how_comptime_works.html&quot;&gt;comptime æ˜¯å¦‚ä½•å·¥ä½œçš„&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;a-zig-bug&#x2F;&quot;&gt;å‘ç°äº† Zig ç¼–è¯‘å™¨çš„ä¸€ä¸ª BUG&lt;&#x2F;a&gt;ï¼Œè¿˜æ¯”è¾ƒä¸¥é‡çš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=5_oqWE9otaE&amp;amp;t=3910s&quot;&gt;What is Zig got than C. Rust, and Go don&#x27;t have&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;others&quot;&gt;others&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;Scala Macro: ä¸¤ç¯‡å…³äº Scala 3 Macro çš„æ–‡ç« ï¼Œè¾ƒä¸ºæ·±å…¥ï¼Œå€¼å¾—æ”¶è—å­¦ä¹ ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;inoio.de&#x2F;blog&#x2F;2024&#x2F;07&#x2F;14&#x2F;scala3-macros-part1&#x2F;&quot;&gt;Crafting types with Scala 3 macros - Part 1: Introduction to macros&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;inoio.de&#x2F;blog&#x2F;2024&#x2F;07&#x2F;15&#x2F;scala3-macros-part2&#x2F;&quot;&gt;Crafting types with Scala 3 macros - Part 2: A Whitebox Macro&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Scala 3.6.2 Released
&lt;ul&gt;
&lt;li&gt;Clause Interleave. æ”¯æŒ: &lt;code&gt;def getOrElse(k: Key)[V &amp;gt;: k.Value](default: V): V&lt;&#x2F;code&gt;, æ›´å¼ºçš„ path-dependent type.&lt;&#x2F;li&gt;
&lt;li&gt;Improve Syntax for Context Bounds and Givens&lt;&#x2F;li&gt;
&lt;li&gt;NamedTuple å¾ˆæœŸå¾…çš„ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå¯ä»¥è®©ä½¿ç”¨ Tuple çš„ä»£ç æ›´åŠ å¯è¯»ã€‚ å¯¹ å‚æ•°è¾ƒå¤šçš„ case class è¿›è¡Œ pattern match ä¹Ÿå¯ä»¥äº«å— NamedTuple çš„ä¾¿åˆ©äº†&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;denoland.medium.com&#x2F;how-we-made-the-deno-language-server-ten-times-faster-62358af87d11&quot;&gt;How We Made the Deno Language Server Ten Times Faster, +8s -&amp;gt; &amp;lt;1s&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;å°è£…ï¼ˆæ ·å¼ã€è¡Œä¸ºé€šè¿‡ Shadow DOMï¼‰ã€äº’æ“ä½œæ€§(æ¡†æ¶æ— å…³)ã€æ ‡å‡†åŒ–&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;kubuszok.com&#x2F;2024&#x2F;modeling-in-scala-part-1&#x2F;&quot;&gt;Modeling in scala, part 1: modeling you domain&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;MPP &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;web-visualization&quot;&gt;Web &amp;amp; Visualization&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.devgenius.io&#x2F;widget-wonders-web-components-the-unsung-heroes-of-modern-ui-052131d692be&quot;&gt;WC åœ¨ç°ä»£UIä¸­çš„æ— åè´¡çŒ®&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;dev-jam&#x2F;functional-web-components-with-lit-part-2-3521a82bf339&quot;&gt;Scoped Components&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥ä¸ºæŸä¸ªç»„ä»¶çš„ html`` ä¸­ä½¿ç”¨çš„ webcomponent æä¾›ä¸€ä¸ª scopeï¼Œé‡æ–°å®šä¹‰ tag -&amp;gt; element çš„æ˜ å°„å…³ç³»ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸ºç»„ä»¶æä¾›ç¤ºä¾‹çº§çš„ css&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@muthuishere&#x2F;setting-up-bun-as-your-javascript-runtime-in-webstorm-and-other-jetbrains-ides-ae98f9368557&quot;&gt;Setting up bun in webstorm&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;No Build åç»­
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rolldown.rs&#x2F;guide&#x2F;in-depth&#x2F;why-bundlers&quot;&gt;Why do we still need bundlers&lt;&#x2F;a&gt;
&lt;ol&gt;
&lt;li&gt;HTTP&#x2F;2 å¹¶ä¸æ„å‘³å¯ä»¥åœæ­¢å…³å¿ƒ HTTP è¯·æ±‚çš„æ•°é‡ï¼ˆå¤§éƒ¨ä»½æµè§ˆå™¨çš„é™åˆ¶æ˜¯100ä¸ªï¼Œæ¯ä¸ªè¯·æ±‚çš„é¢å¤–å¼€é”€ï¼‰ï¼Œå¯¹åŒ…å«æ•°åƒä¸ªæ¨¡å—çš„åº”ç”¨ä»ç„¶éœ€è¦ bundlingã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ·±å±‚æ¬¡çš„ import ä¼šå¯¼è‡´ waterfalls.&lt;&#x2F;li&gt;
&lt;li&gt;Cache:&lt;&#x2F;li&gt;
&lt;li&gt;å‡å°‘ç½‘ç»œå­—èŠ‚æ•°&lt;&#x2F;li&gt;
&lt;li&gt;ç¼–è¯‘ä¼˜åŒ–&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;bjornlu.com&#x2F;blog&#x2F;hot-module-replacement-is-easy#importmetahotaccept&quot;&gt;Hot Module Replacement: How it works?&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;tools-libraries&quot;&gt;Tools &amp;amp; Libraries&lt;&#x2F;h1&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>bison(yacc) æºä»£ç åˆ†æ</title>
        <published>2024-11-22T00:00:00+00:00</published>
        <updated>2024-11-22T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/bison/"/>
        <id>https://wangzaixiang.github.io/blog/bison/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/bison/">&lt;h1 id=&quot;bei-jing&quot;&gt;èƒŒæ™¯&lt;&#x2F;h1&gt;
&lt;p&gt;&quot;æ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥å†™ä¸€ä¸ª parser&quot;ã€‚åœ¨å¤§å­¦æ—¶ï¼Œç¼–è¯‘åŸç†æ˜¯æˆ‘å­¦å¾—æœ€ç³Ÿç³•çš„ä¸€é—¨è¯¾ç¨‹ï¼Œå°¤å…¶æ˜¯ LR æ–‡æ³•æ„é€ çš„é‚£ä¸€ç« ï¼Œå½“æ—¶æ˜¯å®Œå…¨æ²¡æœ‰ç†è§£ï¼Œæ¯•ä¸šåæœ‰æœºä¼š
äº†è§£äº† yaccï¼ŒåŠ¨æ‰‹ç¼–å†™äº†ä¸€ä¸ªå°çš„ parserï¼Œ æ˜¯ä¸€ä¸ª TUI ä¸‹çš„ UIç•Œé¢æè¿°è¯­è¨€ã€‚ï¼ˆå½“æ—¶ï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨ curses library æ¥æ„å»º TUI ç¨‹åºï¼Œè¿™ä¸ªè¿‡ç¨‹
æ˜¯ä¸€ä¸ªç›¸å½“æ¯ç‡¥æ— è¶£çš„ç¼–ç è¿‡ç¨‹ï¼‰ï¼Œç›¸æ¯”ä½¿ç”¨ curses åº“è¿›è¡Œç¼–ç ï¼Œä½¿ç”¨æˆ‘è‡ªåˆ›çš„ UI æè¿°è¯­è¨€ï¼ŒåŸæœ¬éœ€è¦1å‘¨çš„çš„å¼€å‘å·¥ä½œçš„ä»»åŠ¡ï¼Œå¤§éƒ¨ä»½æˆ‘éƒ½å¯ä»¥åœ¨1å¤©å†…å®Œæˆï¼Œ
è¿™åœ¨å½“æ—¶æ˜¯å¾ˆæœ‰æˆå°±æ„Ÿçš„ã€‚åé¢å†ç»“åˆ Yacc å­¦ä¹ ç¼–è¯‘åŸç†ï¼Œå¹¶è‡ªå·±åŠ¨æ‰‹å®Œæˆäº† LR æ–‡æ³•çš„è§„åˆ™è¡¨æ„å»ºè¿‡ç¨‹ä¹‹åï¼Œå¯¹ LR æ–‡æ³•çš„ç†è§£æœ‰äº†å¾ˆå¤§çš„æå‡ï¼Œä¹Ÿå¯¹ Yacc
&#x2F;Bisonè¿™ç±»çš„å·¥å…·æœ‰æ›´å¥½çš„é©¾é©­åº¦ï¼Œæ‰€ä»¥åé¢é™†ç»­ä½¿ç”¨ Yacc ç¼–å†™äº†å‡ ä¸ªå°çš„ è¯­è¨€parserã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨æœ€è¿‘å…¬å¸çš„ä¸€ä¸ªæ•°æ®åˆ†æé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ª SQL Parser çš„æ„å»ºå·¥ä½œã€‚å› ä¸ºæˆ‘ä»¬åœ¨åšæ•°æ®åˆ†æçš„è¿‡ç¨‹ä¸­ï¼Œä¸»è¦çš„å·¥ä½œå°±æ˜¯åœ¨ä¸ SQL æ‰“äº¤é“ï¼šåŒ…æ‹¬å°†
æˆ‘ä»¬çš„å‰ç«¯æŸ¥è¯¢è¯­è¨€ï¼Œè½¬è¯‘æˆSQLæ‰§è¡Œï¼Œè¿™é‡Œæ¶‰åŠåˆ°å¾ˆå¤šçš„æŒ‘æˆ˜ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æŸ¥è¯¢è¯­ä¹‰çš„è¡¨è¿°ï¼Œå°¤å…¶æ˜¯è®¡ç®—æŒ‡æ ‡çš„è¡¨è¿°èƒ½åŠ›ã€‚å‚è€ƒæˆ‘ä¹‹å‰çš„ç³»åˆ—æ–‡ç« ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;dax&#x2F;&quot;&gt;DAX&lt;&#x2F;a&gt;ã€&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;tabular&#x2F;&quot;&gt;Tabulau&lt;&#x2F;a&gt;ã€
&lt;a href=&quot;..&#x2F;2024-08-24-MDX-optimize.md&quot;&gt;MDX&lt;&#x2F;a&gt;ã€‚å°†è¿™äº›è¡¨è¾¾èƒ½åŠ›è½¬è¯‘æˆ SQL æ‰§è¡Œæ˜¯æ•°æ®åˆ†æå¼•æ“ä¸­æœ€æœ‰æŒ‘æˆ˜å’Œä»·å€¼çš„å·¥ä½œä¹‹ä¸€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ•°æ®åº“çš„å…¼å®¹æ€§ã€‚ä¸åŒçš„æ•°æ®åº“åœ¨ SQL æ”¯æŒèƒ½åŠ›ã€æ”¯æŒè¯­æ³•ã€æˆ–è€…å®ç°ç»†èŠ‚ä¸Šæœ‰å¾ˆå¤§çš„å·®å¼‚ã€‚å¦‚æœä½ çš„äº§å“éœ€è¦å…¼å®¹æ•°åä¸ªæ•°æ®åº“äº§å“æ—¶ï¼Œæ„å»º SQL çš„
å·¥ç¨‹æŒ‘æˆ˜æ€§å˜å¾—å·¨å¤§ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;ä¼ ç»Ÿçš„åŸºäºå­—ç¬¦ä¸²å¤„ç†çš„SQLæ„å»ºã€åŠ å·¥è¿‡ç¨‹ï¼Œåœ¨ç¨å¾®å¤æ‚ä¸€äº›çš„åœºæ™¯ä¸­ï¼Œä¼šå˜å¾—åŠ›ä¸ä»å¿ƒï¼Œå› æ­¤ï¼Œæœ‰å¿…è¦å¼•å…¥ SQL Parserï¼Œå°†å¯¹ SQL è¯­å¥çš„æ“ä½œè½¬å˜ä¸ºå¯¹
AST å¾—æ“ä½œï¼Œè¿™ä¼šå¸¦æ¥ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ç²¾ç¡®æ€§ã€‚ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æˆ–è€…å…¶ä»–ç®€å•çš„æ–¹å¼å¯¹ SQL ä»£ç è¿›è¡ŒåŠ å·¥ï¼Œéƒ½ä¼šå¤±å»ç²¾ç¡®æ€§ã€‚åŸºæœ¬ä¸Šåªèƒœä»»æœ€ç®€å•çš„åœºæ™¯ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è¯­ä¹‰åŒ–ä¼˜åŒ–ã€‚å¯¹ AST è¿›ä¸€æ­¥çš„ Type Resolver åï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ SQL ä¸­çš„ç¬¦å·å…³ç³»è¿›è¡Œæ›´ä¸ºç²¾ç¡®çš„æè¿°ï¼Œä¸º SQL çš„ä¼˜åŒ–æä¾›ä¸°å¯Œçš„æ”¯æ’‘ï¼ˆæˆ‘ä»¬äº§å“ä¸­
å†…ç½®äº†ç±»ä¼¼äº apache calcite çš„ Relation Algebra Optimize çš„è‡ªç ”æ¨¡å—ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;æ•°æ®åº“æ–¹è¨€é€‚é…ã€‚ç±»ä¼¼äºå…³ç³»ä»£æ•°ä¼˜åŒ–ï¼Œä¸è¿‡ï¼Œè¿™é‡Œæ›´å¤šçš„æ˜¯å¯¹ä¸€äº›æ•°æ®åº“ç³»ç»Ÿçš„å…¼å®¹æ€§é€‚é…ï¼Œ
&lt;ul&gt;
&lt;li&gt;è¯­æ³•å·®å¼‚ï¼šæ¯”å¦‚æœ‰çš„æ•°æ®åº“(SQL Server) ä¸æ”¯æŒ limit å­å¥ï¼Œ æœ‰çš„æ•°æ®åº“ in å­å¥æœ‰å…ƒç´ æ•°é‡é™åˆ¶ï¼ˆOracleï¼‰ã€æœ‰çš„æ•°æ®åº“ä¸æ”¯æŒ with CTE å­å¥ï¼Œæœ‰çš„æ•°æ®åº“ä¸æ”¯æŒ order by&#x2F;group expression æˆ–è€…
order by&#x2F;group by field-noç­‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è¯æ³•å·®å¼‚ã€‚qualified identity ä¸åŒï¼Œå­—ç¬¦ä¸²å¸¸é‡ä¸­çš„è½¬ä¹‰è§„åˆ™ä¸åŒç­‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å‡½æ•°å·®å¼‚ã€‚è¿™æ–¹é¢çš„å·®å¼‚æ˜¯ç›¸å½“å¤§çš„ï¼Œæ¯æ¬¾æ•°æ®åº“éƒ½æœ‰è‡ªå·±çš„å‡½æ•°å®šä¹‰ï¼Œå³ä½¿å¯¹å®Œå…¨ç›¸åŒçš„åŠŸèƒ½ï¼Œå¤§å®¶éƒ½æœ‰ä¸åŒçš„å‡½æ•°ç­¾åã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;å¤„ç†è¿™äº›å·®å¼‚ï¼ŒAST éƒ½ä¼šå¸¦æ¥æ˜æ˜¾çš„ä»·å€¼ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æˆ‘ä»¬åˆšå¼€å§‹çš„æ—¶å€™ï¼Œä½¿ç”¨ antlr æ„å»ºäº†ä¸€ä¸ª Parserï¼Œä¸è¿‡åé¢å‘ç°æ€§èƒ½ä¸ä½³ï¼Œè€Œä¸”ç”±äºæˆ‘å¯¹ LR æ–‡æ³•ï¼ˆä»¥åŠYaccã€Bisonç­‰å·¥å…·ï¼‰æ›´ä¸ºç†Ÿæ‚‰ï¼Œ
è€Œå¯¹ LLæ–‡æ³• åŠ antlr å¹¶ä¸å¤Ÿç†Ÿæ‚‰ï¼Œäºæ˜¯æŒ‡å¯¼å·¥ç¨‹å¸ˆåŸºäºBison é‡æ–°æ„å»ºäº†ä¸€ä¸ª SQL Parserã€‚å½“ç„¶ï¼Œæ•ˆæœä¹Ÿæ˜¯å¾ˆä¸é”™çš„ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å›¢é˜Ÿäººå‘˜å¯¹ SQL è¯­æ³•æœ‰äº†æ›´æ·±çš„äº†è§£ã€‚å°¤å…¶æ˜¯ç»“åˆ æ•°æ®åº“çš„æŸ¥è¯¢è®¡åˆ’ï¼Œäº†è§£ SQL çš„æ‰§è¡Œè¿‡ç¨‹ã€ä¼˜åŒ–è¿‡ç¨‹ã€ç‰©ç†è®¡åˆ’ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹ windows å‡½æ•°ç­‰é«˜çº§æ¦‚å¿µæœ‰äº†æ›´ä¸ºæ·±å…¥çš„ç†è§£ï¼Œå¹¶åº”ç”¨åˆ°å¤æ‚æŒ‡æ ‡è®¡ç®—çš„è¿‡ç¨‹ä¸­ï¼Œæé«˜äº†è®¡ç®—æŒ‡æ ‡çš„æ”¯æŒèƒ½åŠ›å’Œé€Ÿåº¦ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç›¸æ¯” antlr LL æ–‡æ³•çš„è§£æå™¨ï¼Œ LR ç‰ˆæœ¬çš„æ€§èƒ½æå‡æ˜¾è‘—ï¼Œå¯ä»¥åœ¨ ms é‡çº§å¤„ç† 1M çš„ SQL è¯­å¥ã€‚ï¼ˆLRè‡ªèº«æ€§èƒ½ä¼˜ç§€ï¼Œæˆ‘ä»¬çš„æ–‡æ³•å®Œå…¨æ— éœ€å›æº¯ï¼Œ
æˆ‘ä»¬ä¹Ÿèƒ½é©¾é©­ã€‚è€Œ antlr æˆ‘ä»¬ é©¾é©­èƒ½åŠ›è¾ƒå·®ï¼Œæˆ–è€…å¹¶é antlr å°±ä¸èƒ½è¾¾åˆ°è¿™ä¹ˆå¿«çš„é€Ÿåº¦ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ååŠ©å·¥ç¨‹å¸ˆè§£å†³äº†å¤šä¸ªé—®é¢˜ï¼Œæœ¬æ–‡è®°å½•åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘å¯¹ Bison çš„æºä»£ç çš„åˆ†æï¼Œä»¥åŠ Bison çš„ä½¿ç”¨æŠ€å·§ï¼Œä»¥ä¾›åç»­å‚è€ƒã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;lr-gui-ze-biao-xiang-guan-shu-ju-jie-gou&quot;&gt;LR è§„åˆ™è¡¨ç›¸å…³æ•°æ®ç»“æ„&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨ LR æ–‡æ³•ä¸­ï¼Œæ ¸å¿ƒçš„æ•°æ®ç»“æ„åŒ…æ‹¬ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Shift è¡¨ï¼š(state, terminal) -&amp;gt; state&lt;&#x2F;li&gt;
&lt;li&gt;goto è¡¨: (state, non_terminal) -&amp;gt; state&lt;&#x2F;li&gt;
&lt;li&gt;default reduce è¡¨: state -&amp;gt; ruleNo&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œ1ï¼Œ2 æ•°æ®ç»“æ„å‡å¯ä»¥è¡¨è¿°ä¸ºäºŒç»´çŸ©é˜µï¼Œå¯¹æˆ‘ä»¬çš„ SQL Parser æ¥è¯´ï¼Œè¿™ä¸ªçŸ©é˜µå¤§å°ä¸º 337 * 155 = 52,235 ä¸ªå…ƒç´ ï¼Œå¦‚æœä½¿ç”¨ short ç±»å‹ï¼Œ
åˆ™å¤§æ¦‚å ç”¨ 100K çš„å†…å­˜ã€‚è€Œå®é™…ä¸Šï¼ŒäºŒç»´çŸ©é˜µä¸­å¤§éƒ¨ä»½çš„å…ƒç´ éƒ½æ˜¯æ— æ•ˆçš„å€¼ï¼Œå› æ­¤æ˜¯ä¸€ä¸ªéå¸¸ç¨€ç–çš„çŸ©é˜µï¼Œé€šè¿‡é‡‡ç”¨å‹ç¼©æŠ€æœ¯ï¼Œåˆ™å¯å¤§å¹…åº¦å‡å°‘å†…å­˜çš„å ç”¨ã€‚
ï¼ˆä¾‹å¦‚ï¼Œåœ¨bisonç‰ˆæœ¬ä¸­ï¼Œå®é™…å ç”¨å†…å­˜ä¸º 337(yypact) + 61(yypgoto) + 61(yydefgoto) + 702(yytable) + 702(yycheck) = 1863*2 = 3.7K )
å¤§å¹…å‹ç¼©åï¼Œå¯ä»¥ä¿è¯è¿™äº›æ•°æ®ç»“æ„å¯ä»¥æ”¾å…¥ CPU çš„ L1 Cache ä¸­ï¼Œä»è€Œæé«˜è§£æçš„æ€§èƒ½ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;Bison çš„è¿™ä¸ªæ•°æ®ç»“æ„è®¾è®¡å¾ˆæœ‰æ„æ€ï¼Œä¹‹å‰æˆ‘ä¹Ÿé˜…è¯»è¿‡ä»£ç ï¼Œä½†å¯¹è¿™ä¸ªå‹ç¼©çš„æ•°æ®ç»“æ„æ²¡æœ‰ç»†åŒ–çš„åˆ†æï¼Œè¿™å¯¹è°ƒè¯• Bison ç”Ÿæˆçš„ Parser ä»£ç è¿˜æ˜¯ä¼šæ„æˆ
ä¸€äº›éšœç¢ï¼Œä¹˜ç€è¿™æ¬¡åœ¨è°ƒè¯•ä¸€ä¸ª SQL ç¼–è¯‘æœŸçš„è¿‡ç¨‹ï¼ŒèŠ±äº†ä¸€äº›æ—¶é—´æ¥å½»åº•ç†è§£å®ƒçš„æ•°æ®ç»“æ„è®¾è®¡ï¼Œæ„Ÿè§‰æœ‰å¿…è¦è¿›è¡Œè®°å½•ï¼Œä¸€æ¥æ˜¯ç†è§£ Bison  çš„æ•°æ®ç»“æ„ï¼Œæ–¹ä¾¿åç»­
è°ƒè¯• Parser ä»£ç æ—¶ï¼Œèƒ½å¤Ÿæ›´åŠ çš„å¾—å¿ƒåº”æ‰‹ã€‚äºŒæ¥ä¹Ÿè§‰å¾—è¿™ä¸ªæ•°æ®ç»“æ„çš„è®¾è®¡ï¼Œéå¸¸ç²¾å·§ï¼Œå€¼å¾—å­¦ä¹ ã€‚ LR æ–‡æ³•ä¹Ÿæ˜¯æœ‰é™è‡ªåŠ¨æœºçš„ä¸€ä¸ªæœ€ä½³å®è·µï¼Œå…¶è®¾è®¡ä¹‹ç²¾å·§ï¼Œ
ä»¤äººèµå¹ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬æµ‹è¯•çš„æ¡ˆä¾‹ä¸­ï¼Œ&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;terminal å…±94ä¸ªï¼Œç¼–å·ä¸º 0..93 (ä¸åŒä¸ Lexer ä¸­çš„ç¼–ç ï¼Œåœ¨ Lexer ä¸­ï¼Œä¸º 1-255 çš„å­—ç¬¦ä¿ç•™äº† Lexer ç¼–ç ï¼Œå¦‚æœæŸä¸ªç¼–ç æ²¡æœ‰å¯¹åº”çš„ terminal,
åˆ™ä¼šæ˜ å°„ä¸º YYUNDEF)&lt;&#x2F;li&gt;
&lt;li&gt;non termial å…± 61 ä¸ªï¼Œç¼–å·ä¸º 94..154ã€‚ (ç”±æ­¤å¯è§ï¼Œ terminal å’Œ non terminal ä½¿ç”¨äº†ç›¸åŒçš„ç¼–ç ç©ºé—´)&lt;&#x2F;li&gt;
&lt;li&gt;states: å…±337ä¸ªçŠ¶æ€ï¼Œ ç¼–å·ä¸º 0..336ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;rules: å…±192 æ¡äº§ç”Ÿå¼ï¼Œç¼–å·ä¸º 1..192ã€‚ (è§„åˆ™ç¼–å·ä»1å¼€å§‹)&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;yytable-yycheck&quot;&gt;yytable, yycheck&lt;&#x2F;h2&gt;
&lt;p&gt;yytable ä¸­å­˜å‚¨äº†ä¸¤éƒ¨ä»½çš„ä¿¡æ¯ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;shift(and go to): å…¶é€»è¾‘ä¸ºå¯¹ (state1, terminal) -&amp;gt; state2 ç¨€ç–çŸ©é˜µçš„å‹ç¼©
&lt;ul&gt;
&lt;li&gt;state -&amp;gt; &lt;code&gt;yycheck[ terminal1 .. terminalN ]&lt;&#x2F;code&gt;  è¿™ä¸ªåœ¨ yypact ä¸­æè¿°ï¼Œå¦‚æœ yycheck( yypact(state) + terminal ) == terminalï¼Œåˆ™è¡¨ç¤ºæœ‰æ•ˆçš„ shift&lt;&#x2F;li&gt;
&lt;li&gt;state -&amp;gt; &lt;code&gt;yytable[ terminal1 .. terminalN]&lt;&#x2F;code&gt;, å¦‚æœæ˜¯æœ‰æ•ˆçš„ shift,åˆ™ yytable( yypact(state) + terminal ) æ˜¯shift åçš„æ–°çŠ¶æ€ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;goto: å…¶é€»è¾‘ä¸ºå¯¹ (non_terminal, state) -&amp;gt; state ç¨€ç–çŸ©é˜µçš„å‹ç¼©ã€‚
&lt;ul&gt;
&lt;li&gt;non_terminal -&amp;gt; &lt;code&gt;yycheck[ state1 .. stateN ]&lt;&#x2F;code&gt; è¿™ä¸ªåœ¨ yypgoto ä¸­æè¿°ï¼Œå¦‚æœ yycheck( yypgoto(non_terminal) + state ) == stateï¼Œåˆ™è¡¨ç¤ºæœ‰æ•ˆçš„ goto&lt;&#x2F;li&gt;
&lt;li&gt;non_terminal -&amp;gt; &lt;code&gt;yytable[ state1 .. stateN]&lt;&#x2F;code&gt;, å¦‚æœæ˜¯æœ‰æ•ˆçš„ goto,åˆ™ yytable( yypgoto(non_terminal) + state ) æ˜¯goto åçš„æ–°çŠ¶æ€ã€‚
yytable å®é™…ä¸Šæ˜¯ä¸Šè¿°ä¸¤ä¸ªå‹ç¼©è¡¨çš„åˆå¹¶ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;short-yypact-yytable-yycheck&quot;&gt;&lt;code&gt;short[] yypact, yytable, yycheck&lt;&#x2F;code&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;è¿™ä¸‰ä¸ªè¡¨ç»“åˆèµ·æ¥ï¼Œæ„æˆäº† (state, terminal) -&amp;gt; state çš„æ˜ å°„å…³ç³»ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬ç¤ºä¾‹çš„ SQL Parser ä¸­ï¼Œå¦‚æœä½¿ç”¨å®Œå…¨çŸ©é˜µï¼Œå®Œæ•´æè¿° (state, terminal) -&amp;gt; state çš„æ˜ å°„å…³ç³»ï¼Œåˆ™éœ€è¦ 337 * 94 = 31678 ä¸ªå…ƒç´ ã€‚è€Œ
é€šè¿‡è¿™3ä¸ªæ•°ç»„æ¥æ¨¡æ‹Ÿçš„ä¸€ä¸ªç¨€ç–çŸ©é˜µï¼Œåˆ™å¯ä»¥å¤§å¤§å‡å°‘å†…å­˜ä½¿ç”¨ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœæŸä¸ªçŠ¶æ€ä¸‹ï¼Œæ²¡æœ‰ shift æ“ä½œï¼Œ åªæœ‰ reduce æ“ä½œã€‚ åˆ™ &lt;code&gt;yypact(STATE)&lt;&#x2F;code&gt; åˆ†é…ä¸€ä¸ªæœ€å°çš„è´Ÿæ•°å€¼,  &lt;code&gt;yytable(yyn + terminal.code)&lt;&#x2F;code&gt;
å¯¹æ‰€æœ‰çš„ terminal code éƒ½æ˜¯æ— æ•ˆçš„ yytable ç´¢å¼•å€¼ï¼Œä¸å ç”¨ yytable ä¸­çš„ä»»ä½•ç©ºé—´ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹æœ‰ shift æ“ä½œçš„çŠ¶æ€ï¼Œéœ€è¦åœ¨ yytable ä¸­åˆ†é… n ä¸ªç©ºé—´ï¼š n = state.max_terminal - state.min_terminal + 1 ä¸ªç©ºé—´ã€‚
å³ä½¿è¿™ä¸ªç©ºé—´ä¸­çš„æŸä¸ª terminal æ²¡æœ‰å¯¹åº”çš„ shift æ“ä½œï¼Œåˆ™ yytable(yyn) è®¾ç½®ä¸º-1ï¼Œ yycheck(yyn) è®¾ç½®ä¸º&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœæŸä¸¤ä¸ªçŠ¶æ€çš„ shift å®Œå…¨ç›¸åŒï¼ˆåŒ…æ‹¬ç›®æ ‡çŠ¶æ€ï¼‰ï¼Œå¯ä»¥å…±äº«ç©ºé—´ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç†è®ºä¸Šå¯ä»¥å¦‚æœ state1 ä¸ state2 å¯¹åº”çš„ shift æ“ä½œå¦‚æœæ²¡æœ‰äº¤é›†ï¼Œåˆ™å¯ä»¥å…±äº«ç©ºé—´ã€‚è¿™æ ·å¯ä»¥é€šè¿‡ç®—æ³•ï¼Œè¿›ä¸€æ­¥å¯¹ yytable å‹ç¼©ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;short-yydefact&quot;&gt;&lt;code&gt;short[] yydefact&lt;&#x2F;code&gt;&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;yydefact[stateNo]&lt;&#x2F;code&gt; çš„é•¿åº¦ä¸çŠ¶æ€æ•°é‡ä¸€è‡´ï¼Œæ¯ä¸ªçŠ¶æ€å¯¹åº”ä¸€ä¸ªå€¼ï¼Œè¡¨ç¤ºè¯¥çŠ¶æ€çš„ default reduce æ“ä½œ(ä»1å¼€å§‹ï¼‰ã€‚
ä¸º 0 åˆ™è¡¨ç¤ºè¯¥çŠ¶æ€æ²¡æœ‰ reduce æ“ä½œï¼ˆaccept reduce çš„ç¼–å·ä¸º 1ï¼‰.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;yyr2[ruleNo]&lt;&#x2F;code&gt; è®°å½•æ¯ä¸ª äº§ç”Ÿå¼çš„å³ä¾§ç¬¦å·çš„æ•°é‡ã€‚ ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œå½“æœ€å¤§é•¿åº¦ &amp;lt; 127 æ—¶ï¼Œä½¿ç”¨ byte ç±»å‹ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;yypgoto-yytable-yycheck-short-yydefgoto&quot;&gt;&lt;code&gt;yypgoto, yytable, yycheck, short yydefgoto&lt;&#x2F;code&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;goto table ç”¨äºæè¿° (state, non_terminal) -&amp;gt; state çš„æ˜ å°„å…³ç³»ã€‚
goto_table ç”±ä¸¤éƒ¨ä»½ç»„æˆï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;yypgotoã€yytableã€yycheckï¼šé€šè¿‡ yypgoto å»ºç«‹ non_terminal -&amp;gt; yyn_index çš„æ˜ å°„ï¼Œç„¶åé€šè¿‡ state -&amp;gt; yyn_index + state æ£€æŸ¥
yycheck å’Œ yytable æ¥è·å– goto çš„çŠ¶æ€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœä¸Šè¿°æ£€æŸ¥å¤±è´¥ï¼Œåˆ™é€šè¿‡ yydefgoto(non_terminal) è·å–é»˜è®¤çš„ goto çŠ¶æ€ã€‚(å½“ non_terminal åœ¨å¤šä¸ªçŠ¶æ€ä¸‹çš„ goto çŠ¶æ€ç›¸åŒæ—¶ï¼Œå¯ä»¥å…±äº«ç©ºé—´ã€‚)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;short-yystos&quot;&gt;&lt;code&gt;short[] yystos_&lt;&#x2F;code&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„ SQL parser ä¸­ï¼Œè¿™ä¸ªè¡¨æ²¡æœ‰ä½¿ç”¨åˆ°ã€‚æš‚æ—¶ä¸åˆ†æã€‚ å…¶å¯¹åº”æ¯ä¸ªçŠ¶æ€ä¸‹ å‰å¯¼ç»ˆç»“ç¬¦ï¼Œå¦‚æœæ²¡æœ‰ç¡®å®šçš„ç»ˆç»“ç¬¦ï¼Œåˆ™å¯¹åº”çš„å‰å¯¼éç»ˆç»“ç¬¦ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;sort-yyr1-yyr2&quot;&gt;&lt;code&gt;sort[] yyr1, yyr2&lt;&#x2F;code&gt;&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;yyr1: å¯¹åº”äºæ¯ä¸€ä¸ªäº§ç”Ÿå¼çš„å·¦ä¾§ç¬¦å·ç¼–ç ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;yyr2: å¯¹åº”äºæ¯ä¸€ä¸ªäº§ç”Ÿå¼çš„å³ä¾§ç¬¦å·çš„æ•°é‡ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;bison-de-yi-chang-chu-li&quot;&gt;Bison çš„å¼‚å¸¸å¤„ç†&lt;&#x2F;h1&gt;
&lt;p&gt;Bison æä¾›äº† error recovery çš„æœºåˆ¶ï¼Œæœ‰ä¸€ä¸ªç‰¹æ®Šçš„å†…ç½®ç»ˆç»“ç¬¦ï¼šerrorï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„æ–¹å¼æ¥å¤„ç†é”™è¯¯ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;yacc&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-yacc &quot;&gt;&lt;code class=&quot;language-yacc&quot; data-lang=&quot;yacc&quot;&gt;&lt;span&gt;prog: expr &amp;#39;\n&amp;#39; { printf(&amp;quot;result: %d\n&amp;quot;, $1);    # 1
&lt;&#x2F;span&gt;&lt;span&gt;    | error &amp;#39;\n&amp;#39; { yyerrok; }                    # 2
&lt;&#x2F;span&gt;&lt;span&gt;    ;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;expr: expr &amp;#39;+&amp;#39; expr { $$ = $1 + $3; }            # 3
&lt;&#x2F;span&gt;&lt;span&gt;  | expr &amp;#39;-&amp;#39; expr { $$ = $1 - $3; }              # 4
&lt;&#x2F;span&gt;&lt;span&gt;  | expr &amp;#39;*&amp;#39; expr  { $$ = $1 * $3; }             # 5
&lt;&#x2F;span&gt;&lt;span&gt;  | expr &amp;#39;&#x2F;&amp;#39; expr  { $$ = $1 &#x2F; $3; }             # 6
&lt;&#x2F;span&gt;&lt;span&gt;  | &amp;#39;(&amp;#39; expr &amp;#39;)&amp;#39; { $$ = $2; }                    # 7
&lt;&#x2F;span&gt;&lt;span&gt;  ï½œ expr &amp;#39;?&amp;#39; expr &amp;#39;:&amp;#39; expr                      # 8
&lt;&#x2F;span&gt;&lt;span&gt;  | NUMBER { $$ = $1; }                          # 9
&lt;&#x2F;span&gt;&lt;span&gt;  ;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸Šè¿°æ–‡æ³•ï¼Œéœ€è¦ç»“åˆ Bison çš„ç»ˆç»“ç¬¦çš„ä¼˜å…ˆçº§å®šä¹‰ã€å·¦å³ç»“åˆå®šä¹‰æ¥æ¶ˆé™¤å†²çªã€‚è¿™ä¹Ÿæ˜¯ LR æ–‡æ³•çš„ä¸€å¤§ç‰¹ç‚¹ï¼Œè¯¸å¦‚è¿ç®—ç¬¦è¡¨è¾¾å¼ï¼Œå¯ä»¥ç®€å•
çš„é€šè¿‡è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ã€ç»“åˆæ€§æ¥è§£å†³ï¼Œæ—¢ç®€å•ä¹Ÿéå¸¸ç¬¦åˆäººç±»çš„æ€ç»´ä¹ æƒ¯ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;YYNEWSTATE -&amp;gt; YYERRLAB( yyreportSyntaxError ) -&amp;gt; YYERRLAB1 (ä» stack ä¸­æŸ¥æ‰¾ä¸€ä¸ªå¯ä»¥ shift error çš„çŠ¶æ€ï¼Œå°†å…¶åçš„è¾“å…¥è¾“å…¥ä½œä¸º error ç»ˆç»“ç¬¦)
-&amp;gt; YYNEWSTATE&lt;&#x2F;li&gt;
&lt;li&gt;éœ€è¦æ³¨æ„ï¼Œå¦‚æœåœ¨ parse è¿‡ç¨‹ä¸­ï¼Œå·²ç»å®Œæˆäº†è§„çº¦ï¼Œä½†æœ€åè¢« error æ‰€è¦†ç›–ï¼Œåˆ™ä¹‹å‰è§„çº¦çš„ç»“æœä¼šè¢«ä¸¢å¼ƒï¼Œå› æ­¤ï¼Œè§„çº¦è¿‡ç¨‹ä¸­åº”é¿å…å‰¯ä½œç”¨çš„äº§ç”Ÿã€‚
ä¾‹å¦‚ï¼šå¯¹ &lt;code&gt;1 * 2 + hello\n&lt;&#x2F;code&gt; è¿™ä¸ªè¾“å…¥ï¼Œ åœ¨é‡åˆ° + å·æ—¶ï¼Œä¼šå®Œæˆ expr(1) * expr(2) çš„è§„çº¦çš„ï¼Œè€Œååœ¨ å¤„ç† expr &#x27;*&#x27; ä¹‹åï¼Œé‡åˆ° errorï¼Œæ­¤æ—¶å°†&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å¯¹ä¸Šè¿°æ–‡æ³•ï¼Œä»¥ &lt;code&gt;1 * 2 + hello\n&lt;&#x2F;code&gt; ä¸ºä¾‹ï¼šåœ¨ è¯æ³•åˆ†æå™¨ä¸è®¤è¯† hello æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ª error token, æ­¤æ—¶ è§£æå™¨ä¼šä» stack(è®°å½•äº†ä»åˆå§‹çŠ¶æ€ï¼Œæ¯æ¬¡ç»å†ä¸€ä¸ª
terminal&#x2F;nonterminal åˆ°è¾¾å½“å‰çš„çŠ¶æ€çš„å…¨è¿‡ç¨‹) ä¸­æŸ¥æ‰¾åˆ°æœ€è¿‘çš„ä¸€ä¸ªæ”¯æŒ shift error æ“ä½œçš„çŠ¶æ€ï¼Œåœ¨è¿™é‡Œï¼Œ(#2:0 å³ . error &#x27;\n&#x27; ) çŠ¶æ€æ˜¯æ”¯æŒ
shift errorçš„ï¼Œæ­¤æ—¶ä¼šæŠŠè¿™ä¸ªçŠ¶æ€åçš„æ‰€æœ‰è¾“å…¥ä½œä¸º error é‡æ–°å‹æ ˆï¼ˆåŸæœ‰çš„è¯¥çŠ¶æ€åçš„æ ˆè¢«å¯¹åº”æ¸…æ¥šï¼‰ã€‚ç›´åˆ°ä¸‹ä¸€ä¸ªç»ˆç»“ç¬¦ä¸º &#x27;\n&#x27;ï¼Œ æ­¤æ—¶ä¼šä½¿ç”¨ #2 äº§ç”Ÿå¼è¿›è¡Œè§„çº¦ï¼Œ
å®ç°é”™è¯¯çš„æ¢å¤ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;location&quot;&gt;Location&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;comments-chu-li&quot;&gt;Comments å¤„ç†&lt;&#x2F;h1&gt;
&lt;p&gt;AST å¯¹è¯­æ³•ç»“æ„æ¥è¯´ï¼Œæ˜¯ä¸€ç§å¾ˆå¥½çš„è¡¨ç¤ºç»“æ„ï¼Œä½†å¯¹æºä»£ç ä¸­çš„æ³¨é‡Šæ¥è¯´ï¼Œåˆ™å¹¶ä¸é€‚åˆï¼šæ³¨é‡Šå¯ä»¥å‡ºç°åœ¨æºä»£ç ä¸­çš„ä»»æ„ä½ç½®ï¼Œå…¶ä¸å…·æœ‰ AST çš„è¯­ä¹‰ç»“æ„ï¼Œå› æ­¤ï¼Œå¦‚ä½•åœ¨ AST ä¸­è¡¨ç¤º
æ³¨é‡Šæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨ Parser çš„è¿‡ç¨‹ä¸­ä¿ç•™ Comments åœ¨æœ‰äº›åœºæ™¯ä¸­æ˜¯æœ‰å¿…è¦çš„ï¼Œåœ¨æˆ‘ä»¬çš„ parser ä¸­ï¼Œæœ‰ä¸¤ä¸ªå·²çŸ¥çš„åº”ç”¨åœºæ™¯ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹ä¸ç¬¦åˆæ ‡å‡†çš„ SQL è¯­æ³•ï¼Œä½†éœ€è¦åœ¨ç›®æ ‡æ•°æ®åº“ä¸­æ”¯æŒçš„ SQLè¯­æ³•ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;&#x2F;*@ @*&#x2F;&lt;&#x2F;code&gt; çš„æ–¹å¼åµŒå…¥åˆ° SQL ä¸­ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯ä»¥åœ¨ SQL ä¸­åµŒå…¥ä¸€äº› hintï¼Œç”¨äºè¾…åŠ©ç›®æ ‡æ•°æ®åº“çš„æ€§èƒ½ä¼˜åŒ–ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æˆ‘ä»¬çš„å¤„ç†æ–¹å¼ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è¯æ³•åˆ†æå™¨å¤„ç† commentsï¼Œå¹¶ä½œä¸º ä¸‹ä¸€ä¸ª token çš„ comments å±æ€§ï¼Œè¿”å›ç»™ parser.ï¼ˆç›¸å½“äºæ¯ä¸€ä¸ª token éƒ½æœ‰ä¸€ä¸ª comments å±æ€§ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ äº§ç”Ÿå¼è§„çº¦æ—¶ï¼š
&lt;ul&gt;
&lt;li&gt;å¦‚æœç¬¬ä¸€ä¸ªç¬¦å·($1)æ˜¯ terminalï¼Œåˆ™å°† $1.comments ä½œä¸º Y çš„ preComments&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨äº§ç”Ÿå¼ä¸­çš„å…¶ä»–ç»ˆç»“ç¬¦ï¼Œå…¶æ³¨é‡Šå¯ä»¥æŒ‚è½½åˆ°å…¶å‰ nonTerminal çš„ postComments æˆ–è€…å…¶å nonTerminal çš„ preComments ä¸Šã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœå‡ºç°è¿ç»­çš„ non terminalï¼Œ ä¸­é—´çš„æ³¨é‡Šå°†æ— æ³•ç²¾ç¡®å®šä½ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>simd æ’åº</title>
        <published>2024-11-18T00:00:00+00:00</published>
        <updated>2024-11-18T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/simd-sort/"/>
        <id>https://wangzaixiang.github.io/blog/simd-sort/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/simd-sort/">&lt;p&gt;æœ€è¿‘ï¼Œé˜…è¯»äº† &lt;a href=&quot;https:&#x2F;&#x2F;vldb.org&#x2F;pvldb&#x2F;vol8&#x2F;p1274-inoue.pdf&quot;&gt;SIMD- and Cache-Friendly Algorithm for Sorting an Array of Structures&lt;&#x2F;a&gt;
ä¸€æ–‡åï¼ŒåŠ¨æ‰‹ç¼–å†™äº†ä¸€ä¸ª åŸºäº SIMD çš„æ’åºç®—æ³•ï¼Œå…·ä½“ä»£ç å‚è€ƒï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;vectorize_engine&#x2F;blob&#x2F;main&#x2F;poc&#x2F;vector_example1&#x2F;src&#x2F;bin&#x2F;test.rs&quot;&gt;SIMD Sort Test&lt;&#x2F;a&gt;ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; file poc&#x2F;vector_example1&#x2F;src&#x2F;sort2.rs
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; simd based sort u32x8 
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;sort_u32x8&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;nums&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; u32x8) {
&lt;&#x2F;span&gt;&lt;span&gt;...
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; simd based sort u32x16
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;sort_u32x16&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;nums&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; u32x16){
&lt;&#x2F;span&gt;&lt;span&gt;...
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; simd based sort u32x32
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;sort_u32x32&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;nums&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; u32x32)
&lt;&#x2F;span&gt;&lt;span&gt;...
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; simd based meger sort of 2 u32x16
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;merge_sort_u32x16x2&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;p1&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; u32x16, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;p2&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; u32x16) {
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; åŸºäº merge sort(sort_u32x32 + merge_sort_u32x16x2) çš„æ’åºå®ç°ï¼Œ
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;sort&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;nums&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;]) {
&lt;&#x2F;span&gt;&lt;span&gt;...
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ä½œä¸ºå¯¹æ¯”ï¼Œæµ‹è¯•äº† è¯¥ç®—æ³•ä¸ Rust æ ‡å‡†åº“ä¸­çš„ &lt;code&gt;Slice::sort&lt;&#x2F;code&gt; å’Œ &lt;code&gt;Slice::sort_unstable&lt;&#x2F;code&gt; çš„æ€§èƒ½å·®å¼‚ï¼šï¼ˆæµ‹è¯•ç¯å¢ƒï¼š M1-Max 64Gï¼‰&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;æ•°æ®é‡&lt;&#x2F;th&gt;&lt;th&gt;Slice::sort&lt;&#x2F;th&gt;&lt;th&gt;Slice::sort_unstable&lt;&#x2F;th&gt;&lt;th&gt;My SIMD sort&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;32&lt;&#x2F;td&gt;&lt;td&gt;237 ns&lt;&#x2F;td&gt;&lt;td&gt;156 ns&lt;&#x2F;td&gt;&lt;td&gt;56 ns&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;64&lt;&#x2F;td&gt;&lt;td&gt;642 ms&lt;&#x2F;td&gt;&lt;td&gt;348 ns&lt;&#x2F;td&gt;&lt;td&gt;176 ns&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;128&lt;&#x2F;td&gt;&lt;td&gt;1.156 us&lt;&#x2F;td&gt;&lt;td&gt;785 ns&lt;&#x2F;td&gt;&lt;td&gt;511 ns&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;256&lt;&#x2F;td&gt;&lt;td&gt;2.454	us&lt;&#x2F;td&gt;&lt;td&gt;1.635 us&lt;&#x2F;td&gt;&lt;td&gt;1.255 us&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;512&lt;&#x2F;td&gt;&lt;td&gt;5.192	us&lt;&#x2F;td&gt;&lt;td&gt;3.488 us&lt;&#x2F;td&gt;&lt;td&gt;3.054 us&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;1K&lt;&#x2F;td&gt;&lt;td&gt;10.857 us&lt;&#x2F;td&gt;&lt;td&gt;7.381 us&lt;&#x2F;td&gt;&lt;td&gt;7.382 us&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;2K&lt;&#x2F;td&gt;&lt;td&gt;22.746 us&lt;&#x2F;td&gt;&lt;td&gt;15.638 us&lt;&#x2F;td&gt;&lt;td&gt;17.443 us&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;4K&lt;&#x2F;td&gt;&lt;td&gt;47.517 us&lt;&#x2F;td&gt;&lt;td&gt;32.933 us&lt;&#x2F;td&gt;&lt;td&gt;40.407 us&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;8K&lt;&#x2F;td&gt;&lt;td&gt;98.424 us&lt;&#x2F;td&gt;&lt;td&gt;69.258 us&lt;&#x2F;td&gt;&lt;td&gt;91.900 us&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;16K&lt;&#x2F;td&gt;&lt;td&gt;203.153 us&lt;&#x2F;td&gt;&lt;td&gt;145.538 us&lt;&#x2F;td&gt;&lt;td&gt;205.371 us&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;32K&lt;&#x2F;td&gt;&lt;td&gt;420.905 us&lt;&#x2F;td&gt;&lt;td&gt;305.407 us&lt;&#x2F;td&gt;&lt;td&gt;455.912 us&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;64K&lt;&#x2F;td&gt;&lt;td&gt;870.353 us&lt;&#x2F;td&gt;&lt;td&gt;641.122 us&lt;&#x2F;td&gt;&lt;td&gt;999.676 us&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;128K&lt;&#x2F;td&gt;&lt;td&gt;1.809017	ms&lt;&#x2F;td&gt;&lt;td&gt;1.346237 ms&lt;&#x2F;td&gt;&lt;td&gt;2.180088 ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;256K&lt;&#x2F;td&gt;&lt;td&gt;3.821495	ms&lt;&#x2F;td&gt;&lt;td&gt;2.797711 ms&lt;&#x2F;td&gt;&lt;td&gt;4.712874 ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;512K&lt;&#x2F;td&gt;&lt;td&gt;8.038367	ms&lt;&#x2F;td&gt;&lt;td&gt;6.007526 ms&lt;&#x2F;td&gt;&lt;td&gt;10.383386 ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;1M&lt;&#x2F;td&gt;&lt;td&gt;16.589313	ms&lt;&#x2F;td&gt;&lt;td&gt;12.527798 ms&lt;&#x2F;td&gt;&lt;td&gt;22.416753 ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;2M&lt;&#x2F;td&gt;&lt;td&gt;38.806603	ms&lt;&#x2F;td&gt;&lt;td&gt;25.994612 ms&lt;&#x2F;td&gt;&lt;td&gt;47.795221 ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;4M&lt;&#x2F;td&gt;&lt;td&gt;78.304628	ms&lt;&#x2F;td&gt;&lt;td&gt;52.795861 ms&lt;&#x2F;td&gt;&lt;td&gt;100.198899 ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;8M&lt;&#x2F;td&gt;&lt;td&gt;169.534526 ms&lt;&#x2F;td&gt;&lt;td&gt;109.631584 ms&lt;&#x2F;td&gt;&lt;td&gt;211.116117 ms&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;p&gt;ç”±äº3ä¸ªç®—æ³•éƒ½æ˜¯åŸºäº n*log(2, n) çš„ï¼Œå› æ­¤ï¼Œæˆ‘å¯¹ t &#x2F; (n * log(2,n) è¿›è¡Œäº†å½’ä¸€åŒ–ï¼Œå¯¹æ¯”å¦‚å›¾ï¼š
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;simd-sort&#x2F;img.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;ç»“è®ºï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ 1K ä»¥ä¸‹æ—¶ï¼Œ SIMD sort æ€§èƒ½æ¯” unstable sort è¦æ›´å¥½ã€‚ï¼ˆæ•°æ®é‡è¶Šå°çš„åœºæ™¯ï¼ŒSIMD ç‰ˆæœ¬æå‡è¶Šæ˜æ˜¾ï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ 16K ä»¥ä¸‹æ—¶ï¼Œ SIMD sort æ€§èƒ½æ¯” stable sort è¦æ›´å¥½ï¼Œï¼ˆåŒæ ·ï¼Œè¶Šå°çš„åœºæ™¯ï¼ŒSIMD ç‰ˆæœ¬æå‡è¶Šæ˜æ˜¾ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;unstable sort æ€§èƒ½æ¯” stable sort è¦å¥½20-30%ã€‚ï¼ˆè€Œä¸”ä¸éœ€è¦é¢å¤–çš„ç©ºé—´ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è¯´è€å®è¯ï¼Œå¾—å‡ºè¿™ä¸ªç»“æœæœ‰ä¸€ç‚¹æ²®ä¸§ï¼Œä¹Ÿå› æ­¤è€Œç¿»é˜…äº† rust sort çš„æ–‡æ¡£å’Œæºç ï¼Œäº†è§£äº† &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Voultapher&#x2F;driftsort&quot;&gt;driftsort&lt;&#x2F;a&gt;
çš„è®¾è®¡æ€è·¯ï¼Œå¤§æ¦‚å¾—å‡ºå¦‚ä¸‹çš„ç»“è®ºï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;driftsoft å†…éƒ¨æœ‰å¤§é‡åŸºäºå®é™…ç»éªŒçš„ä¼˜åŒ–ï¼ˆæ¯”å¦‚å¯¹å°‘äº20ä¸ªå…ƒç´ çš„åœºæ™¯è¿›è¡Œæ’å…¥æ’åºï¼‰ï¼Œéƒ¨ä»½å‡½æ•°ä¹Ÿæ”¯æŒ auto vectorizationã€‚ä½œä¸º rust æ ¸å¿ƒåº“ç²¾å¿ƒ
æŒ‘é€‰çš„ç®—æ³•ï¼Œè¦æƒ³æ‰“è´¥å®ƒï¼Œè¿˜æ˜¯æœ‰ç›¸å½“æŒ‘æˆ˜çš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;äºŒåˆ†æ’åºæ³•ä¹Ÿæ˜¯ stable çš„ï¼Œå› æ­¤ï¼Œå’Œ Slice::sort å¯¹æ¯”æ›´åˆé€‚ä¸€äº›ã€‚åœ¨16K ä»¥ä¸‹åœºæ™¯æ—¶ï¼ŒSIMD ç‰ˆæœ¬è¿˜æ˜¯æœ‰é¢†å…ˆä¼˜åŠ¿çš„ã€‚æ‰€ä»¥è¾“çš„ä¸ç®—å¤ªéš¾çœ‹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä»”ç»†åˆ†æäº†ä¸ºä»€ä¹ˆ SIMD ç‰ˆæœ¬æ²¡æœ‰é¢„æœŸçš„å¥½ï¼Œä¸»è¦çš„åŸå› æ˜¯åœ¨ merge sort éƒ¨åˆ†ï¼ŒSIMD å¯¹æ–°å¢çš„æ¯è½® merge çš„å¼€é”€åŸºæœ¬ä¸Šåœ¨ 1.3-1.4ns&#x2F;å…ƒç´ ï¼Œè€Œ
quick sort(driftsoftçš„æ ¸å¿ƒç®—æ³•)åœ¨ 0.5-0.8nsã€‚ æˆ‘æ¨æµ‹çš„åŸå› æ˜¯ï¼Œ quick sort åœ¨ è¿›è¡Œ pivot partition æ—¶ï¼Œå¯ä»¥åˆ©ç”¨åˆ°å½“å‰æ•°æ®çš„å±€éƒ¨æœ‰åºæ€§ï¼Œ
è€Œä»… move æ›´å°‘çš„å…ƒç´ ï¼Œè€Œ merge sort åˆ™æ¯æ¬¡éƒ½éœ€è¦ move å…¨éƒ¨çš„å…ƒç´ ï¼Œæœªèƒ½åˆ©ç”¨åˆ°æ•°æ®çš„å±€éƒ¨æœ‰åºæ€§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è¿™ä¹Ÿé¢ è¦†äº†æˆ‘ä¹‹å‰çš„è®¤çŸ¥ï¼šæˆ‘ä¸€ç›´ä»¥ä¸ºäºŒåˆ†æ’åºæ³• ä¸ å¿«é€Ÿæ’åºæ³•ï¼Œå…·æœ‰ç›¸åŒçš„æ—¶é—´å¤æ‚åº¦ï¼Œå› æ­¤ï¼Œä»–ä»¬çš„æ€§èƒ½åº”è¯¥æ˜¯ä¸€è‡´çš„ã€‚ä½†å®é™…ä¸Šï¼Œquick sort è¿˜æ˜¯æ›´å¿«ä¸€äº›ã€‚
ï¼ˆå½“ç„¶ï¼Œåœ¨ä¸è¿½æ±‚ stable çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å‡å°‘é¢å¤–çš„å†…å­˜éœ€æ±‚ã€‚stable sort å’Œ äºŒåˆ†æ’åºæ³•ï¼Œéƒ½éœ€è¦ N&#x2F;2 çš„è¾…åŠ©å†…å­˜ç”¨äºäº¤æ¢ã€‚ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;å…¶å®ƒï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨è¿›è¡Œ ns çº§çš„æ€§èƒ½ä¼˜åŒ–æ—¶ï¼Œå¾ˆå®¹æ˜“é™·å…¥åˆ°è¿‡æ—©ä¼˜åŒ–çš„ç»†èŠ‚ä¸­ï¼Œåœ¨è¿›è¡Œè¿™ä¸ªå®éªŒè¿‡ç¨‹ä¸­ï¼Œæˆ‘åˆšå¼€å§‹ä¹Ÿé™·å…¥åˆ°è¿‡æ—©ä¼˜åŒ–çš„å›°æƒ‘ä¸­ï¼Œåé¢æœæ–­æ”¾å¼ƒï¼Œå…ˆå®Œæˆä»£ç ï¼Œå†åˆ©ç”¨
samply ç­‰ profile å·¥å…·è¿›è¡Œæ€§èƒ½å¯¹æ¯”ï¼Œæœ€ååˆ†æå‡ºæ€§èƒ½ç“¶é¢ˆï¼Œæœ€åå‘ç°ï¼Œä½ å¯ä»¥å……åˆ†çš„ä¿¡èµ– rust çš„ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œè€Œæœ€åçš„æ€§èƒ½é—®é¢˜ï¼Œåªä¼šæ—¶æ•°æ®ç»“æ„ä¸Šçš„é—®é¢˜ï¼Œ
è­¬å¦‚ï¼Œåœ¨è¿™é‡Œï¼Œå°±æ˜¯ merge sort é˜¶æ®µçš„æ•°æ®å±€éƒ¨æ€§çš„é—®é¢˜ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åç»­å¯ä»¥å¯¹æ¯” &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;intel&#x2F;x86-simd-sort&#x2F;blob&#x2F;main&#x2F;src&#x2F;README.md&quot;&gt;intel x86-simd-sort&lt;&#x2F;a&gt; è¿™ä¸ªé¡¹ç›®ï¼Œ å¯¹æ¯”ä¸€ä¸‹ intel çš„è§£å†³æ–¹æ¡ˆï¼ˆquick sortç‰ˆæœ¬ï¼‰ï¼Œ
åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå¯ä»¥è¯„ä¼°ç¼–å†™ä¸€ç‰ˆ simd çš„ quick sortã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>November 2024</title>
        <published>2024-11-01T00:00:00+00:00</published>
        <updated>2024-11-01T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2024-11/"/>
        <id>https://wangzaixiang.github.io/monthly/2024-11/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2024-11/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.mapotofu.org&#x2F;blogs&#x2F;rabitq-bench&#x2F;&quot;&gt;Improve an algorithm performance step by step&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ samply å·¥å…·æ”¶é›†æ€§èƒ½æ•°æ®&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨ criterion åº“è¿›è¡Œæ€§èƒ½æµ‹è¯•&lt;&#x2F;li&gt;
&lt;li&gt;metrics é‡‡é›†&lt;&#x2F;li&gt;
&lt;li&gt;ç¼–è¯‘é€‰é¡¹ï¼šä¾‹å¦‚ &lt;code&gt;RUSTFLAGS=&quot;-C target-feature=+popcnt&quot;&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;SIMD åŠ é€Ÿï¼Œå¦‚æœç®—æ³•å¯ä»¥è°ƒæ•´ä¸º SIMD ä¼˜åŒ–çš„ç®—æ³•ï¼ŒåŠ é€Ÿæ•ˆæœä¼šå¾ˆæ˜æ˜¾ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é€‰æ‹©æ›´å¥½çš„åº“ï¼š faer&lt;&#x2F;li&gt;
&lt;li&gt;IO ä¼˜åŒ–&lt;&#x2F;li&gt;
&lt;li&gt;const generics&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;pythonspeed.com&#x2F;articles&#x2F;simd-stable-rust&#x2F;&quot;&gt;Using portable SIMD in stable Rust&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;å»¶ç»­ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;monthly&#x2F;2024-10&#x2F;#Languages&quot;&gt;October 2024&lt;&#x2F;a&gt; ä¸­ faster Mandelbrot with SIMD  ä¸€æ–‡&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»äº†ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ wide è¿™ä¸ªåº“ï¼Œåœ¨ stable rust ä¸­ä½¿ç”¨ SIMD çš„æ–¹æ³•ã€‚ ï¼ˆå¯ä»¥äº†è§£ä¸€ä¸‹ wide æ˜¯å¦‚ä½•é€šè¿‡ safe_arch è¿™ä¸ªåº“æ¥å¤„ç†å¤šå¹³å°æ¶æ„çš„
æ”¯æŒçš„ï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æŒ‰ç…§æœ¬æ–‡çš„æµ‹è¯•ï¼Œwideçš„æ€§èƒ½ç›¸æ¯” portable-simd è¦æ…¢ä¸€äº›ï¼Œä½†æ¯” scalar çš„ç‰ˆæœ¬è¿˜æ˜¯æœ‰æˆå€çš„æå‡ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ pulp åº“ï¼Œè¿™ä¸ªåº“æ˜¯ä¸€ä¸ª high level SIMD abstraction. ä¹Ÿæ˜¯ stable rust çš„ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=M8dpH3rO-2M&quot;&gt;Runtime Scripting for Rust Applications&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;dl.korz.dev&#x2F;eurorust2024.pdf&quot;&gt;PDF&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Python.  PyO3(Rust bindings for Python) &#x2F; RustPython(a interpreter written in Rust)&lt;&#x2F;li&gt;
&lt;li&gt;Lua:  lightweight.(355k lua vs 25M cpython vs 37m V8) &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;mlua-rs&#x2F;mlua&quot;&gt;mlua bindings to rust&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;JavaScript
&lt;ul&gt;
&lt;li&gt;V8: &lt;a href=&quot;https:&#x2F;&#x2F;crates.io&#x2F;crates&#x2F;v8&quot;&gt;rusty_v8r&lt;&#x2F;a&gt; , deno_core, deno_ast, deno_runtime&lt;&#x2F;li&gt;
&lt;li&gt;JavaScriptCore: &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wasmerio&#x2F;rusty_jsc&quot;&gt;rusty_jsc&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;endoli&#x2F;javascriptcore.rs&quot;&gt;jsc.rs&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;SpiderMonkey: &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;servo&#x2F;mozjs&quot;&gt;mozjs&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;WASM&lt;&#x2F;li&gt;
&lt;li&gt;rhai: AST-interpreter, dynamic typed&lt;&#x2F;li&gt;
&lt;li&gt;mun:  AOT, static typed, hot reloading. LLVM based&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;a deep dive into the bun architecture&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;makwritinghouse.com&#x2F;bun&#x2F;a-deep-dive-into-the-bun-architecture-part-1&#x2F;&quot;&gt;part 1&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;core layer(using C&#x2F;Zig): managing JS runtime, the native HTTP server, and the file system.&lt;&#x2F;li&gt;
&lt;li&gt;API layer(using js).
ç›®å‰æ²¡æœ‰åç»­çš„æ–‡ç« ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;MPP &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;web-visualization&quot;&gt;Web &amp;amp; Visualization&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;bun 1.1.34 æ”¯æŒ Wasm GCï¼Œdart&#x2F;kotlin&#x2F;scalajs ç­‰å¯ä»¥ç¼–è¯‘ä¸º wasm çš„è¯­è¨€éƒ½å¯ä»¥ä½¿ç”¨ bun äº†ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;brisa.build&quot;&gt;brisa&lt;&#x2F;a&gt;
ç®€å•çš„æµè§ˆäº†ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ï¼Œæœ‰ä¸€ä¸‹ç‰¹è‰²ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ ¸å¿ƒ: ä¸¤ä¸ªç»„ä»¶æ¨¡å‹ï¼šServer Component, Client Componentã€‚
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Server Component: è¿è¡Œåœ¨ Server ç«¯çš„ JS ç»„ä»¶ï¼Œæ¦‚å¿µå’Œ JSF(Java Server Faces)ã€&lt;a href=&quot;https:&#x2F;&#x2F;tapestry.apache.org&quot;&gt;Tapestry&lt;&#x2F;a&gt; å¾ˆç›¸ä¼¼ã€‚
è‹¥å¹²å¹´å‰ï¼Œtapestry æ›¾æ˜¯æˆ‘çš„æœ€çˆ±ã€‚ä¸è¿‡ï¼Œbrisa æ˜¯åŸºäº JavaScript çš„æœåŠ¡ç«¯ç»„ä»¶ï¼Œä½¿ç”¨ JSX çš„è¯­æ³•ï¼Œä¼¼ä¹æ¯” tapestry æ›´ç®€å•ã€‚å½“ç„¶ï¼Œä½¿ç”¨ JSX
æ¥æè¿°æœåŠ¡ç«¯çš„ç»„ä»¶ï¼Œåœ¨æœåŠ¡ç«¯å¤„ç†äº‹ä»¶ï¼Œä»serverç«¯æ›´æ–°çŠ¶æ€åˆ° client ç«¯ï¼Œæ•´ä¸ªçš„ç¼–ç¨‹æ¨¡å‹è¿˜æ˜¯æœ‰äº›åˆ«æ‰­çš„ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;JSFã€Tapestryç­‰æœåŠ¡ç«¯ UI ç»„ä»¶æ¨¡å‹ï¼Œéšç€ å‰ç«¯ç»„ä»¶æŠ€æœ¯çš„å…´èµ·ï¼Œå·²ç»é€æ­¥é€€å‡ºå†å²èˆå°ã€‚brisa æŠŠè¿™ä¸ªæ¦‚å¿µé‡æ–°æ‹¾èµ·ï¼Œæˆ‘ä¸ªäººæ„Ÿè§‰æ„ä¹‰ä¸å¤§ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Client Component: åŸºäº Web Component çš„å‰ç«¯ç»„ä»¶ï¼Œbrisa çš„å‰ç«¯ç»„ä»¶ï¼Œæ•´ä½“ä¸ SolidJSã€Svelte ç­‰ç›¸ä¼¼ã€‚ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ç‚¹æ˜¯ï¼Œbrisa æ”¯æŒ
Web Component çš„ SSRï¼Œ ä¹Ÿå°±æ˜¯åœ¨ä¸€ä¸ª Server Component ä¸­ï¼Œå¯ä»¥åµŒå…¥ Client Componentï¼Œè¿™ä¸ª Client Component ä¼šå…ˆSSR. ç›¸å½“äºåˆå§‹åŒ–
è¿‡ç¨‹å¯ä»¥åœ¨æœåŠ¡ç«¯å®Œæˆã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªæŒ‘æˆ˜ï¼šSSR å’Œ CSR æ··åˆä½¿ç”¨æ—¶ï¼ŒCSR æ˜¯å¦‚ä½•å°†åŠ¨æ€æ•°æ®ä¸ Declarative Shadow DOM ç»“åˆçš„ï¼Ÿbrisa åœ¨è¿™æ–¹é¢ä¼¼ä¹æ¯” Lit SSR åšçš„æ›´ä¼˜é›…ä¸€äº›ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;çº¦å®šè€Œéé…ç½®ã€‚è¿™ä½¿å¾—åº”ç”¨å˜å¾—éå¸¸ç®€å•ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Web Components UI Library&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;shoelace.style&quot;&gt;Shoelace&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;sap.github.io&#x2F;ui5-webcomponents&#x2F;blog&#x2F;releases&#x2F;announcing-v2&#x2F;&quot;&gt;SAP UI5&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;momentum-design&#x2F;momentum-ui&#x2F;tree&#x2F;master&#x2F;web-components#:~:text=lit-element&quot;&gt;Cisco Momentum&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;opensource.adobe.com&#x2F;spectrum-web-components&#x2F;components&#x2F;underlay&quot;&gt;Adobe&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;crayons.freshworks.com&quot;&gt;Stencil Components&lt;&#x2F;a&gt; Build with Stencil.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;vaadin.com&#x2F;docs&#x2F;latest&#x2F;components&quot;&gt;Vaadin&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;developer.salesforce.com&#x2F;docs&#x2F;component-library&#x2F;overview&#x2F;components&quot;&gt;Sale Force&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;ä»¥ä¸‹åº“ç›®å‰å¤„åœ¨æœªç»´æŠ¤ã€æ›´æ–°çŠ¶æ€&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;elix&#x2F;elix&quot;&gt;Elix&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;hope-ui.netlify.app&quot;&gt;Hope UI&lt;&#x2F;a&gt; è¢« pigment æ›¿ä»£ï¼Œä½†ç›®å‰å°šæœªå‘å¸ƒ&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;material-components&#x2F;material-components-web&quot;&gt;MWC&lt;&#x2F;a&gt; mwc is in maintenance mode.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;tools-libraries&quot;&gt;Tools &amp;amp; Libraries&lt;&#x2F;h1&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>å…³äºè½¯ä»¶å¤æ‚æ€§</title>
        <published>2024-10-07T00:00:00+00:00</published>
        <updated>2024-10-07T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/complexity/"/>
        <id>https://wangzaixiang.github.io/blog/complexity/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/complexity/">&lt;p&gt;å¤æ‚æ€§æ˜¯è½¯ä»¶å¼€å‘ä¸­æœ€ä¸ºæ ¸å¿ƒçš„é—®é¢˜ï¼Œç»å¤§å¤šæ•°çš„åˆ›æ–°ï¼ŒåŒ…æ‹¬æ–¹æ³•è®ºã€å·¥å…·ã€æ¡†æ¶ã€ç¼–ç¨‹è¯­è¨€ç­‰ï¼Œéƒ½å¯ä»¥è¯´æ˜¯ä¸ºäº†åº”å¯¹å¤æ‚æ€§çš„æŒ‘æˆ˜è€Œäº§ç”Ÿçš„ã€‚ä¼—å¤šè½¯ä»¶äº§å“ã€
é¡¹ç›®å¾€å¾€æ¶ˆè€—å·¨å¤§çš„äººåŠ›ã€è´¢åŠ›ï¼Œåœ¨è§£å†³é¡¹ç›®ä¸­å› å¤æ‚æ€§å¸¦æ¥çš„ç»´æŠ¤ã€BUGã€å®‰å…¨é—®é¢˜ä¸Šã€‚æœ¬æ–‡æ”¶é›†äº†ä¸€äº›å…³äºè½¯ä»¶å¤æ‚æ€§çš„è§‚ç‚¹ï¼Œå¹¶å åŠ äº†ä¸€äº›ä¸ªäººçš„æ€è€ƒã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦å‚è€ƒï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;milkov.tech&#x2F;assets&#x2F;psd.pdf&quot;&gt;A Philosophy of Software Design&lt;&#x2F;a&gt; ä¸­æ–‡ç‰ˆï¼š&lt;a href=&quot;https:&#x2F;&#x2F;yingang.github.io&#x2F;aposd2e-zh&#x2F;&quot;&gt;è½¯ä»¶è®¾è®¡çš„å“²å­¦&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;Chapter 2: The Nature of Complexity&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;book.douban.com&#x2F;subject&#x2F;1467587&#x2F;&quot;&gt;The Art of UNIX Programming&lt;&#x2F;a&gt; ä¸­æ–‡ç‰ˆï¼šUnixç¼–ç¨‹è‰ºæœ¯ (å¾®ä¿¡è¯»ä¹¦ä¸Šæœ‰ç”µå­ä¹¦)
&lt;ul&gt;
&lt;li&gt;Chapter 13: Complexity, As Simple As Possible, but No Simpler.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Rust for Rustaceans
&lt;ul&gt;
&lt;li&gt;Chapter 3: Design Interfaces&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;1-fu-za-xing&quot;&gt;1. å¤æ‚æ€§&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;fu-za-xing-de-ding-yi&quot;&gt;å¤æ‚æ€§çš„å®šä¹‰&lt;&#x2F;h2&gt;
&lt;p&gt;åœ¨&lt;code&gt;è½¯ä»¶è®¾è®¡çš„å“²å­¦&lt;&#x2F;code&gt;ä¸€ä¹¦ä¸­ï¼Œå¯¹å¤æ‚æ€§è¿›è¡Œäº†å¦‚ä¸‹å®šä¹‰ï¼š&lt;code&gt;è½¯ä»¶çš„å¤æ‚æ€§æ˜¯æŒ‡é‚£äº›è®©ç³»ç»Ÿéš¾ä»¥ç†è§£çš„éƒ¨ä»½&lt;&#x2F;code&gt;ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;éš¾ä»¥ç†è§£ï¼šå½“å‡ºç°é—®é¢˜æ—¶ï¼Œéš¾ä»¥æ‰¾åˆ°é—®é¢˜çš„åŸå› ï¼Œå¯¹ç³»ç»Ÿçš„è¡Œä¸ºéš¾ä»¥é¢„æµ‹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;éš¾ä»¥ä¿®æ”¹ï¼šæ— è®ºæ˜¯æ·»åŠ æ–°åŠŸèƒ½ã€ä¿®å¤BUGã€ä¼˜åŒ–æ€§èƒ½ï¼Œæ— ä»ä¸‹æ‰‹ï¼Œæ”¹ä¸åŠ¨ï¼Œæˆ–è€…ä¿®æ”¹å®Œåå¼•å…¥æ›´å¤šçš„é—®é¢˜ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªé—®é¢˜æ˜¯ç›¸äº’å…³è”çš„ï¼Œå› ä¸ºéš¾ä»¥ç†è§£ï¼ˆæ— æ³•ç†è§£å…¶ç»“æ„ã€æµç¨‹ã€ç®—æ³•ï¼‰ï¼Œä¼šå¯¼è‡´éš¾ä»¥ä¿®æ”¹ã€‚è€Œå› ä¸ºéš¾ä»¥ä¿®æ”¹ï¼Œä¼šå¯¼è‡´åœ¨ç»´æŠ¤çš„è¿‡ç¨‹ä¸­ï¼Œå¼•å…¥æ›´å¤šçš„è¡¥ä¸ï¼Œå¯¼è‡´
ç³»ç»Ÿæ›´ä¸ºå¤æ‚ï¼Œå¯ç†è§£èƒ½åŠ›æŒç»­ä¸‹é™ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;fu-za-xing-de-zhu-yao-zheng-zhuang&quot;&gt;å¤æ‚æ€§çš„ä¸»è¦ç—‡çŠ¶&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å˜æ›´æ”¾å¤§ï¼šå¯¹ç³»ç»Ÿçš„ä¸€ä¸ªå°å˜æ›´ï¼Œä¼šå¯¼è‡´ç³»ç»Ÿä¸­çš„å¤šä¸ªåœ°æ–¹è¿›è¡Œä¿®æ”¹ï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç½‘ç«™ä¸­ï¼Œä¿®æ”¹ banner çš„å†…å®¹ã€é¢œè‰²ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤šä¸ªé¡µé¢çš„ä¿®æ”¹ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æºä¹‹ä¸€ï¼šé‡å¤ã€‚å¤šä¸ªæ¨¡å—å­˜åœ¨ç›¸åŒã€ç›¸ä¼¼çš„é€»è¾‘ã€‚å½“å­˜åœ¨é‡å¤çš„ä»£ç ã€é€»è¾‘æ—¶ï¼Œä¿®æ”¹å°±ä¼šè”“å»¶ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ ¹æºä¹‹äºŒï¼šè€¦åˆï¼šå½“ä¸€ä¸ªæ¨¡å—å‘ç”Ÿå˜æ›´æ—¶ï¼Œä¼šè¾å°„åˆ°å…¶ä»–æ¨¡å—ï¼Œç„¶åç»§ç»­è¾å°„ï¼Œæœ€åå½¢æˆä¸€ä¸ªå·¨å¤§çš„å˜æ›´èŒƒå›´ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;blockquote&gt;
&lt;p&gt;Macro æ˜¯åº”å¯¹é‡å¤ä»£ç çš„ä¸€ç§æ–¹å¼ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;è®¤çŸ¥è´Ÿè·ï¼šå¼€å‘äººå‘˜éœ€è¦æŒæ¡å¤šå°‘çŸ¥è¯†ï¼Œæ‰èƒ½å®Œæˆä¸€ä¸ªä»»åŠ¡ï¼ˆä¾‹å¦‚è°ƒç”¨æ¥å£ã€å®ŒæˆæŸä¸ªåŠŸèƒ½ï¼‰ã€‚ç†è®ºä¸Šï¼Œæ¯ä¸ªåŠŸèƒ½çš„å®ç°ï¼Œæ·±ç©¶ä¸‹å»ï¼Œå°±ä¼šæ¶‰åŠåˆ°è®¡ç®—æœºç§‘å­¦çš„
å„ä¸ªé¢†åŸŸï¼Œä¾‹å¦‚ï¼šæ“ä½œç³»ç»Ÿã€ç½‘ç»œã€æ•°æ®åº“ã€ç¼–è¯‘åŸç†ã€ç®—æ³•ç­‰ï¼Œå¯ä»¥åˆ¶é€ å‡ºæ— ç©·çš„å¤æ‚æ€§ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æºä¹‹ä¸€ï¼šç¼ºå°‘å°è£…ï¼Œæš´éœ²äº†å¤ªå¤šçš„ç»†èŠ‚ï¼ŒåŠ æ·±äº†å¤–éƒ¨çš„è®¤çŸ¥è´Ÿæ‹…ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ ¹æºä¹‹äºŒï¼šç¼ºå°‘æŠ½è±¡ã€‚æŠŠä¼—å¤šåŠŸèƒ½ç‰¹æ€§æ··åˆåœ¨ä¸€èµ·ï¼Œæ„æˆä¸€ä¸ª macro æ¨¡å—ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ ¹æºä¹‹ä¸‰ï¼šä¸ä¸€è‡´æ€§ã€‚ å¯¹è½¯ä»¶äº§å“è€Œè¨€ï¼ŒUIã€æ–‡æ¡£çš„ä¸ä¸€è‡´æ€§ä¼šå¸¦ç»™ç”¨æˆ·è®¤çŸ¥è´Ÿæ‹…ã€‚å¯¹è½¯ä»¶ä»£ç è€Œè¨€ï¼Œå‘½åã€æ¥å£ã€è¡Œä¸ºçš„ä¸ä¸€è‡´æ€§æ€§ï¼Œä¼šå¸¦ç»™ç»´æŠ¤äººå‘˜
ç†è§£ä»£ç çš„è®¤çŸ¥è´Ÿæ‹…ã€‚ä¸ä¸€è‡´æ€§ä¸é‡å¤æ˜¯å¯†åˆ‡ç›¸å…³çš„ï¼Œé‡å¤ä¼šå¸¦æ¥ä¸ä¸€è‡´æ€§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ ¹æºä¹‹å››ï¼šä¸ç¬¦åˆç›´è§‰ã€æƒ¯ä¾‹çš„è®¾è®¡ã€‚æ¯ä¸ªè¯­è¨€ã€æ¡†æ¶ï¼Œéƒ½æœ‰å…¶è‡ªå·±å½¢æˆçš„æƒ¯ç”¨æ³•ï¼Œæœ€ä½³å®è·µã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æœªçŸ¥çš„æœªçŸ¥ï¼ˆä¸ç¡®å®šæ€§ï¼‰ã€‚åœ¨åºå¤§çš„è®¤çŸ¥è´Ÿè·ä¹‹ä¸‹ï¼Œæ˜¯ä¸ç¡®å®šæ€§ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;ul&gt;
&lt;li&gt;ç¼ºä¹å¥‘çº¦å®šä¹‰ï¼ˆè¾¹ç•Œä¸æ˜ç¡®ï¼‰ï¼šå¯¹è¾“å…¥ã€è¾“å‡ºçš„è¾¹ç•Œã€çº¦æŸã€è§„èŒƒæ²¡æœ‰æ˜ç¡®çš„å®šä¹‰ã€‚
&lt;ul&gt;
&lt;li&gt;è¯­ä¹‰ä¸æ¸…æ™°ã€‚æ¥å£çš„è¡Œä¸ºï¼Œè®²ä¸æ¸…æ¥šï¼Œè‡ªç„¶å®ç°å°±è€ƒè™‘ä¸åˆ°ï¼Œä¹Ÿæ— æ³•è¿›è¡Œæµ‹è¯•è¦†ç›–ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸å¯è¯æ˜æ€§ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;ä¸å®Œå¤‡æ€§ã€‚ç³»ç»Ÿçš„è¡Œä¸ºæ˜¯å¦èƒ½è¦†ç›–å¥‘çº¦ï¼ˆè¾¹ç•Œå†…ï¼‰çš„å…¨éƒ¨åœºæ™¯ï¼Œæœ‰å“ªäº›ä¸èƒ½è¦†ç›–çš„åœºæ™¯æ˜¯æœªçŸ¥çš„ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;fu-za-xing-de-fen-lei&quot;&gt;å¤æ‚æ€§çš„åˆ†ç±»&lt;&#x2F;h2&gt;

&lt;img src=&quot;https:&amp;#x2F;&amp;#x2F;wangzaixiang.github.io&amp;#x2F;processed_images&amp;#x2F;img.a692be447cc4c1ba.png&quot; &#x2F;&gt;
&lt;p&gt;åœ¨&lt;code&gt;UNIXç¼–ç¨‹è‰ºæœ¯&lt;&#x2F;code&gt;ä¸€ä¹¦ä¸­ï¼Œå°†å¤æ‚åº¦åˆ†ä¸º3ç±»ã€3ä¸ªæ¥æºï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¤æ‚åº¦ç§ç±»ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æœ¬è´¨å¤æ‚åº¦ï¼šé—®é¢˜é¢†åŸŸè‡ªèº«çš„å¤æ‚æ€§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é€‰æ‹©å¤æ‚åº¦ï¼šä¸ç›®æ ‡éœ€æ±‚ç›¸å…³çš„å¤æ‚æ€§ï¼Œåªèƒ½é€šè¿‡æ”¹å˜å·¥ç¨‹çš„ç›®æ ‡æ¥æ”¹å˜å¤æ‚åº¦ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¶ç„¶å¤æ‚åº¦ï¼šå¯ä»¥é€šè¿‡è‰¯å¥½çš„è®¾è®¡ã€è¿‡ç¨‹æ¥æ”¹å–„çš„å¤æ‚åº¦ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å¤æ‚åº¦æ¥æºä¹‹ä¸€ï¼šä»£ç å¤æ‚åº¦ï¼š&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;UNIXç¼–ç¨‹è‰ºæœ¯&lt;&#x2F;code&gt;ä¸€ä¹¦ä¸­ï¼Œè®¤ä¸ºï¼š&quot;ä»£ç çš„ç¼ºé™·å¯†åº¦ï¼Œæ¯ç™¾è¡Œä»£ç å‡ºé”™ç‡ï¼Œå¾€å¾€æ˜¯ä¸€ä¸ªä¸å®ç°è¯­è¨€ç§ç±»æ— å…³çš„å¸¸é‡ã€‚æ›´å¤šè¡Œçš„ä»£ç æ„å‘³ç€æ›´å¤šçš„ bugï¼Œ
è€Œè°ƒè¯•å¸¸å¸¸æ˜¯å¼€å‘ä¸­æœ€æ˜‚è´µã€æœ€è€—æ—¶çš„éƒ¨åˆ†ã€‚&quot;ï¼Œè¿™ç§è¯´æ³•æ”¾åˆ°ä»Šå¤©ï¼Œæˆ‘è§‰å¾—æ˜¯ä¸æ­£ç¡®çš„äº†ï¼š&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»£ç è¡Œæ•°ä»…æ˜¯å¤æ‚åº¦çš„ä¸€ä¸ªæŒ‡æ ‡ï¼Œä½†ç›¸åŒè¡Œæ•°çš„ä»£ç ï¼Œä»ç„¶ä¼šæœ‰ä¸åŒçš„å¤æ‚åº¦ï¼Œç”šè‡³å·®å¼‚å¾ˆå¤§ã€‚ä¾‹å¦‚åœˆå¤æ‚åº¦ï¼ŒåŠ å…¥äº†å¯¹åˆ†æ”¯è·¯å¾„çš„
å¤æ‚åº¦è¯„ä¼°ã€‚åœ¨è¿™æ–¹é¢ï¼Œå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚Scalaï¼‰ ç›¸æ¯” è¿‡ç¨‹å¼ç¼–ç¨‹è¯­è¨€ï¼ˆJavaï¼‰æ¥è¯´ï¼Œæœ‰ç€æ˜¾è‘—çš„ä¼˜åŠ¿ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ä»£ç è¡Œæ•°&lt;&#x2F;li&gt;
&lt;li&gt;åœˆå¤æ‚åº¦ï¼ˆåˆ†æ”¯ã€è·¯å¾„ï¼‰ï¼šFP é€šè¿‡é«˜é˜¶å‡½æ•°å‡å°‘äº†åˆ†æ”¯ï¼Œé™ä½äº†æ•°æ®å¤æ‚åº¦ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ•°æ®æµå¤æ‚åº¦ã€‚FP çš„æ•°æ®ä¸å˜æ€§ï¼Œå½¢æˆäº† SSA(Static Single Assignment) å½¢å¼ï¼Œé™ä½äº†æ•°æ®æµå¤æ‚åº¦ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åŠŸèƒ½å¯†åº¦ï¼šæ›´é«˜çº§çš„è¯­è¨€ã€æ›´è‰¯å¥½çš„æŠ½è±¡ï¼Œä¹Ÿä¼šå¸¦æ¥æ›´é«˜çš„åŠŸèƒ½å¯†åº¦ã€‚ä¸€è¡Œä»£ç å°±å¯ä»¥ç­‰æ•ˆäºä½çº§è¯­è¨€ã€ä½çº§æŠ½è±¡çš„å¤šè¡Œä»£ç ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å¤æ‚åº¦æ¥æºä¹‹äºŒã€ä¹‹ä¸‰ï¼š æ¥å£å¤æ‚åº¦&#x2F;å®ç°å¤æ‚åº¦&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;MIT &#x2F; New Jersey é£æ ¼&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;UNIXç¼–ç¨‹è‰ºæœ¯&lt;&#x2F;code&gt;ä¸€ä¹¦ä¸­æåˆ°çš„ MIT å“²å­¦ï¼Œä¾§é‡äº æ¥å£çš„ç®€å•æ€§ï¼Œè€Œ &quot;New Jersey&quot; å“²å­¦ï¼Œåˆ™ä¾§é‡äºå®ç°çš„ç®€å•æ€§ã€‚ä¹¦ä¸­ä¹Ÿæåˆ° UNIX çš„å“²å­¦æ˜¯åå‘äº
æ¥å£çš„ç®€å•æ€§ï¼Œä»¥åŠå¤„ç† signal çš„é£æ ¼ï¼ŒSystem V åˆ™æ˜¯åå‘äºå®ç°çš„ç®€å•æ€§ï¼Œè€Œ BSD åé‡äºæ¥å£çš„ç®€å•æ€§ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Simple vs Easy
&lt;a href=&quot;http:&#x2F;&#x2F;www.lihaoyi.com&#x2F;post&#x2F;comlihaoyiScalaExecutablePseudocodethatsEasyBoringandFast.html&quot;&gt;Executable Pseudocode that&#x27;s Easy, Boring, and Fast&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å¯æ‰§è¡Œçš„ä¼ªä»£ç ã€‚æ ¸å¿ƒå°±æ˜¯é¢å‘é˜…è¯»çš„é«˜å¯é˜…è¯»æ€§çš„ä»£ç ã€‚éœ€è¦ç»å¸¸æŒ‘æˆ˜çš„æ˜¯ï¼šè¦å®Œæˆè¿™æ®µåŠŸèƒ½ï¼Œè¿˜å¯ä»¥æ›´ç®€å•å—ï¼Ÿ&lt;&#x2F;li&gt;
&lt;li&gt;Easy not simple: è¿™é‡Œ Easy æ˜¯å¯¹ä½¿ç”¨è€…è€Œè¨€çš„ã€‚æ¥å£ç®€å•ï¼Œæ‰èƒ½è®©ä½¿ç”¨è€…æ›´å®¹æ˜“ä½¿ç”¨ï¼Œsimple æ˜¯å¯¹å®ç°è€…è€Œè¨€çš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Boring not interesting: ä½œè€…çš„æ„æ€æ˜¯ä¸è¦æå¤§è€Œå…¨çš„æ¡†æ¶ï¼Œè€Œæ˜¯èšç„¦äºä¸€ä¸ªé¢†åŸŸï¼Œåšå¥½ä¸€ä¸ªå°è€Œç¾çš„å·¥å…·ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matthiasn&#x2F;talk-transcripts&#x2F;blob&#x2F;master&#x2F;Hickey_Rich&#x2F;SimpleMadeEasy.md&quot;&gt;Simple made easy&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;æ—©æœŸæ•™æ¡çš„ UNIX å“²å­¦ï¼šå®å¯æ”¾å¼ƒåŠŸèƒ½ï¼Œä¹Ÿä¸èƒ½æ”¾å¼ƒç®€å•æ€§ã€‚ CLI ä¸ GUI ä¹‹æˆ˜ï¼Œå°±æ˜¯è¿™ç§å“²å­¦çš„ä½“ç°ã€‚è¿™ä¹Ÿæ˜¯å…¸å‹çš„â€œå› ä¸ºè„æ°´è€Œä¸¢æ‰å­©å­â€çš„åšæ³•ã€‚
&lt;code&gt;è½¯ä»¶è®¾è®¡çš„å“²å­¦&lt;&#x2F;code&gt;ä¸€ä¹¦ä¸­åˆ—ä¸¾äº† edã€viã€samã€emacsã€wily ç­‰æ–‡æœ¬ç¼–è¾‘å™¨çš„æ¼”è¿›å†ç¨‹ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;è½¯ä»¶è®¾è®¡çš„å“²å­¦&lt;&#x2F;code&gt;ä¸€ä¹¦ä¸­ï¼Œæ›´æ˜¯æå‡ºäº† â€œDeep Moduleâ€ çš„è®¾ç½®å“²å­¦ï¼Œå³å¼ºè°ƒï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ¥å£è®¾è®¡åº”å½“ smaller and simplerï¼Œä»è€Œå‡å°‘ä¾èµ–å¤æ‚åº¦ï¼Œè®¤çŸ¥å¤æ‚åº¦ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ¨¡å—å†…éƒ¨çš„å®ç°ï¼Œåº”è¯¥ deepï¼Œå³åŒ…å«æ›´å¤šçš„åŠŸèƒ½ï¼Œéšè—æ›´å¤šçš„ç»†èŠ‚ã€‚è€Œé¿å… proxy&#x2F;adapter è¿™ç§æµ…å±‚æ¨¡å—ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;fu-za-xing-de-du-liang&quot;&gt;å¤æ‚æ€§çš„åº¦é‡&lt;&#x2F;h2&gt;
&lt;p&gt;å¾…è¡¥å……&lt;&#x2F;p&gt;
&lt;h1 id=&quot;2-ru-he-jiang-di-jie-kou-fu-za-xing&quot;&gt;2 å¦‚ä½•é™ä½æ¥å£å¤æ‚æ€§&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;2-1-design-by-contract-zeng-qiang-jie-kou-de-que-ding-xing&quot;&gt;2.1 Design By Contract: å¢å¼ºæ¥å£çš„ç¡®å®šæ€§&lt;&#x2F;h2&gt;
&lt;p&gt;è®¾è®¡å¥‘çº¦ï¼ˆDesign by Contractï¼‰æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ–¹æ³•ï¼Œç”± Bertrand Meyer åœ¨ 1986 å¹´æå‡ºã€‚Meyer ç”šè‡³åˆ›å»ºäº†ä¸€é—¨è¯­è¨€ï¼šEiffelã€‚Eiffel è¯­è¨€çš„æœ€å¤§ç‰¹å¾
å°±æ˜¯å†…ç½®äº†å¯¹ Contract çš„æ”¯æŒï¼Œå°† DBC ä»çº¦å®šå˜ä¸ºæ˜¾å¼çš„ç¼–ç¨‹æ„ä»¶ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;eiffel&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-eiffel &quot;&gt;&lt;code class=&quot;language-eiffel&quot; data-lang=&quot;eiffel&quot;&gt;&lt;span&gt;note
&lt;&#x2F;span&gt;&lt;span&gt;    description: &amp;quot;Simple bank accounts&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;class
&lt;&#x2F;span&gt;&lt;span&gt;    ACCOUNT
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;feature -- Access
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    balance: INTEGER
&lt;&#x2F;span&gt;&lt;span&gt;            -- Current balance
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    deposit_count: INTEGER
&lt;&#x2F;span&gt;&lt;span&gt;            -- Number of deposits made since opening
&lt;&#x2F;span&gt;&lt;span&gt;        do
&lt;&#x2F;span&gt;&lt;span&gt;            ... As before ...
&lt;&#x2F;span&gt;&lt;span&gt;        end
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;feature -- Element change
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    deposit (sum: INTEGER)
&lt;&#x2F;span&gt;&lt;span&gt;            -- Add `sum&amp;#39; to account.
&lt;&#x2F;span&gt;&lt;span&gt;        require
&lt;&#x2F;span&gt;&lt;span&gt;            non_negative: sum &amp;gt;= 0
&lt;&#x2F;span&gt;&lt;span&gt;        do
&lt;&#x2F;span&gt;&lt;span&gt;            ... As before ...
&lt;&#x2F;span&gt;&lt;span&gt;        ensure
&lt;&#x2F;span&gt;&lt;span&gt;            one_more_deposit: deposit_count = old deposit_count + 1
&lt;&#x2F;span&gt;&lt;span&gt;            updated: balance = old balance + sum
&lt;&#x2F;span&gt;&lt;span&gt;        end
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;feature {NONE} -- Implementation
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    all_deposits: DEPOSIT_LIST
&lt;&#x2F;span&gt;&lt;span&gt;            -- List of deposits since account&amp;#39;s opening.
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;invariant
&lt;&#x2F;span&gt;&lt;span&gt;    consistent_balance: (all_deposits &#x2F;= Void) implies
&lt;&#x2F;span&gt;&lt;span&gt;            (balance = all_deposits . total)
&lt;&#x2F;span&gt;&lt;span&gt;    zero_if_no_deposits: (all_deposits = Void) implies
&lt;&#x2F;span&gt;&lt;span&gt;            (balance = 0)
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;end -- class ACCOUNT
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;DBC åªè¦ç”±ä¸‰ä¸ªéƒ¨ä»½ç»„æˆï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å‰ç½®æ£€æŸ¥ï¼šä¸€èˆ¬æ˜¯æ¥å£è°ƒç”¨è€…éœ€è¦ä¿éšœçš„éƒ¨ä»½ï¼ˆè°ƒç”¨è€…çš„èŒè´£ï¼‰ã€‚å½“ç„¶ï¼Œå¯¹äºå¾ˆå¤šæœåŠ¡å¤„ç†æ¥è¯´ï¼Œå‰ç½®æ£€æŸ¥ä¹Ÿæˆä¸ºæ˜¯æœåŠ¡æä¾›è€…çš„è´£ä»»ã€‚ä¸è¿‡ï¼Œä¸€äº›åŸºæœ¬çš„ç±»å‹å±‚é¢
çš„æ£€æŸ¥ï¼Œæ›´åŠ å»ºè®®ç›´æ¥é€šè¿‡å¼ºç±»å‹çš„æ–¹å¼æ¥å®ç°ï¼Œåœ¨æ¡†æ¶å±‚è¿›è¡Œæ£€æŸ¥ï¼Œé¿å…è®©æœåŠ¡æä¾›è€…å¤„ç†è¿™ç±»ä½å±‚æ¬¡çš„æ£€æŸ¥å·¥ä½œã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åç½®æ£€æŸ¥ã€‚åç½®æ£€æŸ¥æ˜¯æœåŠ¡æä¾›è€…åœ¨å®ŒæˆæœåŠ¡å¤„ç†åï¼Œæ‰€éœ€è¿›è¡Œçš„å¿…è¦æ£€æŸ¥ï¼Œç¡®ä¿è‡ªèº«å¤„ç†çš„æ­£ç¡®æ€§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸å˜é‡ã€‚ä¸å˜é‡æ˜¯ä¸€ç±»å¯¹è±¡çš„åŸºç¡€å¥‘çº¦ï¼Œæ— è®ºè¿›è¡Œä½•ç§æ“ä½œï¼Œéƒ½ä¸åº”è¯¥ç ´åè¿™ç§å¥‘çº¦ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ç°åœ¨ï¼Œä¸»æµçš„ç¼–ç¨‹è¯­è¨€ï¼Œéƒ½æ²¡æœ‰å¯¹ DBC çš„è¯­è¨€çº§æ˜¾ç¤ºæ”¯æŒï¼Œè€Œæ”¹ä¸ºä½¿ç”¨ assert æœºåˆ¶æ¥æä¾›éƒ¨ä»½çš„ DBC èƒ½åŠ›ã€‚ä½œä¸ºæ¥å£è®¾è®¡çš„ä¸€éƒ¨ä»½ï¼Œä¸ºæ¥å£ï¼ˆæ–¹æ³•ã€å¯¹è±¡ï¼‰æä¾›
æ˜ç¡®çš„å¥‘çº¦å®šä¹‰ï¼Œè¿™åº”è¯¥æˆä¸ºè®¾è®¡çš„ä¸€éƒ¨ä»½ï¼šå…·å¤‡æ¸…æ™°ã€è‰¯å¥½çš„å¥‘çº¦å®šä¹‰çš„æ¥å£ã€å¯¹è±¡ï¼Œä¼šæœ‰æ›´åŠ ç¡®å®šçš„è¾¹ç•Œã€‚è€Œåä¹‹ï¼Œç¼ºä¹å¥‘çº¦å®šä¹‰çš„æ¥å£ã€å¯¹è±¡ï¼Œå¾ˆå¯èƒ½ä¼šäº§å‡º
ä¸æ¸…æ™°çš„èŒè´£ã€ä¸ç¡®å®šçš„è¾¹ç•Œï¼Œä»¥åŠåœ¨ life time ä¸­äº§ç”Ÿè„æ•°æ®ï¼Œä»è€Œä½¿å¾—åç»­çš„è¡Œä¸ºå˜å¾—æ›´ä¸ºä¸å¯ç¢ç£¨ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä»¥ RDBMS ä¸ºä¾‹ï¼Œå…¶æä¾›äº† table&#x2F;column çº§ä¸Šçš„å¾ˆå¤š constraintï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;unique index ä¿è¯äº†æ•°æ®çš„å”¯ä¸€æ€§ï¼Œé˜²æ­¢é‡å¤æ•°æ®ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;not null é˜²æ­¢ null æ•°æ®è¿›å…¥ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;check çº¦æŸï¼Œä¿è¯æ•°æ®çš„åˆæ³•æ€§ã€‚éƒ¨ä»½æ•°æ®åº“å¯ä»¥å®šä¹‰ä¸€äº›åˆ—ä¸Šçš„æ ¡éªŒè¡¨è¾¾å¼ã€‚å¦‚ &lt;code&gt;CHECK (AGE &amp;gt;= 18)&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;foreign keyï¼šå¼•ç”¨å®Œæ•´æ€§ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;åœ¨èƒ½ä½¿ç”¨è¿™äº›åœºæ™¯çš„åœ°æ–¹ï¼Œåº”è¯¥ä¼˜å…ˆä½¿ç”¨æ•°æ®åº“çš„çº¦æŸï¼Œè€Œä¸æ˜¯åœ¨åº”ç”¨å±‚è¿›è¡Œçº¦æŸã€‚ä¸è¿‡ï¼Œå¯¹å¾ˆå¤šäº’è”ç½‘åº”ç”¨æ¥è¯´ï¼Œç”±äºåˆ†åº“åˆ†è¡¨ç­‰ç‰©ç†éƒ¨ç½²çš„çº¦æŸï¼Œä¼šé™åˆ¶ä½¿ç”¨
foreign keyï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦åœ¨åº”ç”¨å±‚æœ‰ç›¸åº”çš„åº”å¯¹æªæ–½ï¼Œé¿å…è„æ•°æ®è¿›å…¥ç³»ç»Ÿã€‚è„æ•°æ®è¿›å…¥ç³»ç»Ÿï¼Œæœ¬èº«å°±ä»¥ä¸ºç€ç³»ç»Ÿå­˜åœ¨ä¸¥é‡çš„ bugï¼Œæ›´ä¼šå¯¼è‡´åç»­å¤æ‚çš„å¤„ç†ã€
ä»¥åŠå¸¦æ¥æ›´å¤šä¸ç¡®å®šçš„ BUGï¼Œä»è€Œä½¿å¾—å¤æ‚æ€§æ¶åŒ–ï¼Œæ˜¯éœ€è¦å°½å¯èƒ½æå‰æ²»ç†çš„ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;Contract&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å¯ä»¥ä½œä¸ºæ–‡æ¡£çš„ä¸€éƒ¨ä»½ï¼Œä¸ºæ¥å£çš„ä½¿ç”¨è€…æä¾›ä»·å€¼ï¼Œ&lt;&#x2F;li&gt;
&lt;li&gt;å¯ä»¥ä½œä¸ºæµ‹è¯•çš„ä¸€éƒ¨ä»½ï¼Œåœ¨æµ‹è¯•é˜¶æ®µã€è¯•è¿è¡Œé˜¶æ®µï¼Œä½œä¸ºæ¥å£çš„å†…éƒ¨ä¿æŠ¤å™¨ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœä¸æ˜¯æ€§èƒ½å…³åˆ‡çš„ï¼Œåº”è¯¥åœ¨è¿è¡ŒæœŸé—´è¿›è¡Œå¿…è¦çš„å¥‘çº¦æ£€æŸ¥ã€‚å¦‚æœæŸäº›å¥‘çº¦æ£€æŸ¥æœ‰è¾ƒé«˜çš„æ€§èƒ½æˆæœ¬ï¼Œåˆ™å¯ä»¥è€ƒè™‘å¼‚æ­¥ã€æ‰¹é‡çš„æ–¹å¼è¿›è¡Œã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;2-2-wai-xiang-she-ji-mian-xiang-shi-yong-zhe-de-she-ji&quot;&gt;2.2 å¤–å‘è®¾è®¡(é¢å‘ä½¿ç”¨è€…çš„è®¾è®¡)&lt;&#x2F;h2&gt;
&lt;p&gt;å¯¹æ¥å£è®¾è®¡ å’Œ æ¨¡å—å®ç°ä¹‹é—´çš„å¹³è¡¡å’Œå–èˆï¼Œæœ‰ä¸¤ç§è¯´æ³•æ˜¯å¾ˆç”ŸåŠ¨ã€æœ‰è¶£çš„ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªç³Ÿç³•çš„å®ç°ï¼Œå¦‚æœéšè—åœ¨ä¸€ä¸ªè‰¯å¥½çš„æ¥å£åé¢ï¼Œè¿™ä¸ªç³Ÿç³•çš„å®ç°æ˜¯å¯ä»¥æ¥å—çš„ã€‚ï¼ˆè¿™ä¹Ÿæ˜¯æ•æ·ã€è¿­ä»£ã€TDDã€prototype ç­‰æ–¹æ³•è®ºçš„åŸºç¡€ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;è½¯ä»¶è®¾è®¡åº”è¯¥æ˜¯å¤–å‘çš„ï¼ˆé¢å¯¹ä½¿ç”¨è€…è¿›è¡Œè®¾è®¡ï¼‰ï¼Œè€Œä¸æ˜¯å†…å‘çš„ï¼ˆé¢å‘å®ç°ç»†èŠ‚è¿›è¡Œè®¾è®¡ï¼‰ï¼šæŠŠç®€å•ï¼ˆEasyï¼‰ç•™ç»™ç”¨æˆ·ï¼ŒæŠŠå¤æ‚(Complex)ç•™ç»™è‡ªå·±ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;UI(User Interface) ä¸ API(Application Programming Interface) ä¸¤è€…éƒ½æ˜¯ interfaceï¼Œå…¶è®¾è®¡å“²å­¦æœ‰è¯¸å¤šç›¸ä¼¼ä¹‹å¤„ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æˆ‘åœ¨å®é™…å·¥ä½œä¸­ï¼Œçœ‹åˆ°çš„å¤§éƒ¨ä»½çš„å¼€å‘è€…ï¼Œæ€»æ˜¯ä¹ æƒ¯äºå†…å‘çš„é£æ ¼ï¼šæˆ‘è¦å¦‚ä½•å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚è¿™æ ·åšä¼šè®¾è®¡å‡ºç³Ÿç³•çš„æ¥å£ï¼ˆç¼ºä¹æŠ½è±¡ã€ä½¿ç”¨ä¸æ–¹ä¾¿ï¼‰ï¼Œè¿›è€Œåˆ
å¯¼è‡´å†…éƒ¨æ¨¡å—çš„æŠ½è±¡åº¦ä¸å¤Ÿï¼ˆåšä¸€ä¸ªå¥½çš„æŠ½è±¡æ˜¯æœ‰éš¾åº¦çš„ï¼Œå†…å‘çš„è®¾è®¡é£æ ¼ä¼šä½¿å¾—æˆ‘ä»¬å…ˆé¿å¼€å±€éƒ¨çš„å¤æ‚æ€§ï¼Œè€Œç®€åŒ–æ¥å£ï¼‰ï¼Œå¯¼è‡´å®ç°çš„æ•´ä½“å¤æ‚åº¦å¢åŠ ã€‚è€Œ
è½¬ä¸ºå¤–å‘çš„é£æ ¼æ—¶ï¼Œæˆ‘ä»¬ä¼šä¼˜å…ˆä»ä½¿ç”¨è€…çš„è§’åº¦æ¥è®¾è®¡æ¥å£ï¼Œè®©æ¥å£æ›´ä¸ºç®€å•ã€è‡ªç„¶ã€æ¸…æ™°ã€‚è¿™éœ€è¦æ›´å¤šçš„æŠ½è±¡ï¼Œä¹Ÿéœ€è¦è€ƒè™‘æ›´å¤šå®è§‚çš„é—®é¢˜ã€‚TDD å°±æ˜¯ä¸€ç§å¤–å‘
çš„è®¾è®¡é£æ ¼ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¯¹å®ç°çš„å¤æ‚åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡è¿­ä»£çš„æ–¹å¼æ¥å®ç°ï¼Œåœ¨å‰æœŸï¼Œå…ˆå®ç°ä¸€ä¸ªç®€å•çš„ç‰ˆæœ¬ï¼Œæˆ–è€…æŸä¸ªåŸå‹å®ç°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨åç»­è¿­ä»£ä¸­ï¼Œé€æ­¥æ·±åŒ–æŠ½è±¡ã€åˆ†æ‹†åŒ–ã€æ­£äº¤åŒ–ï¼Œå°†å¤æ‚åº¦é€æ­¥é™ä½ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;éšç€æŠ€æœ¯çš„æ¼”è¿›ï¼Œä»Šå¤©éœ€è¦è½¬ç§»åˆ°è°ƒç”¨è€…çš„å¤æ‚æ€§ï¼Œæœªæ¥å¯èƒ½ä¼šå˜å¾—ç®€å•ã€‚ä¾‹å¦‚ï¼Œå¼‚æ­¥å¤„ç†çš„æ–¹å¼ï¼Œå°±ä»æœ€æ—©çš„ callback æ¨¡å¼ï¼Œæ¼”è¿›åˆ° Future&#x2F;Promiseï¼Œ
å†åˆ° async&#x2F;await æ¨¡å¼ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯å°†å¤æ‚æ€§ä»è°ƒç”¨è€…è½¬ç§»åˆ°å®ç°è€…ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å½“ç„¶ï¼Œåœ¨æœ‰çš„æ—¶å€™ï¼Œå¹³è¡¡æ˜¯å¿…é¡»çš„ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ¥å£è®¾è®¡çš„ç®€å•æ€§ï¼Œå¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œéœ€è¦æœ‰å¾ˆå¥½çš„æŠ½è±¡èƒ½åŠ›ã€‚æœ‰æ—¶è¿™ç§èƒ½åŠ›å¿…é¡»å»ºç«‹åœ¨ç›®æ ‡é¢†åŸŸçš„æ·±å…¥ç†è§£ã€ä¸°å¯Œç»éªŒä¹‹ä¸Šã€‚åœ¨å¯¹ç›®æ ‡é¢†åŸŸä¸å¤Ÿç†è§£
çš„æƒ…å†µä¸‹ï¼Œå¾ˆéš¾åšå‡ºç®€å•ã€ä¼˜é›…çš„æ¥å£è®¾è®¡ã€‚ æ‰€ä»¥ï¼Œæœ‰æ—¶ï¼Œè¿˜æ˜¯éœ€è¦å¿«é€Ÿå‰è¿›ï¼Œç­‰è¸©äº†å‘ä¹‹åï¼Œä½ æ‰ä¼šçŸ¥é“æ­£ç¡®çš„è®¾è®¡æ˜¯ä»€ä¹ˆã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨éƒ¨ä»½åœºæ™¯ä¸‹ï¼Œæ¥å£çš„ç®€å•æ€§ä¼šå¸¦æ¥è¿‡é«˜æˆæœ¬çš„å®ç°å¤æ‚åº¦ï¼ˆå¯èƒ½æ˜¯å—å½“å‰çš„æŠ€æœ¯ã€èµ„æºé™åˆ¶ï¼Œéš¾ä»¥çªç ´ï¼‰ï¼Œæˆ–è€…è¿½æ±‚æ¥å£çš„ç®€å•æ€§ï¼Œä¼šå¸¦æ¥ä¸¥é‡çš„æ€§èƒ½æŸå¤±ï¼Œ
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåšå¿…è¦çš„å¦¥åæ˜¯æœ‰ä»·å€¼çš„ã€‚ï¼ˆ&lt;code&gt;UNIXç¼–ç¨‹è‰ºæœ¯&lt;&#x2F;code&gt;ä¸€ä¹¦ä¸­åˆ—ä¸¾äº†ç³»ç»Ÿè°ƒç”¨ä¸­å¯¹æ— æ³•å±è”½çš„ä¸­æ–­çš„å¤„ç†æ–¹å¼ï¼Œä»¥åŠ www ä¸­å¯¹ 404-Not Found çš„å¤„ç†æ–¹å¼
å°±æ˜¯å°†ä¸€å®šçš„å¤æ‚æ€§ä»å®ç°è€…è½¬ç§»åˆ°è°ƒç”¨è€…å»çš„å¾ˆå¥½æ¡ˆä¾‹ã€‚ï¼‰&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;2-3-yi-xie-jie-kou-she-ji-de-yuan-ze&quot;&gt;2.3 ä¸€äº›æ¥å£è®¾è®¡çš„åŸåˆ™&lt;&#x2F;h2&gt;
&lt;p&gt;æœ¬èŠ‚å†…å®¹å‚è€ƒ RustforRustaceans ä¸€ä¹¦ç¬¬3ç« ï¼šDesign Interfacesï¼Œæ˜¯å¯¹æœ¬ç« å†…å®¹çš„ä¸€ä¸ªå¾ˆå¥½çš„æ³¨è„šã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Unsurprising: é™ä½è®¤çŸ¥è´Ÿè·ã€‚å·²ç»å½¢æˆçš„æƒ¯ä¾‹(idiom)ã€ä¹ æƒ¯çš„å‘½åã€åŸºç¡€ç±»å‹ï¼ˆcommon traitsï¼‰è®¾è®¡æ¨¡å¼ã€é£æ ¼ï¼Œè‡ªèº«çš„åˆç†æ€§å¾—åˆ°äº†æ—¶é—´çš„æ£€éªŒï¼Œ
ä¹Ÿå› ä¸ºæ›´å¤šçš„äººç†Ÿæ‚‰ã€æ›´ä¸°å¯Œçš„æ–‡æ¡£ã€ æ›´å¤šçš„ä½¿ç”¨æ¡ˆåˆ—è€Œå‡å°‘è®¤çŸ¥è´Ÿè·ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å·²æœ‰çš„ç®¡ç†ã€æ¨¡å¼å¹¶éä¸èƒ½æ‰“ç ´ï¼Œä½†æ‰“ç ´æ—¶ï¼Œéœ€è¦æœ‰å……åˆ†çš„ç†ç”±ï¼Œè€Œä¸æ˜¯ä¸ºäº†è¿½æ±‚æ–°å¥‡ã€‚å¦‚æœä½ ä¸äº†è§£ã€ä¸ç†è§£å·²æœ‰çš„æ¨¡å¼ï¼Œé‚£ä¹ˆæ‰€è°“çš„åˆ›æ–°ï¼Œå¾ˆå¯èƒ½æ˜¯ä½æ°´å¹³çš„
é‡å¤ï¼Œæ—¢æ²¡æœ‰æä¾›æ–°çš„ä»·å€¼ï¼Œåˆå¢åŠ äº†è®¤çŸ¥è´Ÿè·ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Flexible: è®¾è®¡ä¸€äº›é€šç”¨çš„æ¥å£ï¼Œæé«˜ä»£ç çš„å¯å¤ç”¨æ€§ã€‚åŸºäºæ¥å£ï¼Œè€Œéå…·ä½“å®ç°ï¼Œä½¿ç”¨ generic, ä½¿ç”¨æ›´å…·æŠ½è±¡çš„ç±»å‹ï¼Œè€Œéå…·ä½“åŒ–ç±»å‹ï¼Œä»è€Œå¢åŠ æ¥å£çš„çµæ´»æ€§ã€‚
å¾ˆå¤šè¯­è¨€éƒ½ä¸º Flexible æä¾›äº†æ”¯æŒï¼Œä¾‹å¦‚ï¼šRust çš„ trait, Java çš„ interface, C++ çš„ template, Scalaçš„ Context Bound ç­‰ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Obvious: é€šè¿‡æ³¨é‡Šã€æ–‡æ¡£ã€ç±»å‹ä½“ç³»ã€éƒ½å¯ä»¥æä¾›æ›´ä¸ºæ˜ç¡®çš„æ¥å£ä¿¡æ¯ï¼Œä»è€Œé™ä½è®¤çŸ¥è´Ÿè·ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Constraintedï¼šæé«˜ç¡®å®šæ€§ã€‚å¼ºç±»å‹ä½“ç³»ã€å‰ç½®æ¡ä»¶ï¼Œåç½®æ¡ä»¶ï¼Œä¸å˜é‡ã€æ–­è¨€ç­‰ï¼Œå¯¹æ¥å£è¿›è¡Œçº¦æŸï¼Œæé«˜äº†æ¥å£çš„ç¡®å®šæ€§ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;DBC(Design by Contract) å°±æ˜¯ç‰¹åˆ«é’ˆå¯¹ Constrainted çš„ä¸€ç§è®¾è®¡æ–¹æ³•ã€‚æœ‰è‰¯å¥½ DBC å®è·µçš„è®¾è®¡ä¸€èˆ¬éƒ½ä¼šæœ‰æ›´å¥½çš„è´¨é‡ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;3-chai-fen-jiang-di-shi-xian-fu-za-du&quot;&gt;3. æ‹†åˆ†ï¼šé™ä½å®ç°å¤æ‚åº¦&lt;&#x2F;h1&gt;
&lt;p&gt;æ’åºç®—æ³•æ˜¯å¾ˆæœ‰æ„æ€çš„ç®—æ³•ï¼Œä»æœ€ç®€å•çš„å†’æ³¡æ’åº O(n^2) åˆ°å¿«é€Ÿæ’åº O(n log(n))ï¼Œå…¶ä¸­çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯åˆ†æ‹†ï¼Œå°†ä¸€ä¸ªå¤§çš„é—®é¢˜åˆ†æ‹†æˆå°çš„é—®é¢˜ï¼Œç„¶åå†ç»„åˆã€‚
åœ¨è¿™é‡Œï¼Œå½“é—®é¢˜åˆ†è§£åˆ°è¶³å¤Ÿå°æ—¶ï¼Œå®ƒå°±å˜å¾—ç®€å•äº†ï¼ˆè¡ç”Ÿçš„é—®é¢˜æ˜¯ç»„åˆçš„æˆæœ¬ï¼‰ã€‚è½¯ä»¶çš„å¤æ‚æ€§æˆ–è®¸ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå…¶å¤æ‚åº¦ä¸å†…éƒ¨è§„æ¨¡çš„å¹³æ–¹æˆæ­£æ¯”ï¼Œé€šè¿‡åˆ†æ‹†åå¯ä»¥è½¬åŒ–ä¸º
å‡†çº¿æ€§çš„å¢é•¿ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ‹†åˆ†çš„æ ¸å¿ƒéƒ½æ˜¯å›´ç»•ï¼šè§£è€¦ã€å†…èšæ¥è¿›è¡Œçš„ï¼šå‡å°‘æ¨¡å—é—´çš„è€¦åˆï¼Œå¼ºåŒ–æ¨¡å—å†…çš„èšåˆã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸‰ç§å±‚æ¬¡çš„æ‹†åˆ†ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ¨¡å—æ‹†åˆ†ï¼ˆåŒ…ã€ç±»ã€æ–¹æ³•ï¼‰ï¼šæºä»£ç å±‚é¢&lt;&#x2F;li&gt;
&lt;li&gt;ç»„ä»¶åŒ–ï¼šCOM æ˜¯ç»„ä»¶åŒ–çš„ç»å…¸æ¡ˆä¾‹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;éƒ¨ç½²æ‹†åˆ†ï¼šå¾®æœåŠ¡&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;ä¸€äº›å¸¸è§çš„æ‹†åˆ†æ–¹æ³•ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æŒ‰ç…§é¢†åŸŸæ‹†åˆ†ï¼ˆæ°´å¹³æ‹†åˆ†ï¼‰ï¼šå¾®æœåŠ¡ï¼šéµç…§åº·å¨å®šå¾‹ï¼Œå°†ç»„ç»‡ç»“æ„æ˜ å°„åˆ°ç³»ç»Ÿæ¶æ„ä¸Šï¼Œå°†ä¸åŒçš„ä¸šåŠ¡åŠŸèƒ½æ‹†åˆ†æˆä¸åŒçš„æœåŠ¡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æŒ‰ç…§å±‚æ¬¡æ‹†åˆ†ï¼ˆå‚ç›´æ‹†åˆ†ï¼‰ï¼šå‰ç«¯æ¥å£å±‚ã€ä¸šåŠ¡æµç¨‹å±‚ã€ä¸šåŠ¡æ ¸å¿ƒå±‚ï¼ˆåŸå­æœåŠ¡ï¼‰ã€æ•°æ®è®¿é—®å±‚ã€æ•°æ®å­˜å‚¨å±‚ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸šåŠ¡ä¸æŠ€æœ¯æ‹†åˆ†ï¼ˆåŸºç¡€è®¾æ–½æ‹†åˆ†ï¼‰ï¼šåŸºç¡€æœåŠ¡ã€æœåŠ¡æ²»ç†ã€æ•°æ®ç›®å½•ç­‰ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;
&lt;img src=&quot;https:&amp;#x2F;&amp;#x2F;wangzaixiang.github.io&amp;#x2F;processed_images&amp;#x2F;img_1.1e1a4c476bcf1eb4.png&quot; &#x2F;&gt;
é™„ä¸€å¼ æˆ‘ä¹‹å‰å¯¹åˆ†å±‚ã€åˆ†é¢†åŸŸï¼Œæ˜“å˜å½¢ç›¸å…³çš„æ€è€ƒå›¾ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;3-1-yuan-ze-zheng-jiao-hua-chai-fen&quot;&gt;3.1 åŸåˆ™ï¼šæ­£äº¤åŒ–æ‹†åˆ†&lt;&#x2F;h2&gt;
&lt;p&gt;æ­£äº¤åŒ–ï¼šå°†åˆ†æ‹†åçš„æ¨¡å—ï¼Œåœ¨èŒè´£ä¸Šè¿›è¡Œæ­£äº¤åŒ–ï¼Œé¿å…é‡å¤çš„èŒèƒ½ã€‚æ­£äº¤åŒ–çš„æœ€ä½³æ¡ˆåˆ—ä¹‹ä¸€å°±æ˜¯ WEB çš„ä¸‰ä¸ªæ¨¡å—ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;HTMLï¼ˆDOMï¼‰ï¼šè´Ÿè´£å†…å®¹&lt;&#x2F;li&gt;
&lt;li&gt;CSSï¼šè´Ÿè´£æ ·å¼&lt;&#x2F;li&gt;
&lt;li&gt;JavaScriptï¼šè´Ÿè´£è¡Œä¸º&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;WEB ä¹‹å‰çš„ WFC&#x2F;Motif ç­‰åº”ç”¨ä¸­ï¼Œ DOM ä¸ CSS æ˜¯é«˜åº¦æ··åˆçš„ï¼Œæˆ‘å†™è¿‡é‚£ç§ä»£ç ï¼Œç›¸æ¯” WEB çš„å¼€å‘æ–¹å¼ï¼Œä»£ç é‡è¦å¤§ä¸€ä¸ªæ•°é‡çº§ï¼Œæ˜¯éå¸¸ç—›è‹¦çš„ï¼Œ
å¤§å¤§çš„é™åˆ¶äº† GUI åº”ç”¨çš„å¼€å‘æ•ˆç‡ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ­£äº¤åŒ–è®¾è®¡æ˜¯ä¸€ç§è‰ºæœ¯ï¼Œåœ¨&lt;code&gt;UNIXç¼–ç¨‹è‰ºæœ¯&lt;&#x2F;code&gt;ä¸­ï¼Œæåˆ°çš„ä¸€ä¸ªè¯æ˜¯ SPOT(Single Point of Truth)ï¼š&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç¨‹åºå‘˜ä¿®ç‚¼ä¹‹é“ï¼ˆThe Pragmatic Programmer) é’ˆå¯¹ä¸€ç±»ç‰¹åˆ«é‡è¦çš„æ­£äº¤æ€§æ˜ç¡®æå‡ºäº†ä¸€æ¡åŸåˆ™ï¼šä¸è¦é‡å¤è‡ªèº« Don&#x27;t Repeat Yourselfï¼Œæ„æ€
æ˜¯è¯´ï¼šä»»ä½•ä¸€ä¸ªçŸ¥è¯†ç‚¹åœ¨ç³»ç»Ÿå†…éƒ¨åº”å½“æœ‰ä¸€ä¸ªå”¯ä¸€ã€æ˜ç¡®ã€æƒå¨çš„è¡¨è¿°ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;æ­£äº¤åŒ–è®¾è®¡çš„å¦å¤–ä¸€äº›åœºæ™¯ï¼š å°†ä¸šåŠ¡æ€§ä»£ç  ä¸ æŠ€æœ¯æ€§ä»£ç ï¼ˆå¦‚ä»»åŠ¡è°ƒåº¦ã€ä»»åŠ¡ç¼–æ’ï¼‰ç­‰è¿›è¡Œæ­£äº¤åŒ–ã€‚ï¼ˆåœ¨æˆ‘ä»¬è¿›è¡Œæ•°æ®å¤„ç†çš„ ETL ä¸­ï¼Œ
å°±åº”ç”¨åˆ°è¿™ä¸ªæ‹†åˆ†ï¼Œä»è€Œå¤§å¤§çš„ç®€åŒ–ç³»ç»Ÿï¼‰ï¼Œä¸€èˆ¬çš„ï¼Œä¸šåŠ¡æ€§ä»£ç ä¸ä¸šåŠ¡éœ€æ±‚ä¹‹é—´æœ‰ç›´æ¥çš„æ˜ å°„å…³ç³»ï¼Œæ˜“å˜æ€§å¼ºï¼Œä½†æŠ€æœ¯éš¾åº¦å¹¶ä¸å¤§ï¼Œè€ŒæŠ€æœ¯æ€§ä»£ç åˆ™å…·æœ‰
æ›´å¥½çš„é€šç”¨æ€§ï¼Œå¯ä»¥åº”ç”¨äºä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œä½†å…¶æŠ€æœ¯æŒ‘æˆ˜æ€§é«˜ã€‚å°†è¿™äºŒè€…è¿›è¡Œåˆ†æ‹†ï¼Œæ•´ä¸ªç³»ç»Ÿçš„å¤æ‚æ€§å°±å¤§ä¸ºé™ä½ã€‚&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯¹å¤æ‚çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬åº”è¯¥å¯¹ä¸šåŠ¡è¿›è¡ŒæŠ½è±¡ï¼Œå°†éä¸šåŠ¡æ€§çš„åŠŸèƒ½ä»ä¸šåŠ¡ä¸­åˆ†ç¦»å‡ºæ¥ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;h2 id=&quot;3-2-chai-fen-ye-wu-xing-gong-neng-yu-ji-shu-xing-gong-neng&quot;&gt;3.2 æ‹†åˆ†ï¼šä¸šåŠ¡æ€§åŠŸèƒ½ä¸æŠ€æœ¯æ€§åŠŸèƒ½&lt;&#x2F;h2&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„æŸä¸ªå¼€å‘é¡¹ç›®ä¸­ï¼Œæ¶‰åŠåˆ°ä¸€ä¸ª æ•°æ®ETL çš„ä»»åŠ¡ï¼Œè¿™é‡Œæ¶‰åŠåˆ°æ•°æ®çš„åŠ å·¥å¤„ç†ï¼Œä¹Ÿæ¶‰åŠåˆ°å¤šä¸ªä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»å¤„ç†ï¼Œå†ç‰µæ¶‰åˆ°ä¸€äº›åæŠ€æœ¯æ€§çš„éœ€æ±‚ï¼Œ
è¯¸å¦‚å¹¶å‘ï¼ˆå…³æ³¨TPSã€RTTæŒ‡æ ‡ï¼‰ã€ç›‘æ§ã€é™æµã€ä»»åŠ¡å–æ¶ˆï¼ˆå–æ¶ˆä»»åŠ¡æ—¶é‡Šæ”¾èµ„æºï¼‰ç­‰ï¼Œä¸€å¼€å§‹æ•´ä¸ªä»»åŠ¡å®ç°å¾—éå¸¸å¤æ‚ï¼Œè€Œä¸”ï¼Œåœ¨æŠ€æœ¯æ€§éœ€æ±‚çš„å¤„ç†ä¸Šå¾ˆéš¾è¾¾åˆ°é¢„æœŸã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¯¹è¿™ä¸ªä»»åŠ¡è€Œè¨€ï¼Œæœ¬èº«æœ‰ä¸¤æ–¹é¢çš„å¤æ‚æ€§ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸šåŠ¡å¤æ‚æ€§ï¼šå¦‚ä½•æ­£ç¡®çš„å¤„ç† ETL è‡ªèº«ã€‚è¿™ä¸ªæ˜¯è¿™ä¸ªä»»åŠ¡çš„é‡ç‚¹ï¼Œæœ‰å…¶è‡ªæœ‰çš„å¤æ‚æ€§ï¼ˆæœ¬è´¨å¤æ‚åº¦ï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æŠ€æœ¯å¤æ‚æ€§ï¼šè°ƒåº¦ã€ç¼–æ’ã€å¹¶å‘ã€åˆ†å¸ƒå¼é”ã€ç›‘æ§ã€é™æµã€ä»»åŠ¡å–æ¶ˆã€‚å•å•ä»»åŠ¡å–æ¶ˆè¿™ä¸€é¡¹ï¼Œå°±æœ‰å¾ˆå¤§çš„æŠ€æœ¯æŒ‘æˆ˜ï¼šå› ä¸ºæˆ‘ä»¬çš„äº§å“éœ€è¦é€‚é… 30+ çš„æ•°æ®åº“ï¼Œ
åœ¨å–æ¶ˆä»»åŠ¡æ—¶ï¼Œæ˜¯å¦å¯ä»¥ç»ˆæ­¢ SQL çš„æ‰§è¡Œï¼Œä»è€Œé¿å…è¿™äº›é‡çš„ SQL æ“ä½œç»§ç»­æ‰§è¡Œã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;å°†è¿™ä¸¤ä¸ªå¤æ‚åº¦æ‰åœ¨ä¸€èµ·ï¼Œæœ€åä¼šå¯¼è‡´æ˜¾è‘—çš„å¤æ‚æ€§æå‡ï¼Œä»¥è‡³äºç¬¬ä¸€ç‰ˆæ˜¯ä¸€ä¸ªç³Ÿç³•çš„å®ç°ï¼šæ—¢å¤æ‚ï¼Œåˆéš¾ä»¥è¾¾æˆéœ€æ±‚ç›®æ ‡ï¼Œé€šè¿‡å°†ä¸šåŠ¡ã€æŠ€æœ¯æ€§éœ€æ±‚åˆ†ç¦»åï¼Œä¸¤éƒ¨ä»½
åŠŸèƒ½éƒ½å›å½’åˆ°å„è‡ªçš„æœ¬è´¨å¤æ‚åº¦é¢†åŸŸï¼Œé€‰æ‹©åˆé€‚çš„è§£å†³æ–¹æ¡ˆï¼Œæœ€ç»ˆå¾—ä»¥ç®€åŒ–ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;3-3-dsl-shi-yong-dsl-jiang-di-fu-za-xing&quot;&gt;3.3 DSL: ä½¿ç”¨ DSL é™ä½å¤æ‚æ€§&lt;&#x2F;h2&gt;
&lt;p&gt;å¯¹å¤æ‚çš„ç³»ç»Ÿï¼Œè¦å–„äºå®šä¹‰ DSLï¼Œå»ºç«‹ Domain Specific Languageï¼Œä½¿ç”¨æè¿°å¼çš„è¯­è¨€ï¼Œæ¥å®šä¹‰ what è€Œé howã€‚å®é™…ä¸Šï¼ŒDSL è¯­è¨€æœ¬èº«
å°±æ„å‘³ç€æˆ‘ä»¬å®Œæˆäº†å¯¹å¤æ‚ç³»ç»Ÿçš„æŠ½è±¡ï¼Œå°†å¤æ‚çš„è¡Œä¸ºè½¬æ¢æˆäº†æ›´é«˜é˜¶æŠ½è±¡çš„æè¿°ï¼Œä»è€ŒæŠ“ä½äº†å¤æ‚ä¹‹ä¸­çš„æœ¬è´¨ã€‚å¤§éƒ¨ä»½çš„ DSL è¯­è¨€éƒ½æ˜¯å¯¹æŸä¸ªç‰¹å®šå¤æ‚
é¢†åŸŸçš„æœ‰æ•ˆæŠ½è±¡ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;SQLï¼šå¯¹å…³ç³»å‹æ•°æ®åº“çš„æ“ä½œæŠ½è±¡&lt;&#x2F;li&gt;
&lt;li&gt;å·¥ä½œæµï¼šå¯¹ä»»åŠ¡ç¼–æ’çš„æŠ½è±¡&lt;&#x2F;li&gt;
&lt;li&gt;React&#x2F;Vue: é€šè¿‡ç±» JSX æˆ– template çš„æ–¹å¼ï¼Œå¯¹ UI è¿›è¡ŒæŠ½è±¡ï¼ˆæ³¨æ„è¿™é‡Œçš„æè¿°æ€§ï¼Œè€Œéæ“ä½œæ€§ï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Makefile&#x2F;Maven&#x2F;SBT&#x2F;Cargo: å¯¹é¡¹ç›®æ„å»ºçš„æŠ½è±¡&lt;&#x2F;li&gt;
&lt;li&gt;IDL: å¯¹æ¥å£å®šä¹‰çš„æŠ½è±¡&lt;&#x2F;li&gt;
&lt;li&gt;Regular Expression: å¯¹å­—ç¬¦ä¸²åŒ¹é…çš„æŠ½è±¡&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;å¦‚æœèƒ½å¤Ÿå®šä¹‰å‡º DSLï¼Œå¹¶ç”¨äºæè¿°ç³»ç»Ÿçš„é€»è¾‘è¡Œä¸ºæ—¶ï¼Œç³»ç»Ÿçš„å¤æ‚æ€§ä¼šå¤§ä¸ºé™ä½ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;3-4-yi-bian-xing-volatility-chai-fen&quot;&gt;3.4 æ˜“å˜æ€§(Volatility)æ‹†åˆ†&lt;&#x2F;h2&gt;
&lt;p&gt;æ¯ä¸ªå¤æ‚çš„ç³»ç»Ÿï¼Œéƒ½æœ‰ä¸€äº›éƒ¨ä»¶æ˜¯æ˜“å˜çš„ï¼šä¼šéšç€æ—¶é—´ã€ç©ºé—´çš„å˜åŒ–è€Œæ¼”å˜ï¼Œå…¶è‡ªèº«å…·æœ‰ä¸ç¨³å®šæ€§ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ˜“å˜æ€§çš„éƒ¨ä»¶ï¼Œæ˜¯å¯¼è‡´ç³»ç»Ÿå¤æ‚æ€§æå‡çš„é‡è¦åŸå› ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹ SAAS ç±»åº”ç”¨ï¼Œä¸ºä¸åŒçš„å®¢æˆ·æä¾›ä¸åŒçš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œé›¶å”®ç³»ç»Ÿé’ˆå¯¹ä¸åŒçš„ä¸šæ€æä¾›ä¸åŒçš„æœåŠ¡æ¨¡å¼ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹ ç”µå•†ç±»åº”ç”¨ï¼Œéšç€ä¸šåŠ¡æ¨¡å¼çš„æ”¹å˜ï¼Œä¼šæœ‰ä¸åŒçš„å®¢æˆ·æœåŠ¡ç­–ç•¥ã€è¥é”€ç­–ç•¥ã€ä¼šå‘˜ç­–ç•¥ç­‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹ OLAP ç±»åº”ç”¨ï¼Œéœ€è¦æ¥å…¥ä¸åŒçš„æ•°æ®æºï¼Œé¢å¯¹ä¸åŒæ•°æ®æºä¹‹é—´å¯¹ SQL æ”¯æŒçš„å·®å¼‚ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹ Dashboard ç±»åº”ç”¨ï¼Œéœ€è¦é¢å¯¹ä¸åŒçš„æ•°æ®å±•ç¤ºéœ€æ±‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;å¯¹è¿™ç±»ç³»ç»Ÿï¼Œæˆ‘ä»¬å°±éœ€è¦é‡ç‚¹å…³æ³¨å¦‚ä½•æŠ½è±¡è¿™ä¸€ç±»æ˜“å˜æ€§çš„éƒ¨ä»¶ï¼Œå°†å…¶ä¸ç¨³å®šæ€§çš„éƒ¨ä»¶è¿›è¡Œåˆ†æ‹†ï¼Œä»è€Œå®ç°ç³»ç»Ÿçš„ç®€åŒ–ï¼Œå¦åˆ™å°±ä¼šé™·å…¥â€œCopy + Modifyâ€ çš„
æ¨¡å¼ï¼Œæœ€ç»ˆå½¢æˆå¤šä¸ªå®Œå…¨ä¸åŒçš„ç³»ç»Ÿï¼Œç»´æŠ¤æˆæœ¬ä¼šå¤§å¤§å¢åŠ ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨ &lt;a href=&quot;https:&#x2F;&#x2F;rightingsoftware.org&quot;&gt;Right Software&lt;&#x2F;a&gt; ä¸€ä¹¦ä¸­ï¼Œæåˆ°äº†é¿å…åŠŸèƒ½æ€§çš„åˆ†è§£ï¼Œè€Œæ˜¯åŸºäºæ˜“å˜æ€§çš„åˆ†è§£ã€‚
&lt;a href=&quot;https:&#x2F;&#x2F;seccl.tech&#x2F;guides&#x2F;designing-for-change&#x2F;&quot;&gt;Design for change&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;åŠ¨é™åˆ†ç¦»ï¼Œä»¥é™ä¸ºå¹²ï¼Œä»¥åŠ¨ä¸ºæ”¯ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;åŠ¨æ€æµç¨‹ï¼šåŸºäºåŸå­æ€§çš„æ“ä½œï¼Œå°†æµç¨‹çš„åŠ¨æ€éƒ¨ä»½æå–å‡ºæ¥ï¼Œé…åˆè„šæœ¬å¼•æ“ï¼ˆScriptï¼‰çš„æ–¹å¼æ¥å®ç°åŠ¨æ€æµç¨‹ã€‚script å¯èƒ½æ˜¯ effect æˆ–è€… pureçš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åŠ¨æ€è§„åˆ™ï¼šå¼•å…¥ç±»ä¼¼äºè§„åˆ™å¼•æ“çš„æœºåˆ¶ï¼Œæ¥è§£å†³è§„åˆ™çš„åŠ¨æ€è¡Œã€‚ä¸€ä¸ªè§„åˆ™å¯ä»¥ç®€å•æŠ½è±¡ä¸ºä¸€ä¸ª f:  input -&amp;gt; boolean (pure)&lt;&#x2F;li&gt;
&lt;li&gt;åŠ¨æ€ç­–ç•¥ï¼šç±»ä¼¼äºåŠ¨æ€è§„åˆ™ï¼Œ f: input -&amp;gt; output (pure)&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å¼•å…¥åŠ¨æ€ä»¥åï¼Œæ•´ä¸ªç³»ç»Ÿçš„å¤æ‚æ€§ä¼šæå‡ï¼Œè´¨é‡çš„ç®¡æ§å˜å¾—æ›´ä¸ºé‡è¦ï¼Œå› åº”çš„æªæ–½åŒ…æ‹¬ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;åŠ¨æ€æ²»ç†ï¼šåŒ…æ‹¬ç›‘æ§ã€ç†”æ–­é™æµã€æŠ¥è¡¨ç­‰&lt;&#x2F;li&gt;
&lt;li&gt;åŠ å¼ºå¥‘çº¦åŒ–ï¼Œå°¤å…¶æ˜¯ invariants çš„ç®¡ç†ï¼Œé˜²æ­¢æ ¸å¿ƒæ•°æ®å‡ºç°è„æ•°æ®ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;ä»å¤æ‚æ€§ä¸­è¯†åˆ«å‡ºå“ªäº›æ˜¯ç¨³å®šçš„ã€é™æ€çš„å†…å®¹ã€‚è€å­æ›°ï¼šé‡ä¸ºè½»æ ¹ï¼Œé™ä¸ºèºå›ã€‚åœ¨å¤æ‚çš„ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†é‚£äº›ç¨³å®šçš„ã€é™æ€çš„å†…å®¹æå–å‡ºæ¥ï¼Œå½¢æˆä¸€ä¸ªç¨³å®š
çš„ä¸»å¹²ã€‚è¿™ä¸€æ¡å…¶å®ä¸ä¸Šä¸€æ¡ï¼šæ˜“å˜æ€§æ‹†åˆ†æ˜¯ç›¸è¾…ç›¸æˆçš„ã€‚æ˜“å˜æ€§æ‹†åˆ†æ˜¯å°†æ˜“å˜çš„éƒ¨ä»¶æå–å‡ºæ¥ï¼Œè€ŒåŠ¨é™åˆ†ç¦»åˆ™æ˜¯å°†ç¨³å®šçš„éƒ¨ä»¶æå–å‡ºæ¥ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;3-5-ying-yong-solid-yuan-ze-jin-xing-chai-fen&quot;&gt;3.5ï¼šåº”ç”¨ SOLID åŸåˆ™è¿›è¡Œæ‹†åˆ†&lt;&#x2F;h2&gt;
&lt;p&gt;SOLID åŸåˆ™æ˜¯å¯¹è½¯ä»¶è®¾è®¡çš„äº”ä¸ªåŸºæœ¬åŸåˆ™çš„æ€»ç§°ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;S: å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principleï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;O: å¼€é—­åŸåˆ™ï¼ˆOpen-Closed Principleï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;L: é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;I: æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;D: ä¾èµ–åè½¬åŸåˆ™ï¼ˆDependency Inversion Principleï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;SOLID å¯ä»¥ä½œä¸ºæ¨¡å—æ‹†åˆ†çš„ä¸€ä¸ªå‚è€ƒã€‚&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯¹é™ä½å¤æ‚åº¦çš„æªæ–½ï¼Œåç»­æŒç»­æ›´æ–°ä¸­ ...&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;h1 id=&quot;4-visibility-makes-software-simplicity&quot;&gt;4. visibility makes software simplicity&lt;&#x2F;h1&gt;
&lt;p&gt;è¿™ä¸ªè¯é¢˜ï¼Œæˆ‘ä¼šå•ç‹¬å¼€ä¸€ä¸ª blog æ¥è®²è¿°ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;5-ying-yong-functional-programming-jiang-di-bian-cheng-fu-za-du&quot;&gt;5. åº”ç”¨ Functional Programming é™ä½ç¼–ç¨‹å¤æ‚åº¦&lt;&#x2F;h1&gt;
&lt;p&gt;æ²»ç†è½¯ä»¶å¤æ‚æ€§çš„ä¸€ä¸ªè¯¯åŒºå°±æ˜¯é«˜è°ˆè®¾è®¡ï¼Œè€Œå¿½è§†ç¼–ç ã€‚ä¸€ä¸ªå¹¿æ³›çš„è®¤çŸ¥æ˜¯ï¼šè½¯ä»¶çš„å¤æ‚æ€§ä¸»è¦æ˜¯æ¶æ„å¸ˆã€æ¶æ„è®¾è®¡çš„é—®é¢˜ï¼Œåªè¦è®¾è®¡æ¸…æ™°ã€æ¶æ„åˆç†ï¼Œå°±ä¸ä¼šæœ‰å¤§
çš„é—®é¢˜äº†ã€‚è¿™ä¹Ÿåˆ›é€ äº†è¯¸å¤š PPT æ–‡åŒ–ï¼šæ¶æ„å›¾ä¸Šå †ç Œç€é«˜å¤§ä¸Šã€æ—¶é«¦ã€æ–°æ½®çš„æŠ€æœ¯åè¯ï¼Œå†åŠ ä¸Šä¸°å¯Œå¤šå½©çš„å›¾æ ‡è®¾è®¡ï¼Œä½†å´å¯èƒ½æ˜¯ç»£èŠ±æ•å¤´ï¼Œè´¥çµ®å…¶ä¸­ã€‚åœ¨è¿™æ–¹é¢ï¼Œ
ä¼ ç»Ÿçš„åŸºå»ºé¢†åŸŸï¼Œåº”è¯¥ä¼šæœ´å®å¾ˆå¤šï¼šåä¸½çš„æ¶æ„å’Œè‰ºæœ¯æ€§çš„è®¾è®¡ï¼Œåœ¨åŸºå»ºé¢†åŸŸæ— ç–‘å°±æ˜¯ä¸€ç§ä»·å€¼ï¼ˆè¿™ä¸€ç‚¹ç”šäºè½¯ä»¶ï¼Œè½¯ä»¶é¢†åŸŸç¬¬ä¸€ä»·å€¼è¿˜æ˜¯åŠŸèƒ½éœ€æ±‚ï¼‰ï¼Œä½†å¥½çš„åŸºå»ºï¼Œ
ææ–™ã€å·¥è‰ºã€æ–½å·¥ã€è´¨é‡æ§åˆ¶ç­‰éƒ½æ˜¯åŸºç¡€ï¼Œéƒ½æ˜¯æœ‰ä¸¥æ ¼çš„æ ‡å‡†çš„ã€‚ç›¸åï¼Œåœ¨è½¯ä»¶é¢†åŸŸï¼Œå¯¹ç¼–ç çš„è¦æ±‚å’Œæ ‡å‡†å°±å¾ˆç›¸å·®å¤ªå¤§äº†ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;5-1-han-shu-shi-bian-cheng-ju-you-geng-gao-de-gong-neng-mi-du&quot;&gt;5.1 å‡½æ•°å¼ç¼–ç¨‹å…·æœ‰æ›´é«˜çš„åŠŸèƒ½å¯†åº¦ã€‚&lt;&#x2F;h2&gt;
&lt;p&gt;ä½¿ç”¨ä»£ç çš„è¡Œæ•°æ¥è¯„ä¼°ä»£ç å¤æ‚åº¦ï¼Œè™½ç„¶æ˜¯ä¸€ä¸ªç®€å•çš„çº¬åº¦ï¼Œä½†ä»ç„¶å…·æœ‰ä¸€å®šçš„å‚è€ƒä»·å€¼ã€‚å‡½æ•°å¼è¯­è¨€ï¼Œå…·æœ‰æ›´å¥½çš„æŠ½è±¡èƒ½åŠ›ã€æ›´å¼ºçš„å‡½æ•°ç»„åˆèƒ½åŠ›ï¼ˆå¦‚é«˜é˜¶å‡½æ•°ï¼‰&lt;&#x2F;p&gt;
&lt;h1 id=&quot;6-ying-yong-unit-test-ci-cd-jiang-di-xi-tong-bu-shu-fu-za-du&quot;&gt;6. åº”ç”¨ Unit Test&#x2F; CI&#x2F;CD é™ä½ç³»ç»Ÿéƒ¨ç½²å¤æ‚åº¦&lt;&#x2F;h1&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>LLVM å­¦ä¹ ç³»åˆ—ä¸€ï¼šåˆè¯» LLVM-IR ç¤ºä¾‹ä»£ç </title>
        <published>2024-10-06T00:00:00+00:00</published>
        <updated>2024-10-06T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/learning-llvm/"/>
        <id>https://wangzaixiang.github.io/blog/learning-llvm/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/learning-llvm/">&lt;h1 id=&quot;why-learn-llvm&quot;&gt;Why learn LLVM?&lt;&#x2F;h1&gt;
&lt;p&gt;åœ¨é˜…è¯» duckdb çš„æºä»£ç ï¼Œå¯¹ duckdb æ‰§è¡Œå‘é‡è®¡ç®—çš„æ–¹å¼æœ‰åˆæ­¥çš„äº†è§£ä¹‹åï¼Œæ€è€ƒå¦‚ä½•åœ¨ OLAP å¼•æ“ä¸­é«˜æ•ˆçš„è¿›è¡Œå‘é‡è®¡ç®—ï¼Œæ„Ÿè§‰å¼•å…¥ JIT ä¼šæ˜¯ä¸€ä¸ªæ›´ä½³
çš„é€‰æ‹©ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å°è¯•é˜…è¯» x86 çš„ SIMD æ±‡ç¼–ä»£ç ï¼Œæ„Ÿè§‰æ˜¯éå¸¸å›°éš¾çš„ï¼ŒSIMD çš„æ±‡ç¼–æŒ‡ä»¤éå¸¸å¤æ‚ï¼Œå¯è¯»æ€§å¾ˆå·®ï¼Œè€Œå¯¹åº”ç¼–è¯‘ç”Ÿæˆçš„ LLVM-IR åˆ™å¯è¯»æ€§ã€å¯ç†è§£æ€§é«˜äº†å¾ˆå¤šï¼Œ
åŸºæœ¬ä¸Šï¼Œå¯¹ç…§ LLVM-IR æ–‡æ¡£ï¼Œä¸€éä¸‹æ¥å°±å¯ä»¥ç†è§£å…¶å«ä¹‰ã€‚å†è€ƒè™‘åˆ°è·¨ CPU ä½“ç³»çš„å…¼å®¹æ”¯æŒï¼ŒLLVM-IR æ— ç–‘æ˜¯ä¸€ä¸ªæ›´é«˜levelçš„ï¼Œæ›´å®¹æ˜“ç†è§£çš„ï¼ŒåŒæ—¶ä¹Ÿæœ‰
æ›´å¥½çš„å¯ç§»æ¤æ€§çš„ä¸­é—´è¡¨ç¤ºã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;steps-to-learn-llvm&quot;&gt;Steps to learn LLVM&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åˆè¯» LLVM-IR ç¤ºä¾‹ä»£ç &lt;&#x2F;p&gt;
&lt;p&gt;è‡ªå·±åŠ¨æ‰‹ç¼–å†™ä¸€æ®µ Rust ä»£ç ï¼Œç„¶åç¼–è¯‘ç”Ÿæˆ LLVM-IRï¼Œå†å¯¹ç…§ LLVM-IR æ–‡æ¡£ï¼Œé€ä¸€é˜…è¯» IR ä»£ç ï¼Œç›¸æ¯”ç›´æ¥é˜…è¯» IR æ–‡æ¡£æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åœºæ™¯åŒ–
å­¦ä¹ æ–¹å¼ï¼Œå¯¹ IR æœ‰äº†ä¸€äº›åˆæ­¥çš„äº†è§£åï¼Œåç»­å†ç³»ç»Ÿçš„å­¦ä¹  LLVM-IR çš„çŸ¥è¯†ï¼Œå°±æ˜¾å¾—æ²¡é‚£ä¹ˆæ¯ç‡¥äº†ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Rust æºä»£ç &lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;v1&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;], &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;v2&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span&gt;], &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;result&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;bool&lt;&#x2F;span&gt;&lt;span&gt;]) {
&lt;&#x2F;span&gt;&lt;span&gt;    assert!(v1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() == v2.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() &amp;amp;&amp;amp; v1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() == result.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;());
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for&lt;&#x2F;span&gt;&lt;span&gt; i in &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;..v1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; v1[i] &amp;gt; v2[i] {
&lt;&#x2F;span&gt;&lt;span&gt;            result[i] = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true
&lt;&#x2F;span&gt;&lt;span&gt;        } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            result[i] = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;false
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;LLVM-IR ä»£ç &lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;; l_asm::demo1::select
&lt;&#x2F;span&gt;&lt;span&gt;; Function Attrs: noinline uwtable
&lt;&#x2F;span&gt;&lt;span&gt;define internal fastcc void @_ZN5l_asm5demo16select17h43db37ec056aed21E(
&lt;&#x2F;span&gt;&lt;span&gt;    ptr noalias nocapture noundef nonnull readonly align 4 %v1.0, i64 noundef %v1.1,
&lt;&#x2F;span&gt;&lt;span&gt;    ptr noalias nocapture noundef nonnull readonly align 4 %v2.0, i64 noundef %v2.1,
&lt;&#x2F;span&gt;&lt;span&gt;    ptr noalias nocapture noundef nonnull writeonly align 1 %result.0, i64 noundef %result.1) unnamed_addr #0 {
&lt;&#x2F;span&gt;&lt;span&gt;start:
&lt;&#x2F;span&gt;&lt;span&gt;  %_4 = icmp eq i64 %v1.1, %v2.1
&lt;&#x2F;span&gt;&lt;span&gt;  %_7 = icmp eq i64 %v1.1, %result.1
&lt;&#x2F;span&gt;&lt;span&gt;  %or.cond = and i1 %_4, %_7  -- i1: bit
&lt;&#x2F;span&gt;&lt;span&gt;  br i1 %or.cond, label %bb5.preheader.split, label %bb4  -- br type iftrue ifalse
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;bb5.preheader.split:                              ; preds = %start
&lt;&#x2F;span&gt;&lt;span&gt;  %_218.not = icmp eq i64 %v1.1, 0
&lt;&#x2F;span&gt;&lt;span&gt;  br i1 %_218.not, label %bb15, label %bb13.preheader
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;bb13.preheader:                                   ; preds = %bb5.preheader.split
&lt;&#x2F;span&gt;&lt;span&gt;  %min.iters.check = icmp ult i64 %v1.1, 32       -- unsigned less than
&lt;&#x2F;span&gt;&lt;span&gt;  br i1 %min.iters.check, label %bb13.preheader17, label %vector.ph
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;vector.ph:                                        ; preds = %bb13.preheader
&lt;&#x2F;span&gt;&lt;span&gt;  %n.vec = and i64 %v1.1, -32
&lt;&#x2F;span&gt;&lt;span&gt;  br label %vector.body
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;vector.body:                                      ; preds = %vector.body, %vector.ph
&lt;&#x2F;span&gt;&lt;span&gt;  %index = phi i64 [ 0, %vector.ph ], [ %index.next, %vector.body ]  -- TODO? what is phi
&lt;&#x2F;span&gt;&lt;span&gt;  %0 = getelementptr inbounds [0 x i32], ptr %v1.0, i64 0, i64 %index  -- %0 = %v1.0
&lt;&#x2F;span&gt;&lt;span&gt;  %1 = getelementptr inbounds i32, ptr %0, i64 8                       -- %1 = %0 + 32byte
&lt;&#x2F;span&gt;&lt;span&gt;  %2 = getelementptr inbounds i32, ptr %0, i64 16
&lt;&#x2F;span&gt;&lt;span&gt;  %3 = getelementptr inbounds i32, ptr %0, i64 24
&lt;&#x2F;span&gt;&lt;span&gt;  %wide.load = load &amp;lt;8 x i32&amp;gt;, ptr %0, align 4                          -- 8x32 from v1
&lt;&#x2F;span&gt;&lt;span&gt;  %wide.load10 = load &amp;lt;8 x i32&amp;gt;, ptr %1, align 4
&lt;&#x2F;span&gt;&lt;span&gt;  %wide.load11 = load &amp;lt;8 x i32&amp;gt;, ptr %2, align 4
&lt;&#x2F;span&gt;&lt;span&gt;  %wide.load12 = load &amp;lt;8 x i32&amp;gt;, ptr %3, align 4
&lt;&#x2F;span&gt;&lt;span&gt;  
&lt;&#x2F;span&gt;&lt;span&gt;  %4 = getelementptr inbounds [0 x i32], ptr %v2.0, i64 0, i64 %index
&lt;&#x2F;span&gt;&lt;span&gt;  %5 = getelementptr inbounds i32, ptr %4, i64 8
&lt;&#x2F;span&gt;&lt;span&gt;  %6 = getelementptr inbounds i32, ptr %4, i64 16
&lt;&#x2F;span&gt;&lt;span&gt;  %7 = getelementptr inbounds i32, ptr %4, i64 24
&lt;&#x2F;span&gt;&lt;span&gt;  %wide.load13 = load &amp;lt;8 x i32&amp;gt;, ptr %4, align 4                        -- 8x32 from v1
&lt;&#x2F;span&gt;&lt;span&gt;  %wide.load14 = load &amp;lt;8 x i32&amp;gt;, ptr %5, align 4
&lt;&#x2F;span&gt;&lt;span&gt;  %wide.load15 = load &amp;lt;8 x i32&amp;gt;, ptr %6, align 4
&lt;&#x2F;span&gt;&lt;span&gt;  %wide.load16 = load &amp;lt;8 x i32&amp;gt;, ptr %7, align 4
&lt;&#x2F;span&gt;&lt;span&gt;  
&lt;&#x2F;span&gt;&lt;span&gt;  %8 = icmp sgt &amp;lt;8 x i32&amp;gt; %wide.load, %wide.load13                   -- signed greater than
&lt;&#x2F;span&gt;&lt;span&gt;  %9 = icmp sgt &amp;lt;8 x i32&amp;gt; %wide.load10, %wide.load14
&lt;&#x2F;span&gt;&lt;span&gt;  %10 = icmp sgt &amp;lt;8 x i32&amp;gt; %wide.load11, %wide.load15
&lt;&#x2F;span&gt;&lt;span&gt;  %11 = icmp sgt &amp;lt;8 x i32&amp;gt; %wide.load12, %wide.load16
&lt;&#x2F;span&gt;&lt;span&gt;  
&lt;&#x2F;span&gt;&lt;span&gt;  %12 = zext &amp;lt;8 x i1&amp;gt; %8 to &amp;lt;8 x i8&amp;gt;                                 -- zero extend 8x1 to 8x8
&lt;&#x2F;span&gt;&lt;span&gt;  %13 = zext &amp;lt;8 x i1&amp;gt; %9 to &amp;lt;8 x i8&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;  %14 = zext &amp;lt;8 x i1&amp;gt; %10 to &amp;lt;8 x i8&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;  %15 = zext &amp;lt;8 x i1&amp;gt; %11 to &amp;lt;8 x i8&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;  
&lt;&#x2F;span&gt;&lt;span&gt;  %16 = getelementptr inbounds [0 x i8], ptr %result.0, i64 0, i64 %index
&lt;&#x2F;span&gt;&lt;span&gt;  %17 = getelementptr inbounds i8, ptr %16, i64 8
&lt;&#x2F;span&gt;&lt;span&gt;  %18 = getelementptr inbounds i8, ptr %16, i64 16
&lt;&#x2F;span&gt;&lt;span&gt;  %19 = getelementptr inbounds i8, ptr %16, i64 24
&lt;&#x2F;span&gt;&lt;span&gt;  
&lt;&#x2F;span&gt;&lt;span&gt;  store &amp;lt;8 x i8&amp;gt; %12, ptr %16, align 1                               -- store 8x8 to result
&lt;&#x2F;span&gt;&lt;span&gt;  store &amp;lt;8 x i8&amp;gt; %13, ptr %17, align 1
&lt;&#x2F;span&gt;&lt;span&gt;  store &amp;lt;8 x i8&amp;gt; %14, ptr %18, align 1
&lt;&#x2F;span&gt;&lt;span&gt;  store &amp;lt;8 x i8&amp;gt; %15, ptr %19, align 1
&lt;&#x2F;span&gt;&lt;span&gt;  
&lt;&#x2F;span&gt;&lt;span&gt;  %index.next = add nuw i64 %index, 32
&lt;&#x2F;span&gt;&lt;span&gt;  %20 = icmp eq i64 %index.next, %n.vec
&lt;&#x2F;span&gt;&lt;span&gt;  br i1 %20, label %middle.block, label %vector.body, !llvm.loop !17  -- TODO what&amp;#39;s !llvm.loop !17
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;middle.block:                                     ; preds = %vector.body
&lt;&#x2F;span&gt;&lt;span&gt;  %cmp.n = icmp eq i64 %n.vec, %v1.1
&lt;&#x2F;span&gt;&lt;span&gt;  br i1 %cmp.n, label %bb15, label %bb13.preheader17
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;bb13.preheader17:                                 ; preds = %bb13.preheader, %middle.block
&lt;&#x2F;span&gt;&lt;span&gt;  %iter.sroa.0.09.ph = phi i64 [ 0, %bb13.preheader ], [ %n.vec, %middle.block ]
&lt;&#x2F;span&gt;&lt;span&gt;  br label %bb13
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;bb4:                                              ; preds = %start
&lt;&#x2F;span&gt;&lt;span&gt;; call core::panicking::panic
&lt;&#x2F;span&gt;&lt;span&gt;  tail call void @_ZN4core9panicking5panic17h2a3e12572053020cE(ptr noalias noundef nonnull readonly align 1 @alloc_882a6b32f40210455571ae125dfbea95, i64 noundef 66, ptr noalias noundef nonnull readonly align 8 dereferenceable(24) @alloc_649ca88820fbe63b563e38f24e967ee7) #12
&lt;&#x2F;span&gt;&lt;span&gt;  unreachable
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;bb15:                                             ; preds = %bb13, %middle.block, %bb5.preheader.split
&lt;&#x2F;span&gt;&lt;span&gt;  ret void
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;bb13:                                             ; preds = %bb13.preheader17, %bb13
&lt;&#x2F;span&gt;&lt;span&gt;  %iter.sroa.0.09 = phi i64 [ %_0.i, %bb13 ], [ %iter.sroa.0.09.ph, %bb13.preheader17 ]
&lt;&#x2F;span&gt;&lt;span&gt;  %_0.i = add nuw i64 %iter.sroa.0.09, 1
&lt;&#x2F;span&gt;&lt;span&gt;  %21 = getelementptr inbounds [0 x i32], ptr %v1.0, i64 0, i64 %iter.sroa.0.09
&lt;&#x2F;span&gt;&lt;span&gt;  %_13 = load i32, ptr %21, align 4, !noundef !4
&lt;&#x2F;span&gt;&lt;span&gt;  %22 = getelementptr inbounds [0 x i32], ptr %v2.0, i64 0, i64 %iter.sroa.0.09
&lt;&#x2F;span&gt;&lt;span&gt;  %_15 = load i32, ptr %22, align 4, !noundef !4
&lt;&#x2F;span&gt;&lt;span&gt;  %_12 = icmp sgt i32 %_13, %_15
&lt;&#x2F;span&gt;&lt;span&gt;  %spec.select = zext i1 %_12 to i8
&lt;&#x2F;span&gt;&lt;span&gt;  %23 = getelementptr inbounds [0 x i8], ptr %result.0, i64 0, i64 %iter.sroa.0.09
&lt;&#x2F;span&gt;&lt;span&gt;  store i8 %spec.select, ptr %23, align 1
&lt;&#x2F;span&gt;&lt;span&gt;  %exitcond.not = icmp eq i64 %_0.i, %v1.1
&lt;&#x2F;span&gt;&lt;span&gt;  br i1 %exitcond.not, label %bb15, label %bb13, !llvm.loop !20
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ç”Ÿæˆ LLVM-IR ï¼ˆè¿™é‡Œçš„ ll ä»£ç æ˜¯ä» LLVM å®˜æ–¹çš„ Kaleidoscope Chapter 3 ç”Ÿæˆçš„ï¼Œæ˜¯ä¸€ä¸ªå¾ˆç®€å•ç‰ˆçš„ ll æºæ–‡ä»¶äº†ï¼‰&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt; ; file a1.ll
&lt;&#x2F;span&gt;&lt;span&gt; ; ModuleID = &amp;#39;my cool jit&amp;#39;
&lt;&#x2F;span&gt;&lt;span&gt; source_filename = &amp;quot;my cool jit&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt; define double @foo(double %a, double %b) {
&lt;&#x2F;span&gt;&lt;span&gt;     entry:
&lt;&#x2F;span&gt;&lt;span&gt;     %multmp = fmul double %a, %a
&lt;&#x2F;span&gt;&lt;span&gt;     %multmp1 = fmul double 2.000000e+00, %a
&lt;&#x2F;span&gt;&lt;span&gt;     %multmp2 = fmul double %multmp1, %b
&lt;&#x2F;span&gt;&lt;span&gt;     %addtmp = fadd double %multmp, %multmp2
&lt;&#x2F;span&gt;&lt;span&gt;     %multmp3 = fmul double %b, %b
&lt;&#x2F;span&gt;&lt;span&gt;     %addtmp4 = fadd double %addtmp, %multmp3
&lt;&#x2F;span&gt;&lt;span&gt;     ret double %addtmp4
&lt;&#x2F;span&gt;&lt;span&gt; }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt; declare double @cos(double)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å°†ä¸Šè¿°ä»£ç ç¼–è¯‘ä¸ºå¯æ‰§è¡Œä»£ç ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ç¼–å†™ä¸€ä¸ª main å‡½æ•°ï¼Œè°ƒç”¨ foo å‡½æ•°&lt;pre data-lang=&quot;c&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-c &quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; file a0.c
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;# include &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;stdio.h&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;extern double &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;foo&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;double &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;a&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;double &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;b&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;(){
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;double&lt;&#x2F;span&gt;&lt;span&gt; r = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;foo&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1.0&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2.0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;printf&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;foo(1.0,2.0) = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;%lf&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, r);
&lt;&#x2F;span&gt;&lt;span&gt;  }
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;ç¼–è¯‘ã€æ‰§è¡Œ&lt;pre data-lang=&quot;shell&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-shell &quot;&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span&gt;llc a1.ll -o a1.s
&lt;&#x2F;span&gt;&lt;span&gt;gcc -o a0 a0.c a1.s
&lt;&#x2F;span&gt;&lt;span&gt;.&#x2F;a0   # foo(1.0,2.0) = 9.000000
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;JIT æ–¹å¼&lt;&#x2F;p&gt;
&lt;p&gt;æœ¬è´¨ä¸Šï¼ŒJIT æ‰§è¡Œæ–¹å¼ä¸æ­¥éª¤3 çš„æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ JIT æ–¹å¼åœ¨è¿è¡Œæ—¶ï¼Œç¼–è¯‘ç”Ÿæˆçš„æœºå™¨ç ï¼Œæ˜¯åœ¨å†…å­˜ä¸­ï¼Œå¹¶ mmap åˆ°å¯æ‰§è¡Œå†…å­˜åŒºåŸŸï¼Œç„¶åç›´æ¥æ‰§è¡Œã€‚
å½“ç„¶ï¼Œéœ€è¦å¤„ç†çš„æ˜¯ä¸€äº›ç¬¦å·è¿æ¥ï¼ŒåŒ…æ‹¬è·å– ç”Ÿæˆçš„å‡½æ•°åœ°å€ï¼Œä¹ŸåŒ…æ‹¬è°ƒç”¨å®¿ä¸»ç¯å¢ƒæä¾›çš„å‡½æ•°ç­‰ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;comments-on-kaleidoscope-chapter-4-jit&quot;&gt;Comments on Kaleidoscope Chapter 4: JIT&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;LLVMContext:  an important class for using LLVM in a threaded context. owns core &quot;global&quot; data.&lt;&#x2F;li&gt;
&lt;li&gt;Module: å¯¹åº”äºå•ä¸ª ll æ–‡ä»¶ï¼Œå¯ä»¥åŒ…å«å…¨å±€å˜é‡ã€å‡½æ•°å®šä¹‰ç­‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;KaleidoscopeJITï¼š è¯¦ç»†çš„ CRC æœ‰å¾…æ•´ç†ã€‚
&lt;ul&gt;
&lt;li&gt;RTDyldObjectLinkingLayer&lt;&#x2F;li&gt;
&lt;li&gt;IRCompileLayer:&lt;&#x2F;li&gt;
&lt;li&gt;JITDylib&lt;&#x2F;li&gt;
&lt;li&gt;ResourceTracer?&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;ol&gt;
&lt;li&gt;parser =&amp;gt; AST&lt;&#x2F;li&gt;
&lt;li&gt;AST =&amp;gt; IR&lt;&#x2F;li&gt;
&lt;li&gt;IR =&amp;gt; JIT
&lt;ul&gt;
&lt;li&gt;FunctionAST &lt;code&gt;def foo(x) x + 1&lt;&#x2F;code&gt; =&amp;gt; IR &lt;code&gt;Function&lt;&#x2F;code&gt; =&amp;gt; JIT.addModule&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ Ch4 ä¸­ï¼Œæ¯ä¸ªå‡½æ•°å®šä¹‰éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ Moduleï¼Œç„¶åé€šè¿‡ JIT.addModule åŠ è½½åˆ° JIT ä¸­ã€‚è¿™æ˜¯ REPL æ¨¡å¼çš„ä¸€ä¸ªé€‰æ‹©ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å‡½æ•°è°ƒç”¨æ—¶ï¼Œ&lt;code&gt;foo(x)&lt;&#x2F;code&gt; é¦–å…ˆåœ¨å½“å‰ Module ä¸­æŸ¥æ‰¾ foo (ä¾‹å¦‚é€’å½’è°ƒç”¨)ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™åœ¨å…¨å±€çš„ FunctionProtos ä¸­æŸ¥æ‰¾ï¼Œ
æ­¤æ—¶ï¼Œä¼šåœ¨å½“å‰æ¨¡å—ä¸­ç”Ÿæˆä¸€ä¸ª &lt;code&gt;extern&lt;&#x2F;code&gt; å‡½æ•°ç”³æ˜ã€‚JIT æ¨¡å—ä¼šè´Ÿè´£ linkã€‚&lt;&#x2F;li&gt;
&lt;li&gt;JIT çš„æ ¸å¿ƒæ¥å£æ˜¯ addModule, ç›¸å½“äº link ä¸€ä¸ªæ¨¡å—ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;JIT å¯ä»¥é€šè¿‡ ResourceTracker æ¥åˆ é™¤éƒ¨ä»½æ¨¡å—ï¼Œå¯¹ REPL æ¥è¯´ï¼Œtop-level expr ä¼šä½œä¸ºä¸€ä¸ªåŒ¿åæ¨¡å—ï¼Œè°ƒç”¨åå°±å¯ä»¥è¢«æ¸…é™¤æ‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;JIT ä¼šå¤„ç† link: é¦–å…ˆä»å½“å‰åŠ è½½çš„æ‰€æœ‰æ¨¡å—ä¸­ï¼Œè‡ªåå‘å‰æœç´¢åå­—ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ï¼Œé€šè¿‡ dlsym(&quot;foo&quot;) æ¥æŸ¥æ‰¾ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;JIT æä¾› &lt;code&gt;lookup(name)&lt;&#x2F;code&gt; æ–¹æ³•è¿”å›å‡½æ•°åœ°å€ï¼Œå¯ä»¥åœ¨å¤–éƒ¨ç›´æ¥è°ƒç”¨ï¼ˆå‰ææ˜¯ä½ çŸ¥é“å¦‚ä½•é€šè¿‡ ABI è°ƒç”¨ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;gong-ju-su-cha&quot;&gt;å·¥å…·é€ŸæŸ¥&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;LLVM å·¥å…·
&lt;ul&gt;
&lt;li&gt;llc : .ll to .s, .bc to .s&lt;&#x2F;li&gt;
&lt;li&gt;lli : run .ll, .bc&lt;&#x2F;li&gt;
&lt;li&gt;llvm-as: .ll to .bc&lt;&#x2F;li&gt;
&lt;li&gt;llvm-dis : .bc to .ll&lt;&#x2F;li&gt;
&lt;li&gt;as:  .s to .o&lt;&#x2F;li&gt;
&lt;li&gt;ld: link .o to .out&lt;&#x2F;li&gt;
&lt;li&gt;cc -v å¯ä»¥æŸ¥çœ‹å®Œæ•´çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œæ¯ä¸€ä¸ªç¼–è¯‘é˜¶æ®µçš„å‘½ä»¤è¡Œã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Rust ç¼–è¯‘ç›¸å…³
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;cargo rustc --target x86_64-apple-darwin --release -- --emit asm -C llvm-args=-x86-asm-syntax=intel&lt;&#x2F;code&gt; æ¥ç”Ÿæˆæ±‡ç¼–ä»£ç ã€‚
ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ï¼Œå¯ä»¥åœ¨ &lt;code&gt;target&#x2F;x86_64-apple-darwin&#x2F;release&#x2F;deps&#x2F;&lt;&#x2F;code&gt; ç›®å½•ä¸‹æ‰¾åˆ°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨é€‰é¡¹ -C target-cpu=native æ¥ç”Ÿæˆé’ˆå¯¹å½“å‰ CPU çš„ä¼˜åŒ–ä»£ç ã€‚&lt;code&gt;cargo rustc --target x86_64-apple-darwin --release -- -C target-cpu=native --emit asm&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨é€‰é¡¹ -C target-feature=+avx2 æ¥ç”Ÿæˆé’ˆå¯¹ AVX2 æŒ‡ä»¤é›†çš„ä¼˜åŒ–ä»£ç ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;cargo -vv å¯ä»¥æŸ¥çœ‹è¯¦ç»†çš„æ‰§è¡Œå‘½ä»¤è¡Œå‚æ•°ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;ç³»åˆ—é“¾æ¥
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;learning-llvm&#x2F;&quot;&gt;LLVM å­¦ä¹ ç³»åˆ—ä¸€ï¼šåˆè¯» LLVM-IR ç¤ºä¾‹ä»£ç &lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;learning-llvm-2&#x2F;&quot;&gt;LLVM å­¦ä¹ ç³»åˆ—äºŒï¼šä»ä¸€æ®µç®€å•çš„Cä»£ç æ¥å­¦ä¹ LLVM-IR&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Portable SIMD: How it works</title>
        <published>2024-10-02T00:00:00+00:00</published>
        <updated>2024-10-02T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/how-portable-simd-works/"/>
        <id>https://wangzaixiang.github.io/blog/how-portable-simd-works/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/how-portable-simd-works/">&lt;p&gt;ä¸€ç›´å¾ˆå¥½å¥‡ï¼Œportable simd åº“æ˜¯å¦‚ä½•å®ç°çš„ï¼Œéš¾é“æ˜¯ä¿®æ”¹äº† rustc çš„ç¼–è¯‘æœŸï¼Œä»è€Œç”Ÿæˆæ”¯æŒ SIMD çš„æœºå™¨ä»£ç ï¼Ÿä½†åœ¨ portable-simd çš„æºä»£ç ä¸­ï¼Œ
å¹¶æ²¡æœ‰çœ‹åˆ°ä¸ rustc ç›¸å…³çš„ä¿®æ”¹ã€‚é‚£ä¹ˆï¼Œportable-simd æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ&lt;&#x2F;p&gt;
&lt;p&gt;è¦æ¢ç©¶è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œç„¶åè·Ÿè¸ªä¸€ä¸‹ç¼–è¯‘è¿‡ç¨‹ï¼Œå°±å¯ä»¥çŸ¥é“ portable-simd æ˜¯å¦‚ä½•å·¥ä½œçš„äº†ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;shi-li&quot;&gt;ç¤ºä¾‹&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªæ–°çš„ Rust é¡¹ç›®&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;cargo new hellosimd&lt;&#x2F;li&gt;
&lt;li&gt;cd hellosimd&lt;&#x2F;li&gt;
&lt;li&gt;add cargo-toolchain.toml, è¿™æ ·ï¼Œåç»­å°±ä¸éœ€è¦æ¯æ¬¡æ·»åŠ  +nightly é€‰é¡¹äº†ã€‚&lt;pre data-lang=&quot;toml&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-toml &quot;&gt;&lt;code class=&quot;language-toml&quot; data-lang=&quot;toml&quot;&gt;&lt;span&gt;[toolchain]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;channel &lt;&#x2F;span&gt;&lt;span&gt;= &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nightly&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;add src&#x2F;main.rs as&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span&gt; #![&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;feature&lt;&#x2F;span&gt;&lt;span&gt;(portable_simd)]
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;std::simd::f32x4;
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;std::simd::num::SimdFloat;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; v1: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32 &lt;&#x2F;span&gt;&lt;span&gt;= std::env::args().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;nth&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;unwrap&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;parse&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;unwrap&lt;&#x2F;span&gt;&lt;span&gt;(); 
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; result = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;test&lt;&#x2F;span&gt;&lt;span&gt;(v1);
&lt;&#x2F;span&gt;&lt;span&gt;     println!(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{:?}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, result);
&lt;&#x2F;span&gt;&lt;span&gt; }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt; #[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)] 
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;test&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;num&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32&lt;&#x2F;span&gt;&lt;span&gt;) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f32 &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; a = f32x4::splat(num);
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; b = f32x4::from_array([&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1.0&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2.0&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3.0&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;4.0&lt;&#x2F;span&gt;&lt;span&gt;]);
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; c = a + b;
&lt;&#x2F;span&gt;&lt;span&gt;     c.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;reduce_sum&lt;&#x2F;span&gt;&lt;span&gt;()
&lt;&#x2F;span&gt;&lt;span&gt; }
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æŸ¥çœ‹ MIR ä»£ç : &lt;code&gt;cargo rustc --release -- -Zunpretty=mir&lt;&#x2F;code&gt;
MIR ä»£ç æ¯”è¾ƒéš¾ä»¥é˜…è¯»ï¼Œå¤§æ¦‚å¯ä»¥çœ‹åˆ°è¿™é‡Œè°ƒç”¨äº† simd_shuffle, simd_add, simd_reduce_add_ordered å‡½æ•°ã€‚&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;    bb0: {
&lt;&#x2F;span&gt;&lt;span&gt;     _5 = [copy _1];
&lt;&#x2F;span&gt;&lt;span&gt;     StorageLive(_6);
&lt;&#x2F;span&gt;&lt;span&gt;     _6 = copy _5;
&lt;&#x2F;span&gt;&lt;span&gt;     StorageLive(_7);
&lt;&#x2F;span&gt;&lt;span&gt;     _7 = &amp;amp;raw const _6;
&lt;&#x2F;span&gt;&lt;span&gt;     StorageLive(_11);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageLive(_8);
&lt;&#x2F;span&gt;&lt;span&gt;     _8 = MaybeUninit::&amp;lt;Simd&amp;lt;f32, 1&amp;gt;&amp;gt; { uninit: const () };
&lt;&#x2F;span&gt;&lt;span&gt;     StorageLive(_9);
&lt;&#x2F;span&gt;&lt;span&gt;     _11 = &amp;amp;raw mut _8;
&lt;&#x2F;span&gt;&lt;span&gt;     _9 = copy _11 as *mut [f32; 1] (PtrToPtr);
&lt;&#x2F;span&gt;&lt;span&gt;     copy_nonoverlapping(dst = copy _9, src = copy _7, count = const 1_usize);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageDead(_9);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageLive(_10);
&lt;&#x2F;span&gt;&lt;span&gt;     _10 = copy _8;
&lt;&#x2F;span&gt;&lt;span&gt;     _17 = move ((_10.1: std::mem::ManuallyDrop&amp;lt;std::simd::Simd&amp;lt;f32, 1&amp;gt;&amp;gt;).0: std::simd::Simd&amp;lt;f32, 1&amp;gt;);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageDead(_10);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageDead(_8);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageDead(_11);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageDead(_7);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageDead(_6);
&lt;&#x2F;span&gt;&lt;span&gt;     _2 = simd_shuffle::&amp;lt;Simd&amp;lt;f32, 1&amp;gt;, swizzle::{constant#0}::SimdShuffleIdx&amp;lt;4&amp;gt;, Simd&amp;lt;f32, 4&amp;gt;&amp;gt;(copy _17, move _17, const &amp;lt;std::simd::Simd&amp;lt;T, N&amp;gt;::splat::Splat as std::simd::Swizzle&amp;lt;4&amp;gt;&amp;gt;::swizzle::&amp;lt;f32, 1&amp;gt;::{constant#0}) -&amp;gt; [return: bb1, unwind unreachable];
&lt;&#x2F;span&gt;&lt;span&gt; }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt; bb1: {
&lt;&#x2F;span&gt;&lt;span&gt;     StorageLive(_3);
&lt;&#x2F;span&gt;&lt;span&gt;     _3 = [const 1f32, const 2f32, const 3f32, const 4f32];
&lt;&#x2F;span&gt;&lt;span&gt;     StorageLive(_12);
&lt;&#x2F;span&gt;&lt;span&gt;     _12 = &amp;amp;raw const _3;
&lt;&#x2F;span&gt;&lt;span&gt;     StorageLive(_16);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageLive(_13);
&lt;&#x2F;span&gt;&lt;span&gt;     _13 = MaybeUninit::&amp;lt;Simd&amp;lt;f32, 4&amp;gt;&amp;gt; { uninit: const () };
&lt;&#x2F;span&gt;&lt;span&gt;     StorageLive(_14);
&lt;&#x2F;span&gt;&lt;span&gt;     _16 = &amp;amp;raw mut _13;
&lt;&#x2F;span&gt;&lt;span&gt;     _14 = copy _16 as *mut [f32; 4] (PtrToPtr);
&lt;&#x2F;span&gt;&lt;span&gt;     copy_nonoverlapping(dst = copy _14, src = copy _12, count = const 1_usize);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageDead(_14);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageLive(_15);
&lt;&#x2F;span&gt;&lt;span&gt;     _15 = copy _13;
&lt;&#x2F;span&gt;&lt;span&gt;     _18 = move ((_15.1: std::mem::ManuallyDrop&amp;lt;std::simd::Simd&amp;lt;f32, 4&amp;gt;&amp;gt;).0: std::simd::Simd&amp;lt;f32, 4&amp;gt;);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageDead(_15);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageDead(_13);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageDead(_16);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageDead(_12);
&lt;&#x2F;span&gt;&lt;span&gt;     StorageDead(_3);
&lt;&#x2F;span&gt;&lt;span&gt;     _4 = simd_add::&amp;lt;Simd&amp;lt;f32, 4&amp;gt;&amp;gt;(move _2, move _18) -&amp;gt; [return: bb2, unwind unreachable];
&lt;&#x2F;span&gt;&lt;span&gt; }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt; bb2: {
&lt;&#x2F;span&gt;&lt;span&gt;     _0 = simd_reduce_add_ordered::&amp;lt;Simd&amp;lt;f32, 4&amp;gt;, f32&amp;gt;(move _4, const 0f32) -&amp;gt; [return: bb3, unwind unreachable];
&lt;&#x2F;span&gt;&lt;span&gt; }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;åœ¨ MIR è¿™ä¸ªå±‚æ¬¡ï¼Œå¯ä»¥çœ‹åˆ° splat å‡½æ•°è¢« inline æˆäº†ä¸€æ¬¡ simd_shuffle è°ƒç”¨ã€‚è¿™ä¸ portable-simd æºä»£ç æ˜¯ä¸€è‡´çš„ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span&gt; #[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;splat&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;: T) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;Self &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; This is preferred over `[value; N]`, since it&amp;#39;s explicitly a splat:
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;97804
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;Splat;
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;impl&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const&lt;&#x2F;span&gt;&lt;span&gt; N: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; Swizzle&amp;lt;N&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for &lt;&#x2F;span&gt;&lt;span&gt;Splat {
&lt;&#x2F;span&gt;&lt;span&gt;         &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;INDEX&lt;&#x2F;span&gt;&lt;span&gt;: [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;; N] = [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;; N];
&lt;&#x2F;span&gt;&lt;span&gt;     }
&lt;&#x2F;span&gt;&lt;span&gt;     Splat::swizzle::&amp;lt;T, 1&amp;gt;(Simd::&amp;lt;T, 1&amp;gt;::from([value]))
&lt;&#x2F;span&gt;&lt;span&gt; }
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è€Œ simd_shuffle å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span&gt;-- file stdlib&#x2F;core&#x2F;src&#x2F;intrinsics&#x2F;simd.rs
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;extern &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;rust-intrinsic&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; {
&lt;&#x2F;span&gt;&lt;span&gt; #[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;rustc_nounwind&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;simd_shuffle&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;T, U, V&amp;gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span&gt;: T, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span&gt;: T, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;idx&lt;&#x2F;span&gt;&lt;span&gt;: U) -&amp;gt; V;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt; #[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;rustc_nounwind&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;simd_add&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;T&amp;gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span&gt;: T, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span&gt;: T) -&amp;gt; T;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt; #[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;rustc_nounwind&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;pub fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;simd_reduce_add_ordered&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;T, U&amp;gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span&gt;: T, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span&gt;: U) -&amp;gt; U;
&lt;&#x2F;span&gt;&lt;span&gt;} 
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è¿™äº›å‡½æ•°éƒ½æ˜¯ rustc çš„ intrinsics å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šå°†è¿™äº›å‡½æ•°è°ƒç”¨è½¬æ¢ä¸ºå¯¹åº”çš„ LLVM SIMD æŒ‡ä»¤ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ç»§ç»­æŸ¥çœ‹ LLVM-IR ä»£ç ï¼š&lt;code&gt;cargo rustc --release -- --emit llvm-ir&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt; ; hellosimd::test
&lt;&#x2F;span&gt;&lt;span&gt; ; Function Attrs: mustprogress nofree noinline norecurse nosync nounwind willreturn memory(none) uwtable
&lt;&#x2F;span&gt;&lt;span&gt; define internal fastcc noundef float @_ZN9hellosimd4test17h3d900c9e1094a824E(float noundef %num) unnamed_addr #4 {
&lt;&#x2F;span&gt;&lt;span&gt; start:
&lt;&#x2F;span&gt;&lt;span&gt; %0 = insertelement &amp;lt;1 x float&amp;gt; poison, float %num, i64 0
&lt;&#x2F;span&gt;&lt;span&gt; %1 = shufflevector &amp;lt;1 x float&amp;gt; %0, &amp;lt;1 x float&amp;gt; poison, &amp;lt;4 x i32&amp;gt; zeroinitializer
&lt;&#x2F;span&gt;&lt;span&gt; %2 = fadd &amp;lt;4 x float&amp;gt; %1, &amp;lt;float 1.000000e+00, float 2.000000e+00, float 3.000000e+00, float 4.000000e+00&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt; %3 = tail call float @llvm.vector.reduce.fadd.v4f32(float 0.000000e+00, &amp;lt;4 x float&amp;gt; %2)
&lt;&#x2F;span&gt;&lt;span&gt; ret float %3
&lt;&#x2F;span&gt;&lt;span&gt; }
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;æ­¤æ—¶ï¼Œç”Ÿæˆçš„ LLVM-IR å·²ç»æ˜¯ LLVM çš„ SIMD æŒ‡ä»¤äº†ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;jie-lun&quot;&gt;ç»“è®º&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;portable-simd æœ¬èº«ä»…ä»…æ˜¯ä¸€ä¸ªæ™®é€šçš„ Rust åº“ï¼Œä¸è¿‡ï¼Œå…¶å†…éƒ¨ä¾èµ–äº† rustc çš„ intrinsics å‡½æ•°ï¼Œè€Œè¿™äº›å‡½æ•°åœ¨ LLVM ä¸‹ä¼šè½¬æ¢ä¸º LLVM çš„ æŒ‡ä»¤ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;rustc å†…éƒ¨æœ‰å¾ˆå¤šä¸ CPU æ¶æ„ç›¸å…³çš„ intrinsics å‡½æ•°ï¼Œè¿™äº›å‡½æ•°åœ¨ç¼–è¯‘åï¼ˆå¯èƒ½ï¼‰ä¼šç›´æ¥è½¬æ¢ä¸ºç›®æ ‡ CPU ä¸Šçš„æŒ‡ä»¤ï¼Œè€Œéå‡½æ•°è°ƒç”¨ã€‚æ˜¾ç„¶ï¼Œ intrinsics å‡½æ•°
çš„å¯ç§»æ¤èƒ½åŠ›å¯¹ç¼–è¯‘æœŸæ¥è¯´ï¼Œä¼šæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚rustc ç›®å‰æ˜¯å»ºç«‹åœ¨ LLVM çš„åŸºç¡€ä¹‹ä¸Šï¼ŒæŠŠè¿™ä¸ªè´£ä»»è½¬å«ç»™äº† LLVMã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æˆ‘ä»¬ä¹Ÿå¯ä»¥å‚è€ƒ portable-simd çš„å®ç°ï¼Œæ¥åˆ©ç”¨ rustc çš„ intrinsics å‡½æ•°ï¼Œæ¥å®ç°è‡ªå·±çš„æŸäº›ç‰¹å®šæ“ä½œã€‚&lt;&#x2F;li&gt;
&lt;li&gt;äº†è§£ rustc çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„ç†è§£ Rust è¯­è¨€ç”Ÿæ€ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>October 2024</title>
        <published>2024-10-01T00:00:00+00:00</published>
        <updated>2024-10-01T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2024-10/"/>
        <id>https://wangzaixiang.github.io/monthly/2024-10/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2024-10/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;josephg.com&#x2F;blog&#x2F;rewriting-rust&#x2F;&quot;&gt;Rewriting Rust&lt;&#x2F;a&gt;
ä½œè€…æå‡ºäº†è‡ªå·±å¿ƒä¸­ç†æƒ³çš„ rust åº”è¯¥åŒ…æ‹¬çš„å‡ ä¸ªç‰¹æ€§ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ›´å¤šçš„ function trait. åˆäº† Fn, FnMut, FnOnceã€‚è¿™æ ·ç›¸å½“äºç»™ å‡½æ•° æä¾›æ›´å¤šçš„ç±»å‹ä¿¡æ¯ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Move, Pin çš„é‡æ–°è®¾è®¡ï¼Œæ¶ˆé™¤ Pin å­˜åœ¨çš„å¿…è¦æ€§ï¼Œç»Ÿä¸€ borrow è¯­ä¹‰&lt;&#x2F;li&gt;
&lt;li&gt;comptime. ä¸åŒä¸ macro, comptime ä½¿ç”¨ç›¸åŒçš„æºè¯­è¨€è¯­æ³•ï¼Œæœ‰æ›´å¥½çš„ç±»å‹æ£€æŸ¥ã€‚ï¼ˆç¼–è¯‘å™¨å†…ç½®ä¸€ä¸ªå°çš„è§£é‡Šå™¨ ï¼‰
è¿™3ä¸ªç‰¹æ€§å¯¹æˆ‘æ¥è¯´ï¼Œéƒ½æ„Ÿè§‰æ˜¯éå¸¸åˆç†çš„ï¼Œä¸”æœ‰å¸å¼•åŠ›ã€‚å…¶ä¸­ï¼ŒPinè¿™ä¸€å—çš„ä»‹ç»ä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£ Pin å­˜åœ¨çš„åŸå› ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;pythonspeed.com&#x2F;articles&#x2F;optimizing-with-simd&#x2F;&quot;&gt;faster Mandelbrot with SIMD&lt;&#x2F;a&gt;
Mandlebrot è¿™ä¸ªç®—æ³•å¦‚ä½•åˆ©ç”¨ SIMD è¿›è¡Œä¼˜åŒ–(æœ‰å¾ªç¯å’Œåˆ†æ”¯å¤„ç†)ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸è¿‡ï¼Œè¿™é‡Œä½œè€…çš„å†™æ³•ä¼¼ä¹æœ‰ä¸€äº› BUGï¼Œ SIMD ç‰ˆæœ¬å¹¶ä¸ä¸¥æ ¼å¯¹åº”äº scalar ç‰ˆæœ¬ï¼Œæœ‰äº›åœ°æ–¹çš„å¤„ç†ä¸ä¸€è‡´ã€‚å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« 
&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;mandelbrot-gpu&#x2F;&quot;&gt;Mandelbrot-set CPU vs GPU comparison&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ç°ä»£å¾®å¤„ç†å™¨ï¼š90åˆ†é’Ÿé€ŸæˆæŒ‡å—ï¼ä»‹ç»äº†ç°ä»£ CPU çš„ä¸€äº›æ¦‚å¿µï¼Œå¦‚è¶…æ ‡é‡ã€ä¹±åºæ‰§è¡Œã€åˆ†æ”¯é¢„æµ‹ã€ç¼“å­˜ç­‰ã€SIMDã€SMT ç­‰æŠ€æœ¯ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;645343994&quot;&gt;ä¸­æ–‡ç‰ˆ&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.lighterra.com&#x2F;papers&#x2F;modernmicroprocessors&#x2F;&quot;&gt;English Version&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;oxc.rs&#x2F;docs&#x2F;learn&#x2F;performance.html&quot;&gt;oxc: JavaScript Compiler é¡¹ç›®çš„æ€§èƒ½ä¼˜åŒ–è®°å½•&lt;&#x2F;a&gt;
oxc é¡¹ç›®æ˜¯ä½¿ç”¨ Rust ç¼–å†™çš„ JavaScript ç¼–è¯‘å™¨ï¼Œæœ€è¿‘ Vite é¡¹ç›®ä¹Ÿåœ¨åŸºäº oxc å¼€å‘æ–°ä¸€ä»£çš„ bundle: rolldown. OXC ä»¥æ€§èƒ½è‘—ç§°ï¼Œè¿™ç¯‡æ–‡ç« 
ä»‹ç»äº†ä½œè€…åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­é‡‡å–çš„ä¸€ç³»åˆ—æªæ–½ï¼ŒåŒ…æ‹¬ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;AST ç›¸å…³
&lt;ul&gt;
&lt;li&gt;AST å†…å­˜åˆ†é…ã€‚ä»æ¯ä¸ªå°èŠ‚ç‚¹çš„åˆ†é…ã€é‡Šæ”¾ï¼ŒDropçš„æˆæœ¬è¾ƒé«˜ï¼Œè°ƒæ•´ä¸ºä¸ºå•ä¸ª AST åˆ†é…ä¸€ä¸ª arenaï¼Œä½œä¸ºæ•´ä½“é‡Šæ”¾ã€‚æå‡ ï½20%ï¼ˆä¹Ÿå¤§ä¸ºæå‡ç¼“å­˜å‹å¥½æ€§ï¼‰
è¿™ä¸ªä¸ zig çš„å†…å­˜ç®¡ç†é£æ ¼æœ‰äº›ç›¸ä¼¼ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Enum Sizeã€‚ä½¿ç”¨ box åŒ…è£…å­—æ®µï¼Œå‡å°‘ enum å ç”¨å¤§å°ã€‚æå‡ ï½10%ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Spanï¼šå°†ä½ç½®ä¿¡æ¯ä» usize è°ƒæ•´åˆ° u32. æå‡ ï½5%ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;String interningã€‚ string-cache å­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œç§»é™¤åï¼Œæ€§èƒ½æå‡ ï½30%ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹ string-cache è¿›è¡Œå¹¶å‘ä¼˜åŒ–&lt;&#x2F;li&gt;
&lt;li&gt;String inlining: å¯¹ é•¿åº¦ &amp;lt;= 23 çš„å­—ç¬¦ä¸²è¿›è¡Œ inline, é¿å…ä½¿ç”¨ Stringã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Lexer
&lt;ul&gt;
&lt;li&gt;SIMD&lt;&#x2F;li&gt;
&lt;li&gt;keyword match&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Linter&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Byron&#x2F;gitoxide&#x2F;tree&#x2F;main&quot;&gt;gitoxide&lt;&#x2F;a&gt; ç”¨ rust é‡æ–°çš„ git è½®å­ã€‚ git ç”Ÿæ€å·²ç»æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å‘½ä»¤è¡Œç”Ÿæ€äº†ï¼Œè¿™ä¸ª
è½®å­çš„å·¥ä½œé‡å¹¶ä¸å°ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;db.in.tum.de&#x2F;~finis&#x2F;x86%20intrinsics%20cheat%20sheet%20v1.0.pdf&quot;&gt;x86 Intrinsics Cheat Sheet&lt;&#x2F;a&gt; è¿™ä¸ªæ˜¯å­¦ä¹  SIMD çš„å¥½èµ„æ–™ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.intel.com&#x2F;content&#x2F;www&#x2F;us&#x2F;en&#x2F;docs&#x2F;intrinsics-guide&#x2F;index.html#&quot;&gt;x86 Intrinsics Reference&lt;&#x2F;a&gt; Intel å®˜æ–¹å‚è€ƒã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æ’åº&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.vldb.org&#x2F;pvldb&#x2F;vol8&#x2F;p1274-inoue.pdf&quot;&gt;æ’åºç®—æ³• SIMDç‰ˆæœ¬&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;intel&#x2F;x86-simd-sort&quot;&gt;x86-simd-sort&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;MPP &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;kerkour.com&#x2F;rust-data-engineering&quot;&gt;Why Rust is taking the data engineering world by storm&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;100G - 9T è§„æ¨¡çš„æ•°æ®è§„æ¨¡è¦†ç›–äº† 98% çš„éœ€æ±‚ï¼Œä¹‹å‰éœ€è¦ä¸€ä¸ªå¤§å‹çš„ MPP é›†ç¾¤ï¼Œè€Œç°åœ¨ï¼Œå¯ä»¥åœ¨1ä¸ªæœåŠ¡å™¨ä¸Šå®Œæˆã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Rust + Cargo æ”¹å˜äº†æ•°æ®åº“åº”ç”¨çš„å¼€å‘æ–¹å¼ï¼Œä¸å†éœ€è¦ä¸€ä¸ª monlitic çš„æ•°æ®åº“ï¼Œè€Œæ˜¯å¯ä»¥é€šè¿‡ç»„åˆå„ç§ crate æ¥å®Œæˆã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;datafusion.apache.org&#x2F;user-guide&#x2F;introduction.html#known-users&quot;&gt;å¾ˆå¤šæ•°æ®åº“&lt;&#x2F;a&gt;éƒ½é‡‡ç”¨ datafusion ä½œä¸ºè®¡ç®—å¼•æ“ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;motherduck.com&#x2F;blog&#x2F;big-data-is-dead&#x2F;&quot;&gt;Big Data is dead&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.oschina.net&#x2F;news&#x2F;316422&#x2F;apache-doris-3-0-released&quot;&gt;Apache Doris 3.0 é‡Œç¨‹ç¢‘ç‰ˆæœ¬ï½œå­˜ç®—åˆ†ç¦»æ¶æ„å‡çº§ã€æ¹–ä»“ä¸€ä½“å†è¿›åŒ–&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;web-visualization&quot;&gt;Web &amp;amp; Visualization&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Bundlers&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;bun.sh&#x2F;docs&#x2F;bundler&quot;&gt;bun.build&lt;&#x2F;a&gt; æ¯” esbuild æ›´å¿«ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;oxc-project.github.io&quot;&gt;oxc-project&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rolldown.rs&quot;&gt;rolldown&lt;&#x2F;a&gt; based on oxc, vite å­é¡¹ç›®ï¼Œæ„åœ¨æ›¿æ¢ esbuild å’Œ rollupï¼Œä½œä¸º dev&#x2F;release æ¨¡å¼ä¸‹ç»Ÿä¸€çš„æ‰“åŒ…å·¥å…·&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;brisa.build&quot;&gt;brisa&lt;&#x2F;a&gt; ä¸€ä¸ªå·ç§°ç»§æ‰¿äº†ç»„å¤šå‰ç«¯æ¡†æ¶ç‰¹æ€§çš„æ–°è½®å­ï¼Œå¯¹ webcomponent å’Œ SSR éƒ½æœ‰æ”¯æŒï¼Œç­‰å‘å¸ƒäº†å†çœ‹çœ‹ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;lit.dev&#x2F;blog&#x2F;2024-10-08-signals&#x2F;&quot;&gt;Lit æ”¯æŒ signals&lt;&#x2F;a&gt;
ç°åœ¨çš„ç»„ä»¶æœ‰ä¸¤ç§å“åº”æ¨¡å¼äº†ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹ ç»„ä»¶ è‡ªå·±çš„ props&#x2F;states çš„å˜åŒ–çš„å“åº”ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹ å¤–éƒ¨çš„ signal çš„å“åº”ã€‚
å¢åŠ åè€…ï¼Œå¸¦æ¥äº†çµæ´»æ€§çš„åŒæ—¶ï¼Œæ˜¯å¦ä¼šå¸¦æ¥æ›´å¤šçš„å¤æ‚æ€§å‘¢ï¼Ÿ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å£æ°´æˆ˜ï¼š Web Components, Future or Not?&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dev.to&#x2F;ryansolid&#x2F;web-components-are-not-the-future-48bh&quot;&gt;Web Components Are Not the Future&lt;&#x2F;a&gt;
å¾ˆé—æ†¾ï¼Œæˆ‘éƒ½æ²¡æœ‰ get åˆ°ä½œè€…çš„ç‚¹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@treeder&#x2F;web-components-are-the-future-f0f9f0022686&quot;&gt;Web Components Are the Future&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.abeautifulsite.net&#x2F;posts&#x2F;web-components-are-not-the-future-they-re-the-present&#x2F;&quot;&gt;Web Components Are Not the Future â€” Theyâ€™re the Present&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;ç»„ä»¶çš„äº’æ“ä½œæ€§ã€‚ ABI å…¼å®¹æ€§ã€‚åœ¨æ¡†æ¶Aä¸­ç¼–å†™ä¸€ä¸ªç»„ä»¶ï¼Œåœ¨æ¡†æ¶Bã€Cã€Dä¸­ä½¿ç”¨ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æˆ‘ä»¬ä¸éœ€è¦å°±å¦‚ä½•ç¼–å†™ç»„ä»¶è¾¾æˆä¸€è‡´ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨åº•å±‚å®ç°è¾¾æˆä¸€è‡´ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°ç»„ä»¶çš„äº’æ“ä½œæ€§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Element? Component? è°æ˜¯è°çš„å­é›†ï¼Ÿç»„ä»¶ä¸ä¸€å®šæ˜¯ Elementï¼Œä¸æ˜¯ Element çš„ç»„ä»¶ï¼Œä¸ä¸€å®šè¦ä½œä¸º WebComponent, JS Module è¶³ä»¥ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;2024-11 &lt;a href=&quot;https:&#x2F;&#x2F;c5r.medium.com&#x2F;webcomponents-are-a-part-of-the-future-94a2b0940314&quot;&gt;WebComponents Are (a Part of) the Future&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dev.to&#x2F;richharris&#x2F;why-i-don-t-use-web-components-2cia&quot;&gt;Why I don&#x27;t use web components&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;æ¸è¿›å¼ç»„ä»¶å¯¹ JS çš„ä¾èµ–ï¼Ÿ tiny case&lt;&#x2F;li&gt;
&lt;li&gt;css in js. little case.&lt;&#x2F;li&gt;
&lt;li&gt;æ ‡å‡†ã€ç¨³å®šæ€§ã€‚ little case&lt;&#x2F;li&gt;
&lt;li&gt;polyfills.&lt;&#x2F;li&gt;
&lt;li&gt;slot composition. WEB ç»„ä»¶å¯¹ lighting DOM ç¼ºå°‘å»¶è¿Ÿå¤„ç†ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;props or attrs.&lt;&#x2F;li&gt;
&lt;li&gt;The DOM is bad, write less code. åˆä¸€ä¸ªåŒå‘ç»‘å®šçš„äº‰è®ºã€‚ svelte æœ‰å¯¹åŒå‘ç»‘å®šçš„æ”¯æŒã€‚
è¿™ç¯‡æ–‡ç« æœ‰æ¯”è¾ƒå…·ä½“çš„æŠ€æœ¯ç‚¹ï¼Œä¸è¿‡ï¼Œä»æˆ‘çš„è§’åº¦ä¸Šçœ‹ï¼Œæ˜¯ä¸€äº›åå¥½è¡Œçš„é€‰æ‹©ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;wasm&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zed.dev&#x2F;blog&#x2F;zed-decoded-extensions&quot;&gt;Life of a Zed Extension: Rust, WIT, Wasm&lt;&#x2F;a&gt;
&lt;ol&gt;
&lt;li&gt;how an extension is built&lt;&#x2F;li&gt;
&lt;li&gt;using components model(IDL)&lt;&#x2F;li&gt;
&lt;li&gt;the wasm runtime: wasmtime&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;svelte.dev&#x2F;blog&#x2F;svelte-5-is-alive&quot;&gt;Svelte 5 å‘å¸ƒ&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Svelte æ˜¯ç¼–è¯‘æœŸä¼˜åŒ–çš„å“åº”å¼æ¡†æ¶ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„ç‰¹è‰²æ˜¯å¼•å…¥äº† rune çš„è¯­æ³•ç‰¹å¾ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;let count = $state(0);   &#x2F;&#x2F; ç”³æ˜ count ä¸ºä¸€ä¸ªå“åº”å¼å˜é‡ï¼Œè¿™é‡Œä»…ä»…æ˜¯ä¸€ä¸ªè¯­æ³•æ ‡è¯†ï¼Œè€Œéå‡½æ•°è°ƒç”¨ã€‚
&lt;blockquote&gt;
&lt;p&gt;ä»æºä»£ç çš„è§’åº¦æ¥çœ‹ count ä»ç„¶æ˜¯æœªå°è£…çš„ numberï¼Œä½†ç¼–è¯‘æœŸä¸ºå…¶åˆ›å»ºäº†ä¸€ä¸ªåˆ†è£…çš„å“åº”å¼å˜é‡ï¼Œåªæ˜¯æºä»£ç ä¸­è·å–çš„æ˜¯ wrapper çš„å€¼
å½“ç„¶ï¼Œå¯¹ value çš„èµ‹å€¼æ“ä½œä¹Ÿè¢«æ”¹å†™æˆä¸ºå¯¹ wrapper çš„æ“ä½œã€‚
é€šè¿‡ $state è¿™ä¸ª rune æ ‡è¯†çš„å˜é‡è¯»å†™ï¼Œéƒ½è¢«ç¼–è¯‘å™¨è¿›è¡Œäº†æ”¹å†™ï¼Œè€Œéé€šè¿‡è¿è¡ŒæœŸåå°„æ–¹å¼ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;Svelte 5 ä¸ºä»€ä¹ˆè¦åšè¿™ä¸€ä¸ªä»éšå¼ï¼ˆSvelte 4ï¼‰åˆ°æ˜¾å¼çš„è°ƒæ•´ï¼Œè¿™æ ·åšä¼šæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿè¿™ä¸ªåœ¨å®˜ç½‘æœ‰ä¸€ä¸ª &lt;a href=&quot;https:&#x2F;&#x2F;svelte.dev&#x2F;blog&#x2F;runes&quot;&gt;è¯´æ˜&lt;&#x2F;a&gt;:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ˜¾ç¤ºè¯´æ˜ï¼Œä¼¼ä¹æ˜¯ä¸€ç§å›é€€ï¼Ÿ&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹å¤æ‚é¡¹ç›®ï¼Œå¯ä»¥æ›´å¥½çš„ç†è§£å“ªä¸ªå˜é‡æ˜¯å“åº”å¼çš„ï¼ˆåœ¨å˜é‡çš„å®šä¹‰æ—¶æ˜ç¡®ï¼‰ï¼Œå¯¹ .svelte&#x2F;.js ä»£ç ä¿æŒä¸€è‡´ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Svelte ä¸ solidjs æ˜¯ç±»ä¼¼çš„åŸç†ã€‚åç»­å¯ä»¥åšä¸€ä¸ªç‰¹æ€§ä¸Šçš„å¯¹æ¯”ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;tools-libraries&quot;&gt;Tools &amp;amp; Libraries&lt;&#x2F;h1&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>DOM æ›´æ–°æŠ€æœ¯å¯¹æ¯”ï¼šVirtual DOM or Incremental DOM</title>
        <published>2024-09-12T00:00:00+00:00</published>
        <updated>2024-09-12T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/virtual-dom/"/>
        <id>https://wangzaixiang.github.io/blog/virtual-dom/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/virtual-dom/">&lt;p&gt;DOM æ›´æ–°æŠ€æœ¯æœ¬èº«æ˜¯ä¸€æ­¥æŠ€æœ¯æ¼”è¿›å†å²ï¼Œæœ¬æ–‡æ”¶é›†äº†ä»è¿œå¤æ—¶é—´ åˆ° æœ€æ–°çš„æŠ€æœ¯ï¼Œå¹¶æ•´ç†äº†æˆ‘å¯¹å…¶çš„ç†è§£ã€‚ç›®å‰è¿˜åªæ˜¯ä¸€ä¸ªæçº²ï¼Œåç»­æœ‰æ—¶é—´ä¼šæ…¢æ…¢ç»†åŒ–ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ç›´æ¥ã€å‘½ä»¤å¼æ“ä½œ DOM æ—¶ä»£&lt;&#x2F;p&gt;
&lt;p&gt;å‘½ä»¤å¼ç¼–ç¨‹çš„æ—¶ä»£ï¼Œä¹Ÿæ˜¯ UI çš„ä¼ ç»Ÿæ—¶ä»£ï¼Œæ— æ¯”é»‘æš—ã€æ— è¶£çš„æ—¶ä»£ã€‚ä» Motif åˆ° Win32ï¼Œéƒ½æ˜¯è¿™ç§é£æ ¼çš„ç¼–ç¨‹æ¨¡å¼ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;innerHTML æ“ä½œï¼šç®€å•ã€ç²—æš´&lt;&#x2F;li&gt;
&lt;li&gt;è¯ç”Ÿäº† jquery è¿™ä¸€ç‹è€…&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;React æ—¶ä»£: ui = f(state)&lt;&#x2F;p&gt;
&lt;p&gt;è¿›å…¥åˆ°äº†å‡½æ•°å¼ç¼–ç¨‹çš„æ—¶ä»£ï¼Œä¸ä»…WEBï¼Œæ¡Œé¢ GUI ä¹Ÿå¼€å§‹ä»¥ React é£æ ¼ä¸ºä¸»ï¼Œå¦‚ Flutter, Slint ç­‰ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;React Virtual DOM&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;render&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;vdom &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;f&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;state&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;delta &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;diff&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dom&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;vdom&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;patch&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dom&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;delta&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Loop: event -&amp;gt; change state -&amp;gt; render 
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;incremental DOM&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;render&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;delta &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;f&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;state&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dom&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; compute virtual dom side by side dom
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;patch&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dom&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;delta&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Loop: event -&amp;gt; change state -&amp;gt; render 
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
é€šè¿‡åœ¨è®¡ç®— virtual dom æ—¶ï¼Œå³ä¸ DOM è¿›è¡Œæ¯”è¾ƒï¼Œç”±äºåœ¨å¤§éƒ¨ä»½æƒ…å†µä¸‹ï¼Œå˜æ›´ç´§ç´§æ˜¯ä¸€å°éƒ¨ä»½ï¼Œå› æ­¤ï¼Œå¯ä»¥å‡å°‘å†…å­˜çš„å ç”¨ã€‚è¿™ç§æ¨¡å¼æ„Ÿè§‰åº”è¯¥
æ˜¯å¯¹ virtual dom çš„ä¸€ç§æœ‰æ•ˆä¼˜åŒ–ï¼Œä½†åœ¨å®é™…ç”Ÿæ€ä¸­ï¼Œå¥½åƒå¹¶æ²¡æœ‰å¤ªå¤šçš„å®ç°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Lit-Style&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;render&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;static_parts&lt;&#x2F;span&gt;&lt;span&gt;, [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;position&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;state&lt;&#x2F;span&gt;&lt;span&gt;]] = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;f&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;state&lt;&#x2F;span&gt;&lt;span&gt;); &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å¾—ç›Šäº lit template
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;old_state &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dom&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;position&lt;&#x2F;span&gt;&lt;span&gt;];  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; dynamic éƒ¨ä»½ä¼šæœ‰å¤šä¸ª
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;old_state &lt;&#x2F;span&gt;&lt;span&gt;!= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;state&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;update&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;position&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;state&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;   }
&lt;&#x2F;span&gt;&lt;span&gt;} 
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
Lit åŸºäº templateï¼Œç”±äºå¯ä»¥è¯†åˆ« template çš„é™æ€éƒ¨ä»½ï¼ˆä¸ä¼šå˜åŒ–ï¼‰å’ŒåŠ¨æ€éƒ¨ä»½ï¼ˆä¼šå“åº”æ•°æ®çš„å˜åŒ–ï¼‰ï¼Œ
Lit åœ¨ render åï¼Œä¼šè¿½è¸ªåŠ¨æ€éƒ¨ä»½ï¼Œæ£€æŸ¥åŠ¨æ€éƒ¨ä»½ä¾èµ–çš„æ•°æ®æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œåšå‡ºå“åº”çš„æ›´æ–°ã€‚ï¼ˆå‚è§å¾ˆæ—©æœŸæˆ‘ç¼–å†™çš„ä¸€ç¯‡æ–‡ç« ï¼š
&lt;a href=&quot;&#x2F;blog&#x2F;litelement&quot;&gt;LitElement &amp;amp; LitHtml æ¢ç§˜&lt;&#x2F;a&gt; )
ç¼ºç‚¹ï¼šæ¯æ¬¡ render å‡½æ•°è°ƒç”¨éƒ½ä¼šæ‰§è¡Œï¼Œé€ä¸€æ£€æŸ¥åŠ¨æ€éƒ¨ä»½æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªè¿‡ç¨‹è¿˜æ˜¯ç•¥æ˜¾å¤šä½™ã€‚
ä¼˜ç‚¹ï¼šç®—æ˜¯ä¸€ç§ç›¸å¯¹ç®€å•çš„å¹³è¡¡ï¼Œå³æ²¡æœ‰å¤§é‡çš„ virtual dom çš„å†…å­˜å ç”¨(staticéƒ¨ä»½æ˜¯å…±äº«çš„ï¼Œä¸ä¼šé‡å¤å ç”¨å†…å­˜)ï¼Œ
ä¹Ÿç®€åŒ–äº† DOM çš„ diffè¿‡ç¨‹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Solid-Style&#x2F;Svelte-Style&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;render&lt;&#x2F;span&gt;&lt;span&gt;(){
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dom &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;f&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;state&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;createEffect&lt;&#x2F;span&gt;&lt;span&gt;( () &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å¯¹æ¯ä¸€ä¸ªåŠ¨æ€éƒ¨ä»½ï¼Œè¿½è¸ªå…¶ä¾èµ–çš„æ•°æ®
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dom1 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;f1&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;state1&lt;&#x2F;span&gt;&lt;span&gt;);  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å½“å­çŠ¶æ€å‘ç”Ÿåå˜åŒ–æ—¶ï¼Œæ›´æ–° dom1
&lt;&#x2F;span&gt;&lt;span&gt;  } );
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
è¿™ä¸€ç±»çš„æ¡†æ¶ï¼Œåœ¨ Lit çš„åŸºç¡€ä¸Šæ›´è¿›ä¸€æ­¥ï¼šåœ¨åç»­å“åº”å¼å˜åŒ–æ—¶ï¼Œrender å‡½æ•°ä¸å†æ‰§è¡Œï¼Œè€Œæ˜¯æ¯ä¸ªåŠ¨æ€éƒ¨ä»½ç‹¬ç«‹å“åº”ã€‚å½“ç„¶ï¼Œåšåˆ°è¿™ä¸€ç‚¹æ˜¯
ä¾èµ–äºå¯¹æ¨¡ç‰ˆçš„ç¼–è¯‘çš„ã€‚å³å°†æ¨¡ç‰ˆä¸­çš„åŠ¨æ€éƒ¨ä»½ã€é™æ€éƒ¨ä»½åœ¨ç¼–è¯‘æœŸå³è¿›è¡Œäº†åˆ†ç¦»ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„å“åº”å¼ä»£ç ã€‚
å½“ç„¶ï¼Œå¯¹ä¸€äº›å¤æ‚çš„ç»“æ„ï¼Œéœ€è¦è¿›ä¸€æ­¥å±•å¼€å…¶å“åº”å¼æœºåˆ¶ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æœªæ¥å‘å±•é¢„æµ‹
åœ¨ç¼–è¯‘æœŸè¿›è¡Œæ›´å¤šçš„ä¼˜åŒ–ï¼Œä»è€Œé¿å…åœ¨è¿è¡ŒæœŸåšä¸å¿…è¦çš„è®¡ç®—ï¼Œè¿™ä¸ªæ–¹å‘åº”è¯¥è¿˜æœ‰ä¸å°‘ç©ºé—´ï¼Œä¾‹å¦‚ï¼šè¯¸å¦‚ Solid ç›®å‰è®¾è®¡ï¼ˆæˆ‘çš„çŒœæµ‹ï¼‰ï¼Œè¿˜æ˜¯é‡‡ç”¨
åŠ¨æ€çš„ track æ–¹å¼æ¥è·Ÿè¸ªå˜åŒ–çš„ä¾èµ–ï¼Œåœ¨ä¾èµ–å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‡æ–°è®¡ç®—ï¼Œä»é‡æ–°åˆ·æ–°ä¾èµ–å…³ç³»ã€‚è¿™ä¸ªå¯¹äºä¸€äº›é™æ€çš„ä¾èµ–å…³ç³»ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æœŸç›´æ¥ç¡®å®šï¼Œ
è¿›è€Œå‡å°‘ track çš„å¼€é”€ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;æœ€æ–°çš„å‘å±•ï¼Œè¿™ç§ React é£æ ¼ä¹Ÿé€æ­¥çš„å é¢†äº†æ¡Œé¢ GUI çš„é¢†åŸŸï¼Œå¦‚ Flutter, Slint ç­‰ã€‚åœ¨æœ€è¿‘ç•™æ„çš„ä¸€ä¸ªæ¡†æ¶ dioxuslabs ä¸­ï¼Œæ›´æ˜¯æŠŠ
è¿™ä¸ªå¸¦å…¥åˆ° Rust + WASM + (Web&#x2F;TUI&#x2F;GUI)çš„é£æ ¼ä¸­ï¼Œä»¤ Rustacean ä»¬ä¹Ÿæœ‰äº†ä¸€ç§æ–°çš„é€‰æ‹©ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;links&quot;&gt;Links&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;React
&lt;a href=&quot;https:&#x2F;&#x2F;www.slideshare.net&#x2F;slideshow&#x2F;react-preso-v2&#x2F;26589373&quot;&gt;Rethinking Best Practices&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Svelte ç³»åˆ—&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;svelte.dev&#x2F;blog&#x2F;virtual-dom-is-pure-overhead&quot;&gt;Virtual DOM is pure overhead&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;svelte.dev&#x2F;blog&#x2F;svelte-3-rethinking-reactivity&quot;&gt;Rethinking reactivity&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;svelte.dev&#x2F;blog&#x2F;runes&quot;&gt;Rethinking &#x27;Rethinking reactivity&#x27;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;SolidJS&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dev.to&#x2F;ryansolid&#x2F;a-hands-on-introduction-to-fine-grained-reactivity-3ndf&quot;&gt;A Hands-on Introduction to Fine-Grained Reactivity&lt;&#x2F;a&gt;
æˆ‘è®¾è®¡çš„ Variable Manager è®¾è®¡æ–¹æ¡ˆï¼Œåœ¨å¾ˆå¤šç‰¹æ€§ä¸Šï¼Œä¸è¿™ç¯‡æ–‡ç« çš„è®¾è®¡æ€è·¯æ˜¯ä¸€è‡´çš„ã€‚åŒ…æ‹¬ï¼š
&lt;ul&gt;
&lt;li&gt;dynamic dependency trackingã€‚memoization å’Œ effect éƒ½ç±»ä¼¼äºVM ä¸­çš„ bindingã€‚&lt;&#x2F;li&gt;
&lt;li&gt;batched updates. ç±»ä¼¼äº VM ä¸­çš„ transactionã€‚
åªæ˜¯ï¼Œæœ¬æ–‡æ›´ä¸ºå¾®è§‚ï¼Œé¢å‘ synchronousï¼Œè€Œ vm æ›´ä¸ºå®è§‚ï¼Œé¢å‘ asynchronousã€‚
åªæ˜¯ï¼ŒSolidçš„å¤„ç†ä¸­åº”è¯¥ä½¿ç”¨äº† weak referenceï¼Œå½“ effect å›æ”¶æ—¶ï¼Œè¿™ä¸ªè®¡ç®—ä¹Ÿè‡ªåŠ¨é”€æ¯äº†ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dev.to&#x2F;ryansolid&#x2F;building-a-reactive-library-from-scratch-1i0p&quot;&gt;Building a Reactive Library from Scratch&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;angularindepth.com&#x2F;posts&#x2F;1289&#x2F;solidjs-reactivity-to-rendering&quot;&gt;SolidJS: Reactivity to Rendering&lt;&#x2F;a&gt;
&lt;ol&gt;
&lt;li&gt;example1&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;Greeting &lt;&#x2F;span&gt;&lt;span&gt;= (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;props&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&amp;gt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Hi &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;span&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;{props.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;}&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;span&amp;gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;App&lt;&#x2F;span&gt;&lt;span&gt;(() =&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;   const [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;visible&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;setVisible&lt;&#x2F;span&gt;&lt;span&gt;] = createSignal(false),
&lt;&#x2F;span&gt;&lt;span&gt;   [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;setName&lt;&#x2F;span&gt;&lt;span&gt;] = createSignal(&amp;quot;Josephine&amp;quot;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;   return (
&lt;&#x2F;span&gt;&lt;span&gt;      &amp;lt;div onClick={() =&amp;gt; setName(&amp;quot;Geraldine&amp;quot;)}&amp;gt;{
&lt;&#x2F;span&gt;&lt;span&gt;      visible() &amp;amp;&amp;amp; &amp;lt;Greeting name={ name } &#x2F;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;      }&amp;lt;&#x2F;div&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;   );
&lt;&#x2F;span&gt;&lt;span&gt;});
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
ç­‰æ•ˆäºä»£ç :&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;Greeting &lt;&#x2F;span&gt;&lt;span&gt;= (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;props&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;t1 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Text&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;setName&lt;&#x2F;span&gt;&lt;span&gt;] = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;null&lt;&#x2F;span&gt;&lt;span&gt;; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; signal from props.
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;createEffect&lt;&#x2F;span&gt;&lt;span&gt;(() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;t1&lt;&#x2F;span&gt;&lt;span&gt;.data = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$name&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    });
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span&gt;[ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Text&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Hi &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;Span&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;t1&lt;&#x2F;span&gt;&lt;span&gt;) ];
&lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;App &lt;&#x2F;span&gt;&lt;span&gt;= () &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;els &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;computeEffect&lt;&#x2F;span&gt;&lt;span&gt;( ()&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt;( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;visble&lt;&#x2F;span&gt;&lt;span&gt;() ){
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;el &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;Greeting&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;computeEffect&lt;&#x2F;span&gt;&lt;span&gt;(() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;               &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;el&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;propSet&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;());
&lt;&#x2F;span&gt;&lt;span&gt;            });
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span&gt;[ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;el &lt;&#x2F;span&gt;&lt;span&gt;];
&lt;&#x2F;span&gt;&lt;span&gt;       }
&lt;&#x2F;span&gt;&lt;span&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span&gt;[];
&lt;&#x2F;span&gt;&lt;span&gt;       }
&lt;&#x2F;span&gt;&lt;span&gt;   })
&lt;&#x2F;span&gt;&lt;span&gt;   { &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;div &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;      ...&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;els 
&lt;&#x2F;span&gt;&lt;span&gt;     } 
&lt;&#x2F;span&gt;&lt;span&gt;   }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Angular&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;angularindepth.com&#x2F;posts&#x2F;300&#x2F;big-picture-overview&quot;&gt;Change Detection Big Picture - overview&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;angularindepth.com&#x2F;posts&#x2F;301&#x2F;big-picture-operations&quot;&gt;Change Detection Big Picture - Operations&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;angularindepth.com&#x2F;posts&#x2F;302&#x2F;big-picture-unidirectional-data-flow&quot;&gt;Change Detection Big Picture - Unidirectional data flow&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;angularindepth.com&#x2F;posts&#x2F;303&#x2F;big-picture-rendering-cycle&quot;&gt;Change Detection Big Picture - Rendering cycle&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;angularindepth.com&#x2F;posts&#x2F;304&#x2F;running-change-detection-components-tree&quot;&gt;Change Detection Big Picture - Components tree&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Lit çš„åšæ³•&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.cnblogs.com&#x2F;zhazhanitian&#x2F;p&#x2F;14421993.html&quot;&gt;å¢é‡DOMä¸è™šæ‹ŸDOM&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Incremental-DOM https:&#x2F;&#x2F;google.github.io&#x2F;incremental-dom&#x2F;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;raphlinus.github.io&#x2F;rust&#x2F;gui&#x2F;2022&#x2F;05&#x2F;07&#x2F;ui-architecture.html&quot;&gt;Xilem: an architecture for UI in Rust&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Xilem æ˜¯ä¸€ä¸ªå¾ˆç±»ä¼¼äº Flutter&#x2F;SwiftUI çš„ Rust GUI æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒä¹Ÿæ˜¯ä¸€ä¸ªå¢é‡æ›´æ–°çš„æ¶æ„ï¼Œåœ¨ &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;linebender&#x2F;xilem&#x2F;blob&#x2F;main&#x2F;ARCHITECTURE.md&quot;&gt;Xilemæ¶æ„&lt;&#x2F;a&gt;
ä¸­æœ‰å¾ˆå¤šè¿™æ–¹é¢çš„æ€è€ƒï¼Œå¯ä»¥ä½œä¸ºå¯¹ UI çš„å¢é‡æ›´æ–°çš„å‚è€ƒã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>DuckDB æºç é˜…è¯»ä¹‹ç›¸å…³é“¾æ¥</title>
        <published>2024-09-10T00:00:00+00:00</published>
        <updated>2024-09-10T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/duckdb-links/"/>
        <id>https://wangzaixiang.github.io/blog/duckdb-links/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/duckdb-links/">&lt;p&gt;æœ€è¿‘ï¼Œåœ¨è¯„ä¼°å¼•å…¥ä¸€ä¸ª SQL æ‰§è¡Œå¼•æ“ï¼Œä»¥å–ä»£åˆ†æäº§å“å¯¹ä¸Šæ¸¸æ•°æ®åº“çš„ç‰¹æ€§çš„ä¾èµ–ï¼Œè¿™äº›å·®å¼‚ç»™äº§å“å¸¦æ¥äº†æ˜¾è‘—çš„å›°éš¾ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;MySQL ä¸æ”¯æŒ FullJoin&lt;&#x2F;li&gt;
&lt;li&gt;MySQL çš„çª—å£å‡½æ•°ä¸­ä¸æ”¯æŒ &lt;code&gt;range expr preceding and ...&lt;&#x2F;code&gt;ï¼Œ æ— æ³•æ‰§è¡Œå¦‚ä¸‹çš„SQLï¼š(åŒæœŸç´¯ç§¯å€¼)&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt; order_date, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(amount) as x0, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(amount)) over (
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;order by&lt;&#x2F;span&gt;&lt;span&gt; order_date 
&lt;&#x2F;span&gt;&lt;span&gt; range between 
&lt;&#x2F;span&gt;&lt;span&gt;   date_diff(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;day&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, makeDate( year(order_date)-&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;), order_date) preceding 
&lt;&#x2F;span&gt;&lt;span&gt; and 
&lt;&#x2F;span&gt;&lt;span&gt;   date_diff(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;second&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, makeDate( year(order_date)-&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;, month(order_date), day(order_date) ), order_date) preceding
&lt;&#x2F;span&gt;&lt;span&gt; ) as X1
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; orders
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by&lt;&#x2F;span&gt;&lt;span&gt; order_date;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;ClickHouse å¯¹çª—å£å‡½æ•°çš„æ”¯æŒæä¸ºä¸æ ‡å‡†ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è€ƒè™‘å¼•å…¥ polars æˆ–è€… duckdb, ä¹‹å‰ä¼šåå‘äº polarsï¼ˆä¸»è¦æ˜¯ä¸ªäººå¯¹C++å·²ç»ç”Ÿç–ï¼Œå¯¹Rustçš„æ„Ÿè§‰è¦è‰¯å¥½å¾ˆå¤šï¼‰ï¼Œä½†åœ¨å¯¹æ¯”çª—å£å‡½æ•°çš„èƒ½åŠ›æ–¹é¢
è¿˜æ˜¯è¦æ¬ ç¼ºå¾ˆå¤šï¼Œè€Œ duckdb åœ¨è¿™æ–¹é¢çš„ä½“éªŒè¦å¥½å¾ˆå¤šï¼Œæ‰€ä»¥ç›®å‰æ›´å€¾å‘äºé€‰æ‹© duckdbã€‚è¿™æ ·ï¼Œå°±å¾ˆæœ‰å¿…è¦ç†Ÿæ‚‰ duckdb çš„æºä»£ç ã€‚è¿™é‡Œæ”¶é›†ç½‘ä¸Šä¸
duckdb ç›¸å…³çš„æºä»£ç é˜…è¯»æ–‡æ¡£ï¼Œä¹Ÿç»™è‡ªå·±ç«‹ä¸€ä¸ªflagï¼Œåœ¨æ¥ä¸‹é‡Œçš„æ—¶é—´é‡Œï¼Œé‡ç‚¹é˜…è¯»ä¸€ä¸‹ duckdb çš„æºä»£ç ï¼Œé¡ºä¾¿è¡¥ä¸€è¡¥ C++ çš„åŠŸè¯¾ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¼•å…¥ä¸€ä¸ª SQL æ‰§è¡Œå¼•æ“çš„ç›®çš„ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å±è”½ä¸Šæ¸¸æ•°æ®æºçš„ç‰¹æ€§é™åˆ¶ã€‚æä¾›æ›´å¤šã€ä¸”æ›´ä¸€è‡´çš„SQLåˆ†æèƒ½åŠ›ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åŸºäºå‘é‡è®¡ç®—ã€ä¼˜åŒ–çš„æ‰§è¡Œæœºåˆ¶ï¼Œæä¾›ç›¸æ¯”ä¼ ç»Ÿ OLTP æ›´å¿«é€Ÿçš„æŸ¥è¯¢èƒ½åŠ›ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¿…è¦æ—¶ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„åˆ†æéœ€è¦ï¼Œè¿›è¡Œé’ˆå¯¹æ€§çš„ä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œå¸¸è§çš„å°è®¡ã€åˆè®¡ç­‰åŠŸèƒ½ï¼Œä½¿ç”¨ SQL å®ç°æ—¶ï¼Œéœ€è¦æ‰§è¡Œå¤šæ¡SQLï¼Œ
å¯ä»¥å¼€å‘æ‰©å±•è¿›è¡Œé’ˆå¯¹æ€§çš„ä¼˜åŒ–ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;duckdb-yuan-dai-ma-pou-xi-wen-dang-shou-ji&quot;&gt;DuckDB æºä»£ç å‰–æ æ–‡æ¡£æ”¶é›†&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¼ å»º:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;402355976&quot;&gt;DuckDB Push-Based Execution Model&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;696147374&quot;&gt;DuckDB Query Optimizer&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Focus&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;374627729&quot;&gt;DuckDBï¼šå¼€ç¯‡&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;382131436&quot;&gt;DuckDB: Row-Group Based Storage&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;376178277&quot;&gt;DuckDBï¼šæ¥å£ä¸ç¤ºä¾‹&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;franzcheng&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;644095258&quot;&gt;DuckDBæºç é˜…è¯»02â€”â€”å…¬å…±å­è¡¨è¾¾å¼æ¶ˆé™¤&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;652394118&quot;&gt;DuckDBæºç é˜…è¯»â€”â€”Filter pullup&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;644039061&quot;&gt;DuckDBæºç é˜…è¯»01â€”â€”é‡å¤èšåˆå‡½æ•°å»é™¤&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;çº¢æ˜Ÿé—ªé—ª&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;628391818&quot;&gt;DuckDB Sortä»£ç é˜…è¯»å’Œåˆ†æ&lt;&#x2F;a&gt; é‡ç‚¹å›´ç»• Sortï¼Œåé‡äº Pipeline + Executor&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;664312966&quot;&gt;æ€æ ·æŠŠæ•°æ®åº“æ’åºåšåˆ°å…¨çƒç¬¬ä¸€&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;628507841&quot;&gt;DuckDBçš„å˜é•¿Sortå®ç°&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;628393152&quot;&gt;DuckDBçš„Mergeå®ç°&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Others&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;679569277&quot;&gt;DuckDBå†…å­˜æ ¼å¼ä»£ç è¯¦è§£ï¼ˆä¸€ï¼‰&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å®˜æ–¹&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;DuckDB internals &lt;a href=&quot;https:&#x2F;&#x2F;15721.courses.cs.cmu.edu&#x2F;spring2023&#x2F;slides&#x2F;22-duckdb.pdf&quot;&gt;Slides&lt;&#x2F;a&gt;,
&lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=bZOvAKGkzpQ&quot;&gt;Video&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Push-Based Execution In DuckDB &lt;a href=&quot;https:&#x2F;&#x2F;dsdsd.da.cwi.nl&#x2F;slides&#x2F;dsdsd-duckdb-push-based-execution.pdf&quot;&gt;Slides&lt;&#x2F;a&gt;,
&lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=1kDrPgRUuEI&quot;&gt;Video&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>æ•°æ®åˆ†æä¹‹è¡¨è¾¾å¼è¯­è¨€ï¼šDAX</title>
        <published>2024-09-04T00:00:00+00:00</published>
        <updated>2024-09-04T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/dax/"/>
        <id>https://wangzaixiang.github.io/blog/dax/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/dax/">&lt;h1 id=&quot;qian-yan&quot;&gt;å‰è¨€&lt;&#x2F;h1&gt;
&lt;p&gt;è®¡åˆ’æ•´ç†æœ‰å…³â€œæ•°æ®åˆ†æè¡¨è¾¾å¼è¯­è¨€â€çš„ç³»åˆ—æ–‡æ¡£ï¼Œè®¡åˆ’åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;MDX(Multi-Dimensional Data Expression) è¡¨è¾¾å¼è¯­è¨€&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;DAX(Data Analysis Expressions) è¡¨è¾¾å¼è¯­è¨€&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Tabula è¡¨è¾¾å¼è¯­è¨€&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.tableau.com&#x2F;zh-cn&#x2F;blog&#x2F;LOD-expressions#:~:text=Tableau&quot;&gt;15 å¤§è¯¦ç»†çº§åˆ«è¡¨è¾¾å¼&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;åœ¨æ¯ä¸€ä¸ªæ•°æ®åˆ†æäº§å“çš„èƒŒåï¼Œå¿…ç„¶æœ‰ä¸€ä¸ªè¡¨è¾¾å¼è¯­è¨€ï¼Œç”¨äºå¯¹ä¸€äº›å¤æ‚çš„ä¸šåŠ¡åˆ†æï¼Œå°¤å…¶æ˜¯æŒ‡æ ‡ï¼ˆMeasureï¼‰è¿›è¡Œè¡¨è¾¾ï¼Œå¹¶æä¾›ä¸€å¥—ä¼˜åŒ–çš„è®¡ç®—å¼•æ“ï¼Œ
è¾¾æˆå¯¹æ•°æ®çš„å¿«é€Ÿåˆ†æã€‚ä¾‹å¦‚ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è®¡ç®—åŸå§‹æŒ‡æ ‡åœ¨æŸ¥è¯¢ç»“æœä¸­çš„æ’åã€å æ¯”&lt;&#x2F;li&gt;
&lt;li&gt;è®¡ç®—åŸå§‹æŒ‡æ ‡çš„æ—¶é—´å¿«é€Ÿè®¡ç®—å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;åŒæœŸå€¼ã€åŒæ¯”å¢é•¿ã€åŒæ¯”å¢é•¿ç‡&lt;&#x2F;li&gt;
&lt;li&gt;ä¸ŠæœŸå€¼ã€ä¸ŠæœŸå¢é•¿ã€ä¸ŠæœŸå¢é•¿ç‡&lt;&#x2F;li&gt;
&lt;li&gt;å¹´ç´¯ç§¯ã€æœˆç´¯ç§¯&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;TopN è®¡ç®—ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;15å¤§è¯¦ç»†çº§åˆ«è¡¨è¾¾å¼ä¸­çš„å„ç§è®¡ç®—ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;åœ¨å®é™…ä¸šåŠ¡åˆ†æä¸­ï¼Œä¸Šè¿°çš„è¿™äº›åˆ†æéœ€æ±‚å…¶å®æ˜¯éå¸¸å¸¸è§çš„ï¼Œè™½ç„¶è¿™äº›éƒ½å¯ä»¥åœ¨ SQL ä¸­è¿›è¡Œè®¡ç®—ï¼Œä½†å³ä½¿æ˜¯ç®€å•çš„æ’åã€å æ¯”ä¹Ÿä¼šéœ€è¦ç¼–å†™å¤æ‚çš„
SQL è¯­å¥ï¼Œè€Œä¸”ï¼Œå¤æ‚çš„ SQL è¯­å¥çš„å¯è¯»æ€§ä¹Ÿæ˜¯ç›¸å½“ç³Ÿç³•çš„ã€‚å¯¹å¤æ‚çš„ SQL è¯­å¥ï¼Œå…¶æ‰§è¡Œæ€§èƒ½ä¹Ÿæœªå¿…æ˜¯æœ€ä½³çš„ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å› æ­¤ï¼Œä¸€ä¸ªè¡¨è¾¾å¼è¯­è¨€ï¼Œä¸»è¦å°±æ˜¯æ‰¿è½½å¦‚ä¸‹ç›®æ ‡ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è®¡ç®—çš„è¡¨è¾¾èƒ½åŠ›ã€‚å°½å¯èƒ½å…·å¤‡æœ‰å®Œå¤‡çš„è®¡ç®—èƒ½åŠ›ï¼Œèƒ½å¤Ÿè¡¨è¾¾å„ç§å¤æ‚çš„è®¡ç®—é€»è¾‘ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è¡¨è¾¾å¼è¯­è¨€çš„å¯è¯»æ€§ã€ç®€å•æ€§ã€‚è¶Šé«˜æŠ½è±¡çš„è¡¨è¾¾å¼è¯­è¨€ï¼Œå¯ä»¥å°†å¤æ‚çš„è®¡ç®—é€»è¾‘ç®€å•åŒ–ã€‚ä¾¿äºç”¨æˆ·ç†è§£ã€ç¼–å†™ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è®¡ç®—çš„é«˜æ•ˆæ€§ã€‚æ¯•ç«Ÿï¼Œæ•°æ®åˆ†æå¾€å¾€é¢å¯¹çš„æ˜¯ä¸€ä¸ªå·¨å¤§çš„æ•°æ®é›†ï¼Œå¦‚æœè®¡ç®—éå¸¸è€—æ—¶ï¼Œé‚£ä¹ˆå°±ä¸å®ç”¨äº†ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;dax-data-analysis-expressions-biao-da-shi-yu-yan&quot;&gt;DAX(Data Analysis Expressions) è¡¨è¾¾å¼è¯­è¨€&lt;&#x2F;h1&gt;
&lt;p&gt;DAX æ˜¯ Microsoft PowerBI äº§å“çš„è¡¨è¾¾å¼è¯­è¨€ï¼Œä¹Ÿæ˜¯ PowerBI çš„äº§å“çµé­‚ã€‚äº†è§£å®ƒçš„æƒå¨ä¹¦ç±æ˜¯ã€ŠThe Definitive Guide to DAXã€‹ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æˆ‘å¯¹ PowerBi å¹¶æ²¡æœ‰å¤ªå¤šçš„å®æˆ˜ç»éªŒï¼Œå¯¹å…¶çš„ç†è§£ä¸»è¦æ˜¯åœ¨è®¾è®¡æ•°æ®åˆ†æäº§å“æ—¶ï¼Œç»å¸¸éœ€è¦å¯¹ä¸€äº›åˆ†æé€»è¾‘ï¼Œå‚è€ƒ PowerBI çš„æ¦‚å¿µæ—¶ï¼Œ
å¯¹ DAX è¿›è¡Œé’ˆå¯¹æ€§çš„åˆ†æã€æ£æµ‹ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;power-bi-zhong-de-shai-xuan-fang-xiang&quot;&gt;Power BI ä¸­çš„ç­›é€‰æ–¹å‘&lt;&#x2F;h2&gt;
&lt;p&gt;
&lt;img src=&quot;https:&amp;#x2F;&amp;#x2F;wangzaixiang.github.io&amp;#x2F;processed_images&amp;#x2F;è¡¨å…³ç³»æ¨¡å‹.fab5ed83851c9058.png&quot; &#x2F;&gt;
ç­›é€‰æ–¹å‘æ˜¯ PowerBI ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;é€‰å®šç»™å®š &lt;code&gt;æ—¥æœŸ&lt;&#x2F;code&gt; æ—¶ï¼ŒæŒ‰ç…§ä¸Šå›¾ï¼Œä¼šè‡ªåŠ¨çš„ç­›é€‰ï¼š&lt;code&gt;é”€å”®&lt;&#x2F;code&gt;ã€&lt;code&gt;äº§å“&lt;&#x2F;code&gt;ï¼Œè€Œä¸å½±å“ &lt;code&gt;å®¢æˆ·&lt;&#x2F;code&gt;ã€&lt;code&gt;äº§å“åˆ†ç±»&lt;&#x2F;code&gt; çš„æ•°æ®çš„å¯è§æ€§ã€‚
ï¼ˆä¸Šå›¾ä¸­é”€å”® å’Œ äº§å“ï¼‰è®¾ç½®äº†åŒå‘ç­›é€‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨å¤šç»´æŸ¥è¯¢æ—¶ï¼Œç»´åº¦å°±æ˜¯ç­›é€‰æ¡ä»¶ï¼Œä½œä¸ºç»“æœï¼Œç­›é€‰å‡ºæ¥çš„æ•°æ®ï¼ˆå¤šè¡Œï¼‰æ˜¯ä¸€ä¸ªç»“æœé›†ï¼Œåœ¨è¿™ä¸ªç»“æœé›†ä¸Šé€šè¿‡æŸä¸ªå‡½æ•°è¿ç®—ï¼Œå¾—å‡ºçš„ä¸€ä¸ªå€¼
ç§°ä¹‹ä¸ºåº¦é‡ï¼ˆMeasureï¼‰ã€‚æ‰€ä»¥ï¼Œåº¦é‡æ˜¯ä¸€ä¸ªé›†åˆä¸Šçš„å‡½æ•°ï¼Œè€Œç»´åº¦åˆ™æ˜¯è¿™ä¸ªé›†åˆçš„ç­›é€‰æ¡ä»¶ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸€èˆ¬çš„ï¼Œç»´è¡¨ ä¸ æ˜¯äº‹å®è¡¨ä¹‹é—´çš„å…³ç³»æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œå³ä¸€ä¸ªç»´è¡¨çš„ä¸€è¡Œå¯¹åº”å¤šä¸ªäº‹å®è¡¨çš„è¡Œã€‚
ä¸€ä¸ªç»´åº¦è¡¨çš„ä¸€è¡Œå¯¹åº”å¤šä¸ªäº‹å®è¡¨çš„è¡Œï¼Œè¿™ä¸ªæ˜¯é»˜è®¤çš„ç­›é€‰æ–¹å‘ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Power BI æ”¯æŒåŒå‘ç­›é€‰ï¼Œå³ä»å¤šæ–¹å‘ä¸€æ–¹çš„ç­›é€‰ã€‚ä¸ä¸€æ–¹å¯¹å¤šæ–¹çš„ç­›é€‰ä¸åŒï¼ˆä¸€ä¸ªäº‹å®æ€»æ˜¯æœ‰å”¯ä¸€çš„ç»´åº¦å€¼ï¼‰ï¼Œå¤šæ–¹å¯¹ä¸€æ–¹çš„ç­›é€‰ï¼Œæ„å‘³ç€
ä¸€ä¸ªäº‹å®çš„ç»´åº¦æœ‰å¤šä¸ªå€¼ï¼Œä¾‹å¦‚ï¼šä¸€ä¸ªç”¨æˆ·æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œä¸€ä¸ª SPU å¯ä»¥æœ‰å¤šä¸ªé¢œè‰²ã€‚å½“ä½ ä½¿ç”¨æ ‡ç­¾ã€é¢œè‰²ç­›é€‰ç”¨æˆ·ã€SPUæ—¶ï¼Œå°±æ˜¯å¤šæ–¹å¯¹ä¸€æ–¹çš„ç­›é€‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æŒ‰ç…§å›¾ç¤ºçš„æ–¹å¼ï¼Œæ˜¯æ¯”è¾ƒå¥½ç†è§£ä¸€ä¸ªç»´è¡¨çš„å½±å“èŒƒå›´ï¼ˆå³å…¶ç­›é€‰çš„èŒƒå›´ï¼‰ã€æˆ–è€…ä¸€ä¸ªäº‹å®è¡¨çš„è¾¹ç•Œï¼ˆå³å“ªäº›ç»´åº¦ä¼šå½±å“è¿™ä¸ªäº‹å®è¡¨çš„èŒƒå›´ï¼‰
&lt;ul&gt;
&lt;li&gt;åœ¨æ¨¡å‹ä¸­ï¼Œå¹¶ä¸å­˜åœ¨é‚£ä¸ªè¡¨æ˜¯ç»´è¡¨ã€é‚£ä¸ªè¡¨æ˜¯äº‹å®è¡¨çš„æ¦‚å¿µï¼Œç»´è¡¨å’Œäº‹å®è¡¨æ˜¯æ ¹æ®åœºæ™¯æ¥ç¡®å®šçš„&lt;&#x2F;li&gt;
&lt;li&gt;é”€å”®ä¸äº§å“çš„åŒå‘ç­›é€‰ï¼Œæ„å‘³ç€ä»¥é”€å”®ä¸ºäº‹å®è¡¨æ˜¯ï¼Œäº§å“æ˜¯ç»´åº¦è¡¨ï¼Œåä¹‹ï¼Œä»¥äº§å“ä¸ºäº‹å®è¡¨æ—¶ï¼Œé”€å”®æ˜¯ç»´åº¦è¡¨ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨PowerBIçš„æ¨¡å‹å›¾ä¸­ï¼Œé¡ºç€ç®­å¤´çš„æ–¹å‘ï¼ˆç­›é€‰æ–¹å‘ï¼‰ï¼Œå°±æ˜¯ç»´è¡¨çš„å½±å“èŒƒå›´ï¼Œåä¹‹æ‰€æœ‰å¯ä»¥é¡ºç€ç®­å¤´è§¦è¾¾äº‹å®è¡¨çš„éƒ½æ˜¯è¿™ä¸ªè¡¨çš„ç»´è¡¨ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;filter-context-vs-row-context&quot;&gt;Filter Context vs Row Context&lt;&#x2F;h2&gt;
&lt;p&gt;DAX ä¸­æœ‰ä¸¤ç§ä¸Šä¸‹æ–‡ï¼šFilter Context å’Œ Row Contextã€‚ è¿™ä¸ªæ˜¯å¾ˆå®¹æ˜“æ··æ·†çš„ï¼Œæˆ–è€…é”™è¯¯ä½¿ç”¨çš„ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;column reference and measure reference.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;column reference: &lt;code&gt;Sales[Quantity]&lt;&#x2F;code&gt; or &lt;code&gt;[Quantity]&lt;&#x2F;code&gt; in Sales Context(æ¯”å¦‚åœ¨ Sales è¡¨çš„è®¡ç®—åˆ—å®šä¹‰ä¸­)&lt;&#x2F;li&gt;
&lt;li&gt;measure reference: &lt;code&gt;[Sales Amount]&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;table reference: &lt;code&gt;Sales&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot; checked=&quot;&quot;&#x2F;&gt;
column reference ä¸ measure reference å¦‚æœæœ‰æ­§ä¹‰ï¼Œæ€ä¹ˆå¤„ç†ï¼ŸDAX ä¼šä¼˜å…ˆè§£æä¸º column reference&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Filter Context: ç”¨äºå¯¹å½“å‰çš„æ•°æ®èŒƒå›´è¿›è¡Œç­›é€‰ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Filter Context æ˜¯å¯¹æ•´ä¸ªæ¨¡å‹æœ‰æ•ˆçš„ï¼Œå¦‚æœæœ‰ä¸€ä¸ªç­›é€‰æ¡ä»¶ &lt;code&gt;[table1].[col1] = value1&lt;&#x2F;code&gt;, é‚£ä¹ˆï¼Œè¿™ä¸ªæ¡ä»¶ä¼šç­›é€‰ table1 ä¸­æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œ
å¹¶æ ¹æ®æ¨¡å‹ä¸­çš„ç­›é€‰æ–¹å‘ï¼Œä¼ é€’åˆ°å…¶ä»–è¡¨ä¸­ã€‚å¯ä»¥ç®€å•çš„ç†è§£ï¼Œé€šè¿‡ Filter Context, ä¸€ä¸ªæ¨¡å‹çš„æ•°æ®å¯è§èŒƒå›´è¢«åŠ¨æ€çš„è°ƒæ•´äº†ï¼Œè¿™æ—¶ï¼Œä»»ä½•ä¸€ä¸ªè¡¨ä¸­
çš„æ•°æ®å¹¶ä¸æ˜¯åŸå§‹è¡¨ä¸­çš„æ•°æ®ï¼Œè€Œæ˜¯ç»è¿‡ç­›é€‰çš„æ•°æ®ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;evaluation
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;table reference&lt;&#x2F;code&gt; åœ¨ filter context ä¸­æ±‚å€¼&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;measure reference&lt;&#x2F;code&gt; åœ¨ filter context ä¸­æ±‚å€¼&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;åˆ›å»º&#x2F;ä¿®æ”¹ Filter Context
&lt;ul&gt;
&lt;li&gt;åœ¨ä¸€ä¸ªåˆ†æè¡¨æ ¼ä¸­ï¼Œæ¯ä¸ªå•å…ƒæ ¼éƒ½æœ‰è‡ªå·±çš„ Filter Contextï¼Œä¸€èˆ¬ç”±è¡Œï¼Œåˆ—ï¼Œè¿‡æ»¤å™¨ç­‰å†³å®šã€‚å³ä½¿ä¸åŒçš„å•å…ƒæ ¼ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªè®¡ç®—å…¬å¼ï¼Œä½†ç”±äº
Filter Context çš„ä¸åŒï¼Œè®¡ç®—ç»“æœä¹Ÿä¼šä¸åŒã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è¯¸å¦‚ ALL, ALLEXCEPT, ALLSELECTED ç­‰è¡¨å‡½æ•°ï¼Œå¯ä»¥ç”¨äºä¿®æ”¹ Filter Contextã€‚
&lt;ul&gt;
&lt;li&gt;ALL(table) å‡½æ•°ï¼Œæ¸…é™¤ table ä¸Šçš„æ‰€æœ‰ç­›é€‰å™¨&lt;&#x2F;li&gt;
&lt;li&gt;ALL(table, column) å‡½æ•°ï¼Œæ¸…é™¤ table ä¸Šçš„é™¤äº† column åˆ—çš„æ‰€æœ‰ç­›é€‰å™¨&lt;&#x2F;li&gt;
&lt;li&gt;ALLEXCEPT(table, column1, column2, ...) å‡½æ•°ï¼Œæ¸…é™¤ table ä¸Šçš„é™¤äº† column1, column2, ... åˆ—çš„æ‰€æœ‰ç­›é€‰å™¨&lt;&#x2F;li&gt;
&lt;li&gt;ALLSELECTED(table) å‡½æ•°ï¼Œæ¸…é™¤ table ä¸Šçš„æ‰€æœ‰ç­›é€‰å™¨(åŠ¨æ€çš„ç­›é€‰å™¨)ï¼Œä½†ä¿ç•™ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©çš„ç­›é€‰å™¨ï¼ˆåŸå§‹çš„ç­›é€‰å™¨ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;RelatedTable( table ) å°† å½“å‰ row context æ·»åŠ åˆ° table çš„ filter ä¸­ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;CALCULATE(expr, filter1, filter2, filter3) å‡½æ•°ï¼Œå¯ä»¥ç”¨äºä¿®æ”¹ Filter Contextï¼Œå¹¶åœ¨æ–°çš„ä¸Šä¸‹æ–‡ä¸­è®¡ç®— expr è¡¨è¾¾å¼çš„å€¼ã€‚
&lt;ul&gt;
&lt;li&gt;boolean filter: &lt;code&gt;[column] = value&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;table filter: &lt;code&gt;filter(table, expr)&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;filter modifier:
&lt;ul&gt;
&lt;li&gt;ALLã€ALLEXCEPT&lt;&#x2F;li&gt;
&lt;li&gt;REMOVEFILTERS(table, column*)&lt;&#x2F;li&gt;
&lt;li&gt;KEEPFILTERS(expr) ä¿ç•™å½“å‰çš„ç­›é€‰å™¨ï¼Œä½†å¯ä»¥åˆå¹¶å€¼ï¼Œä¸åŒäº boolean filter,é‚£ä¸ªæ˜¯æ›¿æ¢ç­›é€‰å™¨ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;USERELATIONSHIP&#x2F;CROSSFILTER -- ä¿®æ”¹è¡¨ç­›é€‰å…³ç³»&lt;&#x2F;li&gt;
&lt;li&gt;Calculate ä¼šå°†å½“å‰çš„ RowContext è½¬æ¢ä¸º FilterContextã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;FILTER å‡½æ•°è‡ªèº«å¹¶ä¸ä¿®æ”¹ Filter Context, è€Œæ˜¯ç”Ÿæˆä¸€ä¸ªè®¡ç®—è¡¨ã€‚ä½œä¸º Calculate çš„å‚æ•°æ—¶ï¼Œå…¶ä¼šä¿®æ”¹åŸå§‹è¡¨çš„æ•°æ®èŒƒå›´ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
è¡¨å‡½æ•°æ˜¯å¦æœ‰2ç§è¯­ä¹‰ï¼šå…¶ä¸€ä»£è¡¨ä¸€ä¸ªè¡¨çš„æ•°æ®ï¼Œå…¶äºŒä»£è¡¨ä¿®æ”¹åœ¨è¿™ä¸ªè¡¨ä¸Šçš„ filter&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Every measure reference always has an implicit CALCULATE surrounding it.
&lt;ul&gt;
&lt;li&gt;å®Œæˆäº†å°†å½“å‰ Row Context è½¬åŒ–ä¸º Filter Contextï¼Œä»è€Œå½±å“ Measure çš„æ±‚å€¼&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;ä¸¤ç§ filter
&lt;ul&gt;
&lt;li&gt;column filter: æ›´é«˜æ•ˆ&lt;&#x2F;li&gt;
&lt;li&gt;table filter: a calculated table&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Row Context&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»º RowContext
&lt;ul&gt;
&lt;li&gt;è®¡ç®—åˆ—åœ¨ RowContext ä¸­æ±‚å€¼&lt;&#x2F;li&gt;
&lt;li&gt;SUMX ç­‰ iterate å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ RowContext&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;column reference &lt;code&gt;tab[col]&lt;&#x2F;code&gt; å¯ä»¥åœ¨ RowContext ä¸­æ±‚å€¼
&lt;ul&gt;
&lt;li&gt;å¦‚æœå­˜åœ¨ 1ä¸ª &lt;code&gt;tab&lt;&#x2F;code&gt; çš„ row contextï¼Œåˆ™åœ¨å…¶ä¸­æ±‚å€¼&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœå­˜åœ¨ å¤šä¸ª &lt;code&gt;tab&lt;&#x2F;code&gt; çš„ row contextï¼Œåˆ™åœ¨ latest çš„ row context ä¸­æ±‚å€¼&lt;&#x2F;li&gt;
&lt;li&gt;å¦åˆ™æ— æ³•æ±‚å€¼&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨æŸä¸ªæ±‚å€¼ç‚¹ï¼Œå¯èƒ½å­˜åœ¨ 0..N ä¸ª RowContext å’Œ 1 ä¸ª FilterContextã€‚
&lt;ul&gt;
&lt;li&gt;EARLIER(column, number) å‡½æ•°ï¼Œå¯ä»¥åœ¨ RowContext(-number) ä¸­çš„ column åˆ—çš„å€¼&lt;&#x2F;li&gt;
&lt;li&gt;EALIST(column)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;æ¯ä¸ª row context çš„èŒƒå›´æ˜¯æ¨¡å‹ä¸­çš„å•ä¸ªè¡¨ï¼Œä¸ä¼šæ‰©å±•åˆ°å…¶ä»–è¡¨å»
&lt;ul&gt;
&lt;li&gt;Related(column) ä¸ row context ç›¸å…³çš„ columnï¼Œé€‚åˆäº N:1 çš„å…³è”å­—æ®µ&lt;&#x2F;li&gt;
&lt;li&gt;RelatedTable(table) ä¸ row context ç›¸å…³çš„ tableï¼Œé€‚åˆäº 1: N çš„å…³è”ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot; checked=&quot;&quot;&#x2F;&gt;
RelatedTable(table) è¿™é‡Œçš„ table æ˜¯å¦ä¼šå—å½“å‰çš„ filter context å½±å“? Y&lt;&#x2F;li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
RelatedTable(table) è¿™é‡Œæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„è®¡ç®—è¡¨ï¼Œè¿˜æ˜¯æ›´æ–°äº† filter context?&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Calculate ä¼šå°†å½“å‰çš„ RowContext è½¬æ¢ä¸º FilterContextï¼Œå¹¶æ¶ˆé™¤æ‰æ‰€æœ‰çš„ RowContext.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å…¶å®ï¼Œä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹å¼ï¼Œæ˜¯æ³¨æ˜ DAX å‡½æ•°çš„æ¯ä¸ªå‚æ•°çš„æ±‚å€¼ä¸Šä¸‹æ–‡ï¼Œæ˜¯ Filter Context è¿˜æ˜¯ Row Contextï¼Œè¿™æ ·å°±å¯ä»¥è®©è¿™ä¸ªæ¦‚å¿µ
æ›´ä¸ºæ¸…æ™°äº†ã€‚æ¯•ç«Ÿï¼Œåªæœ‰å°‘æ•°çš„å‡½æ•°ä¼šåˆ›å»ºæ–°çš„ä¸Šä¸‹æ–‡ï¼Œå¤§éƒ¨åˆ†çš„å‡½æ•°éƒ½æ˜¯åœ¨å·²æœ‰çš„ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œè®¡ç®—ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;TODO: ä¸¾ä¾‹è¯´æ˜(è¡¥å……ä¸€ä¸ªä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ° å“ªäº›æ˜¯åœ¨ Filter Context ä¸­è®¡ç®—ï¼Œå“ªäº›æ˜¯åœ¨ Row Context ä¸­è®¡ç®—,
ä»¥åŠå¦‚ä½•é€šè¿‡ CALCULATE å‡½æ•°ï¼Œåˆ›å»ºæ–°çš„ Filter Contextã€‚ï¼‰
ç¤ºä¾‹1:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- åœ¨ SUMX çš„ caller ä¸­ï¼Œæœ‰ä¸€ä¸ª Filter Contextï¼Œè¿™é‡Œå‡è®¾ä¸º fc0, ä¹Ÿå¯èƒ½æœ‰å…¶ä»–çš„ Row Contextï¼Œè¿™é‡Œå‡è®¾ä¸º rc0
&lt;&#x2F;span&gt;&lt;span&gt;SUMX (
&lt;&#x2F;span&gt;&lt;span&gt;    Sales, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- åœ¨ fc0 ä¸­è®¡ç®—è¡¨
&lt;&#x2F;span&gt;&lt;span&gt;    Sales[Net Price] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;* &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- SUMX å‡½æ•°ä¼šç”Ÿæˆä¸€ä¸ªRowContextï¼Œè¿™é‡Œå‡è®¾ä¸º rc1, è¿™ä¸ªè¡¨è¾¾å¼çš„æ±‚å€¼ä¸Šä¸‹æ–‡ä¸ºï¼š fc0 + rc0 + rc1
&lt;&#x2F;span&gt;&lt;span&gt;                           &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- Sales[Net Price] ä¼šåœ¨ rc1 ä¸­æ±‚å€¼ã€‚
&lt;&#x2F;span&gt;&lt;span&gt;)   
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ç¤ºä¾‹2:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- fc0 , rc0
&lt;&#x2F;span&gt;&lt;span&gt;SUMX (
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Product Category&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- eval in fc0, and will create new Row Context rc1 for each row in &amp;#39;Product Category&amp;#39;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- å¯¹ &amp;#39;Product Category&amp;#39; ä¸­çš„æ¯ä¸€è¡Œåˆ›å»ºä¸€ä¸ª Row Context: rc1
&lt;&#x2F;span&gt;&lt;span&gt;    SUMX ( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- eval in fc0 + rc0 + rc1(Product Category)
&lt;&#x2F;span&gt;&lt;span&gt;        RELATEDTABLE ( &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Product&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39; ), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- eval in rc1
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;--  å¯¹æ¯ä¸€è¡Œ Product, åˆ›å»º: rc2(Product)
&lt;&#x2F;span&gt;&lt;span&gt;        SUMX ( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- eval in fc0 + rc0 + rc1(Product Category) + rc2(Product)
&lt;&#x2F;span&gt;&lt;span&gt;            RELATEDTABLE ( Sales ) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- eval in rc2(Product) 
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- å¯¹æ¯ä¸€è¡Œ Sales, åˆ›å»º: rc3(Sales), ä¸Šä¸‹æ–‡ä¸º: fc0 + rc0 + rc1(Product Category) + rc2(Product) + rc3(Sales)
&lt;&#x2F;span&gt;&lt;span&gt;            Sales[Quantity] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- eval in rc3(Sales)
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;* &lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Product&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;[Unit Price] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- eval in rc2(Product)
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;* &lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Product Category&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;[Discount] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- eval in rc1(Product Category)
&lt;&#x2F;span&gt;&lt;span&gt;        )
&lt;&#x2F;span&gt;&lt;span&gt;    )
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ä¸Šé¢çš„è¿™ä¸ªè¡¨è¾¾å¼å¯ä»¥ç®€åŒ–ä¸ºï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt;SUMX (
&lt;&#x2F;span&gt;&lt;span&gt;    Sales,
&lt;&#x2F;span&gt;&lt;span&gt;    Sales[Quantity] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;*&lt;&#x2F;span&gt;&lt;span&gt; RELATED ( &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Product&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;[Unit Price] ) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;*&lt;&#x2F;span&gt;&lt;span&gt; RELATED ( &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Product Category&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;[Discount] )
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;filter-context-yu-mdx-de-yi-tong&quot;&gt;Filter Context ä¸ MDX çš„å¼‚åŒ&lt;&#x2F;h2&gt;
&lt;p&gt;åœ¨ MDX å¼•æ“ä¸­ï¼ŒFilter Context çš„æ¦‚å¿µæ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œä¸€èˆ¬çš„ï¼Œ MDX çš„ filter context ç”±ä¸€ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Filter axisï¼šåœ¨ WHERE å­å¥ä¸­çš„ç­›é€‰æ¡ä»¶æ„æˆäº† filter axis&lt;&#x2F;li&gt;
&lt;li&gt;Column axis&#x2F;Row axis: åœ¨ SELECT å­å¥ä¸­çš„åˆ—ã€è¡Œæ„æˆäº† Column axis&#x2F;Row axis&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ MDX ä¸­ï¼Œå¯ä»¥é€šè¿‡ &lt;code&gt;[Dim1].[ALL Dim1s]&lt;&#x2F;code&gt; ç­‰è¯­æ³•æ‰‹åŠ¨çš„è®¾ç½®æŸä¸ªç»´åº¦çš„ç­›é€‰æ¡ä»¶ï¼Œæ”¹å˜å…¶ç­›é€‰æ¡ä»¶ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;æ€»çš„æ¥è¯´ï¼ŒDAX çš„ Filter Context ç›¸æ¯” MDX æ¥è¯´ï¼Œè¦å¤æ‚çš„å¤šï¼Œå½“ç„¶ï¼Œä¹Ÿè¦å¼ºå¤§çš„å¤šï¼Œçµæ´»çš„å¤šï¼Œæˆ–è€…åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œä¹Ÿä¼šæœ‰æ›´å¥½çš„æ€§èƒ½ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;MDX æ˜¯ å¤šç»´æ¨¡å‹ï¼Œä¸€ä¸ª MDX å°±æ˜¯ä¸€ä¸ªNç»´å¤šç»´ç©ºé—´ã€‚ è€Œ Power BI æ˜¯è¡¨-å…³ç³»æ¨¡å‹ï¼Œæ¯ä¸ªäº‹å®è¡¨ï¼ˆæ ¹æ®å…¶ç­›é€‰å…³ç³»æ„å»ºçš„ä¸€ä¸ªæŸ¥è¯¢å­å›¾ï¼‰éƒ½æ˜¯ä¸€ä¸ª
ç‹¬ç«‹çš„å¤šç»´ç©ºé—´ã€‚ DAX æ›´å¯ä»¥åŠ¨æ€çš„åˆ›å»ºè®¡ç®—è¡¨ï¼Œå› æ­¤ï¼Œçµæ´»æ€§å°±æ›´å¤§äº†ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;DAX çš„ filter context ä¸­ï¼Œ åˆ†ä¸º column based çš„ table basedï¼Œå…¶ä¸­ column based çš„ filter æ˜¯æ»¡è¶³ SQL ä¸‹æ²‰çš„
åŸºç¡€çš„ï¼Œè¿™æ ·åœ¨æ•°æ®åº“ä¸Šæ‰§è¡Œæ—¶ï¼Œä¼šæœ‰æ›´å¥½çš„æ•ˆç‡ã€‚
MDX ç†è®ºä¸Šä¹Ÿå¯ä»¥å¦‚æ­¤ï¼Œç›®å‰çš„å¼€æºå¼•æ“ mondrian åœ¨è¿™æ–¹é¢åšå¾—ä¸å¤Ÿï¼Œå¯ä»¥å‚åŠ æˆ‘æ•´ç†çš„ &lt;a href=&quot;&#x2F;blog&#x2F;mdx-optimize&quot;&gt;MDX optimize&lt;&#x2F;a&gt; ä¸€æ–‡&lt;&#x2F;li&gt;
&lt;li&gt;MDX å¯¹ filter context çš„ä¿®æ”¹èƒ½åŠ›ä¹Ÿè¾ƒå¼±ï¼Œä¸è¿‡è¿™ä¸ªç†è®ºä¸Šæ˜¯å¯ä»¥é€šè¿‡ MDX çš„å‡½æ•°æ¥å®ç°çš„ï¼Œä¸ç®—æ˜¯å¼•æ“çš„é—®é¢˜ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>æ•°æ®åˆ†æä¹‹è¡¨è¾¾å¼è¯­è¨€ï¼šTabular</title>
        <published>2024-09-04T00:00:00+00:00</published>
        <updated>2024-09-04T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/tabular/"/>
        <id>https://wangzaixiang.github.io/blog/tabular/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/tabular/">&lt;p&gt;æœ¬æ–‡æ˜¯æ•°æ®åˆ†æè¡¨è¾¾å¼è¯­è¨€ç³»åˆ—ä¹‹äºŒï¼Œä¸»è¦ä»‹ç»æˆ‘å¯¹ Tabular çš„ç†è§£ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;é¦–å…ˆè¯´æ˜ï¼Œæˆ‘å¯¹ taular è¿™ä¸ªäº§å“çš„ç†Ÿæ‚‰ç¨‹åº¦æ˜¯æœ€ä½çš„ï¼Œåªæ˜¯æœ‰é™çš„è¯•ç”¨äº†ï¼Œå¹¶é‡ç‚¹æ˜¯åœ¨å­¦ä¹  &lt;a href=&quot;https:&#x2F;&#x2F;www.tableau.com&#x2F;zh-cn&#x2F;blog&#x2F;LOD-expressions#:~:text=Tableau&quot;&gt;15 å¤§è¯¦ç»†çº§åˆ«è¡¨è¾¾å¼&lt;&#x2F;a&gt;
è¿™ä¸ªç³»åˆ—æ–‡æ¡£æ—¶ï¼ŒæŒ‰ç…§æ•™ç¨‹è¿›è¡Œçš„ä¸€äº›ç»ƒä¹ ï¼Œé‡ç‚¹åœ¨ä¸ç†è§£ LOD è¡¨è¾¾å¼çš„ä½¿ç”¨ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;chang-jing-1-ke-hu-ding-dan-pin-lu&quot;&gt;åœºæ™¯1: å®¢æˆ·è®¢å•é¢‘ç‡&lt;&#x2F;h2&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;[Number of orders per customer]  := { FIXED [Customer Name] : COUNTD([Order ID]) }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;- è¡Œ: countd([Customer Name])
&lt;&#x2F;span&gt;&lt;span&gt;- åˆ—: [Number of orders per customer] ä½œä¸ºç»´åº¦
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è¿™ä¸ªå¯ä»¥ç†è§£ä¸ºï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è®¡ç®—å­å›¾ï¼š è®¢å•&lt;&#x2F;li&gt;
&lt;li&gt;ä»¥ LOD ä¸ºç»´åº¦æ—¶ï¼Œç­‰åŒäº DAX çš„è®¡ç®—åˆ— (ä»¥å½“å‰è¡Œçš„ Customer Nameä¸ºç­›é€‰æ¡ä»¶ï¼Œè®¡ç®— &lt;code&gt;CountD([Order Id])&lt;&#x2F;code&gt; )ï¼š&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;Number&lt;&#x2F;span&gt;&lt;span&gt; of orders per customer] = CALCULATE( DISTINCTCOUNT(Orders[Order ID]), ALLEXCEPT(Orders[Customer Name]) )
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
åœ¨è¿™é‡Œ, LOD expression ç›¸æ¯” DAX æ›´åŠ ç®€æ´ï¼Œæ›´å®¹æ˜“ç†è§£ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨æ¯ä¸€è¡Œä¸Šï¼Œè®¡ç®—å‡º Numbers of orders per customer çš„å€¼ï¼Œä½œä¸ºä¸€ä¸ªç»´åº¦ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä»¥&lt;code&gt;[Numbers of orders per customer]&lt;&#x2F;code&gt;ä¸ºç­›é€‰ç»´åº¦ï¼Œè¿›è€Œè®¡ç®—å‡º &lt;code&gt;countd([Customer Name]&lt;&#x2F;code&gt;) çš„å€¼ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å¯ä»¥åŸºäº [Number of orders per customer] è®¡ç®—åº¦é‡ï¼Œæ­¤æ—¶ï¼Œéœ€è¦ä½¿ç”¨èšåˆå‡½æ•°ï¼Œè¯¸å¦‚ SUM, MAX ç­‰ï¼Œå…¶åŸç†ä¸è®¡ç®—åˆ—æ˜¯ä¸€è‡´çš„ã€‚
FIXED LOD åªä¼šè®¡ç®—å‡ºå•è¡Œçš„å€¼ï¼Œå› æ­¤ï¼Œå¯ä»¥ä½œä¸ºè®¡ç®—åˆ—ç›´æ¥ä½¿ç”¨ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;chang-jing-2-zhen-lie-fen-xi&quot;&gt;åœºæ™¯2: é˜µåˆ—åˆ†æ&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;tabular&#x2F;scenario-2-1.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;tabular&#x2F;scenario-2-2.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;[å®¢æˆ·é¦–æ¬¡ä¸‹å•æ—¶é—´] := { FIXED [Customer Name] : year(MIN([Order Date])) }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;- è¡Œ: year([Order Date])
&lt;&#x2F;span&gt;&lt;span&gt;- åˆ—ï¼šSUM([é”€å”®é¢])
&lt;&#x2F;span&gt;&lt;span&gt;- é¢œè‰²ï¼š[å®¢æˆ·é¦–æ¬¡ä¸‹å•æ—¶é—´] as ç»´åº¦ï¼Œæ’åº
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;å¦‚æœæ˜¯ç°å®ç™¾åˆ†æ¯”ï¼Œåˆ™åˆ†æè®¾ç½®ä¸ºï¼š
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;- è¡Œ: year([Order Date])
&lt;&#x2F;span&gt;&lt;span&gt;- åˆ—ï¼šSUM([é”€å”®é¢]) &#x2F; sum({ EXCLUDE [å®¢æˆ·é¦–æ¬¡ä¸‹å•å¹´ä»½]: SUM([é”€å”®é¢])})
&lt;&#x2F;span&gt;&lt;span&gt;- é¢œè‰²ï¼š[å®¢æˆ·é¦–æ¬¡ä¸‹å•æ—¶é—´] as ç»´åº¦ï¼Œæ’åº
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘è¿™é‡Œæ˜¯é€šè¿‡æ‰‹å†™è®¡ç®—å…¬å¼çš„æ–¹å¼æ¥å®ç°ï¼Œå®˜æ–¹ç¤ºä¾‹å¯ä»¥é€šè¿‡ è¡¨å¿«é€Ÿè®¡ç®— æ¥å®ç°ï¼Œæ“ä½œæ›´ç®€å•ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨èƒ½ä½¿ç”¨LOD è¡¨è¾¾çš„åœºæ™¯æ¥çœ‹ï¼Œç¡®å®æ¯” DAX æ›´åŠ ç®€å•ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Tabular çš„ æ•°æ®å±•ç¤ºï¼Œè®¾è®¡çš„éå¸¸åˆç†ï¼Œå…¶ä¸­ï¼Œè½´é™¤äº† column, row è½´ä¸¤æ¡å¸¸è§„å‘¨ä¹‹å¤–ï¼Œè¿˜æœ‰ï¼š
&lt;ul&gt;
&lt;li&gt;é¢œè‰²è½´ï¼šå¯ä½œä¸ºç»´åº¦ï¼ˆç”¨äºåˆ†ç»„ï¼‰ã€åº¦é‡ï¼ˆç”¨äºæ¸²æŸ“ä¸åŒçš„é¢œè‰²ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;å¤§å°è½´ï¼šå¯ç”¨äºç»´åº¦ã€åº¦é‡&lt;&#x2F;li&gt;
&lt;li&gt;æ ‡ç­¾è½´ï¼šå¯ç”¨äºç»´åº¦ã€åº¦é‡&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;LOD æœ¬èº«æ˜¯ä¸€ä¸ªé›†åˆï¼Œä½œä¸ºç»´åº¦ä½¿ç”¨æ—¶ï¼Œæˆ–è€…å…¶æ˜¯å•è¡Œé›†åˆï¼Œä¾‹å¦‚ FIXED LOD, æˆ–è€… INCLUDE LODï¼Œæˆ–è€…å…¶æ˜¯å¤šè¡Œé›†åˆï¼Œä¾‹å¦‚ EXCLUDE LODã€‚
ä½œä¸ºå¤šè¡Œé›†åˆï¼Œéœ€è¦ä½¿ç”¨ èšåˆå‡½æ•° è®¡ç®—å‡ºå•ä¸ªæ ‡é‡å€¼ã€‚æˆ–è€… attr() å‡½æ•°ï¼Œå¦‚æœå¤šè¡Œå…·æœ‰ç›¸åŒå€¼ï¼Œåˆ™è¿”å›ä¹‹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Tablular æä¾›äº†ä¸€äº›è¡¨é—´å¿«é€Ÿè®¡ç®—çš„åŠŸèƒ½ã€‚ï¼ˆåç»­å•ç‹¬åˆ†æä¸€ä¸‹ tabular çš„è¡¨è®¡ç®—å‡½æ•°ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;chang-jing-3-mei-ri-li-run-kpi&quot;&gt;åœºæ™¯3: æ¯æ—¥åˆ©æ¶¦ KPI&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;tabular&#x2F;scenario-3.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;[å½“å¤©åˆ©æ¶¦] := { fixed [è®¢å•æ—¥æœŸ]: SUM([åˆ©æ¶¦]) }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;[å½“å¤©ç›ˆåˆ©æ€§è´¨] := 
&lt;&#x2F;span&gt;&lt;span&gt;   if [å½“å¤©ç›ˆåˆ©] &amp;gt; 2000 then &amp;quot;é«˜ç›ˆåˆ©&amp;quot; 
&lt;&#x2F;span&gt;&lt;span&gt;   ELSEIF  [å½“å¤©ç›ˆåˆ©] &amp;gt; 0 then &amp;quot;ç›ˆåˆ©&amp;quot; 
&lt;&#x2F;span&gt;&lt;span&gt;   else &amp;quot;ä¸ç›ˆåˆ©&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;   end
&lt;&#x2F;span&gt;&lt;span&gt;   
&lt;&#x2F;span&gt;&lt;span&gt; - è¡Œï¼šã€å½“å¤©ç›ˆåˆ©æ€§è´¨ã€‘, countd([è®¢å•æ—¥æœŸ])
&lt;&#x2F;span&gt;&lt;span&gt; - åˆ—ï¼š DATETRUNC(&amp;#39;month&amp;#39;, [è®¢å•æ—¥æœŸ])
&lt;&#x2F;span&gt;&lt;span&gt; - é¢œè‰²ï¼š [å½“å¤©ç›ˆåˆ©æ€§è´¨] as ç»´åº¦  
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;chang-jing-4&quot;&gt;åœºæ™¯4:&lt;&#x2F;h2&gt;
&lt;p&gt;æœªå®Œï¼Œå¾…ç»­ã€‚&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>ä½¿ç”¨ ADT ä»£æ•°æ•°æ®ç±»å‹ è¿›è¡Œæ•°æ®å»ºæ¨¡</title>
        <published>2024-09-01T00:00:00+00:00</published>
        <updated>2024-09-01T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/adt/"/>
        <id>https://wangzaixiang.github.io/blog/adt/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/adt/">&lt;h1 id=&quot;1-shen-me-shi-adt&quot;&gt;1. ä»€ä¹ˆæ˜¯ ADT?&lt;&#x2F;h1&gt;
&lt;p&gt;ä»£æ•°æ•°æ®ç±»å‹ ADT æ˜¯ Haskell ç­‰å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œé€šè¿‡ä¸¤ç§æ„é€ æ–¹å¼ï¼Œå³ product type å’Œ sum typeï¼Œå°±å¯ä»¥æ„é€ å‡ºå¤æ‚çš„
æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ pattern matching æ¥å¯¹è¿™äº›æ•°æ®ç»“æ„è¿›è¡Œå¤„ç†ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;sum type&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;haskell&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-haskell &quot;&gt;&lt;code class=&quot;language-haskell&quot; data-lang=&quot;haskell&quot;&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;data &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;Bool &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;True &lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;False
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;data &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;Maybe&lt;&#x2F;span&gt;&lt;span&gt; a = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;Just&lt;&#x2F;span&gt;&lt;span&gt; a | &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;Nothing
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;data &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;Either&lt;&#x2F;span&gt;&lt;span&gt; a b = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;Left&lt;&#x2F;span&gt;&lt;span&gt; a | &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;Right&lt;&#x2F;span&gt;&lt;span&gt; b
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;data &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;List&lt;&#x2F;span&gt;&lt;span&gt; a = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;Nil &lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;Cons&lt;&#x2F;span&gt;&lt;span&gt; a (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;List&lt;&#x2F;span&gt;&lt;span&gt; a)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;åœ¨ Scala å’Œ Rust ä¸­ï¼Œsum type æ˜¯é€šè¿‡ enum æ¥å®ç°çš„ã€‚å¯ä»¥è¿™æ ·ç†è§£ï¼Œ sum type çš„å–å€¼ç©ºé—´æ˜¯æ‰€æœ‰æ„é€ å­çš„å¹¶é›†ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;product type&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;haskell&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-haskell &quot;&gt;&lt;code class=&quot;language-haskell&quot; data-lang=&quot;haskell&quot;&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;data &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;Pair&lt;&#x2F;span&gt;&lt;span&gt; a b = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;Pair&lt;&#x2F;span&gt;&lt;span&gt; a b
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;data &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;Triple&lt;&#x2F;span&gt;&lt;span&gt; a b c = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;Triple&lt;&#x2F;span&gt;&lt;span&gt; a b c
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;åœ¨ Scala å’Œ Rust ä¸­ï¼Œproduct type æ˜¯é€šè¿‡ case class æˆ– struct æ¥å®ç°çš„ã€‚å¯ä»¥è¿™æ ·ç†è§£ï¼Œ product type çš„å–å€¼ç©ºé—´
æ˜¯æ‰€æœ‰æ„é€ å­çš„ç¬›å¡å°”ç§¯ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;å¾ˆå¤šçš„åŸºç¡€ç±»å‹ï¼Œä¾‹å¦‚ï¼šboolean, int, float ç­‰éƒ½å¯ä»¥è§†ä¸ºæŸç§ SUM ç±»å‹ï¼Œä½†åœ¨ scala&#x2F;rust ç­‰è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬å°†è¿™äº›ç±»å‹è§†ä¸ºåŸºç¡€ç±»å‹
ï¼ˆprimitive typeï¼‰ï¼ŒåŸºäºè¿™äº›åŸºç¡€ç±»å‹ï¼Œé€šè¿‡ SUM &#x2F; PRODUCT å°±å¯ä»¥æ„é€ å‡ºå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå¯¹ç›®æ ‡é¢†åŸŸçš„å»ºæ¨¡ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;she-ji-zhi-shan-yi-jing-shu-ju-zhi-dong-xing-wei-dong-jing-fen-chi&quot;&gt;è®¾è®¡ä¹‹ç¦…ï¼šä»¥é™ï¼ˆæ•°æ®ï¼‰åˆ¶åŠ¨ï¼ˆè¡Œä¸ºï¼‰ï¼ŒåŠ¨é™åˆ†ç¦»&lt;&#x2F;h2&gt;
&lt;p&gt;ç›®å‰æ›´ä¸ºæµè¡Œçš„é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰ä¸­ï¼Œä½¿ç”¨ç±»ï¼ˆclassï¼‰æ¥è¿›è¡Œæ•°æ®å»ºæ¨¡ï¼Œåœ¨ OOP ä¸­æ›´å¼ºè°ƒå¦‚ä¸‹çš„æ–¹æ³•ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ç»§æ‰¿ï¼šå³é€šè¿‡åˆ›å»ºå­ç±»çš„æ–¹å¼ã€‚ OOP ä¸­ä¸€ä¸ªç±»çš„å­ç±»å¾€å¾€æ˜¯å¼€æ”¾çš„ï¼Œå¯ä»¥éšæ„çš„å®šä¹‰æ–°çš„å­ç±»ï¼Œæä¾›æ‰©å±•çš„å±æ€§ï¼Œå¹¶æ”¹å˜çˆ¶ç±»çš„è¡Œä¸ºã€‚&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;å— Liskov Substitution Principle çš„é™åˆ¶, å­ç±»çš„è¡Œä¸ºå¿…é¡¿è¦ä¸çˆ¶ç±»ä¸€è‡´ï¼Œç°å®å»ºæ¨¡ä¸­ï¼Œå¾ˆå°‘æœ‰çœŸæ­£çš„ is-a å…³ç³»ï¼Œæ›´å¤šçš„æ˜¯ has-a å…³ç³»ã€‚
å¤§éƒ¨ä»½çš„ç»§æ‰¿å…³ç³»éƒ½æ˜¯é”™è¯¯çš„è®¾è®¡ï¼Œå› æ­¤ï¼Œç°åœ¨è¯­è¨€å¦‚ rust&#x2F;go ç­‰éƒ½ä¸å†æä¾›ç»§æ‰¿çš„æ–¹å¼ï¼Œè€Œæ˜¯ä½¿ç”¨ç»„åˆçš„æ–¹å¼æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æ¥å£å®šä¹‰ï¼šä¸€èˆ¬çš„ï¼Œé€šè¿‡ interface çš„æ–¹å¼æ¥å®šä¹‰ä¸€ç»„è¡Œä¸ºï¼Œå­ç±»ï¼ˆæˆ–å®ç°è€…ï¼‰æä¾›å¯¹ interface çš„å®ç°ã€‚&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;OOP å°†æ•°æ®ä¸è¡Œä¸º å¼ºè¡Œç»‘å®šåœ¨ä¸€èµ·ï¼Œè¿™æ ·ä¼šå¯¼è‡´é¢‘ç¹çš„æ›´æ–°ç±»çš„å®šä¹‰ï¼ˆæ‰©å±•æ–¹æ³•ã€å˜æ›´è¡Œä¸ºï¼‰ã€‚ä¸€ä¸ªç¬‘è¯å°±æ˜¯ï¼Œå¦‚æœè¦å‘é€è®¢å•çš„é‚®ä»¶é€šçŸ¥ï¼Œå°±éœ€è¦
åœ¨è®¢å•ç±»ä¸­å¢åŠ ä¸€ä¸ª sendEmail æ–¹æ³•ï¼Œå¦‚æœè¦å‘é€çŸ­ä¿¡é€šçŸ¥ï¼Œå°±éœ€è¦å¢åŠ ä¸€ä¸ª sendSMS æ–¹æ³•ã€‚å‡ä»¥æ—¶æ—¥ï¼Œè®¢å•ç±»å°±ä¼šå˜å¾—è‡ƒè‚¿ä¸å ªã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ DDD ä¸­ï¼Œæœ‰ä¸€ä¸ª å……è¡€æ¨¡å‹ å’Œ è´«è¡€æ¨¡å‹ çš„æ¦‚å¿µï¼Œå……è¡€æ¨¡å‹æ˜¯æŒ‡é¢†åŸŸå¯¹è±¡å…·æœ‰ä¸°å¯Œçš„è¡Œä¸ºï¼Œè€Œè´«è¡€æ¨¡å‹åˆ™æ˜¯æŒ‡é¢†åŸŸå¯¹è±¡åªæœ‰æ•°æ®ï¼Œæ²¡æœ‰è¡Œä¸ºã€‚
å¾ˆå¤šçš„ DDD ç†è®ºéƒ½å€¾å‘äºå……è¡€æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨ OOP çš„æ–¹å¼ï¼Œå°†æ•°æ®ä¸è¡Œä¸ºè€¦åˆåœ¨ä¸€èµ·ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼å®é™…ä¸Šæ˜¯æ•™æ¡çš„ï¼Œæˆ–è€…åœ¨å¾ˆå¤šæ–¹é¢æ˜¯
è‡ªç›¸çŸ›ç›¾çš„ã€‚
åœ¨å•†ä¸šç³»ç»Ÿä¸­ï¼Œæ•°æ®ç»“æ„ï¼ˆå®ä½“ã€æ•°æ®åº“ç»“æ„ï¼‰æ˜¯ç›¸å¯¹ç¨³å®šçš„ï¼Œä½†è¡Œä¸ºåˆ™æ˜¯é«˜åº¦ä¸ç¨³å®šçš„ï¼Œä¼šéšç€æ—¶é—´ã€ç©ºé—´çš„å˜åŒ–è€Œå˜åŒ–ã€‚å› æ­¤ï¼Œå°†æ•°æ®ä¸è¡Œä¸º
ç»‘å®šåˆ°ä¸€èµ·ï¼Œå®é™…ä¸Šæ˜¯ä¸åˆç†çš„ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å‡½æ•°å¼ç¼–ç¨‹ ä¸ ADT æ›´å€¾å‘äºæ•°æ®çš„å°é—­æ€§ï¼ˆè€Œéæ‰©å±•æ€§ï¼‰ï¼Œä»»ä½•å¯¹æ•°æ®æ¨¡å‹çš„ä¿®æ”¹ï¼Œéƒ½åº”è¯¥ç»´æŠ¤åˆ°ä¸€ä¸ª ADT æ¨¡å‹ä¸­ï¼Œå¹¶é€šè¿‡ç±»å‹æ£€æŸ¥çš„æ–¹å¼æ¥æ£€æŸ¥ç°æœ‰çš„
ä»£ç æ˜¯å¦æœ‰æ­£ç¡®çš„è¦†ç›–æ–°çš„ç±»å‹ï¼Œé€šè¿‡é™æ€çš„ç±»å‹æ£€æŸ¥ï¼Œå¯ä»¥é¿å…å¾ˆå¤šçš„è¿è¡Œæ—¶é”™è¯¯ã€‚
å½“ç„¶ï¼Œè¿™ç§æ–¹å¼ä¹Ÿç¡®å®ä¼šå¸¦æ¥ä¸€å®šçš„é™åˆ¶ï¼šå³åŠ¨æ€èƒ½åŠ›ä¼šå—åˆ°é™åˆ¶ã€‚
é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯¹å¤æ‚çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬ä¼šæ›´å€¾å‘äºè¿½æ±‚é€šè¿‡é™æ€ç±»å‹æ£€æŸ¥å³å¯ä¿è¯çš„æ­£ç¡®æ€§ï¼Œè€Œå°†éœ€è¦åŠ¨æ€æ€§çš„éƒ¨åˆ†ï¼Œé™åˆ¶åœ¨ä¸€ä¸ªæ›´å°çš„è¾¹ç•Œå†…ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;she-ji-zhi-shan-qiong-jin-mei-ju-zu-gou-fu-gai&quot;&gt;è®¾è®¡ä¹‹ç¦…ï¼šç©·å°½æšä¸¾ï¼Œè¶³å¤Ÿè¦†ç›–&lt;&#x2F;h2&gt;
&lt;p&gt;åœ¨ OOP ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå°†æŸä¸€ç±»å¯¹è±¡æŠ½è±¡æŠ½è±¡ä¸ºçˆ¶ç±»ã€å­ç±»çš„æ–¹å¼ï¼Œæˆ–è€… interfaceã€å®ç°ç±»çš„æ–¹å¼ï¼Œç„¶ååœ¨ä½¿ç”¨æ—¶ï¼Œé€šè¿‡å¤šæ€çš„æ–¹å¼æ¥è¿›è¡Œå¤„ç†ã€‚
è€Œåœ¨ ADT ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå°†æŸä¸€ç±»å¯¹è±¡æŠ½è±¡ä¸ºä¸€ä¸ª enum ç±»å‹ï¼Œç„¶åé€šè¿‡ pattern matching çš„æ–¹å¼æ¥è¿›è¡Œå¤„ç†ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;2-json-with-adt&quot;&gt;2. JSON with ADT&lt;&#x2F;h1&gt;
&lt;p&gt;æ•°æ®ç»“æ„é™¤äº†å¹¿æ³›çš„å­˜åœ¨äºå†…å­˜ä¹‹ä¸­ï¼Œæ‰¿æ‹…ç€è¿è¡Œè¿‡ç¨‹ä¸­çš„è¡€æ¶²å’Œç¥ç»çš„ä½œç”¨ï¼Œè¿˜ä¼šè¢«åºåˆ—åŒ–åˆ°ç£ç›˜ã€ç½‘ç»œä¸­ï¼Œä½œä¸ºï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æŒä¹…åŒ–å­˜å‚¨&lt;&#x2F;li&gt;
&lt;li&gt;ç½‘ç»œä¼ è¾“ã€æ•°æ®äº¤æ¢&lt;&#x2F;li&gt;
&lt;li&gt;é…ç½®æ–‡ä»¶&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;ä»æŸä¸ªè§’åº¦æ¥çœ‹ï¼Œè¿™äº›å¤–éƒ¨çš„åºåˆ—åŒ–çš„æ•°æ®ç»“æ„æ‰¿æ‹…ç€æ›´ä¸ºé‡è¦çš„ä½œç”¨ï¼Œå› ä¸ºè¿™äº›æ•°æ®ç»“æ„æ˜¯æ›´åŠ é¢å‘äººçš„ï¼Œéœ€è¦æœ‰è‰¯å¥½çš„å¯ç†è§£æ€§ï¼ŒåŒæ—¶ï¼Œä¸€èˆ¬çš„ï¼Œå®ƒä¸
è¿è¡ŒæœŸçš„æ•°æ®ç»“æ„æ˜¯æœ‰ä¸€å®šçš„ç›¸å…³æ€§çš„ï¼ŒæŸç§ç¨‹åº¦ä¸Šå†³å®šäº†å†…éƒ¨æ•°æ®ç»“æ„ä¸å¤„ç†ä»£ç çš„è®¾è®¡ã€‚&lt;strong&gt;ç”±å¤–è€Œå†…ï¼Œå¤–éƒ¨å†³å®šå†…éƒ¨&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;è¿™äº›å¹´æ¥ï¼Œéšç€ Restful API çš„æµè¡Œï¼ŒJSON ä½œä¸ºä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œå·²ç»æˆä¸ºäº†äº‹å®ä¸Šçš„æ ‡å‡†ã€‚å¾ˆå¤šçš„ç³»ç»Ÿéƒ½ä½¿ç”¨ JSON æ¥ä½œä¸ºæ–‡ä»¶å­˜å‚¨çš„æ ¼å¼ã€
ç½‘ç»œä¼ è¾“çš„æ ¼å¼ã€‚ç›¸æ¯”äº XMLï¼ŒJSON æ›´åŠ ç®€æ´ã€æ˜“è¯»ã€æ˜“å†™ï¼Œä¹Ÿæ›´åŠ å®¹æ˜“çš„è¢«ç¨‹åºå¤„ç†ï¼ˆå†™ä¸€ä¸ªJSON Parseråªéœ€è¦100-200è¡Œä»£ç å°±è¶³å¤Ÿäº†ï¼Œè€Œä¸”æ€§èƒ½è¶³å¤Ÿå¿«
ï¼Œè€ŒXML Parseråˆ™å¯èƒ½éœ€è¦ä¸Šä¸‡è¡Œä»£ç ï¼‰ï¼Œç›¸æ¯”äºäºŒè¿›åˆ¶æ ¼å¼ï¼ŒJSON æ›´åŠ å®¹æ˜“çš„è¢«äººç±»ç†è§£ï¼Œè¿™åœ¨ç½‘ç»œè°ƒè¯•ã€é…ç½®æ–‡ä»¶ç­‰æ–¹é¢æœ‰ç€å¾ˆå¤§çš„ä¼˜åŠ¿ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;JSON çš„è‡ªç”±ä¹Ÿå¾ˆå®¹æ˜“æ»¥ç”¨ï¼Œä¸€äº›å¤æ‚çš„ç³»ç»Ÿä¼šéšç€æ—¶é—´çš„æ¼”åŒ–ï¼Œè€Œå¯¼è‡´ JSON ç»“æ„çš„ä¸æ–­çš„å˜åŒ–ï¼Œå‡ºç°å¾ˆå¤šçš„è´¨é‡é—®é¢˜ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å‡ºç°å¤§é‡çš„å†—ä½™å­—æ®µï¼Œæˆ–è€…åºŸå¼ƒä½†é—ç•™çš„å­—æ®µã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å†å²ç‰ˆæœ¬çš„ å­—æ®µçš„ç»“æ„ã€ç±»å‹ã€è¯­ä¹‰çš„å˜åŒ–ï¼Œå¯¼è‡´äº†å¾ˆå¤šçš„å…¼å®¹æ€§å’Œä¸ä¸€è‡´çš„é—®é¢˜ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å½“æ··ä¹±å‘å±•åˆ°ä¸€å®šç¨‹åº¦ï¼Œå­˜å‚¨æ–‡ä»¶ç»“æ„çš„å˜åŒ–ï¼Œä¼šå˜æˆæ•´ä¸ªç³»ç»Ÿæ²‰é‡çš„åŒ…è¢±ï¼Œæ­¤æ—¶ï¼Œåœ¨ä»£ç å¤„ç†æ—¶ï¼Œéœ€è¦é¢å¯¹å¾ˆå¤šçš„å…¼å®¹æ€§é—®é¢˜ï¼Œå¾ˆå¤šçš„ä»£ç åˆ ä¸å¾—ï¼Œæ”¹ä¸åŠ¨ï¼Œ
åªèƒ½ä¸æ–­çš„é€šè¿‡è¡¥ä¸çš„æ–¹å¼ï¼Œå åŠ åˆ†æ”¯çš„æ–¹å¼ï¼Œæ¥ç»´æŠ¤è¿™äº›å†å²é—ç•™çš„é—®é¢˜ã€‚åœ¨è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°ï¼ŒJSON çš„è‡ªç”±æ€§ï¼Œå®é™…ä¸Šæ˜¯ä¸€ç§è´Ÿæ‹…ã€‚&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¤æ‚çš„è½¯ä»¶ä¸–ç•Œï¼Œå…¶å®å¹¶ä¸éœ€è¦å¤ªå¤šçš„è‡ªç”±ï¼Œç›¸åï¼Œæ›´éœ€è¦çš„æ˜¯ä¿è¯è´¨é‡çš„è§„åˆ™ï¼Œè¯¸å¦‚å¼ºç±»å‹ç¼–ç¨‹è¯­è¨€ï¼Œç›¸æ¯”äºåŠ¨æ€è¯­è¨€ï¼Œå°±å¤±å»äº†ä¸€å®šçš„è‡ªç”±ï¼Œä½†
å¯ä»¥é€šè¿‡ç±»å‹ä½“ç³»ï¼Œæ›´å¥½çš„ä¿è¯çš„ä»£ç çš„æ­£ç¡®æ€§ã€‚æ‰€è°“ï¼šåŠ¨æ€è¯­è¨€ä¸€æ—¶çˆ½ï¼Œä¸€ç›´åŠ¨æ€ä¸€ç›´çˆ½ï¼Œé‡æ„ä»£ç ç«è‘¬åœºã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;åŒç†ï¼Œrust è¯­è¨€çš„ borrow checker ä¹Ÿæ˜¯ä¸€ç§è§„åˆ™ï¼Œå®ƒé™åˆ¶äº†ç¨‹åºå‘˜çš„è‡ªç”±ï¼Œä½†å´å¯ä»¥ä¿è¯ä»£ç çš„æ­£ç¡®æ€§ã€‚è™½ç„¶å’Œç¼–è¯‘æœŸçš„é”™è¯¯äº¤æµï¼Œå¯¹å¤§éƒ¨ä»½
çš„åˆå­¦è€…æ˜¯ä¸€ä»¶ç—›è‹¦çš„äº‹æƒ…ï¼Œä½†æ˜¯ï¼Œå¤§éƒ¨ä»½ä»£ç ç¼–è¯‘é€šè¿‡å°±å¯ä»¥æ— é”™è¿è¡Œï¼Œè¿™ç§æ„Ÿè§‰æ˜¯éå¸¸ç¾å¦™çš„ã€‚åŒç†ï¼Œåœ¨code reviewæ—¶ï¼Œä¹Ÿå¯ä»¥æ›´åŠ ä¸“æ³¨äº
æ ¸å¿ƒé€»è¾‘ï¼Œè€Œæ— éœ€ä¸ºä¸€äº›ä½çº§é”™è¯¯è€Œçƒ¦æ¼ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;h2 id=&quot;2-1-json-schema&quot;&gt;2.1 JSON Schema&lt;&#x2F;h2&gt;
&lt;p&gt;ç±»ä¼¼äºXML Schemaï¼Œ&lt;a href=&quot;https:&#x2F;&#x2F;json-schema.org&quot;&gt;JSON Schema&lt;&#x2F;a&gt; æ˜¯ä¸€ç§ç”¨äºæè¿° JSON æ•°æ®ç»“æ„çš„è§„èŒƒï¼Œå®ƒå¯ä»¥æè¿° JSON æ•°æ®ç»“æ„çš„ç±»å‹ã€ç»“æ„ã€çº¦æŸç­‰ä¿¡æ¯ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯
JSON çš„ç±»å‹ä½“ç³»ã€‚&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;å®é™…ä¸Šï¼ŒJSON schema ç›¸æ¯”å¤§éƒ¨ä»½çš„ç¼–ç¨‹è¯­è¨€çš„ç±»å‹ä½“ç³»ï¼Œå¯¹æ•°æ®çš„ constraint çš„æè¿°æ›´åŠ ä¸°å¯Œï¼Œä¾‹å¦‚ï¼šå¯ä»¥æè¿°æ•°æ®çš„é•¿åº¦ã€å–å€¼èŒƒå›´ã€æ­£åˆ™è¡¨è¾¾å¼ç­‰ã€‚
æˆ‘è§‰å¾— ADT ä¸­ä¹Ÿéœ€è¦ä¸€å¥— constraint çš„æè¿°ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„æè¿°æ•°æ®çš„çº¦æŸã€‚
åœ¨ design-by-contract çš„è®¾è®¡ç†å¿µä¸­ï¼Œä¹Ÿéœ€è¦ä¸€ç§ contract çš„æè¿°è¯­è¨€ï¼Œè¿™äº›éƒ½æ˜¯ç›®å‰çš„è¯­è¨€ä¸­ç¼ºå¤±çš„ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;é€šè¿‡ JSON schemaï¼Œæˆ‘ä»¬å¯ä»¥:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨ JSON schema å¯¹ JSON æ•°æ®ç»“æ„è¿›è¡Œæ ¡éªŒã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ Visual Codeã€IntelliJ IDEA ç­‰ç¼–è¾‘å™¨ä¸­ï¼Œå¯ä»¥å¯¹JSON ç¼–è¾‘æ¥æä¾›æ›´å¥½çš„æç¤ºã€è¡¥å…¨ã€æ ¡éªŒç­‰åŠŸèƒ½ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯ä»¥å°† Schema ä½œä¸ºå…ƒä¿¡æ¯ï¼Œåœ¨ä»£ç ç”Ÿæˆã€æ–‡æ¡£ç”Ÿæˆç­‰æ–¹é¢å‘æŒ¥ä½œç”¨ï¼Œä¾‹å¦‚ API æ–‡æ¡£ç­‰ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;2-2-wjson&quot;&gt;2.2 wjson&lt;&#x2F;h2&gt;
&lt;p&gt;åœ¨æˆ‘å¼€å‘çš„ &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;wjson&quot;&gt;wjson&lt;&#x2F;a&gt; ä¸­ï¼Œæä¾›äº†ä¸€ç§é¢å‘ Scala3 ADT çš„ JSON å·¥å…·åŒ…ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Bean&#x2F;JSON æ˜ å°„æ”¯æŒ: æ”¯æŒ ADT ç±»å‹åˆ° JSON çš„æ˜ å°„ï¼Œä»¥åŠ JSON åˆ° ADT ç±»å‹çš„æ˜ å°„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;JSON Schema generator: æ”¯æŒè‡ªåŠ¨æ ¹æ® ADT ç±»å‹ç”Ÿæˆ JSON Schemaï¼Œä¾¿äºåœ¨å‰ç«¯ã€IDEç­‰å…¶ä»–å·¥å…·ä¸­å¯¹JSONè¿›è¡Œæ•°æ®æç¤ºã€æ ¡éªŒå’Œä»£ç è¡¥å…¨ç­‰åŠŸèƒ½&lt;&#x2F;li&gt;
&lt;li&gt;è§„åˆ’çš„å¤šç‰ˆæœ¬æ”¯æŒåŠŸèƒ½ï¼šå¯ä»¥åœ¨åç»­ç‰ˆæœ¬ä¸­ï¼Œå¢åŠ æ–°çš„å­—æ®µï¼Œæˆ–è€…åºŸå¼ƒæ—§çš„å­—æ®µï¼Œæ”¯æŒæ–°ç‰ˆæœ¬è½¯ä»¶çš„å‘ä¸‹å…¼å®¹ï¼ˆæ–°ç‰ˆæœ¬è½¯ä»¶å¯ä»¥è¯»å†™æ—§ç‰ˆæœ¬æ–‡ä»¶ï¼‰ï¼Œå’Œä¸€å®šç¨‹åº¦çš„
çš„å‘ä¸Šå…¼å®¹ï¼ˆæ—§ç‰ˆæœ¬è½¯ä»¶å¯ä»¥è¯»æ–°ç‰ˆæœ¬æ–‡ä»¶ï¼‰ã€‚
ç›¸å…³çš„æŠ€æœ¯æ–‡æ¡£å‚è€ƒï¼š&lt;a href=&quot;&#x2F;wjson&#x2F;index.html&quot;&gt;wjson docs&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>September 2024</title>
        <published>2024-09-01T00:00:00+00:00</published>
        <updated>2024-09-01T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2024-09/"/>
        <id>https://wangzaixiang.github.io/monthly/2024-09/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2024-09/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.yoshuawuyts.com&#x2F;tree-structured-concurrency&#x2F;&quot;&gt;Tree-Structured-Concurrency&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå¯¹å¤šçº¿ç¨‹å’Œå¹¶å‘å¤„ç†ï¼Œéƒ½åœç•™åœ¨çº¿ç¨‹æ± ã€é”ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰æœºåˆ¶ä¸Šã€‚Structured Concurrency åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œæ˜¯ä¸€ä¸ª
æ›´ä¸ºè´´åˆçš„å¹¶å‘æ¨¡å‹ã€‚Java åœ¨ 19-23 ç‰ˆæœ¬ä¸­ï¼Œä¹Ÿæå‡ºäº†ä¸€ä¸ª Preview ç‰ˆæœ¬çš„ Structured-Concurrencyï¼ˆæˆ‘åœ¨å…¬å¸å†…éƒ¨é¡¹ç›®ä¸­ï¼Œ
ä¹Ÿå‚è€ƒè¿™ä¸ªæ¦‚å¿µï¼Œè®¾è®¡äº†ä¸€ä¸ªScala çš„ Structured Concurrency APIï¼‰ã€‚

&lt;img src=&quot;https:&amp;#x2F;&amp;#x2F;wangzaixiang.github.io&amp;#x2F;processed_images&amp;#x2F;structured-concurrency.1d3eccef9127ba95.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™ä¸ªä½œè€…çš„ä¸€ç³»åˆ—æ–‡ç« ï¼Œéƒ½æ˜¯å›´ç»•ç€Rust è¯­è¨€ä¸­çš„æ¦‚å¿µï¼Œä¾‹å¦‚ï¼šSelf-Reference, Pinï¼Œ Async&#x2F;Await etc. å€¼å¾—æŒç»­å…³æ³¨å­¦ä¹ ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dioxuslabs.com&quot;&gt;Rust GUI&lt;&#x2F;a&gt;
æŒ‰ç…§æ–‡æ¡£ï¼Œè·‘äº†ä¸€ä¸ª Web ç¤ºä¾‹ç¨‹åºã€‚ æ„Ÿè§‰ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;API å¾ˆç†Ÿæ‚‰ã€‚ rsx! ç›¸å½“ä¸å°† JSX å’Œ react é£æ ¼è¿ç§»åˆ° Rust ä¸­ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸€ç§å¼€å‘æ¨¡å¼ï¼Œå¯ä»¥æ”¯æŒ WEB, Desktop, TUI, ç¡®å®å¾ˆæœ‰å¸å¼•åŠ›ã€‚åˆ°äº† WEB ä¸­ä¹Ÿè¿è¡Œçš„æ˜¯ Rustï¼ˆåŸºäºWASMï¼‰ è€Œé JavaScriptã€‚&lt;&#x2F;li&gt;
&lt;li&gt;dx é£æ ¼ä¹Ÿå’Œ cargo&#x2F;npm é£æ ¼å¾ˆç›¸ä¼¼ï¼Œå¼€å‘æ¨¡å¼ä¸‹ï¼Œä¿®æ”¹æºä»£ç è‡ªåŠ¨ç¼–è¯‘ã€çƒ­åŠ è½½ã€‚ç®€å•çš„ä¾‹å­ä½“éªŒä¸é”™ï¼Œä¸çŸ¥é“åœ¨å¤æ‚çš„é¡¹ç›®ä¸­ï¼Œè¿™ä¸ªæ•ˆç‡ä¼šå¦‚ä½•ï¼Ÿ
ç°åœ¨æ¥çœ‹ï¼Œæ˜¯æœ‰äº›æ‹…å¿ƒçš„ï¼Œä¸€æ˜¯ rust ç¼–è¯‘é€Ÿåº¦ï¼ŒäºŒæ˜¯æ•´ä¸ª wasm é‡æ–°åŠ è½½ï¼Œhot reload ç›¸å½“äºæ˜¯æ•´ä¸ªåº”ç”¨äº†ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;wasm çš„ç¼–è¯‘å¤§å°ï¼Œç›®å‰çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼ˆdx new çš„ç¤ºä¾‹ä»£ç )ï¼Œç¼–è¯‘åå¤§å°ä¸º 957K, brå‹ç¼©åä¸º 240Kã€‚ æ›´å¤æ‚çš„é¡¹ç›®ä¼šæœ‰å¤šå¤§å‘¢ï¼Ÿ&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;raphlinus.github.io&#x2F;rust&#x2F;gui&#x2F;2022&#x2F;05&#x2F;07&#x2F;ui-architecture.html&quot;&gt;Xilem: an architecture for UI in Rust&lt;&#x2F;a&gt;
ä¸€ä¸ª React é£æ ¼çš„ Rust GUI æ¡†æ¶ï¼Œæ¶æ„è®¾è®¡ä¸ flutter å¾ˆç›¸ä¼¼ï¼Œè¿™ä¸ªä½œè€…çš„ blogs ä¸Šæœ‰å¾ˆå¤šè¿™æ–¹é¢çš„æ€è€ƒï¼Œä»‹ç»äº†&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;view tree: çŸ­ç”Ÿå‘½å‘¨æœŸï¼Œæ¯æ¬¡ render éƒ½ä¼šé‡æ–°åˆ›å»ºï¼Œä»…ä¿ç•™è¶³å¤Ÿé•¿çš„æ—¶é—´æ¥ååŠ©äº‹ä»¶åˆ†æ´¾ï¼Œç„¶åä¸ä¸‹ä¸€ä¸ªç‰ˆæœ¬è¿›è¡Œæ¯”è¾ƒï¼Œç„¶åå°±è¢«é”€æ¯ã€‚
çº¯å€¼å¯¹è±¡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;widget treeï¼šé•¿ç”Ÿå‘½å‘¨æœŸï¼Œæ¯æ¬¡ render ä¼šæ›´æ–°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;view state tree. è·¨ circle æŒç»­å­˜åœ¨ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;å¦‚ä½•ç»´æŠ¤è¿™ä¸‰é¢—æ ‘ï¼Œå®ç°é«˜æ•ˆçš„ incremental updateï¼Œè¿™ä¸&lt;a href=&quot;&#x2F;blog&#x2F;virtual-dom&quot;&gt;DOM æ›´æ–°æŠ€æœ¯å¯¹æ¯”ï¼šVirtual DOM or Incremental DOM&lt;&#x2F;a&gt; ä¸­ä»‹ç»
çš„å†…å®¹æ˜¯åŒä¸€ä¸ªä¸»é¢˜ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ–‡ç« ä¹Ÿå¯¹æ¯”äº†ä¸ immediate mode GUI(egui) çš„åŒºåˆ«ã€‚ä¸ &lt;a href=&quot;https:&#x2F;&#x2F;guide.elm-lang.org&#x2F;architecture&#x2F;&quot;&gt;Elm&lt;&#x2F;a&gt; æ¶æ„çš„åŒºåˆ«ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;raphlinus.github.io&#x2F;ui&#x2F;druid&#x2F;2019&#x2F;11&#x2F;22&#x2F;reactive-ui.html&quot;&gt;Towards a unified theory of reactive UI&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.google.com&#x2F;presentation&#x2F;d&#x2F;1opLymkreSTFfxygjzSLYI_uH7j1YFfE6DLl8RfCiw7E&#x2F;edit?pli=1#slide=id.p&quot;&gt;å¢é‡è®¡ç®—ä¹‹æ—…&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;linebender&#x2F;xilem&#x2F;blob&#x2F;main&#x2F;ARCHITECTURE.md&quot;&gt;ç³»åˆ—æ¶æ„æ–‡æ¡£&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;mpp-olap&quot;&gt;MPP &amp;amp; OLAP&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;glaredb.com&quot;&gt;GlareDB&lt;&#x2F;a&gt; åˆä¸€ä¸ªè·¨åº“æ‰§è¡ŒSQLçš„å¼•æ“ï¼Œä»ç›®å‰å®˜ç½‘ä¸Šæ²¡æœ‰çœ‹åˆ°ä¸æ€§èƒ½ç›¸å…³çš„ä¿¡æ¯ï¼Œä¸çŸ¥é“è¿™æ–¹é¢çš„è¡¨ç°å¦‚ä½•ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.sohu.com&#x2F;a&#x2F;783829162_121124375&quot;&gt;Databricks æ”¶è´­äº† Apache IcebergèƒŒåå…¬å¸ Tabular&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;iceberg.apache.org&quot;&gt;iceberg&lt;&#x2F;a&gt; å¼€æ”¾çš„åˆ†æå‹è¡¨å­˜å‚¨æ ¼å¼ï¼šæ”¯æŒ
&lt;ol&gt;
&lt;li&gt;schema evolution&lt;&#x2F;li&gt;
&lt;li&gt;éšè—åˆ†åŒº&lt;&#x2F;li&gt;
&lt;li&gt;åˆ†åŒºç»“æ„æ¼”è¿›&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.snowflake.com&quot;&gt;snowflake&lt;&#x2F;a&gt; äº‘æ•°æ®ä»“åº“ï¼Œæ”¯æŒ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=bZOvAKGkzpQ&quot;&gt;DuckDB internals&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;in process like sqlite.&lt;&#x2F;li&gt;
&lt;li&gt;1.1.0 æ€§èƒ½ä¼˜åŒ–
&lt;ul&gt;
&lt;li&gt;ç‰ˆæœ¬å¢åŠ äº†å¯¹ join çš„ä¼˜åŒ–ï¼Œå¯ä»¥æ ¹æ®å³è¡¨çš„è¿‡æ»¤ç»“æœï¼Œæ¥ä¼˜åŒ–å·¦è¡¨çš„ç­›é€‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹ CTE çš„ material çš„ä¼˜åŒ–ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;extension æ”¯æŒ rustå¼€å‘&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;blockquote&gt;
&lt;p&gt;è€ƒè™‘ DuckDB ä½œä¸ºæ•°æ®åˆ†æçš„åŸºç¡€å¼•æ“ï¼Œä»¥è§£å†³å¤æ‚åˆ†æåœºæ™¯ä¸‹çš„æ€§èƒ½é—®é¢˜ï¼Œä¸æ•°æ®åº“å…¼å®¹æ€§é—®é¢˜ã€‚ä¸åŒçš„æºæ•°æ®åº“ï¼Œå…¶æä¾›çš„æŸ¥è¯¢èƒ½åŠ›å·®åˆ«è¾ƒå¤§ï¼Œ
ï¼ˆè¯­æ³•ï¼Œå‡½æ•°ï¼‰ç­‰ï¼Œå¯¹ Full JOINèƒ½åŠ›ã€çª—å£å‡½æ•°çš„è®¡ç®—èƒ½åŠ›ç­‰ï¼Œ é€ä¸€é€‚é…æˆæœ¬å¤ªå¤§ï¼Œè€ƒè™‘ä½¿ç”¨ DuckDB ä½œä¸ºæ•°æ®åˆ†æå¼•æ“ï¼Œå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;æœ¬æœˆå¼€å§‹ï¼Œè®¡åˆ’é˜…è¯» DuckDB çš„æºä»£ç ï¼Œåœ¨é˜…è¯»è¿‡ç¨‹ä¸­æ•´ç†æ–‡æ¡£ï¼Œæœ‰å‡ ä¸ªç›®çš„ï¼šä¸€æ˜¯é˜…è¯»ä¸€ä¸ªä¼˜ç§€çš„OLAPå¼•æ“çš„æºä»£ç ï¼ŒåŠ æ·±å¯¹ OLAP å¼•æ“çš„ç†è§£ï¼›
äºŒæ˜¯è¯„ä¼°åœ¨å…¬å¸äº§å“ä¸­é›†æˆ duckdb, æé«˜äº§å“çš„åˆ†æèƒ½åŠ›ã€‚ä¸‰æ˜¯é¡ºä¾¿é‡æ¸©ä¸€ä¸‹ C++ çš„çŸ¥è¯†ï¼ŒæŠŠè‡ªå·±ä» C++ çš„é™Œç”ŸåŒºè½¬ç§»åˆ°ç†Ÿæ‚‰åŒºæ¥ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;prql&#x2F;prql&quot;&gt;Pipelined Relational Query Language&lt;&#x2F;a&gt; ä¸€ä¸ªæ›´ä¸ºç»“æ„åŒ–çš„SQLæè¿°&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨æ•°æ®åˆ†ææ—¶ï¼Œå¯¹å¤æ‚çš„SQLè¿›è¡Œç†è§£ï¼Œå¾€å¾€æ˜¯éå¸¸å¤´ç—›çš„ï¼Œä½¿ç”¨ with CTE å¯ä»¥è®©è¿™ä¸ªè¿‡ç¨‹ä¾¿å¾—æ›´ä¸ºç»“æ„åŒ–ï¼Œ PRQL æä¾›äº†å¦å¤–ä¸€ä¸ªå‚è€ƒçš„è§†è§’ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;hex.tech&quot;&gt;Hex&lt;&#x2F;a&gt; ä¸€ä¸ªè›®æœ‰ç‰¹è‰²çš„æ•°æ®åˆ†æäº§å“ï¼Œå¯ä»¥ä½“éªŒä¸€ä¸‹å…¶äº§å“è®¾è®¡ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Notebook é£æ ¼ï¼Œä¸€ä¸ª notebook å°±æ˜¯ä¸€ä¸ª workspaceï¼Œæ”¯æŒ Python, SQLä¸¤ç§åˆ†æè¯­è¨€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è¿™äº›è®¡ç®—ç›®å‰æ¥çœ‹æ˜¯æ‰§è¡Œåœ¨ server ä¸Šçš„&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;[Rill Opensource](Dashboards that move as fast as your business)
ä½“éªŒäº†ä¸€ä¸‹ï¼Œä½œä¸º EndUserï¼ŒåŠŸèƒ½è¿˜æ¯”è¾ƒç²—ç‡¥ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;web-visualization&quot;&gt;Web &amp;amp; Visualization&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;NoBuild&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;world.hey.com&#x2F;dhh&#x2F;you-can-t-get-faster-than-no-build-7a44131c&quot;&gt;You can&#x27;t get faster than No Build&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;x.com&#x2F;dhh&#x2F;status&#x2F;1769903387527790975&quot;&gt;#NoBuild on X.com&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;world.hey.com&#x2F;dhh&#x2F;modern-web-apps-without-javascript-bundling-or-transpiling-a20f2755&quot;&gt;Modern web apps without JavaScript bundling or transpiling&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;#nobuild å¯¹ Web çš„ä¼—å¤š pack æ¡†æ¶æ€»æ˜¯å¾ˆä¸çˆ½ï¼Œmark ä¸€ä¸‹ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¹‹å‰ä¹Ÿæµ‹è¯•è¿‡ä¸€ä¸ªç½‘ç«™ï¼Œhttps:&#x2F;&#x2F;shoelace.style&#x2F;components&#x2F;badge ç”±äºé‡‡ç”¨äº† HTTP&#x2F;2ï¼Œåœ¨ä¸packçš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½å¿«é€Ÿè®¿é—®ã€‚
DHH æ˜¯ NoBuild çš„å‘èµ·äººï¼Œä¹Ÿæ˜¯ Webpacker(éwebpack) çš„åˆ›å»ºè€…ã€‚ï¼ˆä¸è¿‡ï¼Œå¦‚æœä½¿ç”¨ tsï¼Œè¿˜æ˜¯éœ€è¦ä¸€ä¸ª transpilingï¼‰&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å‡å°‘äº† build æ—¶é—´&lt;&#x2F;li&gt;
&lt;li&gt;ç”±äºä¸å†bundleï¼Œå¯¹å•ä¸ªmoduleçš„ä¿®æ”¹ï¼Œæ— éœ€é‡æ–°buildæ•´ä¸ªé¡¹ç›®ï¼Œä»¥åŠé‡æ–°ä¸‹è½½æ•´ä¸ªå¤§çš„bundleæ–‡ä»¶ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç”±äºä¸å†bundleï¼Œå¯¹å¤šé¡µé¢åº”ç”¨ï¼Œå¯ä»¥æ›´å¥½çš„åˆ©ç”¨æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶ã€‚ï¼ˆä¸åŒé¡µé¢ bundle ä¼šå¯¼è‡´é‡å¤çš„ä¸‹è½½ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;åé¢æ„è§ï¼šhttps:&#x2F;&#x2F;dev.to&#x2F;konnorrogers&#x2F;why-we-still-bundle-with-http2-in-2022-3noo&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å¤ªå¤šçš„ç¢ç‰‡ï¼Œä¼šäº§ç”Ÿç€‘å¸ƒå¼çš„è¯·æ±‚ï¼Œå› ä¸ºæœ‰ä¸€äº›è¯·æ±‚æ˜¯ä¾èµ–äºå…¶ä»–è¯·æ±‚çš„ï¼Œè¿™ç§ä¾èµ–å…³ç³»ï¼Œä¼šå¯¼è‡´ HTTP&#x2F;2 ä¹Ÿæ— æ³•å‘æŒ¥ã€‚ï¼ˆä¼˜åŒ–ï¼šå°†æ·±å±‚æ¬¡çš„ import
æå‡åˆ°ä¸Šä¸€å±‚æ¥ï¼Ÿæ”¹è¿›é‡‡ç”¨ modulepreloadï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;æ— æ³•äº«å— tree shaking å¸¦æ¥çš„å¥½å¤„ï¼Œåè€…å¯ä»¥å‡å°‘ä¸‹è½½çš„å¤§å°ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;Maybe æœ€ä½³å®è·µ:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å¼€å‘é˜¶æ®µï¼Œä¸ä½¿ç”¨ packï¼Œå‡å°‘ build æ—¶é—´ï¼Œå¹¶ä¸”æ–¹ä¾¿ Hot Reload&lt;&#x2F;li&gt;
&lt;li&gt;ç”Ÿäº§é˜¶æ®µï¼Œè½¬ä¸º package, module ä¸¤ä¸ªå±‚çº§ï¼Œåœ¨ package ä¸Šè¿›è¡Œ pack, ä¸€ä¸ª package ä½œä¸ºä¸€ä¸ª å‰ç«¯çš„å•å…ƒã€‚æºä»£ç çº§åˆ«çš„ module å¤ªç»†ç²’åº¦äº†ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ä»¥ shoelace é¡¹ç›®ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç»„ä»¶åˆ†ä¸ºï¼šé«˜é¢‘ã€ä½é¢‘ã€åºå¤§çš„ç»„ä»¶ï¼Œæ‹†åˆ†ä¸º3-5ä¸ª packageã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;levelup.gitconnected.com&#x2F;signals-behind-the-scenes-19cbcb6b802b&quot;&gt;Signals behind the scenes&lt;&#x2F;a&gt; ä»‹ç»äº†å“åº”å¼æ¬¾æ¶ ä¸­
Signal API çš„å®ç°åŸç†ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Variable Manager: æ˜¯æˆ‘è®¾è®¡çš„ä¸€ä¸ªæ›´ä¸ºå®è§‚å±‚é¢ï¼ˆå“åº”è”è·¯æ›´é•¿ã€ä¸”æ”¯æŒå¼‚æ­¥å¤„ç†ï¼‰çš„å‰ç«¯å˜é‡å“åº”å¼ç®¡ç†å™¨ï¼Œç›®å‰åœ¨å†…éƒ¨äº§å“ä¸­ä½¿ç”¨ï¼Œåç»­æ•´ç†æˆæŠ€æœ¯æ–‡ç« ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;ekino-france&#x2F;webassembly-the-future-of-backend-development-b40bdc7c5cb4&quot;&gt;Wasm: 2023å¹´æŠ¥å‘Š&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ä½œä¸º Plugin ä½¿ç”¨ã€‚ ä¾‹å¦‚ nginx pluginã€‚ç›¸æ¯” LUA æ¥è¯´ï¼Œå¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½ã€å®Œæˆæ›´å¤æ‚çš„åŠŸèƒ½ï¼Œä»¥åŠä½¿ç”¨å¼€å‘è€…æ›´ç†Ÿæ‚‰çš„ç¼–ç¨‹è¯­è¨€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç›®å‰ï¼Œæˆ‘è§‰å¾—æœ€ä¸ºç¼ºå¤±çš„ï¼Œæ˜¯ç¼ºå°‘ Debugger æ”¯æŒï¼Œå¯¹å¼€å‘è€…æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„éšœç¢ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.scala-js.org&#x2F;news&#x2F;2024&#x2F;09&#x2F;28&#x2F;announcing-scalajs-1.17.0&#x2F;&quot;&gt;scala-js 1.17.0 æ”¯æŒ Wasm&lt;&#x2F;a&gt; æš‚æ—¶è¿˜æ˜¯å®éªŒæ€§è´¨ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;keynmol&#x2F;scalajs-wasm-game-of-life&quot;&gt;Game of life Demo in scala-js WASM&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Vega-altair: Declarative Visualization in Python ä¸€ä¸ª Python çš„å¯è§†åŒ–åº“ï¼Œæ”¯æŒå£°æ˜å¼çš„å¯è§†åŒ–è®¾è®¡ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;vega.github.io&#x2F;vega-lite&#x2F;&quot;&gt;Vega-Lite&lt;&#x2F;a&gt; åŸºäº Vegaï¼Œæ›´åå‘äºç”¨æˆ·å±‚, æ•°æ®æè¿°å¼é£æ ¼&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;vega.github.io&#x2F;vega&#x2F;&quot;&gt;Vega&lt;&#x2F;a&gt; ä¸€ä¸ªæ›´åº•å±‚çš„å›¾è¡¨æè¿°è¯­è¨€ï¼Œæ›´å½’ä¸€åŒ–ï¼Œå‘½ä»¤å¼é£æ ¼&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;observablehq.com&#x2F;@vega&quot;&gt;vega on observablehq&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;observablehq.com&#x2F;@vega&#x2F;how-vega-works&quot;&gt;How vega works&lt;&#x2F;a&gt;: ä¸€ç¯‡ä»‹ç» vega çš„å†…éƒ¨workflowçš„æ–‡ç« ï¼Œpipeline(data flow) + react æ˜¯å…¶æ ¸å¿ƒã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;vega.github.io&#x2F;vega&#x2F;about&#x2F;vega-and-d3&#x2F;&quot;&gt;Vega and D3&lt;&#x2F;a&gt; d3ç›¸æ¯”vegaæ›´ä¸ºlow level&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;234762889&quot;&gt;æŠ€æœ¯äººå‘˜çœ¼ä¸­çš„BIä¹‹å¯è§†åŒ– â€”â€” æ ‡å‡†å®¶ï¼šVega &amp;amp; Vega-Lite&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;å½“ä½¿ç”¨Vega-Liteå’ŒVoyageræ—¶ï¼Œæ€»æœ‰ç§â€å°tableauâ€œçš„æ„Ÿè§‰ï¼Œå’Œtableauç¥ä¼¼ã€‚è¿™ä¹Ÿå¼•å‡ºäº†æ˜¯ä¸æ˜¯æœ‰äº†Vega-Liteå’ŒVoyagerï¼Œ
æˆ‘ä»¬å…¶å®å°±å…·å¤‡äº†ä¸€ä¸ªå°å‹çš„BIã€‚
Vega ä¸ Tableau æœ‰ç›¸è¿‘çš„æ¸Šæºã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸çŸ¥é“ vega çš„æ€§èƒ½è¡¨ç°å¦‚ä½•ï¼Ÿå¯ä»¥è¯„ä¼°ä½¿ç”¨ wasm æˆ–è€… webgl&#x2F;webgpu æ¥è¿›è¡ŒåŠ é€Ÿï¼Ÿ&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ https:&#x2F;&#x2F;vega.github.io&#x2F;vega&#x2F;about&#x2F;vega-and-d3&#x2F; æ–‡ä¸­æåˆ°äº† canvas æ€§èƒ½ä¸ SVG çš„å¯¹æ¯”ï¼š&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡å¼•å…¥ä¸€ä¸ªä¸­é—´å±‚ scenegraph, Vega å¯ä»¥æ¸²æŸ“ä¸º canvas æˆ–è€… SVGï¼Œ åœ¨å®Œæ•´åˆ·æ–°æ—¶ï¼ŒCanvas å¯ä»¥æä¾›2-10å€çš„é€Ÿåº¦æå‡
è€Œ SVG åˆ™æ›´é€‚åˆäºæ— é™æ”¾å¤§ï¼Œå¯æ‰“å°èƒ½åŠ›ã€‚Vega å¯ä»¥æ‰©å±•åˆ°ä½¿ç”¨ WebGL æ¥è¿›è¡Œæ¸²æŸ“ï¼ˆä¸è¿‡ï¼Œhttps:&#x2F;&#x2F;github.com&#x2F;vega&#x2F;vega-webgl-renderer
è¿™ä¸ªé¡¹ç›®ä¼¼ä¹å·²ç»8å¹´æ²¡æœ‰ç»´æŠ¤äº†ï¼Œå…¶Demoåœ¨ç°æœ‰çš„æµè§ˆå™¨ä¸­éƒ½æ— æ³•æ­£ç¡®è¿è¡Œï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;monthly&#x2F;2024-09&#x2F;vega-arch.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;observablehq&#x2F;framework&quot;&gt;Observable Framework&lt;&#x2F;a&gt; JS&#x2F;TS çš„ notebook.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dev.to&#x2F;aralroca&#x2F;build-reactive-web-components-with-ssr-3pb9?utm_source=dormosheio&amp;amp;utm_campaign=dormosheio&quot;&gt;Build Reactive Web Components with SSR&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;https:&#x2F;&#x2F;brisa.build è¿™ä¸ª framework è¿˜æ²¡æœ‰open source, ä» doc æ¥çœ‹ï¼Œæä¾›çš„ API å°¤å…¶æ˜¯ CLI API æ¯”è¾ƒå‹å¥½ã€‚ Lité¡¹ç›®çš„ SSR æ„Ÿè§‰è¿˜ä¸æ˜¯å¾ˆç®€å•ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;tools&quot;&gt;Tools&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;books&quot;&gt;Books&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æœ¬æœˆå…¥æ‰‹ rust-under-the-hood ä»ç”Ÿæˆçš„æ±‡ç¼–ä»£ç æ¥ç†è§£ Rust è¯­è¨€ã€‚&lt;&#x2F;p&gt;

&lt;img src=&quot;https:&amp;#x2F;&amp;#x2F;wangzaixiang.github.io&amp;#x2F;processed_images&amp;#x2F;rust-under-the-hood.ba739e2bbbce9dfe.png&quot; &#x2F;&gt;
&lt;p&gt;ä¹‹å‰ä¹Ÿæ–­ç»­é˜…è¯»è¿‡ä¸€äº› Rust ç¼–è¯‘ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ï¼Œç¡®å®ï¼Œä»æ›´ä½æˆæœ¬çš„è§’åº¦æ¥ç†è§£è¯­è¨€ç‰¹æ€§å’Œæ¦‚å¿µï¼Œå¾€å¾€ä¼šå¸¦æ¥æ›´ä¸ºæ·±åˆ»çš„ç†è§£ã€‚æ›´ä½•å†µ
Rust è‡ªèº«ä¹Ÿæ˜¯é¢å‘åº•å±‚çš„ä¸€é—¨è¯­è¨€ï¼Œå„ç§ç‰¹æ€§çš„è®¾è®¡éƒ½ä¸å†…å­˜ã€CPU ä¼˜åŒ–å¯†åˆ‡å…³è”ã€‚å¾ˆå¤šåœ¨ä¸Šå±‚å¤æ‚çš„æ¦‚å¿µï¼Œå¾€å¾€åªæ˜¯åœ¨ä¸Šå±‚ä¸­ä¸åŒ
è§’åº¦çš„æŠ•å½±ï¼Œåœ¨åº•å±‚åè€Œç®€å•æ˜äº†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;èµ¶åœ¨æœˆåº•ä¹‹å‰ï¼ŒæŠŠè¿™æœ¬ä¹¦å¤§æ¦‚ç¿»äº†ä¸€éï¼Œå¯¹ Rust &#x2F; LLVM çš„ä»£ç ä¼˜åŒ–æœ‰äº†è¿›ä¸€æ­¥çš„äº†è§£ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ç›¸å…³æŠ€æœ¯æ”¶é›† ...</title>
        <published>2024-08-22T12:00:00+00:00</published>
        <updated>2024-08-22T12:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/sql-optimize/"/>
        <id>https://wangzaixiang.github.io/blog/sql-optimize/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/sql-optimize/">&lt;h2 id=&quot;you-hua-ce-lue-summary&quot;&gt;ä¼˜åŒ–ç­–ç•¥ Summary&lt;&#x2F;h2&gt;
&lt;p&gt;æ¯ä¸€ä¸ªç« èŠ‚éƒ½å¯ä»¥å†™è‹¥å¹²è®ºæ–‡&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Expression Rewriter&lt;&#x2F;li&gt;
&lt;li&gt;Filter Push-down&lt;&#x2F;li&gt;
&lt;li&gt;Join
&lt;ul&gt;
&lt;li&gt;ç®—æ³•é€‰æ‹©ï¼š Hash(parallel, grace), Sort(full, partial),&lt;&#x2F;li&gt;
&lt;li&gt;è¡¨é¡ºåº&lt;&#x2F;li&gt;
&lt;li&gt;filter push-down&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Subquery as Join
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;ericfu.me&#x2F;subquery-optimization&#x2F;&quot;&gt;å­æŸ¥è¯¢çš„æŸ¥è¯¢ä¼˜åŒ–&lt;&#x2F;a&gt;ï¼š Executor -&amp;gt; Evaluator -&amp;gt; Executor çš„æ‰§è¡Œæ¨¡å¼æ˜¯éå¸¸ä½æ•ˆçš„&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;ericfu.me&#x2F;calcite-top-down-planner&quot;&gt;Calcite ä¸­æ–°å¢çš„ Top-down ä¼˜åŒ–å™¨&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Window å‡½æ•°ä¼˜åŒ–
&lt;ul&gt;
&lt;li&gt;çª—å£ï¼šé‡ç”¨çª—å£ã€å¢é‡å¼çª—å£&lt;&#x2F;li&gt;
&lt;li&gt;èšåˆï¼šå¢é‡å¼èšåˆ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;group-by + èšåˆå‡½æ•°ä¼˜åŒ–
&lt;ul&gt;
&lt;li&gt;åˆ†åŒº: map-reduce&lt;&#x2F;li&gt;
&lt;li&gt;avg() è½¬æ¢ä¸º SUM()&#x2F;COUNT()&lt;&#x2F;li&gt;
&lt;li&gt;æ¶ˆé™¤ grouped dataframe&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;å‡æ
&lt;ul&gt;
&lt;li&gt;è£å‰ªåˆ—&lt;&#x2F;li&gt;
&lt;li&gt;è£å‰ªè¡¨ï¼ˆå…³è”ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;ç´¢å¼•ä¼˜åŒ–
&lt;ul&gt;
&lt;li&gt;minmax&lt;&#x2F;li&gt;
&lt;li&gt;bloom&lt;&#x2F;li&gt;
&lt;li&gt;bitmap&lt;&#x2F;li&gt;
&lt;li&gt;sorted index&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;vectorized using SIMD + GPU&lt;&#x2F;li&gt;
&lt;li&gt;cache, material CTE&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;mysql&quot;&gt;MySQL&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;8.0&#x2F;en&#x2F;select-optimization.html&quot;&gt;Optimizing SELECT Statements&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;8.0&#x2F;en&#x2F;where-optimization.html&quot;&gt;WHERE Clause Optimization&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;ç§»é™¤ä¸å¿…è¦çš„æ‹¬å· (è¡¨è¾¾å¼ä¼˜åŒ–)&lt;&#x2F;li&gt;
&lt;li&gt;Constant folding &lt;code&gt;(a&amp;lt;b AND b=c) AND a=5&lt;&#x2F;code&gt; -&amp;gt; &lt;code&gt;b&amp;gt;5 AND b=c AND a=5&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Constant condition removal.&lt;&#x2F;li&gt;
&lt;li&gt;count(*) ä¼˜åŒ–&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨æ²¡æœ‰ group by æ—¶ï¼Œ having åˆå¹¶åˆ° WHERE ä¸­&lt;&#x2F;li&gt;
&lt;li&gt;where ä¸‹æ²‰åˆ° join è¡¨&lt;&#x2F;li&gt;
&lt;li&gt;constant tables æå‰è¯»å–&lt;&#x2F;li&gt;
&lt;li&gt;join é¡ºåºï¼šå¦‚æœ order by &#x2F; group by å­—æ®µæ¥æºäºå•ä¸ªè¡¨ï¼Œåˆ™è¿™è¡¨ä¼˜åŒ–ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;8.0&#x2F;en&#x2F;range-optimization.html&quot;&gt;Range Optimization&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;8.0&#x2F;en&#x2F;window-function-optimization.html&quot;&gt;Window Function Optimization&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœå­æŸ¥è¯¢å…·æœ‰çª—å£å‡½æ•°ï¼Œåˆ™ç¦ç”¨å­æŸ¥è¯¢çš„æ´¾ç”Ÿè¡¨åˆå¹¶ã€‚å­æŸ¥è¯¢æ€»æ˜¯å…·ä½“åŒ–çš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åŠè¿æ¥ä¸é€‚ç”¨äºçª—å£å‡½æ•°ä¼˜åŒ–ï¼Œå› ä¸ºåŠè¿æ¥é€‚ç”¨äº WHEREå’Œä¸­çš„å­æŸ¥è¯¢JOIN ... ONï¼Œå…¶ä¸­ä¸èƒ½åŒ…å«çª—å£å‡½æ•°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¼˜åŒ–å™¨æŒ‰é¡ºåºå¤„ç†å…·æœ‰ç›¸åŒæ’åºè¦æ±‚çš„å¤šä¸ªçª—å£ï¼Œå› æ­¤å¯ä»¥è·³è¿‡ç¬¬ä¸€ä¸ªçª—å£ä¹‹åçš„æ’åºã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¼˜åŒ–å™¨ä¸ä¼šå°è¯•åˆå¹¶å¯ä»¥åœ¨å•ä¸ªæ­¥éª¤ä¸­è¯„ä¼°çš„çª—å£ï¼ˆä¾‹å¦‚ï¼Œå½“å¤šä¸ª OVERå­å¥åŒ…å«ç›¸åŒçš„çª—å£å®šä¹‰æ—¶ï¼‰ã€‚
è§£å†³æ–¹æ³•æ˜¯åœ¨å­å¥ä¸­å®šä¹‰çª—å£å¹¶åœ¨ WINDOWå­å¥ä¸­å¼•ç”¨çª—å£åç§°OVERã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;8.0&#x2F;en&#x2F;subquery-optimization.html&quot;&gt;å­æŸ¥è¯¢ã€æ´¾ç”Ÿè¡¨ã€è§†å›¾ä¸CTEçš„ä¼˜åŒ–&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;subquery: scalar subquery, 1-row subquery, or N-rows subquery&lt;&#x2F;li&gt;
&lt;li&gt;derived table &lt;code&gt;select ... from (subquery) as tbl&lt;&#x2F;code&gt; or &lt;code&gt;select * from JSON_TABLE(arg_list) as tbl&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;view reference&lt;&#x2F;li&gt;
&lt;li&gt;Common Table Expression&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ä¼˜åŒ–ç­–ç•¥ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;IN, = NAY, EXISTS&lt;&#x2F;code&gt; subquery =&amp;gt; Semijoin &#x2F; materialization &#x2F; Exists-Strategy&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;NOT IN, &amp;lt;&amp;gt; ALL, NOT EXITS&lt;&#x2F;code&gt; subquery=&amp;gt;  materialization &#x2F; Exists-Strategy&lt;&#x2F;li&gt;
&lt;li&gt;derived table, view, CTE =&amp;gt; merge into query &#x2F; material&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;ul&gt;
&lt;li&gt;Semi-join ä¼˜åŒ–ï¼šå°†å­æŸ¥è¯¢è½¬åŒ–ä¸º Semi-Join, å¦‚æœå­æŸ¥è¯¢ä½¿ç”¨äº† range æ“ä½œï¼Œæ˜¯æ— æ³•è¿›è¡Œæ”¹ä¼˜åŒ–çš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç‰©åŒ–ï¼šå½“å­æŸ¥è¯¢æ²¡æœ‰å¼•ç”¨å¤–éƒ¨è¡¨çš„å­—æ®µæ—¶ï¼Œæ˜¯å¯ä»¥ç‰©åŒ–çš„&lt;&#x2F;li&gt;
&lt;li&gt;(a, b, c) IN (select ... ) è½¬åŒ–ä¸º exists (select ... where ...)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;8.0&#x2F;en&#x2F;derived-table-optimization.html&quot;&gt;Merging&lt;&#x2F;a&gt;: åœ¨ Mergeing åå†è¿›è¡ŒåŒ–ç®€ï¼Œé¿å…ä¸€æ¬¡é‡å¤çš„å­æŸ¥è¯¢ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Condition pushdownï¼šå°†æŸ¥è¯¢æ¡ä»¶ä¸‹å‹åˆ° CTEã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœéƒ½ä¸èƒ½èµ°ä¸Šè¿°ä¼˜åŒ–ï¼Œåˆ™å¯èƒ½æŒ‰éœ€æ‰§è¡Œï¼Œåœ¨ select éƒ¨åˆ†ï¼Œä¼šå¯¹ç¾èˆªæ‰§è¡Œå­æŸ¥è¯¢ï¼Œå› è€Œä¼šå‡ºç°æ€§èƒ½é—®é¢˜ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;clickhouse&quot;&gt;ClickHouse&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;clickhouse.com&#x2F;docs&#x2F;en&#x2F;guides&#x2F;joining-tables#optimizing-join-performance&quot;&gt;Join ç®—æ³•&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;hash, parallel hash&lt;&#x2F;li&gt;
&lt;li&gt;grace hash: right table è¿‡å¤§æ—¶ï¼Œå°† hashtable æ‹†åˆ†ä¸ºå¤šä¸ªï¼Œæ¯æ¬¡ä»…åœ¨å†…å­˜ä¸­å­˜æ”¾ä¸€ä¸ªåˆ†åŒºï¼Œå…¶ä»–æ”¾åˆ°ç£ç›˜ä¿å­˜ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;full sorting merge: å·¦è¡¨ã€å³è¡¨éƒ½åœ¨å…³è”å­—æ®µä¸Šæ’åº&lt;&#x2F;li&gt;
&lt;li&gt;partial mergeï¼šå³è¡¨åœ¨å…³è”å­—æ®µä¸Šæ’åºã€‚&lt;&#x2F;li&gt;
&lt;li&gt;direct: ç±»ä¼¼äº Hashï¼Œé’ˆå¯¹äºç‰¹å®šçš„å­˜å‚¨å¼•æ“ç±»å‹ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;

&lt;img src=&quot;https:&amp;#x2F;&amp;#x2F;wangzaixiang.github.io&amp;#x2F;processed_images&amp;#x2F;clickhouse-joins.47c9574879666d92.png&quot; &#x2F;&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;clickhouse.com&#x2F;blog&#x2F;clickhouse-fully-supports-joins-part1&quot;&gt;Join Types supported in ClickHouse&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;clickhouse.com&#x2F;blog&#x2F;clickhouse-fully-supports-joins-hash-joins-part2&quot;&gt;Hash Join, Parallel HashJoin, Grace HashJoin&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;clickhouse.com&#x2F;blog&#x2F;clickhouse-fully-supports-joins-full-sort-partial-merge-part3&quot;&gt;Full Sort Merge, Partial Merge Jooin&lt;&#x2F;a&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»æ–‡æ¡£ä¸Šçœ‹ï¼Œå¦‚æœå³è¡¨å·²ç»æ˜¯æ’åºçš„ï¼Œä¹Ÿéœ€è¦åšä¸€æ¬¡æ’åºï¼Œæ„Ÿè§‰è¿™ä¸ªæ˜¯å¤šä½™çš„&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;clickhouse.com&#x2F;blog&#x2F;clickhouse-fully-supports-joins-direct-join-part4&quot;&gt;Direct Join&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;subquery-you-hua&quot;&gt;Subquery ä¼˜åŒ–&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;left join&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT&lt;&#x2F;span&gt;&lt;span&gt; o_orderkey, (
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT&lt;&#x2F;span&gt;&lt;span&gt; c_name
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; CUSTOMER
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;WHERE&lt;&#x2F;span&gt;&lt;span&gt; c_custkey = o_custkey
&lt;&#x2F;span&gt;&lt;span&gt;) AS c_name &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; ORDERS;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT&lt;&#x2F;span&gt;&lt;span&gt; o_orderkey, c_name
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; orders &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;left join&lt;&#x2F;span&gt;&lt;span&gt; customers on c_custkey = o_custkey
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;semi join&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT&lt;&#x2F;span&gt;&lt;span&gt; c_custkey
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; CUSTOMER
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;WHERE&lt;&#x2F;span&gt;&lt;span&gt; c_nationkey = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;86 &lt;&#x2F;span&gt;&lt;span&gt;AND EXISTS(
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;* &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; ORDERS
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;WHERE&lt;&#x2F;span&gt;&lt;span&gt; o_custkey = c_custkey
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt; c_custkey &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; customer 
&lt;&#x2F;span&gt;&lt;span&gt;semi &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;join&lt;&#x2F;span&gt;&lt;span&gt; orders on o_custkey = c_custkey 
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt; _nationkey = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;86
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;group by&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT&lt;&#x2F;span&gt;&lt;span&gt; c_custkey
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; CUSTOMER
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;WHERE &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1000000 &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt; (
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;SUM&lt;&#x2F;span&gt;&lt;span&gt;(o_totalprice)
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; ORDERS
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;WHERE&lt;&#x2F;span&gt;&lt;span&gt; o_custkey = c_custkey
&lt;&#x2F;span&gt;&lt;span&gt; );
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT&lt;&#x2F;span&gt;&lt;span&gt; c_custkey, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;SUM&lt;&#x2F;span&gt;&lt;span&gt;(o_totalprice)
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;From&lt;&#x2F;span&gt;&lt;span&gt; customer &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;left join&lt;&#x2F;span&gt;&lt;span&gt; orders on o_custkey = c_custkey
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;group by&lt;&#x2F;span&gt;&lt;span&gt; c_custkey
&lt;&#x2F;span&gt;&lt;span&gt; having &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1000000 &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;SUM&lt;&#x2F;span&gt;&lt;span&gt;(o_totalprice)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;é›†åˆæ¯”è¾ƒ&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT&lt;&#x2F;span&gt;&lt;span&gt; c_name
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; CUSTOMER
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;WHERE&lt;&#x2F;span&gt;&lt;span&gt; c_nationkey &amp;lt;&amp;gt; ALL (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT&lt;&#x2F;span&gt;&lt;span&gt; s_nationkey &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; SUPPLIER);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt; c_name &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; customer anti semi &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;join&lt;&#x2F;span&gt;&lt;span&gt; supplier on c_nationkey = s_nationkey;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Mandelbrot-set CPU vs GPU comparison</title>
        <published>2024-08-17T15:19:42+00:00</published>
        <updated>2024-08-17T15:19:42+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/mandelbrot-gpu/"/>
        <id>https://wangzaixiang.github.io/blog/mandelbrot-gpu/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/mandelbrot-gpu/">&lt;p&gt;æœ¬æ–‡æ‰¿æ¥ä¸Šä¸€ç‰‡æ–‡ç«  [wgpu ä»£ç é˜…è¯»](@&#x2F;blog&#x2F;2024-08-10-Trying WGPU&#x2F;index.md), åœ¨é˜…è¯» wgpu ä»£ç çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥å¯¹æ¯” CPU å’Œ GPU çš„æ€§èƒ½ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ç®—æ³•ï¼š Mandelbrot Setï¼Œå…¶ä¸­ CPU ç‰ˆæœ¬æ¥è‡ª ã€Š Programming Rust ã€‹ç¬¬äºŒç‰ˆç¬¬2ç« ï¼ˆå•çº¿ç¨‹ï¼‰ã€ç¬¬19ç« ï¼ˆå¤šçº¿ç¨‹ï¼‰ï¼Œ
è¯¦ç»†ä»£ç å¯ä»¥å‚è€ƒï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;mandelbrot_gpu&#x2F;blob&#x2F;main&#x2F;src&#x2F;cpu.rs&quot;&gt;å•çº¿ç¨‹ç‰ˆæœ¬&lt;&#x2F;a&gt;,
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;mandelbrot_gpu&#x2F;blob&#x2F;main&#x2F;src&#x2F;cpu_par.rs&quot;&gt;å¤šçº¿ç¨‹ç‰ˆæœ¬&lt;&#x2F;a&gt;ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å‚è€ƒ&lt;a href=&quot;https:&#x2F;&#x2F;wgpu.rs&quot;&gt;wgpu-rs&lt;&#x2F;a&gt;çš„ä¾‹å­ï¼Œæˆ‘ç¼–å†™äº†ä¸€ä¸ªGPUçš„ç‰ˆæœ¬ï¼Œè¯¦ç»†çš„ä»£ç è¯·å‚è€ƒï¼š&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;mandelbrot_gpu&#x2F;blob&#x2F;main&#x2F;src&#x2F;gpu.rs&quot;&gt;GPUç‰ˆæœ¬&lt;&#x2F;a&gt;ï¼Œ
å¯¹è¿™ä¸‰ä¸ªç‰ˆæœ¬åˆ†åˆ«è¿›è¡Œå¯¹ç…§æ€§èƒ½æµ‹è¯•ï¼šï¼ˆæµ‹è¯•ç¯å¢ƒï¼šM1 Max, 64Gï¼‰&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;CPU(1 thread)&lt;&#x2F;th&gt;&lt;th&gt;CPU(parallel)&lt;&#x2F;th&gt;&lt;th&gt;GPU&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;3.097s&lt;&#x2F;td&gt;&lt;td&gt;0.368s&lt;&#x2F;td&gt;&lt;td&gt;0.064s&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;1x&lt;&#x2F;td&gt;&lt;td&gt;8.4x&lt;&#x2F;td&gt;&lt;td&gt;48.4x&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;p&gt;ä»è¿™ä¸ªæµ‹è¯•ç»“æœæ¥çœ‹ï¼Œä½¿ç”¨ GPU è¿›è¡ŒåŠ é€Ÿçš„æ•ˆæœæ˜¯éå¸¸æ˜¾è‘—çš„ï¼Œç›¸æ¯”å•çº¿ç¨‹æœ‰ 48.4 å€çš„åŠ é€Ÿæ•ˆæœã€‚ç›¸å¯¹äºå¤šçº¿ç¨‹çš„åŠ é€Ÿæ•ˆæœä¹Ÿæœ‰ 6 å€çš„æå‡ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;xiao-jie&quot;&gt;å°ç»“&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;é€šè¿‡ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ª GPU å®ä¾‹ï¼Œå¯¹ webgpu çš„ API å’Œä¸€äº›æ¦‚å¿µ æœ‰äº†æ›´å¥½çš„ç†è§£ã€‚ç®—æ˜¯å…¥äº†ä¸ªé—¨äº†ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç›®å‰åŸºäº webgpu çš„å¼€å‘æ¨¡å¼è¿˜æ˜¯å¤ªç¹çäº†ï¼Œç›¸å½“äºæŠŠç°ä»£è¯­è¨€çš„ link, loading è¿‡ç¨‹éƒ½è¦åœ¨ä»£ç ä¸­å®ç°ä¸€æ¬¡ã€‚ç±»ä¼¼äº Rust GPUã€Bend è¿™æ ·çš„æŠ€æœ¯
æœªæ¥ä¸€å®šä¼šæœ‰å·¨å¤§ç©ºé—´ï¼Œè®© GPU å¼€å‘çš„é—¨æ§›ä¸ CPU å¼€å‘å¯¹é½èµ·æ¥ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç±»ä¼¼äº dataframe ä¸€ç±»çš„å‘é‡è®¡ç®—ï¼ŒGPU åº”è¯¥å…·æœ‰éå¸¸å·¨å¤§çš„æƒ³è±¡ç©ºé—´ã€‚å¯ä»¥å’Œ SIMD å½¢æˆæ›´å¥½çš„æ­é…ï¼šSIMD æ›´è½»ä¾¿ï¼Œä½†é™åˆ¶å¤šï¼Œæå‡å€æ•°æœ‰é™ã€‚
GPU é‡ï¼ˆå†…å­˜å¤åˆ¶ã€CPU&#x2F;GPUååŒï¼‰ï¼Œæ”¯æŒå¤æ‚çš„åˆ†æ”¯ï¼Œå…·æœ‰ç†è®ºä¸Šæ›´é«˜çš„å¹¶å‘åº¦ã€‚è€Œç›®å‰ï¼ŒdataframeæŠ€æœ¯ï¼Œå³ä¾¿åœ¨ SIMD ä¸Šï¼Œä¹Ÿä¼˜åŒ–æœ‰é™ï¼Œ
å¤§éƒ¨ä»½çš„é¡¹ç›®ä¸»è¦ä¾èµ–è¯­è¨€çº§çš„ vectorize, æ˜¾ç¤ºçš„ SIMD ç®—æ³•å¹¶æœªå¤§é‡ä½¿ç”¨ï¼Œæ›´è°ˆä¸ä¸Š GPU äº†ï¼Œè¿™ä¸€å—ï¼Œæœ‰éå¸¸å¹¿é˜”çš„å‘å±•ç©ºæ ¼ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;webgpufundamentals.org&#x2F;webgpu&#x2F;lessons&#x2F;webgpu-fundamentals.html&quot;&gt;wgpu æ•™ç¨‹&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;HigherOrderCO&#x2F;Bend&quot;&gt;Bend: å¹¶è¡Œç¼–ç¨‹è¯­è¨€&lt;&#x2F;a&gt; å¯ä»¥ç›´æ¥åœ¨ GPU ä¸Šæ‰§è¡Œï¼ŒåŸºäº HVM2ï¼Œç±» python çš„å¹¶è¡Œç¼–ç¨‹è¯­è¨€ï¼Œ
ä¸è¿‡ç›®å‰ä»…æ”¯æŒ Cuda GPUã€‚åœ¨æˆ‘çš„ M1 Max ä¸Šæ— æ³•ä½“éªŒã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rust-gpu.github.io&#x2F;blog&#x2F;transition-announcement&#x2F;&quot;&gt;Rust GPU&lt;&#x2F;a&gt; ç›´æ¥å°† Rust ç¼–è¯‘åˆ° GPU ä¸Šæ‰§è¡Œï¼Œ
ç›¸æ¯”åŸºäº wgpu è¿›è¡Œå¼€å‘ï¼Œæ˜“ç”¨æ€§æœ‰æ˜¾è‘—çš„å·®å¼‚ï¼ˆ webgpu çš„å¼€å‘æ¨¡å¼è¿˜æ˜¯å¾ˆ low-level, éœ€è¦æ¨¡æ‹Ÿ linker, loading ç­‰å¤æ‚é€»è¾‘ï¼Œ
ä¼˜ç‚¹å›åˆ°ä¸Šä¸–çºªä½¿ç”¨ win32 API ç¼–å†™ Windows å›¾å½¢ç•Œé¢çš„æ„Ÿè§‰ï¼Œæˆ‘ä»Šå¤©æ˜¯èŠ±äº†3-4ä¸ªå°æ—¶ï¼Œæ‰è®© mandelbrot çš„GPUç‰ˆæœ¬è·‘èµ·æ¥ã€‚
è€Œ RustGPU&#x2F;Bend ç­‰åˆ™è¯•å›¾è®© GPU å¼€å‘æ›´æ¥è¿‘äºç°ä»£çš„ç¼–ç¨‹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;pythonspeed.com&#x2F;articles&#x2F;optimizing-with-simd&#x2F;&quot;&gt;faster Mandelbrot with SIMD&lt;&#x2F;a&gt;
è¿™ä¸ªç®—æ³•å¦‚ä½•åˆ©ç”¨ SIMD è¿›è¡Œä¼˜åŒ–ï¼Œå¯ä»¥ä½œä¸ºä¸€ä¸ªå­¦ä¹ çš„ä¾‹å­ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>August 2024</title>
        <published>2024-08-16T09:19:42+00:00</published>
        <updated>2024-08-16T09:19:42+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/monthly/2024-08/"/>
        <id>https://wangzaixiang.github.io/monthly/2024-08/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/monthly/2024-08/">&lt;h1 id=&quot;languages&quot;&gt;Languages&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.rust-lang.org&#x2F;2024&#x2F;08&#x2F;12&#x2F;Project-goals.html&quot;&gt;Rust Project goals for 2024&lt;&#x2F;a&gt; ä¸º Rust Edition 2024 è¿›è¡Œå‡†å¤‡&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.scala-lang.org&#x2F;blog&#x2F;2024&#x2F;08&#x2F;22&#x2F;scala-3.5.0-released.html&quot;&gt;Scala 3.5.0&lt;&#x2F;a&gt; æ­£å¼å‘å¸ƒ
&lt;ol&gt;
&lt;li&gt;scala-cli ä½œä¸º scala å‘½ä»¤çš„æ›¿ä»£ï¼Œæ­£å¼è¿›å…¥åˆ°å‘å¸ƒç‰ˆæœ¬ã€‚è¿™ä¸ªå‘½ä»¤ç›®å‰ä¹Ÿæ˜¯æˆ‘ç»å¸¸ä½¿ç”¨çš„å·¥å…·ï¼Œç»“åˆ helix ç¼–è¾‘å™¨ï¼Œæœ‰åŸºæœ¬çš„ IDE åŠŸèƒ½ï¼Œå¾ˆå¥½ç”¨äº†ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Named Tuple: è¿™æ˜¯æˆ‘å¾ˆæœŸå¾…çš„ç‰¹æ€§ï¼Œå¾ˆå¤šåœºæ™¯ä½¿ç”¨ Case Class æœ‰ç‚¹é‡ï¼Œä½¿ç”¨ Tuple ç®€å•è½»é‡ï¼Œä½† _1, _2 è¿™æ ·çš„åå­—å®åœ¨ä¸å¯é˜…è¯»ã€‚
ä½“éªŒä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥æŠŠæˆ‘ä»¬ä»£ç ä¸­çš„ Tuple éƒ½æ›¿æ¢åˆ° NamedTupleã€‚&lt;&#x2F;li&gt;
&lt;li&gt;trait Dynamic&#x27;s selectDynamic&#x2F;applyDynamic æ”¯æŒ inline &lt;a href=&quot;https:&#x2F;&#x2F;inoio.de&#x2F;blog&#x2F;2024&#x2F;07&#x2F;15&#x2F;scala3-macros-part2&#x2F;&quot;&gt;æ–‡ç« é“¾æ¥&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;WasmGC
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;dartlang&#x2F;dart-3-4-bd8d23b4462a&quot;&gt;Dart3.5&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dev.virtuslab.com&#x2F;p&#x2F;scala-to-webassembly-how-and-why&quot;&gt;ScalaJS&lt;&#x2F;a&gt; æ–‡ä¸­ä¹Ÿæåˆ°ä¸ºä»€ä¹ˆæ˜¯ ScalaJS è€Œé Scala Native&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Rust &amp;amp; Flutter &amp;amp; Web
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;fzyzcjy&#x2F;flutter_rust_bridge&quot;&gt;Rust Flutter Bridge&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;mcmah309&#x2F;rust_core&quot;&gt;rust_core&lt;&#x2F;a&gt; æ¨¡æ‹Ÿ rust core library çš„ dart åº“&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;thlorenz.com&#x2F;rid-site&#x2F;&quot;&gt;Rust Integrated Dart&lt;&#x2F;a&gt; Dart ä¸º main, Rust ä¸º library.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;mpp&quot;&gt;MPP&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;HigherOrderCO&#x2F;hvm&quot;&gt;Higher-order Virtual Machine2&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;HigherOrderCO&#x2F;Bend&quot;&gt;Bend: å¹¶è¡Œç¼–ç¨‹è¯­è¨€&lt;&#x2F;a&gt; ç±» python çš„å¹¶è¡Œç¼–ç¨‹è¯­è¨€ï¼Œå¯ä»¥æ‰§è¡Œåœ¨ Cuda GPU ä¸Šæ‰§è¡Œï¼ŒåŸºäº HVM2&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;tonbo.io&#x2F;blog&#x2F;introducing-tonbo&quot;&gt;tonbo&lt;&#x2F;a&gt; Arrowç³»çš„æ•°æ®åº“å­˜å‚¨å¼•æ“ï¼ŒåŸºäº LSMã€Type Safe Structured Storage, async operation, WASM support.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rust-gpu.github.io&#x2F;blog&#x2F;transition-announcement&#x2F;&quot;&gt;Rust GPU&lt;&#x2F;a&gt; ç›´æ¥å°† Rust ç¼–è¯‘åˆ° GPU ä¸Šæ‰§è¡Œï¼Œæ˜“ç”¨æ€§ç›¸æ¯” wgpu æ›´ç®€å•&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wgpu.rs&quot;&gt;wgpu&lt;&#x2F;a&gt; Rust ä¸‹çš„ WebGPU APIã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
&lt;a href=&quot;https:&#x2F;&#x2F;uwheel.rs&#x2F;post&#x2F;datafusion_uwheel&#x2F;&quot;&gt;uwhell&lt;&#x2F;a&gt; é’ˆå¯¹æ—¶åºæ•°æ®åˆ†æçš„ DataFusion ä¼˜åŒ–&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;web&quot;&gt;Web&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;eisenbergeffect.medium.com&#x2F;web-components-2024-winter-update-445f27e7613a&quot;&gt;2024 state of web components&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;eisenbergeffect.medium.com&#x2F;2023-state-of-web-components-c8feb21d4f16&quot;&gt;2023 state of web components&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.quadratichq.com&quot;&gt;spreadsheet with Python, SQL, and AI&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;filtra.io&#x2F;rust-quadratic-aug-24&quot;&gt;Building A Spreadsheet in Rust with WASM and WebGL&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;pixijs.com&quot;&gt;pixi.js, ä¸€ä¸ªåŸºäºWebGLçš„ Sprites åº“&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;tools&quot;&gt;Tools&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.nushell.sh&quot;&gt;nushell&lt;&#x2F;a&gt; å·²ä½œä¸ºæˆ‘çš„ bash çš„æ›¿ä»£å“&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;lsd-rs&#x2F;lsd&quot;&gt;lsd&lt;&#x2F;a&gt; å·²ä½œä¸ºæˆ‘çš„ ls æ›¿ä»£å“&lt;&#x2F;li&gt;
&lt;li&gt;tree-sitter powered tools
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;helix-editor.com&quot;&gt;helix editor&lt;&#x2F;a&gt;: å·²ä½œä¸ºæˆ‘çš„ vi çš„æ›¿ä»£å“ï¼Œæ— ä¾èµ–ï¼Œè‰¯å¥½çš„ light IDE.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;ast-grep&#x2F;ast-grep&quot;&gt;ast-grep&lt;&#x2F;a&gt;: ä»£ç æœç´¢åˆ©å™¨&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;difftastic.wilfred.me.uk&quot;&gt;difftastic&lt;&#x2F;a&gt;ï¼š å·²ä½œä¸ºæˆ‘çš„ git diff æ›¿ä»£å“ï¼Œä»£ç å¯¹æ¯”æ›´æ¸…çˆ½&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Rust vs C++: A Performance Comparison</title>
        <published>2024-08-15T09:19:42+00:00</published>
        <updated>2024-08-15T09:19:42+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/rust-cpp-comparison/"/>
        <id>https://wangzaixiang.github.io/blog/rust-cpp-comparison/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/rust-cpp-comparison/">&lt;p&gt;æœ¬æ–‡å†…å®¹èŠ‚é€‰è‡ªï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;rustaceans&#x2F;c-vs-rust-a-performance-comparison-46d1a669beb1&quot;&gt;Rust vs C++: A Performance Comparison. Part 1&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;rustaceans&#x2F;rust-vs-c-a-performance-comparison-part-2-646ceeb1fbd4&quot;&gt;Rust vs C++. A Performance Comparison. Part 2&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;rustaceans&#x2F;rust-vs-c-a-performance-comparison-part-3-effective-abstractions-e740e8262ce8&quot;&gt;Rust vs C++. A Performance Comparison. Part 3. Effective abstractions&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Aliasing æ•°æ®åˆ«å&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Reference ä¸åŒäº raw pointerï¼šæ€»æ˜¯æœ‰æ•ˆçš„æŒ‡é’ˆï¼ˆé™¤äº† danglin ï¼‰ï¼Œå¯¹é½ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&amp;amp;T ç¡®ä¿æ•°æ®ä¸å¯å˜ï¼Œå¯ä»¥è¿›è¡Œå¯„å­˜å™¨å­˜å‚¨ç­‰æ¿€è¿›çš„ä¼˜åŒ–æªæ–½ã€‚è¿™åœ¨C++ä¸­å¹¶ä¸å¯è¡Œã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&amp;amp;mut T å¯ä»¥ç¡®ä¿ç‹¬å ï¼Œåœ¨æœ¬æ–‡ä¸­çš„æ¡ˆåˆ—ä¸­ï¼Œmul_by_2 çš„ src å’Œ dest å¯ä»¥ç¡®ä¿ä¸ä¼šå¼•ç”¨åŒä¸€ä¸ªåŒºåŸŸ
ï¼ˆä¸¤ä¸ªsliceæ— æ•°æ®é‡å ï¼‰ï¼Œå› è€Œåœ¨ç”Ÿæˆçš„ä»£ç ä¸­ï¼Œå¯ä»¥è¿›è¡Œå¦‚ä¸‹çš„ä¼˜åŒ–ï¼šä½¿ç”¨ movdqu ç­‰æŒ‡ä»¤ä¸€æ¬¡ç§»åŠ¨ 16 å­—èŠ‚å†…å®¹ï¼ˆç›¸å½“äº2ä¸ªu64)ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœæ˜¯ *const T æŒ‡é’ˆï¼Œåˆ™ä¸ä¼šä¿è¯å¼•ç”¨åŒä¸€ä¸ªåŒºåŸŸï¼Œéœ€è¦å…ˆè¿›è¡Œæ£€æµ‹ï¼Œæ‰èƒ½ä½¿ç”¨ movdqu ç­‰æŒ‡ä»¤è¿›è¡Œç§»åŠ¨å¤„ç†ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;éªŒè¯ä»£ç  &lt;a href=&quot;https:&#x2F;&#x2F;play.rust-lang.org&#x2F;?version=stable&amp;amp;mode=release&amp;amp;edition=2021&amp;amp;gist=412780e50ae0ab4c8c62bf8869808897&quot;&gt;playgroud é“¾æ¥&lt;&#x2F;a&gt;ï¼Œ
å¯ä»¥æŸ¥çœ‹å…¶ç”Ÿæˆçš„ASMä»£ç çš„å·®å¼‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Move è¯­ä¹‰
C++ çš„ std::move æ¨¡æ‹Ÿäº†ä¸€ä¸ª move è¯­ä¹‰ï¼Œä½†åˆä¸èƒ½è±¡ Rust ä¸€æ ·çš„ä¿è¯åŸå§‹å˜é‡ä¸èƒ½å†è¢«è®¿é—®ã€‚æˆ‘å¯¹ C++ 11å¼•å…¥çš„è¿™äº›æ¦‚å¿µ
å¹¶ä¸ç†Ÿæ‚‰ï¼Œåªæ˜¯æ„Ÿè§‰ std::move å’Œ std::forward ç›¸æ¯” rust æ¥è¯´ï¼Œè¦å¤æ‚å¾ˆå¤šã€‚&lt;&#x2F;p&gt;
&lt;p&gt;é€šè¿‡ move è¯­ä¹‰ï¼Œç¼–è¯‘æœŸå¯ä»¥è¿›è¡Œæ›´å¤šçš„ä¼˜åŒ–ï¼Œæ¯”å¦‚åœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä¸å†å¤åˆ¶æ•°æ®ï¼Œè€Œæ˜¯ç›´ä¼ é€’ç”¨æ•°æ®çš„æŒ‡é’ˆï¼Œè¿™æ ·å¯ä»¥é¿å…æ•°æ®çš„å¤åˆ¶ã€‚
éªŒè¯ä»£ç ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;play.rust-lang.org&#x2F;?version=stable&amp;amp;mode=release&amp;amp;edition=2021&amp;amp;gist=19b61fbf97f1734cdb6b52801b2ab03c&quot;&gt;move playground&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ç”±äº rust åšäº†å¤ªå¤šçš„ä¼˜åŒ–ï¼Œå¦‚æœç»“æ„ä½“è¾ƒå°çš„è¯ï¼Œå°±ç›´æ¥é€šè¿‡å¯„å­˜å™¨ä¼ é€’å‚æ•°äº†ï¼Œåè€Œå¯èƒ½ä¸èµ°åœ°å€ä¼ é€’çš„ä¼˜åŒ–ã€‚
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;rust-cpp-comparison&#x2F;rust-c++-1.jpg&quot; alt=&quot;æˆªå›¾&quot; &#x2F;&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Dynamic dispatch
C++ çš„ VTBL å¼€é”€å¯¹ virtual å‡½æ•°æ¥è¯´æ˜¯å¿…ä¸å¯å°‘çš„ï¼ŒåŠæ¯ä¸ªå¯¹è±¡éƒ½ä¼šæºå¸¦ä¸€ä¸ª VTBL æŒ‡é’ˆï¼Œé™¤äº†å ç”¨å†…å­˜çš„
å¼€é”€ä¹‹å¤–ï¼ŒVTBLè°ƒç”¨ä¹Ÿä¼šæ˜¯2æ¬¡è®¿é—®ï¼ŒåŒæ—¶ä¹Ÿé˜»ç¢äº† inline çš„ä¼˜åŒ–ã€‚
è€Œ Rust çš„ Trait å¯ä»¥é€šè¿‡ Generic æ¥å®ç°å®Œå…¨é™æ€çš„å¤šæ€ï¼Œé™¤äº†ä¼šå¢åŠ ä»£ç ä½“ç§¯ä¹‹å¤–ï¼Œæ— è€Œå¤–å¼€é”€ã€‚
ä¹Ÿå¯ä»¥é€šè¿‡&amp;amp;dyn æ–¹å¼å®ç°åŠ¨æ€çš„å¤šæ€ã€‚ç®—æ˜¯ä¸€ä¸ªä¸é”™çš„å¹³è¡¡ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Struct Layout and Padding.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;C++ çš„ struct çš„å†…å­˜å¸ƒå±€ä¸å­—æ®µçš„å®šä¹‰é¡ºåºæœ‰å…³ï¼Œå¯èƒ½ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ã€‚è€Œ Rust é»˜è®¤åˆ™æœ€ä¼˜åŒ–å†…å­˜å¸ƒå±€ï¼Œ
ä»è€Œå‡å°‘å†…å­˜å ç”¨ã€‚(å¯¹ vec&lt;struct&gt; è¿™æ ·çš„åº”ç”¨ï¼Œä¼šå› ä¸ºå‡å°‘å†…å­˜çš„å ç”¨è€Œæé«˜ cache å‘½ä¸­ç‡ï¼Œä»è€Œæé«˜æ€§èƒ½)&lt;&#x2F;li&gt;
&lt;li&gt;Rust çš„ enum ç±»å‹å¾ˆéš¾åœ¨C++ä¸­è¡¨è¾¾&lt;&#x2F;li&gt;
&lt;li&gt;è¯¸å¦‚ Option&lt;T&gt; è¿™æ ·çš„ç±»å‹å¯¹ &amp;amp;T æ¥è¯´æ˜¯é›¶å¼€é”€çš„ï¼Œå³æ ¹æœ¬ä¸å­˜åœ¨ tag çš„å¼€é”€ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆç¥å¥‡çš„è®¾è®¡ï¼Œ&lt;&#x2F;li&gt;
&lt;li&gt;å…¼é¡¾ç®€æ´å’Œæ€§èƒ½ï¼Œå ªç§° Zero Cost Abstract çš„å…¸èŒƒã€‚å†çœ‹çœ‹ Scala çš„ Option ç¬é—´å°±ä¸é¦™äº†ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ Rust ä¸­å¾ˆå¹¿æ³›çš„ä½¿ç”¨ struct åµŒå¥—çš„æ–¹å¼æ¥å®šä¹‰æ–°çš„æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬ Rc, RefCell ç­‰ï¼Œè€Œåœ¨ Scala ä¸­ä¸ºäº†
åˆ°è¾¾ç±»ä¼¼çš„zero costæ•ˆæœï¼Œå¯ä»¥é€šè¿‡ opaque type æ¥å®ç°ï¼Œä½†æ˜¯è¿™æ ·çš„ä»£ç ä¼šæ›´åŠ å¤æ‚ï¼Œè¿˜æ˜¯ Rust çš„è®¾è®¡æ›´åŠ ä¼˜é›…ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Compile-time computations.
åº”è¯¥è¯´ comptime æ–¹é¢ï¼ŒRust é€šè¿‡ const, constexp å…³é”®å­—æä¾›äº†ç®€å•ï¼Œä½†å¹¶ä¸å¤Ÿå¼ºå¤§çš„æ”¯æŒã€‚
åœ¨è¿™æ–¹é¢ï¼ŒC++ã€Zigã€Scalaè¯­è¨€éƒ½èµ°å¾—æ›´è¿œã€‚ä¸è¿‡ï¼ŒRust ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Macro æ¥å®ç°ç›¸ä¼¼çš„åŠŸèƒ½ã€‚
æˆ–è®¸ï¼Œåœ¨ comptime è¿™ä¸€å—ï¼Œæœ€ä¼˜ç‰¹è‰²çš„åº”è¯¥æ˜¯ zig è¯­è¨€äº†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å½“ç„¶ Scala çš„ Macro ä¹Ÿæ˜¯éå¸¸å®Œå¤‡çš„ï¼Œä¸è¿‡å¤æ‚æ€§ä¹Ÿæœ‰äº›ä»¤äººç”Ÿç•äº†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æˆ‘åœ¨ wsql&#x2F;wjson è¿™ä¸¤ä¸ªåº“çš„å¼€å‘ä¸­ï¼Œå€ŸåŠ©äº Macro çš„èƒ½åŠ›ï¼Œæä¾›äº†ç”¨æˆ·å‹å¥½çš„APIï¼Œè¿™äº›æ²¡æœ‰ macro çš„åŠ©åŠ›ï¼Œæ˜¯ä¸å¯èƒ½çš„ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ä» ADT ç±»å‹è‡ªåŠ¨æä¾› ResultSetMapping &#x2F; JsonValueMapping åŠŸèƒ½ï¼ˆåœ¨ Java ä¸­æœ‰ä¸ª mapstruct çš„æ¡†æ¶ï¼Œä¸å¤Ÿæ˜¾ç„¶
æ¯”ä¸ä¸Š wjson&#x2F;wsql æä¾›çš„æ˜ å°„æ”¯æŒçš„ç®€æ´å’Œå¼ºå¤§ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;wsql å¯¹ mysql insert batch çš„è‡ªåŠ¨æ”¹å†™&lt;&#x2F;li&gt;
&lt;li&gt;wsql ä¸­æä¾›çš„ BeanBuilder æä¾›äº†ç±»å‹å¼ºå¤§çš„ ç¼–è¯‘æœŸé—´çš„ BeanCopy åŠŸèƒ½ã€‚å…¼é¡¾æ€§èƒ½ä¸ type safe.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>MDX æ‰§è¡Œå¼•æ“ä¼˜åŒ–æ€è·¯ ...</title>
        <published>2024-08-10T12:00:00+00:00</published>
        <updated>2024-08-10T12:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/mdx-optimize/"/>
        <id>https://wangzaixiang.github.io/blog/mdx-optimize/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/mdx-optimize/">&lt;h2 id=&quot;evaluationcontext-you-hua&quot;&gt;EvaluationContext ä¼˜åŒ–&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;AllMembers&lt;&#x2F;li&gt;
&lt;li&gt;Member(u32)  -- native member&lt;&#x2F;li&gt;
&lt;li&gt;CalcMemberInCube(u32)&lt;&#x2F;li&gt;
&lt;li&gt;CalcMemberInQuery(u32)&lt;&#x2F;li&gt;
&lt;li&gt;SlicedMembers -- å…¨å±€çš„ slice ç­›é€‰ï¼Œä¼šåŒæ—¶è·¨å¤šä¸ªç»´åº¦&lt;&#x2F;li&gt;
&lt;li&gt;FilteredMembers(u32) -- å•ç»´åº¦çš„ç­›é€‰ä¸Šä¸‹æ–‡&lt;&#x2F;li&gt;
&lt;li&gt;ReservedLevel(u32)   -- pseudo&lt;&#x2F;li&gt;
&lt;li&gt;_ReservedOther(u32)
é€šè¿‡æ‰©å±• MemberFilter çš„èƒ½åŠ›ï¼Œæ”¯æŒæ›´å¥½çš„ filter pushdown èƒ½åŠ›ã€‚è§£å†³ç›®å‰ï¼Œä¸èƒ½æœ‰æ•ˆæˆ–æ­£ç¡®çš„ä¸‹æ²‰ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;å½“ MDX æŸ¥è¯¢ä¸­æ¶‰åŠåˆ° filter è½´æ—¶ï¼Œå¦‚æœç®€å•çš„å±•å¼€é›†åˆï¼Œfilter é›†åˆä¼šæ”¾å¤§ MDX çš„è®¡ç®—ã€‚
ä¾‹å¦‚ï¼š filter é›†åˆ ä¸º 1000 æ—¶ï¼Œä¼šå¯¼è‡´æ¯ä¸ª cell çš„è®¡ç®—éƒ½ä¼šè¿›è¡Œ1000æ¬¡çš„è®¡ç®—ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;you-hua-1-slice&quot;&gt;ä¼˜åŒ–1: slice&lt;&#x2F;h2&gt;
&lt;p&gt;å½“ filter é›†åˆä¸æ˜¯ä¸€ä¸ªæ­£äº¤é›†åˆæ—¶ï¼Œä¼šåœ¨ Context ä¸­ä¿å­˜ä¸º sliced: Set[Tuple]&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœå½“å‰ Context ä¸­ filter çš„æ‰€æœ‰ç»´åº¦ï¼Œå…¶å€¼ä¸º SlicedMembers æ—¶ï¼Œ ä¼šå°†å®Œæ•´çš„é›†åˆä¸‹æ²‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœfilterè½´ä¸­éƒ¨åˆ†ç»´åº¦çš„å€¼ä¸º SlicedMembers æ—¶ï¼Œä¼šæ ¹æ®è¿™äº›ç»´åº¦ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„ä¸‹æ²‰æ¡ä»¶ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;you-hua-2-bao-cun-wei-duo-ge-filteredmember&quot;&gt;ä¼˜åŒ–2: ä¿å­˜ä¸º å¤šä¸ª FilteredMemberã€‚&lt;&#x2F;h2&gt;
&lt;p&gt;filterMember ä¼šç›´æ¥ä¼ é€’åˆ° cellRequestï¼Œè€Œæ— éœ€å±•å¼€ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;xia-chen-an-xu-zhan-kai&quot;&gt;ä¸‹æ²‰æŒ‰éœ€å±•å¼€&lt;&#x2F;h2&gt;
&lt;p&gt;å½“è®¡ç®— expr æ—¶ï¼Œ åœ¨è¡¨è¾¾å¼ä¸­ï¼Œéœ€è¦è·å– dim1 ç»´åº¦çš„å½“å‰å€¼è¿›è¡Œè®¡ç®—æ—¶ï¼Œè€Œè¿™ä¸ªç»´åº¦åœ¨ slice æˆ– FilterMemberä¸­æ—¶ï¼Œéœ€è¦å¯¹å…¶å±•å¼€ï¼š&lt;&#x2F;p&gt;
&lt;p&gt;æ­¤æ—¶ï¼Œ slice å’Œ filter ä»ç„¶ä¼šä¼ é€’åˆ° cellRequest ä¸­ (è®¡ç®—åº¦é‡ ä¸ è®¡ç®—æˆå‘˜çš„ä¼˜å…ˆçº§é—®é¢˜ï¼Œéœ€è¦æœ‰ expr çš„å†èšåˆæ–¹å¼)ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;filter-han-shu-you-hua&quot;&gt;filter å‡½æ•°ä¼˜åŒ–&lt;&#x2F;h2&gt;
&lt;p&gt;å°è¯•å°† filter å‡½æ•°ä¼˜åŒ–æˆä¸ºæ”¯æŒå¦‚ä¸‹èƒ½åŠ›çš„å‡½æ•°ï¼Œå¯ä»¥å¿«é€Ÿæ‰§è¡Œä¸€ä¸ª tuple load.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;loadTuple å‡½æ•°è®¾è®¡æ–¹æ¡ˆï¼Œèƒ½å°½é‡ä¸‹ç§°åˆ° SQL æ‰§è¡Œ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;you-hua-xiang-guan&quot;&gt;ä¼˜åŒ–ç›¸å…³&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;member cache&lt;&#x2F;li&gt;
&lt;li&gt;tuple cache&lt;&#x2F;li&gt;
&lt;li&gt;segment cache&lt;&#x2F;li&gt;
&lt;li&gt;compute cache&lt;&#x2F;li&gt;
&lt;li&gt;å…¬å…±è¡¨è¾¾å¼æ¶ˆé™¤&lt;&#x2F;li&gt;
&lt;li&gt;batch-fetch buffer optimization&lt;&#x2F;li&gt;
&lt;li&gt;profile support&lt;&#x2F;li&gt;
&lt;li&gt;å‘é‡åŒ–ä¼˜åŒ–&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;segment-cache&quot;&gt;segment cache&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Cell Request&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å­˜å‚¨ æŸ¥è¯¢ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„ä¿¡æ¯ï¼Œ slice, filter ä¿¡æ¯å¯ä»¥åœ¨è¿™é‡Œä¿å­˜
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;QueryContext {
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å­˜å‚¨ æ¨¡å‹æ¨¡å‹ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ member å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œ cache
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;CubeContext {
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;EvalContext {
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;members&lt;&#x2F;span&gt;&lt;span&gt;: Vec&amp;lt;MemberValue&amp;gt;,
&lt;&#x2F;span&gt;&lt;span&gt;     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;slicer&lt;&#x2F;span&gt;&lt;span&gt;:  Slicer, 
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span&gt;CellRequest {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;members&lt;&#x2F;span&gt;&lt;span&gt;: Vec&amp;lt;MemberValue&amp;gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;pattern&lt;&#x2F;span&gt;&lt;span&gt;: BitMap,     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 1: equals for AllMember, SlicedMember, FilterMember, 0: same shape for PrimaryMember, HierarchyMember
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;enum &lt;&#x2F;span&gt;&lt;span&gt;MemberValue {
&lt;&#x2F;span&gt;&lt;span&gt;    AllMember,
&lt;&#x2F;span&gt;&lt;span&gt;    SlicedMember(&amp;amp;Slicer),    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; åœ¨ slice ä¸­æŒ‡å®š
&lt;&#x2F;span&gt;&lt;span&gt;    PrimaryMember(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;),   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å¯¹åº”äºéå±‚æ¬¡ç»´åº¦ä¸‹çš„ä¸€ä¸ªåŸºç¡€æˆå‘˜ï¼ˆsql ç»‘å®šå•ä¸ªå­—æ®µï¼‰
&lt;&#x2F;span&gt;&lt;span&gt;    HierarchyMember(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å¯¹åº”äºå±‚æ¬¡ç»´åº¦ä¸‹çš„ä¸€ä¸ªæˆå‘˜ï¼ˆsql ç»‘å®šå¤šä¸ªå­—æ®µï¼‰
&lt;&#x2F;span&gt;&lt;span&gt;    FilterMember(&amp;amp;Filter),    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å¯¹åº”äºä¸€ä¸ª filter member, ä¾‹å¦‚ it &amp;gt; &amp;#39;2023-01-01&amp;#39; and it &amp;lt; &amp;#39;2023-12-31&amp;#39;
&lt;&#x2F;span&gt;&lt;span&gt;    CalcMember(&amp;amp;CalcMember),  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å¯¹åº”äºä¸€ä¸ªè®¡ç®—æˆå‘˜ï¼Œ åœ¨ CellRequest ä¸­ï¼Œä¸ä¼šå‡ºç°
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; MemberValue å¯ä»¥ç¼–ç ä¸º MemberValue16, MemberValue32
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;trait &lt;&#x2F;span&gt;&lt;span&gt;CellRequestBuffer {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;cellRequest_exists&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;request&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;CellRequest) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;bool&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;add_cellRequest&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;request&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;CellRequest, value);
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;trait &lt;&#x2F;span&gt;&lt;span&gt;SegmentLoader {
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;load&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;requestBuffer&lt;&#x2F;span&gt;&lt;span&gt;: CellRequestBuffer) -&amp;gt; Segment;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;trait &lt;&#x2F;span&gt;&lt;span&gt;Segment {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;cellRequest_matches&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;request&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;CellRequest) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;bool&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;get_cell&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;self&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;request&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;CellRequest) -&amp;gt; Option[Value];
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ol&gt;
&lt;li&gt;MemberValue16
bit0: 0: 1: ALL(0)&#x2F;PrimaryMember(n)  æœ€å¤šå¯è¡¨ç¤º 32K æˆå‘˜
bit1: 1:
10_b13 SliceMember(0)&#x2F;FilteredMember(n) -- æœ€å¤š 16K ä¸ªåˆ‡ç‰‡æˆå‘˜
11_b13 CalMember(n) -- æœ€å¤š 16K ä¸ªè®¡ç®—æˆå‘˜&lt;&#x2F;li&gt;
&lt;li&gt;MemberValue32
åšå¤šå¯è¡¨ç¤º 2^31ï¼ˆ 2G ä¸ªæˆå‘˜ ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;åœ¨ä¸€ä¸ªæŸ¥è¯¢ä¸­ï¼Œå¯èƒ½ä¼šæ„é€ å½“é‡çš„ CellRequest, ä¸”å‡ºç°é‡å¤è¯·æ±‚çš„æƒ…å†µå¾ˆå¤šï¼Œå› æ­¤ï¼Œéœ€è¦ä¸€ä¸ªéå¸¸é«˜æ•ˆçš„ hashmap æ¥è¿›è¡Œç¼“å­˜ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;MemberValue å°½å¯èƒ½ç¼–ç ä¸º i16&#x2F;i32, å‡å°‘å†…å­˜å ç”¨ï¼Œå¹¶ä¸”æœºåˆ¶ hash è®¡ç®—ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;cellRequest ä»¥ trait è®¾è®¡ï¼Œæä¾›å‡ ä¸ªç²¾ç®€çš„å®ç°ï¼Œæœ€å°åŒ–å†…å­˜ä½¿ç”¨ï¼š
&lt;ul&gt;
&lt;li&gt;CompactCellRequest32: 32 å­—èŠ‚å¤§å°ï¼Œ æœ€å¤šæ”¯æŒ 15ä¸ª ç»´åº¦ï¼Œ æ¯ä¸ª member æ”¯æŒ 2å­—èŠ‚ç¼–ç æˆ– 4å­—èŠ‚ç¼–ç ã€‚ pattern ä½¿ç”¨ 2 å­—èŠ‚ã€‚
å…¶ä¸­ 2å­—èŠ‚å¯è¡¨ç¤º 2^15 ä¸ª æˆå‘˜ï¼ˆSlice&#x2F;Filter&#x2F;ALL ä¿ç•™è‹¥å¹²æˆå‘˜ï¼‰ï¼Œ å¯å¤„ç†å¤§éƒ¨ä»½çš„å°ç»´åº¦ã€‚ 4å­—èŠ‚å¯è¡¨ç¤º 2^31 ä¸ª memberã€‚&lt;&#x2F;li&gt;
&lt;li&gt;CompactCellRequest64: 64 å­—èŠ‚å¤§å°ï¼Œæœ€å¤šæ”¯æŒ 30 ä¸ª ç»´åº¦ã€‚ bitmap ä½¿ç”¨ 4å­—èŠ‚ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;CompactCellRequest128: 128 å­—èŠ‚å¤§å°ï¼Œæœ€å¤šæ”¯æŒ 60 ä¸ªç»´åº¦ã€‚ bitmap ä½¿ç”¨ 8å­—èŠ‚ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;CellRequestN: æ”¯æŒä»»æ„çš„ç»´åº¦æ•°é‡ï¼Œä½†æ˜¯å†…å­˜å ç”¨è¾ƒå¤§ï¼Œä¸é€‚åˆå¤§éƒ¨ä»½çš„åœºæ™¯ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ç»“åˆ Rust çš„ HashMap å®ç°ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªé«˜æ•ˆçš„ç¼“å­˜ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å­˜å‚¨ç»“æ„ç´§å‡‘ï¼Œå†…å­˜ä½¿ç”¨å°‘&lt;&#x2F;li&gt;
&lt;li&gt;hash æ•ˆç‡é«˜&lt;&#x2F;li&gt;
&lt;li&gt;å†…å­˜è¿ç»­æ€§å¥½ï¼ˆå¤§éƒ¨ä»½çš„ CellRequest æ˜¯ä¸€ä¸ªçº¯å€¼å¯¹è±¡ï¼Œæ²¡æœ‰äºŒæ¬¡å¼•ç”¨ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;ç»“åˆ HashMap çš„ SIMD å®ç°ï¼ŒæŸ¥æ‰¾æ•ˆç‡é«˜&lt;&#x2F;li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
cell request æ˜¯ä» Context æ¼”å˜æ¥çš„ï¼Œéœ€è¦è®¾è®¡ Context çš„å­˜å‚¨æœºåˆ¶ï¼Œä½¿å¾—è¿™ä¸ªè½¬æ¢å‡ ä¹0æˆæœ¬&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ä¸ Javaå®ç°å¯¹æ¯”ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;RolapEvaluator å¯ä»¥é€šè¿‡ savepoint&#x2F;restore æœºåˆ¶æ¥å®ç°å…±äº«ä¸€ä¸ª evaluatorï¼Œ ä»¥èŠ‚çœå†…å­˜ä½¿ç”¨ã€‚æ›´æ¢ä¸€ä¸ª member éœ€è¦åœ¨ history ä¸­å¢åŠ 
SET_CONTEXT index member 3ä¸ªå¯¹è±¡ï¼Œ è‡³å°‘24å­—èŠ‚ï¼Œå½“æœ‰2-3ä¸ªå­—æ®µæ›´æ–°æ—¶ï¼Œè¿™ä¸ªæˆæœ¬è¿˜ä¸å¦‚ç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Context è½»é‡&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Expr cache
å½“ EvalContext ä¸­åŒ…æ‹¬è‡³å°‘1ä¸ªè®¡ç®—æˆå‘˜æ—¶ï¼Œ å¯ä»¥å¯¹ Expr è¿›è¡Œç¼“å­˜ï¼Œä»¥å‡å°‘è®¡ç®—æˆå‘˜çš„è®¡ç®—æˆæœ¬ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¯¹å½“å‰ MDXï¼Œ æ¯ä¸€ä¸ª AST node éƒ½å¯ä»¥ç”Ÿæˆä¸€ä¸ª è®¡ç®—åº¦é‡ï¼Œæœ‰ä¸€ä¸ªæŸ¥è¯¢çº§çš„ ExprIdï¼Œä»¥åŠ Expr çš„ä¾èµ–ç»´åº¦åˆ—è¡¨ã€‚
eval(Expr)æ—¶ï¼Œ ä¼šæ ¹æ® (ExprId, EvalContext.with(expr.dependencies)) æ¥æŸ¥æ‰¾ç¼“å­˜ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸æ˜¯æ‰€æœ‰çš„ Expr éƒ½ä¼šè¿›å…¥è¿™ä¸ªç¼“å­˜ï¼Œä¸€èˆ¬çš„ï¼Œç³»ç»Ÿä¸­éƒ¨åˆ† expr ä¼šæ ¹æ®è§„åˆ™ï¼Œè¿›å…¥è¿™ä¸ªç¼“å­˜ã€‚å¯ä»¥åœ¨ MDX ä¸­ä½¿ç”¨ç‰¹æ®Šçš„å‡½æ•°æ¥æ§åˆ¶è¿™ä¸ªè§„åˆ™ã€‚ä¾‹å¦‚ï¼š&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;  (&#x2F;*expr-cache*&#x2F; expr )
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;segment cache&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¯ä»¥åœ¨å¤šä¸ª MDX queryä¹‹é—´å…±äº« segment cache.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;scala&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-scala &quot;&gt;&lt;code class=&quot;language-scala&quot; data-lang=&quot;scala&quot;&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;key: (cubeId, cubeVersion, shape, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;CellRequestCrossJoin&lt;&#x2F;span&gt;&lt;span&gt;):
&lt;&#x2F;span&gt;&lt;span&gt;  cubeId
&lt;&#x2F;span&gt;&lt;span&gt;  cubeVersionï¼š æ¯æ¬¡æŠ½å–åï¼ŒcubeVersion + &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1
&lt;&#x2F;span&gt;&lt;span&gt;  shape
&lt;&#x2F;span&gt;&lt;span&gt;  requests: ä»…å¯¹ CrossJoin Bag è¿›è¡Œç¼“å­˜ï¼Œå­˜å‚¨å„ä¸ªç»´åº¦çš„ å€¼
&lt;&#x2F;span&gt;&lt;span&gt;value: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;SegmentData&lt;&#x2F;span&gt;&lt;span&gt;( HashMap[ compact_cell_data, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Value&lt;&#x2F;span&gt;&lt;span&gt;] )
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;segment cacheï¼š(or using rocksdb as storage.)&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;in memory&lt;&#x2F;li&gt;
&lt;li&gt;in files&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;1ä¸ªshape å¯èƒ½å¯¹åº”å¤šä¸ª Segment, æ˜¯å¦éœ€è¦è¿›è¡Œåˆå¹¶ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;è‡ªåŠ¨çš„ aggregation
å¯¹å®½è¡¨è¿›è¡ŒæŸ¥çœ‹æ—¶ï¼Œå¯ä»¥è¯†åˆ«æ¯ä¸ªæŸ¥è¯¢ä½¿ç”¨åˆ°çš„ç»´åº¦ï¼Œé¢„å…ˆæŒ‰è¿™äº›ç»´åº¦è¿›è¡Œèšåˆã€‚å†åœ¨èšåˆåçš„ç»“æœä¸Šè¿›è¡ŒæŸ¥è¯¢ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;qiu-zhi-you-hua&quot;&gt;æ±‚å€¼ä¼˜åŒ–&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å…¬å…±è¡¨è¾¾å¼æå–&lt;&#x2F;p&gt;
&lt;p&gt;å…³äºå…¬å…±è¡¨è¾¾å¼æå–ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ç®€å•æå–ï¼šå¦‚æœä¸¤ä¸ª AST ç»“æ„ç›¸åŒå¹¶ä¸”å…·æœ‰ç›¸åŒçš„ç±»å‹ï¼Œåˆ™å¯ä»¥å…±äº«åŒä¸€ä¸ª AST treeã€‚
evaluate( tree1, context ) å®Œæˆåï¼Œå¯ä»¥å°†  contetx å’Œ value ä¿å­˜åˆ° treeä¸­ã€‚å½“å†æ¬¡æ‰§è¡Œè¿™ evaluate æ—¶ï¼Œå¦‚æœ context æ²¡æœ‰å˜åŒ–ï¼Œåˆ™æ— éœ€é‡å¤è®¡ç®—ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¼˜åŒ–æå–ï¼šå½“å‰ä»…å½“æ£€æµ‹åˆ° ä¸¤ä¸ª AST ä¼šå…±äº«åŒä¸€ä¸ª context æ—¶ï¼Œæ‰å…±äº«åŒä¸€ä¸ª AST Treeã€‚
åšä¸€ä¸ªæ”¹å†™ï¼Œ åœ¨ ç¬¬ä¸€ä¸ª AST ä¸­ï¼Œ æ”¹å†™ä¸º { val x = ..., x }ï¼Œåç»­ç›´æ¥å¼•ç”¨ x å³å¯ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;è¡¨è¾¾å¼æ˜¯è°ƒç”¨è€…æ±‚å€¼ï¼Œè¿˜æ˜¯å‡½æ•°æ±‚å€¼ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å¯ä»¥æ ‡è®° å‡½æ•°çš„å‚æ•°ï¼Œæ˜¯å¦å¯ä»¥ç”±è°ƒç”¨è€…æ±‚å€¼ï¼ˆåœ¨è°ƒç”¨è€…çš„ context ä¸­ï¼‰ï¼Œè¿˜æ˜¯ç”±å‡½æ•°æ±‚å€¼ï¼Œå¦‚æœç”±å‡½æ•°æ±‚å€¼ï¼Œåˆ™å‡½æ•°å¯èƒ½ä¼šæ”¹å˜ contextã€‚
è¿›è¡Œè¿™ä¸ªæ ‡è®°ï¼Œå¯ä»¥å¸®åŠ©è¿›è¡Œå…¬å…±è¡¨è¾¾å¼çš„æå–ä¼˜åŒ–ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;è¡¨è¾¾å¼ç›¸å…³ç»´åº¦ã€‚
éƒ¨åˆ†çš„ treeï¼Œæ±‚å€¼æ—¶ï¼Œä»…å¼•æ¥ context çš„éƒ¨åˆ†ç»´åº¦ï¼Œè¿™æ—¶ï¼Œå³ä½¿context çš„å…¶ä»–ç»´åº¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå…¶å€¼ä»ç„¶ä¸å˜ã€‚
å°†è¿™ä¸ª mask å­˜å‚¨åœ¨ tree ä¸­ï¼Œåˆ™æ±‚å€¼çš„æ—¶å€™ï¼Œ å¯ä»¥æ›´å¥½çš„è¿›è¡Œä¼˜åŒ–ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;scala&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-scala &quot;&gt;&lt;code class=&quot;language-scala&quot; data-lang=&quot;scala&quot;&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;class&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt; Expr&lt;&#x2F;span&gt;&lt;span&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;val &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;mask&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Set&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Dimension&lt;&#x2F;span&gt;&lt;span&gt;] = Set.empty
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;lastContext&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Context 
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;lastResult&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Value
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;evaluation&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;implicit&lt;&#x2F;span&gt;&lt;span&gt; context) = 
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; context == lastContext then lastResult
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;val &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;depContext &lt;&#x2F;span&gt;&lt;span&gt;= context.keepOnly(mask) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; æ¸…ç†æ— å…³ç»´åº¦
&lt;&#x2F;span&gt;&lt;span&gt;          cache[depContext] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;match 
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;case &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;x &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt;&lt;span&gt; x
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;case &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;_ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt;&lt;span&gt; realyEvaluation(context)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å¯¹å‡½æ•°çš„å‚æ•°ï¼Œå¯ä»¥åˆ†ä¸º3ç±»ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ caller context ä¸­æå‰æ±‚å€¼ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ caller context ä¸­å»¶è¿Ÿæ±‚å€¼ã€‚ï¼ˆä¾‹å¦‚ iif å‡½æ•°ï¼‰&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ callee context ä¸­æ±‚å€¼ã€‚ï¼ˆä¾‹å¦‚ filter å‡½æ•°çš„ conditionalï¼‰&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ä¸€ä¸ªè¡¨è¾¾å¼æ±‚å€¼æ—¶ï¼Œå¦‚æœæ±‚å€¼ f(a, b, c)ï¼Œåœ¨ caller context ä¸­æ±‚å€¼çš„è¡¨è¾¾å¼å¯ä»¥è¿›è¡Œ å…¬å…±è¡¨è¾¾å¼æå–ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥é€’å½’å‘ä¸‹ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœä¸¤ä¸ªè¡¨è¾¾å¼å®Œå…¨ç›¸åŒï¼Œä½†å¯èƒ½è¿è¡Œäºä¸åŒçš„ contextï¼Œ åˆ™å¯ä»¥æŒ‰ (mask, mask(context)) è¿›è¡Œcacheã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ç”±äºä¼ªæ±‚å€¼é˜¶æ®µçš„å­˜åœ¨ï¼Œå¯¹ pseudo value æ˜¯å¦ cache? å¦‚æœä¸ cacheï¼Œåˆ™åœ¨ä¼ªæ±‚å€¼é˜¶æ®µä¼šé‡å¤è®¡ç®—ã€‚å¦‚æœ cacheï¼Œåˆ™ä»€ä¹ˆæ—¶å€™æ¸…ç†æ‰è¿™ä¸ª cacheã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;pi-liang-jia-zai&quot;&gt;æ‰¹é‡åŠ è½½&lt;&#x2F;h2&gt;
&lt;p&gt;åœ¨ MDX æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šæ¶‰åŠåˆ° loadCell çš„è°ƒç”¨ï¼Œç®€å•åŠ è½½æ¨¡å¼ä¸­ï¼Œæ¯æ¬¡ loadCell éƒ½ä¼šå‘èµ·ä¸€ä¸ªSQLè¯­å¥ï¼Œå¹¶
åŒæ­¥ç­‰å¾…ç»“æœè¿”å›ï¼Œ è¿™ç§æ–¹å¼å®ç°ç®€å•ï¼Œä½†ç”±äºä¸€æ¬¡æŸ¥è¯¢è¿‡ç¨‹ä¸­ï¼Œè¿™æ ·çš„ loadCell ä¼šå‘èµ·ä¸Šç™¾æ¬¡ï¼Œä¸Šåƒæ¬¡ï¼Œä¹ƒè‡³ä¸Šç™¾ä¸‡æ¬¡ï¼Œä¸Šåƒä¸‡æ¬¡ï¼Œ
ä¼šå­˜åœ¨å¾ˆä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¼˜åŒ–æ–¹æ¡ˆï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒrequestCell å¹¶ä¸çœŸå®å‘èµ·è¯·æ±‚ï¼Œè€Œæ˜¯å°†å…¶æ”¾å…¥åˆ°ä¸€ä¸ªbufferä¸­ï¼Œå¹¶è¿”å›ä¸€ä¸ª pseudo value
åŒæ—¶å¢åŠ ä¸€ä¸ª dirtyCount.&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœè¡¨è¾¾å¼è®¡ç®—è¿‡ç¨‹ä¸­ï¼ŒdirtyCount æ²¡æœ‰å¢åŠ ï¼Œåˆ™è¿™æ¬¡è®¡ç®—æ—¶æœ‰æ•ˆçš„ï¼Œå¯ä»¥ç›´æ¥ä½œä¸ºè¿”å›å€¼ï¼Œå¹¶è¿›è¡Œ cacheã€‚
å¦åˆ™è¿™ä¸ªè¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ª pseudo valueï¼Œä¸èƒ½è¿›è¡Œ cache.&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨è®¡ç®—ç»“æŸåï¼Œå°† buffer ä¸­çš„ requestCell è¿›è¡Œæ‰¹é‡å¤„ç†ï¼Œå‘èµ·ä¸€ä¸ª SQL è¯·æ±‚ï¼Œä¿å­˜æŸ¥è¯¢ç»“æœï¼Œå¹¶é‡æ–°å‘èµ·è®¡ç®—ï¼Œ
ç›´åˆ° dirtyCount = 0 ä¸ºæ­¢ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;æ¯ä¸ªæ‰¹æ¬¡ï¼Œå¯¹åº”äºä¸€ä¸ª SegmentLoadï¼Œä»–å¯èƒ½è¿”å›è¶…è¿‡è¯·æ±‚ cell æ•°é‡çš„ç»“æœ.&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    def cellRequest( cell: CellRequest):
&lt;&#x2F;span&gt;&lt;span&gt;      cellCache.get(cell) match
&lt;&#x2F;span&gt;&lt;span&gt;        case x =&amp;gt; x
&lt;&#x2F;span&gt;&lt;span&gt;        case None =&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;          cellRequests.add(cell) &#x2F;&#x2F; also increase dirty
&lt;&#x2F;span&gt;&lt;span&gt;          PseudoValue
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    class CellRequestBuffer:
&lt;&#x2F;span&gt;&lt;span&gt;        var dirtyCount: Int = 0
&lt;&#x2F;span&gt;&lt;span&gt;        
&lt;&#x2F;span&gt;&lt;span&gt;        def add(cell: CellRequest): Unit
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;CellRequestBuffer ä¼šæŒ‰ cell çš„ pattern è¿›è¡Œåˆ†ç»„è®°å½•ï¼Œ å…·å¤‡ä¸€ä¸‹ç‰¹æ€§çš„ cell å¯ä»¥å½’å…¥ç»Ÿä¸€åˆ†ç»„ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœ cell1.dim1 çš„å€¼ ä¸º ALL, åˆ™ cell2.dim1 == cell2.dim1&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœ cell1.dim1 çš„å€¼ ä¸º PrimaryMember, åˆ™ cell2.dim1 ä¹Ÿæ˜¯ PrimaryMember(ä¸¤è€…å€¼ä¸ä¸€å®šç›¸ç­‰)&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœ cell1.dim1 ä¸º HierarchyMember, åˆ™ cell2.dim1 ä¹Ÿæ˜¯ HierarchyMember(ä¸¤è€…å€¼ä¸ä¸€å®šç›¸ç­‰)&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœ cell1.dim1 ä¸º FilterMemberï¼Œåˆ™ cell2.dim1 == cell1.dim1&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœ cell1.slice ä¸ä¸ºç©ºï¼Œåˆ™ cell2.slice == cell1.slice&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ç”±ä¸¤ç§æ–¹å¼å¯ä»¥ç»„ç»‡ buffer:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;List[CellRequest] è¿™ç§æ–¹å¼ä¿å­˜çš„æ•°é‡ä¸€èˆ¬ä¼šé™åˆ¶åœ¨ 1000 ä»¥å†…
å¯¹åº”çš„SQL ä¸ºï¼š&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT&lt;&#x2F;span&gt;&lt;span&gt; d1, d2, d3, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;SUM&lt;&#x2F;span&gt;&lt;span&gt;(m1) 
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; cube
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt; (d1, d2, d3) in ( (v1, v2, v3), (v4, v5, v6) ... )
&lt;&#x2F;span&gt;&lt;span&gt;        and (f1 &amp;gt; f1_0 and f1 &amp;lt; f1_1)  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- filter field
&lt;&#x2F;span&gt;&lt;span&gt;        and (s1, s2, s3) in ( (s1_0, s2_0, s3_0), (s1_1, s2_1, s3_1) ... ) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- slice
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Map[ Dim, Set[Member] ] å½“ List[CellRequest] è¾¾åˆ°ä¸€å®šå€¼æ—¶ï¼Œè°ƒæ•´ä¸ºè¿™ä¸ªç»“æ„ã€‚
å¯¹åº”çš„SQL ä¸ºï¼š&lt;pre data-lang=&quot;sql&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sql &quot;&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;SELECT&lt;&#x2F;span&gt;&lt;span&gt; d1, d2, d3, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;SUM&lt;&#x2F;span&gt;&lt;span&gt;(m1)
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span&gt; cube
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt; d1 in (...) and d2 in (...) and d3 in (...)
&lt;&#x2F;span&gt;&lt;span&gt;        and (f1 &amp;gt; f1_0 and f1 &amp;lt; f1_1)  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- filter field
&lt;&#x2F;span&gt;&lt;span&gt;        and (s1, s2, s3) in ( (s1_0, s2_0, s3_0), (s1_1, s2_1, s3_1) ... ) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;-- slice
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
åè€…å¯¹åº”çš„ segmentï¼Œå¯èƒ½ä¼šè¿”å›è¶…è¿‡è¯·æ±‚çš„æ•°æ®ï¼Œå¯ä»¥åŒ¹é…æ›´å¤šçš„ cellRequest è¯·æ±‚ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;ytd-mtd-deng-chuang-kou-lei-han-shu-de-ji-suan-you-hua&quot;&gt;YTD, MTD ç­‰çª—å£ç±»å‡½æ•°çš„è®¡ç®—ä¼˜åŒ–ã€‚&lt;&#x2F;h2&gt;
&lt;p&gt;å…¸å‹çš„ï¼Œä¾‹å¦‚è®¡ç®— &lt;code&gt;stdev&lt;&#x2F;code&gt; èšåˆæ–¹å¼æ—¶ï¼Œå¯ä»¥å‚ç…§ ã€ŠEfficient Processing of Window Functions in Analytical SQL Queries
ã€‹ è®ºæ–‡ä¸­çš„ä¼˜åŒ–æ–¹å¼ï¼Œæå°‘è®¡ç®—é‡ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;loadtuples-han-shu-ding-yi&quot;&gt;LoadTuples å‡½æ•°å®šä¹‰&lt;&#x2F;h2&gt;
&lt;p&gt;å¤šç»´æŸ¥è¯¢æ—¶ï¼ŒåŸºäºäº‹å®è¡¨çš„ tuples ä¼šæ¯” crossjoin æœ‰å¤šä¸ªæ•°é‡çº§ä¸Šçš„ä¸‹é™ï¼Œè€Œåœ¨å¤šäº‹å®æƒ…å†µä¸‹ï¼Œ &lt;code&gt;nonEmptyCrossJoin&lt;&#x2F;code&gt; çš„è¯­ä¹‰å¹¶ä¸æ¸…æ™°ï¼Œå› æ­¤ï¼Œ
æˆ‘è®¾è®¡äº†æ–°çš„ loadTuples è¯­ä¹‰ï¼š&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;loadTuples(
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;dimension:&amp;quot;,    [Dim1], [Dim2], [NS1],  ...,  &#x2F;&#x2F; å…ƒç»„ä¸­ä½¿ç”¨çš„ç»´åº¦ï¼Œæ˜¯å¦æ”¯æŒæ˜¾ç¤ºç»™å®šå±‚æ¬¡ï¼Ÿ
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;showEmpty:&amp;quot;,    true,   false,  false,  ...,  &#x2F;&#x2F; å„ä¸ªç»´åº¦æ˜¯å¦å®¹è®¸æ˜¾ç¤ºç©ºæˆå‘˜ï¼Œå‘½åé›†ä¹Ÿå¯ä»¥è€ƒè™‘æ”¯æŒ showEmpty
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;showSubTotal:&amp;quot;, false,  true,   false,  ...,  &#x2F;&#x2F; å„ä¸ªç»´åº¦æ˜¯å¦æ˜¾ç¤ºå°è®¡ï¼Œå‘½åé›†æ˜ç¡®ä¸æ”¯æŒå°è®¡
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;dimensionContext&amp;quot;: null, ([Dim1]), null, ..., &#x2F;&#x2F; æ˜¾ç¤ºç©ºæˆå‘˜æ—¶ç»´åº¦çš„ç­›é€‰ä¸Šä¸‹æ–‡ï¼Œæˆ–è®¸å¯ä»¥çœç•¥ï¼Œä»Schemaä¸­å¯ä»¥è·å¾—ã€‚
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;where:&amp;quot;,        boolean-expression,           &#x2F;&#x2F; ç­›é€‰Boolè¡¨è¾¾å¼
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;sorts:&amp;quot;,       expr1, expr2, ..., DESC|ASC|BDESC|BASC  &#x2F;&#x2F; æ’åºè®¾å®š
&lt;&#x2F;span&gt;&lt;span&gt;  &amp;quot;viewIds:&amp;quot;, viewId1, viewId2, ...              &#x2F;&#x2F; ä»é‚£äº›äº‹å®è¡¨ä¸­åŠ è½½ç»´åº¦ç»„åˆã€‚
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è¯´æ˜
æ–°å®šä¹‰çš„ LoadTuples å‡½æ•°æ¯”è¾ƒå¤æ‚ï¼Œç»¼åˆäº†å¦‚ä¸‹çš„èƒ½åŠ›ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ˜¾ç¤ºç©ºæˆå‘˜çš„ç»´åº¦ï¼šåœ¨ showEmpty = true ä¸­æŒ‡å®šéœ€è¦æ˜¾ç¤ºç©ºæˆå‘˜çš„ç»´åº¦ï¼Œå…¶ä»–ä¸ºä¸æ˜¾ç¤ºç©ºæˆå‘˜çš„ç»´åº¦ã€‚ï¼ˆç›®å‰ä»…æ”¯æŒæ˜¾ç¤ºç©ºæˆå‘˜çš„ç»´åº¦ä¹‹é—´çš„ç­›é€‰ï¼Œ
ä¸æ˜¾ç¤ºç©ºæˆå‘˜çš„ç»´åº¦ä¸å‚ä¸æ˜¾ç¤ºç©ºæˆå‘˜çš„ç»´åº¦çš„ç­›é€‰ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;ä¸æ˜¾ç¤ºç©ºæˆå‘˜çš„ç»´åº¦&lt;&#x2F;li&gt;
&lt;li&gt;åˆ†ç»„å°è®¡ã€‚ï¼ˆå¯¹å•å±‚æ¬¡ç»´åº¦ï¼Œåˆ›å»º aggreate è®¡ç®—æˆå‘˜ æˆ–è€…æ˜ å°„åˆ° All ï¼Œ å¯¹å¤šå±‚æ¬¡ç»´åº¦ï¼Œå¦‚æœè¯¥ç»´åº¦æœ‰è¿‡æ»¤ï¼Œåˆ™ä½¿ç”¨ VisualTotal å‡½æ•°ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;å¤šäº‹å®è¡¨é€»è¾‘ã€‚ å½“é€‰æ‹© viewId1, viewId2 ç­‰å¤šäº‹å®è¡¨æ—¶ï¼Œç»´åº¦ç»„åˆç¬¦åˆå¦‚ä¸‹é€»è¾‘ï¼š
&lt;ul&gt;
&lt;li&gt;å¦‚æœ viewId1 åŒ…å«çš„è½´ä¸Šç»´åº¦(D_i, D_j, D_k) ä¸ viewId2 çš„è½´ä¸Šç»´åº¦ä¸€è‡´æ—¶ï¼Œ äºŒè€…æ˜¯ä¸€ä¸ª union å…³ç³»ï¼ˆå»é™¤é‡å¤ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœ viewId1 åŒ…å«çš„è½´ä¸Šç»´åº¦(D_i, D_j, Dk)æ˜¯ ViewId2 (D_i, D_j, D_k, D_l)çš„å­é›†æ—¶ï¼Œå¦‚æœ (D_i, D_j, Dk)ç»„åˆåœ¨ (D_i, D_j, D_k, D_l) ä¸­å·²å­˜åœ¨ï¼Œåˆ™ä¸å†é‡å¤å‡ºç°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦åˆ™åŒæ—¶åŒ…å«viewId1çš„å…ƒç»„å’ŒviewId2çš„å…ƒç»„ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;ç­›é€‰èƒ½åŠ›ï¼š
&lt;ul&gt;
&lt;li&gt;å¯¹ç»´åº¦å€¼è¿›è¡Œè¿‡æ»¤çš„ç­›é€‰æ¡ä»¶å¯ä»¥ç›´æ¥ä¸‹æ²‰ï¼ˆåŒ…æ‹¬WHEREåŒºçš„æ¡ä»¶ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨åŸºæœ¬åº¦é‡ä½œä¸ºè¿‡æ»¤æ¡ä»¶ï¼Œä¸å…ƒç»„çš„éƒ¨åˆ†ç»´åº¦ç›¸å…³ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨çª—å£å‡½æ•° + havingå­å¥è¿›è¡Œä¸‹æ²‰&lt;&#x2F;li&gt;
&lt;li&gt;æ›´ä¸ºå¤æ‚çš„è®¡ç®—åº¦é‡æš‚æ—¶ä¸èƒ½ä¸‹æ²‰ï¼Œåœ¨ MDX å¼•æ“ä¸­æ‰§è¡Œã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;æ’åºèƒ½åŠ›ï¼š
&lt;ul&gt;
&lt;li&gt;å¯ä»¥å¯¹ç»´åº¦å€¼è¿›è¡Œè¿‡æ»¤ï¼ˆä¸‹æ²‰ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;å¯ä»¥å¯¹åŸºæœ¬åº¦é‡ï¼ˆä¸éƒ¨åˆ†ç»´åº¦ç›¸å…³ï¼‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨çª—å£å‡½æ•° è¿›è¡Œä¸‹æ²‰&lt;&#x2F;li&gt;
&lt;li&gt;æ›´ä¸ºå¤æ‚çš„è®¡ç®—åº¦é‡æš‚æ—¶ä¸èƒ½ä¸‹ç§°ï¼Œåœ¨ MDX å¼•æ“ä¸­æ‰§è¡Œã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;é¢„æœŸçš„ä¼˜åŠ¿ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;æ–°çš„ loadTuple å‡½æ•°åŸºæœ¬æ¶µç›–äº†ç›®å‰ä»ªè¡¨ç›˜æ„å»ºè½´ä¸Šå…ƒç»„çš„å¤§éƒ¨ä»½èƒ½åŠ›ï¼ˆå¹¶åœ¨æ’åºä¸Šæœ‰æ‰€è¶…è¶Šï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹å¤šäº‹å®çš„å¤„ç†ã€ç­›é€‰èƒ½åŠ›ã€æ’åºèƒ½åŠ›æœ‰æ›´å¥½çš„ä¸‹æ²‰èƒ½åŠ›ï¼Œå¯ä»¥è·å¾—æ›´å¥½çš„æŸ¥è¯¢æ€§èƒ½ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å³ä½¿è€ƒè™‘åˆ°å¤æ‚çš„Whereæ¡ä»¶ï¼ŒloadTupleä»ç„¶æœ‰æ›´å¥½çš„ä¸‹æ²‰èƒ½åŠ›ï¼Œåœ¨ä¸‹æ²‰SQLçš„åŸºç¡€ä¸Šï¼Œå†ç»“åˆä¸èƒ½ä¸‹æ²‰çš„ filter + sort å¤„ç†ï¼Œæ•´ä½“æ€§èƒ½ä¼šæ¯”ç°æœ‰çš„ä¸èƒ½ä¸‹æ²‰çš„åœºæ™¯æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹æ¯”ç°æœ‰çš„ crossjoin &#x2F; nonEmptyCrossJoin&#x2F; dim.membersï¼Œæœ‰æ›´ä¸ºæ¸…æ™°çš„æŸ¥è¯¢è¯­ä¹‰ï¼Œä¾¿äºæ•´ä¸ªæŸ¥è¯¢çš„è´¨é‡æå‡&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;Where è½´ä¸Šçš„æ¡ä»¶ï¼Œåœ¨å¤šäº‹å®è¡¨æƒ…å†µä¸‹ï¼Œéœ€è¦è¿›è¡Œçš„å¤„ç†é€»è¾‘åŒ…æ‹¬ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœ viewId1 ä¸åŒ…å« dim1, åˆ™åœ¨ WHERE æ¡ä»¶åº”ç”¨åˆ° viewId1æ—¶ï¼Œéœ€è¦å¯¹ Bool è¡¨è¾¾å¼è¿›è¡Œå¦‚ä¸‹çš„æ”¹å†™ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœ è¡¨è¾¾å¼ dim1.currentMember oper literal ä½¿ç”¨äº†viewIdä¸­ä¸å­˜åœ¨çš„å­—æ®µï¼Œè¿™ä¸ªè¡¨è¾¾å¼æ”¹å†™ä¸º UNUSED&lt;&#x2F;li&gt;
&lt;li&gt;UNUSED and any  --&amp;gt;  any&lt;&#x2F;li&gt;
&lt;li&gt;UNUSED or any   --&amp;gt; any&lt;&#x2F;li&gt;
&lt;li&gt;NOT UNUSED      --&amp;gt; UNUSED
æœ€åé€æ­¥çš„è¿›è¡ŒåŒ–ç®€ï¼Œå¦‚æœæœ€ååŒ–ç®€çš„è¡¨è¾¾å¼ä¸åŒ…å« UNUSEDï¼Œåˆ™å¯ä»¥ç›´æ¥ä¸‹æ²‰ã€‚å¦‚æœåŒ–ç®€åä¸º UNUSEDï¼Œåˆ™åŒ–ç®€ä¸º true.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;è®¡ç®—æˆå‘˜
åœ¨ä¸æ˜¾ç¤ºç©ºæˆå‘˜æ—¶ï¼Œå¦‚æœç»´åº¦æœ‰è®¡ç®—æˆå‘˜ï¼Œåˆ™åœ¨ LoadTuples ä¸­éœ€è¦è¡¥å……è®¡ç®—æˆå‘˜ã€‚
ï¼ˆD_1, D_2, D_3, ..., D_nï¼‰ä¸­ï¼Œå¦‚æœ D_2, D_3æœ‰è®¡ç®—æˆå‘˜ï¼Œåˆ™éœ€è¦è¡¥å……æˆå‘˜ï¼šfilter( { (D1, D4) } * { D2.calcMembers, D2.calcMemers },  [Measures].[Fact Count] &amp;gt; 0 )&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ç­›é€‰æ¡ä»¶ä¸‹æ²‰
ä»¥ f1 &amp;amp;&amp;amp; f2 &amp;amp;&amp;amp; (f3 || f4) ä¸ºä¾‹, f1 , f2 å¯ä»¥ç‹¬ç«‹ä¸‹æ²‰ï¼Œ f3 || f4 åªèƒ½ä½œä¸ºæ•´ä½“ä¸‹æ²‰ï¼Œå…·å¤‡ä¸‹æ²‰çš„ bool è¡¨è¾¾å¼ f æ»¡è¶³ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;f æ˜¯ TOP å±‚çš„è‡ªæˆå‘˜ï¼Œä¸” TOP å±‚çš„å„ä¸ªè‡ªæˆå‘˜ä¹‹é—´æ˜¯ and å…³ç³»ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;f å½¢å¦‚ dim1.currentMember.caption operate constant ä¸” dim1 åœ¨ä¸æ˜¾ç¤ºç©ºæˆå‘˜ä¸­ï¼Œåˆ™ f å¯ä»¥ä¸‹æ²‰&lt;&#x2F;li&gt;
&lt;li&gt;f å½¢å¦‚ &lt;code&gt;[Measures].[X]&lt;&#x2F;code&gt; operator constant ä¸” X æ˜¯åŸºæœ¬åº¦é‡ï¼Œåˆ™ f å¯ä»¥ä¸‹æ²‰&lt;&#x2F;li&gt;
&lt;li&gt;f å½¢å¦‚ (&lt;code&gt;[Measures].[X], [Dim1].[All Dim1s]&lt;&#x2F;code&gt;) operator constant ä¸” X æ˜¯åŸºæœ¬åº¦é‡ï¼Œåˆ™ f å¯ä»¥ä¸‹æ²‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;f æ˜¯2 AND (3 ä¸ 4çš„ç»„åˆ)ï¼Œåˆ™ f å¯ä»¥ä¸‹æ²‰ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;å…·å¤‡ä¸‹æ²‰æ¡ä»¶çš„è¡¨è¾¾å¼å°†åœ¨å¦‚ä¸‹ç¯èŠ‚æ‰§è¡Œï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;éç©ºåŸºæœ¬å…ƒç»„ï¼ˆéè®¡ç®—æˆå‘˜ï¼‰åœ¨ SQL ä¸­æ‰§è¡Œ&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœè¯¥å­—æ®µæœ‰è®¡ç®—æˆå‘˜ï¼Œä¸”æ˜¾ç¤ºè®¡ç®—æˆå‘˜ï¼Œåˆ™åœ¨è¡¥å……è®¡ç®—æˆå‘˜çš„å…ƒç»„å‰ï¼Œè¿›è¡Œè¿‡æ»¤ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ–°å¢åˆ†ç»„å°è®¡çš„å…ƒç»„ï¼Œåœ¨æ–°å¢å‰ï¼Œè¿›è¡Œè¿‡æ»¤ã€‚
ä¸å…·å¤‡ä¸‹æ²‰æ¡ä»¶çš„è¡¨è¾¾å¼ï¼Œç»Ÿä¸€åœ¨æœ€åçš„ MDX è¿‡æ»¤é˜¶æ®µè¿›è¡Œè¿‡æ»¤ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;è®¡ç®—å…ƒç»„æ—¶ï¼Œè‡ªåŠ¨æºå¸¦è¾…åŠ©çš„è®¡ç®—ï¼ˆå¯ç”¨äºMDXè¿‡æ»¤é˜¶æ®µã€MDXæ’åºé˜¶æ®µï¼‰
åœ¨è®¡ç®—å…ƒç»„çš„å€¼æ—¶ï¼Œå¯ä»¥é™„å¸¦è®¡ç®—ç”¨äºåç»­å¤„ç†æ‰€éœ€çš„å€¼ï¼Œä¾‹å¦‚ filter, order-byã€‚
åœ¨ MDX è¿‡æ»¤é˜¶æ®µï¼Œå¯¹ç»™å®šå…ƒç»„ï¼Œå¦‚æœéœ€è¦å¯¹ç‰¹å®šå€¼è¿›è¡Œæ±‚å€¼ï¼Œå¯ä»¥ä½¿ç”¨ tuple.properties.get( expression ) å…ˆè·å–å€¼ï¼Œå¦‚æœå·²æœ‰å€¼çš„è¯ï¼Œåˆ™æ— éœ€é¢å¤–æ±‚å€¼ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;

&lt;img src=&quot;https:&amp;#x2F;&amp;#x2F;wangzaixiang.github.io&amp;#x2F;processed_images&amp;#x2F;loadTuples.60a78fbdca665da6.png&quot; &#x2F;&gt;</content>
        
    </entry>
    <entry xml:lang="en">
        <title>wgpu ä»£ç é˜…è¯»è®°å½•</title>
        <published>2024-08-10T12:00:00+00:00</published>
        <updated>2024-08-10T12:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/trying-wgpu/"/>
        <id>https://wangzaixiang.github.io/blog/trying-wgpu/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/trying-wgpu/">&lt;h1 id=&quot;yue-du-wgpu-dai-ma-ji-lu&quot;&gt;é˜…è¯» wgpu ä»£ç è®°å½•&lt;&#x2F;h1&gt;
&lt;p&gt;ä¾‹å­ï¼š &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;gfx-rs&#x2F;wgpu&#x2F;tree&#x2F;trunk&#x2F;examples&#x2F;src&#x2F;hello_compute&quot;&gt;hello_compute&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;wgpu-ji-ben-liu-cheng&quot;&gt;wgpu åŸºæœ¬æµç¨‹&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;gfx-rs&#x2F;wgpu&#x2F;blob&#x2F;trunk&#x2F;examples&#x2F;src&#x2F;hello_compute&#x2F;mod.rs&quot;&gt;hello_compiute&lt;&#x2F;a&gt;æ˜¯ä¸€ä¸ªä½¿ç”¨ GPU è¿›è¡Œæ•°å­¦è¿ç®—çš„ç¤ºä¾‹ï¼Œæ ¸å¿ƒçš„ä»£ç ä½äºï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;gfx-rs&#x2F;wgpu&#x2F;blob&#x2F;trunk&#x2F;examples&#x2F;src&#x2F;hello_compute&#x2F;shader.wgsl&quot;&gt;Shader&lt;&#x2F;a&gt; æ˜¯è¿è¡ŒäºGPUä¸Šçš„ä»£ç ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;gfx-rs&#x2F;wgpu&#x2F;blob&#x2F;trunk&#x2F;examples&#x2F;src&#x2F;hello_compute&#x2F;mod.rs#L63&quot;&gt;execute_gpu_inner&lt;&#x2F;a&gt; æ˜¯ä¸GPUè¿›è¡Œäº¤äº’çš„ä»£ç 
ä»£ç å¦‚ä¸‹ï¼ˆè¿›è¡Œäº†ç®€åŒ–ï¼Œè¯¦ç»†çš„ä»£ç è¯·å‚è€ƒ github hello_compute&#x2F;mod.rsï¼‰ï¼Œ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;execute_gpu_inner è¿™ä¸ªä»£ç çš„ç»“æ„è¿˜æ˜¯æœ‰äº›å¤æ‚ï¼Œæˆ‘å¯¹å…¶è¿›è¡Œäº†æ•´ç†ï¼Œå½¢æˆäº†ä¸€ä¸ªæ•°æ®æµå›¾ï¼Œå¯¹ç…§è¿™ä¸ªå›¾æ¥çœ‹ï¼Œå°±æ¯”è¾ƒå¥½ç†è§£ webgpu çš„å„ä¸ªé”™ç»¼å¤æ‚çš„å®ä½“ä¹‹é—´çš„å…³ç³»äº†ã€‚&lt;&#x2F;p&gt;
&lt;div class=&quot;mermaid&quot;&gt;
    ```mermaid
flowchart TD
    device
    shader_source -.-&amp;gt; module
    numbers -. create_buffer_init .-&amp;gt; storage_buffer
    module -..-&amp;gt; pipeline 
    device -.create_buffer.-&amp;gt; staging_buffer
    device -.create_buffer_init.-&amp;gt; storage_buffer
    device -.create_compute_pipeline.-&amp;gt; pipeline
    bind_group_layout
    pipeline -. get_bind_group_layout.-&amp;gt; bind_group_layout
    bind_group_layout -.create_bind_group.-&amp;gt; bind_group
    storage_buffer -.- bind_group
    device -.create_command_encoder.-&amp;gt; encoder
    device -.create_shader_module.-&amp;gt; module
    encoder -.begin_compute_pass.-&amp;gt; cpass
    pipeline -..-&amp;gt; cpass
    bind_group -..-&amp;gt; cpass
    storage_buffer -.encoder_copy_buffer_to_buffer.- staging_buffer
    cpass -.queue_submit_encoder.-&amp;gt; submit
    submit -.device_poll.-&amp;gt; poll 
    staging_buffer -.slice_bounded_receiver.-&amp;gt; receiver
    poll -.-&amp;gt; result
    receiver -.-&amp;gt; result
```
&lt;&#x2F;div&gt;
&lt;p&gt;-[ ] æ€è€ƒï¼šå¯ä»¥è¿›ä¸€æ­¥çš„æŠ½è±¡ï¼Œæä¾›ä¸€ä¸ªæ›´åŠ å‹å¥½çš„ APIï¼Œå±è”½ wgpu çš„å†…éƒ¨ç»†èŠ‚ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;ge-ge-cao-zuo-de-hao-shi&quot;&gt;å„ä¸ªæ“ä½œçš„è€—æ—¶&lt;&#x2F;h2&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;æ“ä½œ&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: left&quot;&gt;è€—æ—¶ï¼ˆusï¼‰&lt;&#x2F;th&gt;&lt;th&gt;å æ¯”&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;poll&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;1330&lt;&#x2F;td&gt;&lt;td&gt;45%&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;create_compute_pipeline&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;756&lt;&#x2F;td&gt;&lt;td&gt;26%&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;create_shader_module&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;209&lt;&#x2F;td&gt;&lt;td&gt;7.2%&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;copy_buffer_to_buffer&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;120&lt;&#x2F;td&gt;&lt;td&gt;4.1%&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;submit&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;98&lt;&#x2F;td&gt;&lt;td&gt;3.3%&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;create_buffer_init&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;67&lt;&#x2F;td&gt;&lt;td&gt;2.3%&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;p&gt;å¦‚æœè¯´ poll çš„æ—¶é—´æ˜¯GPU å®é™…è®¡ç®—çš„å¼€é”€ï¼Œé‚£ä¹ˆå¯ä»¥çœ‹åˆ°å‡†å¤‡æ•°æ®çš„æ—¶é—´è€—æ—¶æ¥è¿‘ 1.5ms äº†ã€‚è¿™ä¹Ÿæ˜¯å’ŒCPU å¯¹æ¯”æ—¶ï¼Œå¯èƒ½ä¼šæ€§èƒ½å¯¹æ¯”å¹¶ä¸å¤§çš„åŸå› äº†&lt;&#x2F;p&gt;
&lt;h2 id=&quot;yu-cpu-ban-ben-de-xing-neng-dui-bi&quot;&gt;ä¸ CPU ç‰ˆæœ¬çš„æ€§èƒ½å¯¹æ¯”&lt;&#x2F;h2&gt;
&lt;p&gt;åŸºäº hello_compute, æˆ‘ç¼–å†™äº†ä¸€ä¸ªå¯¹æ¯”çš„ cpu ç‰ˆæœ¬ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;time&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;T, F&amp;gt;( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;label&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;str&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;op&lt;&#x2F;span&gt;&lt;span&gt;: F)  -&amp;gt; T &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt; F: FnOnce() -&amp;gt; T  {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; tm0 = std::time::Instant::now();
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; result = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;op&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; tm1 = std::time::Instant::now();
&lt;&#x2F;span&gt;&lt;span&gt;    println!(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt; in &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{:?}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, label, tm1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;duration_since&lt;&#x2F;span&gt;&lt;span&gt;(tm0));
&lt;&#x2F;span&gt;&lt;span&gt;    result
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;run_test&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; read numbers from args
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; numbers = std::env::args()
&lt;&#x2F;span&gt;&lt;span&gt;        .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;skip&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;        .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span&gt;(|&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;s&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;::from_str(&amp;amp;s).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;expect&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;amp;format!(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;You must pass a list of positive integers &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{s}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;!&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) ))
&lt;&#x2F;span&gt;&lt;span&gt;        .collect::&amp;lt;Vec&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; result = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;time&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;running_cpu&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, || numbers.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;iter&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span&gt;(|&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;n&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;test2&lt;&#x2F;span&gt;&lt;span&gt;(n)).collect::&amp;lt;Vec&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;&amp;gt;() );
&lt;&#x2F;span&gt;&lt;span&gt;    println!(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;running_cpu Steps &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{:?}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, result);
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;test2&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;n_base&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32 &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; n: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32 &lt;&#x2F;span&gt;&lt;span&gt;= n_base;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;loop &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; n &amp;lt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1 &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;break&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; n % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2 &lt;&#x2F;span&gt;&lt;span&gt;== &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            n = n &#x2F; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Overflow? (i.e. 3*n + 1 &amp;gt; 0xffffffffu?)
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; n &amp;gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1431655765&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32 &lt;&#x2F;span&gt;&lt;span&gt;{   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 0x55555555u
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;4294967295&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span&gt;;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; 0xffffffffu
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;            n = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3 &lt;&#x2F;span&gt;&lt;span&gt;* n + &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        i = i + &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return&lt;&#x2F;span&gt;&lt;span&gt; i;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;åˆ†åˆ«è¿›è¡Œäº†å¦‚ä¸‹çš„æµ‹è¯• N ä» 1K - 60K çš„æµ‹è¯•ã€‚
&lt;img width=&quot;529&quot; alt=&quot;wgpu_cpu_compare&quot; src=&quot;https:&#x2F;&#x2F;github.com&#x2F;user-attachments&#x2F;assets&#x2F;830a9e61-a53b-4bca-a0ff-157870dc14df&quot;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;ä»è¿™ä¸ªçš„å›¾å¯ä»¥çœ‹å‡ºï¼šå¯¹æ¯”ä¸CPUç‰ˆæœ¬ï¼Œåœ¨20K è§„æ¨¡ä¹‹å‰ï¼ŒCPU ç‰ˆæœ¬è€—æ—¶æ›´å°‘ï¼Œå•éšç€ N çš„å¢åŠ ï¼ŒCPU è€—æ—¶åŸºæœ¬ä¸Šçº¿æ€§å¢åŠ ï¼Œè€Œ GPU ç‰ˆæœ¬ä»ä» 1K - 60Kï¼ŒåŸºæœ¬ç»´æŒä¸å˜ï¼ˆå—é™ä¸ç›®å‰çš„ä»£ç ï¼ŒGPU ç‰ˆæœ¬ï¼Œå•æ¬¡æäº¤æœ€å¤š64K æ•°æ®ã€‚ï¼‰&lt;&#x2F;p&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œå½“æ•°æ®é‡æŒç»­å¢åŠ ï¼Œä¸”å¤ç”¨ GPU çš„å¦‚ä¸‹èµ„æºï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;module&lt;&#x2F;li&gt;
&lt;li&gt;staging_buffer&#x2F;storage_buffer&lt;&#x2F;li&gt;
&lt;li&gt;pipeline&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒGPU çš„æé€Ÿæ•ˆæœä¼šæ›´ä¸ºæ˜æ˜¾ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;gpu-yu-shu-ju-fen-xi-si-kao&quot;&gt;GPU ä¸ æ•°æ®åˆ†ææ€è€ƒ&lt;&#x2F;h2&gt;
&lt;p&gt;ç›®å‰ï¼ŒOLAP åˆ†æçš„æé€Ÿä¸»è¦æœ‰å¦‚ä¸‹çš„æŠ€æœ¯æ‰‹æ®µï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ—å¼å­˜å‚¨ï¼š åˆ—å¼å­˜å‚¨å¯¹äºå®½è¡¨çš„ OLAP è®¡ç®—åœ¨ IO ä¸Šæœ‰æ˜¾è‘—çš„ä¼˜åŠ¿ï¼Œå› ä¸ºå¤§éƒ¨ä»½çš„æŸ¥è¯¢ä»…ä½¿ç”¨å®½è¡¨çš„éƒ¨åˆ†å­—æ®µã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åˆ—å¼è®¡ç®—ï¼š åœ¨å†…å­˜ä¸­ä½¿ç”¨ vector æ¨¡å¼å­˜å‚¨åˆ—ä¿¡æ¯ï¼Œå¹¶åŸºäºåˆ—è®¡ç®—çš„æ–¹å¼æ›¿ä»£è¡Œè®¡ç®—ï¼Œä»è€Œå……åˆ†åˆ©ç”¨ CPU çš„ cacheå‘½ä¸­ã€‚å‚è§  &lt;a href=&quot;http:&#x2F;&#x2F;cidrdb.org&#x2F;cidr2005&#x2F;papers&#x2F;P19.pdf&quot;&gt;MonetDB&#x2F;X100: Hyper-Pipelining Query Execution&lt;&#x2F;a&gt; by Peter Boncz, Marcin Zukowski and Niels Nes.&lt;&#x2F;li&gt;
&lt;li&gt;SIMD: åŸºäºå‘é‡çš„è®¡ç®—æ¨¡å¼ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨ SIMD åŠ é€Ÿèƒ½åŠ›ã€‚C&#x2F;C++&#x2F;Rustç­‰è¯­è¨€å‡æœ‰ç¼–è¯‘å™¨çº§åˆ«SIMDä¼˜åŒ–ï¼Œä¹Ÿæœ‰SIMDçš„åº“ï¼Œæ˜¾ç¤ºçš„ä½¿ç”¨ SIMD çš„èƒ½åŠ›ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;ç›®å‰æ¥çœ‹ï¼Œä½¿ç”¨ GPU è¿›è¡ŒåŠ é€Ÿï¼Œç›®å‰è¿˜ä¸æ˜¯ä¸»æµï¼Œä½†åº”è¯¥æ˜¯ä¸€ä¸ªä¸é”™çš„å‘å±•æ–¹å‘ï¼Œå¯¹æ¯” SIMDï¼ŒåŸºäºGPU è®¡ç®—ä¼šæœ‰å¦‚ä¸‹çš„ä¼˜åŠ¿ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;WebGPU æ ‡å‡†å·²è¶‹äºæˆç†Ÿï¼ŒChrome&#x2F;Firefoxç­‰æµè§ˆå™¨å·²æ”¯æŒ webgpuã€‚åœ¨ Rust ç”Ÿæ€ä¸­ï¼Œwgpu é¡¹ç›®å·²ç»å¯ä»¥æ”¯æŒ WGSL å¹¶ä¸”è¿è¡Œåœ¨ Windwos(Vulkan&#x2F;DX12)ã€Linux(Vulkan)ã€Mac(Metal)ã€WEB(webgpuï¼‰ä¸Šï¼Œç›¸å½“äºå·²ç»æœ‰äº†ä¸€ä¸ªè·¨å¹³å°çš„åº•å±‚å¼€å‘æ”¯æŒã€‚&lt;&#x2F;li&gt;
&lt;li&gt;SIMD çš„å¹¶å‘é™åˆ¶è¾ƒå¤§ï¼Œå‘é‡å®½åº¦ä¸€èˆ¬åœ¨ 128b - 512b ä¹‹é—´ï¼Œç›¸å½“äº4-16ä¸ªæ•´æ•°ã€‚è€Œ GPU çš„ä¸Šé™è¦é«˜å¾ˆå¤šï¼Œè­¬å¦‚ RTX 4090 æœ‰å¤šè¾¾ 16384 ä¸ªè®¡ç®—å•å…ƒï¼ˆå¯¹åº” AVX 512 ä¸º 16ï¼Œæå‡äº† 1024å€ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;SIMD å¹¶ä¸èƒ½é€‚åº” åˆ†æ”¯è®¡ç®—ï¼Œè€Œ GPU ä¸Šå¯ä»¥æ”¯æŒåˆ†æ”¯è®¡ç®—ã€‚ç±»ä¼¼äº case when çš„è®¡ç®—ï¼Œæ›´é€‚åˆåœ¨ GPUä¸Šå®Œæˆã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;bu-chong&quot;&gt;è¡¥å……&lt;&#x2F;h2&gt;
&lt;blockquote&gt;
&lt;p&gt;2024-08-17 ç¼–å†™äº†ä¸€ä¸ª mondelbrot set çš„ CPU å’Œ GPU ç‰ˆæœ¬çš„æ€§èƒ½å¯¹æ¯” &lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;mandelbrot-gpu&#x2F;&quot;&gt;mandelbrot-gpu&lt;&#x2F;a&gt;ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>MonetDB MAL æ¢ç©¶</title>
        <published>2024-08-08T12:00:00+00:00</published>
        <updated>2024-08-08T12:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/monetdb-mal/"/>
        <id>https://wangzaixiang.github.io/blog/monetdb-mal/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/monetdb-mal/">&lt;p&gt;MonetDB æ˜¯ä¸€ä¸ªåŸºäºåˆ—å­˜çš„ OLAP æ•°æ®åº“å¼•æ“ï¼Œæœ€è¿‘çœ‹åˆ°çš„å¾ˆå¤š OLAP å¼•æ“ï¼ŒåŒ…æ‹¬ &lt;a href=&quot;https:&#x2F;&#x2F;duckdb.org&quot;&gt;DuckDB&lt;&#x2F;a&gt;ã€&lt;a href=&quot;https:&#x2F;&#x2F;pola.rs&quot;&gt;Polars&lt;&#x2F;a&gt;
éƒ½å¼•ç”¨äº†MonetDBçš„ç ”ç©¶è®ºæ–‡ï¼Œè¿™è¯´æ˜äº† MonetDB åœ¨ OLAP é¢†åŸŸçš„æƒå¨åœ°ä½ï¼Œæˆ‘å¯¹ MonetDB çš„å®ç°åŸç†ä¹Ÿå¾ˆæ„Ÿå…´è¶£ï¼Œæœ¬æ–‡å°è¯•å¯¹ MAL åšä¸€ä¸ªåˆæ­¥çš„æ¢ç©¶ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;MonetDB å¼•å…¥äº†ä¸€ä¸ª MAL çš„ç»„ä»¶ï¼ˆMonet Assembly Languageï¼‰ï¼Œå³å°†SQLè¯­è¨€é¦–å…ˆç¼–è¯‘æˆä¸ºä¸€ç§ä¸­é—´è¯­è¨€ï¼ˆIL)ï¼Œç„¶åå†æ‰§è¡Œè¿™ä¸ªILï¼Œè¿™ä¸ sqlite3
æ˜¯éå¸¸ç›¸ä¼¼çš„ã€‚åœ¨ SQLite3ä¸­ï¼Œè¿™ä¸ªIL åˆæˆä¸º bytecodeï¼Œç›¸å…³èµ„æ–™å¯ä»¥å‚è€ƒï¼š&lt;a href=&quot;https:&#x2F;&#x2F;sqlite.org&#x2F;whybytecode.html&quot;&gt;ä¸ºä»€ä¹ˆSQLiteä½¿ç”¨ Bytecode&lt;&#x2F;a&gt;ã€‚
è€Œåœ¨ MonetDB ä¸­ï¼Œåˆ™ç§°ä¹‹ä¸º MALã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æœ¬æ–‡å¹¶ä¸å¯¹ MAL çš„å†…éƒ¨å®ç°è¿›è¡Œæ·±åº¦åˆ†æï¼Œè€Œæ˜¯å°è¯•é€šè¿‡ä¸€äº›ç®€å•çš„æ¡ˆä¾‹ï¼Œæ¥ç†è§£æœ€ç»ˆçš„ mal æ˜¯ä»€ä¹ˆæ ·å­ï¼Œæ˜¯å¦‚ä½•å¯¹åº”åˆ° SQL è¯­å¥çš„ï¼Ÿä»¥ç»ˆä¸ºå§‹ï¼Œå¦‚æœèƒ½è¯»æ‡‚mal
ä»£ç ï¼Œåˆ™åç»­å¯ä»¥è¿›ä¸€æ­¥ç†è§£ MonetDB çš„å…¶ä»–ç»„ä»¶ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;zhun-bei-gong-zuo&quot;&gt;å‡†å¤‡å·¥ä½œ&lt;&#x2F;h1&gt;
&lt;p&gt;é¦–å…ˆå‚è€ƒ &lt;a href=&quot;https:&#x2F;&#x2F;www.monetdb.org&#x2F;documentation-Dec2023&#x2F;user-guide&#x2F;tutorials&#x2F;voc-tutorial&#x2F;&quot;&gt;Tutorial&lt;&#x2F;a&gt; åœ¨æœ¬åœ°æ­å»ºå¥½ç¯å¢ƒå’Œæµ‹è¯•æ•°æ®åº“ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt; brew install monetdb
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt; monetdbd create &#x2F;path&#x2F;to&#x2F;mydbfarm  -- åˆå§‹åŒ–ä¸€ä¸ªæ•°æ®åº“å®ä¾‹ç›®å½•
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt; monetdbd start &#x2F;path&#x2F;to&#x2F;mydbfarm   -- å¯åŠ¨è¯¥å®ä¾‹
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt; monetdb create voc                 -- åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¤„åœ¨ç»´æŠ¤æ¨¡å¼
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt; monetdb release voc                -- å°†æ•°æ®åº“åˆ‡æ¢åˆ°å¯ç”¨æ¨¡å¼
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt; wget https:&#x2F;&#x2F;dev.monetdb.org&#x2F;Assets&#x2F;VOC&#x2F;voc_dump.zip -- è·å–åˆ°ç¤ºä¾‹æ•°æ®åº“çš„æ•°æ®è„šæœ¬
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt; unzip&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -p&lt;&#x2F;span&gt;&lt;span&gt; voc_dump.zip voc_dump.sql | &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;mclient -u&lt;&#x2F;span&gt;&lt;span&gt; voc&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -d&lt;&#x2F;span&gt;&lt;span&gt; voc  -- æ‰§è¡Œè„šæœ¬ï¼Œåˆå§‹åŒ–ç¤ºä¾‹æ•°æ®åº“
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;can-kao-zi-liao&quot;&gt;å‚è€ƒèµ„æ–™&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;BAT ç›¸å…³è®ºæ–‡ &lt;a href=&quot;https:&#x2F;&#x2F;www.researchgate.net&#x2F;publication&#x2F;3735086_Flattening_an_object_algebra_to_provide_performance&quot;&gt;Flattening an object algebra to provide performance
&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;jian-dan-an-li&quot;&gt;ç®€å•æ¡ˆä¾‹&lt;&#x2F;h1&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæ¥é˜…è¯»ä¸€æ¡æœ€ç®€å•çš„ SQL è¯­å¥çš„ MALã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt; mclient&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -u&lt;&#x2F;span&gt;&lt;span&gt; voc&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -d&lt;&#x2F;span&gt;&lt;span&gt; voc
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sql&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; explain select * from invoices where chamber = &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;A&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;mal                                                                                                                                                                     &lt;&#x2F;span&gt;&lt;span&gt;|
&lt;&#x2F;span&gt;&lt;span&gt;+=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;========================================================================================================================================================================+
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;user.main&lt;&#x2F;span&gt;&lt;span&gt;():void;                                                                                                                                              |
&lt;&#x2F;span&gt;&lt;span&gt;|     X_1:void := querylog.define(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;explain select * from invoices where chamber = &amp;#39;A&amp;#39;;&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;:str, &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;default_pipe&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, 36:int);                                                 |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;barrier&lt;&#x2F;span&gt;&lt;span&gt; X_121:bit := language.dataflow();                                                                                                                               |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_4:int&lt;&#x2F;span&gt;&lt;span&gt; := sql.mvc();                                                                                                                                               |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;C_5:bat[:oid]&lt;&#x2F;span&gt;&lt;span&gt; := sql.tid(X_4:int, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;sys&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;invoices&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str);                                                                                                       |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_8:bat[:int]&lt;&#x2F;span&gt;&lt;span&gt; := sql.bind(X_4:int, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;sys&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;invoices&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;number&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, 0:int);                                                                                 |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_15:bat[:str]&lt;&#x2F;span&gt;&lt;span&gt; := sql.bind(X_4:int, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;sys&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;invoices&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;number_sup&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, 0:int);                                                                            |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_20:bat[:int]&lt;&#x2F;span&gt;&lt;span&gt; := sql.bind(X_4:int, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;sys&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;invoices&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;trip&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, 0:int);                                                                                  |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_27:bat[:str]&lt;&#x2F;span&gt;&lt;span&gt; := sql.bind(X_4:int, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;sys&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;invoices&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;trip_sup&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, 0:int);                                                                              |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_34:bat[:int]&lt;&#x2F;span&gt;&lt;span&gt; := sql.bind(X_4:int, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;sys&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;invoices&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;invoice&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, 0:int);                                                                               |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_39:bat[:str]&lt;&#x2F;span&gt;&lt;span&gt; := sql.bind(X_4:int, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;sys&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;invoices&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;chamber&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, 0:int);                                                                               |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;C_48:bat[:oid]&lt;&#x2F;span&gt;&lt;span&gt; := algebra.thetaselect(X_39:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:str&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, C_5:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:oid&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;A&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;==&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str);                                                                            |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_50:bat[:int]&lt;&#x2F;span&gt;&lt;span&gt; := algebra.projection(C_48:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:oid&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, X_8:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:int&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;);                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_51:bat[:str]&lt;&#x2F;span&gt;&lt;span&gt; := algebra.projection(C_48:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:oid&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, X_15:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:str&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;);                                                                                               |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_52:bat[:int]&lt;&#x2F;span&gt;&lt;span&gt; := algebra.projection(C_48:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:oid&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, X_20:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:int&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;);                                                                                               |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_53:bat[:str]&lt;&#x2F;span&gt;&lt;span&gt; := algebra.projection(C_48:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:oid&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, X_27:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:str&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;);                                                                                               |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_54:bat[:int]&lt;&#x2F;span&gt;&lt;span&gt; := algebra.projection(C_48:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:oid&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, X_34:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:int&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;);                                                                                               |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_55:bat[:str]&lt;&#x2F;span&gt;&lt;span&gt; := algebra.projection(C_48:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:oid&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, X_39:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:str&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;);                                                                                               |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_123:void&lt;&#x2F;span&gt;&lt;span&gt; := language.pass(C_48:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:oid&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;);                                                                                                                        |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_124:void&lt;&#x2F;span&gt;&lt;span&gt; := language.pass(X_39:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:str&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;);                                                                                                                        |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_57:bat[:str]&lt;&#x2F;span&gt;&lt;span&gt; := bat.pack(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;sys.invoices&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;sys.invoices&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;sys.invoices&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;sys.invoices&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;sys.invoices&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;sys.invoices&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str);                 |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_58:bat[:str]&lt;&#x2F;span&gt;&lt;span&gt; := bat.pack(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;number&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;number_sup&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;trip&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;trip_sup&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;invoice&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;chamber&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str);                                               |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_59:bat[:str]&lt;&#x2F;span&gt;&lt;span&gt; := bat.pack(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;char&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;char&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;char&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;:str);                                                                    |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_60:bat[:int]&lt;&#x2F;span&gt;&lt;span&gt; := bat.pack(32:int, 1:int, 32:int, 1:int, 32:int, 1:int);                                                                                            |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_61:bat[:int]&lt;&#x2F;span&gt;&lt;span&gt; := bat.pack(0:int, 0:int, 0:int, 0:int, 0:int, 0:int);                                                                                               |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;exit&lt;&#x2F;span&gt;&lt;span&gt; X_121:bit;                                                                                                                                                         |
&lt;&#x2F;span&gt;&lt;span&gt;|     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;X_56:int&lt;&#x2F;span&gt;&lt;span&gt; := sql.resultSet(X_57:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:str&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, X_58:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:str&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, X_59:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:str&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, X_60:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:int&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, X_61:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:int&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, X_50:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:int&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, X_51:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:str&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, X_52:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:int&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, X_53:bat[ |
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; :str], X_54:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:int&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;, X_55:bat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;:str&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;);                                                                                                                                 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;end&lt;&#x2F;span&gt;&lt;span&gt; user.main;                                                                                                                                                          |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# inline                               0 actions 3 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# remap                                0 actions 2 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# costModel                            1 actions 2 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# coercions                            0 actions 5 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# aliases                              1 actions 9 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# evaluate                             0 actions 8 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# emptybind                            6 actions 9 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# deadcode                             6 actions 9 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# pushselect                           0 actions 18 usecs                                                                                                               |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# aliases                              6 actions 4 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# for                                  0 actions 1 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# dict                                 0 actions 8 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# mitosis                                                                                                                                                               |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# mergetable                           0 actions 9 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# aliases                              0 actions 1 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# constants                            0 actions 7 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# commonTerms                          0 actions 10 usecs                                                                                                               |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# projectionpath                       0 actions 4 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# deadcode                             0 actions 3 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# matpack                              0 actions 1 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# reorder                              1 actions 11 usecs                                                                                                               |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# dataflow                             1 actions 17 usecs                                                                                                               |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# querylog                             0 actions 1 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# multiplex                            0 actions 1 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# generator                            0 actions 3 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# candidates                           1 actions 2 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# deadcode                             0 actions 4 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# postfix                              0 actions 5 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# profiler                             0 actions 1 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# garbageCollector                     1 actions 9 usecs                                                                                                                |
&lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# 29 optimizers 224 usecs                                                                                                                                               |
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;59&lt;&#x2F;span&gt;&lt;span&gt; tuples
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬ä¼šå‚è€ƒ &lt;a href=&quot;https:&#x2F;&#x2F;www.monetdb.org&#x2F;documentation-Dec2023&#x2F;dev-guide&#x2F;monetdb-internals&#x2F;mal-modules&#x2F;&quot;&gt;MAL Modules&lt;&#x2F;a&gt;ä¸­
çš„APIæ–‡æ¡£ä¸º MAL ä»£ç æ·»åŠ ä¸Šæ³¨é‡Šï¼š&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;function user.main():void;
&lt;&#x2F;span&gt;&lt;span&gt;     X_1:void := querylog.define(&amp;quot;explain select * from invoices where chamber = &amp;#39;A&amp;#39;;&amp;quot;:str, &amp;quot;default_pipe&amp;quot;:str, 36:int);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt; barrier X_121:bit := language.dataflow();  &#x2F;&#x2F; The current guarded block is executed using dataflow control.
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; Get the multiversion catalog context.
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; Needed for correct statement dependencies
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; (ie sql.update, should be after sql.bind in concurrent execution
&lt;&#x2F;span&gt;&lt;span&gt;     X_4:int := sql.mvc();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; Return a column with the valid tuple identifiers associated with the table sname.tname.
&lt;&#x2F;span&gt;&lt;span&gt;     C_5:bat[:oid] := sql.tid(X_4:int, &amp;quot;sys&amp;quot;:str, &amp;quot;invoices&amp;quot;:str);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; Bind the &amp;#39;schema.table.column&amp;#39; BAT with access kind:
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; 0 - base table
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; 1 - inserts
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; 2 - updates
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F;&#x2F;&#x2F; å¯¹åº”äº select * ä¸­çš„å…­åˆ—
&lt;&#x2F;span&gt;&lt;span&gt;     X_8:bat[:int] := sql.bind(X_4:int, &amp;quot;sys&amp;quot;:str, &amp;quot;invoices&amp;quot;:str, &amp;quot;number&amp;quot;:str, 0:int);
&lt;&#x2F;span&gt;&lt;span&gt;     X_15:bat[:str] := sql.bind(X_4:int, &amp;quot;sys&amp;quot;:str, &amp;quot;invoices&amp;quot;:str, &amp;quot;number_sup&amp;quot;:str, 0:int);
&lt;&#x2F;span&gt;&lt;span&gt;     X_20:bat[:int] := sql.bind(X_4:int, &amp;quot;sys&amp;quot;:str, &amp;quot;invoices&amp;quot;:str, &amp;quot;trip&amp;quot;:str, 0:int);
&lt;&#x2F;span&gt;&lt;span&gt;     X_27:bat[:str] := sql.bind(X_4:int, &amp;quot;sys&amp;quot;:str, &amp;quot;invoices&amp;quot;:str, &amp;quot;trip_sup&amp;quot;:str, 0:int);
&lt;&#x2F;span&gt;&lt;span&gt;     X_34:bat[:int] := sql.bind(X_4:int, &amp;quot;sys&amp;quot;:str, &amp;quot;invoices&amp;quot;:str, &amp;quot;invoice&amp;quot;:str, 0:int);
&lt;&#x2F;span&gt;&lt;span&gt;     X_39:bat[:str] := sql.bind(X_4:int, &amp;quot;sys&amp;quot;:str, &amp;quot;invoices&amp;quot;:str, &amp;quot;chamber&amp;quot;:str, 0:int);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; Select all head values of the first input BAT for which the tail value
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; obeys the relation value OP VAL and for which the head value occurs in
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; the tail of the second input BAT.
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; Input is a dense-headed BAT, output is a dense-headed BAT with in
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; the tail the head value of the input BAT for which the
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; relationship holds.  The output BAT is sorted on the tail value.
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F;&#x2F;&#x2F; Î¸ select è¿›è¡Œè¿‡æ»¤
&lt;&#x2F;span&gt;&lt;span&gt;     C_48:bat[:oid] := algebra.thetaselect(X_39:bat[:str], C_5:bat[:oid], &amp;quot;A&amp;quot;:str, &amp;quot;==&amp;quot;:str);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; Project left input onto right input
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F;&#x2F;&#x2F; X_50 åˆ° X_55 å°±æ˜¯ä»è¿‡æ»¤åçš„ oid æ˜ å°„åˆ°å¯¹åº”çš„åˆ—çš„å€¼
&lt;&#x2F;span&gt;&lt;span&gt;     X_50:bat[:int] := algebra.projection(C_48:bat[:oid], X_8:bat[:int]);
&lt;&#x2F;span&gt;&lt;span&gt;     X_51:bat[:str] := algebra.projection(C_48:bat[:oid], X_15:bat[:str]);
&lt;&#x2F;span&gt;&lt;span&gt;     X_52:bat[:int] := algebra.projection(C_48:bat[:oid], X_20:bat[:int]);
&lt;&#x2F;span&gt;&lt;span&gt;     X_53:bat[:str] := algebra.projection(C_48:bat[:oid], X_27:bat[:str]);
&lt;&#x2F;span&gt;&lt;span&gt;     X_54:bat[:int] := algebra.projection(C_48:bat[:oid], X_34:bat[:int]);
&lt;&#x2F;span&gt;&lt;span&gt;     X_55:bat[:str] := algebra.projection(C_48:bat[:oid], X_39:bat[:str]);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; Cheap instruction to disgard storage while retaining the dataflow dependency
&lt;&#x2F;span&gt;&lt;span&gt;     X_123:void := language.pass(C_48:bat[:oid]);
&lt;&#x2F;span&gt;&lt;span&gt;     X_124:void := language.pass(X_39:bat[:str]);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; Materialize the values into a BAT. Avoiding a clash with mat.pack() in mergetable
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F;&#x2F;&#x2F; resultset column schema ä¿¡æ¯
&lt;&#x2F;span&gt;&lt;span&gt;     X_57:bat[:str] := bat.pack(&amp;quot;sys.invoices&amp;quot;:str, &amp;quot;sys.invoices&amp;quot;:str, &amp;quot;sys.invoices&amp;quot;:str,
&lt;&#x2F;span&gt;&lt;span&gt;                                &amp;quot;sys.invoices&amp;quot;:str, &amp;quot;sys.invoices&amp;quot;:str, &amp;quot;sys.invoices&amp;quot;:str);
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F;&#x2F;&#x2F; resultset column name ä¿¡æ¯
&lt;&#x2F;span&gt;&lt;span&gt;     X_58:bat[:str] := bat.pack(&amp;quot;number&amp;quot;:str, &amp;quot;number_sup&amp;quot;:str, &amp;quot;trip&amp;quot;:str,
&lt;&#x2F;span&gt;&lt;span&gt;                                &amp;quot;trip_sup&amp;quot;:str, &amp;quot;invoice&amp;quot;:str, &amp;quot;chamber&amp;quot;:str);
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F;&#x2F;&#x2F; resultset column datatype ä¿¡æ¯
&lt;&#x2F;span&gt;&lt;span&gt;     X_59:bat[:str] := bat.pack(&amp;quot;int&amp;quot;:str, &amp;quot;char&amp;quot;:str, &amp;quot;int&amp;quot;:str, &amp;quot;char&amp;quot;:str, &amp;quot;int&amp;quot;:str, &amp;quot;char&amp;quot;:str);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F;&#x2F;&#x2F; åº”è¯¥æ˜¯columnçš„å…ƒä¿¡æ¯ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆï¼Œæš‚æ—¶è¿˜ä¸æ¸…æ¥š
&lt;&#x2F;span&gt;&lt;span&gt;     X_60:bat[:int] := bat.pack(32:int, 1:int, 32:int, 1:int, 32:int, 1:int);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F;&#x2F;&#x2F; åº”è¯¥æ˜¯columnçš„å…ƒä¿¡æ¯ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆï¼Œæš‚æ—¶è¿˜ä¸æ¸…æ¥š
&lt;&#x2F;span&gt;&lt;span&gt;     X_61:bat[:int] := bat.pack(0:int, 0:int, 0:int, 0:int, 0:int, 0:int);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt; exit X_121:bit;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;     &#x2F;&#x2F; Prepare a table result set for the client front-end
&lt;&#x2F;span&gt;&lt;span&gt;     X_56:int := sql.resultSet(X_57:bat[:str], X_58:bat[:str], X_59:bat[:str], X_60:bat[:int], X_61:bat[:int],
&lt;&#x2F;span&gt;&lt;span&gt;            X_50:bat[:int], X_51:bat[:str], X_52:bat[:int], X_53:bat[:str], X_54:bat[:int], X_55:bat[:str]);                                                                                                                                 :
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;end user.main;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;æ•´ç†åçš„å¤„ç†å¦‚å›¾ï¼š&lt;img width=&quot;1362&quot; alt=&quot;image&quot; src=&quot;https:&#x2F;&#x2F;github.com&#x2F;user-attachments&#x2F;assets&#x2F;fcc66d79-a46b-4955-ae9f-1d750c3bd46a&quot;&gt;&lt;&#x2F;p&gt;
&lt;h1 id=&quot;group-by-an-li&quot;&gt;group by æ¡ˆä¾‹&lt;&#x2F;h1&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;sql&amp;gt; explain explain select chamber, sum(trip) from invoices group by chamber;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;function user.main():void;
&lt;&#x2F;span&gt;&lt;span&gt;    X_1:void := querylog.define(&amp;quot;explain select chamber, sum(trip) from invoices group by chamber;&amp;quot;:str,
&lt;&#x2F;span&gt;&lt;span&gt;    			&amp;quot;default_pipe&amp;quot;:str, 21:int);
&lt;&#x2F;span&gt;&lt;span&gt;barrier X_91:bit := language.dataflow();
&lt;&#x2F;span&gt;&lt;span&gt;    X_4:int := sql.mvc();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    C_5:bat[:oid] := sql.tid(X_4:int, &amp;quot;sys&amp;quot;:str, &amp;quot;invoices&amp;quot;:str);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    trip_0:bat[:int] := sql.bind(X_4:int, &amp;quot;sys&amp;quot;:str, &amp;quot;invoices&amp;quot;:str, &amp;quot;trip&amp;quot;:str, 0:int);
&lt;&#x2F;span&gt;&lt;span&gt;    chamber_0:bat[:str] := sql.bind(X_4:int, &amp;quot;sys&amp;quot;:str, &amp;quot;invoices&amp;quot;:str, &amp;quot;chamber&amp;quot;:str, 0:int);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    trip_1:bat[:int] := algebra.projection(C_5:bat[:oid], trip_0:bat[:int]);
&lt;&#x2F;span&gt;&lt;span&gt;    chamber_1:bat[:str] := algebra.projection(C_5:bat[:oid], chamber_0:bat[:str]);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    X_93:void := language.pass(C_5:bat[:oid]);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;	&#x2F;&#x2F; è¿™ä¸ªå‡½æ•°æ–‡æ¡£æ²¡æœ‰æ‰¾åˆ°ï¼Œè¿”å›çš„ä¸¤ä¸ª BAT æš‚æ—¶è¯­ä¹‰ä¸ç¡®å®šï¼ŒçŒœæµ‹ï¼š X_22: [1..N, gid], X_23: [1,n, oid]
&lt;&#x2F;span&gt;&lt;span&gt;	&#x2F;&#x2F; å…¶ä¸­ N æ˜¯è¡Œæ•°ï¼Œ n æ˜¯åˆ†ç»„æ•°ã€‚
&lt;&#x2F;span&gt;&lt;span&gt;    (X_22:bat[:oid], C_23:bat[:oid]) := group.groupdone(chamber_1:bat[:str]);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &#x2F;&#x2F;&#x2F;&#x2F; grouped [chamber]
&lt;&#x2F;span&gt;&lt;span&gt;    chamber_2:bat[:str] := algebra.projection(C_23:bat[:oid], chamber_1:bat[:str]);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    X_94:void := language.pass(chamber_1:bat[:str]);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &#x2F;&#x2F;&#x2F;&#x2F; [ sum(trip) for each group ]  subsum(bid, gid, eid, skip_nils) è¿™ä¸ªå‡½æ•°åœ¨å®˜ç½‘æœä¸åˆ°
&lt;&#x2F;span&gt;&lt;span&gt;    trip_sum:bat[:hge] := aggr.subsum(trip_1:bat[:int], X_22:bat[:oid], C_23:bat[:oid], true:bit);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    X_95:void := language.pass(C_23:bat[:oid]);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    X_29:bat[:str] := bat.pack(&amp;quot;sys.invoices&amp;quot;:str, &amp;quot;sys.%1&amp;quot;:str);
&lt;&#x2F;span&gt;&lt;span&gt;    X_30:bat[:str] := bat.pack(&amp;quot;chamber&amp;quot;:str, &amp;quot;%1&amp;quot;:str);
&lt;&#x2F;span&gt;&lt;span&gt;    X_31:bat[:str] := bat.pack(&amp;quot;char&amp;quot;:str, &amp;quot;hugeint&amp;quot;:str);
&lt;&#x2F;span&gt;&lt;span&gt;    X_32:bat[:int] := bat.pack(1:int, 128:int);
&lt;&#x2F;span&gt;&lt;span&gt;    X_33:bat[:int] := bat.pack(0:int, 0:int);
&lt;&#x2F;span&gt;&lt;span&gt;exit X_91:bit;
&lt;&#x2F;span&gt;&lt;span&gt;    X_28:int := sql.;(X_29:bat[:str], X_30:bat[:str], X_31:bat[:str], X_32:bat[:int], X_33:bat[:int],
&lt;&#x2F;span&gt;&lt;span&gt;    	chamber_2:bat[:str], trip_sum:bat[:hge]);
&lt;&#x2F;span&gt;&lt;span&gt;end user.main;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;chuang-kou-han-shu-an-li&quot;&gt;çª—å£å‡½æ•°æ¡ˆä¾‹&lt;&#x2F;h1&gt;
&lt;p&gt;TODOï¼Œ åç»­è¡¥å……&lt;&#x2F;p&gt;
&lt;h1 id=&quot;join-an-li&quot;&gt;join æ¡ˆä¾‹&lt;&#x2F;h1&gt;
&lt;p&gt;TODOï¼Œ åç»­è¡¥å……&lt;&#x2F;p&gt;
&lt;h1 id=&quot;shi-yong-yi-ge-il-lai-zhi-xing-sql-you-shen-me-you-dian&quot;&gt;ä½¿ç”¨ä¸€ä¸ª IL æ¥æ‰§è¡Œ SQL æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ&lt;&#x2F;h1&gt;
&lt;p&gt;Sqlite3 ä½¿ç”¨å­—èŠ‚ç ï¼ŒMonetDB ä½¿ç”¨ MALï¼ŒäºŒè€…æ˜¯ç›¸ä¼¼çš„ï¼Œè€Œå¤§éƒ¨ä»½å…¶ä»–çš„æ•°æ®åº“æ˜¯åŸºäºASTçš„ï¼Œé€šè¿‡å°† SQL è§£ææˆä¸º ASTï¼Œå†è½¬æ¢æˆä¸º Logic Plan å’Œ Physical Plan (ä¹Ÿæ˜¯ AST)ã€‚
åœ¨ &lt;a href=&quot;https:&#x2F;&#x2F;sqlite.org&#x2F;whybytecode.html&quot;&gt;ä¸ºä»€ä¹ˆSQLiteä½¿ç”¨ Bytecode&lt;&#x2F;a&gt; æ–‡ä¸­æåˆ°äº†
ä½¿ç”¨å­—èŠ‚ç çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼š
Pros:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å­—èŠ‚ç æ˜“äºç†è§£ã€‚è€Œ AST ç›¸å¯¹éš¾ä»¥å±•ç¤ºä¸ºå¯è¯»æ€§å¥½çš„è¡¨ç°å½¢å¼ã€‚ï¼ˆå®é™…ä¸Šï¼Œç°åœ¨å¾ˆå¤šæ•°æ®åº“éƒ½å¯ä»¥ä»¥ Tree æ–¹å¼æ¥æŸ¥çœ‹ Planï¼Œè¿™æ–¹é¢çš„å·®è·å…¶å®ä¸å¤§ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;å­—èŠ‚ç æ˜“äºè°ƒè¯•ã€‚å¯ä»¥åƒæ™®é€šçš„ä»£ç è°ƒè¯•ä¸€æ ·çš„è¿›è¡Œå­—èŠ‚ç çš„è°ƒè¯•ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å­—èŠ‚ç å¯ä»¥å¢é‡å¼çš„è¿è¡Œã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å­—èŠ‚ç æ›´åŠ çŸ­å°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å­—èŠ‚ç æ›´åŠ å¿«é€Ÿã€‚å­—èŠ‚ç ç›¸å¯¹äºASTæ¥è¯´å…·æœ‰æ›´å°çš„è§£é‡Šæˆæœ¬
Cons:&lt;&#x2F;li&gt;
&lt;li&gt;AST æ›´ä¾¿äºåœ¨æ‰§è¡ŒæœŸåæœŸçš„è®¡åˆ’å˜æ›´ã€‚å°¤å…¶æ˜¯æ ¹æ®å®é™…æ•°æ®çš„ç‰¹å¾ï¼Œè€Œæ”¹å˜æ‰§è¡Œè®¡åˆ’ï¼Œä¾‹å¦‚è°ƒæ•´ Join ç­–ç•¥ç­‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åŸºäºæ•°æ®æµçš„å¤„ç†æ›´æ˜“äºå¹¶è¡ŒåŒ–ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æˆ‘è§‰å¾—è¿˜æœ‰ä¸€ä¸ªç‚¹ï¼Œæ˜¯å­—èŠ‚ç æ¨¡å¼æ›´æ“…é•¿çš„ï¼Œå¯ä»¥æ›´å¥½çš„è¿›è¡Œè‡ªä¸‹è€Œä¸Šçš„æ€§èƒ½ä¼˜åŒ–ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é’ˆå¯¹æŸä¸ªç‰¹å®šçš„ä¼˜åŒ–åœºæ™¯ï¼Œè®¾è®¡æ›´é€‚åˆçš„ç®—æ³•ï¼ŒåŸºäºå­—èŠ‚ç çš„åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥ç•¥è¿‡å‰é¢çš„ AST æ„å»ºè¿‡ç¨‹ï¼Œ
ç›´æ¥æ‰‹å†™å‡ºç›®æ ‡çš„å­—èŠ‚ç ï¼Œç„¶åç‹¬ç«‹çš„è¿›è¡Œè°ƒè¯•ï¼Œè¿›è¡Œæ€§èƒ½å‹æµ‹ã€‚åœ¨è¾¾åˆ°é¢„æœŸç›®æ ‡åï¼Œè°ƒæ•´å‰ç«¯çš„ AST æ„å»ºè¿‡ç¨‹å³å¯ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;si-kao-1-yin-ru-s-expression-de-il&quot;&gt;æ€è€ƒ1: å¼•å…¥ S-Expression çš„ IL&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;å¼•å…¥ä¸€ä¸ªå‡½æ•°å¼çš„ ILï¼Œé‡‡ç”¨ç±»ä¼¼äº S-Expression çš„æ–¹å¼ï¼Œè¿™æ · AST ä¸ S-ILä¹‹é—´çš„è·ç¦»ä¹Ÿç›¸å¯¹è¾ƒå°ï¼Œå¯ä»¥æ›´æ–¹ä¾¿å¼•å…¥æ–°çš„åº•å±‚å‡½æ•°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;S-expression æ˜¯é¢å‘è§£é‡Šæ‰§è¡Œçš„ï¼Œä¸å­—èŠ‚ç å…·æœ‰ç®€å•çš„å¯¹åº”å…³ç³»ï¼Œå¯ä»¥é«˜æ ¡çš„æ‰§è¡Œï¼ˆæˆ–è€…ç›´æ¥é€šè¿‡ JIT æ–¹å¼æ‰§è¡Œï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;S-expression å¯ä»¥ä¸ AST è¿›è¡Œå…±å­˜ï¼Œè¿™æ ·å¯ä»¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒåŠ¨æ€çš„è°ƒæ•´ ASTï¼Œå†æ¬¡ç”Ÿæˆ S-ILï¼Œç„¶åæ‰§è¡Œã€‚ï¼ˆç±»ä¼¼äºJVMçš„ JIT ä¼˜åŒ–å hot-replaceï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è¿™æ ·çš„ä¸€ä¸ªå¹³è¡¡ï¼Œå¯ä»¥ä¾¿äºè‡ªä¸Šè€Œä¸‹çš„æ‰§è¡Œï¼ˆä»AST -&amp;gt; IL -&amp;gt; æ‰§è¡Œï¼‰ï¼Œä¹Ÿå¯ä»¥ä¾¿äºè‡ªä¸‹è€Œä¸Šçš„ä¼˜åŒ–ï¼Œé’ˆå¯¹ç‰¹å®šçš„åœºæ™¯ï¼Œæä¾›ç‰¹å®šçš„åŸºç¡€æ“ä½œï¼Œæ‰©å±•æ–°çš„ IL æ“ä½œï¼Œ
å¹¶ä¸”åœ¨å¼€å‘é˜¶æ®µï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ S-IL è¿›è¡Œè°ƒè¯•ï¼Œè€Œä¸éœ€è¦å…³å¿ƒ AST çš„æ„å»ºè¿‡ç¨‹ï¼Œä»è€Œå¿«é€Ÿçš„éªŒè¯æ€§èƒ½ä¼˜åŒ–çš„æ•ˆæœã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;si-kao-2-yin-ru-yi-ge-geng-jia-tong-yong-de-xiang-liang-hua-yan-suan-ti-xi&quot;&gt;æ€è€ƒ2: å¼•å…¥ä¸€ä¸ªæ›´åŠ é€šç”¨çš„å‘é‡åŒ–æ¼”ç®—ä½“ç³»ã€‚&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;BAT çš„æ¦‚å¿µæ˜¯ MonetDB çš„æ ¸å¿ƒï¼Œåæ¥è€…è¯¸å¦‚ DuckDB, Polars ç›´æ¥ä½¿ç”¨ Series + DataFrame çš„æ¦‚å¿µï¼Œéƒ½å¼±åŒ–äº† BAT. Bat ç±»ä¼¼äºä¸€ä¸ª ç®€åŒ–çš„ DataFrame
ä½œä¸ºåŸºç¡€æ•°æ®ç»“æ„ï¼Œç›¸æ¯” Series æ¥è¯´è¿˜æ˜¯é‡äº†ä¸€äº›ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å»ºç«‹å‘é‡çš„ç±»å‹ä½“ç³»ï¼Œ åŒ…æ‹¬ vec&lt;bool&gt;, vec&lt;i32&gt;, vec&amp;lt;vec&lt;i32&gt;&amp;gt;, vec&amp;lt;(name: i32, birthday: date)&amp;gt; ç­‰ç­‰ï¼Œ å°¤å…¶æ˜¯å¯¹ Named Tuple çš„æ”¯æŒå’Œ Vector of Struct çš„æ”¯æŒ&lt;&#x2F;li&gt;
&lt;li&gt;å»ºç«‹åŸºäºå‘é‡çš„æ“ä½œä½“ç³»ï¼ŒåŒ…æ‹¬ project, semi-join, join, select ç­‰ç­‰ï¼Œè¿™äº›æ“ä½œï¼Œéƒ½æ˜¯å‘é‡åŒ–ä¼˜åŒ–çš„ï¼ˆç”šè‡³å¯ä»¥ç›´æ¥åœ¨GPUä¸Šæ‰§è¡Œï¼‰æ˜¯ä¸Šå±‚SQL æ‰§è¡Œçš„åŸºç¡€æ”¯æ’‘&lt;&#x2F;li&gt;
&lt;li&gt;ä¸Šå±‚åº”ç”¨å¯ä»¥åŸºäºåŸºç¡€å‘é‡æ¼”ç®—ï¼Œå¢åŠ å„ç§ä¼˜åŒ–ï¼Œä¾‹å¦‚ min-max ç´¢å¼•ï¼Œ bitmap ç´¢å¼•ç­‰ï¼ŒåŸºäºè¿™äº›ç‰¹å®šçš„ç´¢å¼•ï¼Œå‡å°‘æ•°æ®çš„æ‰«æã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹äºå·²æ’åºçš„å‘é‡ï¼Œæä¾›æ›´å¤šçš„ä¼˜åŒ–ï¼Œä¾‹å¦‚ merge join, merge sort ç­‰ç­‰ã€‚ç”šè‡³å¯ä»¥å°†è¿™äº›ä¿¡æ¯ä½œä¸ºç±»å‹ä¿¡æ¯ï¼Œç›´æ¥åœ¨ç¼–è¯‘æœŸè¿›è¡Œä¼˜åŒ–ã€‚
å‚è€ƒï¼š &lt;a href=&quot;https:&#x2F;&#x2F;calcite.apache.org&#x2F;docs&#x2F;algebra.html&quot;&gt;Calcite Relational Algebra&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>ä½¿ç”¨ Notebook ç†Ÿæ‚‰ Polars çš„æ¦‚å¿µå’Œ API</title>
        <published>2024-05-18T12:00:00+00:00</published>
        <updated>2024-05-18T12:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/polars-notebook/"/>
        <id>https://wangzaixiang.github.io/blog/polars-notebook/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/polars-notebook/">&lt;h2 id=&quot;jie-lun-xian-xing&quot;&gt;ç»“è®ºå…ˆè¡Œ&lt;&#x2F;h2&gt;
&lt;p&gt;æœ¬ &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;notebooks&#x2F;blob&#x2F;main&#x2F;polars&#x2F;polars-1.ipynb&quot;&gt;notebook&lt;&#x2F;a&gt; æ˜¯é€šè¿‡ jupyter notebook çš„æ–¹å¼ï¼Œ
æ¥å­¦ä¹  polars çš„APIï¼Œå¹¶ç†è§£å…¶æ¦‚å¿µã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;polars æœ‰3ç§æ±‚å€¼çš„ä¸Šä¸‹æ–‡ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Selection Context: &lt;code&gt;df.select(...)&lt;&#x2F;code&gt;, &lt;code&gt;df.with_columns(...)&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Filter Context:  &lt;code&gt;df.filter(...) &lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Group By(Aggregation Context)ï¼š&lt;code&gt;df.group_by(...).agg(...)&lt;&#x2F;code&gt;ï¼Œæ¯ä¸€ä¸ªåˆ†ç»„å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªchild dataframe&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨è¿™ä¸‰ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œæ¯ä¸ªè¡¨è¾¾å¼çš„æ±‚å€¼ç»“æœæ˜¯ Series-N æˆ–è€… Series-1ã€‚Series-N ä¼šè‡ªåŠ¨å¹¿æ’­ä¸º Series-Nã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;è¡¨è¾¾å¼å¯ä»¥æ˜¯åŸºæœ¬çš„ pl.col(&quot;name&quot;) è¿™ç§æ±‚å€¼ä¸º Series-N&lt;&#x2F;li&gt;
&lt;li&gt;è¡¨è¾¾å¼å¯ä»¥æ˜¯èšåˆå‡½æ•°ï¼Œä¾‹å¦‚ pl.sum(&quot;nrs&quot;)ï¼Œ æ±‚å€¼ä¸º Series-1&lt;&#x2F;li&gt;
&lt;li&gt;å¯ä»¥æ˜¯çª—å£å‡½æ•°ï¼Œä¾‹å¦‚ pl.col(&quot;Close&quot;).last().over(&quot;YM&quot;).alias(&quot;last_close&quot;)ï¼Œæ±‚å€¼ä¸º Series-N&lt;&#x2F;li&gt;
&lt;li&gt;è¡¨è¾¾å¼å¯ä»¥æ˜¯å¤æ‚çš„æ“ä½œ pl.col(&quot;random&quot;).filter(pl.col(&quot;names&quot;).is_not_null())&lt;&#x2F;li&gt;
&lt;li&gt;Series-1 çš„æ±‚å€¼ç»“æœä¼šè¢«å¹¿æ’­ä¸º Series-N, æ‰€æœ‰çš„ Series-N çš„ N å€¼å¿…é¡»ä¸ DataFrame çš„è®°å½•æ•°ç›¸åŒã€‚å¦åˆ™ä¼šæŠ¥é”™ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;è¡¨è¾¾å¼æ˜¯åœ¨ dataframe çš„åŸºç¡€ä¸Šè¿›è¡Œæ±‚å€¼ï¼Œè€Œä¸æ˜¯åœ¨ row based ä¸Šè¿›è¡Œæ±‚å€¼ã€‚å³ä½¿æ˜¯ Series-1 ä¹Ÿæ˜¯ (df -&amp;gt; Series-1)ï¼Œè€Œé
( row -&amp;gt; Series-1 )&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;polars ä¸åŒäº SQL select çš„æ‰§è¡Œæµç¨‹ï¼Œåè€…æœ‰ä¸€ä¸ªä¸¥æ ¼çš„æ‰§è¡Œé¡ºåºå®šä¹‰ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;from -&amp;gt; where -&amp;gt; group by -&amp;gt; having -&amp;gt; select -&amp;gt; window -&amp;gt; order by&lt;&#x2F;li&gt;
&lt;li&gt;polars ä¸­ï¼Œæ¯ä¸ªæ“ä½œæ˜¯ç‹¬ç«‹çš„ï¼Œä¸åŒçš„é¡ºåºç»„åˆï¼Œä¼šäº§ç”Ÿä¸åŒçš„ç»“æœã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ polars ä¸­, select æ±‚å€¼ä¸Šä¸‹æ–‡ä¸­å¯ä»¥æ±‚å€¼çš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬äº† å­—æ®µçº§ã€èšåˆçº§ã€çª—å£çº§çš„èƒ½åŠ›ï¼Œä¸€å®šç¨‹åº¦ä¸Šæ¯” SQL æ›´å¼ºå¤§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ filter&#x2F;aggr æ±‚å€¼ä¸Šä¸‹æ–‡ä¸­ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œç±»ä¼¼çš„è®¡ç®—ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;TODO&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
polars å¯¹çª—å£å‡½æ•°çš„æ±‚å€¼æ˜¯å¦‚ä½•è¿›è¡Œçš„ï¼Ÿæ˜¯å¦æœ€ä¼˜ï¼Ÿ&lt;&#x2F;li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
polars æ˜¯å¦æœ‰å¯¹ç®€å•çš„ group_by sum æ“ä½œæœ‰è¿›è¡Œä¼˜åŒ–ï¼Œé¿å…ç”Ÿæˆä¸­é—´çš„ child dataframe?&lt;&#x2F;li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
å¯¹ä¸€ä¸ª join åçš„ dataframe, æ˜¯å¦ä¼šæœ‰å‡æçš„æ“ä½œï¼ŸåŠæ— ç”¨åˆ°çš„è¡¨ä¼šè‡ªåŠ¨å‡æï¼Ÿ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;1-contexts&quot;&gt;1. Contexts&lt;&#x2F;h2&gt;
&lt;p&gt;å¦‚ä¸‹çš„æ¦‚å¿µåŸºäºå¦‚ä¸‹çš„ç¤ºä¾‹æ•°æ®é›†ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;polars &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;as &lt;&#x2F;span&gt;&lt;span&gt;pl
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;numpy &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;as &lt;&#x2F;span&gt;&lt;span&gt;np
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;df = pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;DataFrame&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;None&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span&gt;],
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;foo&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;ham&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;spam&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;egg&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;None&lt;&#x2F;span&gt;&lt;span&gt;],
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: np.random.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;rand&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span&gt;),
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;groups&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;A&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;A&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;B&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;C&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;B&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;],
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;df
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div&gt;&lt;style&gt;
.dataframe &gt; thead &gt; tr,
.dataframe &gt; tbody &gt; tr {
  text-align: right;
  white-space: pre-wrap;
}
&lt;&#x2F;style&gt;
&lt;small&gt;shape: (5, 4)&lt;&#x2F;small&gt;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;nrs&lt;&#x2F;th&gt;&lt;th&gt;names&lt;&#x2F;th&gt;&lt;th&gt;random&lt;&#x2F;th&gt;&lt;th&gt;groups&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;i64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;f64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;1&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;0.998578&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;A&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;2&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;ham&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;0.061645&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;A&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;3&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;0.927885&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;B&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;egg&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;0.412684&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;C&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;5&lt;&#x2F;td&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;0.432504&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;B&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;
&lt;h3 id=&quot;1-1-selection-context&quot;&gt;1.1 Selection Context&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;1-series-n-and-series-1-expression&quot;&gt;1) Series-N and Series-1 expression&lt;&#x2F;h4&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;total&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;groups&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div&gt;&lt;style&gt;
.dataframe &gt; thead &gt; tr,
.dataframe &gt; tbody &gt; tr {
  text-align: right;
  white-space: pre-wrap;
}
&lt;&#x2F;style&gt;
&lt;small&gt;shape: (5, 4)&lt;&#x2F;small&gt;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;nrs&lt;&#x2F;th&gt;&lt;th&gt;names&lt;&#x2F;th&gt;&lt;th&gt;total&lt;&#x2F;th&gt;&lt;th&gt;groups&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;i64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;f64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;1&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;2.23031&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;A&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;2&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;ham&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;2.23031&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;A&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;3&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;2.23031&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;B&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;egg&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;2.23031&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;C&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;5&lt;&#x2F;td&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;2.23031&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;B&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;
&lt;p&gt;è§£æï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;df.select( pl.col(&quot;nrs&quot;) ) è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ª Seriesï¼Œå…¶é•¿åº¦ä¸º Nï¼ˆè®°å½•æ•°ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;df.select( pl.col(&quot;random&quot;).sum() ) è¿”å›çš„ç»“æœæ˜¯ Series[1] æˆ–è€… Scalarï¼ŒScalarå€¼ä¼šå¹¿æ’­æˆä¸º Series[N]ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å› æ­¤ï¼Œåœ¨ Select ä¸­çš„è¡¨è¾¾å¼ï¼Œæˆ–è€…è¿”å› Series[N]ï¼Œ æˆ–è€…è¿”å› Series[1]ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),                                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Scalar
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names1&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sort&lt;&#x2F;span&gt;&lt;span&gt;(),                       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Series[N]
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;first&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;first name&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Scalar
&lt;&#x2F;span&gt;&lt;span&gt;    (pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;mean&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;10xnrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Scalar
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div&gt;&lt;style&gt;
.dataframe &gt; thead &gt; tr,
.dataframe &gt; tbody &gt; tr {
  text-align: right;
  white-space: pre-wrap;
}
&lt;&#x2F;style&gt;
&lt;small&gt;shape: (5, 5)&lt;&#x2F;small&gt;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;nrs&lt;&#x2F;th&gt;&lt;th&gt;names1&lt;&#x2F;th&gt;&lt;th&gt;names&lt;&#x2F;th&gt;&lt;th&gt;first name&lt;&#x2F;th&gt;&lt;th&gt;10xnrs&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;i64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;f64&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;27.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;ham&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;egg&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;27.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;27.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;egg&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;ham&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;27.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;27.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# example mixes Series-N and Series-1 Expression
&lt;&#x2F;span&gt;&lt;span&gt;df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),                                                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Scalar
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sort&lt;&#x2F;span&gt;&lt;span&gt;(),                                               &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Series[N]
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;first&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;first name&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),                          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Scalar
&lt;&#x2F;span&gt;&lt;span&gt;    (pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) &#x2F; pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;() * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100&lt;&#x2F;span&gt;&lt;span&gt;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;pecents&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Series[N] &#x2F; Scalar =&amp;gt; Series[N]
&lt;&#x2F;span&gt;&lt;span&gt;    (pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;mean&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;10xnrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),                                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Scalar
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div&gt;&lt;style&gt;
.dataframe &gt; thead &gt; tr,
.dataframe &gt; tbody &gt; tr {
  text-align: right;
  white-space: pre-wrap;
}
&lt;&#x2F;style&gt;
&lt;small&gt;shape: (5, 5)&lt;&#x2F;small&gt;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;nrs&lt;&#x2F;th&gt;&lt;th&gt;names&lt;&#x2F;th&gt;&lt;th&gt;first name&lt;&#x2F;th&gt;&lt;th&gt;pecents&lt;&#x2F;th&gt;&lt;th&gt;10xnrs&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;i64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;f64&lt;&#x2F;td&gt;&lt;td&gt;f64&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;37.248716&lt;&#x2F;td&gt;&lt;td&gt;27.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;egg&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;2.337091&lt;&#x2F;td&gt;&lt;td&gt;27.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;11.178078&lt;&#x2F;td&gt;&lt;td&gt;27.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;ham&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;37.932039&lt;&#x2F;td&gt;&lt;td&gt;27.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;11.304075&lt;&#x2F;td&gt;&lt;td&gt;27.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;
&lt;p&gt;åŸºäºå‘é‡çš„å¹¿æ’­æœºåˆ¶ï¼Œå¯ä»¥åœ¨å•ä¸ªè¡¨è¾¾å¼ä¸­ç»“åˆä½¿ç”¨ Series-N è¡¨è¾¾å¼ å’Œ Series-1 è¡¨è¾¾å¼ï¼Œè¿™ç§èƒ½åŠ›ï¼Œè¦åœ¨SQLä¸­è¡¨è¾¾å‡ºæ¥ï¼Œè¿˜æ˜¯æ¯”è¾ƒå›°éš¾çš„ã€‚ï¼ˆ&lt;strong&gt;ä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œ
Polarsçš„è¡¨è¾¾èƒ½åŠ›ç›¸æ¯” SQL æ›´å¼ºå¤§ä¸€äº›ï¼Œä¸¤è€…çš„è®¡ç®—æ¨¡å‹å¹¶ä¸ç›¸åŒ&lt;&#x2F;strong&gt;ï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;h4 id=&quot;2-apis&quot;&gt;2) APIS&lt;&#x2F;h4&gt;
&lt;p&gt;&lt;code&gt;df.select( ... )&lt;&#x2F;code&gt;  # ä»…é€‰æ‹©éƒ¨åˆ†åˆ—&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;df.with_columns( ... ) &lt;&#x2F;code&gt; # ä¿ç•™æ‰€æœ‰åˆ—ï¼Œå¹¶åˆ›æ–°æ–°çš„åˆ—(å¦‚æœåˆ—åé‡å¤ï¼Œåˆ™è¦†ç›–æ‰åŸæœ‰çš„åˆ—)&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;with_columns&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(),   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# æ²¡æœ‰å–åˆ«åæ—¶ï¼Œè¿™ä¸ªæ–°çš„åˆ—çš„åˆ—æ˜ä¹Ÿå«åš randomï¼Œå› æ­¤ï¼Œåœ¨ç»“æœä¸­ä¼šè¦†ç›–æ‰åŸæœ‰ random åˆ—ã€‚
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div&gt;&lt;style&gt;
.dataframe &gt; thead &gt; tr,
.dataframe &gt; tbody &gt; tr {
  text-align: right;
  white-space: pre-wrap;
}
&lt;&#x2F;style&gt;
&lt;small&gt;shape: (5, 4)&lt;&#x2F;small&gt;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;nrs&lt;&#x2F;th&gt;&lt;th&gt;names&lt;&#x2F;th&gt;&lt;th&gt;random&lt;&#x2F;th&gt;&lt;th&gt;groups&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;i64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;f64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;1&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;2.23031&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;A&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;2&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;ham&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;2.23031&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;A&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;3&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;2.23031&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;B&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;egg&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;2.23031&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;C&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;5&lt;&#x2F;td&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;2.23031&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;B&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# the code not works
&lt;&#x2F;span&gt;&lt;span&gt;df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;filter&lt;&#x2F;span&gt;&lt;span&gt;(pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;is_not_null&lt;&#x2F;span&gt;&lt;span&gt;()),       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# the series length is 4, not 5
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;total&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;groups&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ComputeError: Series length 4 doesn&amp;#39;t match the DataFrame height of 5
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;---------------------------------------------------------------------------
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;ComputeError                              Traceback (most recent call last)
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;Cell In[3], line 1
&lt;&#x2F;span&gt;&lt;span&gt;----&amp;gt; 1 df.select(
&lt;&#x2F;span&gt;&lt;span&gt;      2     pl.col(&amp;quot;nrs&amp;quot;).filter(pl.col(&amp;quot;names&amp;quot;).is_not_null()),
&lt;&#x2F;span&gt;&lt;span&gt;      3     pl.col(&amp;quot;names&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;      4     pl.col(&amp;quot;random&amp;quot;).sum().alias(&amp;quot;total&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;      5     pl.col(&amp;quot;groups&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;      6 )
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;File ~&#x2F;venvs&#x2F;polars&#x2F;lib&#x2F;python3.12&#x2F;site-packages&#x2F;polars&#x2F;dataframe&#x2F;frame.py:8137, in DataFrame.select(self, *exprs, **named_exprs)
&lt;&#x2F;span&gt;&lt;span&gt;   8037 def select(
&lt;&#x2F;span&gt;&lt;span&gt;   8038     self, *exprs: IntoExpr | Iterable[IntoExpr], **named_exprs: IntoExpr
&lt;&#x2F;span&gt;&lt;span&gt;   8039 ) -&amp;gt; DataFrame:
&lt;&#x2F;span&gt;&lt;span&gt;   8040     &amp;quot;&amp;quot;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;   8041     Select columns from this DataFrame.
&lt;&#x2F;span&gt;&lt;span&gt;   8042 
&lt;&#x2F;span&gt;&lt;span&gt;   (...)
&lt;&#x2F;span&gt;&lt;span&gt;   8135     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;&#x2F;span&gt;&lt;span&gt;   8136     &amp;quot;&amp;quot;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;-&amp;gt; 8137     return self.lazy().select(*exprs, **named_exprs).collect(_eager=True)
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;File ~&#x2F;venvs&#x2F;polars&#x2F;lib&#x2F;python3.12&#x2F;site-packages&#x2F;polars&#x2F;lazyframe&#x2F;frame.py:1816, in LazyFrame.collect(self, type_coercion, predicate_pushdown, projection_pushdown, simplify_expression, slice_pushdown, comm_subplan_elim, comm_subexpr_elim, no_optimization, streaming, background, _eager, **_kwargs)
&lt;&#x2F;span&gt;&lt;span&gt;   1813 # Only for testing purposes atm.
&lt;&#x2F;span&gt;&lt;span&gt;   1814 callback = _kwargs.get(&amp;quot;post_opt_callback&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;-&amp;gt; 1816 return wrap_df(ldf.collect(callback))
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;ComputeError: Series length 4 doesn&amp;#39;t match the DataFrame height of 5
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è¿™æ®µä»£ç æ— æ³•æ­£ç¡®æ‰§è¡Œï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;df çš„é•¿åº¦ä¸º 5&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;df.select( pl.col(&quot;nrs&quot;).filter( pl.col(&quot;names&quot;).is_not_null() )&lt;&#x2F;code&gt; è¿”å›çš„ Series é•¿åº¦ä¸º4ã€‚Series-N ä¸ DataFrame ä¸åŒ¹é…ã€‚
è¿™ç§æƒ…å†µæ˜¯ä¸èƒ½ä½¿ç”¨å¹¿æ’­çš„æ–¹å¼è¿›è¡Œå¯¹é½çš„ï¼Œå› æ­¤ï¼Œè¿™æ®µä»£ç æ— æ³•æ­£ç¡®æ‰§è¡Œã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h3 id=&quot;1-2-filter-context&quot;&gt;1.2 Filter Context&lt;&#x2F;h3&gt;
&lt;p&gt;Filter Context çš„è¡¨è¾¾å¼æ±‚å€¼ä¸º booleanï¼Œ ç±»ä¼¼äº f: row -&amp;gt; boolean&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;filter&lt;&#x2F;span&gt;&lt;span&gt;(pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div&gt;&lt;style&gt;
.dataframe &gt; thead &gt; tr,
.dataframe &gt; tbody &gt; tr {
  text-align: right;
  white-space: pre-wrap;
}
&lt;&#x2F;style&gt;
&lt;small&gt;shape: (2, 4)&lt;&#x2F;small&gt;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;nrs&lt;&#x2F;th&gt;&lt;th&gt;names&lt;&#x2F;th&gt;&lt;th&gt;random&lt;&#x2F;th&gt;&lt;th&gt;groups&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;i64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;f64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;3&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;0.249306&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;B&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;5&lt;&#x2F;td&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;0.252116&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;B&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# å¯ä»¥åœ¨ filter ä¸­ä½¿ç”¨èšåˆå‡½æ•°ï¼Œçª—å£å‡½æ•°ï¼Œå…¶ç”¨æ³•ä¸ select ä¸­ä¸€è‡´ã€‚
&lt;&#x2F;span&gt;&lt;span&gt;df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;filter&lt;&#x2F;span&gt;&lt;span&gt;(pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;over&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;groups&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0.8&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div&gt;&lt;style&gt;
.dataframe &gt; thead &gt; tr,
.dataframe &gt; tbody &gt; tr {
  text-align: right;
  white-space: pre-wrap;
}
&lt;&#x2F;style&gt;
&lt;small&gt;shape: (2, 4)&lt;&#x2F;small&gt;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;nrs&lt;&#x2F;th&gt;&lt;th&gt;names&lt;&#x2F;th&gt;&lt;th&gt;random&lt;&#x2F;th&gt;&lt;th&gt;groups&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;i64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;f64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;1&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;0.155879&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;A&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;2&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;ham&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;0.711329&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;A&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;éœ€è¦è¡¥å……åˆ†æ&lt;&#x2F;strong&gt;&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨ Filter ä¸­ä¹Ÿå­˜åœ¨ Series-N å’Œ Series-1 çš„è¡¨è¾¾å¼é—®é¢˜ï¼Œå¯ä»¥ç†è§£ä¸ºï¼šfilter æ˜¯è®¡ç®—å‡ºä¸€ä¸ª Series-N[Boolean]ï¼Œè¡¨è¾¾å¼çš„æ¯ä¸€ä¸ªéƒ¨åˆ†æˆ–è€…æ±‚å€¼ä¸ºï¼šSeries-1ï¼ˆå¹¿æ’­ï¼‰æˆ–è€… Series-Nã€‚
å½“ç»“åˆä¸€äº›å¤æ‚çš„è¡¨è¾¾å¼æ—¶ï¼Œä¾‹å¦‚ a and b or cï¼Œå…¶ä¸­ a,b, c å¯èƒ½æ˜¯ Series-Nï¼Œ ä¹Ÿå¯èƒ½æ˜¯ Series-1.
æ±‚å€¼æ–¹å¼ï¼š 1. å…ˆå¯¹æ‰€æœ‰åŸºç¡€çš„ Logic Expression è¿›è¡Œæ±‚å€¼ï¼Œå…¶æˆ–è€…ä¸º Series-N, æˆ–è€…ä¸º Series-1ã€‚
2. å¹¿æ’­åï¼Œå†æ±‚å€¼ Series-N&lt;&#x2F;p&gt;
&lt;p&gt;é—®é¢˜ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œselect ä¸Šä¸‹æ–‡ä¸­å¯ä»¥ä½¿ç”¨ filter, sum, ä»¥åŠçª—å£å‡½æ•°ç­‰ï¼Œé‚£ä¹ˆè¿™äº›å‡½æ•°æ˜¯å¦åœ¨ filter ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Ÿ&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœæ—¢æœ‰ select è®¡ç®—ï¼Œåˆæœ‰ filter è®¡ç®—ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªè®¡ç®—æ˜¯å¦æœ‰å…ˆåé¡ºåºï¼Ÿ
æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å¦‚ä¸‹çš„ç¤ºä¾‹ï¼š&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;df1 = df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),                                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Scalar
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names1&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sort&lt;&#x2F;span&gt;&lt;span&gt;(),                       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Series[N]
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;first&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;first name&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Scalar
&lt;&#x2F;span&gt;&lt;span&gt;    (pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;mean&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;10xnrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Scalar
&lt;&#x2F;span&gt;&lt;span&gt;) .filter(pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2 &lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;df2 = df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;filter&lt;&#x2F;span&gt;&lt;span&gt;(pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),                                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Scalar
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names1&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sort&lt;&#x2F;span&gt;&lt;span&gt;(),                       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Series[N]
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;first&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;first name&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Scalar
&lt;&#x2F;span&gt;&lt;span&gt;    (pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;mean&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;10xnrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Scalar
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;shape: (5, 5)
&lt;&#x2F;span&gt;&lt;span&gt;â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ nrs â”† names1 â”† names â”† first name â”† 10xnrs â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ --- â”† ---    â”† ---   â”† ---        â”† ---    â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ i64 â”† str    â”† str   â”† str        â”† f64    â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•¡
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ 11  â”† foo    â”† null  â”† foo        â”† 27.5   â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ 11  â”† ham    â”† egg   â”† foo        â”† 27.5   â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ 11  â”† spam   â”† foo   â”† foo        â”† 27.5   â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ 11  â”† egg    â”† ham   â”† foo        â”† 27.5   â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ 11  â”† null   â”† spam  â”† foo        â”† 27.5   â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;&#x2F;span&gt;&lt;span&gt;shape: (2, 5)
&lt;&#x2F;span&gt;&lt;span&gt;â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ nrs â”† names1 â”† names â”† first name â”† 10xnrs â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ --- â”† ---    â”† ---   â”† ---        â”† ---    â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ i64 â”† str    â”† str   â”† str        â”† f64    â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•¡
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ 8   â”† spam   â”† null  â”† spam       â”† 40.0   â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ 8   â”† null   â”† spam  â”† spam       â”† 40.0   â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;df1
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div&gt;&lt;style&gt;
.dataframe &gt; thead &gt; tr,
.dataframe &gt; tbody &gt; tr {
  text-align: right;
  white-space: pre-wrap;
}
&lt;&#x2F;style&gt;
&lt;small&gt;shape: (5, 5)&lt;&#x2F;small&gt;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;nrs&lt;&#x2F;th&gt;&lt;th&gt;names1&lt;&#x2F;th&gt;&lt;th&gt;names&lt;&#x2F;th&gt;&lt;th&gt;first name&lt;&#x2F;th&gt;&lt;th&gt;10xnrs&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;i64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;f64&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;27.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;ham&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;egg&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;27.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;27.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;egg&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;ham&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;27.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;27.5&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;df2
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div&gt;&lt;style&gt;
.dataframe &gt; thead &gt; tr,
.dataframe &gt; tbody &gt; tr {
  text-align: right;
  white-space: pre-wrap;
}
&lt;&#x2F;style&gt;
&lt;small&gt;shape: (2, 5)&lt;&#x2F;small&gt;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;nrs&lt;&#x2F;th&gt;&lt;th&gt;names1&lt;&#x2F;th&gt;&lt;th&gt;names&lt;&#x2F;th&gt;&lt;th&gt;first name&lt;&#x2F;th&gt;&lt;th&gt;10xnrs&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;i64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;f64&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;8&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;40.0&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;8&lt;&#x2F;td&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;40.0&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;
&lt;p&gt;ä»ä¸Šé¢çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œ æˆ‘ä»¬å¯ä»¥çœ‹åˆ° è°ƒæ•´é¡ºåºåçš„ä¸¤ä¸ªç»“æœæ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ï¼Œè¿™ä¸ªä¹Ÿè¯´æ˜äº†ä¸ SQL Select å¹¶ä¸ä¸€æ ·ï¼Œåœ¨ Pola RS ä¸­ï¼Œ
select ä¸ filter æ˜¯ç‹¬ç«‹çš„æ“ä½œï¼Œdf.select(...).filter(...) ä¸ df.filter(...).select(...) æ˜¯ä¸ä¸€æ ·çš„ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è¿™ä¸ SQL ä¸­ select * from table where ... çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸ä¸€æ ·çš„ã€‚ä¸€æ¡SQL è¯­å¥æœ‰ä¸€ä¸ªé¢„å®šçš„æ‰§è¡Œé¡ºåºï¼Œå‚è§ï¼š
&lt;a href=&quot;https:&#x2F;&#x2F;pic2.zhimg.com&#x2F;80&#x2F;v2-8faf44f913ce39eef7bab322e4a1b4f9_1440w.webp&quot;&gt;SELECT è¯­å¥æ‰§è¡Œæµç¨‹&lt;&#x2F;a&gt;
åœ¨è¿™ä¸ªæ‰§è¡Œæµç¨‹ä¸­ï¼Œselect å­å¥æ˜¯åœ¨filter ä¹‹åï¼Œç„¶ågroup byï¼Œhavingï¼Œåœ¨ having è¿‡æ»¤ä¹‹åæ‰§è¡Œçš„ï¼Œä½†åœ¨çª—å£å‡½æ•°æ‰§è¡Œä¹‹å‰ã€‚
è€Œ polars åˆ™å®Œå…¨ä¸åŒï¼Œæ¯ä¸ª data frame æ“ä½œæ˜¯ç‹¬ç«‹çš„ï¼Œä¸åŒçš„é¡ºåºç»„åˆï¼Œä¼šäº§ç”Ÿä¸åŒçš„ç»“æœã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å½“ç„¶ï¼Œåœ¨ Lazy Evaluation ä¸­ï¼Œæœ€åæ‰§è¡Œè®¡åˆ’ä¼šå¯¹è¿™äº›æ“ä½œè¿›è¡Œä¼˜åŒ–ï¼Œç”Ÿæˆä¸€ä¸ªæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ã€‚ä½†é€»è¾‘ä¸Šæ¥çœ‹ï¼Œè¿™äº›æ“ä½œæ˜¯ç‹¬ç«‹çš„ã€‚&lt;&#x2F;p&gt;
&lt;h3 id=&quot;1-3-aggragation-context&quot;&gt;1.3 Aggragation Context&lt;&#x2F;h3&gt;
&lt;p&gt;åœ¨ &lt;code&gt;group_by&lt;&#x2F;code&gt;ä¹‹åï¼Œ DataFrame ä¼šè½¬åŒ–ä¸º GroupByï¼Œ agg æ“ä½œä¼šå†æ¬¡å°† GroupBy è½¬æ¢ä¸º DataFrameã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ¯ä¸ª agg è¡¨è¾¾å¼çš„ä¸Šä¸‹æ–‡æ˜¯å•ä¸ªåˆ†ç»„ï¼Œ å…¶è¿”å›å€¼æ˜¯ Series-1ã€‚ å¦‚æœæŸä¸ªè¡¨è¾¾å¼æ±‚å€¼ä¸º Series-Nï¼Œå°†æœ€åè½¬æ¢ä¸º Series-1ã€‚ï¼ˆå¤§éƒ¨åˆ†æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥çš„æ“ä½œï¼‰&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;group_by&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;groups&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;agg&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),  
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;), 
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div&gt;&lt;style&gt;
.dataframe &gt; thead &gt; tr,
.dataframe &gt; tbody &gt; tr {
  text-align: right;
  white-space: pre-wrap;
}
&lt;&#x2F;style&gt;
&lt;small&gt;shape: (3, 4)&lt;&#x2F;small&gt;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;groups&lt;&#x2F;th&gt;&lt;th&gt;nrs&lt;&#x2F;th&gt;&lt;th&gt;random&lt;&#x2F;th&gt;&lt;th&gt;names&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;list[i64]&lt;&#x2F;td&gt;&lt;td&gt;list[f64]&lt;&#x2F;td&gt;&lt;td&gt;list[str]&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&amp;quot;A&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;[1, 2]&lt;&#x2F;td&gt;&lt;td&gt;[0.830762, 0.052124]&lt;&#x2F;td&gt;&lt;td&gt;[&amp;quot;foo&amp;quot;, &amp;quot;ham&amp;quot;]&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;&amp;quot;C&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;[null]&lt;&#x2F;td&gt;&lt;td&gt;[0.846002]&lt;&#x2F;td&gt;&lt;td&gt;[&amp;quot;egg&amp;quot;]&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;&amp;quot;B&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;[3, 5]&lt;&#x2F;td&gt;&lt;td&gt;[0.249306, 0.252116]&lt;&#x2F;td&gt;&lt;td&gt;[&amp;quot;spam&amp;quot;, null]&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;
&lt;p&gt;åœ¨ group_by ä¹‹åçš„ DF å…¶ä¸Šä¸‹æ–‡ä¸º List[(key, rows)] çš„å½¢å¼ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰è¿›è¡Œèšåˆæ“ä½œï¼Œå› æ­¤ï¼Œè¿”å›çš„ç»“æœæ˜¯æ¯ä¸ªç»„ä¸­çš„å­—æ®µçš„ä¸€ä¸ªåˆ—è¡¨å½¢å¼ã€‚è¿™ä¸ªåœ¨å®é™…ä¸­æ„ä¹‰ä¸å¤§ï¼Œå› ä¸ºæ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œè¿™ä¸ªå€¼ä¼šå¾ˆé•¿ã€‚ä½†åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œå¯ä»¥å¸®åŠ©ç†è§£åç»­çš„èšåˆå‡½æ•°å¦‚ä½•å·¥ä½œã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;group_by&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;groups&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;agg&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),                                                                      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# sum nrs by groups
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random_count&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),                                            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# count group members
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;filter&lt;&#x2F;span&gt;&lt;span&gt;(pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;is_not_null&lt;&#x2F;span&gt;&lt;span&gt;()).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random_hasname&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;filter&lt;&#x2F;span&gt;&lt;span&gt;(pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;is_not_null&lt;&#x2F;span&gt;&lt;span&gt;()).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;().name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;suffix&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;_sum&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# sum random where name != null
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;all nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),                                                     &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Series-N ä¼šè‡ªåŠ¨è½¬æ¢ä¸º Series-1
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;reverse&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;reversed names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),                                  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Series-N ä¼šè‡ªåŠ¨è½¬æ¢ä¸º Series-1,
&lt;&#x2F;span&gt;&lt;span&gt;    (pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;filter&lt;&#x2F;span&gt;&lt;span&gt;(pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;is_not_null&lt;&#x2F;span&gt;&lt;span&gt;()) &#x2F; 
&lt;&#x2F;span&gt;&lt;span&gt;     pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;() * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100
&lt;&#x2F;span&gt;&lt;span&gt;    ).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;hasname_percents&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),                                                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# æ¯”è¾ƒå¤æ‚çš„è¡¨è¾¾å¼ 
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;filter&lt;&#x2F;span&gt;&lt;span&gt;(pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;is_not_null&lt;&#x2F;span&gt;&lt;span&gt;())
&lt;&#x2F;span&gt;&lt;span&gt;      .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;filter&lt;&#x2F;span&gt;&lt;span&gt;(pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) &amp;gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random_hasname_tailer&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# ç†è§£ filter 
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div&gt;&lt;style&gt;
.dataframe &gt; thead &gt; tr,
.dataframe &gt; tbody &gt; tr {
  text-align: right;
  white-space: pre-wrap;
}
&lt;&#x2F;style&gt;
&lt;small&gt;shape: (3, 10)&lt;&#x2F;small&gt;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;groups&lt;&#x2F;th&gt;&lt;th&gt;nrs&lt;&#x2F;th&gt;&lt;th&gt;random&lt;&#x2F;th&gt;&lt;th&gt;random_count&lt;&#x2F;th&gt;&lt;th&gt;random_hasname&lt;&#x2F;th&gt;&lt;th&gt;random_sum&lt;&#x2F;th&gt;&lt;th&gt;all nrs&lt;&#x2F;th&gt;&lt;th&gt;reversed names&lt;&#x2F;th&gt;&lt;th&gt;hasname_percents&lt;&#x2F;th&gt;&lt;th&gt;random_hasname_tailer&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;i64&lt;&#x2F;td&gt;&lt;td&gt;list[f64]&lt;&#x2F;td&gt;&lt;td&gt;u32&lt;&#x2F;td&gt;&lt;td&gt;list[f64]&lt;&#x2F;td&gt;&lt;td&gt;f64&lt;&#x2F;td&gt;&lt;td&gt;list[i64]&lt;&#x2F;td&gt;&lt;td&gt;list[str]&lt;&#x2F;td&gt;&lt;td&gt;list[f64]&lt;&#x2F;td&gt;&lt;td&gt;list[f64]&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&amp;quot;C&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;0&lt;&#x2F;td&gt;&lt;td&gt;[0.846002]&lt;&#x2F;td&gt;&lt;td&gt;1&lt;&#x2F;td&gt;&lt;td&gt;[0.846002]&lt;&#x2F;td&gt;&lt;td&gt;0.846002&lt;&#x2F;td&gt;&lt;td&gt;[null]&lt;&#x2F;td&gt;&lt;td&gt;[&amp;quot;egg&amp;quot;]&lt;&#x2F;td&gt;&lt;td&gt;[100.0]&lt;&#x2F;td&gt;&lt;td&gt;[]&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;&amp;quot;B&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;8&lt;&#x2F;td&gt;&lt;td&gt;[0.249306, 0.252116]&lt;&#x2F;td&gt;&lt;td&gt;2&lt;&#x2F;td&gt;&lt;td&gt;[0.249306]&lt;&#x2F;td&gt;&lt;td&gt;0.249306&lt;&#x2F;td&gt;&lt;td&gt;[3, 5]&lt;&#x2F;td&gt;&lt;td&gt;[null, &amp;quot;spam&amp;quot;]&lt;&#x2F;td&gt;&lt;td&gt;[49.719785]&lt;&#x2F;td&gt;&lt;td&gt;[0.249306]&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;&amp;quot;A&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;3&lt;&#x2F;td&gt;&lt;td&gt;[0.830762, 0.052124]&lt;&#x2F;td&gt;&lt;td&gt;2&lt;&#x2F;td&gt;&lt;td&gt;[0.830762, 0.052124]&lt;&#x2F;td&gt;&lt;td&gt;0.882886&lt;&#x2F;td&gt;&lt;td&gt;[1, 2]&lt;&#x2F;td&gt;&lt;td&gt;[&amp;quot;ham&amp;quot;, &amp;quot;foo&amp;quot;]&lt;&#x2F;td&gt;&lt;td&gt;[94.096138, 5.903862]&lt;&#x2F;td&gt;&lt;td&gt;[0.052124]&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;
&lt;p&gt;è¿™ä¸ªç¤ºä¾‹ä¸­æœ‰å‡ ä¸ªExpressionçš„ç†è§£ä¼šæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦ç†è§£ Series-N å’Œ Series-1 çš„è®¡ç®—è¿‡ç¨‹ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;pl.sum(&quot;nrs&quot;)&lt;&#x2F;code&gt; åœ¨å½“å‰åˆ†ç»„ä¸­ï¼Œæ±‚å€¼ä¸º Series-1&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;pl.col(&quot;random&quot;).filter(pl.col(&quot;names&quot;).is_not_null()).sum().name.suffix(&quot;_sum&quot;)&lt;&#x2F;code&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;X = pl.col(&quot;random&quot;)&lt;&#x2F;code&gt; æ±‚å€¼ä¸º Series-N&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;Y = X.filter(pl.col(&quot;names&quot;).is_not_null())&lt;&#x2F;code&gt; æ±‚å€¼ä¸º Series-N&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;Y.sum()&lt;&#x2F;code&gt; æ±‚å€¼ä¸º Series-1&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;pl.col(&quot;random&quot;).filter(pl.col(&quot;names&quot;).is_not_null()).filter(pl.col(&quot;nrs&quot;) &amp;gt;= 2).alias(&quot;random_hasname_tailer&quot;) &lt;&#x2F;code&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;X = pl.col(&quot;random&quot;)&lt;&#x2F;code&gt;: Series-N&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;Y = X.filter(pl.col(&quot;names&quot;).is_not_null())&lt;&#x2F;code&gt; : X çš„ç¯å¢ƒä¸­ä¸ä»…ä»…åŒ…æ‹¬ randomåˆ—ï¼Œä¹ŸåŒ…æ‹¬äº†å…¶ä»–çš„åˆ—ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;Z = Y.filter(pl.col(&quot;nrs&quot;) &amp;gt;= 2)&lt;&#x2F;code&gt;  : Zï¼šä»Y ä¸­æ´¾ç”Ÿå‡ºæ¥ï¼ŒY ä¸­ä¹ŸåŒ…å«äº†å…¶ä»–çš„åˆ—ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è¿™ä¸ª filter çš„ä¸Šä¸‹æ–‡ç¡®å®éå¸¸å¼ºå¤§ï¼Œåç»­åœ¨é˜…è¯»ä»£ç æ—¶ï¼Œéœ€è¦ç†è§£è¿™ä¸ªæ‰§è¡Œçš„é€»è¾‘ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;2-expressions&quot;&gt;2. Expressions&lt;&#x2F;h2&gt;
&lt;p&gt;ç†è§£äº† context ä¹‹åï¼Œexpression çš„å¤šæ ·æ€§å°±æ˜¾å¾—æ²¡æœ‰é‚£ä¹ˆå¤æ‚äº†ï¼Œå¦åˆ™çš„è¯ï¼Œä¸€å¤§å †çš„ expression ä¼šè®©äººçœ¼èŠ±ç¼­ä¹±ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ç±»ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;operators: +, -, *, &#x2F; etc.&lt;&#x2F;li&gt;
&lt;li&gt;column selections: p.col(&quot;name&quot;), p.all()&lt;&#x2F;li&gt;
&lt;li&gt;functions, case when,&lt;&#x2F;li&gt;
&lt;li&gt;casting&lt;&#x2F;li&gt;
&lt;li&gt;strings&lt;&#x2F;li&gt;
&lt;li&gt;aggregations&lt;&#x2F;li&gt;
&lt;li&gt;missing data&lt;&#x2F;li&gt;
&lt;li&gt;window functions&lt;&#x2F;li&gt;
&lt;li&gt;folds&lt;&#x2F;li&gt;
&lt;li&gt;lists&lt;&#x2F;li&gt;
&lt;li&gt;UDF&lt;&#x2F;li&gt;
&lt;li&gt;struts&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;df
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div&gt;&lt;style&gt;
.dataframe &gt; thead &gt; tr,
.dataframe &gt; tbody &gt; tr {
  text-align: right;
  white-space: pre-wrap;
}
&lt;&#x2F;style&gt;
&lt;small&gt;shape: (5, 4)&lt;&#x2F;small&gt;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;nrs&lt;&#x2F;th&gt;&lt;th&gt;names&lt;&#x2F;th&gt;&lt;th&gt;random&lt;&#x2F;th&gt;&lt;th&gt;groups&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;i64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;td&gt;f64&lt;&#x2F;td&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;1&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;foo&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;0.332095&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;A&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;2&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;ham&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;0.807228&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;A&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;3&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;0.174601&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;B&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;egg&amp;quot;&lt;&#x2F;td&gt;&lt;td&gt;0.839158&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;C&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;5&lt;&#x2F;td&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;td&gt;0.498681&lt;&#x2F;td&gt;&lt;td&gt;&amp;quot;B&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;out = df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;group_by&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;groups&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;agg&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# sum nrs by groups
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# count group members
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# sum random where name != null
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;filter&lt;&#x2F;span&gt;&lt;span&gt;(pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;is_not_null&lt;&#x2F;span&gt;&lt;span&gt;()).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;().name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;suffix&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;_sum&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;reverse&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;reversed names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;print&lt;&#x2F;span&gt;&lt;span&gt;(out)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;shape: (3, 5)
&lt;&#x2F;span&gt;&lt;span&gt;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ groups â”† nrs â”† count â”† random_sum â”† reversed names â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ ---    â”† --- â”† ---   â”† ---        â”† ---            â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ str    â”† i64 â”† u32   â”† f64        â”† list[str]      â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¡
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ A      â”† 3   â”† 2     â”† 1.139323   â”† [&amp;quot;ham&amp;quot;, &amp;quot;foo&amp;quot;] â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ C      â”† 0   â”† 1     â”† 0.839158   â”† [&amp;quot;egg&amp;quot;]        â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ B      â”† 8   â”† 2     â”† 0.174601   â”† [null, &amp;quot;spam&amp;quot;] â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;( pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;filter&lt;&#x2F;span&gt;&lt;span&gt;( pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) &amp;gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3 &lt;&#x2F;span&gt;&lt;span&gt;) )
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div&gt;&lt;style&gt;
.dataframe &gt; thead &gt; tr,
.dataframe &gt; tbody &gt; tr {
  text-align: right;
  white-space: pre-wrap;
}
&lt;&#x2F;style&gt;
&lt;small&gt;shape: (2, 1)&lt;&#x2F;small&gt;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;names&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;filter&lt;&#x2F;span&gt;&lt;span&gt;( pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) &amp;gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3 &lt;&#x2F;span&gt;&lt;span&gt;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;( pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) )
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div&gt;&lt;style&gt;
.dataframe &gt; thead &gt; tr,
.dataframe &gt; tbody &gt; tr {
  text-align: right;
  white-space: pre-wrap;
}
&lt;&#x2F;style&gt;
&lt;small&gt;shape: (2, 1)&lt;&#x2F;small&gt;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;names&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;str&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&amp;quot;spam&amp;quot;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;null&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;out = df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;group_by&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;groups&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;agg&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;nrs&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;(),  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# sum nrs by groups
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# count group members
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# sum random where name != null
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;random&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;filter&lt;&#x2F;span&gt;&lt;span&gt;(pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;is_not_null&lt;&#x2F;span&gt;&lt;span&gt;()).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sum&lt;&#x2F;span&gt;&lt;span&gt;().name.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;suffix&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;_sum&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;reverse&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;reversed names&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;),
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;print&lt;&#x2F;span&gt;&lt;span&gt;(out)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;shape: (3, 5)
&lt;&#x2F;span&gt;&lt;span&gt;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ groups â”† nrs â”† count â”† random_sum â”† reversed names â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ ---    â”† --- â”† ---   â”† ---        â”† ---            â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ str    â”† i64 â”† u32   â”† f64        â”† list[str]      â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¡
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ A      â”† 3   â”† 2     â”† 1.139323   â”† [&amp;quot;ham&amp;quot;, &amp;quot;foo&amp;quot;] â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ C      â”† 0   â”† 1     â”† 0.839158   â”† [&amp;quot;egg&amp;quot;]        â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â”‚ B      â”† 8   â”† 2     â”† 0.174601   â”† [null, &amp;quot;spam&amp;quot;] â”‚
&lt;&#x2F;span&gt;&lt;span&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span&gt;datetime &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;date ;
&lt;&#x2F;span&gt;&lt;span&gt;df2 = (
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;date_range&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;start&lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;date&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2021&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;),
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;end&lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;date&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2021&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;12&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;31&lt;&#x2F;span&gt;&lt;span&gt;),
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;interval&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;1d&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;eager&lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;True&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    )
&lt;&#x2F;span&gt;&lt;span&gt;    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;time&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;to_frame&lt;&#x2F;span&gt;&lt;span&gt;()
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;df2
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;div&gt;&lt;style&gt;
.dataframe &gt; thead &gt; tr,
.dataframe &gt; tbody &gt; tr {
  text-align: right;
  white-space: pre-wrap;
}
&lt;&#x2F;style&gt;
&lt;small&gt;shape: (365, 1)&lt;&#x2F;small&gt;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;time&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;date&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;2021-01-01&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;2021-01-02&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;2021-01-03&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;2021-01-04&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;2021-01-05&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;&amp;hellip;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;2021-12-27&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;2021-12-28&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;2021-12-29&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;2021-12-30&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;2021-12-31&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;
&lt;h2 id=&quot;3-eager-or-lazy&quot;&gt;3. Eager or Lazy&lt;&#x2F;h2&gt;
&lt;h2 id=&quot;4-transformation&quot;&gt;4. Transformation&lt;&#x2F;h2&gt;
&lt;h2 id=&quot;5-window-function&quot;&gt;5. Window Function&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;apple_stocks = (
&lt;&#x2F;span&gt;&lt;span&gt;    pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;scan_csv&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;.&#x2F;apple_stock.csv&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;q = (apple_stocks
&lt;&#x2F;span&gt;&lt;span&gt;    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;( pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Date&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).str.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;to_datetime&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;%Y&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;-&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;%m&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;-&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;%d&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;), &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Close&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;with_columns&lt;&#x2F;span&gt;&lt;span&gt;(pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Date&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).dt.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;to_string&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;%Y&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;-&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;%m&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;YM&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;))
&lt;&#x2F;span&gt;&lt;span&gt;    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sort&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Date&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;with_columns&lt;&#x2F;span&gt;&lt;span&gt;( pl.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Close&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;last&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;over&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;YM&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;last_close&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) )
&lt;&#x2F;span&gt;&lt;span&gt;    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;YM&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;last_close&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;unique&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sort&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;YM&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;q.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;show_graph&lt;&#x2F;span&gt;&lt;span&gt;()
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# q.explain()
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;polars-notebook&#x2F;output_42_0.svg&quot; alt=&quot;svg&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;6-operator-and-functions&quot;&gt;6. Operator and Functions&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;misc-why-an-expression-based-api-other-than-sql-in-polars&quot;&gt;Misc: Why an Expression based API other than SQL in Polars?&lt;&#x2F;h2&gt;
&lt;p&gt;The short answer:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Is Polars DSL a superset of SQL? Many DSL capabilities can&#x27;t be expressed in SQL.&lt;&#x2F;li&gt;
&lt;li&gt;What capabilities can be expressed by SQL but not by Polars DSL?&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;In terms of ease of use, SQL is undoubtedly a more concise expression, while DSL is slightly redundant. However, for complex logic, SQL may use complex nesting to represent it, while DSLs can be more concise in this regard.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;todo&quot;&gt;TODO&lt;&#x2F;h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
Supplemented the analysis of Polars&#x27; execution process and performance optimization strategy&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
Is it OK to further test the JOIN performance of Polars?&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
How to read Polars&#x27; query plan&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
Think about how to optimize further data: for example, how to optimize indexed datasets (including min-max indexes, bloom indexes, bitmap indexes, etc.)&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
What can polars do in our multidimensional model queries?&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&#x2F;&gt;
window functions.&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt; 1. Use polars to query the wide table and cache it in a parquet file.
&lt;&#x2F;span&gt;&lt;span&gt; 2. æŸ¥è¯¢æ—¶ï¼Œä»ç¼“å­˜çš„parquet ä¸­è¯»å–æ•°æ®ã€‚
&lt;&#x2F;span&gt;&lt;span&gt; 3. aggregate æŸ¥è¯¢æ—¶ï¼Œè‡ªåŠ¨ç¼“å­˜èšåˆçš„ç»“æœæ•°æ®ã€‚
&lt;&#x2F;span&gt;&lt;span&gt; 4. ä½¿ç”¨ LRU æœºåˆ¶ç®¡ç†ç¼“å­˜æ•°æ®ã€‚&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>å‘é‡å­¦ä¹ </title>
        <published>2024-05-13T12:00:00+00:00</published>
        <updated>2024-05-13T12:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/vectorize-1/"/>
        <id>https://wangzaixiang.github.io/blog/vectorize-1/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/vectorize-1/">&lt;p&gt;æœ¬æ–‡æ˜¯æƒ³é€šè¿‡æ¡ˆä¾‹æ¥å­¦ä¹  vectorize çš„ ä½¿ç”¨ã€æ•ˆæœï¼Œä»¥åŠ æ·±å¯¹è¿™é¡¹æŠ€æœ¯çš„ç†è§£ã€‚
è¿™ä¸ªä¾‹å­æ˜¯ å‚è€ƒ: &lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;605743800&quot;&gt;ucasflï¼šClickHouse ç³»åˆ— - å‘é‡åŒ–æ‰§è¡Œå¼•æ“ä»‹ç»&lt;&#x2F;a&gt; ä¸­ä»‹ç»çš„ countBytes å‡½æ•°ï¼Œ
æˆ‘ä½¿ç”¨ rust portable Simd åº“æ¥è¿›è¡Œç»ƒä¹ ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä»£ç å¯ä»¥ ä»è¿™é‡Œè®¿é—®ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;play.rust-lang.org&#x2F;?version=nightly&amp;amp;mode=release&amp;amp;edition=2021&amp;amp;gist=e5f7c81e71e467adad2d372d13625f16&quot;&gt;playground&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æˆ–è€…å‚è€ƒå¦‚ä¸‹ä»£ç ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span&gt;#![&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;feature&lt;&#x2F;span&gt;&lt;span&gt;(portable_simd)]
&lt;&#x2F;span&gt;&lt;span&gt;#![&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;feature&lt;&#x2F;span&gt;&lt;span&gt;(stdsimd)]
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;std::mem::{size_of};
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;std::simd::{SimdPartialEq, ToBitMask};
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;std::simd::{u8x16, u8x32, u8x64};
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;std::simd::Simd;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;fill_data&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for&lt;&#x2F;span&gt;&lt;span&gt; i in &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;..bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; random = rand::random::&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u16&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        bytes[i] = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; random % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8 &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;4 &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 &lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{ random as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8 &lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; bytes = [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1024&lt;&#x2F;span&gt;&lt;span&gt;];
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; random = rand::random::&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;fill_data&lt;&#x2F;span&gt;&lt;span&gt;(&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut&lt;&#x2F;span&gt;&lt;span&gt; bytes);
&lt;&#x2F;span&gt;&lt;span&gt;    {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;run1&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;countNonZero_inline&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1_000_000&lt;&#x2F;span&gt;&lt;span&gt;, || {
&lt;&#x2F;span&gt;&lt;span&gt;            bytes[random % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1024&lt;&#x2F;span&gt;&lt;span&gt;] += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            countNonZero_inline(&amp;amp;bytes)
&lt;&#x2F;span&gt;&lt;span&gt;        });
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    println!();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;run1&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;countNonZeroV128_countOnes_inline&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;16&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1_000_000&lt;&#x2F;span&gt;&lt;span&gt;, || {
&lt;&#x2F;span&gt;&lt;span&gt;            bytes[random % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1024&lt;&#x2F;span&gt;&lt;span&gt;] += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            countNonZeroV128_countOnes_inline(&amp;amp;bytes)
&lt;&#x2F;span&gt;&lt;span&gt;        });
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;run1&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;countNonZeroV256_countOnes_inline&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;32&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1_000_000&lt;&#x2F;span&gt;&lt;span&gt;, || {
&lt;&#x2F;span&gt;&lt;span&gt;            bytes[random % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1024&lt;&#x2F;span&gt;&lt;span&gt;] += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            countNonZeroV256_countOnes_inline(&amp;amp;bytes)
&lt;&#x2F;span&gt;&lt;span&gt;        });
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;run1&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;countNonZeroV512_countOnes_inline&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;64&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1_000_000&lt;&#x2F;span&gt;&lt;span&gt;, || {
&lt;&#x2F;span&gt;&lt;span&gt;            bytes[random % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1024&lt;&#x2F;span&gt;&lt;span&gt;] += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            countNonZeroV512_countOnes_inline(&amp;amp;bytes)
&lt;&#x2F;span&gt;&lt;span&gt;        });
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    println!();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    #[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;    {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;run1&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;countNonZeroV128_popcnt_intrins_inline&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;16&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1_000_000&lt;&#x2F;span&gt;&lt;span&gt;, || {
&lt;&#x2F;span&gt;&lt;span&gt;            bytes[random % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1024&lt;&#x2F;span&gt;&lt;span&gt;] += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            countNonZeroV128_popcnt_intrins_inline(&amp;amp;bytes)
&lt;&#x2F;span&gt;&lt;span&gt;        });
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;run1&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;countNonZeroV256_popcnt_intrins_inline&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;32&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1_000_000&lt;&#x2F;span&gt;&lt;span&gt;, || {
&lt;&#x2F;span&gt;&lt;span&gt;            bytes[random % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1024&lt;&#x2F;span&gt;&lt;span&gt;] += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            countNonZeroV256_popcnt_intrins_inline(&amp;amp;bytes)
&lt;&#x2F;span&gt;&lt;span&gt;        });
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; require 256bit AVX2
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;run1&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;countNonZeroV256_popcnt_intrins_x86&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;32&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1_000_000&lt;&#x2F;span&gt;&lt;span&gt;, || {
&lt;&#x2F;span&gt;&lt;span&gt;            bytes[random % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1024&lt;&#x2F;span&gt;&lt;span&gt;] += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ countNonZeroV256_popcnt_intrins_x86(&amp;amp;bytes) }
&lt;&#x2F;span&gt;&lt;span&gt;        });
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;run1&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;countNonZeroV512_popcnt_intrins_inline&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;64&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1_000_000&lt;&#x2F;span&gt;&lt;span&gt;, || {
&lt;&#x2F;span&gt;&lt;span&gt;            bytes[random % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1024&lt;&#x2F;span&gt;&lt;span&gt;] += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            countNonZeroV512_popcnt_intrins_inline(&amp;amp;bytes)
&lt;&#x2F;span&gt;&lt;span&gt;        });
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; require 512bit AVX2
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;run1&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;countNonZeroV512_popcnt_intrins_x86&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;32&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1_000_000&lt;&#x2F;span&gt;&lt;span&gt;, || {
&lt;&#x2F;span&gt;&lt;span&gt;            bytes[random % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1024&lt;&#x2F;span&gt;&lt;span&gt;] += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ countNonZeroV512_popcnt_intrins_x86(&amp;amp;bytes) }
&lt;&#x2F;span&gt;&lt;span&gt;        });
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    println!();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    #[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;    {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;run1&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;countNonZeroV128_popcntAsm_inline&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;16&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1_000_000&lt;&#x2F;span&gt;&lt;span&gt;, || {
&lt;&#x2F;span&gt;&lt;span&gt;            bytes[random % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1024&lt;&#x2F;span&gt;&lt;span&gt;] += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            countNonZeroV128_popcntAsm_inline(&amp;amp;bytes)
&lt;&#x2F;span&gt;&lt;span&gt;        });
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;run1&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;countNonZeroV256_popcntAsm_inline&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;32&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1_000_000&lt;&#x2F;span&gt;&lt;span&gt;, || {
&lt;&#x2F;span&gt;&lt;span&gt;            bytes[random % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1024&lt;&#x2F;span&gt;&lt;span&gt;] += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            countNonZeroV128_popcntAsm_inline(&amp;amp;bytes)
&lt;&#x2F;span&gt;&lt;span&gt;        });
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;run1&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;countNonZeroV512_popcntAsm_inline&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;64&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1_000_000&lt;&#x2F;span&gt;&lt;span&gt;, || {
&lt;&#x2F;span&gt;&lt;span&gt;            bytes[random % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1024&lt;&#x2F;span&gt;&lt;span&gt;] += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            countNonZeroV128_popcntAsm_inline(&amp;amp;bytes)
&lt;&#x2F;span&gt;&lt;span&gt;        });
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    println!();
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;run1&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;F&amp;gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;label&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;str&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;width&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;loops&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;mut &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;f&lt;&#x2F;span&gt;&lt;span&gt;: F) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;where&lt;&#x2F;span&gt;&lt;span&gt; F: FnMut()-&amp;gt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize  &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; time0 = std::time::Instant::now();
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; time1 = time0;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; end = time0 + std::time::Duration::from_secs(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; sum = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; n = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;loop &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for&lt;&#x2F;span&gt;&lt;span&gt; _i in &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;..loops {
&lt;&#x2F;span&gt;&lt;span&gt;            sum += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;f&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        n += loops;
&lt;&#x2F;span&gt;&lt;span&gt;        time1 = std::time::Instant::now();
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; time1 &amp;gt;= end {
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;break&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; elapsed = time1 - time0;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; avg = elapsed.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_nanos&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f64 &lt;&#x2F;span&gt;&lt;span&gt;&#x2F; n as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;f64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    println!(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;{label:32}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\t&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;lane width: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{width}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\t&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;sum:{sum:16}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\t&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;times:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{elapsed:?}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;\t&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;time:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;{avg:?}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;ns&#x2F;iter&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;);
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(always)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZero_inline&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for &lt;&#x2F;span&gt;&lt;span&gt;&amp;amp;byte in bytes {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; byte != &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            count += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZero&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for &lt;&#x2F;span&gt;&lt;span&gt;&amp;amp;byte in bytes {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; byte != &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            count += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(always)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV128_popcnt_intrins_inline&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = u8x16;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        count += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ std::arch::x86_64::_popcnt64(bits as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(always)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV256_popcnt_intrins_inline&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = u8x32;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        count += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ std::arch::x86_64::_popcnt64(bits as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(always)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV256_popcnt_intrins_x86&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;core::arch::x86_64::*;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = __m256i;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;_mm256_setzero_si256&lt;&#x2F;span&gt;&lt;span&gt;() ;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;_mm256_loadu_epi8&lt;&#x2F;span&gt;&lt;span&gt;(bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_ptr&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;add&lt;&#x2F;span&gt;&lt;span&gt;(i) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const i8&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; mask = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;_mm256_cmp_epi8_mask&lt;&#x2F;span&gt;&lt;span&gt;(chunk, zero, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;_MM_CMPINT_NE&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        count +=  mask.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;count_ones&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        i += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;32&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(always)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV512_popcnt_intrins_inline&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = u8x64;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        count += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ std::arch::x86_64::_popcnt64(bits as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(always)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV512_popcnt_intrins_x86&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;core::arch::x86_64::*;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = __m512i;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;_mm512_setzero_si512&lt;&#x2F;span&gt;&lt;span&gt;() ;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;_mm512_loadu_epi8&lt;&#x2F;span&gt;&lt;span&gt;(bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;as_ptr&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;add&lt;&#x2F;span&gt;&lt;span&gt;(i) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;*const i8&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; mask = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;_mm512_cmp_epi8_mask&lt;&#x2F;span&gt;&lt;span&gt;(chunk, zero, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;_MM_CMPINT_NE&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        count +=  mask.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;count_ones&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        i += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;&#x2F;&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV128_popcnt_intrins&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = u8x16;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        count += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ std::arch::x86_64::_popcnt64(bits as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV256_popcnt_intrins&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = u8x32;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        count += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ std::arch::x86_64::_popcnt64(bits as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV512_popcnt_intrins&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = u8x64;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        count += &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ std::arch::x86_64::_popcnt64(bits as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;i64&lt;&#x2F;span&gt;&lt;span&gt;) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;};
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(always)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV128_countOnes_inline&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = Simd&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;, 16&amp;gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits = cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        count += bits.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;count_ones&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(always)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV256_countOnes_inline&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = Simd&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;, 32&amp;gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits = cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        count += bits.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;count_ones&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(always)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV512_countOnes_inline&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = Simd&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;, 64&amp;gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits = cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        count += bits.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;count_ones&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;&#x2F;&#x2F; no-inline
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV128_countOnes&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = Simd&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;, 16&amp;gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits = cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        count += bits.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;count_ones&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV256_countOnes&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = Simd&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;, 32&amp;gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits = cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        count += bits.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;count_ones&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV512_countOnes&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = Simd&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;, 64&amp;gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits = cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        count += bits.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;count_ones&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(always)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV128_popcntAsm_inline&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;core::arch::asm;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = u8x16;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; n: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; count += unsafe { std::arch::x86_64::_popcnt32(bits as i32) as usize };
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ asm! {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;popcnt {y}, {x}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, x = in(reg) bits, y = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;out&lt;&#x2F;span&gt;&lt;span&gt;(reg) n
&lt;&#x2F;span&gt;&lt;span&gt;        } }
&lt;&#x2F;span&gt;&lt;span&gt;        count += n;
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(always)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV256_popcntAsm_inline&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;core::arch::asm;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = u8x32;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; n: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; count += unsafe { std::arch::x86_64::_popcnt32(bits as i32) as usize };
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ asm! {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;popcnt {y}, {x}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, x = in(reg) bits, y = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;out&lt;&#x2F;span&gt;&lt;span&gt;(reg) n
&lt;&#x2F;span&gt;&lt;span&gt;        } }
&lt;&#x2F;span&gt;&lt;span&gt;        count += n;
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(always)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV512_popcntAsm_inline&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;core::arch::asm;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = u8x64;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; n: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; count += unsafe { std::arch::x86_64::_popcnt32(bits as i32) as usize };
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ asm! {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;popcnt {y}, {x}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, x = in(reg) bits, y = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;out&lt;&#x2F;span&gt;&lt;span&gt;(reg) n
&lt;&#x2F;span&gt;&lt;span&gt;        } }
&lt;&#x2F;span&gt;&lt;span&gt;        count += n;
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;&#x2F; no-inline
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV128_popcntAsm&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;core::arch::asm;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = u8x16;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; n: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; count += unsafe { std::arch::x86_64::_popcnt32(bits as i32) as usize };
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ asm! {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;popcnt {y}, {x}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, x = in(reg) bits, y = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;out&lt;&#x2F;span&gt;&lt;span&gt;(reg) n
&lt;&#x2F;span&gt;&lt;span&gt;        } }
&lt;&#x2F;span&gt;&lt;span&gt;        count += n;
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV256_popcntAsm&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;core::arch::asm;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = u8x32;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; n: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; count += unsafe { std::arch::x86_64::_popcnt32(bits as i32) as usize };
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ asm! {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;popcnt {y}, {x}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, x = in(reg) bits, y = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;out&lt;&#x2F;span&gt;&lt;span&gt;(reg) n
&lt;&#x2F;span&gt;&lt;span&gt;        } }
&lt;&#x2F;span&gt;&lt;span&gt;        count += n;
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cfg&lt;&#x2F;span&gt;&lt;span&gt;(target_arch = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;x86_64&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span&gt;#[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inline&lt;&#x2F;span&gt;&lt;span&gt;(never)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;countNonZeroV512_popcntAsm&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bytes&lt;&#x2F;span&gt;&lt;span&gt;: &amp;amp;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u8&lt;&#x2F;span&gt;&lt;span&gt;]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;use &lt;&#x2F;span&gt;&lt;span&gt;core::arch::asm;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;VT = u8x64;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; count = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; i = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; zero = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::splat(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt; i + size_of::&amp;lt;VT&amp;gt;() &amp;lt;= bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; chunk = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;VT&lt;&#x2F;span&gt;&lt;span&gt;::from_slice(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; cmp = chunk.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;simd_ne&lt;&#x2F;span&gt;&lt;span&gt;(zero);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; bits: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64 &lt;&#x2F;span&gt;&lt;span&gt;= cmp.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;to_bitmask&lt;&#x2F;span&gt;&lt;span&gt;() as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;u64&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; n: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;usize&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; count += unsafe { std::arch::x86_64::_popcnt32(bits as i32) as usize };
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;unsafe &lt;&#x2F;span&gt;&lt;span&gt;{ asm! {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;popcnt {y}, {x}&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, x = in(reg) bits, y = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;out&lt;&#x2F;span&gt;&lt;span&gt;(reg) n
&lt;&#x2F;span&gt;&lt;span&gt;        } }
&lt;&#x2F;span&gt;&lt;span&gt;        count += n;
&lt;&#x2F;span&gt;&lt;span&gt;        i += size_of::&amp;lt;VT&amp;gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; i &amp;lt; bytes.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;len&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        count += countNonZero_inline(&amp;amp;bytes[i..]);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    count
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ol&gt;
&lt;li&gt;128bit: u8x16&lt;&#x2F;li&gt;
&lt;li&gt;256bit: u8x32&lt;&#x2F;li&gt;
&lt;li&gt;512bit: u8x64&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è¿™ä¸ªå®ç°ä¸­ï¼Œå¯¹å¦‚ä½•è¿›è¡Œæ•´æ•°çš„1ä½ç»Ÿè®¡åˆ†åˆ«ä½¿ç”¨äº†3ç§æ–¹æ³•ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;count_onesã€‚çœ‹rustå¾—å®ç°ï¼Œé‡‡ç”¨çš„ç®—æ³•å¹¶ä¸ç®—å¤ªé«˜æ•ˆ&lt;&#x2F;li&gt;
&lt;li&gt;å°è¯•ä½¿ç”¨  std::arch::x86_64::_popcnt64(bits as i64)&lt;&#x2F;li&gt;
&lt;li&gt;å°è¯•ä½¿ç”¨ asm åµŒå…¥ popcnt æŒ‡ä»¤ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;åé¢å‘ç°ï¼Œå…¶å®å¯ä»¥ä½¿ç”¨ &lt;code&gt;-Ctarget-cpu=native&lt;&#x2F;code&gt; æ¥è¯†åˆ« popcnt ç‰¹æ€§ï¼Œä»è€Œè‡ªåŠ¨ç”Ÿæˆ popcntçš„ä»£ç ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥è·å¾—å¾ˆå¥½çš„æ‰§è¡Œæ•ˆæœã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åˆ†åˆ«åœ¨3ä¸ªå¹³å°ä¸Šè¿›è¡Œäº†æµ‹è¯•ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;M1-MAX&lt;&#x2F;li&gt;
&lt;li&gt;X86 on M1-MAX(Rosetta 2)&lt;&#x2F;li&gt;
&lt;li&gt;X86(å†…éƒ¨è™šæ‹Ÿæœº)&lt;&#x2F;li&gt;
&lt;li&gt;X86(é˜¿é‡Œäº‘ ecs.c7.xlargeå‹å·ï¼ŒCPUä¸ºï¼šIntel Xeon(Ice Lake) Platinum 8369B)&lt;&#x2F;li&gt;
&lt;li&gt;ecs.c7.xlargeï¼Œå¯ç”¨ -Ctarget-cpu=native&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;vectorize-1&#x2F;simd-1.webp&quot; alt=&quot;æ€§èƒ½å¯¹æ¯”&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æ›´æ–°ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ x86 AVX512ä¸Šï¼Œä½¿ç”¨ &lt;code&gt;cargo +nightly rustc --release -- -Ctarget-cpu=native&lt;&#x2F;code&gt; é€‰é¡¹ç¼–è¯‘åçš„æ€§èƒ½æ›´ä½³ã€‚åº”è¯¥æ˜¯ä½¿ç”¨åˆ°äº†å½“å‰CPUçš„å…¨éƒ¨èƒ½åŠ›,
512bitå‘é‡ä¸‹ï¼Œè¾¾åˆ°äº†11.7nsã€‚&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cargo&lt;&#x2F;span&gt;&lt;span&gt; +nightly rustc&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -Z&lt;&#x2F;span&gt;&lt;span&gt; build-std&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; --target&lt;&#x2F;span&gt;&lt;span&gt; x86_64-unknown-linux-gnu&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; --release&lt;&#x2F;span&gt;&lt;span&gt;  -- -Ctarget-cpu=native
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ç»“è®ºåˆ†æï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å‘é‡åŒ–çš„ç‰ˆæœ¬ç›¸æ¯”æ™®é€šå¾ªç¯çš„ç‰ˆæœ¬ï¼Œæœ‰æ¥è¿‘10å€çš„æå‡ã€‚(M1 æå‡ï¼š4å€ï¼ŒX86æå‡ï¼š9å€ï¼‰portable_simd å®é™…ä½¿ç”¨çš„æ˜¯ 128bit çš„å‘é‡ï¼Œ
ä½†å¯ä»¥ä½¿ç”¨256&#x2F;512ä½çš„APIï¼Œæ­¤æ—¶ï¼Œå®ƒä¼šè¿›è¡Œå±•å¼€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æˆ‘ä¹‹å‰æœ‰ä¸ªè¯¯è§£ï¼Œportable_simdæ— æ³•ä½¿ç”¨åˆ° AVX512ç­‰èƒ½åŠ›ã€‚å®é™…ä¸Šå¹¶ä¸ç„¶ï¼Œåªè¦ç¼–è¯‘æ—¶æŒ‡å®š target-cpuï¼Œæ˜¯å¯ä»¥ä½¿ç”¨åˆ° avx2, avx512ç­‰å‘é‡èƒ½åŠ›çš„ã€‚
portable_simd æ˜¯å¼€å‘å‘é‡åŒ–ç®—æ³•é¦–é€‰ï¼Œæ¯•ç«Ÿå¯ç§»æ¤æ€§æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„éœ€æ±‚ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨éƒ¨ä»½åœºåˆä¸‹ï¼Œrustcä¼šè‡ªåŠ¨å‘é‡åŒ–ï¼Œç®€å•åœºæ™¯ä¸‹æ•ˆæœä¼šå’Œæ‰‹åŠ¨å‘é‡åŒ–æ•ˆæœå·®ä¸å¤šã€‚ä½†æœ‰ä¸å°‘é™åˆ¶ï¼Œå¤æ‚ä¸€äº›ç®—æ³•ï¼Œå¯èƒ½æ— æ³•è‡ªåŠ¨å‘é‡åŒ–ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å°è¯•ä½¿ç”¨ x86 ç§æœ‰çš„ 256ä½å‘é‡&#x2F;512ä½å‘é‡èƒ½åŠ›ï¼Œå‘ç°æ€§èƒ½åè€Œæœ‰ä¸‹é™ï¼ŒæŸ¥çœ‹åŸå› æ˜¯ rustc æ²¡æœ‰ä¸º &lt;em&gt;mm_xxx&lt;&#x2F;em&gt; intrinsc æŒ‡ä»¤ç”Ÿæˆå†…è”ï¼Œ
äº§ç”Ÿäº† function call çš„å¼€é”€ï¼Œè¿™å¯¼è‡´äº†æ€§èƒ½çš„ä¸‹é™ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç¼–å†™æµ‹è¯•ä»£ç æ—¶ï¼Œå‰é¢çš„ç‰ˆæœ¬ï¼Œinlineæ—¶è¿›è¡Œäº†è¿‡åº¦çš„ä¼˜åŒ–ï¼ˆæŒ‡é’ˆå¯¹å½“å‰çš„åœºæ™¯è¿›è¡Œäº†ç‰¹å®šçš„ä¼˜åŒ–ï¼‰ï¼Œå…¶ä¸å…·å¤‡å¯å¤åˆ¶æ€§ï¼Œå¹²æ‰°äº†æµ‹è¯•ã€‚
è°ƒæ•´åçš„æµ‹è¯•æ•°æ®è¦å¥½ç†è§£å¾ˆå¤šã€‚ï¼ˆä¹‹å‰çš„éƒ¨ä»½ä¼˜åŒ–ï¼Œå¯¼è‡´ 512bit å¯ä»¥ä¼˜åŒ–åˆ°4n s ä»¥å†…ï¼Œåå®é™…å‘ç°æ˜¯æµ‹è¯•ä»£ç è§¦å‘äº†rustcè¿›è¡Œäº†é€»è¾‘ä¼˜åŒ–ï¼Œ
å°‘æ‰§è¡Œäº†ä¸å°‘å¾ªç¯ã€‚è°ƒæ•´åçš„ä»£ç å¢åŠ äº†æ•°æ®çš„æ··ä¹±ï¼Œé¿å…è¿‡åº¦ä¼˜åŒ–ï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨åµŒå…¥æ±‡ç¼–åï¼Œå¯èƒ½ä¼šå½±å“ç¼–è¯‘å™¨çš„è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œåœ¨æ¡ˆåˆ—ä¸­ï¼Œasmç‰ˆæœ¬ï¼Œåœ¨æ”¯æŒ AVX512çš„CPUä¸Šå¹¶éæœ€ä½³ï¼Œæˆ‘ä¼°è®¡æ˜¯æ²¡æœ‰è¿›è¡Œå¾ªç¯å±•å¼€å¯¼è‡´çš„ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;hou-xu-wo-hui-shou-ji-ji-yu-xiang-liang-ji-suan-de-yi-xi-lie-suan-fa-zheng-li-yi-ge-ti-gang-li-ru&quot;&gt;åç»­ï¼Œæˆ‘ä¼šæ”¶é›†åŸºäºå‘é‡è®¡ç®—çš„ä¸€ç³»åˆ—ç®—æ³•ï¼Œæ•´ç†ä¸€ä¸ªæçº²ï¼Œä¾‹å¦‚:&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;C++ä¸­çš„å‘é‡è®¡ç®—https:&#x2F;&#x2F;www.zhihu.com&#x2F;question&#x2F;450069375&#x2F;answer&#x2F;3258826060?utm_psn=1714201317017481216&lt;&#x2F;li&gt;
&lt;li&gt;hash å‘é‡ç®—æ³•ï¼šæ˜¯å¦å¯ä»¥è®¾è®¡ä¸€ä¸ªå¯åŸºäº SIMD çš„hashç®—æ³•ï¼ˆä¸æ˜¯å¯¹å•ä¸ªå€¼è®¡ç®—hashï¼Œè€Œæ˜¯å¯¹å‘é‡è®¡ç®—hashå‘é‡ï¼‰ï¼Ÿ&lt;&#x2F;li&gt;
&lt;li&gt;hash joinçš„ å‘é‡ç®—æ³•
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.cockroachlabs.com&#x2F;blog&#x2F;vectorized-hash-joiner&#x2F;&quot;&gt;40x faster hash joiner with vectorized execution&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;æºå¤´ï¼šBalancing vectorized query execution with bandwidth-optimized storage (å·²æ”¶è—åˆ° ivySCI åº“ä¸­ç¬¬5.4èŠ‚ï¼šOptimizing Hash-Join)ï¼Œæ¯”è¾ƒéš¾è¯»ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;groups.csail.mit.edu&#x2F;cag&#x2F;6.893-f2000&#x2F;vectorhashjoin.pdf&quot;&gt;A Vectorized Hash-Join&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;binary search çš„å‘é‡ç®—æ³•&lt;&#x2F;li&gt;
&lt;li&gt;Simd-json ä¸­çš„å‘é‡è®¡ç®—&lt;&#x2F;li&gt;
&lt;li&gt;åŠ å¯†è§£å¯†ä¸­çš„å‘é‡è®¡ç®—&lt;&#x2F;li&gt;
&lt;li&gt;Swiss Tableä¸­çš„å‘é‡è®¡ç®—ç­‰ã€‚Rust HashMapå°±æ˜¯åŸºäºè¿™ä¸ªç»“æ„çš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;base64&lt;a href=&quot;https:&#x2F;&#x2F;link.zhihu.com&#x2F;?target=https%3A&#x2F;&#x2F;mcyoung.xyz&#x2F;2023&#x2F;11&#x2F;27&#x2F;simd-base64&#x2F;&quot;&gt;Designing a SIMD Algorithm from Scratch Â· mcyoung&lt;&#x2F;a&gt;éå¸¸å¥½çš„ä¸€ç¯‡è®²è§£ vectorize çš„æ–‡ç« ã€‚
ä»¥ base64 decodeä¸ºä¾‹æ„é€ ä¸€ä¸ªå‘é‡å®ç°ï¼Œæˆ‘è§‰å¾— encode ä¹Ÿé€‚åˆæ„é€ ä¸€ä¸ªå‘é‡å®ç°ï¼Œå¯ä»¥æ‹¿æ¥ç»ƒæ‰‹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Intel å‘é‡æŒ‡ä»¤ https:&#x2F;&#x2F;www.intel.com&#x2F;content&#x2F;www&#x2F;us&#x2F;en&#x2F;docs&#x2F;intrinsics-guide&#x2F;index.html&lt;&#x2F;li&gt;
&lt;li&gt;https:&#x2F;&#x2F;github.com&#x2F;cloudwego&#x2F;sonic-rs&#x2F;blob&#x2F;main&#x2F;docs&#x2F;performance_zh.md sonic-rså¦‚ä½•åˆ©ç”¨SIMDæ¥åŠ é€ŸJSONè§£æ&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;zig è¯­è¨€æœ‰å†…ç½®çš„ SIMD æ”¯æŒï¼Œåœ¨ Parker Liu çš„ä¸“æ ï¼Œæœ‰å¾ˆå¤šå€¼å¾—å­¦ä¹ çš„å¹²è´§ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;687938028&quot;&gt;Zigè¯­è¨€çš„SIMDå¹¶è¡Œè®¡ç®—ä¼˜åŒ–åˆæ¢&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;688345298&quot;&gt;Zigè¯­è¨€çš„SIMDå¹¶è¡Œè®¡ç®—ä¼˜åŒ–åˆæ¢--çŸ©é˜µè½¬ç½®&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;688719072&quot;&gt;Zigè¯­è¨€çš„SIMDå¹¶è¡Œè®¡ç®—ä¼˜åŒ–åˆæ¢--é«˜é€šDSPçš„çŸ©é˜µè½¬ç½®&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;690008262&quot;&gt;Zigè¯­è¨€çš„SIMDå¹¶è¡Œè®¡ç®—ä¼˜åŒ–åˆæ¢--å¹¶è¡Œæ’åº&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;695321017&quot;&gt;Zigè¯­è¨€çš„SIMDå¹¶è¡Œè®¡ç®—ä¼˜åŒ–åˆæ¢--æ··åˆå¿«é€Ÿæ’åº&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;696657692&quot;&gt;Zigè¯­è¨€çš„SIMDå¹¶è¡Œè®¡ç®—ä¼˜åŒ–åˆæ¢--å¤šå‘é‡å¹¶è¡Œæ’åº&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ä¹Ÿæ¬¢è¿å„ä½å¸®å¿™è¡¥å……ä½ æ‰€çŸ¥é“çš„åº”ç”¨å‘é‡è®¡ç®—çš„ç®—æ³•ã€‚&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Scala3 æµ…å°</title>
        <published>2022-07-10T12:00:00+00:00</published>
        <updated>2022-07-10T12:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/trying-scala3/"/>
        <id>https://wangzaixiang.github.io/blog/trying-scala3/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/trying-scala3/">&lt;p&gt;Scala3 ä»2021-05-14 æ­£å¼å‘å¸ƒ 3.0.0 è‡³ä»Šï¼Œå·²å‘å¸ƒäº† 3.0.1ï¼Œ 3.0.2ï¼Œ 3.1.0ï¼Œ 3.1.1ï¼Œ 3.1.2ï¼Œ 3.1.3 ç­‰6ä¸ªå°ç‰ˆæœ¬ï¼Œ
é¢„è®¡7æœˆä»½å¾ˆå¿«å°±è¿æ¥3.2.0çš„ç‰ˆæœ¬ã€‚ä¹‹å‰æœ‰ä¸å°‘çš„Scala2.12&#x2F;2.13çš„ä½¿ç”¨ç»éªŒï¼Œä½†ç”±äºæœ€è¿‘æ²¡æœ‰å®é™…åº”ç”¨çš„é¡¹ç›®ï¼Œæ•…ä¸€ç›´æ²¡æœ‰æœºä¼šåŠ¨æ‰‹ä½“ä¼šScala3ã€‚
æœ€è¿‘é—²æš‡æ—¶é—´ï¼ŒåŠ¨æ‰‹æŠŠä¹‹å‰çš„å‡ ä¸ªåº“è¿ç§»åˆ°Scala3ä¸Šï¼Œå°†éƒ¨ä»½ç»éªŒè®°å½•ä¸€ä¸‹ã€‚&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;2024-08-21 è¡¥å……
è¿™ç¯‡æ–‡ç« å†™äº2022-05,ç°åœ¨æ—¶é—´åˆè¿‡å»äº†2å¹´å¤šï¼ŒScala3 LTS ç‰ˆæœ¬ä¹Ÿå‡ºæ¥äº†ï¼Œç¤¾åŒºå·²ç»åŸºæœ¬è½¬å‘ Scala3äº†ï¼ŒIdeaJ å¯¹ Scala3 çš„æ”¯æŒ
ä¹Ÿè¶‹äºç¨³å®šã€‚æˆ‘ä¹Ÿåœ¨23å¹´å¼€å§‹å¸¦é¢†äº†ä¸€ä¸ªå›¢é˜Ÿï¼Œå°†ä¸€ä¸ªæ ¸å¿ƒçš„äº§å“è½¬å„¿ä½¿ç”¨ Scala3 è¿›è¡Œäº†é‡æ„ï¼Œå–å¾—äº†è‰¯å¥½çš„æˆç»©ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¯èƒ½æ˜¯æˆ‘ä¸ªäººæœ‰åè§ï¼šä½¿ç”¨Javaï¼Œå¤ªå®¹æ˜“å—ä¸è‰¯ä¹ æƒ¯çš„å·¦å³ï¼Œæ˜¯åœ¨å¾ˆéš¾ç¼–å†™å‡ºå¥½çš„ä»£ç å‘¢ï¼Œè€Œåº”ç”¨Scalaï¼Œæˆ‘ä»¬é€šè¿‡æ–½åŠ ä¸€äº›ç®€å•çš„é™åˆ¶åŸåˆ™ï¼Œ
å°±å¯ä»¥å¼ºè¿«å¼€å‘äººå‘˜æ”¹å˜ä¹ æƒ¯ï¼Œç¼–å†™æˆå¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§æ˜¾è‘—æ”¹è¿›çš„ä»£ç ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¾ˆå¸Œæœ›åç»­èƒ½å¤Ÿåœ¨è¿™æ–¹é¢æ€»ç»“ç»éªŒï¼Œåˆ†äº«ï¼Œå¹¶è¿›ä¸€æ­¥æ¨å¹¿å‡½æ•°å¼ç¼–ç¨‹å®è·µã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;h2 id=&quot;idezhi-chi&quot;&gt;IDEæ”¯æŒ&lt;&#x2F;h2&gt;
&lt;p&gt;å­¦ä¹ ä¸€ä¸ªæ–°çš„ç¼–ç¨‹è¯­è¨€ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå¥½çš„IDEæ”¯æŒï¼Œä¼šé¡ºæ‰‹å¾ˆå¤šã€‚ä¹‹å‰ä¸€ç›´åœ¨ ideaj è¿™ä¸ªå·¥å…·ä¸­ç¼–å†™ scala 2 çš„ä»£ç ã€‚ç›®å‰çš„ ideaj å¯¹ Scala3
çš„æ”¯æŒç®—å¾—ä¸Šâ€œèƒ½ç”¨â€çš„é˜¶æ®µï¼Œè¿˜æœ‰ä¸å°‘ç‘•ç–µï¼ŒæœŸå¾…åœ¨æ–°çš„ç‰ˆæœ¬ä¸­èƒ½å¤ŸåŠ é€Ÿä¼˜åŒ–ã€‚è¯´å®åœ¨çš„ï¼Œç›®å‰çš„IDEæ°´å¹³å¯¹Scala3çš„æ¨å¹¿è¿˜æ˜¯ä¼šæœ‰å¾ˆå¤šçš„é˜»ç¢ï¼š
å¤§å®¶å¯¹IDEçš„ä¾èµ–æ˜¯ç›¸å½“å¼ºçš„ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸€äº›ç‘•ç–µï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹æ–°çš„ç¼©è¿›è¯­æ³•çš„ç¼–è¾‘æ”¯æŒä¸€èˆ¬ï¼Œæ¯”å¦‚ Copy - Paste æ“ä½œä¸èƒ½å¾ˆå¥½çš„å¤„ç† indent è¯­æ³•ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹ V3 çš„ä¸€äº›è¯­æ³•ï¼Œå¦‚extensionç­‰ï¼Œè¯­æ³•å¯¼èˆªèƒ½åŠ›è¾ƒå¼±ï¼Œä¹Ÿç¼ºä¹ç±»å‹æç¤ºçš„åŠŸèƒ½ã€‚å¾ˆå¤šåœ¨IDEä¸­çš„ç±»å‹æ¨å¯¼éƒ½å¼±åŒ–åˆ°äº† &lt;code&gt;any&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹ Macro çš„éƒ¨ä»½è¯­æ³•æ”¯æŒä¸å¤Ÿï¼Œä¾‹å¦‚ &lt;code&gt;&#x27;[t]&lt;&#x2F;code&gt; è¿™æ ·çš„ç±»å‹æ¨¡å¼åŒ¹é…ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;æ•´ä½“è¯„ä¼°ï¼šideaj çš„ Scala3 æ”¯æŒï¼Œâ€œå¯ç”¨â€ï¼Œä¸å¤Ÿä¼˜ç§€ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;macro-qian-yi&quot;&gt;Macro è¿ç§»&lt;&#x2F;h2&gt;
&lt;p&gt;å¤§éƒ¨ä»½çš„Scala2 çš„ä»£ç éƒ½å¯ä»¥è¾ƒä¸ºç®€å•çš„è¿ç§»åˆ° Scala3ï¼Œç”šè‡³äºç›´æ¥æŠŠæºä»£ç å¤åˆ¶è¿‡æ¥ã€‚å®˜æ–¹æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„è¿ç§»æŒ‡å¯¼ï¼š
&lt;a href=&quot;https:&#x2F;&#x2F;link.zhihu.com&#x2F;?target=https%3A&#x2F;&#x2F;docs.scala-lang.org&#x2F;scala3&#x2F;guides&#x2F;migration&#x2F;compatibility-intro.html&quot;&gt;Compatibility Reference&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;ä¸è¿‡ï¼Œæˆ‘åœ¨è¿ç§» &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wangzaixiang&#x2F;scala-sql&quot;&gt;scala-sql&lt;&#x2F;a&gt; åº“çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜æ˜¯å¼ºè¿«è‡ªå·±æ”¾å¼ƒäº†Scala2çš„å…¼å®¹è¯­æ³•ï¼Œ
å¼ºè¿«è‡ªå·±æ¥ä½“ä¼š Scala3 çš„æ–°é£æ ¼ï¼Œæ¯”å¦‚ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;æ–°çš„ç¼©è¿›è¯­æ³•ã€‚å†™çš„è¶Šå¤šï¼Œç¡®å®ä¼šè¶Šå–œæ¬¢ï¼Œè¿™ä¸ªå€’æ˜¯å¾ˆç¬¦åˆâ€œç®€æ´â€çš„å‘³é“ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨ enum æ¥æ›¿ä»£ä¼ ç»Ÿçš„ ADT å®ç°ã€‚ï¼ˆæ›´å¥½ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨æ–°çš„ given&#x2F;using æ›¿ä»£ implicitã€‚ ï¼ˆä¸ªäººæ˜¯æœ‰äº›æ€€å¿µ2.13çš„ä¸€ä¸ªå…³é”®è¯ï¼Œæå®šä¸€åˆ‡çš„æ¨¡å¼çš„ã€‚ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;æ–°çš„ extensionã€‚ï¼ˆæ›´å¥½ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ä¸Šè¿°çš„è½¬å˜å¹¶ä¸éš¾ï¼Œæœ€éš¾çš„è¿˜æ˜¯macroçš„è¿ç§»ï¼šscala-sql é¡¹ç›®ä¸­å¹¿æ³›ä½¿ç”¨ Macro æ¥ç®€åŒ–é‡å¤æ€§ä»£ç çš„ç¼–å†™å·¥ä½œï¼Œä¹Ÿæ˜¯æ¡†æ¶æ—¢â€œç®€å•å®ç”¨â€ï¼Œåˆâ€œåŠŸèƒ½å¼ºå¤§â€çš„å…³é”®æªæ–½ã€‚
Scala3çš„Macroå¯ä»¥è¯´æ˜¯ä¸€æ¬¡é¢ è¦†æ€§çš„å®ç°ï¼Œå®Œå…¨ä¸å…¼å®¹äºScala2ï¼Œæ¦‚å¿µè™½ç„¶æœ‰å¾ˆå¤šæ˜¯ç›¸åŒçš„ï¼Œä½†APIå´å®Œå…¨ä¸åŒäº†ã€‚
æˆ‘æ˜¯å·®ä¸å¤šèŠ±äº†2ä¸ªå‘¨æœ«æ‰å®Œæˆäº†ç¬¬ä¸€ä¸ªMacroçš„è¿ç§»ï¼Œä¸è¿‡ï¼Œåé¢çš„é€Ÿåº¦å°±è¶Šæ¥è¶Šå¿«äº†ï¼Œæ…¢æ…¢æ‘¸åˆ°äº†ä¸€äº›é—¨é“ã€‚è¿™ä¸€å—ï¼Œæˆ‘ä¹Ÿæ•´ç†äº†ä¸€äº›æ–‡æ¡£ï¼Œåç»­å¯ä»¥æœ€è¿›ä¸€æ­¥çš„åˆ†äº«ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;images&#x2F;scala3-macros.jpg&quot; alt=&quot;Scala3 Macro æ ¸å¿ƒå¯¹è±¡å…³ç³»å›¾&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;ru-he-diao-shi-macro&quot;&gt;å¦‚ä½•è°ƒè¯•Macroï¼š&lt;&#x2F;h2&gt;
&lt;p&gt;ç¼–å†™Macroçš„é‡è¦æ–¹å¼æ˜¯å–„ç”¨è°ƒè¯•å™¨ï¼Œåœ¨è°ƒè¯•ä¸­ï¼Œäº†è§£å„ä¸ªæ•°æ®ç»“æ„ã€‚è¿™ç›¸æ¯”å•ƒæ–‡æ¡£æˆ–è€…ç›´æ¥çœ‹æºä»£ç ï¼Œå¯èƒ½ä¼šæ›´æœ‰æ•ˆå¾ˆå¤šã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sbt -J-agentlib&lt;&#x2F;span&gt;&lt;span&gt;:jdwp=transport=dt_socket,server=y,suspend=n,address=5005
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å¼€å¯ IDEA çš„è¿œç¨‹è°ƒè¯•ï¼Œè¿™æ ·ï¼Œåœ¨sbtä¸­æ‰§è¡Œ compile å‘½ä»¤æ—¶ï¼Œå°±å¯ä»¥è°ƒè¯•åˆ°æˆ‘ä»¬çš„macroä»£ç äº†ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;shi-yong-inline-macro&quot;&gt;è¯•ç”¨ Inline + Macro&lt;&#x2F;h2&gt;
&lt;p&gt;ç»“åˆ Macro å’Œ inlineï¼Œæ˜¯ä¸€ä¸ªéå¸¸æœ‰æ„æ€çš„å®è·µï¼Œåœ¨scala-sql çš„2.0.Xç‰ˆæœ¬å®è·µä¸­ï¼Œç”Ÿæˆçš„ &lt;code&gt;ResultSetMapper[T]&lt;&#x2F;code&gt; å®ç°ï¼Œ
å¦‚æœä»æœ€ç»ˆå®ç°çš„å­—èŠ‚ç æ¥çœ‹ï¼Œæ˜¯ä¸å¤Ÿç†æƒ³çš„ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;éœ€è¦åœ¨è¿è¡ŒæœŸå®Œæˆ æ•°æ®åº“å­—æ®µå å’Œ å¯¹è±¡å­—æ®µå çš„æ˜ å°„å…³ç³»ï¼Œä»¥æ»¡è¶³ è¯¸å¦‚ä» is_active åˆ° isActiveçš„æ˜ å°„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;è°ƒç”¨ caseFieldGet æ–¹æ³•ï¼Œå®Œæˆä» rs ä¸­è·å–å€¼ï¼Œä»¥åŠæ²¡æœ‰è¯¥å­—æ®µæ—¶ï¼Œdefault å€¼çš„å¤„ç†ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è¿™ä¸ªè¿‡ç¨‹æ—¶æœ‰é¢å¤–çš„å¼€é”€çš„ã€‚è™½ç„¶ç›¸å¯¹æ•°æ®åº“IOè€Œè¨€ï¼Œå¯ä»¥å¿½ç•¥ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨è¿ç§»åˆ° Scala3çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å°è¯•ç»“åˆMacro + inline çš„æ–¹å¼ï¼Œæœ€ç»ˆå®ç°äº†ä¸€ä¸ªâ€œzero-costâ€çš„ResultSetMapperå®ç°ã€‚&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;çœ¼ä¸‹Javaçš„æ¡†æ¶é£æ ¼æ˜¯æ— è§†costï¼Œæ¯ä¸€ä¸ªæ¡†æ¶å–œæ¬¢åœ¨è°ƒç”¨æ ˆä¸Šå±‚å±‚åŠ ç ï¼Œéšä¾¿çœ‹çœ‹é‚£ä¸ªSpringçš„StackTraceéƒ½æ˜¯å‡ åå±‚æ¥¼é«˜ã€‚å†å›åˆ° zero-cost çš„æ—¶ä»£ï¼Œ
æ„Ÿè§‰æ˜¯é‚£ä¹ˆçš„æ¸…çˆ½ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;è­¬å¦‚ï¼šå¯¹å¦‚ä¸‹çš„Case Classç±»ï¼Œ&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;scala&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-scala &quot;&gt;&lt;code class=&quot;language-scala&quot; data-lang=&quot;scala&quot;&gt;&lt;span&gt;@&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;UseColumnMapper&lt;&#x2F;span&gt;&lt;span&gt;(classOf[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Camel2UnderscoreMapper&lt;&#x2F;span&gt;&lt;span&gt;])
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;case class&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt; Test1&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;id&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;Int&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;isActive&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;Boolean&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;tinyInt&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;Byte&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;smallInt&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;Short&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;normalInt&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;Int&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;bigInt&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;Long&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;floatValue&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;Float&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;doubleValue&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;Double&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;decimalValue&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;BigDecimal&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;birthday&lt;&#x2F;span&gt;&lt;span&gt;: java.sql.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Date&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;createdAt&lt;&#x2F;span&gt;&lt;span&gt;: java.sql.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Timestamp&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;updatedAt&lt;&#x2F;span&gt;&lt;span&gt;: java.sql.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Timestamp&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;blobValue&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Array&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;Byte&lt;&#x2F;span&gt;&lt;span&gt;],
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;emptyValue&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span&gt;|&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Null&lt;&#x2F;span&gt;&lt;span&gt;,   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; or using Option[String]
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;emptyInt&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;Int&lt;&#x2F;span&gt;&lt;span&gt;|&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Null &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; or using Option[Int]
&lt;&#x2F;span&gt;&lt;span&gt;     ) derives ResultSetMapper
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å…¶å¯¹åº”çš„ResultSetMapperä»£ç å¦‚ä¸‹ï¼ˆå¯¹ ç”Ÿæˆçš„ä»£ç è¿›è¡Œåç¼–è¯‘çš„æ•ˆæœï¼šï¼‰ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-java &quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;ResultSetMapper&lt;&#x2F;span&gt;&lt;span&gt; var5 = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;ResultSetMapper&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;this&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Test1 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;from&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;final &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;ResultSet &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;rs&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;) {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var2 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getInt&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;id&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var3 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getString&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;boolean&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var4 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getBoolean&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;is_active&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;byte&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var5 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getByte&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;tiny_int&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;short&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var6 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getShort&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;small_int&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var7 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getInt&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;normal_int&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;long&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var8 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getLong&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;big_int&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;float&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var10 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getFloat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;float_value&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;double&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var11 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getDouble&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;double_value&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;BigDecimal&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; it &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getBigDecimal&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;decimal_value&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    scala.math.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;BigDecimal&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var13 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; it &lt;&#x2F;span&gt;&lt;span&gt;!= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;null &lt;&#x2F;span&gt;&lt;span&gt;?&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; scala.package..&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MODULE&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;$.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;BigDecimal&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;apply&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(it) &lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;null&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Date&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var15 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getDate&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;birthday&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Timestamp&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var16 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getTimestamp&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;created_at&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Timestamp&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var17 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getTimestamp&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;updated_at&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;byte[]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var18 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getBytes&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;blob_value&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Object&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var10000;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; vx &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getString&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;empty_value&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;       var10000 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; vx &lt;&#x2F;span&gt;&lt;span&gt;== &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;null &lt;&#x2F;span&gt;&lt;span&gt;? &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;scala.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;None&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;..&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MODULE&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;$ &lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;scala.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Some&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;..&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MODULE&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;$.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;apply&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(vx);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;catch &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;SQLException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;var26&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;) {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;       var10000 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;scala.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;None&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;..&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MODULE&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;$;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Object&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var19 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var10000;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; v &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getInt&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;empty_int&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;       var10000 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; rs.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;wasNull&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;() &lt;&#x2F;span&gt;&lt;span&gt;? &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;scala.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;None&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;..&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MODULE&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;$ &lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;scala.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Some&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;..&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MODULE&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;$.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;apply&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;BoxesRunTime&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;boxToInteger&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(v));
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;catch &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;SQLException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;var25&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;) {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;       var10000 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;scala.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;None&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;..&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MODULE&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;$;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Object&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var22 &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; var10000;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Test1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;this&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;.$outer.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;wsql_test$WsqlTest$_$_$Test1$$$$outer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(), var2, var3, var4, var5, var6, var7, var8, var10, var11, var13, var15, var16, var17, var18, (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Option&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;)var19, (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Option&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;)var22);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;}&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è¿™ä¸ªç”Ÿæˆçš„ä»£ç è´¨é‡ï¼ŒåŸºæœ¬ä¸Šæ˜¯ zero-cost çš„äº†ï¼Œè¾¾åˆ°äº†â€œæ‰‹å†™ä»£ç â€çš„è´¨é‡ã€‚ç›¸æ¯” Javaçš„åŸºäºåå°„çš„å¤§éƒ¨åˆ†æ¡†æ¶ï¼Œscala-sql ç”Ÿæˆçš„ä»£ç è´¨é‡æ›´ä¼˜ï¼Œ
æ›´äº«å—äº†ç¼–è¯‘æ—¶æœŸçš„é™æ€ç±»å‹æ£€æŸ¥ç¦åˆ©ã€‚&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;å®ç°å¦‚ä¸Šçš„æ¸…æ´ä»£ç ç”Ÿæˆï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ç¼–å†™å¤æ‚çš„Macroä»£ç ï¼ˆå¦‚æœè¿™ä¹ˆåšï¼ŒMacroçš„ä»£ç ä¼šå¤æ‚å¾ˆå¤šï¼Œè€Œä¸”ä¹Ÿä¸ä¾¿äºè°ƒè¯•ï¼‰ï¼Œ
è€Œæ˜¯ï¼Œåœ¨Macroä¸­ç”Ÿæˆå¯¹ inline å‡½æ•°çš„è°ƒç”¨ï¼Œåˆ©ç”¨inlineå±•å¼€èƒ½åŠ›ï¼Œå®ç°æœ€ç»ˆçš„æ¸…çˆ½ä»£ç ã€‚
ä¾‹å¦‚ï¼Œå¯¹åŸºç¡€æ•°æ®ç±»å‹ï¼ˆå€¼ç±»å‹ï¼‰ï¼Œä¸”æœ‰ç¼ºçœå€¼æ—¶ï¼ˆdeffï¼‰ï¼Œå…¶ä½¿ç”¨å¦‚ä¸‹çš„inlineä»£ç ï¼Œå®é™…ä¸Šå¹¶ä¸ä¼šäº§ç”Ÿä¸€æ¬¡å‡½æ•°è°ƒç”¨ï¼Œ
è€Œæ˜¯å°†å¦‚ä¸‹çš„ä»£ç åµŒå…¥åˆ° from(rs: ResultSet)ä¸­ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;pre data-lang=&quot;scala&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-scala &quot;&gt;&lt;code class=&quot;language-scala&quot; data-lang=&quot;scala&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;private&lt;&#x2F;span&gt;&lt;span&gt; inline &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;withDefaultOptionAnyVal&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;T&lt;&#x2F;span&gt;&lt;span&gt;](inline &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span&gt;, inline &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;deff&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Option&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;T&lt;&#x2F;span&gt;&lt;span&gt;], &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;rs&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;ResultSet&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;                                       (using JdbcValueAccessor[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;T&lt;&#x2F;span&gt;&lt;span&gt;]): &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Option&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;T&lt;&#x2F;span&gt;&lt;span&gt;] =
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;try
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;val &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;v &lt;&#x2F;span&gt;&lt;span&gt;= rs.get[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;T&lt;&#x2F;span&gt;&lt;span&gt;](name)
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt; rs.wasNull then deff &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;Some(v.nn)
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;catch
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;case &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;ex&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;SQLException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt;&lt;span&gt; deff
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;ji-yu-xin-de-context-functions-chuang-jian-dsl&quot;&gt;åŸºäºæ–°çš„Context Functions åˆ›å»º DSL&lt;&#x2F;h2&gt;
&lt;p&gt;æœ€è¿‘åœ¨è§„åˆ’å¼€å‘ä¸€ä¸ªæ–°çš„æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°ï¼Œ è§„åˆ’çš„ç‰¹æ€§éå¸¸æœ‰å¸å¼•åŠ›ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;èƒ½å¤Ÿæ”¯æŒ HTTP æ¥å£ å’Œ Dubbo æ¥å£ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;èƒ½å¤Ÿé…ç½®å•æ¥å£çš„æµ‹è¯•ç”¨ä¾‹ å’Œ å¤šæ¥å£æµç¨‹çš„æµ‹è¯•ç”¨ä¾‹&lt;&#x2F;li&gt;
&lt;li&gt;å¯ä»¥é…ç½®è¯·æ±‚ã€é…ç½®å¯¹ç»“æœçš„æ–­è¨€ï¼ˆåŸºäº wjson æä¾›çš„å¼ºå¤§çš„ JSON è¡¨è¾¾èƒ½åŠ›ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;å¯ä»¥é…ç½®ä¾èµ–çš„æ•°æ®åº“ã€ä»¥åŠå¯¹æœåŠ¡æ‰§è¡Œå®Œåçš„æ•°æ®åº“ç»“æœè¿›è¡Œæ ¡éªŒã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯ä»¥ä¸ºæ¥å£è°ƒç”¨é…ç½® Mock ä¾èµ–ï¼ŒMockä¾èµ–åªéœ€è¦ä½¿ç”¨ JSON è¿›è¡Œé…ç½®å³å¯ï¼ˆåŸºäºwjsonæä¾›çš„ç®€å•è€Œå¼ºå¤§çš„æ¨¡å¼åŒ¹é…èƒ½åŠ›ï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;åœ¨ç ”å‘ä¸Šè¿°åŸå½¢ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬è‹¦äºå¦‚ä½•æä¾›ä¸€ä¸ªæœ‰å¥½çš„ User Interface ä»¥è®©ç ”å‘ã€æµ‹è¯•äººå‘˜èƒ½å¤Ÿç®€å•çš„ä½¿ç”¨ä¸Šè¿°èƒ½åŠ›ï¼Ÿ
è™½ç„¶æˆ‘ä»¬çš„æœ€ç»ˆç‰ˆæœ¬ä¼šæä¾›åŸºäºWEBçš„ç”¨æˆ·ç•Œé¢ï¼Œä½†ä½œä¸ºä¸€ä¸ªåŸå‹äº§å“ï¼Œæˆ‘ä»¬é€‰æ‹© Scala DSL æ¥è¾¾æˆä¸Šè¿°ç›®æ ‡ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;scala&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-scala &quot;&gt;&lt;code class=&quot;language-scala&quot; data-lang=&quot;scala&quot;&gt;&lt;span&gt;testcase( name=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;test1&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, business=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;..&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, project=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;...&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, service=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;..&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; method=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;...&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;) {
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  reuse(atomic = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;6600&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;  prepareDB {
&lt;&#x2F;span&gt;&lt;span&gt;    dataset(ref = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;base-dataset1&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; )
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;sql&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;quot;&amp;quot;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;    insert into table1 values(...);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;quot;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;  }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  prepareMocks {
&lt;&#x2F;span&gt;&lt;span&gt;    mockset( ref = &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;basic-mocks&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; )
&lt;&#x2F;span&gt;&lt;span&gt;    mock( service=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;..&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, method=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;...&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; ){
&lt;&#x2F;span&gt;&lt;span&gt;      request( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;rejson&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;quot;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt; {...}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;      &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;quot;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;      response( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;json&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;quot;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;....&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;quot;&amp;quot; ) 
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;  }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Scala3çš„Context Functionè®© DSLå˜å¾—æ›´ä¸ºç®€å•ï¼Œè¿™ä¸€å—ç›®å‰è¿˜æ²¡æœ‰æŠ•äº§ï¼Œç­‰æˆ‘ä»¬çš„æ¡ˆä¾‹å®Œæˆåï¼Œæˆ‘å†è¡¥å……ä¸Šå…·ä½“çš„demoã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;null-safe&quot;&gt;Null Safe&lt;&#x2F;h2&gt;
&lt;p&gt;è¿™ä¸ªç‰¹æ€§ç›®å‰è¿˜æ˜¯å®éªŒæ€§è´¨çš„ï¼Œä¹Ÿæ˜¯æˆ‘éå¸¸æ„Ÿå…´è¶£çš„ä¸€ä¸ªç‰¹æ€§ã€‚åœ¨Javaä¸­ï¼Œ null å’Œ NPE çœŸæ˜¯ä¸€ä¸ªæ™®éçš„é”™è¯¯ä½¿ç”¨æ¨¡å¼ã€‚
Kotlin&#x2F;Dartç­‰è¯­è¨€éƒ½æ‹¥æŠ± Null Safeäº†ã€‚æ‰€ä»¥ Explicit Null è¿™ä¸ªç‰¹æ€§åˆšåˆšå‡ºæ¥ï¼Œæˆ‘æ˜¯éå¸¸å…´å¥‹çš„ã€‚
ä¹Ÿä¹˜ç€è¿™æ¬¡çš„æœºä¼šï¼ŒæŠŠ scala-sql 3 ç¼–è¯‘åˆ‡åˆ°è¿™ä¸ªæ¨¡å¼ï¼Œè¿˜çœŸçš„å‘ç°äº†ä¹‹å‰å­˜åœ¨ä¸€äº›ä»£ç ï¼Œæ˜¯æ²¡æœ‰å¾ˆå¥½çš„å¤„ç† nullçš„ã€‚
è¿™ä¸ªæš‚æ—¶æ”¾åˆ° scala3-nullsafe åˆ†æ”¯ä¹‹ä¸­ï¼Œç¨³å®šåä¼šåˆå¹¶åˆ° master.&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>æ•æ·ç ”å‘ä¸è¿‡ç¨‹ç®¡ç†</title>
        <published>2022-03-20T00:00:00+00:00</published>
        <updated>2022-03-20T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/agile-rd/"/>
        <id>https://wangzaixiang.github.io/blog/agile-rd/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/agile-rd/">&lt;p&gt;æœ¬æ–‡æ˜¯æˆ‘åœ¨ä»»æ·±åœ³ç§‘è„‰å…¬å¸CTOæœŸé—´ï¼Œåœ¨å…¬å¸å†…éƒ¨è¿›è¡Œæ•æ·åŠ¨å‘˜çš„ä¸€ä¸ª PPT è®²ç¨¿ï¼Œåˆ†äº«äº†æˆ‘å¯¹æ•æ·ç ”å‘ä¸è¿‡ç¨‹ç®¡ç†çš„ç†è§£ã€å®è·µç»éªŒã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.001.jpg&quot; alt=&quot;agile.001&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.002.jpg&quot; alt=&quot;agile.002&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.003.jpg&quot; alt=&quot;agile.003&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.004.jpg&quot; alt=&quot;agile.004&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.005.jpg&quot; alt=&quot;agile.005&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.006.jpg&quot; alt=&quot;agile.006&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.007.jpg&quot; alt=&quot;agile.007&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.008.jpg&quot; alt=&quot;agile.008&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.009.jpg&quot; alt=&quot;agile.009&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.010.jpg&quot; alt=&quot;agile.010&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.011.jpg&quot; alt=&quot;agile.011&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.012.jpg&quot; alt=&quot;agile.012&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.013.jpg&quot; alt=&quot;agile.013&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.014.jpg&quot; alt=&quot;agile.014&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.015.jpg&quot; alt=&quot;agile.015&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.016.jpg&quot; alt=&quot;agile.016&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.017.jpg&quot; alt=&quot;agile.017&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.018.jpg&quot; alt=&quot;agile.018&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.019.jpg&quot; alt=&quot;agile.019&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;agile-rd&#x2F;img.020.jpg&quot; alt=&quot;agile.020&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Yedisï¼šä¸€æ¬¾è½»é‡çº§ã€é«˜æ€§èƒ½çš„Redisé©±åŠ¨ç¨‹åº</title>
        <published>2021-10-29T00:00:00+00:00</published>
        <updated>2021-10-29T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/yedis/"/>
        <id>https://wangzaixiang.github.io/blog/yedis/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/yedis/">&lt;p&gt;Redisæ˜¯äº’è”ç½‘åº”ç”¨ä¸­å¹¿æ³›ä½¿ç”¨çš„ç¼“å­˜è§£å†³æ–¹æ¡ˆï¼Œä»¥å…¶é«˜æ€§èƒ½ã€ä¸°å¯Œçš„æ•°æ®ç»“æ„ã€ç®€å•æ˜“ç”¨çš„APIè€Œè‘—ç§°ï¼ŒåŸºæœ¬ä¸Šå·²ç»æˆä¸ºäº†äº’è”ç½‘åº”ç”¨çš„åŸºç¡€è®¾æ–½ï¼Œ
å…¶é‡è¦ç¨‹åº¦ä¸MySQLã€Nginxç­‰è¶³ä»¥ç›¸æå¹¶è®ºã€‚Jedisæ˜¯æœ€å¸¸ç”¨çš„Redis Javaé©±åŠ¨ç¨‹åºï¼Œåœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ä¹Ÿå¹¿æ³›ä½¿ç”¨Jedisé©±åŠ¨ç¨‹åºã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨ä½¿ç”¨Jedisçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†å¦‚ä¸‹çš„é—®é¢˜ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Jedis å¯¹ Redis Cluster æ”¯æŒæœ‰å±€é™ï¼ŒSlaveå®ä¾‹ä¸èƒ½æä¾›è¯»è®¿é—®ã€‚è¯¸å¦‚MySQLçš„Slaveå®ä¾‹ï¼Œä¸€èˆ¬ç”¨äºæ‰¿æ‹…ä¸€å®šçš„çº¿ä¸Šåªè¯»è®¿é—®è®¿é—®ï¼Œ
ä»¥é™ä½å¯¹ä¸»åº“çš„è®¿é—®å‹åŠ›ï¼Œæé«˜æ•´ä¸ªç³»ç»Ÿçš„ååèƒ½åŠ›ã€‚è™½ç„¶Rediså®ä¾‹å…·æœ‰å¾ˆé«˜çš„è®¿é—®æ€§èƒ½ï¼Œå•å®ä¾‹å¯ä»¥æä¾›10ä¸‡é‡çº§çš„è®¿é—®QPSï¼Œ
ä½†ä¹Ÿæ˜¯å­˜åœ¨ä¸Šé™çš„ã€‚å¯¹ç”µå•†ã€ç§’æ€ç­‰ä¸šåŠ¡åœºæ™¯ï¼Œå•å®ä¾‹çš„å¤„ç†èƒ½åŠ›ä»ç„¶ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œæ—¢ç„¶ Redis Cluster æ”¯æŒ Master&#x2F;Slave æ¨¡å¼ï¼Œ
ä¸ºä»€ä¹ˆä¸èƒ½å……åˆ†åº”ç”¨ Redis Slave æ¥åˆ†æ‹…è®¿é—®å‹åŠ›å‘¢ï¼Ÿ&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Jedis ä½¿ç”¨è¿æ¥æ± çš„æ¨¡å¼ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå°±éœ€è¦å…³æ³¨è¯¸å¤šçš„è¿æ¥æ± å‚æ•°ï¼Œå¹¶å°è¯•å¹³è¡¡ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;minIdle&lt;&#x2F;li&gt;
&lt;li&gt;maxTotal&lt;&#x2F;li&gt;
&lt;li&gt;maxIdle&lt;&#x2F;li&gt;
&lt;li&gt;testOnBorrow&lt;&#x2F;li&gt;
&lt;li&gt;testOnReturn&lt;&#x2F;li&gt;
&lt;li&gt;testWhileIdle&lt;&#x2F;li&gt;
&lt;li&gt;timeBetweenEvictionRunsMillis&lt;&#x2F;li&gt;
&lt;li&gt;numTestsPerEvictionRun&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;æœ¬æ–‡å¹¶ä¸å°è¯•ä»‹ç»æœ€ä½³çš„ Jedis å‚æ•°å®è·µï¼Œè¿™äº›å‚æ•°çš„è°ƒä¼˜è¿‡ç¨‹ç¡®å®æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚å½“æœåŠ¡éƒ¨ç½²çš„å®ä¾‹å¢åŠ åˆ°ä¸€å®šé‡çº§åï¼Œé…ç½®ä¸€ä¸ªè¾ƒå¤§çš„è¿æ¥æ± ï¼Œ
ä¼šå¯¼è‡´å•ä¸ªredisæœåŠ¡å®ä¾‹éœ€è¦æ”¯æŒä¸€ä¸ªå¾ˆå¤§çš„è¿æ¥æ•°ã€‚è¿™äº›ä¹Ÿç»™åˆ°DBAä¸€å®šçš„å¿ƒç†å‹åŠ›ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Jedis è¿æ¥éœ€è¦ testOnBorrow, æˆ–è€…testOnReturn ç­‰æ£€æµ‹æœºåˆ¶æ¥æ£€æµ‹è¿æ¥çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼Œè¿™ç§æ£€æµ‹æˆ–è€…ä¼šå¯¼è‡´é¢å¤–çš„ RTT æ—¶é—´ï¼Œ
ä»è€Œé™ä½äº†åº”ç”¨çš„è®¿é—®é€Ÿåº¦(æ¯æ¬¡è¿æ¥0.1msçº§åˆ«)ã€‚æˆ–è€…é‡‡ç”¨ testWhileIdle æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶é¿å…äº†æ¯æ¬¡è¿æ¥è¿›è¡Œæµ‹è¯•ï¼Œ
ä½†æ— æ³•ä¿è¯è¿æ¥æ£€æµ‹çš„åŠæ—¶ï¼Œæœ‰å¯èƒ½å‡ºç°æ¼æ£€çš„å¯èƒ½å‹ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ Redis Cluster æ¨¡å¼ä¸‹ï¼ŒRedisæœåŠ¡å¹¶ä¸æ”¯æŒ mget, mput ç­‰æ‰¹é‡æ“ä½œã€‚è€Œä¸šåŠ¡ä¸Šç¢°åˆ°è¿™ç±»åœºæ™¯æ—¶ï¼Œæˆ–è€…é‡‡ç”¨ä¸²è¡Œæ¨¡å¼é€ä¸ªè°ƒç”¨ get æ“ä½œï¼Œ
æˆ–è€…ä½¿ç”¨çº¿ç¨‹æ± ç­‰æ–¹å¼ï¼Œè¿›è¡Œå¹¶å‘æ“ä½œã€‚æ— è®ºå“ªä¸€ç§æ–¹å¼éƒ½ä¸å¤Ÿè®©äººæ»¡æ„ï¼šä¸²è¡Œçš„æ€§èƒ½ä¸ä½³ï¼Œå¤šçº¿ç¨‹çš„æ¨¡å¼ï¼Œç”±å¢åŠ äº†ä¸šåŠ¡æœåŠ¡çš„å¤æ‚æ€§ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;åŸºäºå¦‚ä¸Šçš„ç—›ç‚¹é—®é¢˜ï¼Œæˆ‘ä»¬å†³å®šè‡ªç ”ä¸€ä¸ªåŒ¹é…çš„é©±åŠ¨ç¨‹åºï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºï¼šYedisï¼Œå¯ä»¥ç†è§£ä¸º Yunji Redis Driver æˆ–è€…
Yet another Redis Driverã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;yedis-shi-yong-shuo-ming&quot;&gt;Yedis ä½¿ç”¨è¯´æ˜&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;mavenä¾èµ–&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;xml&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-xml &quot;&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dependency&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;   &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;groupId&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;yunji.yedis.client&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;groupId&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;   &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;artifactId&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;yedis&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;artifactId&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;   &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;version&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;1.3.2&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;version&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dependency&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åŸºæœ¬APIç”¨æ³•&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;pre data-lang=&quot;java&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-java &quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;åˆå§‹åŒ–
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Yedis&lt;&#x2F;span&gt;&lt;span&gt; yedis = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Yedis&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;172.16.0.3:6379,172.16.0.3:6380&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span&gt;);&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;è¶…æ—¶æ—¶é—´(å•ä½:ç§’)
&lt;&#x2F;span&gt;&lt;span&gt;   
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;String
&lt;&#x2F;span&gt;&lt;span&gt;   yedis.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;set&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;key_str&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;test_value&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;);
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span&gt; val = yedis.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;get&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;key_str&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;);
&lt;&#x2F;span&gt;&lt;span&gt;   
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;Hash
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Map&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; map = yedis.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;hgetAll&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;key_map&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;);
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;List&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; list = yedis.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;hmget&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;key_map&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;f1&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;f2&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;f3&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;);
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span&gt; str = yedis.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;hget&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;key_map&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;f1&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;);
&lt;&#x2F;span&gt;&lt;span&gt;   
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;List
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;List&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; list = yedis.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;lrange&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;key_list&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;, -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;List&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; list = yedis.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sort&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;key_list&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;);
&lt;&#x2F;span&gt;&lt;span&gt;   yedis.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;rpush&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;key_list&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;   
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;æŒ‡å®šæ•°æ®è¯»å–æ¥æº
&lt;&#x2F;span&gt;&lt;span&gt;   yedis.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;get&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;key_str&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;ReadModel&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;MASTER_SLAVE&lt;&#x2F;span&gt;&lt;span&gt;);&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;ReadModelï¼šMASTERã€SLAVEã€MASTER_SLAVE
&lt;&#x2F;span&gt;&lt;span&gt;   
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;Pipeline
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Pipeline&lt;&#x2F;span&gt;&lt;span&gt; pip = yedis.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;openPipeline&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;   pip.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;set&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;key_string&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;a&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;);  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;è¿”å›å€¼ï¼šString
&lt;&#x2F;span&gt;&lt;span&gt;   pip.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;hvals&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;key_map&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;);&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;è¿”å›å€¼ï¼šList
&lt;&#x2F;span&gt;&lt;span&gt;   pip.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;get&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;key_map&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;);&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;æ•°æ®ç±»å‹ä¸åŒ¹é…ï¼Œå¼‚å¸¸
&lt;&#x2F;span&gt;&lt;span&gt;   pip.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;zrangeWithScores&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;key_zset&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;, -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;);&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F;è¿”å›å€¼ï¼šTuple
&lt;&#x2F;span&gt;&lt;span&gt;   
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;List&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Object&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; list = pip.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getResults&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Object&lt;&#x2F;span&gt;&lt;span&gt; obj : list){
&lt;&#x2F;span&gt;&lt;span&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt;(obj instanceof &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;YedisException&lt;&#x2F;span&gt;&lt;span&gt;){
&lt;&#x2F;span&gt;&lt;span&gt;           &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;YedisException&lt;&#x2F;span&gt;&lt;span&gt; exception = (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;YedisException&lt;&#x2F;span&gt;&lt;span&gt;) obj;
&lt;&#x2F;span&gt;&lt;span&gt;           exception.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;printStackTrace&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;       }
&lt;&#x2F;span&gt;&lt;span&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;System&lt;&#x2F;span&gt;&lt;span&gt;.out.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;println&lt;&#x2F;span&gt;&lt;span&gt;(obj);
&lt;&#x2F;span&gt;&lt;span&gt;   }
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;JMX ç›‘æ§
yedisæä¾›ç›‘æ§ä¿¡æ¯æ–¹ä¾¿æŸ¥çœ‹å½“æ—¶è¿è¡ŒçŠ¶å†µï¼Œä»¥åŠåŸºæœ¬çš„ç»Ÿè®¡ä¿¡æ¯:&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;

&lt;img src=&quot;https:&amp;#x2F;&amp;#x2F;wangzaixiang.github.io&amp;#x2F;processed_images&amp;#x2F;yedis_jmx.27a2445429253d4c.png&quot; &#x2F;&gt;
&lt;p&gt;ç›‘æ§ä¸­åŒ…å«4ä¸ªå±æ€§ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ChannelInfoï¼šä¸€ä¸ªredisèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªchannelï¼Œç›‘æ§ä¸­å¯ä»¥çœ‹åˆ°å½“å‰è¿æ¥æ˜¯å¦æ­£å¸¸ã€å½“å‰è¿æ¥åˆ›å»ºæ—¶é—´ã€è¯·æ±‚æ•°(æœ€è¿‘20så†…)ã€å¹³å‡å“åº”æ—¶é—´(å•ä½:ms)ä»¥åŠè¯¥RedisèŠ‚ç‚¹å¯¹åº”çš„è¿æ¥æ€»åˆ›å»ºã€å…³é—­æ¬¡æ•°&lt;&#x2F;li&gt;
&lt;li&gt;QueueInfo:  è®°å½•Queueæœ€åä¸€æ¬¡å†™å…¥ã€æ¶ˆè´¹æ—¶é—´ã€Queueä¸­æ¶ˆæ¯é˜»å¡æ•°(Queueçš„å…·ä½“ä½œç”¨ä¸‹æ–‡ä¼šæåˆ°)&lt;&#x2F;li&gt;
&lt;li&gt;UpdateNums: Reidsé›†ç¾¤å‘ç”Ÿå˜æ›´æ¬¡æ•°&lt;&#x2F;li&gt;
&lt;li&gt;LastUpdateTime:  æœ€åä¸€æ¬¡æ›´æ–°RedisçŠ¶æ€æ—¶é—´&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;ji-ben-jia-gou-tu&quot;&gt;åŸºæœ¬æ¶æ„å›¾&lt;&#x2F;h2&gt;
&lt;p&gt;Yedis é‡‡ç”¨äº†å¦‚ä¸‹çš„è®¾è®¡æ€è·¯ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;æ¯ä¸ª Redis èŠ‚ç‚¹åªç»´æŠ¤ä¸€ä¸ªè¿æ¥ï¼Œæ‰€æœ‰çš„å®¢æˆ·ç«¯çº¿ç¨‹å‡å…±äº«å•ä¸ªè¿æ¥ï¼Œå‘é€å‘½ä»¤ã€‚è€Œä¸é‡‡ç”¨è¿æ¥æ± ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åŸºäº Nettyï¼Œæ‰€æœ‰ç½‘ç»œå¤„ç†é‡‡ç”¨å¼‚æ­¥ã€éé˜»å¡æ¨¡å¼ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;é‡‡ç”¨å•è¿æ¥æ¨¡å¼æ˜¯å¦ä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Ÿ&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å•è¿æ¥å¹¶ä¸æ„å‘³ç€ä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚redisï¼Œå…¶å®ƒçš„å®¢æˆ·ç«¯å¿…é¡»ç­‰å¾…è¿™ä¸ªè¯·æ±‚è¿”å›åï¼Œæ‰èƒ½å‘èµ·ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚ç›¸åï¼ŒYedisåœ¨å•ä¸ªTCP Socketä¹‹ä¸Šï¼Œå¤šä¸ªåº”ç”¨çº¿ç¨‹å¯ä»¥å¹¶è¡Œçš„ä½¿ç”¨è¿™ä¸ªSocketå‘é€å‘½ä»¤ã€‚è¿™ä¸ªæ˜¯åŸºäºRedisçš„Pipelineç‰¹æ€§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¤§éƒ¨åˆ†å•ä¸ªçš„Rediså‘½ä»¤æ‰§è¡Œæ—¶é—´éå¸¸ä¹‹å¿«ï¼Œä¸€èˆ¬åœ¨ 10-50us æ•°é‡çº§ä¸Šï¼Œç›¸åï¼Œå³ä½¿åœ¨å±€åŸŸç½‘ä¸Šï¼Œç½‘ç»œçš„ rtt ä¸€èˆ¬ä¹Ÿä¼šè¾¾åˆ°0.3ms - 1msé‡çº§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä»å•ä¸ªå‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹æ¥çœ‹ï¼Œåªæœ‰5%-15%çš„æ—¶é—´æ˜¯åœ¨çœŸæ­£çš„è€—è´¹åœ¨redisæ‰§è¡Œä¹‹ä¸Šï¼Œå…¶ä½™æ—¶é—´å…¶å®æ˜¯è€—è´¹åœ¨ç­‰å¾…ç½‘ç»œä¼ è¾“çš„è¿‡ç¨‹ä¹‹ä¸­ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é€šè¿‡ä½¿ç”¨PipelineæŠ€æœ¯ï¼Œæ— éœ€ç­‰å¾…ä¸Šä¸€ä¸ªå‘½ä»¤å¤„ç†å®Œæ¯•ï¼Œå†å‘é€ä¸‹ä¸€ä¸ªå‘½ä»¤è¯·æ±‚ï¼Œè€Œæ˜¯å®¢æˆ·ç«¯ä¸€ä¸ªæ¥ä¸€ä¸ªçš„å°†å‘½ä»¤å‘é€ç»™RedisæœåŠ¡å™¨ï¼ŒRedisé€ä¸ªè¿›è¡Œå¤„ç†ï¼Œå†é€ä¸ªçš„è¿›è¡Œè¿”å›ï¼Œå®¢æˆ·ç«¯åœ¨é€ä¸ªçš„å¤„ç†è¿”å›ç»“æœã€‚è¿™ç§æ–¹å¼ï¼Œå¯ä»¥å®ç°å•ä¸ªè¿æ¥å°±å¯ä»¥æ›¿ä»£åŸæœ‰è¿æ¥æ± æ‰èƒ½å®Œæˆä»»åŠ¡ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;blockquote&gt;
&lt;p&gt;é‚£ä¹ˆå•è¿æ¥çš„æ¨¡å¼æ˜¯å¦ä¼šå­˜åœ¨æ€§èƒ½ç“¶é¢ˆå‘¢ï¼Ÿç†è®ºä¸Šç¡®å®æœ‰ï¼Œåœ¨å•ä¸ªSocketä¸Šä¼ è¾“çš„æœ€å¤§é€Ÿåº¦ = windowSize &#x2F; rttï¼Œåœ¨ä¸‡å…†å±€åŸŸç½‘ä¸‹ï¼Œè¿™ä¸ªå€¼ä¸€èˆ¬åœ¨50M byteå·¦å³ã€‚è€ƒè™‘åˆ°å•ä¸ªå®¢æˆ·ç«¯å¯¹redisçš„è®¿é—®å¾ˆå°‘ä¼šè¾¾åˆ°å¦‚æ­¤é«˜çš„åœºæ™¯ï¼Œå› æ­¤ï¼Œå•ä¸ªTCPè¿æ¥çš„æ•°æ®ä¼ è¾“ç“¶é¢ˆå¹¶ä¸ä¼šæˆä¸ºå®é™…çš„é—®é¢˜ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;

&lt;img src=&quot;https:&amp;#x2F;&amp;#x2F;wangzaixiang.github.io&amp;#x2F;processed_images&amp;#x2F;15722638104683.fd5cf1a8194d8491.jpg&quot; &#x2F;&gt;&lt;h3 id=&quot;ji-ben-liu-cheng-zheng-chang-ming-ling-chu-li&quot;&gt;åŸºæœ¬æµç¨‹ï¼šæ­£å¸¸å‘½ä»¤å¤„ç†&lt;&#x2F;h3&gt;
&lt;ol&gt;
&lt;li&gt;é¦–å…ˆï¼Œæ ¹æ®ç”¨æˆ·æ‰€ä¼ å…¥çš„Keyè¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°è¯¥Keyçš„æ‰€åœ¨RedisèŠ‚ç‚¹å¯¹åº”çš„Channel&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹é€‰ä¸­çš„Channelï¼ŒåŒæ­¥çš„æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªå¤„ç†è¿”å›ç»“æœçš„ Futureï¼Œ ä¿å­˜åˆ° channel å¯¹åº”çš„é˜Ÿåˆ—ä¸­ï¼ˆç›®å‰æ²¡æœ‰ä½¿ç”¨JDK8çš„Future APIï¼ŒåŸå› æ˜¯éœ€è¦æä¾›å¯¹JDK7çš„APIå…¼å®¹ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;è°ƒç”¨ Netty writeAndFlush æ“ä½œå°†å‘½ä»¤å‘é€ç»™æœåŠ¡å™¨ã€‚
è¿™ä¸¤ä¸ªæ“ä½œå¿…é¡»åŒæ­¥å®Œæˆï¼Œç¡®ä¿ queue ä¸­çš„Futureé¡ºåºå’Œå‘é€é¡ºåºå®Œå…¨ä¸€è‡´ï¼Œè¿™æ ·åœ¨ä¸‹ä¸€æ­¥å¤„ç†è¿”å›ç»“æœ&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;pre data-lang=&quot;java&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-java &quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;private &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;R&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;R &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;send&lt;&#x2F;span&gt;&lt;span&gt;(final &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Request&lt;&#x2F;span&gt;&lt;span&gt; request, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Channel&lt;&#x2F;span&gt;&lt;span&gt; channel) {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;assertChannelNotNull&lt;&#x2F;span&gt;&lt;span&gt;(channel);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;ResponseFuture&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;R&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; future = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;ResponseFuture&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;SendCallback&lt;&#x2F;span&gt;&lt;span&gt;() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        ......
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;synchronized &lt;&#x2F;span&gt;&lt;span&gt;(channel) {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;assertChannelIsActive&lt;&#x2F;span&gt;&lt;span&gt;(channel);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;YedisHandler&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;put&lt;&#x2F;span&gt;&lt;span&gt;(channel, future);
&lt;&#x2F;span&gt;&lt;span&gt;            channel.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;writeAndFlush&lt;&#x2F;span&gt;&lt;span&gt;(request);
&lt;&#x2F;span&gt;&lt;span&gt;        } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;catch &lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;InterruptedException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;e&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;throw new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;YedisInterruptedExceptionException&lt;&#x2F;span&gt;&lt;span&gt;(e);
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;waitResponse&lt;&#x2F;span&gt;&lt;span&gt;(future);
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Nettyæ¥æ”¶åˆ°Redisçš„è¿”å›ç»“æœåï¼Œä»å¯¹åº”Queueä¸­å–å‡ºResponseFutureï¼Œå°†ç»“æœè®¾ç½®åˆ°åˆ°ResponseFutureï¼Œç„¶åå”¤é†’å®¢æˆ·ç«¯ç­‰å¾…çº¿ç¨‹ã€å°†ç»“æœè¿”å›ã€‚&lt;pre data-lang=&quot;java&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-java &quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;    @&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Override
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public&lt;&#x2F;span&gt;&lt;span&gt; void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;channelRead&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;ChannelHandlerContext&lt;&#x2F;span&gt;&lt;span&gt; ctx, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Object&lt;&#x2F;span&gt;&lt;span&gt; msg) {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;ResponseFuture&lt;&#x2F;span&gt;&lt;span&gt; response = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;take&lt;&#x2F;span&gt;&lt;span&gt;(ctx.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;channel&lt;&#x2F;span&gt;&lt;span&gt;());
&lt;&#x2F;span&gt;&lt;span&gt;    response.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;setContent&lt;&#x2F;span&gt;&lt;span&gt;((&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;RedisMessage&lt;&#x2F;span&gt;&lt;span&gt;) msg);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;synchronized &lt;&#x2F;span&gt;&lt;span&gt;(response) {
&lt;&#x2F;span&gt;&lt;span&gt;        response.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;notify&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;åœ¨ä¸Šè¿°çš„ä»£ç ä¸­è™½ç„¶æœ‰ synchronized ä»£ç å—ï¼Œä½†æ˜¯ï¼Œåœ¨ä»£ç å—å†…æ²¡æœ‰é˜»å¡æ€§çš„æ“ä½œï¼Œå› æ­¤ï¼Œå…¶å¯¹å¹¶å‘çš„æ€§èƒ½å½±å“æ˜¯éå¸¸å¾®å°çš„ã€‚å½“ç„¶ä¾‹å¤–ä¹Ÿæ˜¯å­˜åœ¨çš„ï¼šæˆ‘ä»¬ä¼šæ§åˆ¶å•ä¸ªqueueçš„æ’é˜Ÿæ•°é‡ï¼Œç›®å‰ç¼ºçœæ˜¯200ï¼Œç›¸å½“äºæœ€å¤šå¯ä»¥æœ‰200ä¸ªå¤„ç†ä¸­çš„å‘½ä»¤ï¼Œå¯¹åº”äºJedisçš„è¯ï¼Œç›¸å½“äºæœ€å¤š200ä¸ªè¿æ¥æ± ã€‚&lt;&#x2F;p&gt;
&lt;h3 id=&quot;ji-ben-liu-cheng-lu-you-chu-li&quot;&gt;åŸºæœ¬æµç¨‹ï¼šè·¯ç”±å¤„ç†&lt;&#x2F;h3&gt;
&lt;ol&gt;
&lt;li&gt;å…ˆå¯¹Keyè¿›è¡ŒCRC16ã€å¯¹16384è¿›è¡Œå–æ¨¡ï¼Œå¾—åˆ°è¯¥Keyå¯¹åº”çš„slot&lt;&#x2F;li&gt;
&lt;li&gt;yediså†…å­˜ä¸­ç»´æŠ¤äº†ä¸€ä¸ªé•¿åº¦ä¸º16384çš„slotsæ•°ç»„ï¼Œslotsæ•°ç»„å­˜å‚¨äº†Partionå¼•ç”¨ï¼ŒPartionä¸RedisèŠ‚ç‚¹ä¸€ä¸€å¯¹åº”ã€åŒæ—¶ä¹Ÿä¿å­˜äº†Redisçš„ä¸»ä»å…³ç³»ã€‚é€šè¿‡ç¬¬1æ­¥çš„slot + ReadModelå¯ä»¥è·å¾—å¯¹åº”çš„Partionï¼Œè¿›è€Œè·å–å¯¹åº”çš„RedisèŠ‚ç‚¹Host&lt;&#x2F;li&gt;
&lt;li&gt;yedisåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šä¸ºæ¯ä¸ªReidsèŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªchannelè¿æ¥ï¼ŒåŒæ—¶å°†channelç¼“å­˜åˆ°æœ¬åœ°Mapï¼Œä½¿ç”¨hostä½œä¸ºkeyã€‚é€šè¿‡ç¬¬2æ­¥è·å–åˆ°çš„hostä¾¿å¯ä»channel mapä¸­è·å–å¯¹åº”çš„channelï¼Œç„¶åè¿›è¡Œæ•°æ®çš„å‘é€äº†,&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h3 id=&quot;ji-ben-liu-cheng-wang-luo-yi-chang-chu-li&quot;&gt;åŸºæœ¬æµç¨‹ï¼šç½‘ç»œå¼‚å¸¸å¤„ç†&lt;&#x2F;h3&gt;
&lt;ol&gt;
&lt;li&gt;æœåŠ¡å™¨å¼‚å¸¸å…³é—­è¿æ¥
yedisç½‘ç»œé€šä¿¡é‡‡ç”¨nettyï¼Œä¸Redisä¿æŒé•¿è¿æ¥ï¼Œä¸€æ—¦æŸä¸ªRedisèŠ‚ç‚¹è¿æ¥è¢«å…³é—­ï¼Œå®¢æˆ·ç«¯èƒ½è¿…é€Ÿæ£€æµ‹åˆ°å¹¶ä¸”ç§»é™¤è¯¥Channelç¼“å­˜ä¿¡æ¯ï¼Œä½¿å¾—å‘å¾€è¯¥ReidsèŠ‚ç‚¹çš„è¯·æ±‚åœ¨å®¢æˆ·ç«¯ä¾¿å¿«é€Ÿå¤±è´¥ï¼Œä¸ä¼šå› æ­¤å µå¡ï¼›åŒæ—¶åå°çº¿ç¨‹ä¼šå¼‚æ­¥çš„å°è¯•é‡æ–°åˆ›å»ºåˆ°è¯¥ReidsèŠ‚ç‚¹çš„Channelè¿æ¥ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é›†ç¾¤å‘ç”Ÿå˜åŒ–
yediså¯åŠ¨çš„æ—¶å€™ï¼Œåå°ä¼šå¯åŠ¨ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹ï¼Œæ¯5sæ£€æµ‹Reidsé›†ç¾¤æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œä¾‹å¦‚ï¼šä¸»èŠ‚ç‚¹downæœºã€ä¸»ä»å‘ç”Ÿåˆ‡æ¢ã€æ–°å¢&#x2F;ç¼©å‡RedisèŠ‚ç‚¹ç­‰ï¼Œyedisä¼šé‡æ–°æ‰§è¡Œä¸€æ¬¡åˆå§‹åŒ–æ“ä½œï¼ŒæœŸé—´æ‰€æœ‰è¯»å†™æ“ä½œå‡æš‚åœï¼Œç›´è‡³Redisä¿¡æ¯åŒæ­¥å®Œæˆ&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h3 id=&quot;ji-ben-liu-cheng-xin-tiao-jian-cha&quot;&gt;åŸºæœ¬æµç¨‹ï¼šå¿ƒè·³æ£€æŸ¥&lt;&#x2F;h3&gt;
&lt;p&gt;yedisåå°æœ‰ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹ï¼Œæ¯10så‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªPINGå‘½ä»¤ç„¶åå¸¦ä¸Šå½“å‰æ—¶é—´æˆ³ï¼Œç„¶åæˆ‘ä»¬æ£€æµ‹ReidsæœåŠ¡çš„è¿”å›å†…å®¹æ˜¯å¦ä¸æˆ‘ä»¬å‘é€çš„æ—¶é—´æˆ³ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œé‚£å°±è¯´æ˜æ¶ˆæ¯åœ¨Queueä¸­å‘ç”Ÿäº†é”™ä½ï¼Œæˆ‘ä»¬ä¼šç«‹å³å…³é—­è¯¥channelï¼Œç„¶åç«‹å³é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥&lt;&#x2F;p&gt;
&lt;h3 id=&quot;pipeline-chu-li-liu-cheng&quot;&gt;Pipeline å¤„ç†æµç¨‹&lt;&#x2F;h3&gt;
&lt;p&gt;yedisçš„æ•°æ®å‘é€ã€æ¥æ”¶æ¨¡å¼éå¸¸å‹å¥½çš„æ”¯æŒPipelineï¼Œæ˜¯å…¨å±€çš„Pipelineï¼Œè€Œéé’ˆå¯¹æŸä¸ªRedisèŠ‚ç‚¹çš„ã€‚å…·ä½“ä½¿ç”¨æ–¹å¼ï¼Œå¯å‚è€ƒAPIåŸºæœ¬ç”¨æ³•ã€‚Pipelineå¤„ç†æµç¨‹ååˆ†ç®€å•ï¼Œå’Œæ™®é€šå‘½ä»¤å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯åŒæ­¥å’Œå¼‚æ­¥ç­‰å¾…ç»“æœï¼ŒPipelineæ¨¡å¼ä¸‹ï¼Œå‘½ä»¤å‡è¿”å›ResponseFutureï¼Œåœ¨å‘½ä»¤å…¨éƒ¨å‘é€å®Œæˆåï¼Œå†ç»Ÿä¸€ç­‰å¾…ç»“æœã€‚è¿™æ ·ï¼ŒRediså‘½ä»¤å¯ä»¥ä¸åœçš„å‘é€åˆ°RedisæœåŠ¡ç«¯ï¼Œè€Œä¸å¿…ç­‰å¾…ä¸Šä¸€æ¡å‘½äº†å¤„ç†å®Œï¼Œå†å¤„ç†ä¸‹ä¸€æ¡ï¼Œå¤§å¤§æå‡æ•ˆç‡ï¼
åŸºäº Yedis çš„å•è¿æ¥ã€å¼‚æ­¥å¤„ç†æ¡†æ¶ï¼ŒPipelineçš„å®ç°é€»è¾‘éå¸¸ç®€å•ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-java &quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;private &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;R&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;ResponseFuture&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;R&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;send&lt;&#x2F;span&gt;&lt;span&gt;(final &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Request&lt;&#x2F;span&gt;&lt;span&gt; request, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Channel&lt;&#x2F;span&gt;&lt;span&gt; channel) {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;assertChannelNotNull&lt;&#x2F;span&gt;&lt;span&gt;(channel);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;ResponseFuture&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;R&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; future = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;ResponseFuture&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;SendCallback&lt;&#x2F;span&gt;&lt;span&gt;() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;            ......
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        }&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;synchronized &lt;&#x2F;span&gt;&lt;span&gt;(channel) {
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;assertChannelIsActive&lt;&#x2F;span&gt;&lt;span&gt;(channel);
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;(!&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;YedisHandler&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;put&lt;&#x2F;span&gt;&lt;span&gt;(channel, future, timeout)) {
&lt;&#x2F;span&gt;&lt;span&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;throw new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;YedisException&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;format&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;put msg to blockingqueue timeout %s seconds&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, timeout));
&lt;&#x2F;span&gt;&lt;span&gt;                }
&lt;&#x2F;span&gt;&lt;span&gt;                channel.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;writeAndFlush&lt;&#x2F;span&gt;&lt;span&gt;(request);
&lt;&#x2F;span&gt;&lt;span&gt;            } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;catch &lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;InterruptedException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;e&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;throw new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;YedisInterruptedExceptionException&lt;&#x2F;span&gt;&lt;span&gt;(e);
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return&lt;&#x2F;span&gt;&lt;span&gt; future;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;yedis-xing-neng-ce-shi-shu-ju&quot;&gt;Yedis æ€§èƒ½æµ‹è¯•æ•°æ®&lt;&#x2F;h2&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th style=&quot;text-align: left&quot;&gt;åºå·&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: left&quot;&gt;çº¿ç¨‹æ•°&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: left&quot;&gt;æµ‹è¯•æ•°æ®å¤§å°(byte)&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: left&quot;&gt;queue size&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: left&quot;&gt;ä¸»&#x2F;ä»&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: left&quot;&gt;æ€»è¯·æ±‚æ•°&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: left&quot;&gt;æˆåŠŸæ•°&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: left&quot;&gt;å¤±è´¥æ•°&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: left&quot;&gt;QPS&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: left&quot;&gt;YGC&lt;&#x2F;th&gt;&lt;th style=&quot;text-align: left&quot;&gt;FGC&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: left&quot;&gt;1&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;16&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;256&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;200&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;M&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;64878&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;7&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: left&quot;&gt;2&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;32&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;256&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;200&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;M&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;76591&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;7&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: left&quot;&gt;3&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;64&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;256&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;200&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;M&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;82486&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;8&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: left&quot;&gt;4&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;128&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;256&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;200&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;M&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;88704&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;8&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: left&quot;&gt;5&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;256&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;256&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;200&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;M&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;81655&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;8&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: left&quot;&gt;&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: left&quot;&gt;6&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;16&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;1024&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;200&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;M&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;55200&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;10&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: left&quot;&gt;7&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;32&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;1024&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;200&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;M&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;63713&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;10&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: left&quot;&gt;8&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;64&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;1024&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;200&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;M&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;68154&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;11&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: left&quot;&gt;9&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;128&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;1024&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;200&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;M&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;74609&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;11&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: left&quot;&gt;10&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;256&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;1024&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;200&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;M&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;320ä¸‡&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;71428&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;11&lt;&#x2F;td&gt;&lt;td style=&quot;text-align: left&quot;&gt;0&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;h2 id=&quot;qi-ta-jing-yan-zong-jie&quot;&gt;å…¶å®ƒç»éªŒæ€»ç»“&lt;&#x2F;h2&gt;
&lt;p&gt;åœ¨Yediså¼€å‘ä¸­ï¼Œæˆ‘ä»¬éå¸¸å…³æ³¨ä»£ç çš„æ€§èƒ½ï¼Œå°½å¯èƒ½æä¾›ä¸€ä¸ªè¶³å¤Ÿé«˜æ•ˆçš„é©±åŠ¨ç¨‹åºï¼Œè¿™é‡Œç®€å•çš„è¡¥å……è¯´æ˜ä¸€ä¸‹ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ç›´æ¥åœ¨ ByteBufï¼ˆä¸€èˆ¬çš„ï¼Œæ˜¯HeapOffçš„ByteBufï¼Œå¯ä»¥æä¾›æ›´é«˜çš„æ•°æ®è¯»å†™ã€åˆ†é…æ€§èƒ½ï¼‰ä¸­æœç´¢CRã€LFç­‰åˆ†éš”ç¬¦ï¼Œå®é™…æµ‹è¯•è¡¨æ˜ï¼šä½¿ç”¨ ByteBuf.forEachByte è¿­ä»£ç›¸æ¯”æ‰‹å†™çš„ forå¾ªç¯éå†ï¼Œå…·æœ‰10-20%çš„æ€§èƒ½æå‡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æœ€å°åŒ–å†…å­˜åˆ†é…ï¼Œå‡å°‘GCè´Ÿæ‹…ã€‚Yedisé’ˆå¯¹ç½‘ç»œé€šä¿¡ï¼Œå°½é‡é¿å…åˆ›å»ºé¢å¤–çš„å¯¹è±¡ã€‚æˆ‘ä»¬ä¸ºæ¯ä¸ªChannelå‡†å¤‡äº†ä¸€ä¸ªç¼ºçœ1024çš„bufferï¼Œé™¤éå•ä¸ªrediså“åº”å­—ç¬¦ä¸²è¶…è¿‡1024ï¼Œå¦åˆ™æ— éœ€é¢å¤–çš„å†…å­˜åˆ†é…ã€‚è¿™å¯¹äºå¤§é‡ä»¥è¾ƒå°çš„keyï¼Œvalueä¸ºä¸»çš„Redisåº”ç”¨æ¥è¯´ï¼Œå¯ä»¥æœ€å°åŒ–å¯¹è±¡åˆ†åˆ†é…ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨ immutable çš„æ•°æ®ç»“æ„ï¼Œç®€åŒ–å¹¶å‘æƒ…å†µä¸‹çš„çº¿ç¨‹å®‰å…¨ã€‚Yedisä¸­æ¶‰åŠåˆ°å¤§é‡çš„å¹¶å‘æ“ä½œï¼Œè¿™äº›å¹¶å‘æ“ä½œä¼šæ¶‰åŠåˆ°å¤æ‚çš„æ•°æ®åŒæ­¥ã€‚åŒæ­¥æ“ä½œæ˜¯å¹¶å‘çš„ä¸‡æ¶ä¹‹æºï¼Œä¸ºäº†ç®€åŒ–å¹¶å‘å¤„ç†ï¼Œæé«˜ç³»ç»Ÿçš„é²æ£’æ€§ï¼ŒYedisåœ¨å­˜å‚¨å…±äº«çš„æ•°æ®ç»“æ„æ—¶ï¼Œå°½é‡é‡‡ç”¨ immutable çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªå¯ä»¥å‚è€ƒï¼š&lt;code&gt;ClusterInfo&lt;&#x2F;code&gt;ã€&lt;code&gt;Node&lt;&#x2F;code&gt;ã€&lt;code&gt;Partion&lt;&#x2F;code&gt;ç­‰æ•°æ®ç»“æ„ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>åº”ç”¨å‡½æ•°å¼ç¼–ç¨‹</title>
        <published>2021-07-10T00:00:00+00:00</published>
        <updated>2021-07-10T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/applied-function-progamming/"/>
        <id>https://wangzaixiang.github.io/blog/applied-function-progamming/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/applied-function-progamming/">&lt;h1 id=&quot;ying-yong-han-shu-shi-bian-cheng&quot;&gt;åº”ç”¨å‡½æ•°å¼ç¼–ç¨‹&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;1-1-tu-ling-ji-feng-nuo-yi-man-ti-xi-yu-ming-ling-shi-bian-cheng&quot;&gt;1.1 å›¾çµæœºã€å†¯.è¯ºä¼Šæ›¼ä½“ç³» ä¸ å‘½ä»¤å¼ç¼–ç¨‹&lt;&#x2F;h2&gt;
&lt;p&gt;ç°åœ¨å¤§éƒ¨åˆ†çš„ç¨‹åºå‘˜ï¼Œæ¥å—çš„æ˜¯â€œé¢å‘å¯¹è±¡â€çš„ç¼–ç¨‹æ–¹æ³•ï¼ŒåŸºæœ¬çš„å‡ æ¿æ–§åŒ…æ‹¬ï¼šç»§æ‰¿ã€è¦†ç›–ï¼ˆé‡å†™ï¼‰ã€è®¾è®¡æ¨¡å¼ç­‰ã€‚ç¼ºä¹å¯¹æ¯”ï¼Œå°±å¾ˆå®¹æ˜“åäº•è§‚å¤©ï¼Œå®¹æ˜“ä»¥ä¸ºè¿™ç§æ–¹å¼å°±æ˜¯â€œå”¯ä¸€â€çš„é€‰æ‹©ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å…¶å®ï¼Œä»è¯­è¨€æŠ½è±¡çš„è§’åº¦æ¥çœ‹ï¼Œä»é¢å‘æœºå™¨çš„æ±‡ç¼–è¯­è¨€ï¼Œåˆ°ä»¥ï¼£ã€Pascalä¸ºä»£è¡¨çš„ç»“æ„åŒ–ç¼–ç¨‹è¯­è¨€ã€å†åˆ°C++ã€Javaç­‰OOPè¯­è¨€ï¼Œä»–ä»¬çš„æœ¬è´¨éƒ½æ˜¯â€œå›¾çµæœºâ€æ¨¡å‹ï¼Œç¨‹åº =
æ§åˆ¶æµ + å…±äº«å†…å­˜ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;applied-function-progamming&#x2F;15735640009763.png&quot; alt=&quot;å›¾çµæœº&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;é€šè¿‡ç§»åŠ¨çº¸å¸¦ä¾æ¬¡æ‰§è¡Œä¸‹ä¸€è¡Œä»£ç ï¼Œä»£ç å¯èƒ½æ˜¯ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ä»å†…å­˜ä¸­è¯»å–æŸä¸ªæ•°æ®&lt;&#x2F;li&gt;
&lt;li&gt;è¿›è¡ŒæŸç§è®¡ç®—ï¼ˆæˆ–é€»è¾‘æ¯”è¾ƒï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;å°†è®¡ç®—ç»“æœå†™å…¥åˆ°æŸä¸ªå†…å­˜&lt;&#x2F;li&gt;
&lt;li&gt;é¡ºåºæ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œæˆ–è€…è·³è½¬åˆ°æŸä¸ªæŒ‡å®šçš„ä½ç½®ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è¿™ä¸ªç¼–ç¨‹æ¨¡å‹ç”±äºæœ€ä¸ºè´´è¿‘ç›®å‰çš„è®¡ç®—æœºä½“ç³»æ¶æ„ï¼ˆå†¯è¯ºä¼Šæ›¼æ¶æ„ï¼‰ï¼Œå› æ­¤æ˜¯ä¸€ç§å¾ˆè‡ªç„¶çš„è¿›åŒ–ï¼Œå…·æœ‰æœ€é«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ¨¡å‹å¯¹â€äººç±»â€œå¹¶ä¸æ˜¯å‹å¥½çš„ï¼šæˆ‘ä»¬æ›´å–œæ¬¢ä¸€ç§é¡ºåºå‰è¿›çš„æ€ç»´æ¨¡å‹ï¼šç¬¬ä¸€æ­¥ï¼Œç¬¬äºŒæ­¥ï¼Œ......ç›´åˆ°å®Œæˆä»»åŠ¡ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸æ–­çš„è¿›è¡Œè·³è·ƒï¼Œå…œè½¬ï¼Œæœ€ç»ˆå°±ä¼šå½¢æˆä¸€å›¢ä¹±éº»ï¼Œä¸€åº§è¿·å®«ï¼Œè®©å¼€å‘è€…æ— æ³•ç†æ¸…æ€è·¯ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;æ§åˆ¶æµç¨‹çš„å¤æ‚æ€§ï¼Œä¼šè®©æˆ‘ä»¬é™·å…¥åˆ°ä¸€ä¸ªä¸æ–­å‰è¿›ã€åé€€çš„æ€ªåœˆä¹‹ä¸­ï¼Œå¾ˆå®¹æ˜“å°±ä¼šè®©æˆ‘ä»¬è¿·å¤±ï¼Œå¿˜è®°äº†è¿‡å»ï¼Œæ‰¾ä¸åˆ°æœªæ¥ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ•°æ®æµç¨‹çš„å¤æ‚æ€§ã€‚æŸä¸€è¡Œä»£ç ï¼Œéƒ½éœ€è¦è¯»å†™æŸä¸ªå†…å­˜æ•°æ®ï¼Œè¿™äº›ä¾èµ–çš„æ•°æ®ï¼Œå…¶æ¥é¾™å»è„‰å¦‚ä½•ï¼Ÿç›®å‰çš„çŠ¶æ€æ˜¯å¦æ­£ç¡®ï¼Ÿä¸å…¶ä»–çš„æ•°æ®æ˜¯å¦ä¸€è‡´ï¼Ÿå¦‚æœå·²ç»å‡ºç°é”™è¯¯ï¼Œæˆ–è€…ä¸ä¸€è‡´çš„æƒ…å†µï¼Œåç»­çš„å¤„ç†å°±ä¼šè”“å»¶è¿™ä¸ªé”™è¯¯ï¼Œå¯¼è‡´æ›´å¤§çš„é”™è¯¯äº§ç”Ÿã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;æ§åˆ¶æµçš„å¤æ‚æ€§å’Œæ•°æ®æµçš„å¤æ‚æ€§æ˜¯ç›¸äº’çº ç¼ çš„ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å¤æ‚çš„æ§åˆ¶æµï¼Œä¼šè®©æ•°æ®æµå˜å¾—æ›´å¤æ‚ã€æ›´éš¾ä»¥è¯æ˜å…¶æ­£ç¡®æ€§ã€‚æŸä¸ªæ•°æ®çš„å½“å‰çŠ¶æ€ä¾èµ–äºä¹‹å‰çš„æ‰§è¡Œæµç¨‹ï¼Œå¤æ‚çš„æ§åˆ¶æµï¼Œå°±æ„å‘³ç€è¿™ä¸ªæ•°æ®è¿‡å»çš„è¯»ã€å†™ç”Ÿå‘½å‘¨æœŸéå¸¸å¤æ‚ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¤æ‚çš„æ•°æ®æµï¼Œä¼šåå‘ä½œç”¨äºæ§åˆ¶æµï¼Œå½±å“å…¶ç¨‹åºæµç¨‹ã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯ï¼ŒæŸæ®µä»£ç æœ¬èº«é€»è¾‘æ²¡æœ‰é—®é¢˜ï¼Œå¦‚æœä»–çš„è¾“å…¥æ˜¯ä¸€ä¸ªé”™è¯¯çš„ï¼Œæˆ–è€…è‡ªç›¸çŸ›ç›¾çš„ï¼Œåˆ™ä¸€å®šä¼šäº§ç”Ÿé”™è¯¯çš„ç»“æœï¼Œç”šè‡³ä¼šè®©è¿™ä¸ªé”™è¯¯åŠ ä»¥æ”¾å¤§ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;æ§åˆ¶æµï¼Œå¯ä»¥é€šè¿‡æ¶ˆé™¤gotoï¼Œä»ä¸€å›¢ä¹±éº»å¼çš„é€»è¾‘æ¼”è¿›æˆä¸ºâ€œç»“æ„åŒ–â€çš„æ¨¡å¼ï¼Œä¸»è¦çš„æªæ–½åŒ…æ‹¬ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å¼•å…¥â€œå‡½æ•°ã€è¿‡ç¨‹â€ï¼Œæä¾›ä¸€ç§åŸºç¡€åŒ–çš„å­éƒ¨ä»¶ï¼Œé€šè¿‡è¿‡ç¨‹è°ƒç”¨çš„æ–¹å¼ï¼Œæ”¯æŒé«˜ç²’åº¦çš„é€»è¾‘ç»„åˆã€‚åœ¨å®è§‚å±‚é¢æ¶ˆé™¤ goto&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨ä¸‰ç§æ§åˆ¶æµç¨‹ï¼š
&lt;ol&gt;
&lt;li&gt;é¡ºåºä»£ç å—&lt;&#x2F;li&gt;
&lt;li&gt;åˆ†æ”¯ä»£ç å—ï¼Œä¹Ÿå°±æ˜¯é«˜çº§è¯­è¨€ä¸­çš„ if else, switch ç­‰è¯­æ³•&lt;&#x2F;li&gt;
&lt;li&gt;å¾ªç¯ä»£ç å—ã€‚ä¹Ÿå°±æ˜¯é«˜çº§è¯­è¨€ä¸­çš„ for, while ç­‰è¯­æ³•&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ç»“åˆä¸Šè¿°å…ƒç´ ï¼Œå°±å¯ä»¥å®Œå…¨ç¼–å†™å‡ºæ²¡æœ‰ goto
çš„ä»£ç æ¥ã€‚å…¶å®ï¼Œæ­£å¦‚â€œç»“æ„åŒ–ç¼–ç¨‹â€œçš„åç§°æ‰€ç¤ºï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ¶ˆé™¤æ‰æ§åˆ¶æµçš„å¼‚å¸¸è·³è½¬ï¼Œåªæ˜¯æ¢äº†ä¸€ç§æ›´åŠ æœ‰åºçš„æ¨¡å¼ï¼Œè®©ä»£ç å—å˜å¾—æ›´ä¸ºâ€ç»“æ„â€œï¼Œæ¥è¿‘äººçš„æ€ç»´ä¹ æƒ¯ã€‚ç»“æ„åŒ–ç¼–ç¨‹æ˜¯å¯¹æ§åˆ¶æµç¨‹çš„ä¸€æ¬¡æŠ½è±¡ï¼ŒæŠŠç¼–ç¨‹ä»æ— é™è‡ªç”±çš„gotoä¸­ï¼ŒåŠ ä»¥æŠ½è±¡ï¼Œä½¿ç”¨
&lt;code&gt;å­è¿‡ç¨‹&lt;&#x2F;code&gt;ã€&lt;code&gt;é¡ºåºå—&lt;&#x2F;code&gt;ã€&lt;code&gt;åˆ†æ”¯å—&lt;&#x2F;code&gt;ã€&lt;code&gt;å¾ªç¯å—&lt;&#x2F;code&gt;è¿™å‡ ä¸ªåŸºæœ¬çš„ç»“æ„å°±å¯ä»¥å®ç°åŒæ ·çš„åŠŸèƒ½ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ç»“æ„åŒ–ç¼–ç¨‹è¯ç”Ÿäº†æ–°çš„é«˜çº§è¯­è¨€ï¼Œå¦‚ Cã€Pascalã€Ada ç­‰ï¼Œéšåï¼Œéšç€ä»£ç è§„æ¨¡çš„é£é€Ÿä¸Šå‡ï¼Œ&lt;code&gt;è¿‡ç¨‹&lt;&#x2F;code&gt;
çš„æ•°é‡é€æ­¥æˆä¸ºä¸€ä¸ªå·¨å¤§çš„æ•°å­—ï¼Œä¼ ç»Ÿçš„ä»£ç ç»„ç»‡æ¨¡å¼ä¸€èˆ¬æŒ‰ç…§â€œæ¨¡å—â€çš„æ–¹å¼ï¼Œå°†ä¸€ç»„ç›¸å…³è”çš„&lt;code&gt;è¿‡ç¨‹&lt;&#x2F;code&gt;æ”¾åˆ°åŒä¸€ä¸ªæ¨¡å—ä¸­ï¼Œä¾‹å¦‚ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸€ä¸ªå®ç° Link List æ•°æ®ç»“æ„çš„&lt;code&gt;module&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;ä¸€ä¸ªå®ç° Quick Sort æ’åºç®—æ³•çš„&lt;code&gt;module&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;ä¸€ä¸ªå®ç°æŸä¸ª User Story çš„&lt;code&gt;module&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;éšç€&lt;code&gt;module&lt;&#x2F;code&gt;çš„è¿›ä¸€æ­¥å¤æ‚åŒ–ï¼Œæˆ‘ä»¬å¼•å…¥äº† &lt;code&gt;object oriented&lt;&#x2F;code&gt;, ä»¥æ•°æ®ç»“æ„ä¸ºä¸­å¿ƒï¼Œå°† æ•°æ®ç»“æ„ï¼ˆ&lt;code&gt;object&lt;&#x2F;code&gt;)å’Œæ“ä½œæ•°æ®ç»“æ„çš„è¿‡ç¨‹ï¼ˆ
&lt;code&gt;method&lt;&#x2F;code&gt;) ç»„åˆåˆ°ä¸€èµ·ï¼Œå½¢æˆäº†&lt;code&gt;class&lt;&#x2F;code&gt;ï¼Œäºæ˜¯è¯ç”Ÿäº†&lt;code&gt;é¢å‘å¯¹è±¡ç¼–ç¨‹&lt;&#x2F;code&gt;ï¼Œé™¤äº† &lt;code&gt;object&lt;&#x2F;code&gt; ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨äº† &lt;code&gt;package&lt;&#x2F;code&gt;(æˆ–è€…è¯´
&lt;code&gt;namespace&lt;&#x2F;code&gt;)ã€&lt;code&gt;module&lt;&#x2F;code&gt; ç­‰æ›´é«˜å±‚æ¬¡çš„ç»„åˆï¼Œä»¥æä¾›æ›´å¥½çš„ç»“æ„åŒ–ç»„ç»‡èƒ½åŠ›ã€‚è¿™ç±»è¯­è¨€ï¼ŒåŒ…æ‹¬ smalltalkã€c++ã€Javaã€C#ç­‰ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸Šé¢çš„è¯­è¨€è¿›åŒ–å²ï¼Œå…¶å®æ˜¯ä¸€ä¸ªå¯¹æ§åˆ¶æµç¨‹è¿›è¡Œä¸æ–­æŠ½è±¡ï¼Œä»è€Œå½¢æˆæ›´è´´è¿‘äººçš„è¡¨è¾¾æ–¹å¼ã€‚ä½†æœ‰ä¸€ç‚¹ä¸å˜çš„æ˜¯ï¼Œè¿™ä¸ªè¿›åŒ–å²æœ‰ä¸€ä¸ªä¸å˜çš„â€œæ ¹éšå–»â€ï¼Œå³è®¡ç®—æ˜¯ä¸€ä¸ªå›¾çµæœºæ¨¡å‹ï¼Œ
&lt;code&gt;ç¨‹åº = æ§åˆ¶æµ + å…±äº«å†…å­˜&lt;&#x2F;code&gt;ï¼Œæ— è®ºæ˜¯æ±‡ç¼–è¯­è¨€ã€ç»“æ„åŒ–è¯­è¨€ã€é¢å‘å¯¹è±¡è¯­è¨€ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ªå›¾çµè®¡ç®—æ¨¡å‹ï¼Œè¿™ç±»çš„è¯­è¨€ï¼Œæˆ‘ä»¬ä¹Ÿç§°ä¹‹ä¸ºâ€œå‘½ä»¤å¼è¯­è¨€â€ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¤§å®¶å¯ä»¥å†ç¿»ç¿»ã€Šä¸‰ä½“ã€‹ï¼Œè¿™æœ¬ä¹¦å…¶å®ä¹Ÿç®—æ˜¯ä¸€æœ¬é€šä¿—çš„è®¡ç®—æœºå…¥é—¨ä¹¦ç±ï¼Œç¬¬åå…«ç« ã€Šç‰›é¡¿ã€å†¯.è¯ºä¼Šæ›¼ã€ç§¦å§‹çš‡ã€ä¸‰æ—¥è¿ç ã€‹ä¸­ï¼Œä¸ºäº†è§£å†³ä¸‰ä½“çš„è¿è½¬è§„å¾‹ï¼Œå‡†ç¡®é¢„æµ‹å‡ºä¸‰ä½“è¿ç çš„æ—¶é—´ï¼Œç‰›é¡¿å‘ç°äº†ç‰©ç†å­¦ä¸‰å®šå¾‹ï¼Œè§£å†³äº†ä»ä¸Šåˆ°å¤©ä½“è¿åŠ¨ã€ä¸‹åˆ°ç»†èƒåˆ†è£‚çš„ä¸€åˆ‡è§„å¾‹ï¼Œåªæ˜¯è¿™é‡Œçš„è®¡ç®—é‡å¤ªè¿‡åºå¤§ï¼Œä¸€å¤§å †å¾®ç§¯åˆ†æ–¹ç¨‹éœ€è¦æ±‚è§£ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå†¯.è¯ºä¼Šæ›¼å‘æ˜äº†è®¡ç®—æ¨¡å‹ï¼Œè¿˜åªæ˜¯ç†è®ºï¼Œå†¯.è¯ºä¼Šæ›¼å¹¶æ²¡æœ‰å‘æ˜è®¡ç®—æœºï¼Œäºæ˜¯ï¼Œä»–ä»¬æ‰¾åˆ°äº†ä¸œæ–¹çš„å›ä¸»ï¼šç§¦å§‹çš‡ï¼Œç”±ç§¦å§‹çš‡æ¥è´Ÿè´£åˆ¶é€ è¿™å°å¤æ‚çš„è®¡ç®—æœºã€‚å†¯è°ƒåŠ¨äº†ç§¦å§‹çš‡çš„3000ä¸‡å£«å…µï¼ŒæŠŠ3000ä¸‡å£«å…µæ’å…µå¸ƒé˜µï¼Œå¹¶æ˜ç¡®æ¯ä¸€ä¸ªå£«å…µçš„èŒè´£ï¼Œå…¶å®ä¹Ÿæ˜¯éå¸¸ä¹‹ç®€å•ï¼šæ‰¿æ‹…ä¸é—¨ã€æˆ–é—¨ã€éé—¨ä¸‰è€…ä¹‹ä¸€çš„èŒè´£ï¼Œä»»ä½•ä¸€åå£«å…µåªéœ€è¦ä¸€å°æ—¶çš„è®­ç»ƒå°±å¯ä»¥æŒæ¡ã€‚æœ€åï¼Œè¿™å°â€œç§¦1å·â€
è®¡ç®—æœºå°±æ„å»ºæˆåŠŸï¼ˆç§¦1å·çš„CPUï¼Œç”±3000ä¸‡çš„é—¨ç”µè·¯ç»„æˆï¼Œå¤§çº¦æœ‰1.2äº¿æ™¶ä½“ç®¡ï¼Œå…¶è§„æ¨¡ç›¸å½“äº 2005å¹´Intelçš„ç¬¬ä¸€ä»£å¥”è…¾DåŒæ ¸å¤„ç†å™¨2.3äº¿æ™¶ä½“ç®¡
ä¸­çš„å•æ ¸è§„æ¨¡ï¼Œå…¶å®æ˜¯éå¸¸åªé¢†å…ˆçš„äº†ï¼‰ã€‚è¿™å°è®¡ç®—æœºè€—æ—¶16ä¸ªæœˆï¼Œå®Œæˆäº†ä¸‰ä½“è¿ç çš„è®¡ç®—ã€‚å½“ç„¶ï¼Œè¿™ä¸ªæ¼‚äº®çš„æ¡ˆä¾‹ä¸­ï¼Œå¦‚æœå†è¡¥å……ä¸Šå›¾çµå’ŒAdaï¼Œæˆ‘è§‰å¾—ä¼šæ›´å®Œç¾ä¸€äº›ï¼Œå› ä¸ºæ˜¯å›¾çµåˆ›é€ äº†è®¡ç®—æ¨¡å‹ï¼Œå†¯è¯ºä¼Šæ›¼åˆ™æ ¹æ®è¿™ä¸ªè®¡ç®—æ¨¡å‹è®¾è®¡äº†CPUå’Œç³»ç»Ÿæ¶æ„ï¼Œè€ŒAdaï¼Œåˆ™æ˜¯ç¬¬ä¸€ä¸ªç¨‹åºå‘˜ï¼Œç”±å¥¹è®¾è®¡å‡ºæ•´ä¸ªè®¡ç®—ç¨‹åºï¼Œå‘½ä»¤ç€è¿™å°åºå¤§çš„è®¡ç®—æœºï¼Œå®Œæˆä¸€ä¸ªå…·ä½“å‘½é¢˜çš„è®¡ç®—ã€‚&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;åœ¨é‡‘å­—å¡”çš„ä¸­éƒ¨ï¼Œä¸€æ’æ——æ‰‹ç”¨æ——è¯­å‘å‡ºæŒ‡ä»¤ï¼Œä¸€æ—¶é—´ï¼Œä¸‹é¢å¤§åœ°ä¸Šä¸‰åƒä¸‡äººæ„æˆçš„å·¨å‹ä¸»æ¿ä»¿ä½›æ¶²åŒ–äº†ï¼Œå……æ»¡äº†ç»†å¯†çš„ç²¼ç²¼æ³¢å…‰ï¼Œé‚£æ˜¯å‡ åƒä¸‡é¢å°æ——åœ¨æŒ¥åŠ¨ã€‚åœ¨é è¿‘é‡‘å­—å¡”åº•éƒ¨çš„æ˜¾ç¤ºé˜µåˆ—ä¸­ï¼Œä¸€æ¡ç”±æ— æ•°é¢ç»¿è‰²å¤§æ——æ„æˆçš„è¿›åº¦æ¡åœ¨å»¶ä¼¸ç€ï¼Œæ ‡ç¤ºç€è‡ªæ£€çš„è¿›åº¦ã€‚ååˆ†é’Ÿåï¼Œè¿›åº¦æ¡èµ°åˆ°äº†å¤´ã€‚&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œè‡ªæ£€å®Œæˆï¼å¼•å¯¼ç¨‹åºè¿è¡Œï¼æ“ä½œç³»ç»ŸåŠ è½½ï¼ï¼â€&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;ä¸‹é¢ï¼Œè´¯ç©¿äººåˆ—è®¡ç®—æœºçš„ç³»ç»Ÿæ€»çº¿ä¸Šçš„è½»éª‘å…µå¿«é€Ÿè¿åŠ¨èµ·æ¥ï¼Œæ€»çº¿ç«‹åˆ»å˜æˆäº†ä¸€æ¡æ¹æ€¥çš„æ²³æµï¼Œè¿™æ²³æµæ²¿é€”åˆåˆ†æˆæ— æ•°æ¡ç»†å°çš„æ”¯æµï¼Œæ¸—å…¥åˆ°å„ä¸ªæ¨¡å—é˜µåˆ—ä¹‹ä¸­ã€‚å¾ˆå¿«ï¼Œé»‘ç™½æ——çš„æ¶Ÿæ¼ªæ¼”åŒ–æˆæ±¹æ¶Œçš„æµªæ½®ï¼Œæ¿€è¡åœ¨æ•´å—ä¸»æ¿ä¸Šã€‚ä¸­å¤®çš„CPUåŒºæ¿€è¡æœ€ä¸ºå‰§çƒˆï¼Œåƒä¸€ç‰‡ç‡ƒçƒ§çš„ç«è¯ã€‚çªç„¶ï¼Œä»¿ä½›ç«è¯ç‡ƒå°½ï¼ŒCPUåŒºçš„æ‰°åŠ¨æ¸æ¸å¹³é™ä¸‹æ¥ï¼Œæœ€åç«Ÿå®Œå…¨é™æ­¢äº†ï¼›ä»¥å®ƒä¸ºåœ†å¿ƒï¼Œè¿™é™æ­¢å‘å„ä¸ªæ–¹å‘é£å¿«æ‰©æ•£å¼€æ¥ï¼Œåƒå¿«é€Ÿå°å†»çš„æµ·é¢ï¼Œæœ€åæ•´å—ä¸»æ¿å¤§éƒ¨åˆ†é™æ­¢äº†ï¼Œå…¶é—´åªæœ‰ä¸€äº›é›¶æ˜Ÿçš„æ­»å¾ªç¯åœ¨ä»¥ä¸å˜çš„èŠ‚å¥æ²¡æœ‰ç”Ÿæ°”åœ°é—ªåŠ¨ç€ï¼Œæ˜¾ç¤ºé˜µåˆ—ä¸­å‡ºç°äº†é—ªåŠ¨çš„çº¢è‰²ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åˆ˜æ…ˆæ¬£. ä¸‰ä½“å…¨é›†&lt;&#x2F;p&gt;
&lt;h2 id=&quot;1-2-lyan-suan-yu-han-shu-shi-bian-cheng&quot;&gt;1.2 Î»æ¼”ç®— ä¸ å‡½æ•°å¼ç¼–ç¨‹&lt;&#x2F;h2&gt;
&lt;p&gt;èŠ±å¼€ä¸¤æœµï¼Œå„è¡¨ä¸€æã€‚é™¤äº†å›¾çµè®¡ç®—ï¼Œè¿˜æœ‰ä¸€ä¸ªè®¡ç®—æ¨¡å‹ï¼Œå°±æ˜¯ Î»è®¡ç®—ã€‚ lambdaæ¼”ç®—æ˜¯Alonzo
Churchåœ¨1930å¹´å»ºç«‹çš„ï¼ˆå…¶ç›¸æ¯”å›¾çµæœºç†è®ºçš„åˆ›å»ºæ—¶é—´æ—©6å¹´ï¼ŒChurchä¹Ÿæ˜¯Turingçš„è€å¸ˆï¼‰ã€‚lambda è®¡ç®—çš„æ ¸å¿ƒéå¸¸ç®€å•ï¼š&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;E = x       -- å˜é‡ x
&lt;&#x2F;span&gt;&lt;span&gt;    | Î»x.E -- å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶å˜é‡xï¼Œè¿”å›å€¼ä¸º E
&lt;&#x2F;span&gt;&lt;span&gt;    | (E1 E2) -- è°ƒç”¨å‡½æ•° E1(E2)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;æœ‰è®ºæ–‡è¯æ˜ï¼šå›¾çµæ¼”ç®— å’Œ Î»æ¼”ç®—éƒ½æ˜¯è®¡ç®—å®Œå¤‡çš„è¯­è¨€ï¼ŒäºŒè€…åœ¨åŠŸèƒ½ä¸Šæ˜¯ç­‰ä»·çš„ã€‚Lisp è¯­è¨€æ˜¯æœ€æ—©çš„åŸºäº Î»æ¼”ç®— çš„é«˜çº§è¯­è¨€ã€‚ç°åœ¨çš„å„ç§ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œéƒ½ä¼šå¼•å…¥
lambda è¿™ä¸ªæ¦‚å¿µï¼Œå…¶æºå¤´éƒ½å‡ºè‡ª lambda æ¼”ç®—è¿™ä¸€ç†è®ºã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸Šè¿°çš„æ ¸å¿ƒæ¨¡å‹æ˜¯å¦‚æ­¤ç®€å•ï¼Œä½†å´æ˜¯FPçš„æ ¸å¿ƒåŸç†ï¼Œå…¶ä½œç”¨çŠ¹å¦‚ç‰›é¡¿ä¸‰å®šå¾‹ä¹‹äºç»å…¸ç‰©ç†ï¼Œå¦‚äº”å¤§å…¬ç†ä¹‹äºæ¬§å‡ é‡Œå¾—å‡ ä½•ã€‚æˆ–è€…å¯ä»¥ç†è§£ä¸º
FP ç¼–ç¨‹çš„CPUå’Œæ±‡ç¼–è¯­è¨€ï¼šæ‰€æœ‰çš„å‡½æ•°å¼ä»£ç ï¼Œæœ€ç»ˆéƒ½å¯ä»¥è¡¨è¾¾ä¸ºå¦‚ä¸Šçš„ä¸‰ç§åŸºæœ¬å…ƒç´ ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;2-han-shu-shi-bian-cheng-de-ji-ben-yuan-ze&quot;&gt;2. å‡½æ•°å¼ç¼–ç¨‹çš„åŸºæœ¬åŸåˆ™&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;2-1-wu-fu-zuo-yong-chun-han-shu&quot;&gt;2.1 æ— å‰¯ä½œç”¨çº¯å‡½æ•°&lt;&#x2F;h2&gt;
&lt;p&gt;æ‰€è°“çº¯å‡½æ•°ï¼Œå°±æ˜¯æ¥æ”¶è¾“å…¥ï¼Œè®¡ç®—å¹¶è¿”å›ç»“æœã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸äº§ç”Ÿå…¶å®ƒæ•ˆæœã€‚ï¼ˆé€šä¿—çš„è¯´ï¼Œé™¤äº†è¿”å›ç»“æœï¼Œä»¥åŠCPUå‘çƒ­ä¹‹å¤–ï¼Œä¸è¦åšå…¶ä»–çš„äº‹æƒ…ï¼‰ï¼ŒåŒ…æ‹¬ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ä»»ä½•èµ‹å€¼æ“ä½œï¼Œä¼šæ”¹å˜ç°æœ‰å†…å­˜çŠ¶æ€ï¼ˆé™¤éé¦–æ¬¡èµ‹å€¼ï¼Œåœ¨å‡½æ•°å¼è¯­è¨€ä¸­ï¼Œé¦–æ¬¡èµ‹å€¼è¢«ç§°ä¸º å˜é‡ç»‘å®šï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;æ›´æ”¹å…¨å±€å˜é‡ã€‚åœ¨Javaä¸­ï¼Œè¿™åŒ…æ‹¬ï¼šstaticå˜é‡ï¼Œå¯¹è±¡çš„å®ä¾‹å˜é‡ï¼ˆåŒ…æ‹¬ä¿®æ”¹å‚æ•°å¯¹è±¡ä¸­çš„å­—æ®µï¼‰ç­‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä»»ä½• IO æ“ä½œã€‚åŒ…æ‹¬é”®ç›˜è¾“å…¥ã€å±å¹•è¾“å‡ºã€æ–‡ä»¶è¯»å†™ã€è®°å½•æ—¥å¿—ã€è¯»å†™Socketç­‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä»»ä½•æ•°æ®åº“æ“ä½œã€‚å½“ç„¶ï¼Œæ•°æ®åº“æ“ä½œä¹Ÿæ˜¯IOã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å½“ç„¶ï¼Œä¹ŸåŒ…æ‹¬å‘é€çŸ­ä¿¡ã€å‘é€é‚®ä»¶ç­‰ç­‰ï¼Œè¿™äº›ä¹Ÿæ˜¯é€šè¿‡ IO æ¥å¼•èµ·çš„ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤–ï¼Œçº¯å‡½æ•°è¿˜å…·å¤‡â€œå¼•ç”¨é€æ˜æ€§â€ï¼Œå³å¯¹ç›¸åŒçš„è¾“å…¥å‚æ•°ï¼Œæ€»æ˜¯åº”è¯¥è¿”å›ç›¸åŒçš„è®¡ç®—ç»“æœï¼Œå› æ­¤ï¼Œè¯¸å¦‚
currentTimeMillisã€UUIDã€randomç­‰ï¼Œéƒ½ä¸æ˜¯â€œçº¯å‡½æ•°â€ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ”¾åˆ°å®é™…ä¸šåŠ¡ä¹‹ä¸­ï¼Œè¿™ä¸ªçº¦æŸå…¶å®æœ‰äº›â€œè‹›åˆ»â€ï¼Œæˆ‘ä»¬å¾ˆéš¾åšåˆ°ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®å®é™…æƒ…å†µï¼Œé…Œæƒ…æ”¾æ¾ä¸€ä¸‹ï¼Œä¾‹å¦‚ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;è¯¸å¦‚â€œæ—¥å¿—è¾“å‡ºâ€œè¿™æ ·çš„IOï¼Œå¯ä»¥è§†ä¸ºâ€œè½»å¾®æ— å®³çš„å‰¯ä½œç”¨â€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨äº‹åŠ¡ç±»æœåŠ¡å¤„ç†ä¸­ï¼Œè¯»å–æ•°æ®åº“ä¸­çš„å½“å‰çŠ¶æ€ï¼Œå¯ä»¥è§†ä¸ºâ€œæ— å®³çš„IOæ“ä½œ&quot;ï¼Œæˆ–è€…å½“ä½œç±»ä¼¼äºè¯»å–å‡½æ•°ä¸Šä¸‹æ–‡ä¸­çš„å…¨å±€å˜é‡æ“ä½œã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;æ„Ÿè§‰ä¸Šï¼Œå¦‚æœæ²¡æœ‰IOï¼Œæ²¡æœ‰æ•°æ®åº“æ“ä½œï¼Œé‚£æˆ‘ä»¬çš„ä»£ç è¿˜èƒ½å¹²ä»€ä¹ˆå‘¢ï¼Ÿåˆ›å»ºè®¢å•çš„æœåŠ¡ï¼Œæœ¬è´¨ä¸Šä¸å°±æ˜¯éœ€è¦ç”Ÿæˆä¸€ä¸ªæ–°çš„è®¢å•å—ï¼Ÿè¿™ä¸ªç–‘é—®ï¼Œæˆ‘ä»¬ä¼šåœ¨
&lt;code&gt;2.5 ç®¡ç†å‰¯ä½œç”¨&lt;&#x2F;code&gt; ä¸­è¿›è¡Œè¯´æ˜ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;2-2-bu-ke-bian-shu-ju&quot;&gt;2.2 ä¸å¯å˜æ•°æ®&lt;&#x2F;h2&gt;
&lt;p&gt;ä¸å‘½ä»¤å¼è¯­è¨€åŸºäºâ€å…±äº«å†…å­˜â€œçš„æ¨¡å‹ä¸åŒï¼Œå‡½æ•°å¼ç¼–ç¨‹ä¸­å¼ºè°ƒæ•°æ®çš„ä¸å¯å˜æ€§ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨å‡½æ•°ä¸­ä¸è¦ä½¿ç”¨å¯å˜å˜é‡ï¼ˆvariableï¼‰ã€‚ç”¨ Java è¯­è¨€ä¸ºä¾‹ï¼Œæ‰€æœ‰çš„å‡½æ•°å±€éƒ¨å˜é‡éƒ½åº”è¯¥ä½¿ç”¨ final ä¿®é¥°ï¼Œåªèƒ½åˆå§‹åŒ–èµ‹å€¼ä¸€æ¬¡ï¼Œä¸èƒ½è¿›è¡ŒäºŒæ¬¡èµ‹å€¼ã€‚ï¼ˆè¿™é‡Œï¼Œæ²¿ç”¨äº†
variable è¿™ä¸ªåç§°ï¼Œåªæ˜¯æ²¿ç”¨è€Œå·²ï¼Œå…¶å«ä¹‰å®Œå…¨ä¸åŒï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;ä¸è¦åˆ›å»º mutable çš„å¯¹è±¡ã€‚æ‰€æœ‰çš„å¯¹è±¡éƒ½åº”è¯¥æ˜¯ immutable çš„ã€‚ä¸€ç»å®ä¾‹åŒ–ï¼Œå…¶å†…éƒ¨å­—æ®µç»ˆç”Ÿä¸å˜ï¼Œç›´åˆ°å¯¹è±¡é”€æ¯ã€‚ç”¨ Java
è¯­è¨€ä¸ºä¾‹ï¼Œæ‰€æœ‰çš„å®ä¾‹å˜é‡éƒ½åº”è¯¥ä½¿ç”¨ final ä¿®é¥°ï¼Œåªèƒ½åœ¨æ„é€ æ–¹æ³•ä¸­è¿›è¡Œåˆå§‹åŒ–ã€‚è¿™æ ·çš„ç±»å‹ï¼Œåœ¨Javaä¸­å°‘ä¹‹åˆå°‘ï¼Œæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„å°±æ˜¯
String ç±»å‹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸è¦ä½¿ç”¨ mutable çš„é›†åˆã€‚æ‰€æœ‰çš„é›†åˆï¼Œéƒ½å¿…é¡»åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå”¯ä¸€ç¡®å®šå…¶ä¸­çš„å…ƒç´ ã€‚ä¸€ç»åˆ›å»ºï¼Œä¾¿ä¸å¯å¢åŠ ã€æ›¿æ¢æˆ–åˆ é™¤å…ƒç´ ã€‚å¦‚æœéœ€è¦å˜æ›´çš„è¯ï¼Œåªèƒ½åŸºäºç°æœ‰çš„é›†åˆï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å‰¯æœ¬ã€‚è¿™ä¸€ç‚¹åœ¨
Java ä¸­æ¯”è¾ƒå°´å°¬ï¼Œjava.util.collection ä¸­æ ¹æœ¬å°±æ²¡æœ‰è¿™æ ·çš„é›†åˆç±»å‹ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å±€éƒ¨å˜é‡ä¸å¯å˜ï¼Œå®ä¾‹å˜é‡ä¸å¯å˜ï¼ˆå½“ç„¶ï¼Œé™æ€å˜é‡ä¹Ÿä¸å¯å˜ï¼‰ã€é›†åˆä¸å¯å˜ï¼Œè¿™ä¸ªä¹Ÿæ˜¯é¢ è¦†Javaç¨‹åºå‘˜ä¸‰è§‚çš„çº¦æŸï¼Œåœ¨æ­¤è§„åˆ™ä¸‹ï¼Œè¿˜èƒ½å¹²ä»€ä¹ˆå‘¢ï¼Ÿ&lt;&#x2F;p&gt;
&lt;h2 id=&quot;2-3-shi-yong-biao-da-shi-expression-er-fei-yu-ju-statement&quot;&gt;2.3 ä½¿ç”¨è¡¨è¾¾å¼(expression)è€Œéè¯­å¥(statement)&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;code&gt;1 + 2 * 3&lt;&#x2F;code&gt; æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå…¶ååº”äº†ä¸€ä¸ªè®¡ç®—è¿‡ç¨‹ï¼Œå¹¶ä»£è¡¨ç€ä¸€ä¸ªæœ€ç»ˆçš„å€¼ã€‚è€Œ &lt;code&gt;if(flag) a = 1 else a = 0&lt;&#x2F;code&gt;
æ˜¯ä¸€ä¸ªè¯­å¥ï¼Œå®ƒæ²¡æœ‰è¿”å›å€¼ï¼ˆè™½ç„¶éƒ¨åˆ†è¯­è¨€ä¹Ÿå¯èƒ½ç»™å®ƒèµ‹äºˆäº†ä¸€ä¸ªè¿”å›å€¼ï¼‰ï¼Œè€Œæ˜¯æ‰§è¡Œäº†ä¸€æ¬¡èµ‹å€¼æ“ä½œï¼Œäº§ç”Ÿäº†å‰¯ä½œç”¨ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨ Java ä¸­ï¼Œ if-elseï¼Œfor, while, switch, try-catch éƒ½æ˜¯ statementï¼Œå› æ­¤ï¼Œè¿™ä¸€ç‚¹æˆ‘ä»¬åªèƒ½å°†å°±ã€‚ï¼ˆJava14ä¸­ switch å°†æ”¯æŒä½œä¸º
expression ä½¿ç”¨ï¼Œä½†å¥‡æ€ªçš„æ˜¯ï¼Œå…¶å®ƒæ“ä½œè¿˜æ˜¯ä¸æ”¯æŒ expressionï¼Œæ€»æ˜¯å­¦ä¸€ç‚¹ä¸å­¦å®Œå…¨ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code&gt;?:&lt;&#x2F;code&gt; ä¸‰æœ¨è¿ç®—ç¬¦æ¥æ›¿ä»£
if-elseï¼Œä¸è¿‡ä¹Ÿæœ‰å¾ˆå¤šå±€é™ã€‚è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°±åªèƒ½å°†å°±äº†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è€Œåœ¨ Kotlinï¼Œscala ç­‰æ—¶é«¦çš„ç¼–ç¨‹è¯­è¨€é‡Œï¼Œif-else, switch, try-catch, for éƒ½å¯ä»¥ä½œä¸º expression æ¥ä½¿ç”¨ï¼Œå¦‚æœä½ é€‰æ‹©è¿™æ ·çš„è¯­è¨€ï¼Œä½ å°±å¯ä»¥é€‰æ‹©
expressionï¼Œè€Œé¿å…ä½¿ç”¨ statement äº†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä½¿ç”¨ statementï¼Œåˆ™ä¸å¯é¿å…çš„ä¼šç”¨åˆ°èµ‹å€¼æ“ä½œï¼Œè¿™ä¸€ç±»çš„å‰¯ä½œç”¨å°±æ²¡æ³•é¿å…çš„äº†ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çº¦æŸï¼šåªå®¹è®¸å¯¹æ–¹æ³•çš„å±€éƒ¨å˜é‡è¿›è¡Œèµ‹å€¼ï¼Œè€Œä¸è¦å¯¹å¯¹è±¡å­—æ®µï¼ˆå®ä¾‹å˜é‡æˆ–é™æ€å˜é‡ï¼‰è¿›è¡Œèµ‹å€¼ã€‚è¿™ç›¸å½“äºæŠŠ
â€å‰¯ä½œç”¨â€œå±€é™åœ¨æ–¹æ³•å†…éƒ¨ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è€Œåœ¨Kotlinï¼ŒScalaè¿™ç±»æ”¯æŒå®Œæ•´ expression çš„è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸¥æ ¼çš„æ ‡å‡†ï¼Œæœç»èµ‹å€¼è¯­è¨€è¿™ä¸€ç±»å‰¯ä½œç”¨çš„å‡ºç°ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;2-4-jian-dan-hua-liu-cheng&quot;&gt;2.4 ç®€å•åŒ–æµç¨‹&lt;&#x2F;h2&gt;
&lt;p&gt;ç»“æ„åŒ–ç¼–ç¨‹ï¼Œå¼•å…¥äº† if-else, switch ç­‰åˆ†æ”¯æµç¨‹ï¼Œfor&#x2F;whileç­‰å¾ªç¯æµç¨‹ï¼Œå®é™…ä¸šåŠ¡ä¸­ï¼Œè¿™ç±»çš„æµç¨‹è¿˜æ˜¯ä¼šå¸¦æ¥ä¸€å®šçš„å¤æ‚æ€§ï¼Œå°¤å…¶æ˜¯å¤šå±‚åµŒå¥—çš„æƒ…å†µä¸‹ã€‚æ­£å¦‚
Î»æ¼”ç®— çš„ç†è®ºæ¨¡å‹ä¸­ï¼ŒFP åªéœ€è¦å‡½æ•°çš„è°ƒç”¨ï¼Œè€Œæ— éœ€åˆ†æ”¯å’Œå¾ªç¯æµç¨‹çš„ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è¿™é‡Œçš„çº¦å®šé’ˆå¯¹ kotlin, scalaç­‰æ”¯æŒ expression çš„è¯­è¨€ï¼Œå¯¹äº Java, éœ€è¦é…Œæƒ…å‚è€ƒï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨ if-else, for, switch ç­‰expression, è€Œä¸æ˜¯ statementã€‚ï¼ˆæ€è€ƒé¢˜ï¼šif-else expressionå°±ä¸æ˜¯åˆ†æ”¯äº†å—ï¼Ÿï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;é¿å…ä½¿ç”¨ continue, break ç­‰ç ´åæ­£å¸¸æµç¨‹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é¿å…ä½¿ç”¨ return ï¼Œæ­£å¸¸çš„è¯ï¼Œå‡½æ•°åº”è¯¥åœ¨æœ€æœ«ä¸€è¡Œäº§ç”Ÿè¿”å›å€¼ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é¿å… null å€¼ã€‚
&lt;ol&gt;
&lt;li&gt;å¦‚æœæŸä¸ªå˜é‡çš„å€¼å¯èƒ½ä¸º nullï¼Œåˆ™æ”¹å˜ä¸º Option[T]ï¼Œå¹¶ä½¿ç”¨ None æ›¿ä»£ nullã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœæŸä¸ªæ–¹æ³•ï¼Œå¯èƒ½ä¼šè¿”å› nullï¼Œè°ƒæ•´ä¸ºè¿”å› Option[T]&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœæŸä¸ªå­—æ®µçš„å€¼å¯èƒ½ä¼šä¸º nullï¼Œè°ƒæ•´ä¸º Option[T]&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨ filter, map ç­‰æ“ä½œå¤„ç† Optionï¼Œå¯ä»¥é¿å… if&#x2F;else çš„ä½¿ç”¨ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ä¹Ÿæœ‰çš„æ–‡ç« å»ºè®®ï¼Œé¿å…ä½¿ç”¨ Exceptionï¼Œè€Œä½¿ç”¨ Try[T] æ¥æ›¿ä»£ï¼Œä¸è¿‡ï¼Œæˆ‘ä¸ªäººå¹¶ä¸å€¾å‘äºæ­¤ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œ Excpetion æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ª
Monodï¼Œè‡ªç„¶å…·æœ‰ Try[T] çš„ç‰¹æ€§ï¼Œè€Œä¸”å¯è¯»æ€§æ›´é«˜ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸€ä¸ªå¸¸è§çš„æŒ‘æˆ˜æ˜¯ï¼Œä¸ä½¿ç”¨å¯å˜å˜é‡ï¼Œä¸ä½¿ç”¨å¾ªç¯ï¼Œé‚£ä¹ˆå¦‚ä½•å¤„ç†ä¼ ç»Ÿéœ€è¦è¿­ä»£çš„åœºæ™¯å‘¢ï¼Ÿåœ¨FPä¸­ï¼Œé€’å½’è°ƒç”¨å°±æ˜¯FPçš„å¾ªç¯è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥å‚è€ƒ&lt;a href=&quot;https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;e456c27a4366&quot;&gt;ä»ç¤ºä¾‹é€æ¸ç†è§£Scalaå°¾é€’å½’&lt;&#x2F;a&gt;
ä¸€æ–‡ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;2-5-jian-dan-shu-ju-liu&quot;&gt;2.5 ç®€å•æ•°æ®æµ&lt;&#x2F;h2&gt;
&lt;p&gt;åº”ç”¨å‡½æ•°å¼ç¼–ç¨‹ï¼Œå¸¦æ¥çš„ä¸€ä¸ªæœ¬è´¨çš„æ”¹å˜å°±æ˜¯ï¼šç®€å•çš„æ•°æ®æµï¼šè¯·æ±‚å‚æ•°ç•™ç»ä¸€ä¸ªå‡½æ•°ï¼Œè€Œäº§å‡ºä¸€ä¸ªæ–°çš„æ•°æ®ï¼Œæ–°çš„æ•°æ®ç»§ç»­æµåŠ¨ï¼Œç»è¿‡æ–°çš„è®¡ç®—è¿‡ç¨‹ï¼Œäº§ç”Ÿå‡ºæ–°çš„æ•°æ®ï¼Œç›´åˆ°è¾¾æˆæœ€ç»ˆçš„ç»“æœã€‚åŒºåˆ«äºå‘½ä»¤å¼ç¼–ç¨‹ï¼Œè¿™ä¸ªæµåŠ¨æ€»æ˜¯äº§ç”Ÿæ–°çš„æ•°æ®ï¼Œè€Œä¸ä¼šä¿®æ”¹ä»»ä½•å·²ç»å­˜åœ¨çš„æ•°æ®ã€‚&lt;&#x2F;p&gt;
&lt;h3 id=&quot;2-5-1-pipeline&quot;&gt;2.5.1 pipeline&lt;&#x2F;h3&gt;
&lt;p&gt;å¯¹ shell ç”¨æˆ·æ¥è¯´ï¼Œpipeline æ˜¯æœ€ä¸ºç†Ÿæ‚‰çš„ï¼Œè­¬å¦‚å¦‚ä¸‹çš„bashè„šæœ¬ï¼Œæ˜¯ç»Ÿè®¡nginxè®¿é—®æ—¥å¿—ä¸­è®¿é—®é‡æœ€å¤§çš„å‰10åIPï¼ŒåŠå…¶è®¿é—®æ¬¡æ•°ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cat&lt;&#x2F;span&gt;&lt;span&gt; access.log | &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;gawk&lt;&#x2F;span&gt;&lt;span&gt; â€˜{print $&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;}â€™ | &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sort &lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;uniq -c &lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sort -rn &lt;&#x2F;span&gt;&lt;span&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;tail -10
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å¯ä»¥è¿™ä¹ˆæ¥ç†è§£ä¸€ä¸ª pipelineï¼šæ¯ä¸ªstepç›¸å½“äºä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸Šä¸€ä¸ª step çš„è¾“å‡ºï¼Œå¤„ç†å®Œæˆåï¼Œå½¢æˆæ–°çš„è®¡ç®—ç»“æœï¼Œå†è¾“å‡ºåˆ°ä¸‹ä¸€ä¸ª
Stepã€‚Stepä¹‹é—´æ”¶å°¾ç›¸è¿ï¼Œæ•°æ®ä¾æ¬¡ä»Step1ã€Step2ã€ç›´åˆ°æœ€åã€‚è¿™å…¶å®ç›¸å½“äºä¸€ç³»åˆ—çš„å‡½æ•°ç»„åˆè°ƒç”¨ã€‚&lt;&#x2F;p&gt;
&lt;h3 id=&quot;2-5-2-dan-xiang-wu-huan-shu-ju-liu-dag&quot;&gt;2.5.2 å•å‘æ— ç¯æ•°æ®æµ DAG&lt;&#x2F;h3&gt;
&lt;p&gt;pipeline æ˜¯ä¸€ç§æœ€ç®€å•ã€æœ€æ¸…æ™°çš„æ•°æ®æµï¼Œæ²¡æœ‰åˆ†æ”¯ï¼Œæ²¡æœ‰åˆå¹¶ï¼Œä½†å®é™…åœºæ™¯ä¸‹ï¼Œæ•°æ®æµå‘è¿˜æ˜¯ä¼šæ›´å¤æ‚ä¸€äº›ã€‚æœ‰å¦‚æ²³æµå…¥æµ·ï¼Œæœ‰ä¸»å¹²æ²³é“ï¼Œä¹Ÿæœ‰ä¼—å¤šåˆ†æ”¯çš„æ²³é“ï¼Œæœ€åä¸»å¹²ã€æ”¯æµæ±‡èšæˆæ±Ÿï¼Œä¸œå¥”å¤§æµ·ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸å‘½ä»¤å¼è¯­è¨€ä¸é€šï¼ŒFPä¸‹çš„æ•°æ®æµå¿…é¡»æ˜¯å•å‘æ— ç¯è·¯çš„ï¼Œä¸€ä¸ªå‡½æ•°ä¸èƒ½ä¾èµ–è¿™ä¸ªå‡½æ•°æ‰§è¡Œä¹‹åäº§ç”Ÿçš„æ•°æ®ã€‚è¿™æ ·çš„æ•°æ®æµï¼Œæœ€ç»ˆä¼šå½¢æˆä¸€ä¸ª
DAGã€‚æ•°æ®ä¸€æ—¦å½¢æˆå›è·¯ï¼Œå¸¦æ¥çš„å¤æ‚æ€§ï¼ŒåŒ…æ‹¬ï¼šéš¾ä»¥ç†è§£ï¼Œéš¾ä»¥æ¨ç†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å½“ç„¶ï¼Œä¼šæœ‰ä¸€äº›å…¶å®ƒçš„æ¨¡å¼ï¼Œè®©æ•´ä¸ªæ•°æ®æµå˜å¾—æ›´åŠ ç®€å•ä¸€äº›ï¼Œä¾‹å¦‚ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å±‚æ¬¡åŒ–ã€‚ å¯¹å¤æ‚çš„æ•°æ®æµè¿›è¡Œå±‚æ¬¡åˆ’åˆ†ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ¨¡å—åŒ–ã€‚å°†DAGçš„éƒ¨åˆ†èŠ‚ç‚¹è¿›è¡Œèšåˆï¼Œç®€åŒ–èŠ‚ç‚¹ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è¿™ä¸ªè¿‡ç¨‹éœ€è¦ç»“åˆä¸šåŠ¡ï¼Œå½¢æˆç»éªŒã€‚åç»­å¯ä»¥æ•´ç†æˆä¸ºå‚è€ƒçš„â€œæ¨¡å¼â€ã€‚ä½†æ€»çš„è€Œè¨€ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®© DAG å˜å¾—æ›´åŠ ç®€å•ï¼Œæ›´æ˜“äºç†è§£ï¼Œæ›´æ–¹ä¾¿æ¨ç†éªŒè¯ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;2-6-ge-chi-fu-zuo-yong&quot;&gt;2.6 éš”ç¦»å‰¯ä½œç”¨&lt;&#x2F;h2&gt;
&lt;p&gt;çº¯å‡½æ•°åªè¿”å›è®¡ç®—ç»“æœï¼Œä½†æˆ‘ä»¬çš„æœ€ç»ˆç›®çš„éƒ½æ˜¯è¦â€œæ”¹å˜ä¸–ç•Œâ€ï¼šæˆ–è€…æ›´æ–°é“¶è¡Œè´¦æˆ·çš„ä½™é¢ï¼Œæˆ–è€…å‘é€ä¸€ä¸ªç”µå­é‚®ä»¶é€šçŸ¥ï¼Œæˆ–è€…åœ¨å±å¹•ä¸Šæ˜¾ç¤ºä¸€ä¸ªæŠ¥è¡¨ï¼Œè¿™äº›éƒ½æ˜¯FPæ„ä¹‰ä¸Šçš„â€œeffectâ€ï¼Œåœ¨å‡½æ•°ç»“æŸä¹‹åä¾ç„¶å­˜åœ¨çš„å½±å“ã€‚ç°å®çš„ç¨‹åºæœ€ç»ˆä¾ç„¶ä¼šäº§ç”Ÿ
effectï¼Œå¹¶ä¸”ä»¥äº§ç”Ÿæœ€ç»ˆçš„ ã€æ­£ç¡®çš„ effect ä¸ºç»ˆæç›®æ ‡ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;FP
çš„ç›®çš„ä¸æ˜¯æ²¡æœ‰effectï¼Œä¸æ˜¯æ¶ˆé™¤effectï¼Œè€Œæ˜¯éš”ç¦»effectï¼Œå°†ç¨‹åºä¸­çš„é€»è¾‘è®¡ç®—å’Œç»“æœè½åœ°è¿›è¡Œåˆ†ç¦»ï¼Œè®©é€»è¾‘è®¡ç®—æ›´ä¸ºçº¯ç²¹ï¼Œå¸¦æ¥æ›´å¼ºçš„ç»„åˆèƒ½åŠ›ï¼Œæ›´æ¸…æ™°çš„æ•°æ®æµï¼Œè®©é€»è¾‘å¯ä»¥è‡ªæˆ‘è¯æ˜ã€‚éš”ç¦»ä¹‹åçš„å‰¯ä½œç”¨æ“ä½œï¼Œå°±æ˜¯â€œè§£é‡Šâ€é€»è¾‘è®¡ç®—çš„ç»“æœï¼Œå®Œæˆè½åœ°è¿‡ç¨‹ï¼Œå› è€Œæ›´ä¸ºå†…èšï¼ˆè€Œä¸æ˜¯åˆ†æ•£åœ¨å¤„ç†çš„å››å¤„ï¼‰ã€æ›´ä¸ºç®€å•ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a href=&quot;https:&#x2F;&#x2F;zio.dev&#x2F;docs&#x2F;overview&#x2F;overview_background&quot;&gt;å‡½æ•°å¼è®¡ç®—ä¸­çš„å‰¯ä½œç”¨&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;h3 id=&quot;2-6-1-ji-suan-jie-shi-mo-xing&quot;&gt;2.6.1 è®¡ç®—-è§£é‡Šæ¨¡å‹&lt;&#x2F;h3&gt;
&lt;p&gt;è®¡ç®—-è§£é‡Šæ¨¡å‹æ˜¯æœ€ç®€å•çš„å‰¯ä½œç”¨éš”ç¦»ï¼Œå…¶åŸºæœ¬é€»è¾‘å¦‚ä¸‹ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;scala 3&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-scala 3 &quot;&gt;&lt;code class=&quot;language-scala 3&quot; data-lang=&quot;scala 3&quot;&gt;&lt;span&gt;def service(request: Request): Response = {
&lt;&#x2F;span&gt;&lt;span&gt;    def logic(): ActionModel = {
&lt;&#x2F;span&gt;&lt;span&gt;        &#x2F;&#x2F; ...... pure function code which return an ActionModel
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    def interpret(actionModel: ActionModel): Unit = {
&lt;&#x2F;span&gt;&lt;span&gt;        &#x2F;&#x2F; ......  execute the actions such as insert an entity, send an email, etc.
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    logic() -&amp;gt; interpret()
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è€ƒè™‘åˆ° &lt;code&gt;logic()&lt;&#x2F;code&gt; ä¸­ä¾èµ–ç€å¯¹æ•°æ®åº“ç­‰çš„ä¸€äº›ä¾èµ–ï¼ˆå­˜åœ¨ç€æŸç§ Input çš„æ“ä½œï¼‰ï¼Œå› æ­¤ï¼Œä¹Ÿå¯ä»¥è°ƒæ•´ä¸º &lt;code&gt;å‡†å¤‡-è®¡ç®—-è§£é‡Šæ¨¡å‹&lt;&#x2F;code&gt;ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;scala&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-scala &quot;&gt;&lt;code class=&quot;language-scala&quot; data-lang=&quot;scala&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;service&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;request&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Request&lt;&#x2F;span&gt;&lt;span&gt;): &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Response &lt;&#x2F;span&gt;&lt;span&gt;= {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;fetch&lt;&#x2F;span&gt;&lt;span&gt;(): &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;InitialModel &lt;&#x2F;span&gt;&lt;span&gt;= {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ......  read only operation, fetch required information into InitialModel
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;logic&lt;&#x2F;span&gt;&lt;span&gt;(): &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;ActionModel &lt;&#x2F;span&gt;&lt;span&gt;= {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ...... &#x2F;&#x2F; pure function code which return an ActionModel
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;interpret&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;actionModel&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;ActionModel&lt;&#x2F;span&gt;&lt;span&gt;): &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;Unit &lt;&#x2F;span&gt;&lt;span&gt;= {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; ...... &#x2F;&#x2F; execute the actions such as insert an entity, send an email, etc.
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    fetch() -&amp;gt; logic() -&amp;gt; interpret()
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å¯¹äº‹åŠ¡ç±»æœåŠ¡è€Œè¨€ï¼ŒæŸ¥è¯¢ç±»æœåŠ¡å’Œå¤§éƒ¨åˆ†çš„å•äº‹åŠ¡ç±»æœåŠ¡ï¼Œéƒ½å¯ä»¥ç®€åŒ–ä¸º &lt;code&gt;è®¡ç®—-è§£é‡Šæ¨¡å‹&lt;&#x2F;code&gt;ï¼Œè¿™ç§æŠ½è±¡ä¼šå¸¦æ¥å¦‚ä¸‹çš„å¥½å¤„ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å°†å‰¯ä½œç”¨æå–ã€èšåˆåˆ°ä¸€ä¸ªè§£é‡Šå‡½æ•°ä¸­ï¼Œå–ä»£åˆ†æ•£åœ¨ä¸šåŠ¡é€»è¾‘çš„æ–¹å¼ï¼ŒæœåŠ¡çš„ç›®çš„æ€§éå¸¸æ˜ç¡®ï¼Œæ˜“äºç†è§£ä»£ç ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;éš”ç¦»å‰¯ä½œç”¨åçš„ä¸šåŠ¡é€»è¾‘ï¼Œæˆä¸ºä¸€ä¸ªçº¯å‡½æ•°ï¼Œå¯ä»¥æ›´å¥½çš„å®ç°ä»£ç çš„å¤ç”¨ï¼Œæ›´ä¾¿äºè¿›è¡Œå•å…ƒæµ‹è¯•ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;åœ¨æœ‰çš„äº‹åŠ¡ç±»å¤„ç†ä¸­ï¼Œä¼šæœ‰é”å®šèµ„æºçš„éœ€æ±‚ï¼Œå¦‚æ‰£å‡è´¦æˆ·ä½™é¢ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ fetch
é˜¶æ®µï¼Œå¯¹éœ€è¦é”å®šçš„èµ„æºæ–½åŠ é”å®šæ“ä½œã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠâ€œlock&quot; è¿™æ ·çš„æ“ä½œï¼Œä¹Ÿè§†ä¸ºä¸€ç§â€œä½å±å®³å‰¯ä½œç”¨â€ï¼Œå› ä¸ºå…¶æœ¬è´¨ä¸Šä¸ä¿®æ”¹æ•°æ®ï¼Œå®¹æ˜“å›é€€ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¼€å‘çº¦å®šï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åŒºåˆ†è®¡ç®—ä¸å‰¯ä½œç”¨ï¼Œä¸šåŠ¡é€»è¾‘åº”è¯¥é›†ä¸­åœ¨&lt;code&gt;è®¡ç®—&lt;&#x2F;code&gt;ä¹‹ä¸­ï¼Œä¿æŒ&lt;code&gt;è§£é‡Š&lt;&#x2F;code&gt;çš„ç®€å•æ€§ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ä¿æŒè®¡ç®—æ˜¯çº¯å‡½æ•°çš„ï¼Œå…·å¤‡å¼•ç”¨é€æ˜æ€§ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é¿å…åœ¨è§£é‡Šä¸­åŒ…æ‹¬ä¸šåŠ¡é€»è¾‘ï¼Œåªè§£é‡Šæ‰§è¡Œè®¡ç®—çš„ç»“æœï¼Œå®Œæˆæ•°æ®è½åœ°ã€‚å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;é¿å…åœ¨è§£é‡Šé˜¶æ®µä¾èµ– &lt;code&gt;insert&lt;&#x2F;code&gt; æ“ä½œè¿”å›çš„è‡ªå¢ IDï¼Œæ›¿ä»£æ–¹æ¡ˆæ˜¯ï¼šé€šè¿‡å…¨å±€çš„ id æœåŠ¡è·å–idï¼Œåœ¨ insert è¯­å¥ä¸­æ˜¾ç¤ºèµ‹å€¼ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é¿å…åœ¨è§£é‡Šé˜¶æ®µä¾èµ– &lt;code&gt;update&lt;&#x2F;code&gt; è¯­å¥æ˜¯å¦ä¼šå‘½ä¸­æ•°æ®ï¼Œæ›¿ä»£æ–¹æ¡ˆæ˜¯ï¼šåœ¨ fetch é˜¶æ®µæ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å‘½åçº¦å®š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹æœ‰å‰¯ä½œç”¨çš„æ–¹æ³•ï¼Œä½¿ç”¨ &lt;code&gt;doXXX&lt;&#x2F;code&gt; å‘½åã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ··åˆæ–¹æ³•ï¼ˆå³ä¸²è”èµ·è®¡ç®— å’Œ è§£é‡Šçš„æ–¹æ³•ï¼‰ï¼Œåº”ä½œä¸ºæœåŠ¡çš„æœ€å¤–å±‚æ–¹æ³•ï¼ˆå¤æ‚çš„æ–¹æ³•ï¼Œå¯ä»¥æ”¾å®½åˆ°ç¬¬äºŒå±‚çš„æ–¹æ³•ï¼‰ï¼Œæ··åˆæ–¹æ³•ä½¿ç”¨
&lt;code&gt;@effect&lt;&#x2F;code&gt;è¿›è¡Œæ ‡è¯†ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨æ··åˆæ–¹æ³•ä¸­ï¼Œä½¿ç”¨&lt;code&gt;DoEffects!&lt;&#x2F;code&gt;è¿›è¡Œä»£ç é›†ä¸­æ ‡è¯†æœ‰å‰¯ä½œç”¨çš„ä»£ç å—ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;pre data-lang=&quot;scala 3&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-scala 3 &quot;&gt;&lt;code class=&quot;language-scala 3&quot; data-lang=&quot;scala 3&quot;&gt;&lt;span&gt;    def service() = 
&lt;&#x2F;span&gt;&lt;span&gt;        calculation_1 &#x2F;&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;        DoEffects_! {   
&lt;&#x2F;span&gt;&lt;span&gt;            &#x2F;&#x2F; ... ...  åœ¨ DoEffects! ä»£ç å—ä¸­è¿›è¡Œå‰¯ä½œç”¨å¤„ç†ï¼Œå¦‚å‘é€é‚®ä»¶ï¼Œä¿®æ”¹æ•°æ®åº“ã€‚
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;        calculation_2 &#x2F;&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;        DoEffects_! { 
&lt;&#x2F;span&gt;&lt;span&gt;            &#x2F;&#x2F; ... ...  åœ¨ DoEffects! ä»£ç å—ä¸­è¿›è¡Œå‰¯ä½œç”¨å¤„ç†ï¼Œå¦‚å‘é€é‚®ä»¶ï¼Œä¿®æ”¹æ•°æ®åº“ã€‚ 
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h3 id=&quot;2-6-2-duo-jie-duan-di-jin-mo-xing&quot;&gt;2.6.2  å¤šé˜¶æ®µé€’è¿›æ¨¡å‹&lt;&#x2F;h3&gt;
&lt;pre data-lang=&quot;scala 3&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-scala 3 &quot;&gt;&lt;code class=&quot;language-scala 3&quot; data-lang=&quot;scala 3&quot;&gt;&lt;span&gt;def service(request: Request): Response = {
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &#x2F;&#x2F; phase1
&lt;&#x2F;span&gt;&lt;span&gt;    phase1Fetch() -&amp;gt; phase1Logic() -&amp;gt; phase1Interpret()
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    phase2Fetch() -&amp;gt; phase2Logic() -&amp;gt; phase2Interpret() &#x2F;&#x2F; based on phase1â€™s result
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    phase3Fetch() -&amp;gt; phase3Logic() -&amp;gt; phase3Interpret() &#x2F;&#x2F; based on phase1 &amp;amp; phase2â€™s result
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å¦‚æœ&lt;code&gt;é˜¶æ®µN&lt;&#x2F;code&gt;çš„å¤„ç†éœ€è¦ä¾èµ–&lt;code&gt;é˜¶æ®µN-1&lt;&#x2F;code&gt;æˆ–è€…æ›´æ—©ä¹‹å‰çš„å‰¯ä½œç”¨å¤„ç†ç»“æœï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°†æ— æ³•å®Œå…¨çš„éµå®ˆ&lt;code&gt;è®¡ç®—-è§£é‡Š&lt;&#x2F;code&gt;
æ¨¡å‹ï¼Œé‚£ä¹ˆï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥éµå®ˆçº¦å®šï¼Œè®©ä»£ç çš„å¯è¯»æ€§å˜å¾—æ›´å¼ºï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å°†å‰¯ä½œç”¨å¤„ç†é›†ä¸­åˆ°æœåŠ¡çš„é¡¶å±‚ä¸»æµç¨‹ä»£ç ä¸­&lt;&#x2F;strong&gt;ã€‚é¿å…å°†å‰¯ä½œç”¨ä»£ç åˆ†æ•£ï¼Œå°¤å…¶æ˜¯ä¸‹æ²‰åˆ°å¾ˆä½å±‚çš„ä¸šåŠ¡ä»£ç ä¹‹ä¸­ï¼Œä¼šè®©æœåŠ¡çš„ä¸»é€»è¾‘å˜å¾—ä¸æ˜æ™°ï¼Œå¢åŠ å¤æ‚åº¦ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨ doXXXX æˆ–è€… DOEffects! çº¦å®š&lt;&#x2F;strong&gt;ã€‚è®©å‰¯ä½œç”¨ä»£ç é˜…è¯»èµ·æ¥æ›´ä¸ºæ˜æ˜¾ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç”±äºæ‰§è¡Œå‰¯ä½œç”¨æœ¬èº«ä¼šå¸¦æ¥æ›´å¤šçš„å¼‚å¸¸æƒ…å†µï¼Œå› æ­¤ï¼Œåœ¨ä¸»æµç¨‹ä¸­é›†ä¸­å¤„ç†å¼‚å¸¸ï¼Œä¼šè®©å¼‚å¸¸æ›´ä¸ºæ¸…æ™°ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;åœ¨æ•°æ®åº“äº‹åŠ¡ç±»åº”ç”¨ä¸­ï¼Œé™¤éå¤šé˜¶æ®µçš„å¤„ç†éœ€è¦åœ¨å¤šä¸ªäº‹åŠ¡ä¸­å®Œæˆï¼ˆå¦‚å› ä¸ºé¢†åŸŸéš”ç¦»åŸå› ï¼‰ï¼Œå¦åˆ™æˆ‘ä»¬åº”å°½å¯èƒ½ä½¿ç”¨&lt;code&gt;è®¡ç®—-è§£é‡Šæ¨¡å‹&lt;&#x2F;code&gt;
ï¼Œåœ¨è®¡ç®—é˜¶æ®µå°½å¯èƒ½çš„ç¡®å®šé€»è¾‘ï¼Œè€Œä¸è¦è¿‡äºä¾èµ–â€œå‰¯ä½œç”¨æ‰§è¡Œâ€æ—¶çš„ç»“æœã€‚&lt;&#x2F;p&gt;
&lt;h3 id=&quot;2-6-3-tcc-mo-xing&quot;&gt;2.6.3 TCC æ¨¡å‹&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;code&gt;è®¡ç®—-è§£é‡Šæ¨¡å‹&lt;&#x2F;code&gt; éå¸¸é€‚åˆäºå•äº‹åŠ¡ç±»çš„å¤„ç†ï¼Œä½†å¯¹äºå¤šäº‹åŠ¡ï¼Œæˆ–è€…è¯´åˆ†å¸ƒå¼äº‹åŠ¡çš„åœºæ™¯æ—¶ï¼Œä¼šæœ‰äº›åŠ›ä¸ä»å¿ƒã€‚è­¬å¦‚ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;scala&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-scala &quot;&gt;&lt;code class=&quot;language-scala&quot; data-lang=&quot;scala&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;service
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;val &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;resp_a &lt;&#x2F;span&gt;&lt;span&gt;= service_a(req_a)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;(resp_a) {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;val &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;resp_b &lt;&#x2F;span&gt;&lt;span&gt;= service(req_b)
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;éœ€è¦æ ¹æ®ç¬¬ä¸€ä¸ªäº‹åŠ¡å¤„ç†çš„ç»“æœï¼Œæ¥å†³å®šç¬¬äºŒä¸ªäº‹åŠ¡çš„æ‰§è¡Œæƒ…å†µï¼Œåœ¨æ‰§è¡Œäº‹åŠ¡äºŒä¹‹å‰ï¼Œå¿…é¡»è¦å…ˆæäº¤äº‹åŠ¡ä¸€çš„æ‰§è¡Œç»“æœï¼Œå³æ‰§è¡Œäº‹åŠ¡ä¸€çš„å‰¯ä½œç”¨ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä½¿ç”¨ TCC æ¨¡å‹æ—¶ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;Try&lt;&#x2F;code&gt; å¤„ç†è´Ÿè´£é”å®šæœåŠ¡æ‰€éœ€çš„æœ€å°‘èµ„æºï¼Œè¿™ä¸ªæ“ä½œå­˜åœ¨å‰¯ä½œç”¨ï¼Œä½†æä¾›äº†ä¸€ç§å¯é€†çš„æ–¹å¼ã€‚å› è€Œå¯è§†ä¸º&lt;em&gt;æ— å®³çš„å‰¯ä½œç”¨&lt;&#x2F;em&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;Confirm&lt;&#x2F;code&gt; ç”±ä¸»æµç¨‹è£å†³ï¼Œåœ¨å†³å®šæäº¤äº‹åŠ¡æ—¶ï¼Œå†ä¾æ¬¡è°ƒç”¨å¤šä¸ªå­æ“ä½œçš„ &lt;code&gt;confirm&lt;&#x2F;code&gt;ï¼Œ è¿™ä¸€æ­¥ç›¸å½“äº&lt;em&gt;æ‰§è¡Œå‰¯ä½œç”¨&lt;&#x2F;em&gt;çš„æ“ä½œã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;Cancel&lt;&#x2F;code&gt;ç”±ä¸»æµç¨‹è£å†³ï¼Œåœ¨å†³å®šäº‹åŠ¡å›æ»šæ—¶ï¼Œå†ä¾æ¬¡è°ƒç”¨å¤šä¸ªå­—æ“ä½œçš„&lt;code&gt;cancel&lt;&#x2F;code&gt;ï¼Œè¿™ä¸€æ­¥ç›¸å½“äº&lt;em&gt;æ‰§è¡Œå›æ»šå‰¯ä½œç”¨&lt;&#x2F;em&gt;çš„æ“ä½œã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;é€šè¿‡TCCæ¨¡å‹çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥ä¸€ç§æ¥è¿‘äº&lt;em&gt;éš”ç¦»å‰¯ä½œç”¨&lt;&#x2F;em&gt;çš„æ•ˆæœçš„æ–¹å¼ï¼Œæ¥å®ç°å¤æ‚åœºæ™¯ä¸‹çš„é€»è¾‘éš”ç¦»ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;3-fp-wu-chu-bu-zai&quot;&gt;3. FP æ— å¤„ä¸åœ¨&lt;&#x2F;h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Linux Shell &amp;amp; FP&lt;&#x2F;p&gt;
&lt;p&gt;æ­£å¦‚ä¸Šæ–‡ä¸­çš„ pipeline ç¤ºä¾‹ï¼Œ pipeline æ„å»ºäº† Shell çš„å¼ºå¤§ä¹‹å¤„ï¼Œä¹Ÿå¯ä»¥ä½œä¸º FP æˆåŠŸçš„ä¸€ä¸ªå…¸å‹æ¡ˆä¾‹ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;æ¯ä¸ªLinuxå‘½ä»¤ï¼Œéƒ½èšç„¦äºè§£å†³å•ä¸ªé—®é¢˜ã€‚è¿™ç›¸å½“äºç¼–å†™æ›´å…·å†…èšçš„å‡½æ•°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Shell ä½¿ç”¨ç®€å•çš„æ–‡æœ¬è¡Œ &lt;code&gt;Line&lt;&#x2F;code&gt; ä½œä¸ºæ ‡å‡†çš„æ•°æ®æ ¼å¼ï¼Œä½œä¸ºç®¡é“äº¤æ¢çš„æ•°æ®æ ‡å‡†ã€‚è¿™ä¸ªç®€å•çš„ç­–ç•¥è®©æ‰€æœ‰çš„å‘½ä»¤éƒ½å¯ä»¥ä¸²è”èµ·æ¥ï¼Œå®Œæˆäº’æ“ä½œã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è¿™ä¹Ÿç»™æˆ‘ä»¬å¾ˆå¤šè‰¯å¥½çš„ FP ç¼–ç¨‹å¯ç¤ºï¼š
3. å‡½æ•°è®¾è®¡åº”éµå®ˆ&lt;code&gt;Single Responsibility Principle&lt;&#x2F;code&gt;ï¼Œå†…èšæ€§è¶Šå¼ºçš„å‡½æ•°ã€åŠŸèƒ½è¶Šå•ä¸€çš„å‡½æ•°ï¼Œä¸ä»…å®ç°æˆæœ¬æ›´ä½ï¼Œå…¶å¯ç»„åˆèƒ½åŠ›ä¹Ÿæ›´å¼ºã€‚
4. åŸºäºæ ‡å‡†åŒ–çš„æ•°æ®ç»“æ„ã€‚ä¾¿äºå‡½æ•°é—´çš„äº’ç›¸ç»„åˆã€‚å¦‚æœåœ¨æ¯æ¬¡å‡½æ•°ç»„åˆæ—¶ï¼Œéƒ½éœ€è¦è¿›è¡Œæ•°æ®çš„è½¬æ¢ï¼Œè¿™æ ·ä»£ç çš„è‡ªç”±åº¦å°±ä¼šå¤§æ‰“æŠ˜æ‰£ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;SQL &amp;amp; FP&lt;&#x2F;p&gt;
&lt;p&gt;æˆ‘ä»¬æœ€ä¸ºç†Ÿæ‚‰çš„SQLï¼Œå…¶å®ä¹Ÿç®—æ˜¯ä¸€ç§ FP çš„æ€æƒ³ï¼Œä¹Ÿè¢«ç§°ä¹‹ä¸º &lt;code&gt;Declarative Programming&lt;&#x2F;code&gt;ï¼ˆå£°æ˜å¼ç¼–ç¨‹ï¼‰ï¼Œå…¶å®è¿™ä¹Ÿæ˜¯ FP
çš„ç‰¹å¾ã€‚å¦‚æœè¯´å‘½ä»¤å¼è¯­è¨€å…³æ³¨äº&lt;code&gt;how to do&lt;&#x2F;code&gt;ï¼Œé‚£ä¹ˆFP åˆ™å…³æ³¨äº &lt;code&gt;what to do&lt;&#x2F;code&gt;ï¼Œå¯¹æ¯”ä¸€ä¸‹å¦‚ä¸‹çš„ä»£ç ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;csharp&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-csharp &quot;&gt;&lt;code class=&quot;language-csharp&quot; data-lang=&quot;csharp&quot;&gt;&lt;span&gt;    int[] array = { 1, 5, 2, 10, 7 };
&lt;&#x2F;span&gt;&lt;span&gt;    var results = from x in array
&lt;&#x2F;span&gt;&lt;span&gt;        where x % 2 == 1  
&lt;&#x2F;span&gt;&lt;span&gt;        orderby x descending   
&lt;&#x2F;span&gt;&lt;span&gt;        select x * x;        
&lt;&#x2F;span&gt;&lt;span&gt;    foreach (var result in results)     {      
&lt;&#x2F;span&gt;&lt;span&gt;         Console.WriteLine(result);   
&lt;&#x2F;span&gt;&lt;span&gt;    } 
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ä¸Šé¢çš„ä»£ç æ˜¯æ”¯æŒ LINQ è¯­æ³•çš„C#ï¼Œåœ¨scalaä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„æ–¹å¼ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;scala&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-scala &quot;&gt;&lt;code class=&quot;language-scala&quot; data-lang=&quot;scala&quot;&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;val &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;array &lt;&#x2F;span&gt;&lt;span&gt;= Array(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;7&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;val &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;results &lt;&#x2F;span&gt;&lt;span&gt;= array.filter(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;_&lt;&#x2F;span&gt;&lt;span&gt; % &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2 &lt;&#x2F;span&gt;&lt;span&gt;== &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;        .sortedBy ( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt; - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;_ &lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;        .map( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;x &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt;&lt;span&gt; x * x)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨ Java æ¥ç¼–å†™ï¼Œä¼šé•¿ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿå¤§å®¶å¯ä»¥ä»è¿™ä¸ªæ¡ˆä¾‹æ¥ç†è§£ä¸€ä¸‹ FP çš„ &lt;code&gt;å£°æ˜å¼ç¼–ç¨‹&lt;&#x2F;code&gt;
ç‰¹ç‚¹ã€‚å£°æ˜å¼ç¼–ç¨‹çš„ä¸€ä¸ªæœ€å¤§çš„ä¸åŒåœ¨äºï¼Œä»–çš„æ¯ä¸€è¡Œä»£ç æ›´èšç„¦äºæè¿°ä»£ç çš„ç›®çš„ï¼ˆé¢å‘é˜…è¯»è€…ï¼‰ï¼Œè€Œä¸æ˜¯èšç„¦äºâ€æ€ä¹ˆåšâ€œï¼Ÿ&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;CQRS &amp;amp; FP
&lt;code&gt;Command Query Responsibility Segregation&lt;&#x2F;code&gt; æ˜¯ä¸€ç§é¢å‘é¢†åŸŸå¤æ‚æ€§çš„è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡åŒºåˆ† Commandã€Queryï¼Œä½¿ç”¨ Event Sourcing
æ¥æè¿° Command çš„ç»“æœï¼Œé¿å…å¯¹æ•°æ®è¿›è¡Œ mutable çš„æ“ä½œã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Event Sourcing æ¨¡å¼é¿å…äº†å¯¹ Entity çš„ç›´æ¥ä¿®æ”¹ï¼Œè€Œ Event æœ¬èº«æ˜¯ immutable çš„ï¼Œè¿™ä¸ FP çš„æ•°æ®ä¸å¯å˜æ€æƒ³ä¸€è‡´ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Entity Snapshot = f ( events )ã€‚å¯ä»¥æ ¹æ®ä¸åŒçš„éœ€æ±‚ã€åœºæ™¯ã€è§†è§’ï¼Œå»ºç«‹ä¸åŒçš„ snapshotã€‚è¿™æ˜¯ä¸€ä¸ª Pure çš„æ“ä½œã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å¤§æ•°æ®å¤„ç† &amp;amp; FPï¼ˆFlinkã€Sparkã€Kafka Streamã€Akka Streamï¼‰
ä» Map-Reduce å¼€å¯å¤§æ•°æ®å¤„ç†æ—¶ä»£å¼€å§‹ï¼Œæ–°çš„å¤§æ•°æ®å¤„ç†æ¡†æ¶ï¼Œå¦‚ Sparkã€Flink ç­‰éƒ½é‡‡ç”¨äº† FP çš„æ€æƒ³ã€‚ä¸æ™®é€šçš„ FP
ä¸åŒï¼Œè¿™ç±»æ¶æ„ä¼šåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç¯å¢ƒä¸‹ï¼Œç¼–æ’å‡ºä¸€ä¸ªåˆ†å¸ƒå¼çš„ Data Flow Topologyï¼Œå¹¶æä¾›åŒ…æ‹¬ back presureã€checkpoint
ç­‰æœºåˆ¶ã€‚ä½†å…¶æ ¸å¿ƒæ€æƒ³ï¼Œä»ç„¶æ˜¯æ•°æ®æµå›¾ï¼Œè¿™ä¸ªå’Œ FP çš„æ€æƒ³æ˜¯å®Œå…¨å»åˆçš„ï¼Œå› æ­¤ï¼Œå¤§éƒ¨åˆ†çš„å¤§æ•°æ®å¤„ç†æ¡†æ¶æä¾›çš„éƒ½æ˜¯ FP çš„APIã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;React &amp;amp; FP
ä¼ ç»Ÿæ„ä¹‰ä¸Šï¼ŒUIå¹¶ä¸é€‚åˆäºFPï¼Œå› ä¸º UI æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªé«˜åº¦ mutable çš„åœºæ™¯ï¼Œä»»ä½•ä¸€ä¸ªäº¤äº’äº‹ä»¶ï¼Œå¦‚é¼ æ ‡ã€é”®ç›˜ï¼Œæˆ–è€…æ—¶é’Ÿäº‹ä»¶ï¼Œéƒ½ä¼šå¯¼è‡´
UI å…ƒç´ çš„å·¨å¤§å˜åŒ–ã€‚æ— è®ºæ˜¯ä¸€ä¸ª Widget Treeï¼Œè¿˜æ˜¯ä¸€ä¸ª DOM Treeï¼Œè¿™ç§å˜åŒ–æ€»æ˜¯æ— æ³•é¿å…çš„ã€‚è€Œ FP å€¾å‘äº immutable
çš„æ€ç»´æ¨¡å‹ï¼Œå› æ­¤ï¼Œä¼ ç»Ÿæ„ä¹‰ä¸Šï¼ŒFP å¹¶ä¸é€‚ç”¨äº UI å¼€å‘ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸è¿‡ï¼ŒReact è¿™ä¸ªéå¸¸æµè¡Œçš„æ¡†æ¶ï¼Œä»WEBå¼€å‘ï¼Œå»¶å±•åˆ° React Native è¿›è¡ŒAPPçš„å¼€å‘ï¼ŒçŸ­çŸ­çš„æ•°å¹´æ—¶é—´ï¼Œå·²æˆä¸ºäº†æœ€å—æ¬¢è¿çš„å‰ç«¯å¼€å‘æ¶æ„ã€‚å¾ˆå¤šæœ€æ–°çš„å‰ç«¯å¼€å‘æ¶æ„ï¼Œä¾‹å¦‚
LitElementï¼ˆa WebComponents libraryï¼‰ã€Flutterã€å¾®ä¿¡å°ç¨‹åºç­‰ï¼Œéƒ½é‡‡ç”¨äº†äº React ç›¸ä¼¼çš„æ–¹å¼ï¼šæ„å»º VDOMï¼Œå¹¶é€šè¿‡ diff - patch
ç®—æ³•å®Œæˆ DOM çš„æ›´æ–°ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¼•å…¥ VDOM åï¼Œ VDOM. = f ( states )
ï¼Œè¿™æ˜¯ä¸€ä¸ªçº¯ç²¹çš„å‡½æ•°è®¡ç®—ï¼Œæ˜¯æ²¡æœ‰å‰¯ä½œç”¨ï¼Œå½“ä»»ä½•çŠ¶æ€å˜åŒ–åï¼Œæˆ‘ä»¬åªéœ€è¦é‡æ–°åº”ç”¨å‡½æ•°å°±å¯ä»¥å¾—åˆ°æœ€æ–°çš„VDOMï¼Œè€Œæ— éœ€æ ¹æ®å½“å‰çš„çŠ¶æ€ï¼Œè®¡ç®—å‡ºç•Œé¢æ‰€éœ€è¦çš„å˜åŒ–ï¼ˆÎ”ã€æˆ–è€…å¢é‡å˜åŒ–ï¼‰ã€‚æ€»æ˜¯è¿›è¡Œä¸€æ¬¡å®Œæ•´çš„
VDOM è®¡ç®—ï¼Œç›¸æ¯”æ ¹æ®å½“å‰çŠ¶æ€è®¡ç®— Î” è¦ç®€å•å¾—å¤šã€‚å½“å®Œæˆ VDOM è®¡ç®—åï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª diff ç®—æ³•ï¼Œå®Œæˆ VDOM ä¸ä¸Šä¸€æ¬¡çš„ VDOM çš„å·®å¼‚ã€‚
å³ patch = diff( VDOM1, VDOM2)ï¼Œè¿™ä¹Ÿæ˜¯ä¸€æ¬¡çº¯ç²¹çš„å‡½æ•°è®¡ç®—ï¼Œç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨ &lt;code&gt;interpret&lt;&#x2F;code&gt; å‡½æ•°ï¼Œå°†è¿™ä¸ª patch
åº”ç”¨åˆ°DOMä¸Šï¼Œå®ŒæˆDOMçš„æ›´æ–°è¿‡ç¨‹ã€‚è¿™ä¸ªå’Œæˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„ &lt;code&gt;è®¡ç®—-è§£é‡Š&lt;&#x2F;code&gt;æ¨¡å‹æ˜¯ä¸€è‡´çš„ã€‚é€šè¿‡ VDOM å’Œ patch ç®—æ³•ï¼Œæˆ‘ä»¬å®Œæˆäº†è®¡ç®—ä¸è§£é‡Šçš„éš”ç¦»ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;React çš„æˆåŠŸä¹‹å¤„åœ¨äºï¼šé€šè¿‡&lt;code&gt;è®¡ç®—-è§£é‡Š&lt;&#x2F;code&gt;éš”ç¦»ï¼ŒUI çš„ä¸šåŠ¡é€»è¾‘éƒ½å¯ä»¥é‡‡ç”¨ FP çš„æ–¹å¼è¿›è¡Œå®Œæˆï¼Œè¿™å¤§å¤§çš„ç®€åŒ–äº†UI
çš„æ“ä½œï¼Œå‡å°‘äº†ä»£ç é‡ã€‚åŒæ—¶ï¼Œç”±äºé‡‡ç”¨ diff ç®—æ³•ï¼Œæœ€åçš„DOMæ›´æ–°ä¹Ÿå¯ä»¥åšåˆ°&lt;em&gt;æœ€ä¼˜åŒ–&lt;&#x2F;em&gt;ï¼Œä»è€Œä¹Ÿå¸¦æ¥æå¤§çš„æ€§èƒ½æå‡ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æ–°çš„ç¼–ç¨‹è¯­è¨€å¯¹FPçš„æ”¯æŒ
è™½ç„¶Cã€Javaè¯­è¨€åœ¨æœ€è¿‘è®¸å¤šå¹´ä¸­ï¼Œä¸€ç›´æ˜¯é›„éœ¸ Tiobeæ¦œçš„å‰äºŒé€‰æ‹©ï¼Œä¸è¿‡ï¼Œè¶Šæ¥è¶Šå¤šçš„æ–°æ™‹è¯­è¨€ï¼Œéƒ½æ™®éé€‰æ‹©äº†æ”¯æŒ FP çš„ç‰¹æ€§ã€‚
éšç€è¶Šæ¥è¶Šå¤šçš„ç¼–ç¨‹è¯­è¨€ã€ç¼–ç¨‹æ¡†æ¶å¯¹FPçš„æ”¯æŒï¼Œæˆ‘ä»¬åº”è¯¥å¤§èƒ†çš„æ‹¥æŠ±FPçš„ç¼–ç¨‹æ€æƒ³ï¼Œå› ä¸ºè¿™ä¹Ÿä»£è¡¨ç€æœªæ¥çš„è¶‹åŠ¿ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;&#x2F;th&gt;&lt;th&gt;Java&lt;&#x2F;th&gt;&lt;th&gt;Kotlin&lt;&#x2F;th&gt;&lt;th&gt;Scala&lt;&#x2F;th&gt;&lt;th&gt;Swift&lt;&#x2F;th&gt;&lt;th&gt;Rust&lt;&#x2F;th&gt;&lt;th&gt;Go&lt;&#x2F;th&gt;&lt;th&gt;Dart&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;ä¸å¯å˜å˜é‡&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;ä¸å¯å˜é›†åˆ&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;if-else è¡¨è¾¾å¼&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;for è¡¨è¾¾å¼&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;switch è¡¨è¾¾å¼&lt;&#x2F;td&gt;&lt;td&gt;JDK14&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;Î»åŒ¿åå‡½æ•°&lt;&#x2F;td&gt;&lt;td&gt;JDK8&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;å‡½æ•°å³å€¼&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;å°¾é€’å½’&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;Y&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;td&gt;N&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;p&gt;ç»¼ä¸Šï¼Œæ¯”è¾ƒå¥½çš„ä½“éªŒFPçš„ç¼–ç¨‹è¯­è¨€æ˜¯ Kotlinã€Scalaã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;4-ying-yong-shi-jian&quot;&gt;4. åº”ç”¨å®è·µ&lt;&#x2F;h1&gt;
&lt;p&gt;ä»ç›®å‰å›½å†…çš„åº”ç”¨æƒ…å†µæ¥çœ‹ï¼ŒFP
åº”è¯¥è¿˜æ˜¯å°ä¼—çš„é€‰æ‹©ï¼Œä½œè€…åœ¨ä¸€ä¸ªå‡½æ•°å¼å¼€å‘çš„ç¾¤ä¸­ï¼Œæ™®éæ¥è§¦åˆ°çš„éƒ½æ˜¯ä¸€äº›â€œå…´è¶£çˆ±å¥½è€…â€œï¼Œé—®åŠæ˜¯å¦åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæ˜¯å¦æœ‰é€‰æ‹©â€å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€â€ï¼Œæ˜¯å¦åº”ç”¨å‡½æ•°å¼ç¼–ç¨‹ï¼Ÿæ™®éçš„å›ç­”æ˜¯â€œä¸â€ï¼Œå¤§å®¶å¯¹FPæœ‰è¾ƒå¤šçš„æ‹…å¿§ã€è¯¯è§£ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;4-1-fp-hen-kun-nan-ru-fu-za-lei-xing-ti-xi-ling-huo-de-dslyu-fa-tian-shu-yi-ban-de-frameworkyuan-dai-ma-yi-ji-hui-se-de-monad&quot;&gt;4.1 FP å¾ˆå›°éš¾ï¼Œå¦‚å¤æ‚ç±»å‹ä½“ç³»ã€çµæ´»çš„DSLè¯­æ³•ã€å¤©ä¹¦ä¸€èˆ¬çš„frameworkæºä»£ç ã€ä»¥åŠæ™¦æ¶©çš„Monadï¼Ÿ&lt;&#x2F;h2&gt;
&lt;p&gt;ç›¸ä¿¡å¾ˆå¤šFPçš„çˆ±å¥½è€…éƒ½æ˜¯æŠ±ç€è¿™æ ·çš„ç–‘æƒ‘çš„ï¼šFPå¾ˆå›°éš¾ï¼Œæœ‰å¾ˆå¤šçš„æ–°æ¦‚å¿µï¼ŒMonadã€Î» calculusã€Categoriesï¼Œè¿™ä¼¼ä¹ä¸å­¦ä¹ é‡å­åŠ›å­¦çš„éš¾åº¦ä¹Ÿå·®ä¸å¤šäº†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;çš„ç¡®ï¼ŒFPçš„å‘å±•å²ä¸Šï¼Œä¸€ç›´éƒ½æœ‰â€œæ•°å­¦å®¶â€çš„å½±å­ï¼Œä»Categoriesç†è®ºã€Î»æ¼”ç®—ã€LISPç¼–ç¨‹è¯­è¨€ï¼Œéƒ½æœ‰éå¸¸æ·±åšçš„æ•°æ®ç†è®ºåŸºç¡€ï¼Œå…¶èƒŒåæœ‰ä¸€å¥—å¤æ‚çš„ã€æ·±å¥¥çš„ç†è®ºã€‚ä½†å®é™…ä¸Šï¼Œå¤§éƒ¨åˆ†çš„å•†ä¸šåº”ç”¨ä¸­ï¼Œå¹¶ä¸ä¼šç”¨åˆ°å¤æ‚çš„ç†è®ºã€‚æ­£å¦‚æ¯é¸¡ä¼šä¸‹è›‹ï¼Œä½†å®ƒä¸ä¼šçŸ¥é“ä¸‹è›‹èƒŒåçš„ç§‘å­¦é€»è¾‘ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä¸äº†è§£è¿™äº›æ·±å¥¥æ•°å­¦çš„æƒ…å†µä¸‹ï¼Œé©¾é©­å‡½æ•°å¼ç¼–ç¨‹ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;FPå¯ä»¥å¾ˆæ·±å¥¥ï¼Œä½†ä¸€äº›åŸºæœ¬çš„åŸåˆ™ç¡®å®éå¸¸ç®€å•çš„ï¼Œä¹Ÿè¶³ä»¥å¤„ç†ç»å¤§å¤šæ•°çš„åº”ç”¨é—®é¢˜ã€‚æœ¬æ–‡æ€»ç»“äº†å‡ æ¡FPçš„åŸºæœ¬åŸåˆ™ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ç¼–å†™æ— å‰¯ä½œç”¨çš„çº¯å‡½æ•°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç¼–å†™â€œä¸å˜æ€§â€œçš„ä»£ç ï¼Œä½¿ç”¨ immutable å˜é‡å’Œ immutable å¯¹è±¡ã€immutabeé›†åˆã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨ expression è€Œé statement&lt;&#x2F;li&gt;
&lt;li&gt;ç¼–å†™ç®€å•çš„å¤„ç†æµç¨‹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç¼–å†™ç®€å•çš„æ•°æ®æµï¼Œé‡‡ç”¨ pipelineã€DAG çš„ç»“æ„ï¼Œåˆ’åˆ†å±‚æ¬¡ã€ç²’åº¦ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;éš”ç¦»å‰¯ä½œç”¨ï¼Œé‡‡ç”¨ &lt;code&gt;è®¡ç®—-è§£é‡Š&lt;&#x2F;code&gt;ã€&lt;code&gt;å¤šé˜¶æ®µå‰¯ä½œç”¨æ¨¡å‹&lt;&#x2F;code&gt;ã€&lt;code&gt;TCC&lt;&#x2F;code&gt;ç­‰æ¨¡å¼éš”ç¦»å‰¯ä½œç”¨å¤„ç†ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å®é™…ä¸Šï¼Œé€šè¿‡éµå®ˆä¸Šè¿°çš„åŸåˆ™ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒ Monadã€æ›´ä¸éœ€è¦å­¦ä¹  Categories Theoryï¼Œå°±å®Œå…¨å¯ä»¥åº”å¯¹å•†ä¸šåº”ç”¨å¼€å‘ã€‚ä½¿ç”¨ FP å¹¶ä¸å¹¶
OOP æ›´å¤æ‚ï¼Œæ›´çƒ§è„‘ï¼Œç›¸åï¼Œé€šè¿‡åº”ç”¨ä¸Šè¿°çš„åŸåˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å‘å‡ºæ›´ä¸ºç®€æ´ã€æ¸…æ™°ã€å¯è¯»ã€æ— BUGçš„ç¨‹åºã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;4-2-zhao-bu-dao-shou-xi-fpde-gong-cheng-shi&quot;&gt;4.2 æ‹›ä¸åˆ°ç†Ÿæ‚‰FPçš„å·¥ç¨‹å¸ˆã€‚&lt;&#x2F;h2&gt;
&lt;p&gt;çš„ç¡®å¦‚æ­¤ï¼Œç›®å‰å¤§éƒ¨åˆ†å·¥ç¨‹å¸ˆéƒ½æ˜¯OOçš„ä¿¡å¾’ï¼ŒåŸºæœ¬ä¸Šç¼ºä¹FPçš„è®¤çŸ¥å’Œå®è·µã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬è®¤ä¸ºFPå¹¶ä¸æ˜¯ä»€ä¹ˆâ€œå¼‚ç±»â€çš„ç¼–ç¨‹æ¨¡å¼ï¼Œé€šè¿‡å¼ºè°ƒä¸Šè¿°çš„6æ¡åŸºæœ¬åŸåˆ™ï¼Œç»å¤§éƒ¨åˆ†çš„å·¥ç¨‹å¸ˆéƒ½å¯ä»¥åœ¨1-2å‘¨æ—¶é—´å†…ï¼Œé€æ­¥å®Œæˆè½¬å‹ï¼Œå¹¶åœ¨3-4å‘¨çš„å®è·µçª—å£å†…ï¼Œé€æ­¥çš„ä¹ æƒ¯æ–°çš„ç¼–ç¨‹æ¨¡å¼ï¼Œäº§å‡ºæ›´ä¸ºé«˜æ•ˆã€é«˜è´¨é‡çš„ä»£ç ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æˆ‘ä»¬æ¨èçš„å­¦ä¹ è·¯å¾„æ˜¯ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;åˆæ­¥äº†è§£å‡½æ•°å¼è¯­è¨€çš„ä¸€äº›åŸºæœ¬è¯­æ³•ã€å‡½æ•°ã€‚(1-2å¤©ï¼‰ï¼Œåœ¨åç»­è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥éšæ—¶é€šè¿‡æœç´¢ã€æŸ¥æ‰‹å†Œã€å’¨è¯¢èº«è¾¹çš„ç†Ÿæ‰‹ï¼Œæ¥åº”å¯¹å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ä¸€äº›åˆçº§é—®é¢˜ï¼šä¾‹å¦‚ï¼Œè¯­æ³•é—®é¢˜ï¼Œå¸¸ç”¨å‡½æ•°é—®é¢˜ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åŸºäºä¸å˜é‡ç¼–ç¨‹ï¼Œç¼–å†™æ— å‰¯ä½œç”¨çš„çº¯å‡½æ•°ã€‚ï¼ˆ1å‘¨ï¼‰ï¼Œä¸€èˆ¬çš„ï¼Œé€šè¿‡å®Œæˆå‡ ä¸ªé›†åˆç›¸å…³çš„ç»ƒä¹ é¢˜ï¼Œå¼€å‘è€…å³å¯ç†è§£å¦‚ä½•æ¶ˆé™¤ä¸å˜é‡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;é€‰æ‹©1-2ä¸ªè¿‡å¾€çš„ä»£ç ç‰‡æ®µï¼Œæˆ‘ä»¬çš„åŸåˆ™ä¸Šæ˜¯é€‰æ‹©å°½å¯èƒ½å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œæœ‰æ—¶å€™å¯èƒ½æ˜¯æˆç™¾ä¸Šåƒè¡Œçš„ä¼ ç»Ÿä»£ç ï¼Œå°è¯•ä½¿ç”¨1å‘¨çš„æ—¶é—´è¿›è¡Œé‡æ„å®éªŒï¼Œæ¼”ç»ƒæˆ‘ä»¬æ¨èçš„6ä¸ªåŸåˆ™ï¼šåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªç†Ÿç»ƒæŒæ¡è¿™ç§æ–¹å¼çš„ç†Ÿæ‰‹ï¼Œäºˆä»¥æ£€æŸ¥å’ŒæŒ‡å¯¼ï¼Œæ˜¯éå¸¸æœ‰æ•ˆçš„ã€‚ï¼ˆ1å‘¨ï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸€èˆ¬çš„ï¼Œç»å†2å‘¨çš„å®è·µï¼Œä¸€ä¸ªç†Ÿç»ƒçš„Javaç¨‹åºå‘˜ï¼Œå®Œå…¨å¯ä»¥æˆåŠŸè½¬å‹ï¼ŒæŒæ¡æ–°çš„FPç¼–ç¨‹æ€æƒ³å’Œä½¿ç”¨æ–¹æ³•ï¼Œå¹¶å¼€å§‹åœ¨å·¥ç¨‹ä¸­è¿›è¡Œåº”ç”¨ã€‚å½“ç„¶ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œé…ç½®ä¸€ä¸ªæŒæ¡è¯¥æ–¹æ³•çš„ç†Ÿæ‰‹ï¼ŒæŒ‡å¯¼4-6ä¸ªè½¬å‹ç¨‹åºå‘˜ï¼ŒæŒ‰éœ€æ–½ä»¥æ´æ‰‹ï¼Œé˜¶æ®µæ€§è¿›è¡Œä»£ç çš„reviewï¼Œæ˜¯éå¸¸æœ‰æ•ˆçš„ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;4-3-bian-cheng-yu-yan-xuan-ze-shi-hun-he-shi-bian-cheng-huan-shi-qiang-zhi-xing-fp&quot;&gt;4.3 ç¼–ç¨‹è¯­è¨€é€‰æ‹©ï¼Ÿæ˜¯æ··åˆå¼ç¼–ç¨‹ï¼Ÿï¼Œè¿˜æ˜¯å¼ºåˆ¶æ€§ FPï¼Ÿ&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;é€‰æ‹© Java 8ï¼Ÿè¿˜æ˜¯ Kotlinã€Scalaç­‰ç¼–ç¨‹è¯­è¨€ï¼Ÿ&lt;&#x2F;li&gt;
&lt;li&gt;æ˜¯åœ¨é¡¹ç›®ä¸­é€‰æ‹©æ··åˆå¼ç¼–ç¨‹ï¼Œæ—¢é‡‡ç”¨ä¼ ç»Ÿå‘½ä»¤å¼ï¼Œä½¿ç”¨å˜é‡ã€å¯å˜é›†åˆï¼Œä¹Ÿç»“åˆä½¿ç”¨éƒ¨åˆ†å‡½æ•°å¼çš„ç”¨æ³•ï¼Ÿ&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ä»æˆ‘ä¸ªäººçš„ç»éªŒæ¥çœ‹ï¼Œæˆ‘ä¼šæ›´å€¾å‘äºä¸€æ­¥åˆ°ä½ï¼Œé€‰æ‹©æ”¯æŒå‡½æ•°å¼èƒ½åŠ›è¾ƒä¸ºå½»åº•åœ°è¯­è¨€ï¼Œåœ¨ JVM ä¹‹ä¸Šï¼Œæˆ‘ä¼šæ¨è Kotlinã€Scalaã€‚è™½ç„¶åŸºäº
Java8 çš„Stream API å’Œ lambdaï¼Œä¹Ÿå¯ä»¥ç¼–å†™ FP é£æ ¼çš„ä»£ç ï¼Œä½†æ˜¯ï¼Œé€‰æ‹© Java8ï¼Œä¸»è¦å­˜åœ¨çš„ä¸è¶³ä¹‹å¤„æ˜¯ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ç¼ºå°‘ä¸€ä¸ª immutable collection APIã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç¼ºå°‘å¯¹ if-else, switch è¡¨è¾¾å¼çš„æ”¯æŒã€‚è¿™ä½¿å¾— statement çš„ä½¿ç”¨ä¸å¯é¿å…ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¸æ”¯æŒ tailrecï¼Œè¿™ä½¿å¾— å¾ªç¯ä¸å¯é¿å…ï¼Œä¹Ÿä½¿å¾— statementçš„ä½¿ç”¨ä¸å¯é¿å…ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è€Œé€‰æ‹© Kotlinã€Scala è¿™æ ·çš„è¯­è¨€ï¼Œå¯¹ Java ç¨‹åºå‘˜æ¥è¯´ï¼Œå…¶å®å¹¶æ²¡æœ‰å¤šå¤§çš„é—¨æ§›ï¼Œä¸€èˆ¬çš„ï¼Œç»è¿‡2-4å‘¨çš„æ—¶é—´ï¼ŒJavaç¨‹åºå‘˜å°±å¯ä»¥åŸºæœ¬ä¸ŠæŒæ¡
Scala è¿™æ ·çš„è¯­è¨€ï¼Œç†Ÿç»ƒçš„è¿›è¡Œåº”ç”¨å¼€å‘ã€‚è€Œé€šè¿‡æ–½åŠ æœ¬æ–‡ä»‹ç»çš„ 6
ä¸ªé™åˆ¶åŸåˆ™ï¼Œæœç»å‰¯ä½œç”¨çš„æ»¥ç”¨ã€æ‹’ç»æ•°æ®å¯å˜æ€§å¤„ç†ï¼Œå¯ä»¥å¸¦æ¥æ˜¾è‘—çš„ä»£ç è´¨é‡æå‡ã€‚ç›¸åï¼Œå¦‚æœä¸èƒ½è·µè¡Œæœ¬æ–‡æ¨èçš„åŸåˆ™ï¼Œåˆ™å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œç¨‹åºå‘˜åœ¨ä¸è‡ªè§‰çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šé€€åŒ–ä¸ºä¼ ç»ŸOOPçš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œæœ€ç»ˆçš„æ•ˆæœä¼šæ‰“ä¸ŠæŠ˜æ‰£ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;4-4-fp-dui-cheng-xu-yuan-su-yang-de-bang-zhu&quot;&gt;4.4 FP å¯¹ç¨‹åºå‘˜ç´ å…»çš„å¸®åŠ©&lt;&#x2F;h2&gt;
&lt;p&gt;å¯¹å¤§éƒ¨åˆ†çš„ç¨‹åºå‘˜æ¥è¯´ï¼Œä¼šæ›´ä¹ æƒ¯ OOP
çš„æ–¹å¼ï¼Œå› ä¸ºè¿™ç§æ–¹å¼å¸¦ç»™ç¨‹åºå‘˜çš„çº¦æŸæ›´å°ï¼Œç¼–ç ä¼šæ›´ä¸ºè‡ªç”±ã€‚ä½†è¿™æ ·å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œç¼ºä¹å¯¹æ•´ä¸ªç¨‹åºçš„æ•´ä½“æ€è€ƒï¼Œå°¤å…¶æ˜¯å¯¹æ•°æ®æµçš„æ•´ä½“æ€è€ƒï¼Œå¤§éƒ¨åˆ†çš„æ—¶é—´å…¶å®æ˜¯é€šè¿‡â€œè°ƒè¯•â€æ¥ç¼–å†™ä»£ç ï¼Œå¯èƒ½1å¤©ç¼–å†™çš„ä»£ç ï¼Œè°ƒè¯•è¦2-5å€çš„æ—¶é—´ã€‚è¿™ç§å†™èµ·æ¥å¾ˆçˆ½ï¼ŒæŠŠå›°éš¾ç•™ç»™è°ƒè¯•çš„æ–¹å¼ï¼Œå¾ˆéš¾è¯´å¯ä»¥æé«˜ç¨‹åºå‘˜çš„æ€ç»´èƒ½åŠ›ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è€Œ FP ä¸åŒï¼Œéš”ç¦»å‰¯ä½œç”¨ã€ç¼–å†™æ— å‰¯ä½œç”¨çš„å‡½æ•°ã€ä½¿ç”¨å•å‘æ— ç¯è·¯çš„æ•°æ®æµï¼Œéƒ½ä¼šè¿«ä½¿ç¨‹åºå‘˜åœ¨è§£å†³ä¸€ä¸ªå…·ä½“é—®é¢˜å‰ï¼Œå…ˆç†æ¸…æ€è·¯ï¼Œæ¢³ç†æ•°æ®æµå‘ï¼Œäº†è§£æœ€ç»ˆçš„å‰¯ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿè€Œè¿™äº›ææ¸…æ¥šåï¼Œå‰©ä¸‹çš„ä»£ç å¼€å‘åè€Œæ˜¯ä¸€ä»¶ç›¸å¯¹ç®€å•çš„äº‹æƒ…ã€‚é‡‡ç”¨
FP æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥èŠ±æ›´å°‘çš„æ—¶é—´æ¥è°ƒè¯•ä»£ç ï¼ŒåŸå› æ˜¯ï¼šFP ç®€å•çš„æ•°æ®æµã€æ•°æ®çš„ä¸å˜æ€§ï¼Œè®©ä»£ç æ˜¯é«˜åº¦è‡ªæè¿°çš„ï¼Œå…·æœ‰å¾ˆå¼ºçš„å¯è¯æ˜æ€§ã€‚åœ¨æˆ‘ä»¬çš„å®è·µä¸­ï¼Œæˆ‘ä»¬ä¼šæ¨èç¨‹åºå‘˜æŒ‘æˆ˜ï¼šä¸€éå†™æ­£ç¡®ä»£ç ï¼Œè€Œä¸å¿…é€šè¿‡
debug æ¥å’Œé”™è¯¯æ‰è°œè—ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;4-5-fp-dui-xiang-mu-zhi-liang-de-bang-zhu&quot;&gt;4.5 FP å¯¹é¡¹ç›®è´¨é‡çš„å¸®åŠ©&lt;&#x2F;h2&gt;
&lt;p&gt;é€šè¿‡è·µè¡Œæœ¬æ–‡æ¨èçš„6æ¡åŸºæœ¬åŸåˆ™ï¼Œå¯ä»¥åŠ å¤§å¹…åº¦çš„æå‡ä»£ç çš„è´¨é‡ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;éš”ç¦»å‰¯ä½œç”¨ï¼Œä¼šè®©ä»£ç çš„é€»è¾‘æ›´ä¸ºæ¸…æ™°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¤§éƒ¨åˆ†ä»£ç æ˜¯ç¬¦åˆSRPã€å†…èšã€æ— å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å¾ˆå®¹æ˜“é˜…è¯»ã€å•å…ƒæµ‹è¯•ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ç®€å•æ•°æ®æµè®©ä»£ç æ•´ä½“æµç¨‹ç®€å•ã€æ¸…æ™°ã€‚è¯„å®¡ä»£ç æ—¶ï¼Œå¯ä»¥æŒ‰ç…§é¡ºåºæ–¹å¼è¿›è¡Œï¼Œè€Œæ— éœ€å…œè½¬ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è™½ç„¶ FP å¹¶ä¸æ˜¯è§£å†³æ‰€æœ‰é—®é¢˜çš„é“¶å¼¹ï¼Œä½†æ˜¯ï¼Œé‡‡ç”¨äº†æœ¬æ–‡6åŸåˆ™çš„ FP
ä»£ç ï¼Œå´å¸¦æ¥äº†æ›´å¥½çš„å¯è¯»æ€§ã€å¯éªŒè¯æ€§ï¼Œåœ¨å®é™…å·¥ç¨‹å®è·µä¸­ï¼Œå¤§å¹…åº¦é™ä½äº†ä»£ç è¯„å®¡çš„éš¾åº¦ï¼Œç¡®ä¿è¯„å®¡è€…å¯ä»¥ä»¥è¾ƒå°çš„ä»£ä»·ç†è§£è¢«è¯„å®¡çš„ä»£ç ã€‚ä»æˆ‘ä»¬çš„å®è·µç»éªŒæ¥çœ‹ï¼Œé‡‡ç”¨6å¤§åŸåˆ™ç¼–å†™çš„ä»£ç ï¼Œå…¶è¾ƒä½çš„æ°´ä½çš„ä»£ç ï¼Œä¹Ÿè¶…è¿‡äº†å¤§éƒ¨åˆ†â€œç¼–å†™è‰¯å¥½çš„â€ä¼ ç»Ÿ
OOP ä»£ç ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä½œä¸ºä¸€ä¸ªè¡¥å……ï¼Œæˆ‘ä»¬æ­£åœ¨å¼€å‘6åŸåˆ™çš„ä»£ç æµ‹è¯„å·¥å…·ï¼Œå¯¹è¿ååŸåˆ™çš„ä»£ç ï¼Œåœ¨ä»£ç æäº¤é˜¶æ®µï¼Œå³å¯åˆ©ç”¨å·¥å…·è¿›è¡Œæ‰«ææ£€æŸ¥ï¼Œé˜²æ­¢è¿ååŸåˆ™çš„ä»£ç è¿›å…¥ä»£ç åº“ï¼Œè¿™ä¸ªè¿›ä¸€æ­¥ç®€åŒ–ä»£ç çš„è¯„å®¡å·¥ä½œé‡ï¼Œä½¿å¾—ï¼Œæˆ‘ä»¬å¯ä»¥æ›´èšç„¦äºä»£ç é€»è¾‘æœ¬èº«ï¼Œè€Œéä¸€äº›å½¢å¼åŒ–çš„å†…å®¹ã€‚&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>å®ä¾‹è®²è§£ Java å†…å­˜æ¨¡å‹</title>
        <published>2021-06-10T00:00:00+00:00</published>
        <updated>2021-06-10T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/java-volatile/"/>
        <id>https://wangzaixiang.github.io/blog/java-volatile/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/java-volatile/">&lt;h1 id=&quot;shi-li-jiang-jie-java-nei-cun-mo-xing&quot;&gt;å®ä¾‹è®²è§£ Java å†…å­˜æ¨¡å‹&lt;&#x2F;h1&gt;
&lt;p&gt;Javaå†…å­˜æ¨¡å‹(JMM)æ˜¯ä¸€ä¸ªç›¸å¯¹æŠ½è±¡ã€é«˜çº§çš„è¯é¢˜ï¼Œç›¸å…³çš„è§„èŒƒåœ¨&lt;a href=&quot;https:&#x2F;&#x2F;docs.oracle.com&#x2F;javase&#x2F;specs&#x2F;jls&#x2F;se8&#x2F;html&#x2F;jls-17.html#jls-17.4&quot;&gt;Memory Model&lt;&#x2F;a&gt;æœ‰è¯¦ç»†çš„å®šä¹‰ã€‚JMMä¸»è¦è§£å†³å†…å­˜è¯»å†™çš„å¯è§æ€§é—®é¢˜ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯å†…å­˜è¯»å†™çš„å¯è§æ€§é—®é¢˜å‘¢ï¼Ÿä¼šå‡ºç°ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Œå¦‚ä½•è§£å†³è¿™äº›é—®é¢˜å‘¢ï¼Ÿæœ¬æ–‡è®²è¯•å›¾é€šè¿‡ä¸€äº›å®ä¾‹æ¥è®²è¿°ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;fan-li-dai-ma&quot;&gt;åä¾‹ä»£ç &lt;&#x2F;h2&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-java &quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;java.util.concurrent.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;BrokenBarrierException&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;java.util.concurrent.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;CyclicBarrier&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Test2 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;a &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;b &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;x &lt;&#x2F;span&gt;&lt;span&gt;= -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;y &lt;&#x2F;span&gt;&lt;span&gt;= -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;path1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		a &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		x &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; b;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;path2&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		b &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		y &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; a;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public boolean &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;test&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;throws &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;InterruptedException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		a &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; b &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		x &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; y &lt;&#x2F;span&gt;&lt;span&gt;= -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;CyclicBarrier&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; barrier &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;CyclicBarrier&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Thread&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; t1 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Thread&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;			&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;run&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;() {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;				&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;					barrier.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;await&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;					&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;path1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;				} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;catch &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;InterruptedException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;BrokenBarrierException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;e&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;) {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;				}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;			};
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		};
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Thread&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; t2 &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Thread&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;			&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;run&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;() {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;				&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;					barrier.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;await&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;					&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;path2&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;				} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;catch &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;InterruptedException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;BrokenBarrierException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;e&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;) {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;				}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;			};
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		};
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		t1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;start&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		t2.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;start&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		t1.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;join&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		t2.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;join&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(x &lt;&#x2F;span&gt;&lt;span&gt;== &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 &lt;&#x2F;span&gt;&lt;span&gt;&amp;amp;&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; y &lt;&#x2F;span&gt;&lt;span&gt;== &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;			&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;else return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public static void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;args&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;throws &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;InterruptedException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;for&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; i &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;; i&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1000&lt;&#x2F;span&gt;&lt;span&gt;*&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1000&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;; i&lt;&#x2F;span&gt;&lt;span&gt;++&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;			&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Test2&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;test&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;()&lt;&#x2F;span&gt;&lt;span&gt;==&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;) {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;				&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;System&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;.out.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;println&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;found on &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; +&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; i);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;			}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;		}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;	
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è¿™ä¸ªä¾‹å­ï¼Œåˆå§‹åŒ–æ—¶ï¼Œa = 0, b = 0, x = -1, y = -1, å¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œåˆ†åˆ«åŒæ—¶æ‰§è¡Œ path1 å’Œ path2ï¼Œ
é‚£ä¹ˆåœ¨2ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆåï¼Œæ˜¯å¦å¯èƒ½ä¼šå‡ºç° x == 0 &amp;amp;&amp;amp; y == 0 çš„æƒ…å†µå‘¢ï¼Ÿ
&lt;img src=&quot;&#x2F;images&#x2F;15764941224465.jpg&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;ç°åœ¨è®©æˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸‹å¯èƒ½çš„æ‰§è¡Œæƒ…å†µï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Thread 1 çš„ a = 1 å…ˆäº Thread 2 çš„ b = 2 æ‰§è¡Œã€‚å¦‚ä¸‹å›¾
&lt;img src=&quot;&#x2F;images&#x2F;15764945758860.jpg&quot; alt=&quot;&quot; &#x2F;&gt;&lt;br &#x2F;&gt;
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ y = 1ï¼Œ x å¯èƒ½ä¸º0æˆ–è€…2ã€‚ ä¸ä¼šå‡ºç° y == 0 &amp;amp;&amp;amp; x == 0çš„æƒ…å†µã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Thread 1 çš„ a = 1 æ™šäº  Thread 2 çš„ b = 2 æ‰§è¡Œï¼Œå¦‚ä¸‹å›¾ï¼š
&lt;img src=&quot;&#x2F;images&#x2F;15764947927698.jpg&quot; alt=&quot;&quot; &#x2F;&gt;
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ x = 2, y å¯èƒ½ä¸º 0æˆ–è€…1ã€‚ä¸ä¼šå‡ºç° x == 0 &amp;amp;&amp;amp; y == 0çš„æƒ…å†µã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Thread 1 å’Œ Thread 2 å®Œå…¨åŒæ—¶æ‰§è¡Œã€‚
&lt;img src=&quot;&#x2F;images&#x2F;15764949409093.jpg&quot; alt=&quot;&quot; &#x2F;&gt;
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ x = 2, y = 1ï¼Œä¸å¯èƒ½å‡ºç° x == 0 &amp;amp;&amp;amp; y == 0 çš„æƒ…å†µã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;æ ¹æ®æˆ‘ä»¬çš„åˆ†æï¼Œæ— è®ºæ˜¯ T1å…ˆäºT2,T1æ™šäºT2ï¼Œè¿˜æ˜¯ T1,T2å®Œå…¨åŒæ—¶æ‰§è¡Œï¼Œç†è®ºä¸Šéƒ½ä¸ä¼šå‡ºç° x == 0 and y == 0 çš„æƒ…å†µå‡ºç°ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä½†æ˜¯å®é™…ä¸Šï¼Œæˆ‘ä»¬å»è¿è¡Œä¸Šè¿°çš„ä»£ç ï¼Œå´å¯èƒ½ä¼šå‡ºç°è¿èƒŒé¢„æœŸçš„æƒ…å†µã€‚
&lt;img src=&quot;&#x2F;images&#x2F;15764953595416.jpg&quot; alt=&quot;-w322&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨æˆ‘çš„MacBookProä¸Šï¼Œæ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œåœ¨1ç™¾ä¸‡æ¬¡å¾ªç¯ä¸­ï¼Œå‡ºç°äº†8æ¬¡ä¸ç¬¦åˆâ€œé¢„æœŸâ€çš„æƒ…å†µã€‚è™½ç„¶è¯´ï¼Œè¿™ç§å‡ ç‡æ˜¯éå¸¸ä½çš„ï¼Œç™¾ä¸‡åˆ†ä¹‹å…«ã€‚ä½†è¿™æ ·çš„é—®é¢˜å¦‚æœå‡ºç°åœ¨çº¿ä¸Šç³»ç»Ÿä¸­ï¼Œæ¯å¤©éƒ½å‡ºç°æ•°æ¬¡æˆ–è€…æ•°åæ¬¡å¼‚å¸¸æƒ…å†µï¼Œä¼šæ˜¯ä¸€ä»¶éå¸¸ä»¤äººæŠ“ç‹‚çš„äº‹æƒ…ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;yuan-yin-shi-shen-me&quot;&gt;åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ&lt;&#x2F;h2&gt;
&lt;p&gt;æˆ‘ä»¬ä¸Šé¢åˆ†æäº†3ç§å¯èƒ½çš„æ‰§è¡Œè·¯å¾„ï¼Œâ€œç†è®ºâ€ä¸Šï¼Œæ˜¯ä¸ä¼šå‡ºç°x,yåŒæ—¶ä¸º0çš„æƒ…å†µçš„ï¼Œä½†å®é™…æ‰§è¡Œç»“æœå¹¶ä¸ç¬¦åˆé¢„æœŸã€‚è‚¯å®šæ˜¯æˆ‘ä»¬çš„åˆ†æå‡ºäº†é—®é¢˜ã€‚CPUçš„å®é™…æ‰§è¡Œï¼Œå’Œæˆ‘ä»¬ä¸Šé¢çš„â€œå‡è®¾â€å¹¶ä¸ä¸€è‡´ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¸Šé¢åˆ†æçš„ä¸‰ç§å¯èƒ½çš„æ‰§è¡Œè·¯å¾„ï¼Œéƒ½æœ‰ä¸€ä¸ªåŸºæœ¬çš„å‡è®¾ï¼šCPU æ˜¯å…ˆæ‰§è¡Œä¸Šä¸€æ¡æŒ‡ä»¤ï¼Œç„¶ååœ¨æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œä¸”æ‰§è¡Œå®Œè¿™æ¡æŒ‡ä»¤åï¼Œæ‰§è¡Œç»“æœï¼Œå¯ä»¥åœ¨å…¶ä»–çš„CPUï¼ˆçº¿ç¨‹ï¼‰ä¸Šåæ˜ å…¶æ‰§è¡Œç»“æœï¼Œå³ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒCPUæ˜¯ä¾ç…§é¡ºåºæ‰§è¡ŒæŒ‡ä»¤çš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å½“å‰CPUæ‰§è¡Œå®Œä¸€æ¡å­˜å‚¨æŒ‡ä»¤åï¼Œåœ¨å…¶ä»–CPUä¸Šè¯»å–è¯¥åœ°å€æ—¶ï¼Œå¯ä»¥é©¬ä¸Šè¯»å–åˆ°æˆ‘ä»¬å†™å…¥çš„ç»“æœã€‚ï¼ˆå½“ç„¶ï¼Œä¹Ÿéšå«ç€ï¼šå½“å‰CPUå¯ä»¥é©¬ä¸Šçœ‹åˆ°å†™å…¥çš„ç»“æœï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªå‡è®¾ï¼Œéƒ½æ˜¯æ¯”è¾ƒç¬¦åˆæˆ‘ä»¬çš„ç†è§£é€»è¾‘çš„ï¼Œè¿™æ‰æ˜¯æ­£ç¡®åæ˜ æˆ‘ä»¬ä»£ç é€»è¾‘çš„æ–¹å¼ã€‚äº‹å®ä¸Šï¼Œå¦‚æœCPUä¸¥æ ¼çš„æŒ‰ç…§ä¸Šè¿°é€»è¾‘æ¥æ‰§è¡Œä»£ç ï¼Œæ˜¯ä¸ä¼šå‡ºç°ä¸Šé¢çš„å¼‚å¸¸æƒ…å†µçš„ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªå‡è®¾ï¼Œåœ¨ç°ä»£å¤§éƒ¨åˆ†çš„CPUä¸Šéƒ½ä¸æˆç«‹ã€‚æœ¬æ–‡å°±ä»¥æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„ x86 ç³»åˆ—CPUæ¥è¿›è¡Œè¯´æ˜ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒCPU æ˜¯æŒ‰ç…§é¡ºåºæ‰§è¡ŒæŒ‡ä»¤çš„ã€‚
å®é™…ä¸Šï¼ŒX86 ä¸å†å®Œå…¨éµå®ˆé¡ºåºæ‰§è¡ŒæŒ‡ä»¤çš„åŸåˆ™ã€‚X86 é‡‡ç”¨å¤šçº§æµæ°´çº¿æ¶æ„ï¼ŒCPUå¯ä»¥åœ¨åŒä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…ï¼Œè§£ç å¤šæ¡æŒ‡ä»¤ï¼Œå¹¶åŒæ—¶å‘å°„åˆ°å¤šä¸ªæ‰§è¡Œå•å…ƒè¿›è¡Œæ‰§è¡Œï¼Œè¿™ç§°ä¹‹ä¸ºâ€œå¤šå‘å°„â€æŠ€æœ¯ã€‚é‡‡ç”¨å¤šå‘å°„æŠ€æœ¯ï¼ŒCPUå¯ä»¥åœ¨åŒä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…åŒæ—¶æ‰§è¡Œå¤šæ¡æŒ‡ä»¤ï¼Œè¿™ä½¿å¾—ç¨‹åºæ‰§è¡Œé€Ÿåº¦å˜å¾—æ›´å¿«äº†ã€‚
å½“ç„¶ï¼Œè¦è¿›è¡Œè¿™ç§ä¼˜åŒ–ï¼Œä¹Ÿæ˜¯æœ‰å‰ææ¡ä»¶çš„ï¼Œæ¯”å¦‚ï¼Œå¦‚æœä¸¤æ¡æŒ‡ä»¤å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œé‚£ä¹ˆï¼ŒCPUæ˜¯ä¸èƒ½å°†å…¶åŒæ—¶æ‰§è¡Œçš„ã€‚&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;    a = x
&lt;&#x2F;span&gt;&lt;span&gt;    b = a + 1
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;blockquote&gt;
&lt;p&gt;Intelæ›¾ç»è®¾è®¡è¿‡ä¸€æ¬¾åä¸º Itaniumï¼ˆå®‰è…¾ï¼‰ çš„CPUï¼Œè¿™æ¬¾CPUå®¹è®¸ç¼–è¯‘å™¨æ˜¾å¼çš„å°†å¤šæ¡æŒ‡ä»¤åˆå¹¶æˆä¸º1æ¡å®½æŒ‡ä»¤ï¼Œäº¤ç»™ CPU æ‰§è¡Œï¼Œä»è€Œå®ç°æ›´å¥½çš„æ€§èƒ½ã€‚å¯æƒœçš„æ˜¯ï¼Œè¿™æ¬¾å¤„ç†å™¨ï¼Œä»æ¥å°±æ²¡æœ‰å é¢†å¸‚åœºï¼Œç›®å‰å·²ç»è¢«IntelæŠ›å¼ƒäº†ã€‚
ç›®å‰çš„ X86 æ¶æ„ï¼Œé‡‡ç”¨çš„æ˜¯ç”± CPU è‡ªå·±æ¥ç®¡ç†æŒ‡ä»¤çš„ä¾èµ–å…³ç³»ï¼Œå¹¶é‡‡ç”¨å¤šå‘å°„çš„æ–¹å¼ï¼Œæ¥å®ç°æ€§èƒ½æå‡ï¼Œå…¶å®ä¹Ÿé—´æ¥å®ç°äº† Itanium æœªè¾¾æˆçš„ä½¿å‘½ã€‚è€Œä¸”ï¼Œæ— éœ€ç¼–è¯‘å™¨è¿›è¡Œé©å‘½æ€§çš„æ”¹å˜ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å½“å‰ CPU æ‰§è¡Œå®Œä¸€æ¡å­˜å‚¨ï¼ˆå†™å…¥å†…å­˜ï¼‰æŒ‡ä»¤åï¼Œåœ¨å…¶ä»–CPUä¸Šå¯ä»¥é©¬ä¸Šè¯»å–åˆ°å…¶ç»“æœã€‚
å®é™…ä¸Šï¼ŒX86 å¹¶ä¸æä¾›è¿™ç§æ‰¿è¯ºã€‚å‡è®¾CPUè¦æä¾›è¿™ç§æ‰¿è¯ºï¼Œåˆ™æ„å‘³ç€ï¼šå½“å‰çš„å­˜å‚¨æŒ‡ä»¤ï¼Œå¿…é¡»ç­‰å¾…åˆ°å®é™…å°†æ•°æ®çœŸå®å†™å…¥åˆ°å†…å­˜ä¸­ã€‚è€ƒè™‘åˆ° CPU è®¿é—®å†…å­˜çš„é€Ÿåº¦ç›¸å¯¹äºCPUçš„è‡ªèº«çš„æ‰§è¡Œé€Ÿåº¦è€Œè¨€ï¼Œæ˜¯ç›¸å½“ç¼“æ…¢çš„ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Registerï¼š1 Cycle&lt;&#x2F;li&gt;
&lt;li&gt;L1 Cacheï¼š3 Cycles&lt;&#x2F;li&gt;
&lt;li&gt;L2 Cacheï¼š10+ Cycles&lt;&#x2F;li&gt;
&lt;li&gt;L3 Cacheï¼š20~30+ Cycles&lt;&#x2F;li&gt;
&lt;li&gt;Main Memoryï¼š~100 Cycles&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;è€ƒè™‘åˆ°å¤§éƒ¨åˆ†çš„CPUè®¡ç®—ï¼Œéƒ½å¯ä»¥åœ¨1ä¸ªå‘¨æœŸå†…å®Œæˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœç­‰å¾…ä¸€æ¬¡å†…å­˜çš„è®¿é—®ï¼Œå¯èƒ½ä¼šæµªè´¹æ‰100æ¡æ‰§è¡Œçš„æ‰§è¡Œèƒ½åŠ›ã€‚
æ‰€ä»¥ï¼Œå®é™…ä¸Šï¼ŒCPUä¼šå¯¹å†…å­˜çš„è¯»å†™è¿›è¡Œå¤§é‡è´Ÿè´£çš„ä¼˜åŒ–ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å¼•å…¥ L1,L2,L3 Cacheã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¼•å…¥ Write Bufferã€‚
è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è¿‡ç¨‹ï¼Œæœ¬æ–‡ä¸å¯¹æ­¤è¿›å±•å±•å¼€ï¼Œè¿™é‡Œé˜è¿°çš„æ˜¯è¿™æ ·çš„ä¸€ä¸ªäº‹å®ï¼šå½“CPUæ‰§è¡Œå®Œä¸€ä¸ª Store æŒ‡ä»¤æ—¶ï¼Œä¸ºäº†ä¿è¯æœ€ä½³çš„CPUæ‰§è¡Œæ•ˆç‡ï¼Œå®ƒå¹¶ä¸ä¿è¯æ•°æ®å·²ç»å†™å…¥åˆ°ä¸»å­˜ä¸­ï¼Œå®ƒå¯èƒ½æ˜¯å†™å…¥åˆ°å½“å‰CPUçš„ä¸€ä¸ªå†…éƒ¨ write bufferä¸­ï¼Œç„¶åå†åˆå¹¶ï¼Œå†™å…¥åˆ° L1 Cacheã€L2 Cacheã€L3 Cacheã€Main Memoryä¸­ã€‚è¿™é‡Œ L1, L2æ˜¯æ¯ä¸ªCPUç§æœ‰çš„ç¼“å­˜ï¼ŒL3 Cacheæ˜¯å¤šä¸ªCPU æ‰€å…±äº«çš„ã€‚
å½“å†™å…¥æ•°æ®åœ¨ Write Buffer æ—¶ï¼Œå…¶å®ƒCPUè¯»å–æ•°æ®æ—¶ï¼Œä¾ç„¶ä¼šè¯»å–åˆ°ä¹‹å‰çš„å€¼ã€‚è€Œå½“æ•°æ®å·²ç»å†™å…¥ L1&#x2F;L2 Cacheæ—¶ï¼ŒX86ä¼šé€šè¿‡ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œç¡®ä¿å…¶å®ƒçš„CPUè¯»å–åˆ°æ›´æ–°åçš„å€¼ã€‚æ‰€ä»¥ï¼Œåœ¨æ•°æ®ä»write bufferå†™å…¥åˆ°Cacheä¹‹å‰ï¼Œå…¶å®ƒCPUæ˜¯æ— æ³•è¯»å–å½“å‰çº¿ç¨‹çš„å†™å…¥ç»“æœçš„ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œä¼šå‡ºç° x == 0 &amp;amp;&amp;amp; y == 0 å‘¢ï¼Ÿ
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;java-volatile&#x2F;media&#x2F;15744362994853&#x2F;15765008552361.jpg&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;[a] = 1 å’Œ r1 = [b] æŒ‡ä»¤æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œ.
&lt;ol&gt;
&lt;li&gt;[a] = 1 æ˜¯ä¸€æ¡StoreæŒ‡ä»¤ï¼Œå…¶æ•°æ®ä¼šå…ˆå†™å…¥CPUçš„ WriteBufï¼Œç„¶åå†™å…¥ Cacheï¼Œå¤§çº¦éœ€è¦ 3+ æ—¶é’Ÿå‘¨æœŸï¼Œä¸ºå…¶å®ƒçº¿ç¨‹æ‰€èƒ½è¯»å–åˆ°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;r1 = [b] æ˜¯ä¸€ä¸ªLoadæŒ‡ä»¤ï¼Œå…¶æ•°æ®å¯èƒ½å·²ç»åœ¨ L1 å†…ï¼Œå¯ä»¥ç«‹å³æ‰§è¡Œï¼Œå…¶å€¼ä¸º0&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;[b] = 2 å’Œ r1 = [a] æŒ‡ä»¤æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œ
&lt;ol&gt;
&lt;li&gt;[b] = 2 æ˜¯ä¸€æ¡ Store æŒ‡ä»¤ï¼Œå…¶æ•°æ®ä¼šå…ˆå†™å…¥ CPU çš„ WriteBufï¼Œç„¶åå†™å…¥ Cacheï¼Œå¤§çº¦éœ€è¦ 3+ æ—¶é—´å‘¨æœŸä¹‹åï¼Œå…¶å®ƒçº¿ç¨‹æ‰èƒ½è¯»å–åˆ°å†™å…¥çš„å€¼ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;r1 = [a] æ˜¯ä¸€æ¡ Load æŒ‡ä»¤ï¼Œå…¶æ•°æ®å¯èƒ½å·²ç»åœ¨ L1 å†…ï¼Œå¯ä»¥ç«‹å³æ‰§è¡Œï¼Œå…¶å€¼ä¸º0.
å½“å‡ºç°è¿™ç§æ‰§è¡Œè·¯å¾„æ—¶ï¼Œå°±ä¼šå‡ºç° x == y == 0çš„æƒ…å†µäº†ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ç»¼ä¸Šï¼Œ[a] = 1 å’Œ r1 = [b] è¿™ä¸¤æ¡æŒ‡ä»¤ï¼Œå…¶æ‰§è¡Œçš„ç»“æœç›¸å½“äºé‡æ–°æ’åºäº†ï¼š r1 = [b], [a] = 1ã€‚è¿™é‡Œè¯´çš„é‡æ’åºï¼Œæ˜¯æŒ‡åœ¨å…¶å®ƒCPUçš„è§†è§’æ¥çœ‹ï¼Œä¸¤æ¡æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚åœ¨æ‰§è¡ŒCPU è‡ªèº«æ¥çœ‹ï¼Œæ˜¯ä¸å­˜åœ¨é‡æ’åºçš„é—®é¢˜çš„ï¼ŒCPU çš„ä¼˜åŒ–æ€»æ˜¯ä¿è¯ç¬¦åˆå•çº¿ç¨‹çš„è¯­ä¹‰ä¸å˜çš„ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;si-chong-zhong-pai-xu&quot;&gt;å››ç§é‡æ’åº&lt;&#x2F;h2&gt;
&lt;p&gt;ä¸Šé¢çš„ç¤ºä¾‹å®é™…ä¸Šæ˜¯ä¸€æ¬¡ Store - Load çš„é‡æ’åºï¼Œä¸€å…±æœ‰å››ç§å½¢å¼çš„é‡æ’åºï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Load - Load&lt;&#x2F;li&gt;
&lt;li&gt;Store - Store&lt;&#x2F;li&gt;
&lt;li&gt;Load - Store&lt;&#x2F;li&gt;
&lt;li&gt;Store - Load&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ä¸åŒçš„CPUæœ‰ä¸åŒçš„æŒ‡ä»¤é‡æ’åºç­–ç•¥ï¼Œè€Œåœ¨X86ä¸­ï¼Œåªæœ‰ Store Load æ˜¯ä¼šå‡ºç°é‡æ’åºçš„ï¼Œè€Œå…¶å®ƒçš„ä¸‰ç§ï¼š Load Load, Load Store, Store Store éƒ½ä¸ä¼šå‡ºç°é‡æ’åºã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Load Loadï¼Œ Store Store ä¸ä¼šé‡æ’åºã€‚
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;java-volatile&#x2F;media&#x2F;15744362994853&#x2F;15765027225748.jpg&quot; alt=&quot;&quot; &#x2F;&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœ r1 = 1, åˆ™æ„å‘³ç€ [y] = 1 å·²æ‰§è¡Œï¼Œ åˆ™ [x] = 1 å¿…ç„¶å·²æ‰§è¡Œ&lt;&#x2F;li&gt;
&lt;li&gt;r2 = [x] å¿…é¡»æ™šäº r1 = [y]ï¼Œå› æ­¤ï¼Œr2 ä¸€å®šç­‰äº1&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Load Store ä¸ä¼šé‡æ’åº
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;java-volatile&#x2F;media&#x2F;15744362994853&#x2F;15765030906230.jpg&quot; alt=&quot;&quot; &#x2F;&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœ r1 == 1ï¼Œåˆ™æ„å‘³ç€ [x] = 1 å·²ç»æ‰§è¡Œï¼Œç”±äº Load Store ä¸èƒ½é‡æ’åºï¼Œ r2 = [y] = 0&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœ r2 == 1, åˆ™æ„å‘³ [y] = 1å·²ç»æ‰§è¡Œï¼Œæ­¤æ—¶ r1 = [x] = 0ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Store Load å¯èƒ½ä¼šå‡ºç°é‡æ’åºã€‚è¿™ä¸ªå·²ç»åœ¨ä¸Šé¢çš„æ¡ˆåˆ—ä¸­è¯´æ˜ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;å¯¹å…¶ä»–çš„CPUï¼Œå¦‚Armï¼Œå¯èƒ½ä¼šæœ‰ä¸åŒçš„æŒ‡ä»¤é‡æ’åºé™åˆ¶ï¼Œå…·ä½“æƒ…å†µå¦‚ä½•ï¼Œä½œè€…å¯¹Armä¸ç†Ÿæ‚‰ï¼Œæ²¡æ‰¾æœé›†åˆ°è¿™æ–¹é¢çš„èµ„æ–™ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;fang-zhi-zhong-pai-xu&quot;&gt;é˜²æ­¢é‡æ’åº&lt;&#x2F;h2&gt;
&lt;p&gt;ä¸ºäº†é˜²æ­¢å†…å­˜é‡æ’åºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ æŒ‡ä»¤å’ŒæŒ‡ä»¤ä¹‹é—´æ’å…¥ä¸€äº›ç‰¹å®šçš„æŒ‡ä»¤ï¼Œæ¥é˜²æ­¢é‡æ’åºã€‚è¿™äº›æŒ‡ä»¤ç§°ä¹‹ä¸º memory barriersï¼Œ æˆ–è€… memory fenceã€‚æœ‰å››ç§ç±»å‹çš„å†…å­˜å±éšœã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;LoadLoad.
Load1 LoadLoad Load2 åœ¨ä¸¤æ¡ LoadæŒ‡ä»¤ä¹‹é—´æ’å…¥ LoadLoadï¼Œå¯ä»¥ç¡®ä¿ä¸¤æ¡LoadæŒ‡ä»¤ä¸è¢«é‡æ’åºã€‚å¯¹X86æ¥è¯´ï¼Œä¸éœ€è¦ LoadLoad å±éšœã€‚&lt;&#x2F;li&gt;
&lt;li&gt;StoreStore
Store1 StoreStore Store2 åœ¨ä¸¤æ¡ Store æŒ‡ä»¤ä¹‹é—´æ’å…¥ StoreStoreï¼Œå¯ä»¥ç¡®ä¿ä¸¤æ¡ Store æŒ‡ä»¤ä¸è¢«é‡æ’åºã€‚å¯¹ X86æ¥è¯´ï¼Œä¸éœ€è¦ StoreStoreå±éšœã€‚&lt;&#x2F;li&gt;
&lt;li&gt;LoadStore
Load1 LoadStore Store2 åœ¨Loadå’ŒStoreæŒ‡ä»¤ä¹‹é—´æ’å…¥ LoadStoreï¼Œå¯ä»¥ç¡®ä¿Load1 Store2æŒ‡ä»¤ä¸è¢«é‡æ‹è®¯ã€‚å¯¹X86æ¥è¯´ï¼Œä¸éœ€è¦ Load StoreæŒ‡ä»¤ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;StoreLoad
Store1 StoreLoad Load2 åœ¨ Store1å’ŒLoad2ä¹‹é—´æ’å…¥ StoreLoadï¼Œå¯ä»¥ç²¾è‡´ StoreLoad é‡æ’åºã€‚è¿™æ˜¯ X86 æ‰€éœ€è¦çš„ã€‚X86 æä¾› sfence, lfence, mfence ä¸‰ç§å†…å­˜å±éšœæŒ‡ä»¤ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;volatile&quot;&gt;volatile&lt;&#x2F;h1&gt;
&lt;p&gt;lock addl $0, [esp]&lt;&#x2F;p&gt;
&lt;h1 id=&quot;putorderedlong&quot;&gt;putOrderedLong&lt;&#x2F;h1&gt;
&lt;h1 id=&quot;putlongvolatile&quot;&gt;putLongVolatile&lt;&#x2F;h1&gt;
&lt;p&gt;å¼•è¿°ï¼šã€ŠIntel 64 and IA-32 Architecturesã€‹&lt;code&gt;8.2.3 Examples Illustrating the Memory-Ordering Principles&lt;&#x2F;code&gt; ä¸€æ–‡ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è®²è¿°å†…å®¹ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;volatile å¯¹ JavaC çš„å½±å“ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;volatile å¯¹ JVM çš„å½±å“&lt;&#x2F;li&gt;
&lt;li&gt;unsafe.putOrderedLong æ˜¯ä»€ä¹ˆæ„æ€&lt;&#x2F;li&gt;
&lt;li&gt;What&#x27;s happen-before and memory-oder? èƒ½ç»™æˆ‘ä¸€ä¸ªåä¾‹å—ï¼Ÿ&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;ul&gt;
&lt;li&gt;write back&lt;&#x2F;li&gt;
&lt;li&gt;write through&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;store-store-load-load-not-reordered&quot;&gt;Store-Store, Load-Load not reordered&lt;&#x2F;h2&gt;
&lt;h2 id=&quot;load-store-not-reordered&quot;&gt;Load-Store not reordered&lt;&#x2F;h2&gt;
&lt;h2 id=&quot;store-load-maybe-reordered&quot;&gt;Store-Load maybe reordered.&lt;&#x2F;h2&gt;
&lt;p&gt;è¿™ä¸ªæ¡ˆä¾‹å’Œ DCL æ˜¯ç›¸åŒçš„æ¦‚å¿µçš„ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-java &quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;package &lt;&#x2F;span&gt;&lt;span&gt;demo;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;java.util.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Queue&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;java.util.concurrent.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;BlockingDeque&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;java.util.concurrent.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;BlockingQueue&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;java.util.concurrent.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;LinkedBlockingQueue&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Test1 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Thread1
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Thread2
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; thread submit a req and waiting a response
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; thread2 process req and subit a response
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;BlockingQueue&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Task&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;&amp;gt; queue &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;LinkedBlockingQueue&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;&amp;lt;&amp;gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Task &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;request;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;response;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Consumer &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;extends &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Thread &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;Consumer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;setDaemon&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        @&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Override
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;run&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;() {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Task&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; task &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; queue.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;take&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    task.response &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; task.request.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;toUpperCase&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;synchronized &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(task) {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                        task.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;notify&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;catch&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;InterruptedException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;ex&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    ex.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;printStackTrace&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;            }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Producer &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;extends &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Thread &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        @&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Override
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;run&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;() {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; count &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Task&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; task &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Task&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                task.request &lt;&#x2F;span&gt;&lt;span&gt;= &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Hello&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                queue.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;offer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(task);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;synchronized &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(task){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(task.response &lt;&#x2F;span&gt;&lt;span&gt;== &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;null&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;) {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                            task.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;wait&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;60_000&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                        }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;catch&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;InterruptedException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;ex&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                        }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(task.response &lt;&#x2F;span&gt;&lt;span&gt;== &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;null&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;){ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; do volatile required?
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;System&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;.out.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;println&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;reponse is null at &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; +&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; count);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;System&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;exit&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;break&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                count &lt;&#x2F;span&gt;&lt;span&gt;+= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(count &lt;&#x2F;span&gt;&lt;span&gt;% &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1000_000 &lt;&#x2F;span&gt;&lt;span&gt;== &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;) {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;System&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;.out.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;println&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;runs &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; +&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; count&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1000_000 &lt;&#x2F;span&gt;&lt;span&gt;+ &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;M turns&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;            }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;runTest&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Producer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;start&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Producer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;start&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Producer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;start&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Producer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;start&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Consumer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;start&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Consumer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;start&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public static void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;args&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;) {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Test1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;runTest&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;hou-ji&quot;&gt;åè®°&lt;&#x2F;h1&gt;
&lt;p&gt;2025-04-07 å­¦ä¹ ã€Šè¶…æ ‡é‡å¤„ç†å™¨è®¾è®¡ã€‹ï¼Œå¯¹CPU ISA(å¾®æ¶æ„)æœ‰ä¸€å®šç†è§£åï¼Œå¯ä»¥æ›´å¥½çš„ç†è§£è¿™ä¸ªé—®é¢˜&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹è¶…æ ‡é‡å¤„ç†å™¨ã€å¤šå‘å°„ã€ä¹±åºæ‰§è¡Œæƒ…å†µä¸‹ï¼Œç†è®ºä¸ŠæŒ‡ä»¤ä»å‰ç«¯è§£ç åï¼Œä¼šè¿›å…¥åˆ°åç«¯å‘å°„é˜Ÿåˆ—ã€‚æ­¤åï¼Œå…¶æ‰§è¡Œæ˜¯ä¹±åºçš„ã€‚å¯èƒ½ä¼šå‡ºç°åé¢çš„æŒ‡ä»¤å…ˆæ‰§è¡Œï¼Œ
å‰é¢çš„æŒ‡ä»¤åæ‰§è¡Œçš„æƒ…å†µã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ROB(Reorder Buffer) ä¹±åºæ‰§è¡Œçš„æŒ‡ä»¤ï¼Œå¯èƒ½ä¼šåœ¨ROBä¸­ç­‰å¾…å¾ˆé•¿æ—¶é—´ï¼Œæ‰ä¼šè¢«æäº¤åˆ°å†…å­˜ä¸­ã€‚è¿™ä¸ªä¸»è¦æ˜¯å¯¹å•ä¸ªçº¿ç¨‹çš„æœ‰åºæ€§è€Œè¨€ï¼Œä¸»è¦æ˜¯é’ˆå¯¹åº”ç”¨å¯è§çš„å¯„å­˜å™¨ã€å†…å­˜çš„å¯è§æ€§è€Œè¨€ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨æ‰§è¡ŒæŒ‡ä»¤æ—¶çš„å†…å­˜æœ‰åºæ€§ï¼Œå­˜åœ¨ Load-Load, Store-Store, Load-Store, Store-Load å››ç§æƒ…å†µã€‚ä¸åŒçš„ CPU æ¶æ„æœ‰ä¸åŒçš„å®ç°ã€‚
&lt;ul&gt;
&lt;li&gt;x86 æ¶æ„ä¸‹ï¼ŒLoad-Load, Store-Store ä¸ä¼šé‡æ’åºï¼ŒLoad-Store ä¸ä¼šé‡æ’åºï¼ŒStore-Load å¯èƒ½ä¼šé‡æ’åºã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ARM æ¶æ„ä¸‹ï¼Œéƒ½ä¼šå‡ºç°é‡æ’åºï¼Œéœ€è¦æ˜¾ç¤ºä½¿ç”¨å†…å­˜å±éšœã€‚ä¼˜ç‚¹æ˜¯å®¹è®¸æ›´å¤šçš„æŒ‡ä»¤é‡æ’ï¼Œä»è€Œæå‡ IPCï¼Œä½†å¹¶å‘åœºæ™¯ä¸­éœ€è¦æ›´å¤šçš„å†…å­˜å±éšœã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;load-load-zhe-ge-an-li-dai-gai-jin&quot;&gt;Load-Load (è¿™ä¸ªæ¡ˆä¾‹å¾…æ”¹è¿›)&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;c&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-c &quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å…±äº«å˜é‡
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt; data = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;bool&lt;&#x2F;span&gt;&lt;span&gt; ready = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Thread A: å†™å…¥æ•°æ®
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;writer&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;    data = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;42&lt;&#x2F;span&gt;&lt;span&gt;;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å†™æ“ä½œ
&lt;&#x2F;span&gt;&lt;span&gt;    ready = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span&gt;;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å†™æ ‡è®°
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Thread B: è¯»å–æ•°æ®
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;reader&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while &lt;&#x2F;span&gt;&lt;span&gt;(!ready) { &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;* ç­‰å¾… *&#x2F; &lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt; local_data_1 = data;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Load 1
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt; local_data_2 = data;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Load 2
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;assert&lt;&#x2F;span&gt;&lt;span&gt;(local_data_1 == local_data_2);  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; æ–­è¨€åº”æ€»æˆç«‹
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;store-store&quot;&gt;Store-Store&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;c&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-c &quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å…±äº«å˜é‡
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt; a = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt; b = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Thread A: å†™å…¥ä¸¤ä¸ªå˜é‡
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;writer&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;    a = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Store 1
&lt;&#x2F;span&gt;&lt;span&gt;    b = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Store 2
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Thread B: æ£€æŸ¥å†™å…¥é¡ºåº
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;reader&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while &lt;&#x2F;span&gt;&lt;span&gt;(b != &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;) { &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;* ç­‰å¾… *&#x2F; &lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;assert&lt;&#x2F;span&gt;&lt;span&gt;(a == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;);  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; è‹¥ Store-Store é‡æ’å¯¼è‡´ b=2 å…ˆäº a=1ï¼Œåˆ™æ–­è¨€å¤±è´¥
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;load-store-ci-an-li-dai-gai-jin&quot;&gt;Load-Store(æ­¤æ¡ˆä¾‹å¾…æ”¹è¿›)&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;c&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-c &quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å…±äº«å˜é‡
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt; data = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;bool&lt;&#x2F;span&gt;&lt;span&gt; ready = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Thread A: å†™å…¥æ•°æ®
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;writer&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;    data = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;42&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    ready = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span&gt;;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å†™æ ‡è®°
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Thread B: è¯»å–æ•°æ®åç«‹å³å†™å…¥æ–°å€¼
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;reader&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while &lt;&#x2F;span&gt;&lt;span&gt;(!ready) { &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;* ç­‰å¾… *&#x2F; &lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span&gt; local_data = data;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Load
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;DMB&lt;&#x2F;span&gt;&lt;span&gt;(LD);        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; å‡è®¾æ­¤å¤„ç¼ºå°‘å±éšœ
&lt;&#x2F;span&gt;&lt;span&gt;    data = local_data + &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Store
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>æ— ç«¯å”¤é†’</title>
        <published>2021-06-10T00:00:00+00:00</published>
        <updated>2021-06-10T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/spurious-weakup/"/>
        <id>https://wangzaixiang.github.io/blog/spurious-weakup/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/spurious-weakup/">&lt;h1 id=&quot;wu-duan-huan-xing-spurious-wakeup&quot;&gt;æ— ç«¯å”¤é†’ï¼ˆspurious wakeupï¼‰&lt;&#x2F;h1&gt;
&lt;p&gt;å‰äº›æ—¶é—´ï¼Œæˆ‘ä»¬è‡ªç ”çš„ä¸€æ¬¾ Redis é©±åŠ¨ï¼Œæœ‰ååº”å­˜åœ¨å¦‚ä¸‹çš„ç°è±¡ï¼šå¶å°”ä¼šå‡ºç° redis å‘é€å‘½ä»¤ï¼Œåœ¨æ²¡æœ‰è¶…æ—¶çš„æƒ…å†µä¸‹ï¼Œå´è¿”å›äº†â€œæ²¡æœ‰æ”¶åˆ°è¿”å›ç»“æœâ€çš„æƒ…å†µï¼Œè™½ç„¶å‡ ç‡å¾ˆä½ï¼Œä½†ä¹Ÿæ˜¯æ–­æ–­ç»­ç»­å‡ºç°äº†å‡ æ¬¡ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªéå¸¸éšè—çš„ BUGã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸ºäº†å®šä½è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†ç›¸å…³çš„é€»è¾‘è¿›è¡Œäº†ç®€åŒ–ï¼Œç¼–å†™äº†å¦‚ä¸‹ç­‰æ•ˆçš„ä»£ç ï¼Œæ£€æµ‹æ˜¯å¦ä¼šé‡ç°é—®é¢˜ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-java &quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;package &lt;&#x2F;span&gt;&lt;span&gt;demo;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;java.util.concurrent.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;BlockingQueue&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;java.util.concurrent.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;LinkedBlockingQueue&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;java.util.concurrent.atomic.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;AtomicInteger&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Test1 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;BlockingQueue&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Task&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;&amp;gt; queue &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;LinkedBlockingQueue&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;&amp;lt;&amp;gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;100&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Task &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;request;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;response;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Consumer &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;extends &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Thread &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;Consumer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;setDaemon&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        @&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Override
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;run&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;() {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Task&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; task &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; queue.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;take&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;synchronized &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(task) {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                        task.response &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; task.request.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;toUpperCase&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();  
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                        task.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;notify&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;catch&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;InterruptedException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;ex&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    ex.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;printStackTrace&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;            }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Producer &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;extends &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Thread &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        @&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Override
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;run&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;() {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;int&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; count &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;final &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Task&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; task &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Task&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                task.request &lt;&#x2F;span&gt;&lt;span&gt;= &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Hello&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; visible to others?
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;boolean&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; offOK &lt;&#x2F;span&gt;&lt;span&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; queue.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;offer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(task);  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; check offer
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(offOK &lt;&#x2F;span&gt;&lt;span&gt;== &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;) {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;System&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;.out.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;println&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;offer failed, retry&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;continue&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;boolean&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; waitOk &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;long&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; start, end;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;synchronized &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(task){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(task.response &lt;&#x2F;span&gt;&lt;span&gt;== &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;null&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;) {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                            task.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;wait&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;60_000&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                            waitOk &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(task.response &lt;&#x2F;span&gt;&lt;span&gt;== &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;null&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;){ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; do volatile required?
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;System&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;.out.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;println&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;reponse is null waitok = &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; +&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; waitOk &lt;&#x2F;span&gt;&lt;span&gt;+ &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt; waitTime:&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; +&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; count);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;System&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;exit&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;break&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                            }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                        }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;catch&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;InterruptedException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;ex&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                            ex.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;printStackTrace&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                        }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                count &lt;&#x2F;span&gt;&lt;span&gt;+= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(count &lt;&#x2F;span&gt;&lt;span&gt;% &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1000_000 &lt;&#x2F;span&gt;&lt;span&gt;== &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;) {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;System&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;.out.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;println&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;runs &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; +&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt; count&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1000_000 &lt;&#x2F;span&gt;&lt;span&gt;+ &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;M turns&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;);
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;                }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;            }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;runTest&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Producer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;start&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Consumer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;start&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public static void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;args&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;) {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Test1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;runTest&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;è¿™ä¸ªä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…æ¨¡å‹ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;ç”Ÿäº§è€…ï¼šå¾€é˜Ÿåˆ—ä¸­æäº¤ä¸€ä¸ªæ¶ˆæ¯ï¼ˆTaskï¼‰ï¼Œç­‰å¾…æ¶ˆè´¹è€…å¤„ç†å®Œåå”¤é†’ç”Ÿäº§è€…ã€‚æœŸæœ› Task ä¸­çš„responseå·²ç»æœ‰æ­£ç¡®çš„å€¼ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ¶ˆè´¹è€…ï¼šç­‰å¾…é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œå¤„ç†å®Œä¸€æ¡æ¶ˆæ¯åï¼Œå”¤é†’ç”Ÿäº§è€…ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è¿è¡Œå¦‚ä¸Šçš„æµ‹è¯•ä»£ç ï¼Œå¾ˆå¿«å°±å¯ä»¥é‡ç°é—®é¢˜ï¼Œå¯èƒ½åœ¨5ç™¾ä¸‡æ¬¡è‡³1-2äº¿æ¬¡å¾ªç¯åï¼Œç¨‹åºæ‰“å° &lt;code&gt;reponse is null &lt;&#x2F;code&gt;åé€€å‡ºã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æœ€å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„æ€€ç–‘ç‚¹æ˜¯ï¼šConsumer çº¿ç¨‹ä¸­æ‰§è¡Œçš„ &lt;code&gt;task.response = task.request.toUppercase()&lt;&#x2F;code&gt; ç»“æœå¯¹ Producer çº¿ç¨‹ä¸å¯è§ã€‚ï¼ˆä½†æŒ‰ç…§ synchronize çš„è¯­ä¹‰ï¼Œåœ¨ synchronize å—monitor exitç¦»å¼€æ—¶ï¼Œæ•°æ®ä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ï¼‰ï¼Œæˆ‘ä»¬å°è¯•å°† response å­—æ®µä¿®é¥°ä¸º volatileï¼Œ ä½†ç»“æœä»ç„¶ä¼šå‡ºç°åŒæ ·çš„é—®é¢˜ï¼Œå› æ­¤ï¼Œé—®é¢˜ï¼Œå¹¶ä¸å¤„åœ¨ synchronize&#x2F;volatile å¼•èµ·çš„æ•°æ®å¯è§æ€§æ–¹é¢ã€‚&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;å…³äºJMMçš„å­¦ä¹ ï¼Œå¼ºçƒˆæ¨èï¼š&lt;a href=&quot;https:&#x2F;&#x2F;www.infoq.cn&#x2F;minibook&#x2F;java_memory_model?utm_source=related_read&amp;amp;utm_medium=article&quot;&gt;æ·±å…¥ç†è§£Javaå†…å­˜æ¨¡å‹&lt;&#x2F;a&gt;ï¼Œä»¥åŠå¯¹ç…§æŸ¥çœ‹ &lt;a href=&quot;https:&#x2F;&#x2F;docs.oracle.com&#x2F;javase&#x2F;specs&#x2F;jls&#x2F;se15&#x2F;html&#x2F;jls-17.html#jls-17.4&quot;&gt;JMMå®˜æ–¹æ–‡æ¡£&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;å› ä¸ºè¿™æ®µä»£ç èƒ½å¤Ÿæ›´å¥½çš„è¿›è¡Œé—®é¢˜çš„é‡ç°ï¼ˆè€ŒåŸ Redis é©±åŠ¨è¦é‡ç°è¿™ä¸ªé—®é¢˜ï¼Œåˆ™éœ€è¦æ•°å¤©çš„æ—¶é—´ï¼‰ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯¹è¿™æ®µä»£ç ç•¥ä½œæ”¹é€ ï¼Œåœ¨å‡ºç°å¼‚å¸¸çš„ä»£ç ç‚¹ä¸Šï¼Œæ·»åŠ äº†ä¸€äº›è°ƒè¯•ä»£ç ï¼Œç»“æœå‘ç°äº†ä¸€ä¸ªæœ‰æ„æ€çš„ç°è±¡ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ç”Ÿäº§è€…è¿›å…¥åˆ° &lt;code&gt;System.exit&lt;&#x2F;code&gt;æ—¶ï¼Œ ç›¸åº”çš„æ¶ˆè´¹è€…è¿˜æ²¡æœ‰è¿›å…¥åˆ° &lt;code&gt;synchronzie&lt;&#x2F;code&gt; å—ä¸­ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‰çš„Consumerå¹¶æ²¡æœ‰å¼€å§‹æ¶ˆè´¹ Taskï¼Œè‡ªç„¶ä¹Ÿæ²¡æœ‰è¿›è¡Œ notify è°ƒç”¨ï¼Œä½†Producerçš„ wait å´åœ¨æ²¡æœ‰ä»»ä½•å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œå·²ç»è¿”å›äº†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è¿™ä¸ªæ—¶å€™ï¼Œå†ä»”ç»†é˜…è¯»ä¸€ä¸‹ Object.wait çš„æ–‡æ¡£ï¼š&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;A thread can also wake up without being notified, interrupted, or
timing out, a so-called &lt;i&gt;spurious wakeup&lt;&#x2F;i&gt;.  While this will rarely
occur in practice, applications must guard against it by testing for
the condition that should have caused the thread to be awakened, and
continuing to wait if the condition is not satisfied.  In other words,
waits should always occur in loops, like this one:&lt;&#x2F;p&gt;
&lt;pre&gt;
  synchronized (obj) {
      while (&amp;lt;condition does not hold&amp;gt;)
          obj.wait(timeout);
      ... &#x2F;&#x2F; Perform action appropriate to condition
  }
&lt;&#x2F;pre&gt;
&lt;p&gt;(For more information on this topic, see Section 3.2.3 in Doug Lea&#x27;s
&quot;Concurrent Programming in Java (Second Edition)&quot; (Addison-Wesley,
2000), or Item 50 in Joshua Bloch&#x27;s &quot;Effective Java Programming
Language Guide&quot; (Addison-Wesley, 2001).&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;çœ‹æ¥ä¹‹å‰éƒ½å¿½ç•¥äº†è¿™ä¸ª spurious wakeup (æ— ç«¯å”¤é†’)ã€‚æŒ‰ç…§è¿™ä¸ªæ–‡æ¡£çš„æŒ‡å¯¼ï¼Œä¸Šè¿°çš„ä»£ç åº”è¯¥é‡å†™ä¸ºï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-java &quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;synchronized&lt;&#x2F;span&gt;&lt;span&gt;(task) {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;long&lt;&#x2F;span&gt;&lt;span&gt; begin = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;System&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;currentTimeMillis&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;while&lt;&#x2F;span&gt;&lt;span&gt;(task.response == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;null&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;long&lt;&#x2F;span&gt;&lt;span&gt; now = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;System&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;currentTimeMillis&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;long&lt;&#x2F;span&gt;&lt;span&gt; waitTime = begin + &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;60_000&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;L &lt;&#x2F;span&gt;&lt;span&gt;- now;
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt;(waitTime &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;) 
&lt;&#x2F;span&gt;&lt;span&gt;                    task.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;wait&lt;&#x2F;span&gt;&lt;span&gt;(waitTime);
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;catch&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;InterruptedException &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;ex&lt;&#x2F;span&gt;&lt;span&gt;){
&lt;&#x2F;span&gt;&lt;span&gt;                ex.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;printStackTrace&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if&lt;&#x2F;span&gt;&lt;span&gt;(task.response == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;null&lt;&#x2F;span&gt;&lt;span&gt;) { &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; do volatile required?
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;System&lt;&#x2F;span&gt;&lt;span&gt;.out.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;println&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;reponse is null waitok = &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; + count);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;System&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;exit&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;break&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;xiao-jie&quot;&gt;å°ç»“&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;Object.wait ä¼šè¢«æ— ç«¯å”¤é†’ï¼Œè¿™ä¸ªçŸ¥è¯†ç‚¹è¾ƒä¸ºå†·é—¨ã€‚å¦‚æœæ²¡æœ‰å…³æ³¨åˆ°è¿™ä¸ªç‚¹çš„è¯ï¼Œwait&#x2F;notify å¾ˆå¯èƒ½ä¼šå‡ºç°å°å‡ ç‡çš„æ˜¯å¤±è´¥ï¼ˆåœ¨ä¸Šäº¿çº§è°ƒç”¨çš„åœºæ™¯ä¸‹ï¼Œåˆ™è¿‘ä¹æ˜¯å¤§å‡ ç‡äº‹ä»¶ï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹å°å‡ ç‡å‡ºç°çš„å¹¶å‘é—®é¢˜ï¼Œéœ€è¦ä¸¥é‡ä»¥å¾…ï¼Œè¿™äº›äº‹ä»¶å‡ ä¹è‚¯å®šæ˜¯ç¨‹åºçš„Bugï¼Œå‡ºç°ä¸€æ¬¡ï¼Œå°±æ„å‘³ç€ä¸€å®šä¼šæœ‰ç¬¬äºŒæ¬¡å’Œæ›´å¤šæ¬¡ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä¼´éšè¿™ä¸ªé—®é¢˜çš„è§£å†³ï¼Œæˆ‘å‡ ä¹é‡æ¸©äº†ä¸€é JMMï¼Œåœ¨é€ä¸€æ’æŸ¥çš„è¿‡ç¨‹ä¸­ï¼Œä¼¼ä¹åˆæ·±å…¥ç†è§£äº†ä¸€äº›ã€‚è¿™äº›æ¡ˆä¾‹å¸¦ç»™æˆ‘ä»¬çš„å¸®åŠ©ï¼Œç›¸æ¯”å•çº¯çš„å­¦ä¹ è¦æ•ˆæœå¥½å¾ˆå¤šã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>FAQ</title>
        <published>2021-05-01T19:30:00+00:00</published>
        <updated>2021-05-01T19:30:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/docs/help/faq/"/>
        <id>https://wangzaixiang.github.io/docs/help/faq/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/docs/help/faq/">&lt;h2 id=&quot;what-is-the-adidoks&quot;&gt;What is the AdiDoks?&lt;&#x2F;h2&gt;
&lt;p&gt;AdiDoks is a Zola theme for Documentation&#x27;s sites, ported by the Hugo Theme
&lt;a href=&quot;https:&#x2F;&#x2F;getdoks.org&quot;&gt;Doks&lt;&#x2F;a&gt;, which is a pretty nice theme. Thanks a lot to
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;h-enk&quot;&gt;&lt;em&gt;h-enk&lt;&#x2F;em&gt;&lt;&#x2F;a&gt;, the creator of the &lt;a href=&quot;https:&#x2F;&#x2F;getdoks.org&quot;&gt;Doks&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;keyboard-shortcuts-for-search&quot;&gt;Keyboard shortcuts for search?&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;focus: &lt;code&gt;&#x2F;&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;select: &lt;code&gt;â†“&lt;&#x2F;code&gt; and &lt;code&gt;â†‘&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;open: &lt;code&gt;Enter&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;close: &lt;code&gt;Esc&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;other-documentation&quot;&gt;Other documentation?&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.netlify.com&#x2F;&quot;&gt;Netlify&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.getzola.org&#x2F;documentation&#x2F;getting-started&#x2F;overview&#x2F;&quot;&gt;Zola&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;contact-the-creator&quot;&gt;Contact the creator?&lt;&#x2F;h2&gt;
&lt;p&gt;Send &lt;em&gt;Aaran Xu&lt;&#x2F;em&gt; an E-mail:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;mailto:aaranxu@outlook.com&quot;&gt;aaranxu@outlook.com&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Code of Conduct</title>
        <published>2021-05-01T18:20:00+00:00</published>
        <updated>2021-05-01T18:20:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/docs/contributing/code-of-conduct/"/>
        <id>https://wangzaixiang.github.io/docs/contributing/code-of-conduct/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/docs/contributing/code-of-conduct/">&lt;h2 id=&quot;our-pledge&quot;&gt;Our Pledge&lt;&#x2F;h2&gt;
&lt;p&gt;We as members, contributors, and leaders pledge to make participation in our
community a harassment-free experience for everyone, regardless of age, body
size, visible or invisible disability, ethnicity, sex characteristics, gender
identity and expression, level of experience, education, socio-economic status,
nationality, personal appearance, race, caste, color, religion, or sexual identity
and orientation.&lt;&#x2F;p&gt;
&lt;p&gt;We pledge to act and interact in ways that contribute to an open, welcoming,
diverse, inclusive, and healthy community.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;our-standards&quot;&gt;Our Standards&lt;&#x2F;h2&gt;
&lt;p&gt;Examples of behavior that contributes to a positive environment for our
community include:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Demonstrating empathy and kindness toward other people&lt;&#x2F;li&gt;
&lt;li&gt;Being respectful of differing opinions, viewpoints, and experiences&lt;&#x2F;li&gt;
&lt;li&gt;Giving and gracefully accepting constructive feedback&lt;&#x2F;li&gt;
&lt;li&gt;Accepting responsibility and apologizing to those affected by our mistakes,
and learning from the experience&lt;&#x2F;li&gt;
&lt;li&gt;Focusing on what is best not just for us as individuals, but for the
overall community&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Examples of unacceptable behavior include:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;The use of sexualized language or imagery, and sexual attention or
advances of any kind&lt;&#x2F;li&gt;
&lt;li&gt;Trolling, insulting or derogatory comments, and personal or political attacks&lt;&#x2F;li&gt;
&lt;li&gt;Public or private harassment&lt;&#x2F;li&gt;
&lt;li&gt;Publishing others&#x27; private information, such as a physical or email
address, without their explicit permission&lt;&#x2F;li&gt;
&lt;li&gt;Other conduct which could reasonably be considered inappropriate in a
professional setting&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;enforcement-responsibilities&quot;&gt;Enforcement Responsibilities&lt;&#x2F;h2&gt;
&lt;p&gt;Community leaders are responsible for clarifying and enforcing our standards of
acceptable behavior and will take appropriate and fair corrective action in
response to any behavior that they deem inappropriate, threatening, offensive,
or harmful.&lt;&#x2F;p&gt;
&lt;p&gt;Community leaders have the right and responsibility to remove, edit, or reject
comments, commits, code, wiki edits, issues, and other contributions that are
not aligned to this Code of Conduct, and will communicate reasons for moderation
decisions when appropriate.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;scope&quot;&gt;Scope&lt;&#x2F;h2&gt;
&lt;p&gt;This Code of Conduct applies within all community spaces, and also applies when
an individual is officially representing the community in public spaces.
Examples of representing our community include using an official e-mail address,
posting via an official social media account, or acting as an appointed
representative at an online or offline event.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;enforcement&quot;&gt;Enforcement&lt;&#x2F;h2&gt;
&lt;p&gt;Instances of abusive, harassing, or otherwise unacceptable behavior may be
reported to the community leaders responsible for enforcement at
&lt;a href=&quot;mailto:aaranxu@outlook.com&quot;&gt;aaranxu@outlook.com&lt;&#x2F;a&gt;.
All complaints will be reviewed and investigated promptly and fairly.&lt;&#x2F;p&gt;
&lt;p&gt;All community leaders are obligated to respect the privacy and security of the
reporter of any incident.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;enforcement-guidelines&quot;&gt;Enforcement Guidelines&lt;&#x2F;h2&gt;
&lt;p&gt;Community leaders will follow these Community Impact Guidelines in determining
the consequences for any action they deem in violation of this Code of Conduct:&lt;&#x2F;p&gt;
&lt;h3 id=&quot;1-correction&quot;&gt;1. Correction&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;Community Impact&lt;&#x2F;strong&gt;: Use of inappropriate language or other behavior deemed
unprofessional or unwelcome in the community.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Consequence&lt;&#x2F;strong&gt;: A private, written warning from community leaders, providing
clarity around the nature of the violation and an explanation of why the
behavior was inappropriate. A public apology may be requested.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;2-warning&quot;&gt;2. Warning&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;Community Impact&lt;&#x2F;strong&gt;: A violation through a single incident or series
of actions.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Consequence&lt;&#x2F;strong&gt;: A warning with consequences for continued behavior. No
interaction with the people involved, including unsolicited interaction with
those enforcing the Code of Conduct, for a specified period of time. This
includes avoiding interactions in community spaces as well as external channels
like social media. Violating these terms may lead to a temporary or
permanent ban.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;3-temporary-ban&quot;&gt;3. Temporary Ban&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;Community Impact&lt;&#x2F;strong&gt;: A serious violation of community standards, including
sustained inappropriate behavior.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Consequence&lt;&#x2F;strong&gt;: A temporary ban from any sort of interaction or public
communication with the community for a specified period of time. No public or
private interaction with the people involved, including unsolicited interaction
with those enforcing the Code of Conduct, is allowed during this period.
Violating these terms may lead to a permanent ban.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;4-permanent-ban&quot;&gt;4. Permanent Ban&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;Community Impact&lt;&#x2F;strong&gt;: Demonstrating a pattern of violation of community
standards, including sustained inappropriate behavior,  harassment of an
individual, or aggression toward or disparagement of classes of individuals.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Consequence&lt;&#x2F;strong&gt;: A permanent ban from any sort of public interaction within
the community.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;attribution&quot;&gt;Attribution&lt;&#x2F;h2&gt;
&lt;p&gt;This Code of Conduct is adapted from the &lt;a href=&quot;https:&#x2F;&#x2F;www.contributor-covenant.org&quot;&gt;Contributor Covenant&lt;&#x2F;a&gt;,
version 2.0, available at
&lt;a href=&quot;https:&#x2F;&#x2F;www.contributor-covenant.org&#x2F;version&#x2F;2&#x2F;0&#x2F;code_of_conduct.html&quot;&gt;https:&#x2F;&#x2F;www.contributor-covenant.org&#x2F;version&#x2F;2&#x2F;0&#x2F;code_of_conduct.html&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Community Impact Guidelines were inspired by
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;mozilla&#x2F;diversity&quot;&gt;Mozilla&#x27;s code of conduct enforcement ladder&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;For answers to common questions about this code of conduct, see the FAQ at
&lt;a href=&quot;https:&#x2F;&#x2F;www.contributor-covenant.org&#x2F;faq&quot;&gt;https:&#x2F;&#x2F;www.contributor-covenant.org&#x2F;faq&lt;&#x2F;a&gt;. Translations are available
at &lt;a href=&quot;https:&#x2F;&#x2F;www.contributor-covenant.org&#x2F;translations&quot;&gt;https:&#x2F;&#x2F;www.contributor-covenant.org&#x2F;translations&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>How to Contribute</title>
        <published>2021-05-01T18:10:00+00:00</published>
        <updated>2021-05-01T18:10:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/docs/contributing/how-to-contribute/"/>
        <id>https://wangzaixiang.github.io/docs/contributing/how-to-contribute/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/docs/contributing/how-to-contribute/">&lt;p&gt;ğŸ‘‰ Make sure to read the &lt;a href=&quot;..&#x2F;code-of-conduct&#x2F;&quot;&gt;Code of Conduct&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;contribute-to-doks&quot;&gt;Contribute to Doks&lt;&#x2F;h2&gt;
&lt;p&gt;ğŸ‘‰ The AdiDoks code lives in the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;aaranxu&#x2F;adidoks&quot;&gt;&lt;code&gt;adidoks&lt;&#x2F;code&gt; repository&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Follow the &lt;a href=&quot;https:&#x2F;&#x2F;guides.github.com&#x2F;introduction&#x2F;flow&#x2F;&quot;&gt;GitHub flow&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Follow the &lt;a href=&quot;https:&#x2F;&#x2F;www.conventionalcommits.org&#x2F;en&#x2F;v1.0.0&#x2F;&quot;&gt;Conventional Commits Specification&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;create-an-issue&quot;&gt;Create an issue&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;aaranxu&#x2F;adidoks&#x2F;issues&#x2F;new?template=bug-report---.md&quot;&gt;Bug report&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;aaranxu&#x2F;adidoks&#x2F;issues&#x2F;new?template=feature-request---.md&quot;&gt;Feature request&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;improve-documentation&quot;&gt;Improve documentation&lt;&#x2F;h2&gt;
&lt;p&gt;ğŸ‘‰ The documentation lives in &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;aaranxu&#x2F;adidoks&#x2F;tree&#x2F;master&#x2F;content&#x2F;docs&quot;&gt;&lt;code&gt;.&#x2F;content&#x2F;docs&#x2F;&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;
of the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;h-enk&#x2F;getdoks.org&quot;&gt;&lt;code&gt;adidoks&lt;&#x2F;code&gt; repository&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Follow the &lt;a href=&quot;https:&#x2F;&#x2F;guides.github.com&#x2F;introduction&#x2F;flow&#x2F;&quot;&gt;GitHub flow&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Follow the &lt;a href=&quot;https:&#x2F;&#x2F;www.conventionalcommits.org&#x2F;en&#x2F;v1.0.0&#x2F;&quot;&gt;Conventional Commits Specification&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Quick Start</title>
        <published>2021-05-01T08:20:00+00:00</published>
        <updated>2021-05-01T08:20:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/docs/getting-started/quick-start/"/>
        <id>https://wangzaixiang.github.io/docs/getting-started/quick-start/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/docs/getting-started/quick-start/">&lt;h2 id=&quot;requirements&quot;&gt;Requirements&lt;&#x2F;h2&gt;
&lt;p&gt;Before using the theme, you need to install the &lt;a href=&quot;https:&#x2F;&#x2F;www.getzola.org&#x2F;documentation&#x2F;getting-started&#x2F;installation&#x2F;&quot;&gt;Zola&lt;&#x2F;a&gt; â‰¥ 0.15.0.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;run-the-theme-directly&quot;&gt;Run the Theme Directly&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; clone https:&#x2F;&#x2F;github.com&#x2F;aaranxu&#x2F;adidoks.git
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;cd&lt;&#x2F;span&gt;&lt;span&gt; adidoks
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;zola&lt;&#x2F;span&gt;&lt;span&gt; serve
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Visit &lt;code&gt;http:&#x2F;&#x2F;127.0.0.1:1111&#x2F;&lt;&#x2F;code&gt; in the browser.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;installation&quot;&gt;Installation&lt;&#x2F;h2&gt;
&lt;p&gt;Just earlier we showed you how to run the theme directly. Now we start to
install the theme in an existing site step by step.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;step-1-create-a-new-zola-site&quot;&gt;Step 1: Create a new zola site&lt;&#x2F;h3&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;zola&lt;&#x2F;span&gt;&lt;span&gt; init mysite
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;step-2-install-adidoks&quot;&gt;Step 2: Install AdiDoks&lt;&#x2F;h3&gt;
&lt;p&gt;Download this theme to your themes directory:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;cd&lt;&#x2F;span&gt;&lt;span&gt; mysite&#x2F;themes
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; clone https:&#x2F;&#x2F;github.com&#x2F;aaranxu&#x2F;adidoks.git
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Or install as a submodule:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;cd&lt;&#x2F;span&gt;&lt;span&gt; mysite
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; init  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# if your project is a git repository already, ignore this command
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; submodule add https:&#x2F;&#x2F;github.com&#x2F;aaranxu&#x2F;adidoks.git themes&#x2F;adidoks
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;step-3-configuration&quot;&gt;Step 3: Configuration&lt;&#x2F;h3&gt;
&lt;p&gt;Enable the theme in your &lt;code&gt;config.toml&lt;&#x2F;code&gt; in the site derectory:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;toml&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-toml &quot;&gt;&lt;code class=&quot;language-toml&quot; data-lang=&quot;toml&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;theme &lt;&#x2F;span&gt;&lt;span&gt;= &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;adidoks&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Or copy the &lt;code&gt;config.toml.example&lt;&#x2F;code&gt; from the theme directory to your project&#x27;s
root directory:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cp&lt;&#x2F;span&gt;&lt;span&gt; themes&#x2F;adidoks&#x2F;config.toml.example config.toml
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;step-4-add-new-content&quot;&gt;Step 4: Add new content&lt;&#x2F;h3&gt;
&lt;p&gt;You can copy the content from the theme directory to your project:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cp -r&lt;&#x2F;span&gt;&lt;span&gt; themes&#x2F;adidoks&#x2F;content .
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;You can modify or add new posts in the &lt;code&gt;content&#x2F;blog&lt;&#x2F;code&gt;, &lt;code&gt;content&#x2F;docs&lt;&#x2F;code&gt; or other
content directories as needed.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;step-5-run-the-project&quot;&gt;Step 5: Run the project&lt;&#x2F;h3&gt;
&lt;p&gt;Just run &lt;code&gt;zola serve&lt;&#x2F;code&gt; in the root path of the project:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;zola&lt;&#x2F;span&gt;&lt;span&gt; serve
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;AdiDoks will start the Zola development web server accessible by default at
&lt;code&gt;http:&#x2F;&#x2F;127.0.0.1:1111&lt;&#x2F;code&gt;. Saved changes will live reload in the browser.&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Introduction</title>
        <published>2021-05-01T08:00:00+00:00</published>
        <updated>2021-05-01T08:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/docs/getting-started/introduction/"/>
        <id>https://wangzaixiang.github.io/docs/getting-started/introduction/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/docs/getting-started/introduction/">&lt;h2 id=&quot;quick-start&quot;&gt;Quick Start&lt;&#x2F;h2&gt;
&lt;p&gt;One page summary of how to start a new AdiDoks project. &lt;a href=&quot;..&#x2F;quick-start&#x2F;&quot;&gt;Quick Start â†’&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;go-further&quot;&gt;Go further&lt;&#x2F;h2&gt;
&lt;p&gt;Contributing and Help.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;contributing&quot;&gt;Contributing&lt;&#x2F;h2&gt;
&lt;p&gt;Find out how to contribute to Doks. &lt;a href=&quot;..&#x2F;..&#x2F;contributing&#x2F;how-to-contribute&#x2F;&quot;&gt;Contributing â†’&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;help&quot;&gt;Help&lt;&#x2F;h2&gt;
&lt;p&gt;Get help on Doks. &lt;a href=&quot;..&#x2F;..&#x2F;help&#x2F;faq&#x2F;&quot;&gt;Help â†’&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>wangzaixiang</title>
        <published>2021-04-01T08:50:45+00:00</published>
        <updated>2021-04-01T08:50:45+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/authors/wangzx/"/>
        <id>https://wangzaixiang.github.io/authors/wangzx/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/authors/wangzx/">&lt;p&gt;æˆ‘æ˜¯ wangzx, ä¸€å 30+ å¹´çš„è€ç¨‹åºå‘˜ï¼Œè¿™ä¸ªç½‘ç«™æ˜¯æˆ‘çš„ä¸ªäººæŠ€æœ¯åšå®¢ã€é˜…è¯»æœ­è®° å’Œ éƒ¨ä»½æŠ€æœ¯æ–‡æ¡£çš„æ•´ç†ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Scala çˆ±å¥½è€…ï¼Œå¤šä¸ª Scala å¼€æºåº“ä½œè€…ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;é…·çˆ± FP ç¼–ç¨‹åŠè®¾è®¡ï¼ŒFP å¸ƒé“å¸ˆï¼Œå¹¶åœ¨ä¸šåŠ¡ç±»ã€åŸºç¡€æ¶æ„ç±»é¡¹ç›®ä¸­æœ‰åº”ç”¨å®è·µï¼ˆä» 0 åˆ° 1 ç»„å»º FP å¼€å‘å›¢é˜Ÿï¼‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å”¯å“ä¼šå¾®æœåŠ¡æ¡†æ¶ OSP åˆ›å»ºè€…ï¼Œ å¼€æºå¾®æœåŠ¡æ¡†æ¶ &lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;authors&#x2F;wangzx&#x2F;github.com&#x2F;dapeng-soa&quot;&gt;dapeng-soa&lt;&#x2F;a&gt; åˆ›å»ºè€…ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ›¾æ¶‰è¶³å¤šä¸ªè¡Œä¸šï¼ŒCCBé“¶è¡Œæ ¸å¿ƒç³»ç»Ÿå»ºè®¾è€…ã€ä¸œèˆªç”µå­å®¢ç¥¨è®¾è®¡è€…ã€ç”µå•†ã€é›¶å”®ã€å¤§å®—ã€‚æœ‰è‡ªå·±çš„ DDD  + FP å®è·µä½“ç³»ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æ•æ·å®è·µè€…ï¼šXPã€Scrumã€Leanã€TDD ...&lt;&#x2F;li&gt;
&lt;li&gt;ç›®å‰ä¸“æ³¨äºï¼šBI &amp;amp; MPP &amp;amp; OLAP &amp;amp; Rust æŠ€æœ¯ï¼Œå¸Œæœ›èƒ½æ·±æ‰è¿›æ¥ï¼Œåšä¸€äº›æœ‰æ„æ€çš„äº‹æƒ…ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;ul&gt;
&lt;li&gt;ç”µå­é‚®ä»¶: &lt;a href=&quot;mailto:949631531@qq.com&quot;&gt;949631531@qq.com&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;github: &lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;authors&#x2F;wangzx&#x2F;github.com&#x2F;wangzaixiang&quot;&gt;github.com&#x2F;wangzaixiang&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>dapeng JSON æµå¼å¤„ç†ç®€ä»‹</title>
        <published>2020-09-04T12:00:00+00:00</published>
        <updated>2020-09-04T12:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/dapeng-json/"/>
        <id>https://wangzaixiang.github.io/blog/dapeng-json/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/dapeng-json/">&lt;h1 id=&quot;bei-jing&quot;&gt;èƒŒæ™¯&lt;&#x2F;h1&gt;
&lt;p&gt;dapengçš„åŸç”Ÿåè®®æ˜¯thrift, åŒ…æ‹¬äºŒè¿›åˆ¶ã€å‹ç¼©äºŒè¿›åˆ¶ä¸¤ç§æ¨¡å¼. åŸç”Ÿåè®®çš„ä¼˜åŠ¿æ˜¯æœ‰ä¸°å¯Œçš„æ•°æ®ç±»å‹æ”¯æŒèƒ½åŠ›ï¼ˆä¼˜äºJSONï¼‰, ä¼ è¾“æ ¼å¼ç´§å‡‘ï¼ˆè¿œæ¯”JSONæ›´å°,
å°¤å…¶æ˜¯å‹ç¼©äºŒè¿›åˆ¶æ ¼å¼ï¼‰, åºåˆ—åŒ–å¼€é”€å°ï¼ˆå‡ ä¹æ²¡æœ‰è§£ææˆæœ¬å’Œæ•°æ®è½¬æ¢æˆæœ¬ï¼‰, è¿™äº›ä¼˜ç‚¹æ˜¯dapengé€‰æ‹©thriftçš„åŸºæœ¬åŸå› .&lt;&#x2F;p&gt;
&lt;p&gt;è™½ç„¶æœ‰å¾ˆå¤šçš„ä¼˜åŠ¿, åŸç”Ÿçš„thriftåè®®æœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯å¯¹&quot;äºº&quot;ä¸å‹å¥½, è€ŒJSONåˆ™æ˜¯human readableçš„æœ€ä¼˜é€‰æ‹©, ç›®å‰å·²æ˜¯äº’è”ç½‘åº”ç”¨çš„äº‹å®æ ‡å‡†.
å®ƒç›¸æ¯”XMLæ›´ä¸ºç®€æ´, å½“ç„¶ä¹Ÿæ›´ä¸ºç´§å‡‘, ä¾¿äºå¼€å‘è€…é˜…è¯», éå¸¸æ–¹ä¾¿åœ¨WEBä¸Šåº”ç”¨. è¿™ä½¿å¾—å®ƒå–ä»£xmlæˆä¸ºäº†æ•°æ®äº¤æ¢äº‹å®ä¸Šçš„è¡Œä¸šæ ‡å‡†. å°½ç®¡è¯­è¨€ä¹‹äº‰æ˜¯ä¸ªæ°¸æ’çš„è¯é¢˜,
ä½†åœ¨æ•°æ®äº¤æ¢æ ¼å¼ä¸Š, JSONæ˜¯æ¯«æ— äº‰è®®çš„ç‹è€….&lt;&#x2F;p&gt;
&lt;p&gt;å¦‚ä½•ä¸ºdapengæœåŠ¡æä¾›å¯¹JSONçš„æ”¯æŒ, å¯ä»¥ä½¿ç”¨restfulçš„å½¢å¼æ¥è°ƒç”¨dapengæœåŠ¡, ä»è€Œæ–¹ä¾¿WEBå‰ç«¯ã€PHPæˆ–è€…å‘½ä»¤è¡Œå·¥å…·æ¥è°ƒç”¨æœåŠ¡å‘¢ï¼Ÿ
dapengæä¾›äº†API Gateway, å°†JSONè¯·æ±‚è½¬æ¢æˆä¸ºthriftè¯·æ±‚, å¯¹å¤–æä¾›äº†ä¸€ä¸ªrestful + JSONçš„APIæ¥å…¥æœåŠ¡.
API GatewayåŒ…æ‹¬äº†é‰´æƒã€æµæ§ã€è·¯ç”±ç­‰å¤šä¸ªåŠŸèƒ½, ä½†å…¶æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯å®ŒæˆJSONåˆ°thriftçš„åŒå‘æ•°æ®è½¬æ¢å·¥ä½œ, æœ¬æ–‡ä»‹ç»äº†dapeng-jsonçš„è®¾è®¡ç‰¹è‰²,
åŒ…æ‹¬dapengæ˜¯å¦‚ä½•é«˜æ•ˆç‡çš„å®Œæˆæ•°æ®è½¬åŒ–ã€å¦‚ä½•å¤„ç†å¯å˜å‹ç¼©äºŒè¿›åˆ¶æ ¼å¼ç­‰æŒ‘æˆ˜çš„.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;dapeng-json åœ¨æŠ€æœ¯ä¸Šçš„ä¸€ä¸ªæœ€å¤§çš„ç‰¹ç‚¹æ˜¯ï¼šé‡‡ç”¨æµå¼å¤„ç†çš„æ–¹å¼ï¼Œæ— è®ºæ˜¯å¯¹è¯·æ±‚å’Œè¿”å›ä¿¡æ¯ï¼Œéƒ½æ— éœ€æ„å»ºå®Œæ•´çš„ JSON å¯¹è±¡ï¼Œä»è€Œå¤§å¤§å‡å°‘å†…å­˜çš„åˆ†é…å’ŒGCçš„
å¼€é”€ï¼Œå³ä½¿å¯¹äºå·¨å¤§çš„è¯·æ±‚&#x2F;è¿”å›ï¼Œä¹Ÿå¯ä»¥åœ¨å¾ˆå°‘çš„å†…å­˜æ¶ˆè€—ä¸‹å®Œæˆè½¬æ¢ï¼Œå› å¯¹ï¼Œå¯¹äºç½‘å…³ä¸€ç±»çš„åº”ç”¨æ¥è¯´ï¼Œå¯ä»¥å¸¦æ¥å·¨å¤§çš„æ€§èƒ½æå‡ï¼Œä½¿ç”¨æ™®é€šçš„ 4core 4G çš„
è™šæ‹Ÿæœºå°±å¯ä»¥è¾¾åˆ° 20K+&#x2F;s çš„ QPSï¼Œè¿™æ˜¯éæµå¼å¤„ç†çš„æ–¹å¼å¾ˆéš¾è¾¾åˆ°çš„ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;h1 id=&quot;dapeng-jsonde-she-ji-mu-biao&quot;&gt;dapeng-jsonçš„è®¾è®¡ç›®æ ‡&lt;&#x2F;h1&gt;
&lt;p&gt;dapeng-jsonçš„æœ€ç»ˆç›®çš„å°±æ˜¯å®ç°JSONå­—ç¬¦ä¸²ä¸åŸºäºthriftåè®®æ ¼å¼çš„äºŒè¿›åˆ¶æµä¹‹é—´çš„é«˜æ•ˆäº’æ¢.å…·ä½“æœ‰å¦‚ä¸‹ä¸‰ä¸ªæŒ‡æ ‡:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;é«˜æ€§èƒ½
è€ƒè™‘åˆ° dapeng-json ä½œä¸º http ç½‘å…³ç”šè‡³åç»­ service-mesh çš„æ ¸å¿ƒæ¨¡å—, è¦æ±‚å…¶èƒ½å®ç°é«˜æ•ˆçš„åºåˆ—åŒ–ä»¥åŠååºåˆ—åŒ–, ä»¥æ”¯æŒæµ·é‡è¯·æ±‚çš„å¤„ç†. å¦‚æœåºåˆ—åŒ–çš„å¼€é”€é«˜, åˆ™åŠ¿å¿…ä¼šé™ä½ç½‘å…³çš„æ¥å…¥èƒ½åŠ›.
&lt;blockquote&gt;
&lt;p&gt;toBeDone, æ€§èƒ½å‚æ•°(JSONè·Ÿæ™®é€šjavaå®¢æˆ·ç«¯çš„æ€§èƒ½å¯¹æ¯”)&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;ä½å†…å­˜ä½¿ç”¨
è™½ç„¶å¤§éƒ¨åˆ†æƒ…å†µä¸‹çš„JSONè¯·æ±‚ã€è¿”å›éƒ½æ˜¯æ•°æ®é‡è¾ƒå°çš„åœºæ™¯, ä½†ä½œä¸ºå¹³å°æ¡†æ¶, ä¹Ÿéœ€è¦åº”å¯¹æ›´å¤§çš„JSONè¯·æ±‚å’Œè¿”å›, æ¯”å¦‚1Mã€ç”šè‡³10M. åœ¨è¿™äº›åœºæ™¯ä¸‹, å¦‚æœéœ€è¦å ç”¨å¤§é‡çš„å†…å­˜, é‚£ä¹ˆåŠ¿å¿…å¯¼è‡´å·¨å¤§çš„å†…å­˜éœ€æ±‚, åŒæ—¶å¼•å‘é¢‘ç¹çš„GCæ“ä½œ, ä¹Ÿä¼šè”åŠ¨å½±å“åˆ°æ•´ä¸ªç½‘å…³çš„æ€§èƒ½.
dapeng-jsonå‚è€ƒäº†XML SAX APIçš„è®¾è®¡æ€æƒ³, åˆ›é€ æ€§çš„å¼•å…¥äº†JSON Stream API, é‡‡ç”¨æµå¼çš„å¤„ç†æ¨¡å¼, å®ç°JSON å¯¹ thrift çš„åŒå‘è½¬æ¢, æ— è®ºæ•°æ®åŒ…æœ‰å¤šå¤§, éƒ½å¯ä»¥åœ¨ä¸€å®šå›ºå®šçš„å†…å­˜è§„æ¨¡å†…å®Œæˆ.&lt;&#x2F;li&gt;
&lt;li&gt;å®¹é”™æ€§å¥½
åœ¨dapengä¸­, IDLå±‚é¢å®šä¹‰äº†åŸºæœ¬çš„æœåŠ¡è°ƒç”¨å‰ç½®æ¡ä»¶, è­¬å¦‚å¿…é¡»ä½¿ç”¨æ­£ç¡®çš„æ•°æ®ç±»å‹, æœ‰çš„å­—æ®µæ˜¯å¿…å¡«çš„. åœ¨ä½¿ç”¨json-thriftè½¬æ¢æ—¶,
å¿…é¡»èƒ½å¤Ÿæ­£ç¡®çš„è¿›è¡Œæ•°æ®è½¬æ¢, ä¸è¦æŠŠé”™è¯¯çš„è¯·æ±‚ä¼ é€’ç»™æœåŠ¡æ–¹. å¹¶ä¸”éœ€è¦åœ¨æœ‰é”™è¯¯çš„æƒ…å†µä¸‹, æ¸…æ™°çš„åé¦ˆé”™è¯¯, ä»¥ä¾¿å¼€å‘è€…è¿›è¡Œå®šä½.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;åœ¨ä»‹ç»dapeng-JSONçš„è®¾è®¡æ€è·¯ä¹‹å‰, æˆ‘ä»¬å…ˆçœ‹çœ‹dapengå¯¹JSONçš„æ”¯æŒæ¶æ„:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;dapeng-json&#x2F;dapeng-json.png&quot; alt=&quot;image&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;å³ä¸Šè§’çš„ä¸¤ä¸ªæ¨¡å—(dapeng-json, ServiceMetaData), å†æš´éœ²ä¸€ä¸ªhttpç«¯å£, å¯ä»¥æ„æˆä¸€ä¸ªå…¸å‹çš„ HttpServiceAgent.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;h1 id=&quot;dapeng-json-de-shi-xian-si-lu&quot;&gt;dapeng-json çš„å®ç°æ€è·¯&lt;&#x2F;h1&gt;
&lt;p&gt;è®©æˆ‘ä»¬é‡æ¸©ä¸€ä¸‹dapeng-jsonçš„ä½¿å‘½:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;dapeng-jsonçš„æœ€ç»ˆç›®çš„å°±æ˜¯å®ç° JSON å­—ç¬¦ä¸²ä¸ thrif æ ¼å¼çš„äºŒè¿›åˆ¶æµä¹‹é—´çš„é«˜æ•ˆäº’æ¢&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;h2 id=&quot;chang-gui-fang-shi-string-jsonobject-pojo-binary&quot;&gt;å¸¸è§„æ–¹å¼ï¼šstring -&amp;gt; JSONObject -&amp;gt; POJO -&amp;gt; Binary&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;å°†JSON å­—ç¬¦ä¸²è½¬æ¢ä¸º JSON å¯¹è±¡æ¨¡å‹ï¼ˆJSONObjectï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;ç„¶åé€šè¿‡ä¸‰æ–¹JSON-POJOæ˜ å°„æ¡†æ¶ï¼ˆå¦‚Googleçš„Gson, é˜¿é‡Œçš„FastJSONç­‰), å°†JSONObjectè½¬æ¢æˆä¸ºPOJO,&lt;&#x2F;li&gt;
&lt;li&gt;é€šè¿‡dapengç”Ÿæˆçš„POJOåºåˆ—åŒ–ä»£ç å®Œæˆä»POJOåˆ°thrfitçš„è½¬æ¢è¿‡ç¨‹.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;éƒ¨åˆ†æ¡†æ¶å¯ä»¥ç»“åˆ1å’Œ2, ç›´æ¥ä»JSONå­—ç¬¦ä¸²è½¬æ¢æˆä¸º POJO.&lt;&#x2F;p&gt;
&lt;p&gt;ä¸è¿‡, è¿™ä¸ªè®¾è®¡ä¸æ»¡è¶³æˆ‘ä»¬çš„è®¾è®¡è¦æ±‚ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;è¿™ä¸ªè¿‡ç¨‹ç»è¿‡äº†ä¸‰æ¬¡è½¬æ¢, ä¼šäº§ç”Ÿå¤§é‡çš„ä¸´æ—¶å¯¹è±¡, æœ‰å¾ˆå¤§çš„å†…å­˜è¦æ±‚&lt;&#x2F;li&gt;
&lt;li&gt;ä½¿ç”¨åå°„æ–¹å¼å¯¹äºæ—¨åœ¨æ¦¨å¹²æœåŠ¡å™¨æ€§èƒ½ä»¥è·å–é«˜ååé‡çš„ç³»ç»Ÿæ¥è¯´, éš¾ä»¥è¾¾åˆ°æ€§èƒ½æœ€ä½³&lt;&#x2F;li&gt;
&lt;li&gt;è¿™ä¸ªæ–¹æ¡ˆæœ‰å¾ˆå¼ºçš„â€œç±»å‹â€éœ€æ±‚, åœ¨ API ç½‘å…³ä¸­å¿…é¡»ä¾èµ– POJO åŒ…, è¦æ±‚JSONæ¨¡å—ä¾èµ–æœåŠ¡çš„apiåŒ…ï¼ˆå¦åˆ™æ²¡æ³•çŸ¥æ™“æœåŠ¡æ¥å£çš„è¾“å…¥è¾“å‡ºå‚æ•°ï¼‰, è¿™ä¸ªä¾èµ–ä¼šé™ä½APIç½‘å…³çš„åŠ¨æ€èƒ½åŠ›, ä½¿å¾—éƒ¨ç½²ç»´æŠ¤å¤æ‚.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;ji-yu-liu-de-zhuan-huan-json-bytes-binary&quot;&gt;åŸºäºæµçš„è½¬æ¢ï¼šJSON bytes -&amp;gt; Binary&lt;&#x2F;h2&gt;
&lt;p&gt;è¿™æ˜¯dapeng-jsonæ‰€é‡‡ç”¨çš„æ–¹å¼, æ˜¾è€Œæ˜“è§, è¿™ä¸ªè¿‡ç¨‹åªç»å†äº†ä¸€æ¬¡åè®®è½¬æ¢, å³ç›´æ¥å°†ä»ç½‘ç»œä¸Šæ¥æ”¶åˆ°çš„ä¸€ä¸ªJSONå­—èŠ‚æµç›´æ¥è½¬æ¢æˆä¸ºthriftæ•°æ®åŒ….&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;dapeng-json&#x2F;JsonSerializer-class.png&quot; alt=&quot;image&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;h3 id=&quot;jsoncallback&quot;&gt;JSONCallback&lt;&#x2F;h3&gt;
&lt;p&gt;ä»ä¸ŠèŠ‚æˆ‘ä»¬å¯ä»¥å¾—çŸ¥, JSONçš„ç»„æˆå…ƒç´ ç±»å‹ä¸å¤š, ä¸”æ¯ç§å…ƒç´ éƒ½æœ‰è‡ªå·±çš„å¼€å§‹&#x2F;ç»“æŸå­—ç¬¦, æˆ‘ä»¬æš‚ä¸”ç§°è¿™äº›å­—ç¬¦ä¸ºå…³é”®å­—ç¬¦.&lt;&#x2F;p&gt;
&lt;p&gt;ä¸ºäº†é«˜æ•ˆçš„å¤„ç†JSONå­—ç¬¦ä¸², æˆ‘ä»¬é‡‡ç”¨äº†Streamingçš„å¤„ç†æ–¹å¼:é€ä¸ªå­—ç¬¦è¯»å…¥JSONå­—ç¬¦ä¸²,ç¢°åˆ°å…³é”®å­—ç¬¦å°±è§¦å‘ä¸€å®šçš„å¤„ç†åŠ¨ä½œ. ä¸ºæ­¤, æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ¥å£JSONCallback, å¹¶å®šä¹‰äº†ä¸€ç»„å›è°ƒæ–¹æ³•ç”¨ä»¥å¤„ç†æ¯ç§JSONå…ƒç´ :&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;Java&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-Java &quot;&gt;&lt;code class=&quot;language-Java&quot; data-lang=&quot;Java&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;package &lt;&#x2F;span&gt;&lt;span&gt;com.github.dapeng.json;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;com.github.dapeng.org.apache.thrift.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;TException&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;**
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt; * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@author&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt; zxwang
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt; *&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;public interface JSONCallback {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    &#x2F;**
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * Called at start of JSON object, typical handle the &amp;#39;{&amp;#39;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@throws &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;TException
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    void onStartObject() throws TException;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    &#x2F;**
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * Called at end of JSON object, typical handle the &amp;#39;}&amp;#39;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@throws &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;TException
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    void onEndObject() throws TException;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    &#x2F;**
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * Called at start of JSON array, typical handle the &amp;#39;[&amp;#39;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@throws &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;TException
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    void onStartArray() throws TException;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    &#x2F;**
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * Called at end of JSON array, typical handle the &amp;#39;]&amp;#39;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@throws &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;TException
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    void onEndArray() throws TException;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    &#x2F;**
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * Called at start of JSON field, such as: &amp;quot;orderId&amp;quot;:130
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@param &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt; name of the filed, as for the example above, that is &amp;quot;orderId&amp;quot;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@throws &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;TException
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    void onStartField(String name) throws TException;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    &#x2F;**
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * Called at end of JSON field
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@throws &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;TException
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    void onEndField() throws TException;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    &#x2F;**
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * Called when a boolean value is met,
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * as to given field: &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;pre&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&amp;gt;&amp;quot;expired&amp;quot;:false&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;pre&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * First onStartField(&amp;quot;expired&amp;quot;) is called, followed by a call onBoolean(false) and a call onEndField()
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@param &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;value
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@throws &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;TException
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    void onBoolean(boolean value) throws TException;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    &#x2F;**
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * Called when a double value is met.
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@param &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;value
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@throws &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;TException
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    void onNumber(double value) throws TException;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    &#x2F;**
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * Called when a long&#x2F;int value is met.
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@param &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;value
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@throws &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;TException
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    void onNumber(long value) throws TException;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    &#x2F;**
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * Called when a null value is met.
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * Such as: &amp;quot;subItemId&amp;quot;:null
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@throws &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;TException
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    void onNull() throws TException;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    &#x2F;**
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * Called when a String value is met.
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * Such as: &amp;quot;name&amp;quot;: &amp;quot;Walt&amp;quot;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@param &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;value
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;@throws &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;TException
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;     *&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;    void onString(String value) throws TException;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™ä¸ªæ¥å£çš„è®¾è®¡å€Ÿé‰´äº†XML SAXçš„è®¾è®¡æ€æƒ³, æ—¢å¯ç”¨äºåºåˆ—åŒ–ï¼ˆç”ŸæˆJSONï¼‰, ä¹Ÿå¯ä»¥ååºåˆ—åŒ–ï¼ˆè§£æJSONå­—ç¬¦ä¸²ï¼‰.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;æ­¤å¤–, dapengæ ¸å¿ƒåŒ…é‡Œå®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„ç¼–è§£ç æ¥å£:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;package com.github.dapeng.core;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;import com.github.dapeng.org.apache.thrift.TException;
&lt;&#x2F;span&gt;&lt;span&gt;import com.github.dapeng.org.apache.thrift.protocol.TProtocol;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;**
&lt;&#x2F;span&gt;&lt;span&gt; * é€šç”¨ç¼–è§£ç å™¨æ¥å£
&lt;&#x2F;span&gt;&lt;span&gt; * @author ever
&lt;&#x2F;span&gt;&lt;span&gt; * @date 2017&#x2F;7&#x2F;17
&lt;&#x2F;span&gt;&lt;span&gt; *&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;public interface BeanSerializer&amp;lt;T&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &#x2F;**
&lt;&#x2F;span&gt;&lt;span&gt;     * ååºåˆ—åŒ–æ–¹æ³•, ä»thriftåè®®æ ¼å¼ä¸­è½¬æ¢å›PoJo
&lt;&#x2F;span&gt;&lt;span&gt;     * @param iproto
&lt;&#x2F;span&gt;&lt;span&gt;     * @return
&lt;&#x2F;span&gt;&lt;span&gt;     * @throws TException
&lt;&#x2F;span&gt;&lt;span&gt;     *&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;    T read(TProtocol iproto) throws TException;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &#x2F;**
&lt;&#x2F;span&gt;&lt;span&gt;     * åºåˆ—åŒ–æ–¹æ³•, æŠŠPoJoè½¬æ¢ä¸ºthriftåè®®æ ¼å¼
&lt;&#x2F;span&gt;&lt;span&gt;     * @param bean
&lt;&#x2F;span&gt;&lt;span&gt;     * @param oproto
&lt;&#x2F;span&gt;&lt;span&gt;     * @throws TException
&lt;&#x2F;span&gt;&lt;span&gt;     *&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;    void write(T bean, TProtocol oproto) throws TException;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &#x2F;**
&lt;&#x2F;span&gt;&lt;span&gt;     * PoJoæ ¡éªŒæ–¹æ³•
&lt;&#x2F;span&gt;&lt;span&gt;     * @param bean
&lt;&#x2F;span&gt;&lt;span&gt;     * @throws TException
&lt;&#x2F;span&gt;&lt;span&gt;     *&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;    void validate(T bean) throws TException;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &#x2F;**
&lt;&#x2F;span&gt;&lt;span&gt;     * è¾“å‡ºå¯¹äººå‹å¥½çš„ä¿¡æ¯
&lt;&#x2F;span&gt;&lt;span&gt;     * @param bean
&lt;&#x2F;span&gt;&lt;span&gt;     * @return
&lt;&#x2F;span&gt;&lt;span&gt;     *&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;    String toString(T bean);
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;dapeng-JSONé€šè¿‡JSONSerializerå®ç°äº†è¿™ä¸ªç¼–è§£ç å™¨.&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨æ·±å…¥å…·ä½“å®ç°ä¹‹å‰, æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹dapengçš„æœåŠ¡å…ƒä¿¡æ¯, å› ä¸ºæœåŠ¡å…ƒä¿¡æ¯æ˜¯dapengå¾ˆå¤šæ¨¡å—çš„å…³é”®.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;dapeng-yuan-xin-xi&quot;&gt;dapeng å…ƒä¿¡æ¯&lt;&#x2F;h3&gt;
&lt;p&gt;å‰æ–‡æåˆ°, dapengæœåŠ¡æœ‰ä¸°å¯Œçš„å…ƒä¿¡æ¯, éå¸¸ç±»ä¼¼äºJava Classçš„åå°„ä¿¡æ¯, é€šè¿‡åå°„, æˆ‘ä»¬åŠ¨æ€çš„è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å„ä¸ªå­—æ®µã€æ–¹æ³•, è€Œæ— éœ€ä¾èµ–äºç¼–è¯‘æ—¶æœŸçš„ç±»å‹ä¿¡æ¯. åŒæ ·, æœ‰äº†æœåŠ¡å…ƒä¿¡æ¯, æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨è¿è¡ŒæœŸè®¿é—®åˆ°IDLä¸­å®šä¹‰çš„æ‰€æœ‰ä¿¡æ¯.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡å…ƒæ•°æ®ä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆjava&#x2F;scalaç­‰å®¢æˆ·ç«¯ä»£ç .&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡å…ƒæ•°æ®ä¿¡æ¯åœ¨å®¢æˆ·ç«¯åºåˆ—åŒ–&#x2F;ååºåˆ—æ¥å£å‚æ•°æˆ–è€…è¿”å›ä¿¡æ¯çš„æ—¶å€™, æ ¡éªŒæ¯ä¸€ä¸ªå­—æ®µæ˜¯å¦æœ‰æ•ˆ.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;è¿™é‡Œæ˜¯ä¸€ä¸ªæœåŠ¡å…ƒä¿¡æ¯çš„ç¤ºä¾‹ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;xml&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-xml &quot;&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;request &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;getAddress_args&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;fields&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;field &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;tag&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;request&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;optional&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;privacy&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dataType&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;                &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;kind&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;STRUCT&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;kind&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;                &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;ref&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;com.today.api.dictionary.request.GetAddressRequest&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;ref&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dataType&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;doc&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; æŸ¥è¯¢è¯·æ±‚&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;doc&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;field&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;fields&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;request&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;namespace&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;com.today.api.dictionary.request&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;GetAddressRequest&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;doc&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;æ–°å¢&#x2F;ç¼–è¾‘ å­—å…¸ çš„è¯·æ±‚å®ä½“&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;doc&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;fields&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;field &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;tag&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;provinceCode&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;optional&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;privacy&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dataType&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;                &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;kind&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;STRING&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;kind&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dataType&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;doc&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;çœçº§åœ°å€ç¼–ç &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;doc&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;field&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;field &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;tag&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;cityCode&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;optional&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;privacy&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dataType&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;                &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;kind&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;STRING&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;kind&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dataType&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;doc&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;å¸‚çº§åœ°å€ç¼–ç &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;doc&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;field&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;field &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;tag&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;3&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;districtCode&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;optional&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;privacy&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dataType&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;                &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;kind&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;STRING&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;kind&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dataType&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;doc&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;åŒºçº§åœ°å€ç¼–ç &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;doc&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;field&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;field &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;tag&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;4&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;townCode&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;optional&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;privacy&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dataType&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;                &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;kind&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;STRING&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;kind&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dataType&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;doc&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;ä¹¡é•‡çº§åœ°å€ç¼–ç &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;doc&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;field&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;field &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;tag&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;streetCode&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;optional&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;privacy&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dataType&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;                &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;kind&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;STRING&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;kind&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;dataType&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;            &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;doc&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;è¡—é“çº§åœ°å€ç¼–ç &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;doc&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;field&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;fields&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;struct&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;jsonserializer-write-xu-lie-hua-jsonstring-binarry-zi-ding-xiang-xia-jie-xi-json&quot;&gt;JSONSerializer.writeï¼š åºåˆ—åŒ–(JSONString-&amp;gt;Binarry)ï¼šè‡ªé¡¶å‘ä¸‹è§£æJSON&lt;&#x2F;h3&gt;
&lt;pre data-lang=&quot;java&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-java &quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;@&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Override
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;public&lt;&#x2F;span&gt;&lt;span&gt; void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;write&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span&gt; input, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;TProtocol&lt;&#x2F;span&gt;&lt;span&gt; oproto) throws &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;TException &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;JsonReader&lt;&#x2F;span&gt;&lt;span&gt; jsonReader = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;JsonReader&lt;&#x2F;span&gt;&lt;span&gt;(service, method, version, struct, requestByteBuf, oproto);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;JsonParser&lt;&#x2F;span&gt;&lt;span&gt;(input, jsonReader).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;parseJsValue&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;æˆ‘ä»¬é€šè¿‡JsonParserå®ç°å¯¹JSONå­—ç¬¦ä¸²çš„è§£æ, åœ¨æµå¼è§£æJSONçš„è¿‡ç¨‹ä¸­, æˆ‘ä»¬ä¼šäº§ç”ŸJsonCallbackäº‹ä»¶, JsonReaderå°±æ˜¯è´Ÿè´£å°†ç›¸åº”çš„äº‹ä»¶è½¬åŒ–ä¸ºThriftçš„æ“ä½œ.&lt;&#x2F;p&gt;
&lt;p&gt;è€ƒè™‘ä¹‹å‰æåˆ°çš„JSONä¾‹å­:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;json&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-json &quot;&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;createOrderRequest&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: {
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;memberId&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1024&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;payCode&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;tidf3325aaeny&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;,
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;storeIds: [28, 35, 64],&lt;&#x2F;span&gt;&lt;span style=&quot;background-color:#bf616a;color:#2b303b;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;items&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: [
&lt;&#x2F;span&gt;&lt;span&gt;           {
&lt;&#x2F;span&gt;&lt;span&gt;               &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;skuId&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;24&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;               &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;amount&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;4.5
&lt;&#x2F;span&gt;&lt;span&gt;           }, {
&lt;&#x2F;span&gt;&lt;span&gt;               &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;skuId&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;106&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;               &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;amount&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;20.0
&lt;&#x2F;span&gt;&lt;span&gt;           }
&lt;&#x2F;span&gt;&lt;span&gt;        ]
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å¯¹åº”çš„ JSONCallback åºåˆ—å¦‚ä¸‹:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;- onStartObject
&lt;&#x2F;span&gt;&lt;span&gt;    - onStartFiled createOrderRequest
&lt;&#x2F;span&gt;&lt;span&gt;        - onStartObject
&lt;&#x2F;span&gt;&lt;span&gt;            - onStartField memberId
&lt;&#x2F;span&gt;&lt;span&gt;                - onNumber 1024
&lt;&#x2F;span&gt;&lt;span&gt;            - onEndField
&lt;&#x2F;span&gt;&lt;span&gt;            - onStartField payCode
&lt;&#x2F;span&gt;&lt;span&gt;                - onString tidf3325aaeny
&lt;&#x2F;span&gt;&lt;span&gt;            - onEndField 
&lt;&#x2F;span&gt;&lt;span&gt;            - onStartField storeIds
&lt;&#x2F;span&gt;&lt;span&gt;                - onStartArray
&lt;&#x2F;span&gt;&lt;span&gt;                    - onNumber 28
&lt;&#x2F;span&gt;&lt;span&gt;                    - onNumber 35
&lt;&#x2F;span&gt;&lt;span&gt;                    - onNumber 64
&lt;&#x2F;span&gt;&lt;span&gt;                - onEndArray
&lt;&#x2F;span&gt;&lt;span&gt;            - onEndField
&lt;&#x2F;span&gt;&lt;span&gt;            - onStartField items
&lt;&#x2F;span&gt;&lt;span&gt;                - onStartArray
&lt;&#x2F;span&gt;&lt;span&gt;                    - onStartObject
&lt;&#x2F;span&gt;&lt;span&gt;                        - onStartField skuId
&lt;&#x2F;span&gt;&lt;span&gt;                            - onNumber 24
&lt;&#x2F;span&gt;&lt;span&gt;                        - onEndField
&lt;&#x2F;span&gt;&lt;span&gt;                        - onStartField amount
&lt;&#x2F;span&gt;&lt;span&gt;                            - onNumber 4.5
&lt;&#x2F;span&gt;&lt;span&gt;                        - onEndField
&lt;&#x2F;span&gt;&lt;span&gt;                    - onEndObject
&lt;&#x2F;span&gt;&lt;span&gt;                    - onStartObject
&lt;&#x2F;span&gt;&lt;span&gt;                        - onStartField skuId
&lt;&#x2F;span&gt;&lt;span&gt;                            - onNumber 106
&lt;&#x2F;span&gt;&lt;span&gt;                        - onEndField
&lt;&#x2F;span&gt;&lt;span&gt;                        - onStartField amount
&lt;&#x2F;span&gt;&lt;span&gt;                            - onNumber 20.0
&lt;&#x2F;span&gt;&lt;span&gt;                        - onEndField
&lt;&#x2F;span&gt;&lt;span&gt;                    - onEndObject
&lt;&#x2F;span&gt;&lt;span&gt;                - onEndArray
&lt;&#x2F;span&gt;&lt;span&gt;            - onEndField          
&lt;&#x2F;span&gt;&lt;span&gt;        - onEndObject
&lt;&#x2F;span&gt;&lt;span&gt;    - onEndField
&lt;&#x2F;span&gt;&lt;span&gt;- onEndObject
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;jsonserializer-read-fan-xu-lie-hua-binary-jsonstring&quot;&gt;JSONSerializer.readï¼šååºåˆ—åŒ–(Binary-&amp;gt;JSONString)&lt;&#x2F;h3&gt;
&lt;p&gt;è¿™ä¸ªè¿‡ç¨‹æ˜¯writeçš„ä¸€ä¸ªé€†å‘è¿‡ç¨‹.&lt;&#x2F;p&gt;
&lt;p&gt;é’ˆå¯¹JSONçš„å„ç§æ•°æ®ç±»å‹
é€šè¿‡dapengå¼ºå¤§çš„æœåŠ¡å…ƒæ•°æ®,æˆ‘ä»¬å¯ä»¥çŸ¥é“æŸä¸ªæœåŠ¡çš„æŸä¸ªæ–¹æ³•çš„æŸä¸ªå…¥å‚çš„å…ƒæ•°æ®ä¿¡æ¯,ä¾‹å¦‚æœ‰å¤šå°‘field,æ¯ä¸ªfieldçš„ç±»å‹,æ˜¯å¦å¿…å¡«ç­‰:&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨å¤„ç†JSONçš„è¿‡ç¨‹ä¸­, æˆ‘ä»¬å¯ä»¥é€šè¿‡å…ƒæ•°æ®æ¥å®ç°å¦‚ä¸‹åŠŸèƒ½:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹äºæ¥å£è¯·æ±‚å‚æ•°ä¸­æ²¡æœ‰çš„å­—æ®µ, å¯ç›´æ¥å¿½ç•¥&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹æ¯ä¸ªå­—æ®µåšå¿…è¦çš„ç±»å‹æ ¡éªŒ, åŒæ—¶&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹äºæ¥å£è¯·æ±‚å‚æ•°ä¸­è¦æ±‚å¿…å¡«çš„å‚æ•°å­—æ®µ,åœ¨å¤„ç†å®Œæ•´ä¸ªJSONå­—ç¬¦ä¸²ä¹‹å,åšä¸€ä¸ªå¯¹å¿…å¡«å­—æ®µçš„æ ¡éªŒ. å¦‚æœå­˜åœ¨å¿…å¡«å­—æ®µç¼ºå¤±çš„æƒ…å†µ,é‚£ä¹ˆç›´æ¥è¿”å›æç¤ºç»™è°ƒç”¨æ–¹,é˜²æ­¢æ— æ•ˆè¯·æ±‚å‘åˆ°æœåŠ¡ç«¯.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;åŸºäºstring-streamçš„æµå¼å¤„ç†æœºåˆ¶,å°½å¯èƒ½å°‘çš„åˆ†é…å†…å­˜ä»¥åŠåˆ›å»ºå­—ç¬¦ä¸²,æ”¯æŒfast-failed. æµå¼å¤„ç†ä¸éœ€è¦åœ¨å†…å­˜ä¸­æ„å»ºå¥½æ•´ä¸ªJSONå¯¹è±¡å†åšå¤„ç†, å®ƒå¯¹å†…å­˜çš„æ¶ˆè€—å–å†³äºJSONç»“æ„çš„æ·±åº¦è€Œä¸æ˜¯é•¿åº¦. ä¾‹å¦‚æŸä¸ªJSONç»“æ„ä½“åŒ…å«ä¸€ä¸ªæ•°ç»„å…ƒç´ , é‚£ä¹ˆæµå¼å¤„ç†æœºåˆ¶æ‰€éœ€è¦çš„æœ€å¤§å†…å­˜ç­‰äºå•ä¸ªæ•°ç»„å…ƒç´ çš„å¤§å°, è€Œæ•°ç»„çš„é•¿åº¦å¯¹äºå†…å­˜æ¶ˆè€—æ¥è¯´æ²¡æœ‰å½±å“. è¿™ä¸ªç‰¹æ€§å¾ˆé‡è¦, å°±ç®—è¦å¤„ç†å‡ MBæˆ–è€…å‡ åMBç”šè‡³å‡ ç™¾MBçš„JSONæ•°æ®, dapeng-JSONå¯èƒ½ä¹Ÿåªæ˜¯éœ€è¦å‡ KBçš„å†…å­˜æ¶ˆè€—è€Œå·².&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;dapeng-json&#x2F;dapeng-service-mesh.png&quot; alt=&quot;image&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;h1 id=&quot;others&quot;&gt;others&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;numberlei-xing-de-shu-ju-zhuan-huan&quot;&gt;Numberç±»å‹çš„æ•°æ®è½¬æ¢&lt;&#x2F;h2&gt;
&lt;p&gt;ç”±äºJavaScriptè§„èŒƒä¸­ï¼Œ æ•°å­—åªæœ‰ä¸€ç§ç±»å‹:Numberï¼Œä¸”æ˜¯æµ®ç‚¹ç±»å‹ã€‚é‚£ä¹ˆå¯¹äºä¸€ä¸ªå¤§çš„é•¿æ•´å‹(Long, è¶…å‡º[-2^53, 2^53]èŒƒå›´ï¼Œä¹Ÿå³[-9007199254740992,9007199254740992])ï¼Œä½¿ç”¨Numberç±»å‹ä¼šå­˜åœ¨ä¸å¯é¢„æ–™çš„ç»“æœã€‚ä¾‹å¦‚:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;gt; var l1 = 9007199254740995
&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; var l2 = 9007199254740996
&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; l1 == l2
&lt;&#x2F;span&gt;&lt;span&gt;true
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;é’ˆå¯¹Jsonæ•°å€¼ç±»å‹åœ¨è½¬æ¢è¿‡ç¨‹ä¸­å­˜åœ¨ç²¾åº¦ä¸¢å¤±çš„é—®é¢˜ï¼Œ çº¦å®šå¦‚ä¸‹ï¼š&lt;&#x2F;p&gt;
&lt;h3 id=&quot;1-jian-yi&quot;&gt;1. å»ºè®®&lt;&#x2F;h3&gt;
&lt;ol&gt;
&lt;li&gt;é¦–å…ˆæˆ‘ä»¬ä¸å»ºè®®åœ¨ä¸šåŠ¡æ¥å£ä¸­ä½¿ç”¨Doubleç±»å‹çš„å­—æ®µï¼Œ å°½é‡ç”¨BigDecimalã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœæŸä¸ªå­—æ®µæ˜¯ä¸ªé•¿æ•´å‹(Long)ï¼Œä¸”é¢„æœŸä¸åœ¨[-2^53, 2^53]èŒƒå›´å†…ï¼Œä¹Ÿå³[-9007199254740992,9007199254740992],  é‚£ä¹ˆå»ºè®®å‰ç«¯å°è£…jsonæ•°æ®çš„æ—¶å€™ï¼Œ è¯¥å­—æ®µç”¨å­—ç¬¦ä¸²ï¼ˆdapeng-jsonè½¬æ¢å¼•æ“ä¼šé€šè¿‡æœåŠ¡å…ƒæ•°æ®å‡†ç¡®çš„æŠŠè¯¥å­—ç¬¦ä¸²è½¬å›Longï¼‰&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h3 id=&quot;2-fu-wu-duan-fan-hui-gei-qian-duan-de-shu-ju-thrift-json&quot;&gt;2. æœåŠ¡ç«¯è¿”å›ç»™å‰ç«¯çš„æ•°æ®(thrift-&amp;gt;json)&lt;&#x2F;h3&gt;
&lt;p&gt;å¯¹äºLongç±»å‹ï¼Œä¼šåˆ¤æ–­ä¸€ä¸‹å¤§å°ï¼Œå¦‚æœè¶…å‡º[-2^53, 2^53]ï¼Œ é‚£ä¹ˆæˆ‘ä»¬ä¼šæŠŠLongç±»å‹è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚ å¦åˆ™å°±ç›´æ¥è¾“å‡ºNumberç±»å‹&lt;&#x2F;p&gt;
&lt;p&gt;å¯¹äºDoubleç±»å‹ï¼Œ è¿™ä¸ªå°±ç›´æ¥è¾“å‡ºNumberç±»å‹äº†ã€‚&lt;&#x2F;p&gt;
&lt;h3 id=&quot;3-qian-duan-dao-hou-duan-de-shu-ju-chuan-di-json-thrift&quot;&gt;3. å‰ç«¯åˆ°åç«¯çš„æ•°æ®ä¼ é€’(json-&amp;gt;thrift)&lt;&#x2F;h3&gt;
&lt;p&gt;å¯¹äºLongç±»å‹ï¼Œ ä¸ç®¡jsonæ˜¯Numberè¿˜æ˜¯å­—ç¬¦ä¸²ï¼Œ æˆ‘ä»¬éƒ½è½¬æˆæ ‡å‡†çš„Long&lt;&#x2F;p&gt;
&lt;p&gt;å¯¹äºDoubleç±»å‹ï¼Œä¸ç®¡jsonæ˜¯Numberè¿˜æ˜¯å­—ç¬¦ä¸²ï¼Œ æˆ‘ä»¬éƒ½è½¬æˆæ ‡å‡†çš„Double&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>LitElement &amp; LitHtml æ¢ç§˜</title>
        <published>2019-11-04T00:00:00+00:00</published>
        <updated>2019-11-04T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/litelement/"/>
        <id>https://wangzaixiang.github.io/blog/litelement/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/litelement/">&lt;p&gt;åœ¨Polymerçš„æœ€æ–°Blogä¸­ï¼Œä»‹ç»äº†æ–°çš„webcomponentå¼€å‘æ¡†æ¶ï¼šLitElement ã€‚ä½œä¸ºä¸€ä¸ªPolymerçš„èµ„æ·±ç²‰ï¼Œè¿™äº›å¹´ä¸€ç›´å¤„åœ¨ä¸”çˆ±ä¸”æ¨ä¹‹ä¸­ï¼š
çˆ± Polymerä¹‹ç»„ä»¶åŒ–æ¶æ„ï¼ˆå½“ç„¶æ›´å¤šå½’æ ¹äºwebcomponentåº•å±‚æ ‡å‡†ï¼‰ï¼Œçˆ± Polymer ä¹‹æ¦‚å¿µç®€å•ï¼Œæ¨ Polymer ä¹‹ä¸ç—›ä¸ç—’ä¹‹ç¤¾åŒºç”Ÿæ€ï¼Œ
å°¤å…¶åœ¨å›½å†…ï¼Œå‡ ä¹æ˜¯æ— äººé—®æ´¥ï¼Œäº¦æ¨ Polymer ä¹‹ç‰ˆæœ¬æ›´æ–°ï¼Œæ‘§æ¯æ‹‰æœ½ï¼Œä»V1åˆ°V2åˆ°V3ï¼Œå“ªä¸€ä¸ªç‰ˆæœ¬æ›´æ›¿éƒ½æ˜¯å¤§åˆ€é˜”æ–§ï¼Œä»ä¸è€ƒè™‘å‘ä¸‹å…¼å®¹ã€‚
è€ŒV3åˆšå‡ºï¼Œç°åœ¨åˆå†’å‡ºä¸€ä¸ªLitElementï¼Œä¸”åˆæ˜¯ä¸€ä¸ªå®Œå…¨é¢ è¦† V3çš„è®¾è®¡ã€‚
è™½ç„¶æœ€è¿‘å¾ˆé•¿æ—¶é—´ä»¥æ¥ï¼Œæˆ‘å¯¹å‰ç«¯æŠ€æœ¯ç”šå°‘é—®æ´¥ï¼Œä½†è¿˜æ˜¯å¾ˆå¥½å¥‡ LitHtml ç©¶ç«Ÿæ˜¯ä½•æ–¹ç¥åœ£ï¼Œèƒ½å¤Ÿè®©Polymer è¦åœ¨ å†ç»3å¹´å‘å¸ƒ3ä¸ªå¤§ç‰ˆæœ¬ä¹‹åï¼Œå¦èµ·ç‚‰ç¶ï¼Œé‡æ ‘æ–°æ ‡å‘¢ï¼Ÿ&lt;&#x2F;p&gt;
&lt;p&gt;æŒ‰ç…§å®˜æ–¹çš„Guideï¼ŒåŠ¨æ‰‹å¯åŠ¨ä¸€ä¸ªHello Worldä¹‹æ—…ï¼Œäº†è§£ä¸€ä¸‹ LitHtml çš„å¥¥å¦™ä¹‹æ‰€åœ¨ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šçš„æ”¶è·çš„ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;geng-biao-zhun&quot;&gt;æ›´æ ‡å‡†&lt;&#x2F;h2&gt;
&lt;p&gt;LitElement å®Œå…¨åŸºäºæœ€æ–°çš„WebComponentæ ‡å‡†&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Custom Element V1
CustomElement æ˜¯ webcomponent çš„æ ¸å¿ƒè§„èŒƒï¼ŒåŒºåˆ«äºReactã€VUEã€Angularç­‰ä¸€ç³»åˆ—çš„â€œè‡ªå®šä¹‰å…ƒç´ â€çš„æ¡†æ¶ï¼ŒCustom Elementåœ¨æµè§ˆå™¨åº•å±‚æä¾›äº†æ‰©å±•
element çš„èƒ½åŠ›ï¼Œå¹¶ä¸”ç»Ÿä¸€äº†æ‰©å±• Element ä¸å†…ç½® Element çš„ attributeã€propertyã€methodã€event çš„æ¨¡å‹ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¦‚æœè¯´Reactã€VUEã€Angularçš„â€œè‡ªå®šä¹‰å…ƒç´ â€æ˜¯å¼€å‘æ—¶æœŸçš„è¯­æ³•ç³–é‚£ä¹ˆCustom Elementåˆ™æ˜¯è¿è¡Œæ—¶æœŸçš„å¯¹è±¡æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥åšå¾ˆå¤šåŸæœ¬ä¸èƒ½åšçš„äº‹æƒ…ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨è¿è¡ŒæœŸï¼Œç›´æ¥åœ¨ DOM inspector ç­‰å·¥å…·ä¸­ï¼Œæµè§ˆç»„ä»¶ï¼Œæˆ–å¯¹å…¶è¿›è¡ŒåŠ¨æ€çš„è°ƒæ•´ï¼Œå¦‚è°ƒæ•´ attributeã€propertyã€CSSç­‰ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¯ä»¥æ›´å¥½çš„ä¸å…¶å®ƒçš„ç»„ä»¶æ¡†æ¶é›†æˆï¼Œä¾‹å¦‚ä»Reactä¸­ç›´æ¥ä½¿ç”¨webcomponentï¼Œå¯¹å…¶å®ƒæŠ€æœ¯æ— æ„Ÿé€‚é…ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Shadow DOM V1
Shadow DOMä¸ºè‡ªå®šä¹‰çš„ç»„ä»¶æä¾›äº†åŒ…æ‹¬CSSã€äº‹ä»¶çš„æœ‰æ•ˆéš”ç¦»ï¼Œä¸å†æ‹…å¿ƒä¸åŒçš„ç»„ä»¶ä¹‹é—´çš„æ ·å¼ã€äº‹ä»¶æ±¡æŸ“äº†ã€‚è¿™ç›¸å½“äºä¸ºè‡ªå®šä¹‰ç»„ä»¶æä¾›äº†ä¸€ä¸ªæœ‰æ•ˆçš„ä¿æŠ¤ä¼ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;JavaScript Module
Polymer V1ã€V2ä¸­éƒ½å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æŠ€æœ¯ HTML Importsï¼Œå°è¯•ä½¿ç”¨HTMLä½œä¸ºä¸€ç§æ–°çš„moduleè½½ä½“ï¼Œè¿™ä¸ªæ€è·¯å¹¶æ²¡æœ‰å¾—åˆ°ä¸šç•Œçš„å¹¿æ³›æ”¯æŒï¼Œ
åè€Œå¤§å®¶æ›´ä¸ºå€¾å‘äºæ”¯æŒåŸºäºES6çš„ModuleæŠ€æœ¯ã€‚ä» Polymer V3å¼€å§‹ï¼Œä¹Ÿå‘è¿™ä¸€æ€è·¯å¯¹é½ï¼ŒåºŸå¼ƒäº†HTML Importsï¼Œè€Œæ˜¯ä½¿ç”¨ES6 Moduleã€‚
è¿™æ ·å¸¦æ¥çš„ä¼˜ç‚¹æ˜¯åœ¨å¼€å‘æ–¹å¼ä¸Šä¸Reactã€VUEç­‰æ›´åŠ ä¸€è‡´ï¼Œå½“ç„¶ä¹Ÿæ›´åŠ ä¾èµ– ES6 çš„è¯­è¨€ç‰¹æ€§ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æ›´åŒ¹é… OO æ€æƒ³ï¼ˆæˆ–è€…è¯´ç»„ä»¶æ¨¡å‹ï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªè‡ªå®šä¹‰ç»„ä»¶ å°±æ˜¯ä¸€ä¸ª ç»§æ‰¿äº† LitElement çš„ES6 Classã€‚&lt;&#x2F;li&gt;
&lt;li&gt;æœ‰è‡ªå·±çš„ propertiesï¼Œéƒ¨åˆ†çš„propertieså¯ä»¥æ˜ å°„åˆ° attribute&lt;&#x2F;li&gt;
&lt;li&gt;æœ‰è‡ªå·±çš„ methodï¼Œå¯ä»¥å“åº”å¤–éƒ¨çš„è¯·æ±‚&lt;&#x2F;li&gt;
&lt;li&gt;æœ‰è‡ªå·±çš„ eventï¼Œå¯ä»¥å°†å˜åŒ–å¹¿æ’­å‡ºå»ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å½“ç„¶ï¼ŒLitElement å¹¶ä¸ä¸¥æ ¼æ„ä¹‰çš„åŒ¹é…ä¼ ç»Ÿçš„ç»„ä»¶ OO æ¨¡å‹ï¼Œä¾‹å¦‚ property çš„å®šä¹‰æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œè¿™ä¸ªå¯ä»¥ä½¿ç”¨ typescript è¿™ç±»æ”¯æŒ
@decorator ç‰¹æ€§çš„è¯­è¨€æ¥è¿›è¡Œè¯­æ³•ç³–é€‚é…ã€‚ä½†åœ¨åº•å±‚æ¨¡å‹ä¸ŠLitElementä¸ç»å…¸çš„OOç»„ä»¶æ¨¡å‹æ˜¯ä¸€è‡´çš„ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å½“ç„¶ï¼Œå¦‚æœè¯´ Vue&#x2F;React ä¹Ÿæ˜¯ç»„ä»¶æ¨¡å‹ï¼Œé‚£ä¹ˆä¸åŒä¹‹å¤„ï¼Œå°±åœ¨åŸºäº WebComponent æ˜¯ä¸€ä¸ª ABI çº§åˆ«ã€è¿è¡ŒæœŸçº§åˆ«çš„ç»„ä»¶æ¨¡å‹ï¼Œè€Œéå¼€å‘æœŸçº§åˆ«
çš„ç»„ä»¶æ¨¡å‹ï¼Œè¿™ä¹Ÿè§£å†³äº†ä¸åŒæ¡†æ¶ä¹‹é—´çš„ç»„ä»¶ååŒã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;geng-xiao-qiao&quot;&gt;æ›´å°å·§&lt;&#x2F;h2&gt;
&lt;p&gt;æ ¸å¿ƒçš„ LitElement + LitHtml éå¸¸å°å·§ï¼Œç›®å‰ç‰ˆæœ¬çš„å…¨éƒ¨æºä»£ç ï¼ˆModule)å…± 28ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;LitElement å…± 3ä¸ªModuleï¼Œ632è¡Œæºä»£ç ï¼Œ25Kã€‚&lt;&#x2F;li&gt;
&lt;li&gt;LitHtml æ ¸å¿ƒ å…± 14 ä¸ªModuleï¼Œ1326 è¡Œæºä»£ç ï¼Œ 54Kã€‚&lt;&#x2F;li&gt;
&lt;li&gt;LitHtml æ‰©å±•æ ‡è®°ï¼Œå…±11ä¸ª Moduleï¼Œ978è¡Œæºä»£ç ï¼Œ44K&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æ ¸å¿ƒçš„æºä»£ç è¡Œæ•°ä¸è¶…è¿‡2000è¡Œï¼ˆè¿˜æ²¡æœ‰å‰”é™¤æ³¨é‡Šï¼‰ï¼Œå…¶å¯è¯»æ€§ä¹Ÿæ˜¯éå¸¸å¥½ï¼Œç†Ÿæ‚‰çš„è¯ï¼Œ1å¤©å°±å¯ä»¥å…¨éƒ¨é˜…è¯»å®Œæˆäº†ï¼Œè¿è¡ŒæœŸä¹Ÿå¾ˆå°ï¼Œgzipåå¤§çº¦40Kå·¦å³ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ç›¸æ¯”Polymer V1 - V3 çš„ç‰ˆæœ¬ï¼ŒLitElementåº”è¯¥æ˜¯ä¸€ä¸ªå¾ˆå°çš„å®ç°äº†ï¼Œè¿™é‡Œé¢ï¼Œéå¸¸å¥¥å¦™çš„åœ°æ–¹æ˜¯ LitHtmlï¼Œç†è§£äº† LitHtmlï¼ŒLitElement
å…¶å®åªæ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ webcomponent å°è£…äº†ã€‚å®é™…ä¸Šï¼Œgluonjs å°±æ˜¯å¦å¤–ä¸€ä¸ªåŸºäº LitHtml çš„ webcomponent å°è£…ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ‰€ä»¥æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ï¼šWhat is LitHtmlï¼ŸWhy LitHtmlï¼Ÿ&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-is-lithtml&quot;&gt;What is LitHtml?&lt;&#x2F;h2&gt;
&lt;p&gt;LitHtmlç›®å‰æ˜¯Polymerä¸‹çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œä»å…¶åå­—æ¥çœ‹ï¼Œå¯ä»¥ç†è§£ä¸º Literal Htmlï¼Œæ˜¯ä¸€ä¸ªåŸºäºå­—ç¬¦æµçš„HTMLæ¨¡ç‰ˆå¼•æ“ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ¨¡ç‰ˆå¼•æ“ï¼Œæ˜¯è§£å†³UIæ¸²æŸ“è¿™ä¸€ç±»é—®é¢˜çš„æœ€ä¸ºå¸¸è§çš„æ¨¡å¼ï¼Œæœ€æ—©æ˜¯æœåŠ¡ç«¯çš„PHPã€JSPã€ASPç­‰ï¼Œå°±æ˜¯å…¸å‹çš„è„šæœ¬åŒ–çš„æ¨¡æ¿å¼•æ“æŠ€æœ¯ï¼Œåé¢æ¼”å˜åˆ°äº†ç»„ä»¶åŒ–ï¼Œ
ä¾‹å¦‚ JSFã€ASP.NETç­‰ã€‚ç„¶åï¼Œæ¨¡æ¿å¼•æ“æŠ€æœ¯ï¼Œå¼€å§‹å»¶å±•åˆ°äº†æµè§ˆå™¨å‰ç«¯ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ï¼ˆç¿»ç¿»æ—§è´¦ï¼šä½œè€…åœ¨2005å¹´ï¼Œä¹Ÿåˆ›é€ äº†ä¸€ä¸ªå‰ç«¯æ¨¡æ¿çš„è½®å­ï¼š&lt;a href=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;litelement&#x2F;easyajax.sf.net&quot;&gt;easyajax&lt;&#x2F;a&gt;ï¼Œåœ¨å½“æ—¶ï¼Œè¿˜æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„ç”Ÿäº§åŠ›å·¥å…·ï¼Œä¹Ÿåœ¨æˆ‘ä¸»å¯¼çš„å¤šä¸ªé¡¹ç›®ä¸­è¿›è¡Œäº†åº”ç”¨ï¼Œ
ç›¸æ¯”å½“æ—¶ä¼ ç»Ÿçš„JavaScriptå¼€å‘ï¼Œeasyajax å¸¦æ¥çš„å¼€å‘ä½“éªŒæ˜¯éå¸¸å¥½çš„ï¼Œ å¯¹å½“æ—¶æˆ‘ä»¬çš„å‰ç«¯æ•ˆç‡æœ‰éå¸¸æ˜¾è‘—çš„æå‡ï¼‰&lt;&#x2F;p&gt;
&lt;p&gt;æµè§ˆå™¨ç«¯çš„æ¨¡æ¿å¼•æ“ï¼Œæœ‰ä¸¤å¤§æµæ´¾ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;DOM based templateã€‚å…¸å‹åˆ¶ä½œåŒ…æ‹¬ï¼šeasyajaxã€polymerã€angularjsã€Vueã€‚&lt;&#x2F;li&gt;
&lt;li&gt;Literal based templateã€‚åç«¯çš„JSPã€PHPç­‰éƒ½ç®—æ˜¯è¿™ä¸€ç±»ã€‚reactæ˜¯å¼€å¯Literal based templateçš„ä¸€ä¸ªæˆåŠŸä¹‹ä½œã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼ŒDOM based templateå æ®ä¸»æµï¼ŒLiteral based templateå…¶å®æ›´å¤šåœ¨åç«¯æ¸²æŸ“ï¼Œç›´è‡³reactjsè·å¾—æˆåŠŸã€‚ä½œä¸ºä¸€ä¸ªåˆ›é€ è¿‡ DOM based template
è½®å­çš„å·¥ç¨‹å¸ˆï¼Œæˆ‘å½“æ—¶ä¹Ÿå¾ˆéš¾ç†è§£ï¼Œä¸ºä»€ä¹ˆè¦é€‰æ‹©è¿™ç§æ¨¡å¼ï¼Ÿæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘æœ€æ—©ç†è§£ Reactè®¾è®¡çš„å‡ºå‘ç‚¹æ˜¯ï¼šReact æ˜¯åç«¯å·¥ç¨‹å¸ˆåˆ›é€ çš„å‰ç«¯è½®å­ï¼ˆè™½ç„¶æˆ‘ä¸»è¦ä¹Ÿç®—æ˜¯åç«¯å·¥ç¨‹å¸ˆï¼‰ï¼Œå…¶æœ€æ—©ç¡®å®æ˜¯åº”ç”¨åœ¨æœåŠ¡ç«¯çš„ï¼Œé€æ­¥çš„è½¬ç§»åˆ°å‰ç«¯ã€‚
åœ¨åç«¯çš„è¯ï¼Œæ²¡æœ‰æµè§ˆå™¨æ„é€ çš„DOMï¼ŒLiteral Basedå®ç°æ›´ä¸ºç®€å•ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;React æ˜¯ Fuctional Program æ€ç»´ï¼Œ UI = f(data)ï¼Œè®©ä¸€æ‰¹æœ‰å‡½æ•°å¼æƒ…ç»“çš„åç«¯å·¥ç¨‹å¸ˆï¼Œæ¥æ•´å¤©åº”å¯¹ OOP çš„ä¸–ç•Œï¼Œå®Œå…¨æ˜¯ä¸‰è§‚ä¸æ­£ï¼Œéä½“ä¸é€‚çš„åœºæ™¯ã€‚
ï¼ˆè‡ªæ‰“æˆ‘ä»Scalaå…¥æ‰‹è½¬å˜åˆ°FPåï¼Œæˆ‘ç›®å‰ä¹Ÿæ˜¯æ·±åˆ»çš„é™¤åœ¨è¿™æ ·ä¸€ç§çŠ¶æ€ä¹‹ä¸‹ï¼‰ã€‚äºæ˜¯ï¼ŒReactå°±å‘¼ä¹‹æ¬²å‡ºäº†ã€‚å¤§å®¶åƒä¸‡ä¸è¦è®¤ä¸ºä¼šç”¨mapã€foreachå°±æ˜¯å‡½æ•°å¼ç¼–ç¨‹äº†&lt;&#x2F;li&gt;
&lt;li&gt;UI = f(data) æ˜¯ä¸€ä¸ªå¾ˆåä¸½çš„è½¬èº«ï¼Œéå¸¸æ»¡è¶³äº†FPå·¥ç¨‹å¸ˆçš„å®¡ç¾æ´ç™–ï¼Œä½†æ€§èƒ½å‘¢ï¼Ÿè¦çŸ¥é“åç«¯å·¥ç¨‹å¸ˆï¼Œå¯¹æ€§èƒ½ä¹Ÿæ˜¯éå¸¸ä¹‹è€¿è€¿äºæ€€çš„ï¼Œäºæ˜¯VDOMå’ŒDiffç®—æ³•å°±å‘¼ä¹‹æ¬²å‡ºäº†ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;JSX(Literal Termplate) + VDOM + Diff = ReactJSï¼Œä¸€ä¸ªæ–°ç‰©ç§è¯ç”Ÿå¹¶è·å¾—äº†å·¨å¤§çš„æˆåŠŸã€‚é™¤äº†Facebookçš„æ¨æ‰‹ï¼Œå…¶æœ¬èº«ä¹Ÿæ˜¯è¶³å¤Ÿæœ‰ä»·å€¼çš„ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;è¿™ä¸ªæ¨ç†è¿‡ç¨‹å®Œå…¨æ˜¯æˆ‘è‡ªå·±çš„æ£æµ‹ï¼Œæ˜¯å¦çœŸçš„å¦‚æ˜¯ï¼Œå°±ä¸å¾—è€ŒçŸ¥äº†ã€‚ä¸è¿‡ï¼ŒReactç¡®å®å¼€å¯äº†å…¨æ–°çš„å‰ç«¯å¼€å‘æ–°çš„æ€ç»´æ¨¡å‹ï¼Œä½¿å¾—æˆ‘ä»¬ä¸å†å±€é™äºåŸæœ‰çš„DOM basedï¼Œ
ä¹Ÿå¯ä»¥ä½¿ç”¨å®Œå…¨FPçš„æ–¹å¼ï¼Œæ¥è§£å†³UIçš„é—®é¢˜ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;LitHtmlçš„å¾ˆå¤šæ€è·¯æ˜¯ç»§æ‰¿äº†Reactçš„ï¼Œåªæ˜¯åœ¨å®ç°æ–¹å¼ä¸Šå¦è¾Ÿè¹Šå¾„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘åœ¨è¿™ç¯‡æ–‡ç« ä¸­è¯•å›¾åˆ†æçš„å†…å®¹ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ”¾å¼ƒ JSX è¯­æ³•ï¼Œé‡‡ç”¨ES6çš„ tag templateæŠ€æœ¯ï¼Œå®ç°æ®Šé€”åŒå½’ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; JSX
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;ShoppingList &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;extends &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;React.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Component &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;render&lt;&#x2F;span&gt;&lt;span&gt;() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;&amp;lt;div className=&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;shopping-list&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &amp;lt;h1&amp;gt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Shopping List for &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;this&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;props&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;.name}&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;h1&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &amp;lt;ul&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &amp;lt;li&amp;gt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Instagram&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;li&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &amp;lt;li&amp;gt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;WhatsApp&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;li&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;ul&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;          &lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;div&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; Taged Template
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;render&lt;&#x2F;span&gt;&lt;span&gt;() { 
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;html&lt;&#x2F;span&gt;&lt;span&gt;`&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;lt;div className=&amp;quot;shopping-list&amp;quot;&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;        &amp;lt;h1&amp;gt;Shopping List for {this.props.name}&amp;lt;&#x2F;h1&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;        &amp;lt;ul&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;          &amp;lt;li&amp;gt;Instagram&amp;lt;&#x2F;li&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;          &amp;lt;li&amp;gt;WhatsApp&amp;lt;&#x2F;li&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;        &amp;lt;&#x2F;ul&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;      &amp;lt;&#x2F;div&amp;gt;&lt;&#x2F;span&gt;&lt;span&gt;`
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;åº”è¯¥è¯´ï¼Œå¦‚æœåœ¨å½“å¹´æœ‰äº†tagged templateï¼ŒReactçš„å·¥ç¨‹å¸ˆå°±ä¸éœ€è¦è‡ªå·±åˆ›é€ ä¸€ä¸ªJSXäº†ã€‚JSXå®Œå…¨æ˜¯ä¸å¾—å·²è€Œä¸ºä¹‹çš„ä¸œè¥¿ã€‚
ES6ä¸­çš„template + tagged templateè¯­æ³•ç³–ï¼Œç®€ç›´å°±æ˜¯é€ç»™LitHtmlçš„ä¸€ä¸ªæœ€ä½³ç¤¼ç‰©ã€‚è¿™ä¸ªå·®å¼‚å®Œå…¨æ˜¯ç¯å¢ƒåŸå› å¼•èµ·çš„ã€‚ä¸è¿‡ï¼Œåæ¥è€…æ€»æ˜¯ä¼šå æ›´å¤šçš„ä¾¿å®œï¼Œ
æ— è®ºæ˜¯æ€æƒ³ä¸Šå¯ä»¥ç«™åœ¨å‰äººçš„è‚©è†€ä¹‹ä¸Šï¼Œè¿˜æ˜¯åœ¨å·¥å…·ä¸Šï¼Œæœ‰æ›´ä¸°å¯Œçš„å·¥å…·å¯ä»¥éšæ‰‹ä½¿ç”¨ã€‚æ€»ä¹‹ï¼ŒLitHtmlåŸºäºtagged templateï¼Œå¸¦æ¥çš„ä¼˜åŠ¿å°±æ˜¯ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼Œæ— éœ€é¢„ç¼–è¯‘ã€é¢„å¤„ç†ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;tagged tempalte æ‰©å±•èƒ½åŠ›æ›´å¼ºï¼Œç®€ç›´æ˜¯ä¸ºDSLå®šåˆ¶çš„æ‰©å±•å¤§æ³•ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;å…¶å®ƒçš„ä½¿ç”¨æ–¹æ³•ä¸ React ç›¸ä¼¼ï¼Œä¸è¿‡ï¼ŒLitHtml æ›´ä¸“æ³¨ä¸ºä¸€ä¸ªæ¸²æŸ“å¼•æ“ï¼Œä¸å°è¯•æä¾›ç»„ä»¶ã€åº”ç”¨æ¡†æ¶çš„ä¸œè¥¿ï¼Œå› æ­¤ï¼Œæ¦‚å¿µæå°‘ï¼ŒåŸºæœ¬ä¸Šå°±ä¸€ä¸ªæ„é€  html æ¨¡æ¿ï¼Œ
ç„¶åå°±æ˜¯ render è¿‡ç¨‹äº†ã€‚åœ¨Reactä¸­çš„ç»„ä»¶æŠ€æœ¯ç­‰ï¼Œéƒ½ä»LitHtmlä¸­å‰”é™¤äº†ï¼ˆè½¬ç§»åˆ°ç±»ä¼¼äº LitElementã€GlonJSè¿™æ ·çš„ç»„ä»¶æ¡†æ¶ä¹‹ä¸­ã€‚ï¼‰å› æ­¤ï¼Œå­¦ä¹ ä½¿ç”¨LitHtmlæ˜¯éå¸¸ç®€å•çš„ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;result &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;myTemplate&lt;&#x2F;span&gt;&lt;span&gt;({title: &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Hello&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;, body: &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;lit-html is cool&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;});
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;render&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;result&lt;&#x2F;span&gt;&lt;span&gt;, document.body);
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œé™¤äº†è¯­æ³•ä¸Šçš„å·®å¼‚ï¼ˆJSX vs tagged templateï¼‰ç›¸æ¯”Reactï¼ŒLitHtmlåœ¨renderä¸Šåˆ°åº•æœ‰ä»€ä¹ˆç‰¹åˆ«æ”¯æŒå‘¢ï¼Ÿæ˜¯å¦å¯ä»¥è¾¾åˆ°Reactçš„æ€§èƒ½ï¼Œæˆ–è€…è¶…è¶Šå‘¢ï¼Ÿ&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;example-1&quot;&gt;Example 1&lt;&#x2F;h2&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆé€‰æ‹©ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹ï¼Œæ¥å‰–æLitHtmlçš„æ¸²æŸ“è¿‡ç¨‹&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;html&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-html &quot;&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;script &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;type&lt;&#x2F;span&gt;&lt;span&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;module&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;{&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;LitElement&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;html&lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;@polymer&#x2F;lit-element&lt;&#x2F;span&gt;&lt;span&gt;&amp;#39;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;MyElement &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;extends &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;LitElement &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;static get &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;properties&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;() {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;            mood: { type: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;String &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;constructor&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;(){
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;super&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;();
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;this&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;.mood &lt;&#x2F;span&gt;&lt;span&gt;= &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;happy&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;render&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;() {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;html&lt;&#x2F;span&gt;&lt;span&gt;`&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Hello &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;${&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;this&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;.mood}&lt;&#x2F;span&gt;&lt;span&gt;`
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;customElements&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;define&lt;&#x2F;span&gt;&lt;span&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;my-element&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;MyElement&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;script&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;body&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;my-element&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;my-element&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;body&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;gou-zao-templateresult&quot;&gt;æ„é€ TemplateResult&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;code&gt;html&#x27;Hello ${this.mood}&#x27;&lt;&#x2F;code&gt; è¿™ä¸€è¡Œä»£ç ï¼Œæ„é€ çš„æ˜¯ä¸€ä¸ªTemplateResultå¯¹è±¡ã€‚è¿™ä¸€ä¸ªè¿‡ç¨‹çš„åŸç†å¯ä»¥å‚è€ƒï¼šTagged Template Stringã€‚
è¿™æ˜¯ES6çš„è¯­è¨€ç‰¹æ€§ï¼Œä¸å±äº LitHtml çš„ç§æœ‰ç‰¹å¾ï¼Œå› æ­¤ï¼Œé˜…è¯»ä¸‹é¢ç« èŠ‚ä¹‹å‰ï¼Œä¸€å®šè¦å…ˆäº†è§£è¿™ä¸ªè¯­è¨€ç‰¹æ€§ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ï¼ˆå¦‚æœä½ æ˜¯Scalaçš„ç”¨æˆ·ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯Scalaä¸­çš„å­—ç¬¦ä¸²æ’å€¼ï¼Œå¤§éƒ¨åˆ†æ–°å¼çš„è¯­è¨€éƒ½å¼€å§‹æ”¯æŒè¿™ä¸ªç‰¹æ€§äº†ã€‚ï¼‰&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;TemplateResult &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;strings&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;TemplateStringsArray;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; string[]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;:  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;any[];
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;type&lt;&#x2F;span&gt;&lt;span&gt;:  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;string;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; either html or svg
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;processor&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;TemplateProcessor;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;TemplateResult æ˜¯ä¸€ä¸ªå€¼å¯¹è±¡ï¼Œstringsæ˜¯æ¨¡æ¿å†…å®¹ï¼Œåœ¨æˆ‘ä»¬çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œå°±æ˜¯ &lt;code&gt;[&quot;Hello &quot;, &quot;&quot;]&lt;&#x2F;code&gt;, valueå°±æ˜¯æ¨¡æ¿ä¸­çš„å€¼ï¼Œåœ¨æˆ‘ä»¬çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œå°±æ˜¯ &lt;code&gt;[ this.modd ]&lt;&#x2F;code&gt;ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸€ä¸ªéœ€è¦ç‰¹åˆ«å…³æ³¨çš„æ˜¯ï¼šåœ¨åç»­è°ƒç”¨ renderæ–¹æ³•æ—¶ï¼Œ Hello ${this.mood} æ˜¯é‡ç”¨ç¬¬ä¸€æ¬¡çš„æ¨¡æ¿çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåç»­åˆ›å»ºçš„TemplateResultå¯¹è±¡ï¼Œ
å…¶ strings å€¼ä¸ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œå¯ä»¥ç†è§£ä¸ºç¼–è¯‘æ—¶æœŸå°±ç¡®å®šçš„ä¸€ä¸ªå¸¸é‡å€¼ï¼Œè€Œå˜åŒ–çš„åªæœ‰ value æ•°ç»„ã€‚&lt;&#x2F;p&gt;
&lt;h2 id=&quot;xuan-ran-guo-cheng&quot;&gt;æ¸²æŸ“è¿‡ç¨‹&lt;&#x2F;h2&gt;
&lt;p&gt;LitHtml ä½¿ç”¨ &lt;code&gt;LitHtml.render( container, templateResult ) &lt;&#x2F;code&gt; æ¥å®Œæˆä¸€æ¬¡æ¸²æŸ“ï¼ˆå³ç”Ÿæˆæˆ–æ›´æ–°containerä¸‹çš„DOMç»“æ„ï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;é¦–æ¬¡æ¸²æŸ“&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯¹åº”äº TemplateResultæ˜¯ä¸€ä¸ªLiteralç‰ˆæœ¬çš„æ¨¡æ¿å¯¹è±¡ï¼ŒTemplateåˆ™æ˜¯ä¸€ä¸ªDOMç‰ˆæœ¬çš„æ¨¡æ¿å¯¹è±¡ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ TemplateResultä¸­æ¨¡æ¿æ˜¯ä»¥å­—ç¬¦ä¸²å½¢å¼å­˜åœ¨ã€‚Templateä¸­åˆ™æ˜¯ä»¥html templateå…ƒç´ å­˜åœ¨ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨TemplateResultä¸­ï¼ŒåŠ¨æ€çš„å€¼æ˜¯ä»¥ value[] å­˜åœ¨ï¼Œè€Œåœ¨ Templateä¸­ï¼Œåˆ™æ˜¯ä»¥ ( index ) å½¢å¼å­˜åœ¨ï¼Œ
index æ˜¯è¯¥å€¼åœ¨DOMä¸­çš„node indexã€‚ï¼ˆæŒ‰ç…§æ ‡å‡†éå†é¡ºåºï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æŒ‡å‘æœ€ç»ˆæ¸²æŸ“çš„ DOMã€‚æˆ–è€…æ˜¯ fragementã€attributeã€eventç­‰ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;ç»´æŠ¤DOMä¸­å„ä¸ªåŠ¨æ€éƒ¨åˆ†çš„ Part[]ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;renderæ—¶ï¼ŒLitHtmlå¹¶ä¸æ˜¯å°† TemplateResult å…³è”åˆ° container æœ¬èº«ï¼Œç›¸åï¼Œè€Œæ˜¯åœ¨ container ä¸­åˆ›å»ºå­å…ƒç´ ã€‚
(ç”±äº TemplateResult æœ¬èº«å¯èƒ½æ˜¯ &lt;code&gt;&amp;lt;div&amp;gt;...&amp;lt;&#x2F;div&amp;gt; &amp;lt;div&amp;gt;...&amp;lt;&#x2F;div&amp;gt;&lt;&#x2F;code&gt; ç­‰å¤šä¸ªå…ƒç´ ç‰‡æ®µï¼Œå¹¶ä¸ä¸€å®šå¯¹åº”åˆ°å•ä¸ªçš„Nodeã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;startNode å’Œ endNode æ˜¯ LitHtml è‡ªå·±åˆ›å»ºçš„åœ¨DOMä¸­çš„ Comment å…ƒç´ ï¼Œè¿™äº›å…ƒç´ å æ®DOMä½ç½®ï¼Œä½†å¹¶ä¸å½±å“å–§è½¯è¿‡ç¨‹ã€‚
NodePartåˆ›å»ºçš„å…ƒç´ å°†ä»‹äºè¿™ä¸¤ä¸ªå…ƒç´ ä¹‹é—´ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æ ¹æ® templateResult åˆ›å»ºä¸€ä¸ª &lt;code&gt;&amp;lt;template&amp;gt;&lt;&#x2F;code&gt; å…ƒç´ ã€‚è¿™ä¸ªè¿‡ç¨‹ç›¸å½“äºå®Œæˆä» Literal åˆ° DOM çš„ä¸€ä¸ªè½¬æ¢ã€‚
å¯¹åº”åˆ°æœ¬ç¤ºä¾‹ä¸­ï¼Œç›¸å½“äºåˆ›å»ºäº†å¦‚ä¸‹çš„ä¸€ä¸ª DOM&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;html&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-html &quot;&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;template&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;Hello &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&amp;lt;!----&amp;gt;&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;template&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ª Template å¯¹è±¡ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Template &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;element&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;HtmlTemplateElement;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;parts&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;TemplatePart[]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;   }
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;TemplatePart &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;type&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;string; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; node | attribute
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;index&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;number; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; for node and attribute
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;string    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; for attribute
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;       &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;strings&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;string[] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;&#x2F;&#x2F; for attribute
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;   }
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æ ¹æ® Template å¯¹è±¡åˆ›å»º TemplateInstance å¯¹è±¡ã€‚
Template åªæ˜¯ä¸€ä¸ªDOMæ¨¡æ¿ï¼ˆdom + parts)ï¼Œå¹¶ä¸çœŸæ­£ä¸æ¸²æŸ“çš„DOMæ ‘å…³è”ã€‚
è€Œ TemplateInstance åˆ™æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶çš„ç¤ºä¾‹ï¼Œæ˜¯ä½œä¸ºæ‰€æœ‰ä½¿ç”¨ æ¨¡æ¿ å¤Ÿæ—©çš„ NodePart çš„ Modelã€‚&lt;&#x2F;p&gt;
&lt;p&gt;TemplateInstance åˆ™æ˜¯ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;TemplateInstance &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;template&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;Template;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;_fragment&lt;&#x2F;span&gt;&lt;span&gt;:  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;Fragement;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;_parts&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;Part[];
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ä¸‹å›¾æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ¸²æŸ“æ•°æ®æµï¼š&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;litelement&#x2F;lit-render.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åˆ é™¤ container ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚renderä¼šæ ¹æ® html æ¨¡æ¿ï¼Œé‡æ–°æ›´æ–° container ä¸‹çš„å…¨éƒ¨æ˜¾ç¤ºå†…å®¹ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;æ–°åˆ›å»ºä¸€ä¸ª NodePart å¯¹è±¡ï¼Œå¹¶å…³è”åˆ° containerã€‚
LitHtmlä¸­ï¼ŒPart å……å½“äº†MVCæ¨¡å¼ä¸­çš„ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œå®ƒè¿æ¥äº† Modelï¼ˆæ¨¡ç‰ˆå†…å®¹ï¼‰ã€Viewï¼ˆDOM Node)ï¼Œå¹¶å®Œæˆæ›´æ–°è¿‡ç¨‹ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæ–°åˆ›å»ºçš„NodePart è¿æ¥äº† TemplateResultï¼ˆModel)ã€containerï¼ˆView)ï¼Œå¹¶æ§åˆ¶è¿™ä¸ªæ¸²æŸ“è¿‡ç¨‹ã€‚&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;interface &lt;&#x2F;span&gt;&lt;span&gt;Part {
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;: any;
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;setValue&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;: any): void;
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;commit&lt;&#x2F;span&gt;&lt;span&gt;(): void;
&lt;&#x2F;span&gt;&lt;span&gt;  }
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;NodePart &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;implements &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Part &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;startNode&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;endNode&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;Node;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;any;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;__pendingValue&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;any;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#eff1f5;&quot;&gt;  }
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;part.setValue ( templateResult ) å°† templateResult ä½œä¸º part çš„æ–°å€¼ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;part.commit æäº¤æ–°å€¼ (templateResult)ï¼Œè¿™ä¸ªä¼šæ›´æ–° part å¯¹åº”çš„ DOMã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;åç»­æ¸²æŸ“&lt;&#x2F;p&gt;
&lt;p&gt;å¯¹ cotainer è¿›è¡Œç¬¬äºŒæ¬¡çš„æ¸²æŸ“æ—¶ï¼Œå…¶åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ£€æŸ¥å½“å‰ TemplateInstance çš„æ¨¡æ¿æ˜¯å¦ä¸ result çš„æ¨¡æ¿æ˜¯å¦ä¸€è‡´ï¼Ÿ&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœä¸‹ä¸€æ¬¡ render ä½¿ç”¨çš„æ˜¯å¦å¤–ä¸€ä¸ªæ¨¡æ¿ï¼Œåˆ™ç›¸å½“äºå®Œæˆé‡æ–°æ¸²æŸ“ï¼Œå…¶è¿‡ç¨‹ä¸é¦–æ¬¡æ¸²æŸ“å®Œå…¨ç›¸åŒï¼Œå‚è§ä¸Šé¢çš„åˆ†æè¿‡ç¨‹ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœä½¿ç”¨çš„æ˜¯ç›¸åŒçš„æ¨¡æ¿ï¼Œåˆ™è¡¨ç¤ºåªæœ‰æ¨¡æ¿ä¸­çš„å€¼ä¼šå˜åŒ–ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å°†æ¯ä¸€ä¸ª TemplateResult çš„æ–°å€¼æ›´æ–°åˆ°å¯¹åº”çš„ Part çš„æ–°å€¼ï¼Œå¹¶æäº¤ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å‡è®¾æ˜¯ä¸€ä¸ªNodePartï¼Œæ–°å€¼æ˜¯ Stringï¼Œåˆ™å¯¹åº”çš„ä½ç½®ä¼šæ›¿æ¢æˆTEXTã€‚ï¼ˆå¦‚æœåŸæ¥çš„èŠ‚ç‚¹è¿˜å­˜åœ¨ä¸”æ˜¯ TEXTï¼Œ
åˆ™åœ¨åŸnodeä¸Šæ›´æ–°å€¼ï¼Œå¦åˆ™ï¼Œåˆ é™¤åŸæ¥çš„èŠ‚ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„TEXTèŠ‚ç‚¹ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;å‡è®¾æ˜¯ä¸€ä¸ªNodePartï¼Œæ–°å€¼æ˜¯TemplateResultï¼Œå³åµŒå¥—çš„htmlæ¨¡æ¿ï¼Œåˆ™é€’å½’å¤„ç†è¿™ä¸ªè¿‡ç¨‹ã€‚ï¼ˆ
å¦‚æœåŸNodePartæ˜¯ä¸€ä¸ªTemplateResultï¼Œä¸”å…·æœ‰ç›¸åŒçš„æ¨¡æ¿ï¼Œåˆ™åªæœ‰å…¶ä¸­åŠ¨æ€çš„éƒ¨åˆ†è¢«æ›¿æ¢ï¼Œå¦åˆ™æ•´ä½“æ›¿æ¢ã€‚ï¼‰&lt;&#x2F;li&gt;
&lt;li&gt;æ£€æŸ¥ container æ˜¯å¦æœ‰å¯¹åº”çš„ NodePartï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç›´æ¥å°† TemplateResult ä½œä¸ºvalueæ›´æ–°å¯¹åº”çš„ partã€‚
è¿™ä¸ªè¿‡ç¨‹ä¸å†éœ€è¦ä¸Šé¢çš„ ä» TemplateResult -&amp;gt; Template -&amp;gt; TemplateInstance çš„è¿‡ç¨‹ï¼Œ
è€Œæ˜¯ç›´æ¥æ‰¾åˆ° NodePartï¼Œæ›´æ–°å…¶å€¼ã€‚NodePart æ›´æ–° TemplateResult çš„è¿‡ç¨‹&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœ container æ²¡æœ‰ å¯¹åº”çš„ partï¼Œåˆ™è¡¨æ˜æ˜¯é¦–æ¬¡renderï¼Œä½¿ç”¨ä¸Šä¸€èŠ‚ä»‹ç»çš„æµç¨‹è¿›è¡Œæ¸²æŸ“ï¼š
ä» TemplateResult -&amp;gt; Template -&amp;gt; TemplateInstanceã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;lithtmlgeng-gao-xiao-ma&quot;&gt;LitHtmlæ›´é«˜æ•ˆå—ï¼Ÿ&lt;&#x2F;h2&gt;
&lt;p&gt;ä¸Šé¢è§£æäº† LitHtml çš„æ¸²æŸ“è¿‡ç¨‹ï¼Œæ•´ä¸ªæµç¨‹æ˜¯éå¸¸ç®€å•çš„ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªè¿‡ç¨‹é‡‡å–äº†é‚£äº›æªæ–½ï¼Œä½¿å¾—å…¶å…·æœ‰æ›´é«˜çš„æ€§èƒ½å‘¢ï¼Ÿ
ç›¸æ¯” React ä¼šæ›´é«˜æ•ˆå—ï¼Ÿ&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Tagged Template String æ‰§è¡Œç›¸æ¯” JSX æ›´é«˜æ•ˆã€‚JSXæ¯æ¬¡renderæ—¶ï¼Œéƒ½éœ€è¦å®Œæ•´çš„æ„é€ ä¸€ä¸ªè™šæ‹ŸDOMï¼Œ
è€ŒLitHtmlï¼Œåˆ™åªæ˜¯é‡æ„ä¸€ä¸ª è½»é‡çº§çš„ TemplateResult å¯¹è±¡ï¼Œå˜åŒ–çš„åªæœ‰ value é›†åˆã€‚
å½“VDOMè¾ƒå¤§æ—¶ï¼ŒLitHtmlçš„é€Ÿåº¦ä¼šå¿«1-2ä¸ªæ•°é‡çº§ã€‚è€Œä¸”ï¼ŒTemplateResult åœ¨memory footä¸Šä¹Ÿè¦è¿œè¿œå°äº VDOMã€‚&lt;&#x2F;li&gt;
&lt;li&gt;ä» TemplateResult åˆ° &lt;code&gt;&amp;lt;template&amp;gt;&lt;&#x2F;code&gt; çš„è¿‡ç¨‹ï¼Œæ˜¯ç›´æ¥ä» TemplateResult æ„é€  html ï¼Œç„¶åä½¿ç”¨ template.innerHTML
å®Œæˆè§£æçš„ã€‚è¿™ä¸ªè¿‡ç¨‹ä½¿ç”¨æµè§ˆå™¨è‡ªå·±çš„è¯­æ³•è§£æå™¨æ¥å®Œæˆçš„ã€‚ç”±äºä½¿ç”¨äº† template æŠ€æœ¯ï¼Œ
è¿™ä¸ªDOMæ˜¯ä¸€ä¸ªDocumentFragementï¼Œå¹¶ä¸æ˜¯çœŸå®DOMçš„ä¸€éƒ¨åˆ†ï¼Œå†…å­˜å ç”¨å°ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å®é™…æ¸²æŸ“çš„DOMç”Ÿæˆï¼Œæ˜¯ä» template.importNode æ¥å®ŒæˆDOMçš„å¤åˆ¶ã€‚è€Œä¸æ˜¯å‘Reactä¸€æ ·é€ä¸ªDomèŠ‚ç‚¹çš„åˆ›å»ºã€‚
å¯¹äºè¾ƒå¤§çš„DOMï¼Œè¿™ä¸ªé¦–æ¬¡æ¸²æŸ“çš„æ•ˆç‡ä¼šé«˜å¾ˆå¤šã€‚&lt;&#x2F;li&gt;
&lt;li&gt;åœ¨å¢é‡æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼ŒLitHtml å’Œ React ç›¸ç±»ä¼¼ï¼Œéƒ½æ˜¯æŒ‰ç…§ç›¸åŒå±‚æ¬¡çš„èŠ‚ç‚¹é‡ç”¨çš„æ–¹å¼ï¼Œ
Reacté€šè¿‡ diff(VDOM, DOM)æ¥å®ç°å¢é‡æ›´æ–°ï¼Œè€ŒLitHtmlå¹¶æ²¡æœ‰ä½¿ç”¨diffç®—æ³•ï¼Œè€Œæ˜¯åŸºäºç›¸åŒæ¨¡æ¿çš„æ¸²æŸ“ï¼Œ
åªéœ€è¦å¯¹åŠ¨æ€éƒ¨åˆ†è¿›è¡Œæ›´æ–°å³å¯ã€‚ä¸¤è€…æ®Šé€”åŒå½’ï¼Œä½†LitHtmlçš„è®¡ç®—è¿‡ç¨‹æ›´åŠ è½»å·§ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;é‚£ä¹ˆï¼ŒLitHtmlæ˜¯å¦‚ä½•å¤„ç†å¤§æ•°ç»„å¾ªç¯å¯¹åº”çš„ DOM æ›´æ–°å‘¢ï¼Ÿå¦‚ä¸‹é¢çš„ä¾‹å­ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;myTemplate &lt;&#x2F;span&gt;&lt;span&gt;= (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;items&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;html&lt;&#x2F;span&gt;&lt;span&gt;`&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;lt;ul&amp;gt; ${&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;items&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;i &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;html&lt;&#x2F;span&gt;&lt;span&gt;`&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;lt;li&amp;gt;item ${&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;i&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;}&amp;lt;&#x2F;li&amp;gt;&lt;&#x2F;span&gt;&lt;span&gt;`&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;) } &amp;lt;&#x2F;ul&amp;gt;&lt;&#x2F;span&gt;&lt;span&gt;`
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;items &lt;&#x2F;span&gt;&lt;span&gt;= [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;4&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;6&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;7&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;8&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;9&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;];
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;render&lt;&#x2F;span&gt;&lt;span&gt;( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;myTemplate&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;items&lt;&#x2F;span&gt;&lt;span&gt;),   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;div&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;items&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;remove&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;render&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;myTemplate&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;items&lt;&#x2F;span&gt;&lt;span&gt;), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;div&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å½“ items åˆ é™¤æ‰ 1 æ—¶ï¼Œä¸Šé¢çš„ä»£ç ï¼Œå…¶å®æ˜¯å¯¹æ‰€æœ‰è¡Œéƒ½æ›´æ–°äº†ï¼Œè€Œæœ€å°çš„æˆæœ¬ï¼Œåº”è¯¥æ˜¯ç›´æ¥å°†ç¬¬ä¸€è¡Œåˆ é™¤ï¼Œä¿ç•™å…¶ä»–çš„DOMèŠ‚ç‚¹ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¾ˆé—æ†¾ï¼ŒLitHtmlå¹¶ä¸ä¼šè‡ªåŠ¨å¸®ä½ åšè¿™ä¸ªä¼˜åŒ–ï¼Œä¸è¿‡ï¼Œä½ å¯ä»¥ä½¿ç”¨ LitHtml çš„ Repeat æŒ‡ä»¤ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;{&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;repeat&lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;@lit-html&#x2F;directives&#x2F;repeat&lt;&#x2F;span&gt;&lt;span&gt;&amp;quot;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;myTemplate &lt;&#x2F;span&gt;&lt;span&gt;= (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;items&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;html&lt;&#x2F;span&gt;&lt;span&gt;`&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;lt;ul&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;${ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;repeat&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;items&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;,  &lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;i&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;i&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;,  &lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;i&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;index&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;html&lt;&#x2F;span&gt;&lt;span&gt;`&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;lt;li&amp;gt;item ${&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;i&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;}&amp;lt;&#x2F;li&amp;gt;&lt;&#x2F;span&gt;&lt;span&gt;`&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;) }
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;lt;&#x2F;ul&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;`
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;render&lt;&#x2F;span&gt;&lt;span&gt;( &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;myTemplate&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;items&lt;&#x2F;span&gt;&lt;span&gt;), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;div&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;å®é™…ä¸Šï¼ŒLitHtmlå¼€æ”¾äº† Part çš„æ“ä½œAPIï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥å¯¹æ ‡å‡†çš„æ¸²æŸ“è¡Œä¸ºè¿›è¡Œå®šåˆ¶ï¼Œæ¯”å¦‚è¿™é‡Œçš„repeatå°±æ˜¯è¿™æ ·çš„ä¸€æ¬¡å®šåˆ¶ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;litelement&quot;&gt;LitElement&lt;&#x2F;h1&gt;
&lt;p&gt;åŸºäº LitHtml è¿™ä¸ªé«˜æ•ˆçš„æ¸²æŸ“å¼•æ“ï¼ŒLiElement å…¶å®åªæ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§çš„ WebComponent å°è£…ï¼Œä¸»è¦çš„ç‰¹æ€§åŒ…æ‹¬ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;WebComponent ç”Ÿå‘½å‘¨æœŸæ¨¡å‹æ”¯æŒã€‚&lt;&#x2F;li&gt;
&lt;li&gt;å•å‘çš„æ•°æ®ç»‘å®šæ¨¡å‹ã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;hou-xu&quot;&gt;åç»­&lt;&#x2F;h2&gt;
&lt;p&gt;åç»­æœ‰æœºä¼šï¼Œæˆ‘ä¼šè¿›ä¸€æ­¥åˆ†æï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;LitElement vs PolymerElement æ¯”è¾ƒä¸€ä¸‹ä¸»è¦çš„ç‰¹å¾ï¼Œæ˜¯å¦ä¼šå¯¹åº”ç”¨å¼€å‘æ›´å‹å¥½ã€‚&lt;&#x2F;li&gt;
&lt;li&gt;why one-way databinding and why not two-way databinding ?
åŒå‘æ•°æ®ç»‘å®šæ˜¯Polymerçš„ä¸€ä¸ªé‡è¦ç‰¹å¾ï¼Œå¯æ˜¯LitElementæ”¾å¼ƒäº†è¯¥ç‰¹æ€§ï¼Œé‡‡ç”¨äº†ä¸Reactä¸€è‡´çš„å•é¡¹æ•°æ®ç»‘å®šã€‚
å¯¹æ­¤ï¼Œæˆ‘ä¸ªäººæŒæœ‰ä¸åŒæ„è§ï¼Œä¹Ÿå¸Œæœ›åœ¨åç»­çš„é˜¶æ®µè¿›ä¸€æ­¥çš„å¯¹è¿™2ç§æ¨¡å¼è¿›è¡Œåˆ†æã€‚&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>è´¦åŠ¡ç³»ç»Ÿè®¾è®¡åŠåº”ç”¨</title>
        <published>2016-06-15T00:00:00+00:00</published>
        <updated>2016-06-15T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://wangzaixiang.github.io/blog/account-system/"/>
        <id>https://wangzaixiang.github.io/blog/account-system/</id>
        
        <content type="html" xml:base="https://wangzaixiang.github.io/blog/account-system/">&lt;p&gt;æ‘˜è¦ï¼šæœ¬æ–‡æ¥è‡ªä¸­ç”Ÿä»£æŠ€æœ¯äº¤æµç¾¤çš„åˆ†äº«ã€‚åˆ†äº«è€…ï¼šç‹åœ¨ç¥¥ï¼Œç°ä»»å¿«å¡‘ç½‘ CTOï¼Œå…·æœ‰20å¹´ITä»ä¸šç»éªŒï¼Œç›®å‰è´Ÿè´£å¤§å®—å•†å“ç”µå•†å¿«å¡‘ç½‘çš„B2Bå¹³å°ï¼Œ
æœ‰ä¸°å¯Œçš„äº§å“å’Œç ”å‘ç®¡ç†ç»éªŒã€‚æœ¬æ–‡å°†åˆ†äº«æ¥è‡ªå®æˆ˜çš„å…³äºç”µå•†B2Bå¹³å°è´¦åŠ¡ç³»ç»Ÿè®¾è®¡ç»éªŒã€‚ &lt;a href=&quot;https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;I8A_zF6MTkMle8o6uI8Wag&quot;&gt;åŸæ–‡è¿æ¥&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‹åœ¨ç¥¥
20å¹´ITä»ä¸šç»éªŒï¼Œæ··æˆ˜è¿‡é“¶è¡Œã€èˆªç©ºæ—…æ¸¸ç­‰è¡Œä¸šã€‚å…¨æ ˆå·¥ç¨‹å¸ˆã€‚ç¼–ç¨‹è¯­è¨€çˆ±å¥½è€…ã€æ–°è½®å­çˆ±å¥½è€…ã€scalaçˆ±å¥½è€…ã€‚æ··è¿¹è¿‡é“¶è¡Œã€èˆªç©ºæ—…æ¸¸ç­‰è¡Œä¸šï¼Œ
æ‹…ä»»è¿‡ æ˜“ç½‘é€šå•†æ—… CTOã€å¥½æ˜“ç”µå­è”è¡Œ CTOï¼Œç°ä»»å¿«å¡‘ç½‘ CTOã€‚å”¯å“ä¼šSOAæ¶æ„OSPåˆ›å»ºè€…ã€‚ä¸šä½™é©¬æ‹‰æ¾çˆ±å¥½è€…ã€‚&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;æœ¬æ¬¡åˆ†äº«çš„ä¸»é¢˜æ˜¯â€œå¸åŠ¡ç³»ç»Ÿè®¾è®¡åŠå…¶åœ¨ç”µå•†çš„åº”ç”¨â€ï¼Œä¸»è¦ä»‹ç»å¤å¼è®°è´¦æ–¹æ³•ï¼Œä»¥åŠå…¶åœ¨ç”µå•†ä¸­çš„åº”ç”¨ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å†…å®¹æ¦‚è¦&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;èƒŒæ™¯ä»‹ç»&lt;&#x2F;li&gt;
&lt;li&gt;å¤å¼è®°è´¦æ³•&lt;&#x2F;li&gt;
&lt;li&gt;å¸åŠ¡ç³»ç»ŸåŸºæœ¬è¦ç´ &lt;&#x2F;li&gt;
&lt;li&gt;åœ¨ç”µå•†å¹³å°çš„åº”ç”¨&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;bei-jing-jie-shao&quot;&gt;èƒŒæ™¯ä»‹ç»&lt;&#x2F;h1&gt;
&lt;p&gt;é¦–å…ˆç”³æ˜ä¸€ä¸‹ï¼Œè¿™ä¸€å—å¹¶ä¸æ˜¯å®šä½äºä¸“ä¸šçš„è´¢åŠ¡ç³»ç»Ÿè€Œè°ˆçš„ï¼Œæˆ‘æœ¬äººä¹Ÿæ²¡æœ‰ä¸“ä¸šçš„è´¢åŠ¡çŸ¥è¯†å’Œç›¸å…³å·¥ä½œç»éªŒã€‚ä½†æ˜¯å¾ˆå¤šçš„ä¸šåŠ¡ç³»ç»Ÿã€ç”µå•†ç³»ç»Ÿéƒ½æ¶‰åŠåˆ°èµ„é‡‘çš„ç»“ç®—é—®é¢˜ï¼Œ
è€Œä¸”è¿™ä¸€å—å¾€å¾€ä¹Ÿæ˜¯ä¸šåŠ¡ä¸­æœ€ä¸ºå¤æ‚çš„ä¸€å—ï¼Œå¤§éƒ¨åˆ†çš„æŠ€æœ¯äººå‘˜å¹¶ä¸æ‡‚è´¢åŠ¡çŸ¥è¯†ï¼Œå¾€å¾€é‡‡ç”¨ä¸€äº›ç±»ä¼¼äºâ€æ”¶ä»˜è®°è´¦â€œçš„æ€è·¯ï¼Œæ¥è®°å½•èµ„é‡‘çš„å˜åŒ–ï¼Œå¾€å¾€ä¼šè¶Šå¾€åèµ°ï¼Œ
ç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œè€Œä¸”èµ„é‡‘ä¹‹é—´çš„å…³ç³»ä¹Ÿä¼šè¶Šæ¥è¶Šæ··ä¹±ï¼Œè´¦ç®—ä¸æ¸…æ¥šï¼Œä¹Ÿä¼šå¸¦æ¥è´¢åŠ¡å®‰å…¨æ–¹é¢çš„å¾ˆå¤šé—®é¢˜ã€‚æˆ‘ä¹‹å‰æœ‰è¿‡é“¶è¡Œæ ¸å¿ƒç³»ç»Ÿå»ºè®¾çš„ä¸€äº›ç»éªŒï¼Œ
æ„Ÿè§‰å°†è¿™ä¸€å—çš„æ€è·¯åº”ç”¨åœ¨éè´¢åŠ¡ç³»ç»Ÿä¸­ï¼Œå¯ä»¥åŒ–ç¹ä¸ºç®€ã€ä»¥é™åˆ¶åŠ¨ï¼Œç®¡å¥½é’±å’Œè´¦ï¼Œå¾€å¾€èƒ½å¤Ÿèµ·åˆ°å¾ˆç¥å¥‡çš„æ•ˆæœã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ¯”å¦‚è¯´å¯¹å¿«å¡‘ç½‘ï¼Œæˆ‘ä»¬çš„è®¢å•å°±æ¶‰åŠåˆ°å¤æ‚çš„èµ„é‡‘ç»“ç®—å…³ç³»ï¼Œç”±äºæ˜¯å¤§å®—å•†å“ï¼Œå®¢å•ä»·å¾ˆé«˜ï¼Œçº¿ä¸‹çš„ä¸šåŠ¡æµç¨‹æ¯”è¾ƒå¤æ‚ï¼Œæ”¶ä»˜æ¬¾ä¸€å—çš„å¤æ‚åº¦æ˜¯å¾ˆé«˜çš„ï¼Œ
ä¼ ç»Ÿçš„æ–¹å¼ï¼Œæ˜¯æ”¶ä»˜æ¬¾åœ¨ç‹¬ç«‹çš„è´¢åŠ¡ç³»ç»Ÿä¸­è§£å†³ï¼Œä½†è¿™æ ·ï¼Œåˆéš¾ä»¥å’Œè¿è¥æµç¨‹å¾ˆå¥½çš„ç»“åˆèµ·æ¥ã€‚æˆ‘ä»¬ä¹‹å‰å°±æ˜¯é‡‡ç”¨ç±»ä¼¼äºâ€æ”¶ä»˜è®°è´¦â€œçš„æ–¹æ³•ï¼Œç®€å•çš„çºªå½•æ”¶ä»˜æ¬¾æµæ°´ï¼Œ
è¿™ç§æ–¹å¼éšç€ä¸šåŠ¡çš„å˜åŒ–ã€ä»¥åŠè¿è¥çš„ç²¾ç»†åŒ–ï¼Œè¶Šæ¥è¶Šéš¾ç§»æ»¡è¶³è¦æ±‚ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå•å•è®¢å•æ”¶æ¬¾æµæ°´ï¼Œå°±è¦è€ƒè™‘åˆ°ä¸åŒçš„æ”¶æ¬¾æ¸ é“
ï¼ˆé“¶è¡Œè½¬è´¦ã€èµ„é‡‘å¸æˆ·ã€é‡‘èè´·æ¬¾ã€é¢„æ”¶æ¬¾ï¼‰ã€æ”¶æ¬¾ç”¨é€”ï¼ˆä¿è¯é‡‘ã€è´§æ¬¾ã€è¿è´¹ã€è¿çº¦é‡‘ï¼‰ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å†å…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å†…éƒ¨å¯¹è®¢å•è¿›è¡Œç²¾ç»†åŒ–çš„æ ¸ç®—ï¼ŒåŒºåˆ†è®¢å•å†…çš„è´§ç‰©æ¯›åˆ©ã€ç‰©æµæ¯›åˆ©ã€é‡‘èæ¯›åˆ©ï¼Œè€Œæ¯ä¸€é¡¹æ¯›åˆ©åˆéœ€è¦æ ¸ç®—é‡‡è´­ç«¯ã€é”€å”®ç«¯çš„æ¯”ä¾‹ã€‚
è€Œä¸”è¿™ä¸ªæ˜¯ä¸€ä¸ªä¸æ–­å˜åŒ–çš„è¿‡ç¨‹ï¼Œéšç€ä¸åŒçš„è®¢å•çš„æ”¶æ¬¾æ—¶é—´ã€ä»˜æ¬¾æ—¶é—´ã€æ”¶æ¬¾æ–¹å¼ã€ä»˜æ¬¾æ–¹å¼ã€è®¢å•çš„å±¥çº¦æƒ…å†µè€Œå˜åŒ–ï¼Œæƒ³æƒ³ï¼Œè¦æŠŠè¿™ä¹ˆå¤šè´¢åŠ¡æ•°æ®æ ¸ç®—æ¸…æ¥šï¼Œ
é‡‡ç”¨ä¼ ç»Ÿçš„â€œä¸šåŠ¡æµæ°´â€æ˜¯ä¸€ä»¶éå¸¸å›°éš¾ï¼Œä¹ƒè‡³ä¸å¯èƒ½çš„ä»»åŠ¡ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å†å…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å†…éƒ¨å¯¹è®¢å•è¿›è¡Œç²¾ç»†åŒ–çš„æ ¸ç®—ï¼ŒåŒºåˆ†è®¢å•å†…çš„è´§ç‰©æ¯›åˆ©ã€ç‰©æµæ¯›åˆ©ã€é‡‘èæ¯›åˆ©ï¼Œè€Œæ¯ä¸€é¡¹æ¯›åˆ©åˆéœ€è¦æ ¸ç®—é‡‡è´­ç«¯ã€é”€å”®ç«¯çš„æ¯”ä¾‹ã€‚
è€Œä¸”è¿™ä¸ªæ˜¯ä¸€ä¸ªä¸æ–­å˜åŒ–çš„è¿‡ç¨‹ï¼Œéšç€ä¸åŒçš„è®¢å•çš„æ”¶æ¬¾æ—¶é—´ã€ä»˜æ¬¾æ—¶é—´ã€æ”¶æ¬¾æ–¹å¼ã€ä»˜æ¬¾æ–¹å¼ã€è®¢å•çš„å±¥çº¦æƒ…å†µè€Œå˜åŒ–ï¼Œæƒ³æƒ³ï¼Œè¦æŠŠè¿™ä¹ˆå¤šè´¢åŠ¡æ•°æ®æ ¸ç®—æ¸…æ¥šï¼Œ
é‡‡ç”¨ä¼ ç»Ÿçš„â€œä¸šåŠ¡æµæ°´â€æ˜¯ä¸€ä»¶éå¸¸å›°éš¾ï¼Œä¹ƒè‡³ä¸å¯èƒ½çš„ä»»åŠ¡ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;fu-shi-ji-zhang-fa&quot;&gt;å¤å¼è®°è´¦æ³•&lt;&#x2F;h1&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img.png&quot; alt=&quot;img.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å…¶å®ï¼Œåˆšæ‰è¯´çš„è¿™äº›é—®é¢˜ï¼Œåœ¨ä¸“ä¸šçš„è´¢åŠ¡ç³»ç»Ÿä¸­å¯èƒ½å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ã€‚å…¶å®ï¼Œä¼ ç»Ÿçš„è´¢åŠ¡ç³»ç»Ÿï¼Œä¹Ÿæ˜¯é‡‡ç”¨â€œæ”¶ä»˜â€è®°è´¦æ³•çš„æ–¹å¼è¿›è¡Œçš„ï¼Œæœ‰äº›ç±»ä¼¼äºæˆ‘ä»¬æä¸€ä¸ªExcelï¼Œ
å¾ˆç®€å•çš„å‡ åˆ—ï¼š æ—¶é—´ã€ æ”¶æ¬¾é‡‘é¢ã€ä»˜æ¬¾é‡‘é¢ã€ç”¨é€”ï¼Œç­‰ç­‰ã€‚ä½†è¿™ç§æ–¹å¼å¾ˆéš¾ä»¥è§£å†³ä¼ä¸šè¿ä½œä¸­å¤æ‚çš„èµ„é‡‘å…³ç³»ï¼Œå› æ­¤ï¼Œç°åœ¨å·²ç»åºŸå¼ƒæ‰äº†ã€‚ç°åœ¨çš„è´¢åŠ¡ç³»ç»Ÿï¼Œ
éƒ½æ˜¯é‡‡ç”¨â€œå¤å¼è®°è´¦â€çš„æ–¹å¼ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ç¨‹åºå‘˜ä¸€èˆ¬éƒ½ä¸æ‡‚ä¼šè®¡çŸ¥è¯†ï¼Œä¸è¿‡ï¼Œæˆ‘å»ºè®®å¤§å®¶éƒ½åšä¸€äº›äº†è§£ã€‚ä¼šè®¡çŸ¥è¯†ä¸ä»…å¯ä»¥åº”ç”¨äºæˆ‘ä»¬çš„è½¯ä»¶è®¾è®¡ï¼Œè€Œä¸”ä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬å»é˜…è¯»ä¸€ä¸ªå…¬å¸çš„è´¢æŠ¥ï¼Œ
é¡ºä¾¿åšä¸€ç‚¹â€œä»·å€¼æŠ•èµ„â€çš„äº‹æƒ…ï¼Œè¯´ä¸å®šèµšçš„æ¯”å·¥ç¨‹å¸ˆè¦å¤šå¾ˆå¤šå‘¢ã€‚:)&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_1.png&quot; alt=&quot;img_1.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å¤å¼è®°è´¦æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä¼šè®¡æ’ç­‰å¼ï¼šèµ„äº§ ï¼ è´Ÿå€º ï¼‹ æ‰€æœ‰è€…æƒç›Šã€‚è¿™ä¸ªä¹Ÿæ˜¯æ‰€æœ‰çš„ä¼ä¸šè´¢åŠ¡æŠ¥è¡¨çš„æ ¸å¿ƒã€‚ é“¶è¡Œå¸æˆ·èµ„é‡‘ã€åº”æ”¶æ¬¾ã€é¢„æ”¶æ¬¾ã€å›ºå®šèµ„äº§
ï¼ˆç”µè„‘ã€åŠå…¬æ¡Œæ¤…ï¼‰ç­‰éƒ½å±äºèµ„äº§ï¼ŒçŸ­æœŸå€Ÿæ¬¾ã€åº”ä»˜æ¬¾ã€é¢„å”®æ¬¾ç­‰éƒ½æ˜¯è´Ÿå€ºï¼Œè€Œå…¬ç§¯é‡‘ã€æœªåˆ†é…åˆ©æ¶¦ã€å®æ”¶èµ„æœ¬ç­‰ç­‰å±äºæ‰€æœ‰è¿™æƒç›Šã€‚ ä¸€èˆ¬çš„ï¼Œåœ¨ä¸šåŠ¡è¿è¥ç±»ç³»ç»Ÿä¸­ï¼Œ
ä¸å¤ªä¼šæ¶‰åŠåˆ°æ‰€æœ‰è€…æƒç›Šè¿™ä¸€ç±»çš„å¸æˆ·ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä½œä¸ºä¼šè®¡æ’ç­‰å¼çš„ä¸€ä¸ªæ‰©å±•ï¼šèµ„äº§ ï¼‹ æ”¯å‡ºï¼ˆè´¹ç”¨ï¼‰ï¼ è´Ÿå€º ï¼‹ æ‰€æœ‰è€…æƒç›Š ï¼‹ æ”¶å…¥ï¼ˆæ”¶ç›Šï¼‰ï¼Œæ”¶å…¥ã€æ”¯å‡ºè¿™ä¸¤ç±»å¸æˆ·æ˜¯ä¼ä¸šè¿ä½œè¿‡ç¨‹ä¸­çš„æœ€ä¸ºå¸¸è§çš„ä¸šåŠ¡ï¼Œ
æ¯”å¦‚é”€å”®æ”¶å…¥ã€é‡‡è´­æ”¯å‡ºã€è´¹ç”¨è¡¥è´´ã€åˆ©æ¯æ”¶å…¥ã€åˆ©æ¯æ”¯å‡ºç­‰ç­‰ã€‚æ”¶å…¥ç±»å¸æˆ·çš„æ€§è´¨ä¸è´Ÿå€ºç±»ç›¸ä¼¼ï¼Œæ˜¯åœ¨ç­‰å¼çš„å³è¾¹ã€‚æ”¯å‡ºç±»å¸æˆ·çš„æ€§è´¨ä¸èµ„äº§ç±»ç›¸ä¼¼ï¼Œæ˜¯åœ¨ç­‰å¼çš„å·¦è¾¹ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¯¹äºåˆæ¬¡æ¥è§¦ä¼šè®¡çŸ¥è¯†çš„åŒå­¦ï¼Œè¿™äº›æ˜¯éå¸¸ç»•å£çš„ã€‚æ”¶å…¥ä¸ºä»€ä¹ˆå’Œè´Ÿå€ºåœ¨ä¸€èµ·ï¼Œæ˜æ˜æ”¶å…¥æ„æˆäº†æˆ‘çš„èµ„äº§å•Šï¼Œè€Œè´¹ç”¨æ€ä¹ˆåˆä¸èµ„äº§åœ¨ä¸€èµ·ï¼Œæ˜æ˜è´¹ç”¨æ˜¯æˆ‘çš„â€è´Ÿå€ºâ€œå•Šï¼Ÿ
è¿™äº›ï¼Œæ˜¯å¾ˆéš¾è§£é‡Šæ¸…æ¥šçš„ã€‚å»ºè®®ï¼Œåˆæ¬¡æ¥è§¦ä¼šè®¡çŸ¥è¯†çš„åŒå­¦ï¼Œåƒä¸‡ä¸è¦çº ç»“äºè¿™äº›â€ç»•å£â€œçš„æ¦‚å¿µï¼Œå¤§ä¸äº†æŠŠå¸æˆ·ç»“æ„æ˜ç¡®æ‰“å°å‡ºæ¥ï¼Œç…§å•æ¥æ”¶ï¼Œä¸ç†è§£ä¹Ÿä¸è¦çº ç»“ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_2.png&quot; alt=&quot;img_2.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_3.png&quot; alt=&quot;img_3.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æŒ‰ç…§ä¼šè®¡ç­‰å¼ï¼Œä»»ä½•ä¸€é¡¹ç»æµä¸šåŠ¡éƒ½ä¼šå¼•èµ·èµ„äº§ä¸æƒç›Šä¹‹é—´è‡³å°‘ä¸¤ä¸ªé¡¹ç›®å‘ç”Ÿå¢å‡å˜åŠ¨ï¼Œè€Œä¸”å¢å‡å˜åŠ¨çš„é‡‘é¢ç›¸ç­‰ã€‚å› æ­¤å¯¹æ¯ä¸€ç¬”ç»æµä¸šåŠ¡çš„å‘ç”Ÿï¼Œéƒ½å¯ä»¥ä»¥ç›¸ç­‰çš„
é‡‘é¢åœ¨ä¸¤ä¸ªæˆ–ä¸¤ä¸ªç›¸å…³è´¦æˆ·ä¸­ä½œç­‰é¢åŒé‡è®°å½•ã€‚è¿™ç§è®°è´¦å¦‚å®åæ˜ äº†ç»æµäº‹ç‰©çš„å®¢è§‚è”ç³»ï¼Œæ˜¯ä¸€ç§ç§‘å­¦çš„è®°è´¦æ–¹æ³•ã€‚å…¶å®ï¼Œåœ¨â€œæ”¶ä»˜â€è®°è´¦ä¸­ï¼Œæˆ‘ä»¬å·²ç»éšå«äº†è¿™ä¸ªå› ç´ ï¼Œ
æˆ‘ä»¬ä¼šè¡¥å……çºªå½•ä¸€ä¸‹æœ¬æ¬¡æ”¶ä»˜æ¬¾çš„â€œç”¨é€”â€ï¼Œå…¶å®ï¼Œä¹Ÿå°±æ˜¯æè¿°å¯¹æ–¹çš„ä¸€äº›æ€§è´¨ã€‚çŸ¥è¯†ï¼Œå¤å¼è®°è´¦æ³•æŠŠè¿™ä¸€å—æ ‡å‡†åŒ–äº†ï¼Œæ˜¯å¯¹â€œæ”¶ä»˜è®°è´¦â€çš„ä¸€æ¬¡ç§‘å­¦çš„å‡çº§ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å¯¹å¸æˆ·çš„å˜æ›´è®°å½•æœ‰2ç§ï¼šå€Ÿè®°ã€è´·è®°ã€‚å¯¹ä¸åŒæ€§è´¨çš„å¸æˆ·ï¼ˆä¹Ÿå¯ä»¥ç§°å‘¼ä¸ºä¼šè®¡ç§‘ç›®ï¼‰ï¼Œå®šä¹‰æ˜¯ä¸ä¸€æ ·çš„ã€‚æ¯”å¦‚èµ„äº§ç±»å¸æˆ·ï¼Œä¾‹å¦‚å­˜æ¬¾ï¼Œä¼šå¯¼è‡´å¸æˆ·ä½™é¢å¢åŠ ï¼Œ
æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œå€Ÿè®°â€ï¼Œå¦‚æœæ˜¯å–æ¬¾ï¼Œä¼šå¯¼è‡´å¸æˆ·ä½™é¢å‡å°‘ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œè´·è®°â€ï¼Œè€Œå¯¹è´Ÿå€ºç±»å¸æˆ·ï¼Œæ¯”å¦‚æ”¶åˆ°é¢„ä»˜æ¬¾ï¼Œä¼šå¯¼è‡´ä½™é¢å¢åŠ ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œè´·è®°â€ï¼Œ
è€Œå½’è¿˜é¢„ä»˜æ¬¾æˆ–è€…ä½¿ç”¨é¢„ä»˜æ¬¾ï¼Œä¼šå¯¼è‡´ä½™é¢å‡å°‘ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œå€Ÿè®°â€ï¼Œè¿™ä¸ªå¯ä»¥å‚è€ƒä¸Šè¿°çš„è¡¨æ ¼ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å†æ¬¡â€œå‹æƒ…æç¤ºâ€ï¼Œä¸ºä»€ä¹ˆé“¶è¡Œå­˜æ¬¾å¢åŠ æ˜¯â€œå€Ÿè®°â€ï¼Œæˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰å€Ÿæ¬¾å•Šï¼Ÿå¤§å®¶åƒä¸‡ä¸è¦çº ç»“äºè¿™ä¸ªå­—çœ¼ï¼Œæ­¤å€Ÿéå½¼å€Ÿã€‚å¦‚æœæä¸æ‡‚ï¼Œç›´æ¥æŸ¥æŸ¥è¡¨ï¼Œåƒä¸‡åˆ«çº å­—çœ¼ã€‚&lt;&#x2F;p&gt;
&lt;h1 id=&quot;zhang-wu-xi-tong-ji-ben-yao-su&quot;&gt;å¸åŠ¡ç³»ç»ŸåŸºæœ¬è¦ç´ &lt;&#x2F;h1&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_4.png&quot; alt=&quot;img_4.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;è¿™é‡Œä»‹ç»ä¸€ä¸‹å¸åŠ¡ç³»ç»Ÿçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚è¿™äº›æ¦‚å¿µä¹Ÿåªæ˜¯æˆ‘ä»¬ä¹‹å‰åœ¨é“¶è¡Œæ ¸å¿ƒç³»ç»Ÿä¸­çš„ä¸€äº›çº¦å®šï¼Œå¹¶ä¸ä»£è¡¨æ˜¯â€è¡Œä¸šæ ‡å‡†â€œã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å…³äºâ€œå¸æˆ·â€ï¼Œä¼šè®¡å¸æˆ·ï¼Œä¹Ÿç§°ä¹‹ä¸ºâ€œä¼šè®¡ç§‘ç›®â€ï¼Œå¦å¤–ï¼Œæˆ‘ä»¬è¿˜ä¼šæœ‰ä¸šåŠ¡å¸æˆ·ï¼Œæ¯”å¦‚å¯¹â€é¢„æ”¶æ¬¾â€œï¼Œæˆ‘ä»¬ä¼šå¯¹æ¯ä¸€ä¸ªå®¢æˆ·è®¾ç«‹ä¸€ä¸ªä¸šåŠ¡å¸æˆ·ã€‚è¿™ä¸¤ä¸ªå¸æˆ·æ˜¯åœ¨ä¸¤ä¸ªä¸åŒçš„ä½“ç³»ä¸­çš„ï¼Œ
ä¸€ä¸ªæ˜¯ä¼šè®¡å±‚é¢ï¼Œä¸€ä¸ªæ˜¯ä¸šåŠ¡å±‚é¢ï¼Œä½†åˆæœ‰ç›¸å…³æ€§ï¼šä¼šè®¡å¸æˆ·ä¸€èˆ¬æ˜¯å¯¹åº”çš„â€ä¸šåŠ¡å¸æˆ·â€œçš„æ±‡æ€»ã€‚æˆ‘ä»¬ä¹ŸæŠŠâ€ä¸šåŠ¡å¸æˆ·â€œç§°ä¹‹ä¸ºâ€åˆ†æˆ·è´¦â€œã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æœ‰ä¸¤ç§è®°è´¦çš„æ¨¡å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥æ“ä½œâ€œç§‘ç›®â€ï¼Œå¯¹å…¶è¿›è¡Œå€Ÿè®°ã€è´·è®°ï¼Œè¿™ç§æ–¹å¼ä¼šè®°å½•ä¼šè®¡è®°è´¦æµæ°´ï¼ŒåŒæ—¶æ›´æ–°å®¢æˆ·çš„ä½™é¢ã€‚å¦å¤–ä¸€ç§æ˜¯åªæ“ä½œä¸šåŠ¡å¸æˆ·ï¼Œ
æ¯”å¦‚å­˜æ¬¾ã€å–æ¬¾ç­‰æ“ä½œï¼Œåªä¿®æ”¹åˆ†æˆ·è´¦ï¼Œè®°å½•ä¸šåŠ¡æµæ°´ã€‚è€Œå®šæ—¶çš„ï¼ˆæ¯”å¦‚åœ¨æ¯å¤©æ—¥ç»“æ—¶ï¼‰ï¼Œå¯¹å½“å¤©çš„ä¸šåŠ¡æµæ°´è¿›è¡Œæ‰¹é‡å¤„ç†ï¼Œå†è®°å½•ä¼šè®¡æµæ°´ã€æ›´æ–°ä¼šè®¡ç§‘ç›®çš„ä½™é¢ã€‚
ä¸¤ç§æ–¹å¼å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œæ‰¹é‡çš„æ–¹å¼å°†è®°è´¦å»¶åï¼Œæ€§èƒ½å¯èƒ½æ›´é«˜ï¼Œè€Œä¸”ï¼Œä¸€äº›ä¸­é—´çš„æ“ä½œï¼ˆè­¬å¦‚å–æ¶ˆçš„æµæ°´ï¼‰æ— éœ€å¤„ç†ã€‚è€Œå®æ—¶æ“ä½œå¤æ‚æ€§è¦é«˜å¾ˆå¤šï¼Œä½†å®æ—¶æ“ä½œå¯ä»¥
å®æ—¶çš„ååº”ä¼šè®¡ç§‘ç›®çš„æœ€æ–°ä½™é¢ï¼Œä¹Ÿæ˜¯æœ‰ä»·å€¼çš„ã€‚å…·ä½“å¦‚ä½•é€‰å–ï¼Œåœ¨å®è·µä¸­éœ€è¦å¹³è¡¡ï¼Œæ ¹æ®ä¸šåŠ¡éœ€è¦é€‰å–ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_5.png&quot; alt=&quot;img_5.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_6.png&quot; alt=&quot;img_6.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;ä¸€èˆ¬çš„ï¼Œä¼šè®¡ç§‘ç›®æˆ‘ä»¬ä¸ä¼šé€‰æ‹©â€œè‡ªå¢â€çš„æ–¹å¼ï¼Œè€Œæ˜¯å’Œè´¢åŠ¡äººå‘˜ä¸€èµ·åå•†ï¼Œç¡®å®šä¸€ä¸ªæœ‰æ„ä¹‰çš„ç¼–ç ï¼Œè¿™ä¸ªå¯¹äºåç»­çš„äº¤æµï¼Œæ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬åœ¨é“¶è¡Œçš„æ—¶å€™ï¼Œ
æˆ‘ä»¬çš„æ´»æœŸå­˜æ¬¾çš„ç§‘ç›®æ˜¯ï¼š02870100ï¼Œè¿™ä¸ªä»£å·æ˜¯æœ‰ä¸€å®šçš„ä¸šåŠ¡å«ä¹‰çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªäºŒçº§ç§‘ç›®ï¼Œä¸€çº§ 0287 ä»£è¡¨æ´»æœŸï¼Œå¥‡æ•°ç»“å°¾æ—¶è´Ÿå€ºç±»ç§‘ç›®
ï¼ˆä¸ä¼ä¸šä¸åŒï¼Œåœ¨é“¶è¡Œï¼Œå­˜æ¬¾æ—¶è´Ÿå€ºè€Œéèµ„äº§ï¼‰ï¼Œ01 æ˜¯äºŒçº§ï¼Œè¿™ä¸ªç§‘ç›®æ²¡æœ‰ä¸‹è®¾å­ç§‘ç›®ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ç§‘ç›®ä¹‹é—´çš„çˆ¶å­å…³ç³»ï¼šæ¯”å¦‚è¯´ å®šæœŸå­˜æ¬¾ æœ‰1å¹´å®šæœŸã€2å¹´å®šæœŸã€3å¹´å®šæœŸç­‰ç»„æˆï¼Œå¯ä»¥è®¾ç«‹â€œå®šæœŸå­˜æ¬¾â€ç§‘ç›®å’Œâ€œ1å¹´å®šæœŸå­˜æ¬¾â€ç§‘ç›®ï¼Œä¸¤è€…æ˜¯çˆ¶å­å…³ç³»ã€‚ä¸€èˆ¬çš„ï¼Œ
çˆ¶ç§‘ç›®çš„ä½™é¢æ˜¯å…¨éƒ¨å­ç§‘ç›®ä½™é¢çš„æ€»å’Œï¼Œå…·æœ‰å­ç§‘ç›®çš„çˆ¶ç§‘ç›®ï¼Œä¸åº”è¯¥ç›´æ¥è¿›è¡Œè®°è´¦æ“ä½œã€‚å¦åˆ™ä¼šå¯¼è‡´æ•°æ®çš„çŸ›ç›¾ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸€èˆ¬çš„ï¼Œä¸åŒçš„ä¸šåŠ¡æµæ°´ï¼Œä¼šæœ‰ä¸åŒçš„è®°è´¦æ–¹å¼ï¼Œå…·ä½“è€Œè¨€ï¼Œå°±æ˜¯è¦å€Ÿè®°å“ªäº›å¸æˆ·ã€è´·è®°å“ªäº›å¸æˆ·ï¼Œç›¸åº”çš„è®°è´¦é‡‘é¢å¦‚ä½•ç¡®å®šï¼Ÿè¿™äº›ä¸€èˆ¬æ˜¯åœ¨ä¸šåŠ¡è®¾è®¡æ—¶å°±éœ€è¦ç¡®å®šçš„ï¼Œ
å¼€å‘å¯ä»¥å†™æ­»åœ¨ä»£ç ä¸­ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨é…ç½®çš„æ–¹å¼æ¥è¿›è¡Œã€‚è€ƒè™‘åˆ°å¦‚ä½•è®°è´¦æ˜¯ä¸€ä¸ªç›¸å¯¹æ˜“å˜çš„è¡Œä¸ºï¼ˆä¸åŒæ—¶æœŸã€ä¸åŒçš„ä¸šåŠ¡æ¨¡å¼ã€ä¸åŒçš„ç®¡ç†ç­–ç•¥ï¼Œ
éƒ½å¯èƒ½è°ƒæ•´åŒä¸€ç¬”ä¸šåŠ¡æµæ°´çš„è®°è´¦æ–¹å¼ï¼‰ï¼Œé‡‡ç”¨é…ç½®çš„æ–¹å¼å¯ä»¥æ›´æ•æ·çš„åº”å¯¹è¿™ç§å˜åŒ–ï¼Œè€Œä¸”ï¼Œå°†è¿™ä¸€å—çš„é€»è¾‘ä»ä¸šåŠ¡æµæ°´ä¸­è§£å¶å‡ºæ¥ï¼Œä¹Ÿæ˜¯å¾ˆæœ‰ä»·å€¼çš„ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_7.png&quot; alt=&quot;img_7.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹â€œå¹³è¡¡ä½“ç³»â€ï¼Œè¿™é‡Œæœ‰é™æ€çš„å¹³è¡¡ï¼š èµ„äº§ ï¼ è´Ÿå€º ï¼‹ æ‰€æœ‰è€…æƒç›Šï¼Œ ä¹Ÿæœ‰åŠ¨æ€çš„å¹³è¡¡ï¼Œå³æ¯ä¸€ç¬”ä¼šè®¡æµæ°´ï¼Œéƒ½è¦æ»¡è¶³ï¼š æœ‰å€Ÿå¿…æœ‰è´·ï¼Œå€Ÿè´·å¿…ç›¸ç­‰ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æœ‰äº†è¿™ä¸¤ä¸ªå¹³è¡¡å…³ç³»ï¼Œæˆ‘ä»¬åœ¨æ¯å¤©ï¼ˆæˆ–è€…æ¯ä¸ªå‘¨æœŸå¼€å§‹ï¼‰ï¼Œåº”è¯¥æ»¡è¶³é™æ€å¹³è¡¡ï¼Œåœ¨æ¯ä¸ªæ—¥ç»ˆï¼ˆæˆ–è€…å‘¨æœŸç»“æŸï¼‰ï¼Œä¹Ÿåº”è¯¥æ»¡è¶³é™æ€å¹³è¡¡ã€‚ä»»ä½•æ—¶å€™ï¼Œç³»ç»Ÿçš„è¿™ä¸ªå¹³è¡¡å…³ç³»å‡ºç°æ‰“ç ´ï¼Œ
ä¸€å®šæ˜¯ç³»ç»Ÿå‡ºç°äº†BUGã€‚ä¸€ä¸ªèƒ½å¤Ÿè‡ªæˆ‘å¹³è¡¡å’Œé—®é¢˜æ£€æµ‹çš„ç³»ç»Ÿï¼Œæ˜¯å¤šä¹ˆä¼˜ç¾çš„ä¸€ä»¶äº‹æƒ…ï¼Œè¿™ä¹Ÿä¹Ÿæ˜¯â€œå¤å¼è®°è´¦æ³•â€å¸¦æ¥çš„ä¸€ä¸ªä¼˜åŠ¿ä»·å€¼ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_8.png&quot; alt=&quot;img_8.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;ç¬¬äºŒä¸ªå¹³è¡¡æ˜¯â€œæ€»åˆ†ä¸€è‡´â€ï¼Œå³æ€»è´¦ ï¼ âˆ‘åˆ†æˆ·è´¦ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;æ¯”å¦‚åœ¨é“¶è¡Œç³»ç»Ÿä¸­ï¼Œæ¯å¤©ä¼—å¤šçš„å­˜æ¬¾ã€å–æ¬¾ã€å¼€æˆ·ã€é”€æˆ·æ“ä½œï¼Œåˆ†æˆ·è´¦çš„å˜åŒ–æ˜¯é¢‘ç¹çš„ï¼Œè¿™ä¸ªå’Œæ€»è´¦æ˜¯å¦ä¸€è‡´ï¼Œä¹Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚æˆ‘ä»¬æ—©æœŸçš„é“¶è¡Œç³»ç»Ÿï¼Œç”±äºå®‰å…¨æ€§
çš„é—®é¢˜ï¼Œç»å¸¸ä¼šå‡ºç°ä¸€äº›å†…éƒ¨äººå‘˜ä½œæ¡ˆçš„æƒ…å†µã€‚æ¯”å¦‚ï¼Œæˆ‘ç›´æ¥æ“ä½œæˆ‘ä»¬å¸æˆ·ï¼Œå°†å­˜æ¬¾ä½™é¢å¢åŠ 100ä¸‡ï¼Œå¦‚æœä¸è¿›è¡Œæ€»åˆ†æ ¸å¯¹ï¼Œå°±å¯èƒ½æŸ¥è¯¢ä¸å‡ºæ¥ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ç”±äºæ€»è´¦æœ‰è‡ªå·±çš„å¹³è¡¡ä½“ç³»ï¼ˆå¤–åŠ ä¸šåŠ¡ç›‘æ§ç®¡ç†ä½“ç³»ï¼‰ï¼Œå†åŠ ä¸Šæ€»åˆ†æ ¸å¯¹ï¼ˆæˆ‘ä»¬ä¸å¯èƒ½æ¯å¤©å¯¹ä¸Šä¸‡çš„åˆ†å¸æˆ·è¿›è¡Œé€ä¸€æ ¸æŸ¥ï¼‰ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå¯ä»¥å®ç°ä¸šåŠ¡ç³»ç»Ÿçš„
å…³é”®æ•°æ®çš„â€œè‡ªå¹³è¡¡â€æ£€æŸ¥ã€‚è¿™ä¸ªå¯¹äºé˜²èŒƒä¸šåŠ¡é£é™©æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_9.png&quot; alt=&quot;img_9.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;é™¤äº†ç³»ç»Ÿé—´çš„å¹³è¡¡å…³ç³»ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„å¹³è¡¡ï¼šâ€œè´¦æ¬¾ä¸€è‡´â€ï¼Œè´¦æ˜¯ç³»ç»Ÿå†…çš„å¸æˆ·ï¼ˆç§‘ç›®ï¼‰ä½™é¢ï¼Œæ˜¯ä¸ªæ•°å­—ï¼Œæ¬¾æ˜¯å®åœ¨çš„ç°é‡‘ï¼Œæ˜¯æˆ‘ä»¬åœ¨é“¶è¡Œå¸æˆ·çš„ä½™é¢
ï¼ˆå¯¹é“¶è¡Œæ ¸å¿ƒç³»ç»Ÿï¼Œå°±æ˜¯æŸœå°é’±ç®±ä¸­çš„ç°é‡‘ï¼‰æ˜¯éœ€è¦ä¸€è‡´çš„ã€‚è¿™ä¸ªå¹³è¡¡æ˜¯éå¸¸æœ‰ä½œç”¨çš„ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;é™æ€å¹³è¡¡ ï¼‹ åŠ¨æ€å¹³è¡¡ ï¼‹ æ€»åˆ†æ ¸å¯¹ ï¼‹ è´¦æ¬¾ä¸€è‡´ï¼Œ è¿™å‡ ä¸ªå¹³è¡¡å…³ç³»ä¸€ç¯å¥—ä¸€ç¯ï¼Œæ„å»ºäº†ä¸€å¥—éå¸¸ä¼˜ç¾ã€å®Œå–„çš„è‡ªå¹³è¡¡ä½“ç³»ï¼Œå³åŒ…æ‹¬ä¼šè®¡æ€»è´¦ã€ä¹Ÿæ¶‰åŠåˆ°åˆ†æˆ·è´¦ï¼Œ
å¹¶å’Œâ€œç°é‡‘â€è¿™ä¸ªå®ä½“æ¦‚å¿µè¿›è¡Œæ ¸å¯¹ã€‚è¿™ä¸€ç³»åˆ—çš„å¹³è¡¡å…³ç³»ï¼Œç¡®ä¿å¸æˆ·æ•°æ®çš„ä¸€è‡´æ€§ã€å®‰å…¨æ€§ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_10.png&quot; alt=&quot;img_10.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å¦å¤–ï¼Œå¦‚æœç›´æ¥ä¿®æ”¹æŸ2ä¸ªå¸æˆ·ï¼Œè€Œä¸è®°å½•ä¸šåŠ¡æµæ°´ï¼ˆä¸šåŠ¡æµæ°´æœ‰åˆ«çš„æ–¹å¼è¿›è¡Œæ ¸æŸ¥ï¼‰ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥ç ´åå‘¢ï¼Ÿè¿™ä¸€å—ï¼Œåœ¨é“¶è¡Œä½“ç³»ä¸­ä¹Ÿæœ‰å¯¹åº”çš„å®‰å…¨æªæ–½ï¼Œ
æ¯”å¦‚åŠ ä¸ŠMACå­—æ®µï¼Œæ‰‹å·¥ä¿®æ”¹æ•°æ®åº“çš„æˆæœ¬å°±å¤§ä¸ºå¢åŠ ã€‚å¦å¤–ï¼Œé‡‡ç”¨binlogç›¸ç»“åˆçš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥æ£€æŸ¥å‡ºæ²¡æœ‰æ­£å¸¸ä¸šåŠ¡æµæ°´çš„â€œç›´æ¥ä¿®æ”¹å¸æˆ·â€çš„æ“ä½œï¼Œ
ä»è€Œè¿›ä¸€æ­¥çš„å¢åŠ æ•´ä¸ªå¸åŠ¡ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_11.png&quot; alt=&quot;img_11.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;h1 id=&quot;zai-dian-shang-ping-tai-de-ying-yong&quot;&gt;åœ¨ç”µå•†å¹³å°çš„åº”ç”¨&lt;&#x2F;h1&gt;
&lt;p&gt;ä¸‹é¢ï¼Œæˆ‘å°±é™„ä¸Š2ä¸ªåº”ç”¨è¿™ä¸€æ–¹æ³•çš„å®è·µã€‚å¯ä¾›å¤§å®¶å‚è€ƒã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å…¶ä¸€æ˜¯åœ¨è…¾è®¯ç”µå•†æ—¶åº”ç”¨äºç”µå•†æ”¯ä»˜ç»“ç®—ã€‚
&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_12.png&quot; alt=&quot;img_12.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_13.png&quot; alt=&quot;img_13.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_14.png&quot; alt=&quot;img_14.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å…¶äºŒæ˜¯ç›®å‰æˆ‘ä»¬åœ¨å¿«å¡‘ç½‘åº”ç”¨çš„è®¢å•ç»“ç®—ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_15.png&quot; alt=&quot;img_15.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨å¿«å¡‘ç½‘åº”ç”¨â€œå¤å¼è®°è´¦â€æ¥åº”å¯¹è®¢å•ç»“ç®—æ—¶ï¼Œæ˜¯äº«å—åˆ°äº†è¿™å¼ æ¨¡å¼å¸¦ç»™æˆ‘ä»¬çš„â€œçº¢åˆ©â€çš„ã€‚ç®€å•çš„æ¥è¯´ï¼Œåœ¨åº”ç”¨â€œæ”¶ä»˜â€è®°è´¦æ¨¡å¼æ—¶ï¼Œè¦è¡¨è¾¾å¤æ‚çš„èµ„é‡‘å…³ç³»æ˜¯éå¸¸å›°éš¾çš„ã€‚
é‡‡ç”¨äº†â€œå¤å¼è®°è´¦â€æ¨¡å¼åï¼Œè¿™ä¸ªå›°éš¾ä»â€œå¼€å‘å›¢é˜Ÿâ€è½¬ç§»åˆ°äº†â€œäº§å“å›¢é˜Ÿâ€ï¼Œåªè¦äº§å“å±‚é¢èƒ½å¤Ÿæ¸…æ™°çš„æè¿°å‡ºæ¥ï¼Œå¼€å‘çš„å®ç°å°±å˜å¾—ç®€å•ï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªç¿»è¯‘çš„å·¥ä½œã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åˆç†çš„è®¾ç½®å¥½å¸æˆ·ç»“æ„ã€ä»¥åŠç¡®å®šå¥½æ¯ä¸€ç¬”ä¸šåŠ¡æµæ°´çš„è®°è´¦æ–¹å¼ï¼ˆè¿™ä¸€æ–¹é¢å¯ä»¥è¯·æ•™å…¬å¸çš„è´¢åŠ¡ä¸“å®¶ï¼‰ï¼Œå‰©ä¸‹çš„é—®é¢˜å°±è¿åˆƒè€Œè§£äº†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_16.png&quot; alt=&quot;img_16.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;è¿™æ˜¯æˆ‘ä»¬çš„è®¢å•ç»“ç®—æ‰€æ¶‰åŠåˆ°çš„å¸æˆ·ç»“æ„ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;è¿™ä¸ªå¸åŠ¡ç»“æ„çš„è®¾è®¡ï¼Œæ˜¯â€œéä¸“ä¸šçš„â€œï¼Œæˆ‘ä»¬æ˜¯ç«™åœ¨ä¸šåŠ¡è¿è¥çš„è§’åº¦ä¸Šï¼Œå¹¶æ²¡æœ‰åˆ»æ„çš„è¿½æ±‚æ˜¯å¦ç¬¦åˆâ€è´¢åŠ¡â€œæ ‡å‡†ã€‚ä¸è¿‡ï¼Œæœ‰ä¸€äº›è´¢åŠ¡ç»éªŒè¿˜æ˜¯ä¼šå¾ˆæœ‰å¸®åŠ©çš„ã€‚
è¿™ä¸€å—ï¼Œä¹Ÿå¯ä»¥å’¨è¯¢å…¬å¸çš„è´¢åŠ¡åŒäº‹ï¼Œè·å¾—å»ºè®®ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;wangzaixiang.github.io&#x2F;blog&#x2F;account-system&#x2F;img_17.png&quot; alt=&quot;img_17.png&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªä¸šåŠ¡æµæ°´ï¼Œå¦‚ä½•è¿›è¡Œè®°è´¦çš„èŒƒä¾‹ã€‚åŒæ ·ï¼Œä¹Ÿæ˜¯â€œéè´¢åŠ¡ä¸“ä¸šâ€çš„ã€‚&lt;&#x2F;p&gt;
</content>
        
    </entry>
</feed>
