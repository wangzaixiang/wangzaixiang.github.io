---
layout: ddd
prev: learn-scala-3.html
up: learn-scala.html
---
### Phase 4: 隔离副作用

> 我们的Scala历程回顾：
> 
> 我是从2015开始，选择Scala作为团队开发的主语言的，2015年，我们主要停留在第一阶段，工程师更多的使用Scala作为Java的一个简单替换。
> 
> 2016-2017年，是第二阶段的过程。随着团队对Scala的语感比较熟悉，我们开始应用更多的函数式特性，使用 expr 来减少 var 的使用，使用强大的集合库、高阶函数来替代冗长的循环。但总体感觉，相比Java仍然没有巨大的突破，而且，工程师很难在 OO 和 FP 中权衡。所以，如果从工程的角度来看，这种阶段似乎处在一个“四不像”的尴尬状态，很多代码似乎都比Java版本有更好的可读性，但仍然有相当的代码处在Java的模式之中，混合使用 mutable / immutable， var/val 等带来了一定的审美障碍。
> 
> 随着我们对FP的喜好，和对OO的憎恶（更客观是说，应该是对命令式语言的厌恶），我们越发不喜欢这种混合的编程模式。于是，在2017年10月份，我们启动了一个拒绝 var/mutable/return 的项目，想探索彻底改变的可能性。
> - 首先，我们调整了Dapeng SOA的代码生成模式，为其新增了一个scala模式的Service API，全部采用Case Class作为API的数据结构。
> - 升级了我们的底层的DAO框架 scala-sql，使其近支持 Case Class，不再支持 mutable 的数据处理。
> - 在service implementation层面，约定no var, no mutable, no break, no return, no null的风格。
> 
> 通过这种内（scala-sql）外(service API)夹攻，和编程约定，我们完成第一个大约1人月的试点项目。当这个试点项目结束时，我们获得了极大的自信和满足感：
> - 试点项目的代码可读性明显提升。
> - 除了在第1-2周，对这种风格的转换有所不适，后期逐步接受了新的风格，并且明显从内心中更倾向新的风格。
> - 习惯了新的风格之后，工作效率进一步的提升，代码可读性和质量也感觉更好了。
> - 终于彻底的抛弃命令式的习惯，以及抛弃混杂式的编程习惯，最终的产出更加纯洁，成就感更高。
> 
> 2018年，我们的团队成员大部分加入了 Today 新零售平台，这种新的开发模式也成为新平台的基础选项，所面临的一个新问题就是开发人员的招聘。在此之前，我们的团队成员一般都有1-2个月以上的适应期，从Java逐步转化到Scala来。而新的团队，所招聘人员无一例外都是完全没有Scala经验的，而项目压力则要求，所有人员能马上投入工作，尽快交付项目代码。
> 
> 我们完全按照Java的标准进行程序员面试，无需其具备Scala经验（甚至Java 8的lambda编程经验），但告知其入职之后，需要转换到Scala开发之中。有极少的工程师会拒绝我们的机会（这类同学都是工作经验较长，Java基础较好的），新入职人员，我们会提供2周的培训时间，在2周时间内，要求其完成我们的第一阶段、第二阶段的培训工作。并了解我们的第三阶段要求。
> 
> 当然，在这个过程中，我们已经培养的一个基础核心团队，会为所有新同学提供支援，帮助新人应对简单或复杂的问题。有一个熟练的、有经验的支撑团队，有一个成熟的开发模式（虽然我们也就是1个人月的实验项目），新人入手的时间会很快。
> 
> 当然，第三阶段的培训，很多是在投入实际项目之中，一边工作、一边练习的。这个过程仍然依赖以老带新的模式来支持。一般的，经历2-4周的实践开发，工程师可以彻底的接受我们的标准，并熟练的工作，并交付出更高质量的业务代码。

年我们的团队，在2017年之前，还处在“更好的Java”这个阶段，2018年度我们完成了“不变性”这个挑战，获得成果是非常显著的，但目前而言，我们在代码质量方面仍然不够满意，为此，我给团队的下一个目标是：在2019年度，我们要实现“隔离副作用”这个实现层面的巨大挑战，我相信，如果达到这个境界，我们的代码质量会出现一次新的飞跃。

